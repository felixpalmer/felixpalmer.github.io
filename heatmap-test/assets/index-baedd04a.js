var V8=Object.defineProperty;var $8=(t,e,n)=>e in t?V8(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var L=(t,e,n)=>($8(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Gne=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function G0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ZE={exports:{}},at={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nu=Symbol.for("react.element"),W8=Symbol.for("react.portal"),j8=Symbol.for("react.fragment"),H8=Symbol.for("react.strict_mode"),X8=Symbol.for("react.profiler"),Q8=Symbol.for("react.provider"),Y8=Symbol.for("react.context"),q8=Symbol.for("react.forward_ref"),Z8=Symbol.for("react.suspense"),K8=Symbol.for("react.memo"),G8=Symbol.for("react.lazy"),Qv=Symbol.iterator;function J8(t){return t===null||typeof t!="object"?null:(t=Qv&&t[Qv]||t["@@iterator"],typeof t=="function"?t:null)}var KE={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},GE=Object.assign,JE={};function Xl(t,e,n){this.props=t,this.context=e,this.refs=JE,this.updater=n||KE}Xl.prototype.isReactComponent={};Xl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Xl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function eS(){}eS.prototype=Xl.prototype;function p2(t,e,n){this.props=t,this.context=e,this.refs=JE,this.updater=n||KE}var g2=p2.prototype=new eS;g2.constructor=p2;GE(g2,Xl.prototype);g2.isPureReactComponent=!0;var Yv=Array.isArray,tS=Object.prototype.hasOwnProperty,m2={current:null},nS={key:!0,ref:!0,__self:!0,__source:!0};function rS(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)tS.call(e,r)&&!nS.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var u=Array(a),h=0;h<a;h++)u[h]=arguments[h+2];i.children=u}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:nu,type:t,key:s,ref:o,props:i,_owner:m2.current}}function eO(t,e){return{$$typeof:nu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function _2(t){return typeof t=="object"&&t!==null&&t.$$typeof===nu}function tO(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var qv=/\/+/g;function fp(t,e){return typeof t=="object"&&t!==null&&t.key!=null?tO(""+t.key):e.toString(36)}function Hf(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case nu:case W8:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+fp(o,0):r,Yv(i)?(n="",t!=null&&(n=t.replace(qv,"$&/")+"/"),Hf(i,e,n,"",function(h){return h})):i!=null&&(_2(i)&&(i=eO(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(qv,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",Yv(t))for(var a=0;a<t.length;a++){s=t[a];var u=r+fp(s,a);o+=Hf(s,e,n,u,i)}else if(u=J8(t),typeof u=="function")for(t=u.call(t),a=0;!(s=t.next()).done;)s=s.value,u=r+fp(s,a++),o+=Hf(s,e,n,u,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Du(t,e,n){if(t==null)return t;var r=[],i=0;return Hf(t,r,"","",function(s){return e.call(n,s,i++)}),r}function nO(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Yn={current:null},Xf={transition:null},rO={ReactCurrentDispatcher:Yn,ReactCurrentBatchConfig:Xf,ReactCurrentOwner:m2};function iS(){throw Error("act(...) is not supported in production builds of React.")}at.Children={map:Du,forEach:function(t,e,n){Du(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Du(t,function(){e++}),e},toArray:function(t){return Du(t,function(e){return e})||[]},only:function(t){if(!_2(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};at.Component=Xl;at.Fragment=j8;at.Profiler=X8;at.PureComponent=p2;at.StrictMode=H8;at.Suspense=Z8;at.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rO;at.act=iS;at.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=GE({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=m2.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(u in e)tS.call(e,u)&&!nS.hasOwnProperty(u)&&(r[u]=e[u]===void 0&&a!==void 0?a[u]:e[u])}var u=arguments.length-2;if(u===1)r.children=n;else if(1<u){a=Array(u);for(var h=0;h<u;h++)a[h]=arguments[h+2];r.children=a}return{$$typeof:nu,type:t.type,key:i,ref:s,props:r,_owner:o}};at.createContext=function(t){return t={$$typeof:Y8,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Q8,_context:t},t.Consumer=t};at.createElement=rS;at.createFactory=function(t){var e=rS.bind(null,t);return e.type=t,e};at.createRef=function(){return{current:null}};at.forwardRef=function(t){return{$$typeof:q8,render:t}};at.isValidElement=_2;at.lazy=function(t){return{$$typeof:G8,_payload:{_status:-1,_result:t},_init:nO}};at.memo=function(t,e){return{$$typeof:K8,type:t,compare:e===void 0?null:e}};at.startTransition=function(t){var e=Xf.transition;Xf.transition={};try{t()}finally{Xf.transition=e}};at.unstable_act=iS;at.useCallback=function(t,e){return Yn.current.useCallback(t,e)};at.useContext=function(t){return Yn.current.useContext(t)};at.useDebugValue=function(){};at.useDeferredValue=function(t){return Yn.current.useDeferredValue(t)};at.useEffect=function(t,e){return Yn.current.useEffect(t,e)};at.useId=function(){return Yn.current.useId()};at.useImperativeHandle=function(t,e,n){return Yn.current.useImperativeHandle(t,e,n)};at.useInsertionEffect=function(t,e){return Yn.current.useInsertionEffect(t,e)};at.useLayoutEffect=function(t,e){return Yn.current.useLayoutEffect(t,e)};at.useMemo=function(t,e){return Yn.current.useMemo(t,e)};at.useReducer=function(t,e,n){return Yn.current.useReducer(t,e,n)};at.useRef=function(t){return Yn.current.useRef(t)};at.useState=function(t){return Yn.current.useState(t)};at.useSyncExternalStore=function(t,e,n){return Yn.current.useSyncExternalStore(t,e,n)};at.useTransition=function(){return Yn.current.useTransition()};at.version="18.3.1";ZE.exports=at;var Ce=ZE.exports;const pt=G0(Ce);var sS={exports:{}},vr={},oS={exports:{}},aS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(K,de){var be=K.length;K.push(de);e:for(;0<be;){var Re=be-1>>>1,ze=K[Re];if(0<i(ze,de))K[Re]=de,K[be]=ze,be=Re;else break e}}function n(K){return K.length===0?null:K[0]}function r(K){if(K.length===0)return null;var de=K[0],be=K.pop();if(be!==de){K[0]=be;e:for(var Re=0,ze=K.length,_t=ze>>>1;Re<_t;){var wt=2*(Re+1)-1,it=K[wt],st=wt+1,zt=K[st];if(0>i(it,be))st<ze&&0>i(zt,it)?(K[Re]=zt,K[st]=be,Re=st):(K[Re]=it,K[wt]=be,Re=wt);else if(st<ze&&0>i(zt,be))K[Re]=zt,K[st]=be,Re=st;else break e}}return de}function i(K,de){var be=K.sortIndex-de.sortIndex;return be!==0?be:K.id-de.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var u=[],h=[],p=1,_=null,v=3,b=!1,E=!1,R=!1,D=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,S=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(K){for(var de=n(h);de!==null;){if(de.callback===null)r(h);else if(de.startTime<=K)r(h),de.sortIndex=de.expirationTime,e(u,de);else break;de=n(h)}}function M(K){if(R=!1,k(K),!E)if(n(u)!==null)E=!0,oe(V);else{var de=n(h);de!==null&&ue(M,de.startTime-K)}}function V(K,de){E=!1,R&&(R=!1,P(I),I=-1),b=!0;var be=v;try{for(k(de),_=n(u);_!==null&&(!(_.expirationTime>de)||K&&!$());){var Re=_.callback;if(typeof Re=="function"){_.callback=null,v=_.priorityLevel;var ze=Re(_.expirationTime<=de);de=t.unstable_now(),typeof ze=="function"?_.callback=ze:_===n(u)&&r(u),k(de)}else r(u);_=n(u)}if(_!==null)var _t=!0;else{var wt=n(h);wt!==null&&ue(M,wt.startTime-de),_t=!1}return _t}finally{_=null,v=be,b=!1}}var Y=!1,le=null,I=-1,O=5,U=-1;function $(){return!(t.unstable_now()-U<O)}function q(){if(le!==null){var K=t.unstable_now();U=K;var de=!0;try{de=le(!0,K)}finally{de?Z():(Y=!1,le=null)}}else Y=!1}var Z;if(typeof S=="function")Z=function(){S(q)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,G=ee.port2;ee.port1.onmessage=q,Z=function(){G.postMessage(null)}}else Z=function(){D(q,0)};function oe(K){le=K,Y||(Y=!0,Z())}function ue(K,de){I=D(function(){K(t.unstable_now())},de)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(K){K.callback=null},t.unstable_continueExecution=function(){E||b||(E=!0,oe(V))},t.unstable_forceFrameRate=function(K){0>K||125<K?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<K?Math.floor(1e3/K):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_getFirstCallbackNode=function(){return n(u)},t.unstable_next=function(K){switch(v){case 1:case 2:case 3:var de=3;break;default:de=v}var be=v;v=de;try{return K()}finally{v=be}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(K,de){switch(K){case 1:case 2:case 3:case 4:case 5:break;default:K=3}var be=v;v=K;try{return de()}finally{v=be}},t.unstable_scheduleCallback=function(K,de,be){var Re=t.unstable_now();switch(typeof be=="object"&&be!==null?(be=be.delay,be=typeof be=="number"&&0<be?Re+be:Re):be=Re,K){case 1:var ze=-1;break;case 2:ze=250;break;case 5:ze=1073741823;break;case 4:ze=1e4;break;default:ze=5e3}return ze=be+ze,K={id:p++,callback:de,priorityLevel:K,startTime:be,expirationTime:ze,sortIndex:-1},be>Re?(K.sortIndex=be,e(h,K),n(u)===null&&K===n(h)&&(R?(P(I),I=-1):R=!0,ue(M,be-Re))):(K.sortIndex=ze,e(u,K),E||b||(E=!0,oe(V))),K},t.unstable_shouldYield=$,t.unstable_wrapCallback=function(K){var de=v;return function(){var be=v;v=de;try{return K.apply(this,arguments)}finally{v=be}}}})(aS);oS.exports=aS;var iO=oS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sO=Ce,_r=iO;function Se(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lS=new Set,_A={};function la(t,e){Il(t,e),Il(t+"Capture",e)}function Il(t,e){for(_A[t]=e,t=0;t<e.length;t++)lS.add(e[t])}var ts=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Yg=Object.prototype.hasOwnProperty,oO=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Zv={},Kv={};function aO(t){return Yg.call(Kv,t)?!0:Yg.call(Zv,t)?!1:oO.test(t)?Kv[t]=!0:(Zv[t]=!0,!1)}function lO(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function cO(t,e,n,r){if(e===null||typeof e>"u"||lO(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function qn(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Sn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Sn[t]=new qn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Sn[e]=new qn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Sn[t]=new qn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Sn[t]=new qn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Sn[t]=new qn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Sn[t]=new qn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Sn[t]=new qn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Sn[t]=new qn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Sn[t]=new qn(t,5,!1,t.toLowerCase(),null,!1,!1)});var y2=/[\-:]([a-z])/g;function v2(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(y2,v2);Sn[e]=new qn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(y2,v2);Sn[e]=new qn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(y2,v2);Sn[e]=new qn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Sn[t]=new qn(t,1,!1,t.toLowerCase(),null,!1,!1)});Sn.xlinkHref=new qn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Sn[t]=new qn(t,1,!1,t.toLowerCase(),null,!0,!0)});function w2(t,e,n,r){var i=Sn.hasOwnProperty(e)?Sn[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(cO(e,n,i,r)&&(n=null),r||i===null?aO(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var As=sO.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Bu=Symbol.for("react.element"),Ha=Symbol.for("react.portal"),Xa=Symbol.for("react.fragment"),b2=Symbol.for("react.strict_mode"),qg=Symbol.for("react.profiler"),cS=Symbol.for("react.provider"),AS=Symbol.for("react.context"),x2=Symbol.for("react.forward_ref"),Zg=Symbol.for("react.suspense"),Kg=Symbol.for("react.suspense_list"),T2=Symbol.for("react.memo"),Is=Symbol.for("react.lazy"),uS=Symbol.for("react.offscreen"),Gv=Symbol.iterator;function uc(t){return t===null||typeof t!="object"?null:(t=Gv&&t[Gv]||t["@@iterator"],typeof t=="function"?t:null)}var Ht=Object.assign,hp;function Rc(t){if(hp===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);hp=e&&e[1]||""}return`
`+hp+t}var dp=!1;function pp(t,e){if(!t||dp)return"";dp=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(h){var r=h}Reflect.construct(t,[],e)}else{try{e.call()}catch(h){r=h}t.call(e.prototype)}else{try{throw Error()}catch(h){r=h}t()}}catch(h){if(h&&r&&typeof h.stack=="string"){for(var i=h.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var u=`
`+i[o].replace(" at new "," at ");return t.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",t.displayName)),u}while(1<=o&&0<=a);break}}}finally{dp=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Rc(t):""}function AO(t){switch(t.tag){case 5:return Rc(t.type);case 16:return Rc("Lazy");case 13:return Rc("Suspense");case 19:return Rc("SuspenseList");case 0:case 2:case 15:return t=pp(t.type,!1),t;case 11:return t=pp(t.type.render,!1),t;case 1:return t=pp(t.type,!0),t;default:return""}}function Gg(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Xa:return"Fragment";case Ha:return"Portal";case qg:return"Profiler";case b2:return"StrictMode";case Zg:return"Suspense";case Kg:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case AS:return(t.displayName||"Context")+".Consumer";case cS:return(t._context.displayName||"Context")+".Provider";case x2:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case T2:return e=t.displayName||null,e!==null?e:Gg(t.type)||"Memo";case Is:e=t._payload,t=t._init;try{return Gg(t(e))}catch{}}return null}function uO(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Gg(e);case 8:return e===b2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function oo(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function fS(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function fO(t){var e=fS(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Lu(t){t._valueTracker||(t._valueTracker=fO(t))}function hS(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=fS(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Th(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Jg(t,e){var n=e.checked;return Ht({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Jv(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=oo(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function dS(t,e){e=e.checked,e!=null&&w2(t,"checked",e,!1)}function em(t,e){dS(t,e);var n=oo(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?tm(t,e.type,n):e.hasOwnProperty("defaultValue")&&tm(t,e.type,oo(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function ew(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function tm(t,e,n){(e!=="number"||Th(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var kc=Array.isArray;function _l(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+oo(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function nm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Se(91));return Ht({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function tw(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(Se(92));if(kc(n)){if(1<n.length)throw Error(Se(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:oo(n)}}function pS(t,e){var n=oo(e.value),r=oo(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function nw(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function gS(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function rm(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?gS(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Fu,mS=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Fu=Fu||document.createElement("div"),Fu.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Fu.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function yA(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var jc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},hO=["Webkit","ms","Moz","O"];Object.keys(jc).forEach(function(t){hO.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),jc[e]=jc[t]})});function _S(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||jc.hasOwnProperty(t)&&jc[t]?(""+e).trim():e+"px"}function yS(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=_S(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var dO=Ht({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function im(t,e){if(e){if(dO[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Se(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Se(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Se(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Se(62))}}function sm(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var om=null;function E2(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var am=null,yl=null,vl=null;function rw(t){if(t=su(t)){if(typeof am!="function")throw Error(Se(280));var e=t.stateNode;e&&(e=rd(e),am(t.stateNode,t.type,e))}}function vS(t){yl?vl?vl.push(t):vl=[t]:yl=t}function wS(){if(yl){var t=yl,e=vl;if(vl=yl=null,rw(t),e)for(t=0;t<e.length;t++)rw(e[t])}}function bS(t,e){return t(e)}function xS(){}var gp=!1;function TS(t,e,n){if(gp)return t(e,n);gp=!0;try{return bS(t,e,n)}finally{gp=!1,(yl!==null||vl!==null)&&(xS(),wS())}}function vA(t,e){var n=t.stateNode;if(n===null)return null;var r=rd(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(Se(231,e,typeof n));return n}var lm=!1;if(ts)try{var fc={};Object.defineProperty(fc,"passive",{get:function(){lm=!0}}),window.addEventListener("test",fc,fc),window.removeEventListener("test",fc,fc)}catch{lm=!1}function pO(t,e,n,r,i,s,o,a,u){var h=Array.prototype.slice.call(arguments,3);try{e.apply(n,h)}catch(p){this.onError(p)}}var Hc=!1,Eh=null,Sh=!1,cm=null,gO={onError:function(t){Hc=!0,Eh=t}};function mO(t,e,n,r,i,s,o,a,u){Hc=!1,Eh=null,pO.apply(gO,arguments)}function _O(t,e,n,r,i,s,o,a,u){if(mO.apply(this,arguments),Hc){if(Hc){var h=Eh;Hc=!1,Eh=null}else throw Error(Se(198));Sh||(Sh=!0,cm=h)}}function ca(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function ES(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function iw(t){if(ca(t)!==t)throw Error(Se(188))}function yO(t){var e=t.alternate;if(!e){if(e=ca(t),e===null)throw Error(Se(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return iw(i),t;if(s===r)return iw(i),e;s=s.sibling}throw Error(Se(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(Se(189))}}if(n.alternate!==r)throw Error(Se(190))}if(n.tag!==3)throw Error(Se(188));return n.stateNode.current===n?t:e}function SS(t){return t=yO(t),t!==null?CS(t):null}function CS(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=CS(t);if(e!==null)return e;t=t.sibling}return null}var PS=_r.unstable_scheduleCallback,sw=_r.unstable_cancelCallback,vO=_r.unstable_shouldYield,wO=_r.unstable_requestPaint,Kt=_r.unstable_now,bO=_r.unstable_getCurrentPriorityLevel,S2=_r.unstable_ImmediatePriority,RS=_r.unstable_UserBlockingPriority,Ch=_r.unstable_NormalPriority,xO=_r.unstable_LowPriority,kS=_r.unstable_IdlePriority,J0=null,ki=null;function TO(t){if(ki&&typeof ki.onCommitFiberRoot=="function")try{ki.onCommitFiberRoot(J0,t,void 0,(t.current.flags&128)===128)}catch{}}var ii=Math.clz32?Math.clz32:CO,EO=Math.log,SO=Math.LN2;function CO(t){return t>>>=0,t===0?32:31-(EO(t)/SO|0)|0}var Uu=64,zu=4194304;function Ic(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Ph(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=Ic(a):(s&=o,s!==0&&(r=Ic(s)))}else o=n&~i,o!==0?r=Ic(o):s!==0&&(r=Ic(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-ii(e),i=1<<n,r|=t[n],e&=~i;return r}function PO(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function RO(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-ii(s),a=1<<o,u=i[o];u===-1?(!(a&n)||a&r)&&(i[o]=PO(a,e)):u<=e&&(t.expiredLanes|=a),s&=~a}}function Am(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function IS(){var t=Uu;return Uu<<=1,!(Uu&4194240)&&(Uu=64),t}function mp(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function ru(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ii(e),t[e]=n}function kO(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-ii(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function C2(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-ii(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var Tt=0;function MS(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var OS,P2,NS,DS,BS,um=!1,Vu=[],Ys=null,qs=null,Zs=null,wA=new Map,bA=new Map,Ls=[],IO="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ow(t,e){switch(t){case"focusin":case"focusout":Ys=null;break;case"dragenter":case"dragleave":qs=null;break;case"mouseover":case"mouseout":Zs=null;break;case"pointerover":case"pointerout":wA.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":bA.delete(e.pointerId)}}function hc(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=su(e),e!==null&&P2(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function MO(t,e,n,r,i){switch(e){case"focusin":return Ys=hc(Ys,t,e,n,r,i),!0;case"dragenter":return qs=hc(qs,t,e,n,r,i),!0;case"mouseover":return Zs=hc(Zs,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return wA.set(s,hc(wA.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,bA.set(s,hc(bA.get(s)||null,t,e,n,r,i)),!0}return!1}function LS(t){var e=ko(t.target);if(e!==null){var n=ca(e);if(n!==null){if(e=n.tag,e===13){if(e=ES(n),e!==null){t.blockedOn=e,BS(t.priority,function(){NS(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Qf(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=fm(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);om=r,n.target.dispatchEvent(r),om=null}else return e=su(n),e!==null&&P2(e),t.blockedOn=n,!1;e.shift()}return!0}function aw(t,e,n){Qf(t)&&n.delete(e)}function OO(){um=!1,Ys!==null&&Qf(Ys)&&(Ys=null),qs!==null&&Qf(qs)&&(qs=null),Zs!==null&&Qf(Zs)&&(Zs=null),wA.forEach(aw),bA.forEach(aw)}function dc(t,e){t.blockedOn===e&&(t.blockedOn=null,um||(um=!0,_r.unstable_scheduleCallback(_r.unstable_NormalPriority,OO)))}function xA(t){function e(i){return dc(i,t)}if(0<Vu.length){dc(Vu[0],t);for(var n=1;n<Vu.length;n++){var r=Vu[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ys!==null&&dc(Ys,t),qs!==null&&dc(qs,t),Zs!==null&&dc(Zs,t),wA.forEach(e),bA.forEach(e),n=0;n<Ls.length;n++)r=Ls[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Ls.length&&(n=Ls[0],n.blockedOn===null);)LS(n),n.blockedOn===null&&Ls.shift()}var wl=As.ReactCurrentBatchConfig,Rh=!0;function NO(t,e,n,r){var i=Tt,s=wl.transition;wl.transition=null;try{Tt=1,R2(t,e,n,r)}finally{Tt=i,wl.transition=s}}function DO(t,e,n,r){var i=Tt,s=wl.transition;wl.transition=null;try{Tt=4,R2(t,e,n,r)}finally{Tt=i,wl.transition=s}}function R2(t,e,n,r){if(Rh){var i=fm(t,e,n,r);if(i===null)Cp(t,e,r,kh,n),ow(t,r);else if(MO(i,t,e,n,r))r.stopPropagation();else if(ow(t,r),e&4&&-1<IO.indexOf(t)){for(;i!==null;){var s=su(i);if(s!==null&&OS(s),s=fm(t,e,n,r),s===null&&Cp(t,e,r,kh,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Cp(t,e,r,null,n)}}var kh=null;function fm(t,e,n,r){if(kh=null,t=E2(r),t=ko(t),t!==null)if(e=ca(t),e===null)t=null;else if(n=e.tag,n===13){if(t=ES(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return kh=t,null}function FS(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(bO()){case S2:return 1;case RS:return 4;case Ch:case xO:return 16;case kS:return 536870912;default:return 16}default:return 16}}var zs=null,k2=null,Yf=null;function US(){if(Yf)return Yf;var t,e=k2,n=e.length,r,i="value"in zs?zs.value:zs.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return Yf=i.slice(t,1<r?1-r:void 0)}function qf(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function $u(){return!0}function lw(){return!1}function wr(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?$u:lw,this.isPropagationStopped=lw,this}return Ht(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=$u)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=$u)},persist:function(){},isPersistent:$u}),e}var Ql={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},I2=wr(Ql),iu=Ht({},Ql,{view:0,detail:0}),BO=wr(iu),_p,yp,pc,ed=Ht({},iu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:M2,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==pc&&(pc&&t.type==="mousemove"?(_p=t.screenX-pc.screenX,yp=t.screenY-pc.screenY):yp=_p=0,pc=t),_p)},movementY:function(t){return"movementY"in t?t.movementY:yp}}),cw=wr(ed),LO=Ht({},ed,{dataTransfer:0}),FO=wr(LO),UO=Ht({},iu,{relatedTarget:0}),vp=wr(UO),zO=Ht({},Ql,{animationName:0,elapsedTime:0,pseudoElement:0}),VO=wr(zO),$O=Ht({},Ql,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),WO=wr($O),jO=Ht({},Ql,{data:0}),Aw=wr(jO),HO={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},XO={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},QO={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YO(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=QO[t])?!!e[t]:!1}function M2(){return YO}var qO=Ht({},iu,{key:function(t){if(t.key){var e=HO[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=qf(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?XO[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:M2,charCode:function(t){return t.type==="keypress"?qf(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?qf(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),ZO=wr(qO),KO=Ht({},ed,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),uw=wr(KO),GO=Ht({},iu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:M2}),JO=wr(GO),eN=Ht({},Ql,{propertyName:0,elapsedTime:0,pseudoElement:0}),tN=wr(eN),nN=Ht({},ed,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),rN=wr(nN),iN=[9,13,27,32],O2=ts&&"CompositionEvent"in window,Xc=null;ts&&"documentMode"in document&&(Xc=document.documentMode);var sN=ts&&"TextEvent"in window&&!Xc,zS=ts&&(!O2||Xc&&8<Xc&&11>=Xc),fw=String.fromCharCode(32),hw=!1;function VS(t,e){switch(t){case"keyup":return iN.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $S(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Qa=!1;function oN(t,e){switch(t){case"compositionend":return $S(e);case"keypress":return e.which!==32?null:(hw=!0,fw);case"textInput":return t=e.data,t===fw&&hw?null:t;default:return null}}function aN(t,e){if(Qa)return t==="compositionend"||!O2&&VS(t,e)?(t=US(),Yf=k2=zs=null,Qa=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return zS&&e.locale!=="ko"?null:e.data;default:return null}}var lN={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function dw(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!lN[t.type]:e==="textarea"}function WS(t,e,n,r){vS(r),e=Ih(e,"onChange"),0<e.length&&(n=new I2("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Qc=null,TA=null;function cN(t){e4(t,0)}function td(t){var e=Za(t);if(hS(e))return t}function AN(t,e){if(t==="change")return e}var jS=!1;if(ts){var wp;if(ts){var bp="oninput"in document;if(!bp){var pw=document.createElement("div");pw.setAttribute("oninput","return;"),bp=typeof pw.oninput=="function"}wp=bp}else wp=!1;jS=wp&&(!document.documentMode||9<document.documentMode)}function gw(){Qc&&(Qc.detachEvent("onpropertychange",HS),TA=Qc=null)}function HS(t){if(t.propertyName==="value"&&td(TA)){var e=[];WS(e,TA,t,E2(t)),TS(cN,e)}}function uN(t,e,n){t==="focusin"?(gw(),Qc=e,TA=n,Qc.attachEvent("onpropertychange",HS)):t==="focusout"&&gw()}function fN(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return td(TA)}function hN(t,e){if(t==="click")return td(e)}function dN(t,e){if(t==="input"||t==="change")return td(e)}function pN(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var ai=typeof Object.is=="function"?Object.is:pN;function EA(t,e){if(ai(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Yg.call(e,i)||!ai(t[i],e[i]))return!1}return!0}function mw(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function _w(t,e){var n=mw(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=mw(n)}}function XS(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?XS(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function QS(){for(var t=window,e=Th();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Th(t.document)}return e}function N2(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function gN(t){var e=QS(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&XS(n.ownerDocument.documentElement,n)){if(r!==null&&N2(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=_w(n,s);var o=_w(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mN=ts&&"documentMode"in document&&11>=document.documentMode,Ya=null,hm=null,Yc=null,dm=!1;function yw(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;dm||Ya==null||Ya!==Th(r)||(r=Ya,"selectionStart"in r&&N2(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Yc&&EA(Yc,r)||(Yc=r,r=Ih(hm,"onSelect"),0<r.length&&(e=new I2("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=Ya)))}function Wu(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var qa={animationend:Wu("Animation","AnimationEnd"),animationiteration:Wu("Animation","AnimationIteration"),animationstart:Wu("Animation","AnimationStart"),transitionend:Wu("Transition","TransitionEnd")},xp={},YS={};ts&&(YS=document.createElement("div").style,"AnimationEvent"in window||(delete qa.animationend.animation,delete qa.animationiteration.animation,delete qa.animationstart.animation),"TransitionEvent"in window||delete qa.transitionend.transition);function nd(t){if(xp[t])return xp[t];if(!qa[t])return t;var e=qa[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in YS)return xp[t]=e[n];return t}var qS=nd("animationend"),ZS=nd("animationiteration"),KS=nd("animationstart"),GS=nd("transitionend"),JS=new Map,vw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ao(t,e){JS.set(t,e),la(e,[t])}for(var Tp=0;Tp<vw.length;Tp++){var Ep=vw[Tp],_N=Ep.toLowerCase(),yN=Ep[0].toUpperCase()+Ep.slice(1);Ao(_N,"on"+yN)}Ao(qS,"onAnimationEnd");Ao(ZS,"onAnimationIteration");Ao(KS,"onAnimationStart");Ao("dblclick","onDoubleClick");Ao("focusin","onFocus");Ao("focusout","onBlur");Ao(GS,"onTransitionEnd");Il("onMouseEnter",["mouseout","mouseover"]);Il("onMouseLeave",["mouseout","mouseover"]);Il("onPointerEnter",["pointerout","pointerover"]);Il("onPointerLeave",["pointerout","pointerover"]);la("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));la("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));la("onBeforeInput",["compositionend","keypress","textInput","paste"]);la("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));la("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));la("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Mc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),vN=new Set("cancel close invalid load scroll toggle".split(" ").concat(Mc));function ww(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,_O(r,e,void 0,t),t.currentTarget=null}function e4(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],u=a.instance,h=a.currentTarget;if(a=a.listener,u!==s&&i.isPropagationStopped())break e;ww(i,a,h),s=u}else for(o=0;o<r.length;o++){if(a=r[o],u=a.instance,h=a.currentTarget,a=a.listener,u!==s&&i.isPropagationStopped())break e;ww(i,a,h),s=u}}}if(Sh)throw t=cm,Sh=!1,cm=null,t}function Mt(t,e){var n=e[ym];n===void 0&&(n=e[ym]=new Set);var r=t+"__bubble";n.has(r)||(t4(e,t,2,!1),n.add(r))}function Sp(t,e,n){var r=0;e&&(r|=4),t4(n,t,r,e)}var ju="_reactListening"+Math.random().toString(36).slice(2);function SA(t){if(!t[ju]){t[ju]=!0,lS.forEach(function(n){n!=="selectionchange"&&(vN.has(n)||Sp(n,!1,t),Sp(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ju]||(e[ju]=!0,Sp("selectionchange",!1,e))}}function t4(t,e,n,r){switch(FS(e)){case 1:var i=NO;break;case 4:i=DO;break;default:i=R2}n=i.bind(null,e,n,t),i=void 0,!lm||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Cp(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var u=o.tag;if((u===3||u===4)&&(u=o.stateNode.containerInfo,u===i||u.nodeType===8&&u.parentNode===i))return;o=o.return}for(;a!==null;){if(o=ko(a),o===null)return;if(u=o.tag,u===5||u===6){r=s=o;continue e}a=a.parentNode}}r=r.return}TS(function(){var h=s,p=E2(n),_=[];e:{var v=JS.get(t);if(v!==void 0){var b=I2,E=t;switch(t){case"keypress":if(qf(n)===0)break e;case"keydown":case"keyup":b=ZO;break;case"focusin":E="focus",b=vp;break;case"focusout":E="blur",b=vp;break;case"beforeblur":case"afterblur":b=vp;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":b=cw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":b=FO;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":b=JO;break;case qS:case ZS:case KS:b=VO;break;case GS:b=tN;break;case"scroll":b=BO;break;case"wheel":b=rN;break;case"copy":case"cut":case"paste":b=WO;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":b=uw}var R=(e&4)!==0,D=!R&&t==="scroll",P=R?v!==null?v+"Capture":null:v;R=[];for(var S=h,k;S!==null;){k=S;var M=k.stateNode;if(k.tag===5&&M!==null&&(k=M,P!==null&&(M=vA(S,P),M!=null&&R.push(CA(S,M,k)))),D)break;S=S.return}0<R.length&&(v=new b(v,E,null,n,p),_.push({event:v,listeners:R}))}}if(!(e&7)){e:{if(v=t==="mouseover"||t==="pointerover",b=t==="mouseout"||t==="pointerout",v&&n!==om&&(E=n.relatedTarget||n.fromElement)&&(ko(E)||E[ns]))break e;if((b||v)&&(v=p.window===p?p:(v=p.ownerDocument)?v.defaultView||v.parentWindow:window,b?(E=n.relatedTarget||n.toElement,b=h,E=E?ko(E):null,E!==null&&(D=ca(E),E!==D||E.tag!==5&&E.tag!==6)&&(E=null)):(b=null,E=h),b!==E)){if(R=cw,M="onMouseLeave",P="onMouseEnter",S="mouse",(t==="pointerout"||t==="pointerover")&&(R=uw,M="onPointerLeave",P="onPointerEnter",S="pointer"),D=b==null?v:Za(b),k=E==null?v:Za(E),v=new R(M,S+"leave",b,n,p),v.target=D,v.relatedTarget=k,M=null,ko(p)===h&&(R=new R(P,S+"enter",E,n,p),R.target=k,R.relatedTarget=D,M=R),D=M,b&&E)t:{for(R=b,P=E,S=0,k=R;k;k=Ca(k))S++;for(k=0,M=P;M;M=Ca(M))k++;for(;0<S-k;)R=Ca(R),S--;for(;0<k-S;)P=Ca(P),k--;for(;S--;){if(R===P||P!==null&&R===P.alternate)break t;R=Ca(R),P=Ca(P)}R=null}else R=null;b!==null&&bw(_,v,b,R,!1),E!==null&&D!==null&&bw(_,D,E,R,!0)}}e:{if(v=h?Za(h):window,b=v.nodeName&&v.nodeName.toLowerCase(),b==="select"||b==="input"&&v.type==="file")var V=AN;else if(dw(v))if(jS)V=dN;else{V=fN;var Y=uN}else(b=v.nodeName)&&b.toLowerCase()==="input"&&(v.type==="checkbox"||v.type==="radio")&&(V=hN);if(V&&(V=V(t,h))){WS(_,V,n,p);break e}Y&&Y(t,v,h),t==="focusout"&&(Y=v._wrapperState)&&Y.controlled&&v.type==="number"&&tm(v,"number",v.value)}switch(Y=h?Za(h):window,t){case"focusin":(dw(Y)||Y.contentEditable==="true")&&(Ya=Y,hm=h,Yc=null);break;case"focusout":Yc=hm=Ya=null;break;case"mousedown":dm=!0;break;case"contextmenu":case"mouseup":case"dragend":dm=!1,yw(_,n,p);break;case"selectionchange":if(mN)break;case"keydown":case"keyup":yw(_,n,p)}var le;if(O2)e:{switch(t){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Qa?VS(t,n)&&(I="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(zS&&n.locale!=="ko"&&(Qa||I!=="onCompositionStart"?I==="onCompositionEnd"&&Qa&&(le=US()):(zs=p,k2="value"in zs?zs.value:zs.textContent,Qa=!0)),Y=Ih(h,I),0<Y.length&&(I=new Aw(I,t,null,n,p),_.push({event:I,listeners:Y}),le?I.data=le:(le=$S(n),le!==null&&(I.data=le)))),(le=sN?oN(t,n):aN(t,n))&&(h=Ih(h,"onBeforeInput"),0<h.length&&(p=new Aw("onBeforeInput","beforeinput",null,n,p),_.push({event:p,listeners:h}),p.data=le))}e4(_,e)})}function CA(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Ih(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=vA(t,n),s!=null&&r.unshift(CA(t,s,i)),s=vA(t,e),s!=null&&r.push(CA(t,s,i))),t=t.return}return r}function Ca(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function bw(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,u=a.alternate,h=a.stateNode;if(u!==null&&u===r)break;a.tag===5&&h!==null&&(a=h,i?(u=vA(n,s),u!=null&&o.unshift(CA(n,u,a))):i||(u=vA(n,s),u!=null&&o.push(CA(n,u,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var wN=/\r\n?/g,bN=/\u0000|\uFFFD/g;function xw(t){return(typeof t=="string"?t:""+t).replace(wN,`
`).replace(bN,"")}function Hu(t,e,n){if(e=xw(e),xw(t)!==e&&n)throw Error(Se(425))}function Mh(){}var pm=null,gm=null;function mm(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var _m=typeof setTimeout=="function"?setTimeout:void 0,xN=typeof clearTimeout=="function"?clearTimeout:void 0,Tw=typeof Promise=="function"?Promise:void 0,TN=typeof queueMicrotask=="function"?queueMicrotask:typeof Tw<"u"?function(t){return Tw.resolve(null).then(t).catch(EN)}:_m;function EN(t){setTimeout(function(){throw t})}function Pp(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),xA(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);xA(e)}function Ks(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Ew(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Yl=Math.random().toString(36).slice(2),Ti="__reactFiber$"+Yl,PA="__reactProps$"+Yl,ns="__reactContainer$"+Yl,ym="__reactEvents$"+Yl,SN="__reactListeners$"+Yl,CN="__reactHandles$"+Yl;function ko(t){var e=t[Ti];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ns]||n[Ti]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Ew(t);t!==null;){if(n=t[Ti])return n;t=Ew(t)}return e}t=n,n=t.parentNode}return null}function su(t){return t=t[Ti]||t[ns],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Za(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Se(33))}function rd(t){return t[PA]||null}var vm=[],Ka=-1;function uo(t){return{current:t}}function Nt(t){0>Ka||(t.current=vm[Ka],vm[Ka]=null,Ka--)}function kt(t,e){Ka++,vm[Ka]=t.current,t.current=e}var ao={},Fn=uo(ao),sr=uo(!1),Xo=ao;function Ml(t,e){var n=t.type.contextTypes;if(!n)return ao;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function or(t){return t=t.childContextTypes,t!=null}function Oh(){Nt(sr),Nt(Fn)}function Sw(t,e,n){if(Fn.current!==ao)throw Error(Se(168));kt(Fn,e),kt(sr,n)}function n4(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(Se(108,uO(t)||"Unknown",i));return Ht({},n,r)}function Nh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ao,Xo=Fn.current,kt(Fn,t),kt(sr,sr.current),!0}function Cw(t,e,n){var r=t.stateNode;if(!r)throw Error(Se(169));n?(t=n4(t,e,Xo),r.__reactInternalMemoizedMergedChildContext=t,Nt(sr),Nt(Fn),kt(Fn,t)):Nt(sr),kt(sr,n)}var Wi=null,id=!1,Rp=!1;function r4(t){Wi===null?Wi=[t]:Wi.push(t)}function PN(t){id=!0,r4(t)}function fo(){if(!Rp&&Wi!==null){Rp=!0;var t=0,e=Tt;try{var n=Wi;for(Tt=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}Wi=null,id=!1}catch(i){throw Wi!==null&&(Wi=Wi.slice(t+1)),PS(S2,fo),i}finally{Tt=e,Rp=!1}}return null}var Ga=[],Ja=0,Dh=null,Bh=0,kr=[],Ir=0,Qo=null,qi=1,Zi="";function Co(t,e){Ga[Ja++]=Bh,Ga[Ja++]=Dh,Dh=t,Bh=e}function i4(t,e,n){kr[Ir++]=qi,kr[Ir++]=Zi,kr[Ir++]=Qo,Qo=t;var r=qi;t=Zi;var i=32-ii(r)-1;r&=~(1<<i),n+=1;var s=32-ii(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,qi=1<<32-ii(e)+i|n<<i|r,Zi=s+t}else qi=1<<s|n<<i|r,Zi=t}function D2(t){t.return!==null&&(Co(t,1),i4(t,1,0))}function B2(t){for(;t===Dh;)Dh=Ga[--Ja],Ga[Ja]=null,Bh=Ga[--Ja],Ga[Ja]=null;for(;t===Qo;)Qo=kr[--Ir],kr[Ir]=null,Zi=kr[--Ir],kr[Ir]=null,qi=kr[--Ir],kr[Ir]=null}var mr=null,hr=null,Ft=!1,Gr=null;function s4(t,e){var n=Mr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Pw(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,mr=t,hr=Ks(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,mr=t,hr=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Qo!==null?{id:qi,overflow:Zi}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Mr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,mr=t,hr=null,!0):!1;default:return!1}}function wm(t){return(t.mode&1)!==0&&(t.flags&128)===0}function bm(t){if(Ft){var e=hr;if(e){var n=e;if(!Pw(t,e)){if(wm(t))throw Error(Se(418));e=Ks(n.nextSibling);var r=mr;e&&Pw(t,e)?s4(r,n):(t.flags=t.flags&-4097|2,Ft=!1,mr=t)}}else{if(wm(t))throw Error(Se(418));t.flags=t.flags&-4097|2,Ft=!1,mr=t}}}function Rw(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;mr=t}function Xu(t){if(t!==mr)return!1;if(!Ft)return Rw(t),Ft=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!mm(t.type,t.memoizedProps)),e&&(e=hr)){if(wm(t))throw o4(),Error(Se(418));for(;e;)s4(t,e),e=Ks(e.nextSibling)}if(Rw(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Se(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){hr=Ks(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}hr=null}}else hr=mr?Ks(t.stateNode.nextSibling):null;return!0}function o4(){for(var t=hr;t;)t=Ks(t.nextSibling)}function Ol(){hr=mr=null,Ft=!1}function L2(t){Gr===null?Gr=[t]:Gr.push(t)}var RN=As.ReactCurrentBatchConfig;function gc(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(Se(309));var r=n.stateNode}if(!r)throw Error(Se(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(Se(284));if(!n._owner)throw Error(Se(290,t))}return t}function Qu(t,e){throw t=Object.prototype.toString.call(e),Error(Se(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function kw(t){var e=t._init;return e(t._payload)}function a4(t){function e(P,S){if(t){var k=P.deletions;k===null?(P.deletions=[S],P.flags|=16):k.push(S)}}function n(P,S){if(!t)return null;for(;S!==null;)e(P,S),S=S.sibling;return null}function r(P,S){for(P=new Map;S!==null;)S.key!==null?P.set(S.key,S):P.set(S.index,S),S=S.sibling;return P}function i(P,S){return P=to(P,S),P.index=0,P.sibling=null,P}function s(P,S,k){return P.index=k,t?(k=P.alternate,k!==null?(k=k.index,k<S?(P.flags|=2,S):k):(P.flags|=2,S)):(P.flags|=1048576,S)}function o(P){return t&&P.alternate===null&&(P.flags|=2),P}function a(P,S,k,M){return S===null||S.tag!==6?(S=Bp(k,P.mode,M),S.return=P,S):(S=i(S,k),S.return=P,S)}function u(P,S,k,M){var V=k.type;return V===Xa?p(P,S,k.props.children,M,k.key):S!==null&&(S.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Is&&kw(V)===S.type)?(M=i(S,k.props),M.ref=gc(P,S,k),M.return=P,M):(M=nh(k.type,k.key,k.props,null,P.mode,M),M.ref=gc(P,S,k),M.return=P,M)}function h(P,S,k,M){return S===null||S.tag!==4||S.stateNode.containerInfo!==k.containerInfo||S.stateNode.implementation!==k.implementation?(S=Lp(k,P.mode,M),S.return=P,S):(S=i(S,k.children||[]),S.return=P,S)}function p(P,S,k,M,V){return S===null||S.tag!==7?(S=Uo(k,P.mode,M,V),S.return=P,S):(S=i(S,k),S.return=P,S)}function _(P,S,k){if(typeof S=="string"&&S!==""||typeof S=="number")return S=Bp(""+S,P.mode,k),S.return=P,S;if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Bu:return k=nh(S.type,S.key,S.props,null,P.mode,k),k.ref=gc(P,null,S),k.return=P,k;case Ha:return S=Lp(S,P.mode,k),S.return=P,S;case Is:var M=S._init;return _(P,M(S._payload),k)}if(kc(S)||uc(S))return S=Uo(S,P.mode,k,null),S.return=P,S;Qu(P,S)}return null}function v(P,S,k,M){var V=S!==null?S.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return V!==null?null:a(P,S,""+k,M);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case Bu:return k.key===V?u(P,S,k,M):null;case Ha:return k.key===V?h(P,S,k,M):null;case Is:return V=k._init,v(P,S,V(k._payload),M)}if(kc(k)||uc(k))return V!==null?null:p(P,S,k,M,null);Qu(P,k)}return null}function b(P,S,k,M,V){if(typeof M=="string"&&M!==""||typeof M=="number")return P=P.get(k)||null,a(S,P,""+M,V);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case Bu:return P=P.get(M.key===null?k:M.key)||null,u(S,P,M,V);case Ha:return P=P.get(M.key===null?k:M.key)||null,h(S,P,M,V);case Is:var Y=M._init;return b(P,S,k,Y(M._payload),V)}if(kc(M)||uc(M))return P=P.get(k)||null,p(S,P,M,V,null);Qu(S,M)}return null}function E(P,S,k,M){for(var V=null,Y=null,le=S,I=S=0,O=null;le!==null&&I<k.length;I++){le.index>I?(O=le,le=null):O=le.sibling;var U=v(P,le,k[I],M);if(U===null){le===null&&(le=O);break}t&&le&&U.alternate===null&&e(P,le),S=s(U,S,I),Y===null?V=U:Y.sibling=U,Y=U,le=O}if(I===k.length)return n(P,le),Ft&&Co(P,I),V;if(le===null){for(;I<k.length;I++)le=_(P,k[I],M),le!==null&&(S=s(le,S,I),Y===null?V=le:Y.sibling=le,Y=le);return Ft&&Co(P,I),V}for(le=r(P,le);I<k.length;I++)O=b(le,P,I,k[I],M),O!==null&&(t&&O.alternate!==null&&le.delete(O.key===null?I:O.key),S=s(O,S,I),Y===null?V=O:Y.sibling=O,Y=O);return t&&le.forEach(function($){return e(P,$)}),Ft&&Co(P,I),V}function R(P,S,k,M){var V=uc(k);if(typeof V!="function")throw Error(Se(150));if(k=V.call(k),k==null)throw Error(Se(151));for(var Y=V=null,le=S,I=S=0,O=null,U=k.next();le!==null&&!U.done;I++,U=k.next()){le.index>I?(O=le,le=null):O=le.sibling;var $=v(P,le,U.value,M);if($===null){le===null&&(le=O);break}t&&le&&$.alternate===null&&e(P,le),S=s($,S,I),Y===null?V=$:Y.sibling=$,Y=$,le=O}if(U.done)return n(P,le),Ft&&Co(P,I),V;if(le===null){for(;!U.done;I++,U=k.next())U=_(P,U.value,M),U!==null&&(S=s(U,S,I),Y===null?V=U:Y.sibling=U,Y=U);return Ft&&Co(P,I),V}for(le=r(P,le);!U.done;I++,U=k.next())U=b(le,P,I,U.value,M),U!==null&&(t&&U.alternate!==null&&le.delete(U.key===null?I:U.key),S=s(U,S,I),Y===null?V=U:Y.sibling=U,Y=U);return t&&le.forEach(function(q){return e(P,q)}),Ft&&Co(P,I),V}function D(P,S,k,M){if(typeof k=="object"&&k!==null&&k.type===Xa&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case Bu:e:{for(var V=k.key,Y=S;Y!==null;){if(Y.key===V){if(V=k.type,V===Xa){if(Y.tag===7){n(P,Y.sibling),S=i(Y,k.props.children),S.return=P,P=S;break e}}else if(Y.elementType===V||typeof V=="object"&&V!==null&&V.$$typeof===Is&&kw(V)===Y.type){n(P,Y.sibling),S=i(Y,k.props),S.ref=gc(P,Y,k),S.return=P,P=S;break e}n(P,Y);break}else e(P,Y);Y=Y.sibling}k.type===Xa?(S=Uo(k.props.children,P.mode,M,k.key),S.return=P,P=S):(M=nh(k.type,k.key,k.props,null,P.mode,M),M.ref=gc(P,S,k),M.return=P,P=M)}return o(P);case Ha:e:{for(Y=k.key;S!==null;){if(S.key===Y)if(S.tag===4&&S.stateNode.containerInfo===k.containerInfo&&S.stateNode.implementation===k.implementation){n(P,S.sibling),S=i(S,k.children||[]),S.return=P,P=S;break e}else{n(P,S);break}else e(P,S);S=S.sibling}S=Lp(k,P.mode,M),S.return=P,P=S}return o(P);case Is:return Y=k._init,D(P,S,Y(k._payload),M)}if(kc(k))return E(P,S,k,M);if(uc(k))return R(P,S,k,M);Qu(P,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,S!==null&&S.tag===6?(n(P,S.sibling),S=i(S,k),S.return=P,P=S):(n(P,S),S=Bp(k,P.mode,M),S.return=P,P=S),o(P)):n(P,S)}return D}var Nl=a4(!0),l4=a4(!1),Lh=uo(null),Fh=null,el=null,F2=null;function U2(){F2=el=Fh=null}function z2(t){var e=Lh.current;Nt(Lh),t._currentValue=e}function xm(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function bl(t,e){Fh=t,F2=el=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(nr=!0),t.firstContext=null)}function zr(t){var e=t._currentValue;if(F2!==t)if(t={context:t,memoizedValue:e,next:null},el===null){if(Fh===null)throw Error(Se(308));el=t,Fh.dependencies={lanes:0,firstContext:t}}else el=el.next=t;return e}var Io=null;function V2(t){Io===null?Io=[t]:Io.push(t)}function c4(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,V2(e)):(n.next=i.next,i.next=n),e.interleaved=n,rs(t,r)}function rs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Ms=!1;function $2(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function A4(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Gi(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Gs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ft&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,rs(t,n)}return i=r.interleaved,i===null?(e.next=e,V2(r)):(e.next=i.next,i.next=e),r.interleaved=e,rs(t,n)}function Zf(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,C2(t,n)}}function Iw(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Uh(t,e,n,r){var i=t.updateQueue;Ms=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var u=a,h=u.next;u.next=null,o===null?s=h:o.next=h,o=u;var p=t.alternate;p!==null&&(p=p.updateQueue,a=p.lastBaseUpdate,a!==o&&(a===null?p.firstBaseUpdate=h:a.next=h,p.lastBaseUpdate=u))}if(s!==null){var _=i.baseState;o=0,p=h=u=null,a=s;do{var v=a.lane,b=a.eventTime;if((r&v)===v){p!==null&&(p=p.next={eventTime:b,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var E=t,R=a;switch(v=e,b=n,R.tag){case 1:if(E=R.payload,typeof E=="function"){_=E.call(b,_,v);break e}_=E;break e;case 3:E.flags=E.flags&-65537|128;case 0:if(E=R.payload,v=typeof E=="function"?E.call(b,_,v):E,v==null)break e;_=Ht({},_,v);break e;case 2:Ms=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,v=i.effects,v===null?i.effects=[a]:v.push(a))}else b={eventTime:b,lane:v,tag:a.tag,payload:a.payload,callback:a.callback,next:null},p===null?(h=p=b,u=_):p=p.next=b,o|=v;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;v=a,a=v.next,v.next=null,i.lastBaseUpdate=v,i.shared.pending=null}}while(1);if(p===null&&(u=_),i.baseState=u,i.firstBaseUpdate=h,i.lastBaseUpdate=p,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);qo|=o,t.lanes=o,t.memoizedState=_}}function Mw(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(Se(191,i));i.call(r)}}}var ou={},Ii=uo(ou),RA=uo(ou),kA=uo(ou);function Mo(t){if(t===ou)throw Error(Se(174));return t}function W2(t,e){switch(kt(kA,e),kt(RA,t),kt(Ii,ou),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:rm(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=rm(e,t)}Nt(Ii),kt(Ii,e)}function Dl(){Nt(Ii),Nt(RA),Nt(kA)}function u4(t){Mo(kA.current);var e=Mo(Ii.current),n=rm(e,t.type);e!==n&&(kt(RA,t),kt(Ii,n))}function j2(t){RA.current===t&&(Nt(Ii),Nt(RA))}var $t=uo(0);function zh(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var kp=[];function H2(){for(var t=0;t<kp.length;t++)kp[t]._workInProgressVersionPrimary=null;kp.length=0}var Kf=As.ReactCurrentDispatcher,Ip=As.ReactCurrentBatchConfig,Yo=0,jt=null,on=null,pn=null,Vh=!1,qc=!1,IA=0,kN=0;function Rn(){throw Error(Se(321))}function X2(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!ai(t[n],e[n]))return!1;return!0}function Q2(t,e,n,r,i,s){if(Yo=s,jt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Kf.current=t===null||t.memoizedState===null?NN:DN,t=n(r,i),qc){s=0;do{if(qc=!1,IA=0,25<=s)throw Error(Se(301));s+=1,pn=on=null,e.updateQueue=null,Kf.current=BN,t=n(r,i)}while(qc)}if(Kf.current=$h,e=on!==null&&on.next!==null,Yo=0,pn=on=jt=null,Vh=!1,e)throw Error(Se(300));return t}function Y2(){var t=IA!==0;return IA=0,t}function vi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return pn===null?jt.memoizedState=pn=t:pn=pn.next=t,pn}function Vr(){if(on===null){var t=jt.alternate;t=t!==null?t.memoizedState:null}else t=on.next;var e=pn===null?jt.memoizedState:pn.next;if(e!==null)pn=e,on=t;else{if(t===null)throw Error(Se(310));on=t,t={memoizedState:on.memoizedState,baseState:on.baseState,baseQueue:on.baseQueue,queue:on.queue,next:null},pn===null?jt.memoizedState=pn=t:pn=pn.next=t}return pn}function MA(t,e){return typeof e=="function"?e(t):e}function Mp(t){var e=Vr(),n=e.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=t;var r=on,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,u=null,h=s;do{var p=h.lane;if((Yo&p)===p)u!==null&&(u=u.next={lane:0,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null}),r=h.hasEagerState?h.eagerState:t(r,h.action);else{var _={lane:p,action:h.action,hasEagerState:h.hasEagerState,eagerState:h.eagerState,next:null};u===null?(a=u=_,o=r):u=u.next=_,jt.lanes|=p,qo|=p}h=h.next}while(h!==null&&h!==s);u===null?o=r:u.next=a,ai(r,e.memoizedState)||(nr=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=u,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,jt.lanes|=s,qo|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Op(t){var e=Vr(),n=e.queue;if(n===null)throw Error(Se(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);ai(s,e.memoizedState)||(nr=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function f4(){}function h4(t,e){var n=jt,r=Vr(),i=e(),s=!ai(r.memoizedState,i);if(s&&(r.memoizedState=i,nr=!0),r=r.queue,q2(g4.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||pn!==null&&pn.memoizedState.tag&1){if(n.flags|=2048,OA(9,p4.bind(null,n,r,i,e),void 0,null),gn===null)throw Error(Se(349));Yo&30||d4(n,e,i)}return i}function d4(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function p4(t,e,n,r){e.value=n,e.getSnapshot=r,m4(e)&&_4(t)}function g4(t,e,n){return n(function(){m4(e)&&_4(t)})}function m4(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!ai(t,n)}catch{return!0}}function _4(t){var e=rs(t,1);e!==null&&si(e,t,1,-1)}function Ow(t){var e=vi();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:MA,lastRenderedState:t},e.queue=t,t=t.dispatch=ON.bind(null,jt,t),[e.memoizedState,t]}function OA(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=jt.updateQueue,e===null?(e={lastEffect:null,stores:null},jt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function y4(){return Vr().memoizedState}function Gf(t,e,n,r){var i=vi();jt.flags|=t,i.memoizedState=OA(1|e,n,void 0,r===void 0?null:r)}function sd(t,e,n,r){var i=Vr();r=r===void 0?null:r;var s=void 0;if(on!==null){var o=on.memoizedState;if(s=o.destroy,r!==null&&X2(r,o.deps)){i.memoizedState=OA(e,n,s,r);return}}jt.flags|=t,i.memoizedState=OA(1|e,n,s,r)}function Nw(t,e){return Gf(8390656,8,t,e)}function q2(t,e){return sd(2048,8,t,e)}function v4(t,e){return sd(4,2,t,e)}function w4(t,e){return sd(4,4,t,e)}function b4(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function x4(t,e,n){return n=n!=null?n.concat([t]):null,sd(4,4,b4.bind(null,e,t),n)}function Z2(){}function T4(t,e){var n=Vr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&X2(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function E4(t,e){var n=Vr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&X2(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function S4(t,e,n){return Yo&21?(ai(n,e)||(n=IS(),jt.lanes|=n,qo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,nr=!0),t.memoizedState=n)}function IN(t,e){var n=Tt;Tt=n!==0&&4>n?n:4,t(!0);var r=Ip.transition;Ip.transition={};try{t(!1),e()}finally{Tt=n,Ip.transition=r}}function C4(){return Vr().memoizedState}function MN(t,e,n){var r=eo(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},P4(t))R4(e,n);else if(n=c4(t,e,n,r),n!==null){var i=Qn();si(n,t,r,i),k4(n,e,r)}}function ON(t,e,n){var r=eo(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(P4(t))R4(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,ai(a,o)){var u=e.interleaved;u===null?(i.next=i,V2(e)):(i.next=u.next,u.next=i),e.interleaved=i;return}}catch{}finally{}n=c4(t,e,i,r),n!==null&&(i=Qn(),si(n,t,r,i),k4(n,e,r))}}function P4(t){var e=t.alternate;return t===jt||e!==null&&e===jt}function R4(t,e){qc=Vh=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function k4(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,C2(t,n)}}var $h={readContext:zr,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},NN={readContext:zr,useCallback:function(t,e){return vi().memoizedState=[t,e===void 0?null:e],t},useContext:zr,useEffect:Nw,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Gf(4194308,4,b4.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Gf(4194308,4,t,e)},useInsertionEffect:function(t,e){return Gf(4,2,t,e)},useMemo:function(t,e){var n=vi();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=vi();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=MN.bind(null,jt,t),[r.memoizedState,t]},useRef:function(t){var e=vi();return t={current:t},e.memoizedState=t},useState:Ow,useDebugValue:Z2,useDeferredValue:function(t){return vi().memoizedState=t},useTransition:function(){var t=Ow(!1),e=t[0];return t=IN.bind(null,t[1]),vi().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=jt,i=vi();if(Ft){if(n===void 0)throw Error(Se(407));n=n()}else{if(n=e(),gn===null)throw Error(Se(349));Yo&30||d4(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Nw(g4.bind(null,r,s,t),[t]),r.flags|=2048,OA(9,p4.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=vi(),e=gn.identifierPrefix;if(Ft){var n=Zi,r=qi;n=(r&~(1<<32-ii(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=IA++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=kN++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},DN={readContext:zr,useCallback:T4,useContext:zr,useEffect:q2,useImperativeHandle:x4,useInsertionEffect:v4,useLayoutEffect:w4,useMemo:E4,useReducer:Mp,useRef:y4,useState:function(){return Mp(MA)},useDebugValue:Z2,useDeferredValue:function(t){var e=Vr();return S4(e,on.memoizedState,t)},useTransition:function(){var t=Mp(MA)[0],e=Vr().memoizedState;return[t,e]},useMutableSource:f4,useSyncExternalStore:h4,useId:C4,unstable_isNewReconciler:!1},BN={readContext:zr,useCallback:T4,useContext:zr,useEffect:q2,useImperativeHandle:x4,useInsertionEffect:v4,useLayoutEffect:w4,useMemo:E4,useReducer:Op,useRef:y4,useState:function(){return Op(MA)},useDebugValue:Z2,useDeferredValue:function(t){var e=Vr();return on===null?e.memoizedState=t:S4(e,on.memoizedState,t)},useTransition:function(){var t=Op(MA)[0],e=Vr().memoizedState;return[t,e]},useMutableSource:f4,useSyncExternalStore:h4,useId:C4,unstable_isNewReconciler:!1};function Zr(t,e){if(t&&t.defaultProps){e=Ht({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function Tm(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Ht({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var od={isMounted:function(t){return(t=t._reactInternals)?ca(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Qn(),i=eo(t),s=Gi(r,i);s.payload=e,n!=null&&(s.callback=n),e=Gs(t,s,i),e!==null&&(si(e,t,i,r),Zf(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Qn(),i=eo(t),s=Gi(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Gs(t,s,i),e!==null&&(si(e,t,i,r),Zf(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Qn(),r=eo(t),i=Gi(n,r);i.tag=2,e!=null&&(i.callback=e),e=Gs(t,i,r),e!==null&&(si(e,t,r,n),Zf(e,t,r))}};function Dw(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!EA(n,r)||!EA(i,s):!0}function I4(t,e,n){var r=!1,i=ao,s=e.contextType;return typeof s=="object"&&s!==null?s=zr(s):(i=or(e)?Xo:Fn.current,r=e.contextTypes,s=(r=r!=null)?Ml(t,i):ao),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=od,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Bw(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&od.enqueueReplaceState(e,e.state,null)}function Em(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},$2(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=zr(s):(s=or(e)?Xo:Fn.current,i.context=Ml(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(Tm(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&od.enqueueReplaceState(i,i.state,null),Uh(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Bl(t,e){try{var n="",r=e;do n+=AO(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Np(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Sm(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var LN=typeof WeakMap=="function"?WeakMap:Map;function M4(t,e,n){n=Gi(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){jh||(jh=!0,Bm=r),Sm(t,e)},n}function O4(t,e,n){n=Gi(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Sm(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Sm(t,e),typeof r!="function"&&(Js===null?Js=new Set([this]):Js.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function Lw(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new LN;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=KN.bind(null,t,e,n),e.then(t,t))}function Fw(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Uw(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Gi(-1,1),e.tag=2,Gs(n,e,1))),n.lanes|=1),t)}var FN=As.ReactCurrentOwner,nr=!1;function Wn(t,e,n,r){e.child=t===null?l4(e,null,n,r):Nl(e,t.child,n,r)}function zw(t,e,n,r,i){n=n.render;var s=e.ref;return bl(e,i),r=Q2(t,e,n,r,s,i),n=Y2(),t!==null&&!nr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,is(t,e,i)):(Ft&&n&&D2(e),e.flags|=1,Wn(t,e,r,i),e.child)}function Vw(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!i1(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,N4(t,e,s,r,i)):(t=nh(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:EA,n(o,r)&&t.ref===e.ref)return is(t,e,i)}return e.flags|=1,t=to(s,r),t.ref=e.ref,t.return=e,e.child=t}function N4(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(EA(s,r)&&t.ref===e.ref)if(nr=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(nr=!0);else return e.lanes=t.lanes,is(t,e,i)}return Cm(t,e,n,r,i)}function D4(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},kt(nl,ur),ur|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,kt(nl,ur),ur|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,kt(nl,ur),ur|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,kt(nl,ur),ur|=r;return Wn(t,e,i,n),e.child}function B4(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Cm(t,e,n,r,i){var s=or(n)?Xo:Fn.current;return s=Ml(e,s),bl(e,i),n=Q2(t,e,n,r,s,i),r=Y2(),t!==null&&!nr?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,is(t,e,i)):(Ft&&r&&D2(e),e.flags|=1,Wn(t,e,n,i),e.child)}function $w(t,e,n,r,i){if(or(n)){var s=!0;Nh(e)}else s=!1;if(bl(e,i),e.stateNode===null)Jf(t,e),I4(e,n,r),Em(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var u=o.context,h=n.contextType;typeof h=="object"&&h!==null?h=zr(h):(h=or(n)?Xo:Fn.current,h=Ml(e,h));var p=n.getDerivedStateFromProps,_=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function";_||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||u!==h)&&Bw(e,o,r,h),Ms=!1;var v=e.memoizedState;o.state=v,Uh(e,r,o,i),u=e.memoizedState,a!==r||v!==u||sr.current||Ms?(typeof p=="function"&&(Tm(e,n,p,r),u=e.memoizedState),(a=Ms||Dw(e,n,a,r,v,u,h))?(_||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=u),o.props=r,o.state=u,o.context=h,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,A4(t,e),a=e.memoizedProps,h=e.type===e.elementType?a:Zr(e.type,a),o.props=h,_=e.pendingProps,v=o.context,u=n.contextType,typeof u=="object"&&u!==null?u=zr(u):(u=or(n)?Xo:Fn.current,u=Ml(e,u));var b=n.getDerivedStateFromProps;(p=typeof b=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==_||v!==u)&&Bw(e,o,r,u),Ms=!1,v=e.memoizedState,o.state=v,Uh(e,r,o,i);var E=e.memoizedState;a!==_||v!==E||sr.current||Ms?(typeof b=="function"&&(Tm(e,n,b,r),E=e.memoizedState),(h=Ms||Dw(e,n,h,r,v,E,u)||!1)?(p||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,E,u),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,E,u)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=E),o.props=r,o.state=E,o.context=u,r=h):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&v===t.memoizedState||(e.flags|=1024),r=!1)}return Pm(t,e,n,r,s,i)}function Pm(t,e,n,r,i,s){B4(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Cw(e,n,!1),is(t,e,s);r=e.stateNode,FN.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Nl(e,t.child,null,s),e.child=Nl(e,null,a,s)):Wn(t,e,a,s),e.memoizedState=r.state,i&&Cw(e,n,!0),e.child}function L4(t){var e=t.stateNode;e.pendingContext?Sw(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Sw(t,e.context,!1),W2(t,e.containerInfo)}function Ww(t,e,n,r,i){return Ol(),L2(i),e.flags|=256,Wn(t,e,n,r),e.child}var Rm={dehydrated:null,treeContext:null,retryLane:0};function km(t){return{baseLanes:t,cachePool:null,transitions:null}}function F4(t,e,n){var r=e.pendingProps,i=$t.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),kt($t,i&1),t===null)return bm(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=cd(o,r,0,null),t=Uo(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=km(n),e.memoizedState=Rm,t):K2(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return UN(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var u={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=u,e.deletions=null):(r=to(i,u),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=to(a,s):(s=Uo(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?km(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=Rm,r}return s=t.child,t=s.sibling,r=to(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function K2(t,e){return e=cd({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Yu(t,e,n,r){return r!==null&&L2(r),Nl(e,t.child,null,n),t=K2(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function UN(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=Np(Error(Se(422))),Yu(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=cd({mode:"visible",children:r.children},i,0,null),s=Uo(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Nl(e,t.child,null,o),e.child.memoizedState=km(o),e.memoizedState=Rm,s);if(!(e.mode&1))return Yu(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(Se(419)),r=Np(s,r,void 0),Yu(t,e,o,r)}if(a=(o&t.childLanes)!==0,nr||a){if(r=gn,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,rs(t,i),si(r,t,i,-1))}return r1(),r=Np(Error(Se(421))),Yu(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=GN.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,hr=Ks(i.nextSibling),mr=e,Ft=!0,Gr=null,t!==null&&(kr[Ir++]=qi,kr[Ir++]=Zi,kr[Ir++]=Qo,qi=t.id,Zi=t.overflow,Qo=e),e=K2(e,r.children),e.flags|=4096,e)}function jw(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),xm(t.return,e,n)}function Dp(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function U4(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Wn(t,e,r.children,n),r=$t.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&jw(t,n,e);else if(t.tag===19)jw(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(kt($t,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&zh(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Dp(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&zh(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Dp(e,!0,n,null,s);break;case"together":Dp(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Jf(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function is(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),qo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(Se(153));if(e.child!==null){for(t=e.child,n=to(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=to(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function zN(t,e,n){switch(e.tag){case 3:L4(e),Ol();break;case 5:u4(e);break;case 1:or(e.type)&&Nh(e);break;case 4:W2(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;kt(Lh,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(kt($t,$t.current&1),e.flags|=128,null):n&e.child.childLanes?F4(t,e,n):(kt($t,$t.current&1),t=is(t,e,n),t!==null?t.sibling:null);kt($t,$t.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return U4(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),kt($t,$t.current),r)break;return null;case 22:case 23:return e.lanes=0,D4(t,e,n)}return is(t,e,n)}var z4,Im,V4,$4;z4=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Im=function(){};V4=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,Mo(Ii.current);var s=null;switch(n){case"input":i=Jg(t,i),r=Jg(t,r),s=[];break;case"select":i=Ht({},i,{value:void 0}),r=Ht({},r,{value:void 0}),s=[];break;case"textarea":i=nm(t,i),r=nm(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=Mh)}im(n,r);var o;n=null;for(h in i)if(!r.hasOwnProperty(h)&&i.hasOwnProperty(h)&&i[h]!=null)if(h==="style"){var a=i[h];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else h!=="dangerouslySetInnerHTML"&&h!=="children"&&h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(_A.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in r){var u=r[h];if(a=i!=null?i[h]:void 0,r.hasOwnProperty(h)&&u!==a&&(u!=null||a!=null))if(h==="style")if(a){for(o in a)!a.hasOwnProperty(o)||u&&u.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in u)u.hasOwnProperty(o)&&a[o]!==u[o]&&(n||(n={}),n[o]=u[o])}else n||(s||(s=[]),s.push(h,n)),n=u;else h==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,a=a?a.__html:void 0,u!=null&&a!==u&&(s=s||[]).push(h,u)):h==="children"?typeof u!="string"&&typeof u!="number"||(s=s||[]).push(h,""+u):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&(_A.hasOwnProperty(h)?(u!=null&&h==="onScroll"&&Mt("scroll",t),s||a===u||(s=[])):(s=s||[]).push(h,u))}n&&(s=s||[]).push("style",n);var h=s;(e.updateQueue=h)&&(e.flags|=4)}};$4=function(t,e,n,r){n!==r&&(e.flags|=4)};function mc(t,e){if(!Ft)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function kn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function VN(t,e,n){var r=e.pendingProps;switch(B2(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kn(e),null;case 1:return or(e.type)&&Oh(),kn(e),null;case 3:return r=e.stateNode,Dl(),Nt(sr),Nt(Fn),H2(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Xu(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Gr!==null&&(Um(Gr),Gr=null))),Im(t,e),kn(e),null;case 5:j2(e);var i=Mo(kA.current);if(n=e.type,t!==null&&e.stateNode!=null)V4(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(Se(166));return kn(e),null}if(t=Mo(Ii.current),Xu(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Ti]=e,r[PA]=s,t=(e.mode&1)!==0,n){case"dialog":Mt("cancel",r),Mt("close",r);break;case"iframe":case"object":case"embed":Mt("load",r);break;case"video":case"audio":for(i=0;i<Mc.length;i++)Mt(Mc[i],r);break;case"source":Mt("error",r);break;case"img":case"image":case"link":Mt("error",r),Mt("load",r);break;case"details":Mt("toggle",r);break;case"input":Jv(r,s),Mt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mt("invalid",r);break;case"textarea":tw(r,s),Mt("invalid",r)}im(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&Hu(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Hu(r.textContent,a,t),i=["children",""+a]):_A.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&Mt("scroll",r)}switch(n){case"input":Lu(r),ew(r,s,!0);break;case"textarea":Lu(r),nw(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=Mh)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=gS(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Ti]=e,t[PA]=r,z4(t,e,!1,!1),e.stateNode=t;e:{switch(o=sm(n,r),n){case"dialog":Mt("cancel",t),Mt("close",t),i=r;break;case"iframe":case"object":case"embed":Mt("load",t),i=r;break;case"video":case"audio":for(i=0;i<Mc.length;i++)Mt(Mc[i],t);i=r;break;case"source":Mt("error",t),i=r;break;case"img":case"image":case"link":Mt("error",t),Mt("load",t),i=r;break;case"details":Mt("toggle",t),i=r;break;case"input":Jv(t,r),i=Jg(t,r),Mt("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=Ht({},r,{value:void 0}),Mt("invalid",t);break;case"textarea":tw(t,r),i=nm(t,r),Mt("invalid",t);break;default:i=r}im(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var u=a[s];s==="style"?yS(t,u):s==="dangerouslySetInnerHTML"?(u=u?u.__html:void 0,u!=null&&mS(t,u)):s==="children"?typeof u=="string"?(n!=="textarea"||u!=="")&&yA(t,u):typeof u=="number"&&yA(t,""+u):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(_A.hasOwnProperty(s)?u!=null&&s==="onScroll"&&Mt("scroll",t):u!=null&&w2(t,s,u,o))}switch(n){case"input":Lu(t),ew(t,r,!1);break;case"textarea":Lu(t),nw(t);break;case"option":r.value!=null&&t.setAttribute("value",""+oo(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?_l(t,!!r.multiple,s,!1):r.defaultValue!=null&&_l(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=Mh)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return kn(e),null;case 6:if(t&&e.stateNode!=null)$4(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(Se(166));if(n=Mo(kA.current),Mo(Ii.current),Xu(e)){if(r=e.stateNode,n=e.memoizedProps,r[Ti]=e,(s=r.nodeValue!==n)&&(t=mr,t!==null))switch(t.tag){case 3:Hu(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Hu(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Ti]=e,e.stateNode=r}return kn(e),null;case 13:if(Nt($t),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Ft&&hr!==null&&e.mode&1&&!(e.flags&128))o4(),Ol(),e.flags|=98560,s=!1;else if(s=Xu(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(Se(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(Se(317));s[Ti]=e}else Ol(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;kn(e),s=!1}else Gr!==null&&(Um(Gr),Gr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||$t.current&1?ln===0&&(ln=3):r1())),e.updateQueue!==null&&(e.flags|=4),kn(e),null);case 4:return Dl(),Im(t,e),t===null&&SA(e.stateNode.containerInfo),kn(e),null;case 10:return z2(e.type._context),kn(e),null;case 17:return or(e.type)&&Oh(),kn(e),null;case 19:if(Nt($t),s=e.memoizedState,s===null)return kn(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)mc(s,!1);else{if(ln!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=zh(t),o!==null){for(e.flags|=128,mc(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return kt($t,$t.current&1|2),e.child}t=t.sibling}s.tail!==null&&Kt()>Ll&&(e.flags|=128,r=!0,mc(s,!1),e.lanes=4194304)}else{if(!r)if(t=zh(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),mc(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!Ft)return kn(e),null}else 2*Kt()-s.renderingStartTime>Ll&&n!==1073741824&&(e.flags|=128,r=!0,mc(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Kt(),e.sibling=null,n=$t.current,kt($t,r?n&1|2:n&1),e):(kn(e),null);case 22:case 23:return n1(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ur&1073741824&&(kn(e),e.subtreeFlags&6&&(e.flags|=8192)):kn(e),null;case 24:return null;case 25:return null}throw Error(Se(156,e.tag))}function $N(t,e){switch(B2(e),e.tag){case 1:return or(e.type)&&Oh(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Dl(),Nt(sr),Nt(Fn),H2(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return j2(e),null;case 13:if(Nt($t),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(Se(340));Ol()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Nt($t),null;case 4:return Dl(),null;case 10:return z2(e.type._context),null;case 22:case 23:return n1(),null;case 24:return null;default:return null}}var qu=!1,Ln=!1,WN=typeof WeakSet=="function"?WeakSet:Set,De=null;function tl(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){qt(t,e,r)}else n.current=null}function Mm(t,e,n){try{n()}catch(r){qt(t,e,r)}}var Hw=!1;function jN(t,e){if(pm=Rh,t=QS(),N2(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,u=-1,h=0,p=0,_=t,v=null;t:for(;;){for(var b;_!==n||i!==0&&_.nodeType!==3||(a=o+i),_!==s||r!==0&&_.nodeType!==3||(u=o+r),_.nodeType===3&&(o+=_.nodeValue.length),(b=_.firstChild)!==null;)v=_,_=b;for(;;){if(_===t)break t;if(v===n&&++h===i&&(a=o),v===s&&++p===r&&(u=o),(b=_.nextSibling)!==null)break;_=v,v=_.parentNode}_=b}n=a===-1||u===-1?null:{start:a,end:u}}else n=null}n=n||{start:0,end:0}}else n=null;for(gm={focusedElem:t,selectionRange:n},Rh=!1,De=e;De!==null;)if(e=De,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,De=t;else for(;De!==null;){e=De;try{var E=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(E!==null){var R=E.memoizedProps,D=E.memoizedState,P=e.stateNode,S=P.getSnapshotBeforeUpdate(e.elementType===e.type?R:Zr(e.type,R),D);P.__reactInternalSnapshotBeforeUpdate=S}break;case 3:var k=e.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Se(163))}}catch(M){qt(e,e.return,M)}if(t=e.sibling,t!==null){t.return=e.return,De=t;break}De=e.return}return E=Hw,Hw=!1,E}function Zc(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Mm(e,n,s)}i=i.next}while(i!==r)}}function ad(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Om(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function W4(t){var e=t.alternate;e!==null&&(t.alternate=null,W4(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Ti],delete e[PA],delete e[ym],delete e[SN],delete e[CN])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function j4(t){return t.tag===5||t.tag===3||t.tag===4}function Xw(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||j4(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Nm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Mh));else if(r!==4&&(t=t.child,t!==null))for(Nm(t,e,n),t=t.sibling;t!==null;)Nm(t,e,n),t=t.sibling}function Dm(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Dm(t,e,n),t=t.sibling;t!==null;)Dm(t,e,n),t=t.sibling}var wn=null,Kr=!1;function ys(t,e,n){for(n=n.child;n!==null;)H4(t,e,n),n=n.sibling}function H4(t,e,n){if(ki&&typeof ki.onCommitFiberUnmount=="function")try{ki.onCommitFiberUnmount(J0,n)}catch{}switch(n.tag){case 5:Ln||tl(n,e);case 6:var r=wn,i=Kr;wn=null,ys(t,e,n),wn=r,Kr=i,wn!==null&&(Kr?(t=wn,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):wn.removeChild(n.stateNode));break;case 18:wn!==null&&(Kr?(t=wn,n=n.stateNode,t.nodeType===8?Pp(t.parentNode,n):t.nodeType===1&&Pp(t,n),xA(t)):Pp(wn,n.stateNode));break;case 4:r=wn,i=Kr,wn=n.stateNode.containerInfo,Kr=!0,ys(t,e,n),wn=r,Kr=i;break;case 0:case 11:case 14:case 15:if(!Ln&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&Mm(n,e,o),i=i.next}while(i!==r)}ys(t,e,n);break;case 1:if(!Ln&&(tl(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){qt(n,e,a)}ys(t,e,n);break;case 21:ys(t,e,n);break;case 22:n.mode&1?(Ln=(r=Ln)||n.memoizedState!==null,ys(t,e,n),Ln=r):ys(t,e,n);break;default:ys(t,e,n)}}function Qw(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new WN),e.forEach(function(r){var i=JN.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Hr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:wn=a.stateNode,Kr=!1;break e;case 3:wn=a.stateNode.containerInfo,Kr=!0;break e;case 4:wn=a.stateNode.containerInfo,Kr=!0;break e}a=a.return}if(wn===null)throw Error(Se(160));H4(s,o,i),wn=null,Kr=!1;var u=i.alternate;u!==null&&(u.return=null),i.return=null}catch(h){qt(i,e,h)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)X4(e,t),e=e.sibling}function X4(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Hr(e,t),di(t),r&4){try{Zc(3,t,t.return),ad(3,t)}catch(R){qt(t,t.return,R)}try{Zc(5,t,t.return)}catch(R){qt(t,t.return,R)}}break;case 1:Hr(e,t),di(t),r&512&&n!==null&&tl(n,n.return);break;case 5:if(Hr(e,t),di(t),r&512&&n!==null&&tl(n,n.return),t.flags&32){var i=t.stateNode;try{yA(i,"")}catch(R){qt(t,t.return,R)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,u=t.updateQueue;if(t.updateQueue=null,u!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&dS(i,s),sm(a,o);var h=sm(a,s);for(o=0;o<u.length;o+=2){var p=u[o],_=u[o+1];p==="style"?yS(i,_):p==="dangerouslySetInnerHTML"?mS(i,_):p==="children"?yA(i,_):w2(i,p,_,h)}switch(a){case"input":em(i,s);break;case"textarea":pS(i,s);break;case"select":var v=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var b=s.value;b!=null?_l(i,!!s.multiple,b,!1):v!==!!s.multiple&&(s.defaultValue!=null?_l(i,!!s.multiple,s.defaultValue,!0):_l(i,!!s.multiple,s.multiple?[]:"",!1))}i[PA]=s}catch(R){qt(t,t.return,R)}}break;case 6:if(Hr(e,t),di(t),r&4){if(t.stateNode===null)throw Error(Se(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(R){qt(t,t.return,R)}}break;case 3:if(Hr(e,t),di(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{xA(e.containerInfo)}catch(R){qt(t,t.return,R)}break;case 4:Hr(e,t),di(t);break;case 13:Hr(e,t),di(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(e1=Kt())),r&4&&Qw(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(Ln=(h=Ln)||p,Hr(e,t),Ln=h):Hr(e,t),di(t),r&8192){if(h=t.memoizedState!==null,(t.stateNode.isHidden=h)&&!p&&t.mode&1)for(De=t,p=t.child;p!==null;){for(_=De=p;De!==null;){switch(v=De,b=v.child,v.tag){case 0:case 11:case 14:case 15:Zc(4,v,v.return);break;case 1:tl(v,v.return);var E=v.stateNode;if(typeof E.componentWillUnmount=="function"){r=v,n=v.return;try{e=r,E.props=e.memoizedProps,E.state=e.memoizedState,E.componentWillUnmount()}catch(R){qt(r,n,R)}}break;case 5:tl(v,v.return);break;case 22:if(v.memoizedState!==null){qw(_);continue}}b!==null?(b.return=v,De=b):qw(_)}p=p.sibling}e:for(p=null,_=t;;){if(_.tag===5){if(p===null){p=_;try{i=_.stateNode,h?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=_.stateNode,u=_.memoizedProps.style,o=u!=null&&u.hasOwnProperty("display")?u.display:null,a.style.display=_S("display",o))}catch(R){qt(t,t.return,R)}}}else if(_.tag===6){if(p===null)try{_.stateNode.nodeValue=h?"":_.memoizedProps}catch(R){qt(t,t.return,R)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===t)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===t)break e;for(;_.sibling===null;){if(_.return===null||_.return===t)break e;p===_&&(p=null),_=_.return}p===_&&(p=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:Hr(e,t),di(t),r&4&&Qw(t);break;case 21:break;default:Hr(e,t),di(t)}}function di(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(j4(n)){var r=n;break e}n=n.return}throw Error(Se(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(yA(i,""),r.flags&=-33);var s=Xw(t);Dm(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=Xw(t);Nm(t,a,o);break;default:throw Error(Se(161))}}catch(u){qt(t,t.return,u)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function HN(t,e,n){De=t,Q4(t)}function Q4(t,e,n){for(var r=(t.mode&1)!==0;De!==null;){var i=De,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||qu;if(!o){var a=i.alternate,u=a!==null&&a.memoizedState!==null||Ln;a=qu;var h=Ln;if(qu=o,(Ln=u)&&!h)for(De=i;De!==null;)o=De,u=o.child,o.tag===22&&o.memoizedState!==null?Zw(i):u!==null?(u.return=o,De=u):Zw(i);for(;s!==null;)De=s,Q4(s),s=s.sibling;De=i,qu=a,Ln=h}Yw(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,De=s):Yw(t)}}function Yw(t){for(;De!==null;){var e=De;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Ln||ad(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Ln)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Zr(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Mw(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Mw(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var u=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":u.autoFocus&&n.focus();break;case"img":u.src&&(n.src=u.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var h=e.alternate;if(h!==null){var p=h.memoizedState;if(p!==null){var _=p.dehydrated;_!==null&&xA(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Se(163))}Ln||e.flags&512&&Om(e)}catch(v){qt(e,e.return,v)}}if(e===t){De=null;break}if(n=e.sibling,n!==null){n.return=e.return,De=n;break}De=e.return}}function qw(t){for(;De!==null;){var e=De;if(e===t){De=null;break}var n=e.sibling;if(n!==null){n.return=e.return,De=n;break}De=e.return}}function Zw(t){for(;De!==null;){var e=De;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ad(4,e)}catch(u){qt(e,n,u)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(u){qt(e,i,u)}}var s=e.return;try{Om(e)}catch(u){qt(e,s,u)}break;case 5:var o=e.return;try{Om(e)}catch(u){qt(e,o,u)}}}catch(u){qt(e,e.return,u)}if(e===t){De=null;break}var a=e.sibling;if(a!==null){a.return=e.return,De=a;break}De=e.return}}var XN=Math.ceil,Wh=As.ReactCurrentDispatcher,G2=As.ReactCurrentOwner,Or=As.ReactCurrentBatchConfig,ft=0,gn=null,tn=null,En=0,ur=0,nl=uo(0),ln=0,NA=null,qo=0,ld=0,J2=0,Kc=null,tr=null,e1=0,Ll=1/0,$i=null,jh=!1,Bm=null,Js=null,Zu=!1,Vs=null,Hh=0,Gc=0,Lm=null,eh=-1,th=0;function Qn(){return ft&6?Kt():eh!==-1?eh:eh=Kt()}function eo(t){return t.mode&1?ft&2&&En!==0?En&-En:RN.transition!==null?(th===0&&(th=IS()),th):(t=Tt,t!==0||(t=window.event,t=t===void 0?16:FS(t.type)),t):1}function si(t,e,n,r){if(50<Gc)throw Gc=0,Lm=null,Error(Se(185));ru(t,n,r),(!(ft&2)||t!==gn)&&(t===gn&&(!(ft&2)&&(ld|=n),ln===4&&Fs(t,En)),ar(t,r),n===1&&ft===0&&!(e.mode&1)&&(Ll=Kt()+500,id&&fo()))}function ar(t,e){var n=t.callbackNode;RO(t,e);var r=Ph(t,t===gn?En:0);if(r===0)n!==null&&sw(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&sw(n),e===1)t.tag===0?PN(Kw.bind(null,t)):r4(Kw.bind(null,t)),TN(function(){!(ft&6)&&fo()}),n=null;else{switch(MS(r)){case 1:n=S2;break;case 4:n=RS;break;case 16:n=Ch;break;case 536870912:n=kS;break;default:n=Ch}n=tC(n,Y4.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function Y4(t,e){if(eh=-1,th=0,ft&6)throw Error(Se(327));var n=t.callbackNode;if(xl()&&t.callbackNode!==n)return null;var r=Ph(t,t===gn?En:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Xh(t,r);else{e=r;var i=ft;ft|=2;var s=Z4();(gn!==t||En!==e)&&($i=null,Ll=Kt()+500,Fo(t,e));do try{qN();break}catch(a){q4(t,a)}while(1);U2(),Wh.current=s,ft=i,tn!==null?e=0:(gn=null,En=0,e=ln)}if(e!==0){if(e===2&&(i=Am(t),i!==0&&(r=i,e=Fm(t,i))),e===1)throw n=NA,Fo(t,0),Fs(t,r),ar(t,Kt()),n;if(e===6)Fs(t,r);else{if(i=t.current.alternate,!(r&30)&&!QN(i)&&(e=Xh(t,r),e===2&&(s=Am(t),s!==0&&(r=s,e=Fm(t,s))),e===1))throw n=NA,Fo(t,0),Fs(t,r),ar(t,Kt()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(Se(345));case 2:Po(t,tr,$i);break;case 3:if(Fs(t,r),(r&130023424)===r&&(e=e1+500-Kt(),10<e)){if(Ph(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Qn(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=_m(Po.bind(null,t,tr,$i),e);break}Po(t,tr,$i);break;case 4:if(Fs(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-ii(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Kt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*XN(r/1960))-r,10<r){t.timeoutHandle=_m(Po.bind(null,t,tr,$i),r);break}Po(t,tr,$i);break;case 5:Po(t,tr,$i);break;default:throw Error(Se(329))}}}return ar(t,Kt()),t.callbackNode===n?Y4.bind(null,t):null}function Fm(t,e){var n=Kc;return t.current.memoizedState.isDehydrated&&(Fo(t,e).flags|=256),t=Xh(t,e),t!==2&&(e=tr,tr=n,e!==null&&Um(e)),t}function Um(t){tr===null?tr=t:tr.push.apply(tr,t)}function QN(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!ai(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Fs(t,e){for(e&=~J2,e&=~ld,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-ii(e),r=1<<n;t[n]=-1,e&=~r}}function Kw(t){if(ft&6)throw Error(Se(327));xl();var e=Ph(t,0);if(!(e&1))return ar(t,Kt()),null;var n=Xh(t,e);if(t.tag!==0&&n===2){var r=Am(t);r!==0&&(e=r,n=Fm(t,r))}if(n===1)throw n=NA,Fo(t,0),Fs(t,e),ar(t,Kt()),n;if(n===6)throw Error(Se(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Po(t,tr,$i),ar(t,Kt()),null}function t1(t,e){var n=ft;ft|=1;try{return t(e)}finally{ft=n,ft===0&&(Ll=Kt()+500,id&&fo())}}function Zo(t){Vs!==null&&Vs.tag===0&&!(ft&6)&&xl();var e=ft;ft|=1;var n=Or.transition,r=Tt;try{if(Or.transition=null,Tt=1,t)return t()}finally{Tt=r,Or.transition=n,ft=e,!(ft&6)&&fo()}}function n1(){ur=nl.current,Nt(nl)}function Fo(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xN(n)),tn!==null)for(n=tn.return;n!==null;){var r=n;switch(B2(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Oh();break;case 3:Dl(),Nt(sr),Nt(Fn),H2();break;case 5:j2(r);break;case 4:Dl();break;case 13:Nt($t);break;case 19:Nt($t);break;case 10:z2(r.type._context);break;case 22:case 23:n1()}n=n.return}if(gn=t,tn=t=to(t.current,null),En=ur=e,ln=0,NA=null,J2=ld=qo=0,tr=Kc=null,Io!==null){for(e=0;e<Io.length;e++)if(n=Io[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}Io=null}return t}function q4(t,e){do{var n=tn;try{if(U2(),Kf.current=$h,Vh){for(var r=jt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Vh=!1}if(Yo=0,pn=on=jt=null,qc=!1,IA=0,G2.current=null,n===null||n.return===null){ln=1,NA=e,tn=null;break}e:{var s=t,o=n.return,a=n,u=e;if(e=En,a.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){var h=u,p=a,_=p.tag;if(!(p.mode&1)&&(_===0||_===11||_===15)){var v=p.alternate;v?(p.updateQueue=v.updateQueue,p.memoizedState=v.memoizedState,p.lanes=v.lanes):(p.updateQueue=null,p.memoizedState=null)}var b=Fw(o);if(b!==null){b.flags&=-257,Uw(b,o,a,s,e),b.mode&1&&Lw(s,h,e),e=b,u=h;var E=e.updateQueue;if(E===null){var R=new Set;R.add(u),e.updateQueue=R}else E.add(u);break e}else{if(!(e&1)){Lw(s,h,e),r1();break e}u=Error(Se(426))}}else if(Ft&&a.mode&1){var D=Fw(o);if(D!==null){!(D.flags&65536)&&(D.flags|=256),Uw(D,o,a,s,e),L2(Bl(u,a));break e}}s=u=Bl(u,a),ln!==4&&(ln=2),Kc===null?Kc=[s]:Kc.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var P=M4(s,u,e);Iw(s,P);break e;case 1:a=u;var S=s.type,k=s.stateNode;if(!(s.flags&128)&&(typeof S.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Js===null||!Js.has(k)))){s.flags|=65536,e&=-e,s.lanes|=e;var M=O4(s,a,e);Iw(s,M);break e}}s=s.return}while(s!==null)}G4(n)}catch(V){e=V,tn===n&&n!==null&&(tn=n=n.return);continue}break}while(1)}function Z4(){var t=Wh.current;return Wh.current=$h,t===null?$h:t}function r1(){(ln===0||ln===3||ln===2)&&(ln=4),gn===null||!(qo&268435455)&&!(ld&268435455)||Fs(gn,En)}function Xh(t,e){var n=ft;ft|=2;var r=Z4();(gn!==t||En!==e)&&($i=null,Fo(t,e));do try{YN();break}catch(i){q4(t,i)}while(1);if(U2(),ft=n,Wh.current=r,tn!==null)throw Error(Se(261));return gn=null,En=0,ln}function YN(){for(;tn!==null;)K4(tn)}function qN(){for(;tn!==null&&!vO();)K4(tn)}function K4(t){var e=eC(t.alternate,t,ur);t.memoizedProps=t.pendingProps,e===null?G4(t):tn=e,G2.current=null}function G4(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=$N(n,e),n!==null){n.flags&=32767,tn=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{ln=6,tn=null;return}}else if(n=VN(n,e,ur),n!==null){tn=n;return}if(e=e.sibling,e!==null){tn=e;return}tn=e=t}while(e!==null);ln===0&&(ln=5)}function Po(t,e,n){var r=Tt,i=Or.transition;try{Or.transition=null,Tt=1,ZN(t,e,n,r)}finally{Or.transition=i,Tt=r}return null}function ZN(t,e,n,r){do xl();while(Vs!==null);if(ft&6)throw Error(Se(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(Se(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(kO(t,s),t===gn&&(tn=gn=null,En=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Zu||(Zu=!0,tC(Ch,function(){return xl(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Or.transition,Or.transition=null;var o=Tt;Tt=1;var a=ft;ft|=4,G2.current=null,jN(t,n),X4(n,t),gN(gm),Rh=!!pm,gm=pm=null,t.current=n,HN(n),wO(),ft=a,Tt=o,Or.transition=s}else t.current=n;if(Zu&&(Zu=!1,Vs=t,Hh=i),s=t.pendingLanes,s===0&&(Js=null),TO(n.stateNode),ar(t,Kt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(jh)throw jh=!1,t=Bm,Bm=null,t;return Hh&1&&t.tag!==0&&xl(),s=t.pendingLanes,s&1?t===Lm?Gc++:(Gc=0,Lm=t):Gc=0,fo(),null}function xl(){if(Vs!==null){var t=MS(Hh),e=Or.transition,n=Tt;try{if(Or.transition=null,Tt=16>t?16:t,Vs===null)var r=!1;else{if(t=Vs,Vs=null,Hh=0,ft&6)throw Error(Se(331));var i=ft;for(ft|=4,De=t.current;De!==null;){var s=De,o=s.child;if(De.flags&16){var a=s.deletions;if(a!==null){for(var u=0;u<a.length;u++){var h=a[u];for(De=h;De!==null;){var p=De;switch(p.tag){case 0:case 11:case 15:Zc(8,p,s)}var _=p.child;if(_!==null)_.return=p,De=_;else for(;De!==null;){p=De;var v=p.sibling,b=p.return;if(W4(p),p===h){De=null;break}if(v!==null){v.return=b,De=v;break}De=b}}}var E=s.alternate;if(E!==null){var R=E.child;if(R!==null){E.child=null;do{var D=R.sibling;R.sibling=null,R=D}while(R!==null)}}De=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,De=o;else e:for(;De!==null;){if(s=De,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Zc(9,s,s.return)}var P=s.sibling;if(P!==null){P.return=s.return,De=P;break e}De=s.return}}var S=t.current;for(De=S;De!==null;){o=De;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,De=k;else e:for(o=S;De!==null;){if(a=De,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ad(9,a)}}catch(V){qt(a,a.return,V)}if(a===o){De=null;break e}var M=a.sibling;if(M!==null){M.return=a.return,De=M;break e}De=a.return}}if(ft=i,fo(),ki&&typeof ki.onPostCommitFiberRoot=="function")try{ki.onPostCommitFiberRoot(J0,t)}catch{}r=!0}return r}finally{Tt=n,Or.transition=e}}return!1}function Gw(t,e,n){e=Bl(n,e),e=M4(t,e,1),t=Gs(t,e,1),e=Qn(),t!==null&&(ru(t,1,e),ar(t,e))}function qt(t,e,n){if(t.tag===3)Gw(t,t,n);else for(;e!==null;){if(e.tag===3){Gw(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Js===null||!Js.has(r))){t=Bl(n,t),t=O4(e,t,1),e=Gs(e,t,1),t=Qn(),e!==null&&(ru(e,1,t),ar(e,t));break}}e=e.return}}function KN(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Qn(),t.pingedLanes|=t.suspendedLanes&n,gn===t&&(En&n)===n&&(ln===4||ln===3&&(En&130023424)===En&&500>Kt()-e1?Fo(t,0):J2|=n),ar(t,e)}function J4(t,e){e===0&&(t.mode&1?(e=zu,zu<<=1,!(zu&130023424)&&(zu=4194304)):e=1);var n=Qn();t=rs(t,e),t!==null&&(ru(t,e,n),ar(t,n))}function GN(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),J4(t,n)}function JN(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(Se(314))}r!==null&&r.delete(e),J4(t,n)}var eC;eC=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||sr.current)nr=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return nr=!1,zN(t,e,n);nr=!!(t.flags&131072)}else nr=!1,Ft&&e.flags&1048576&&i4(e,Bh,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Jf(t,e),t=e.pendingProps;var i=Ml(e,Fn.current);bl(e,n),i=Q2(null,e,r,t,i,n);var s=Y2();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,or(r)?(s=!0,Nh(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,$2(e),i.updater=od,e.stateNode=i,i._reactInternals=e,Em(e,r,t,n),e=Pm(null,e,r,!0,s,n)):(e.tag=0,Ft&&s&&D2(e),Wn(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Jf(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=tD(r),t=Zr(r,t),i){case 0:e=Cm(null,e,r,t,n);break e;case 1:e=$w(null,e,r,t,n);break e;case 11:e=zw(null,e,r,t,n);break e;case 14:e=Vw(null,e,r,Zr(r.type,t),n);break e}throw Error(Se(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zr(r,i),Cm(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zr(r,i),$w(t,e,r,i,n);case 3:e:{if(L4(e),t===null)throw Error(Se(387));r=e.pendingProps,s=e.memoizedState,i=s.element,A4(t,e),Uh(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Bl(Error(Se(423)),e),e=Ww(t,e,r,n,i);break e}else if(r!==i){i=Bl(Error(Se(424)),e),e=Ww(t,e,r,n,i);break e}else for(hr=Ks(e.stateNode.containerInfo.firstChild),mr=e,Ft=!0,Gr=null,n=l4(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ol(),r===i){e=is(t,e,n);break e}Wn(t,e,r,n)}e=e.child}return e;case 5:return u4(e),t===null&&bm(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,mm(r,i)?o=null:s!==null&&mm(r,s)&&(e.flags|=32),B4(t,e),Wn(t,e,o,n),e.child;case 6:return t===null&&bm(e),null;case 13:return F4(t,e,n);case 4:return W2(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Nl(e,null,r,n):Wn(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zr(r,i),zw(t,e,r,i,n);case 7:return Wn(t,e,e.pendingProps,n),e.child;case 8:return Wn(t,e,e.pendingProps.children,n),e.child;case 12:return Wn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,kt(Lh,r._currentValue),r._currentValue=o,s!==null)if(ai(s.value,o)){if(s.children===i.children&&!sr.current){e=is(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var u=a.firstContext;u!==null;){if(u.context===r){if(s.tag===1){u=Gi(-1,n&-n),u.tag=2;var h=s.updateQueue;if(h!==null){h=h.shared;var p=h.pending;p===null?u.next=u:(u.next=p.next,p.next=u),h.pending=u}}s.lanes|=n,u=s.alternate,u!==null&&(u.lanes|=n),xm(s.return,n,e),a.lanes|=n;break}u=u.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(Se(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),xm(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Wn(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,bl(e,n),i=zr(i),r=r(i),e.flags|=1,Wn(t,e,r,n),e.child;case 14:return r=e.type,i=Zr(r,e.pendingProps),i=Zr(r.type,i),Vw(t,e,r,i,n);case 15:return N4(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Zr(r,i),Jf(t,e),e.tag=1,or(r)?(t=!0,Nh(e)):t=!1,bl(e,n),I4(e,r,i),Em(e,r,i,n),Pm(null,e,r,!0,t,n);case 19:return U4(t,e,n);case 22:return D4(t,e,n)}throw Error(Se(156,e.tag))};function tC(t,e){return PS(t,e)}function eD(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mr(t,e,n,r){return new eD(t,e,n,r)}function i1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function tD(t){if(typeof t=="function")return i1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===x2)return 11;if(t===T2)return 14}return 2}function to(t,e){var n=t.alternate;return n===null?(n=Mr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function nh(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")i1(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case Xa:return Uo(n.children,i,s,e);case b2:o=8,i|=8;break;case qg:return t=Mr(12,n,e,i|2),t.elementType=qg,t.lanes=s,t;case Zg:return t=Mr(13,n,e,i),t.elementType=Zg,t.lanes=s,t;case Kg:return t=Mr(19,n,e,i),t.elementType=Kg,t.lanes=s,t;case uS:return cd(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case cS:o=10;break e;case AS:o=9;break e;case x2:o=11;break e;case T2:o=14;break e;case Is:o=16,r=null;break e}throw Error(Se(130,t==null?t:typeof t,""))}return e=Mr(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function Uo(t,e,n,r){return t=Mr(7,t,r,e),t.lanes=n,t}function cd(t,e,n,r){return t=Mr(22,t,r,e),t.elementType=uS,t.lanes=n,t.stateNode={isHidden:!1},t}function Bp(t,e,n){return t=Mr(6,t,null,e),t.lanes=n,t}function Lp(t,e,n){return e=Mr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function nD(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mp(0),this.expirationTimes=mp(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mp(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function s1(t,e,n,r,i,s,o,a,u){return t=new nD(t,e,n,a,u),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Mr(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},$2(s),t}function rD(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ha,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function nC(t){if(!t)return ao;t=t._reactInternals;e:{if(ca(t)!==t||t.tag!==1)throw Error(Se(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(or(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Se(171))}if(t.tag===1){var n=t.type;if(or(n))return n4(t,n,e)}return e}function rC(t,e,n,r,i,s,o,a,u){return t=s1(n,r,!0,t,i,s,o,a,u),t.context=nC(null),n=t.current,r=Qn(),i=eo(n),s=Gi(r,i),s.callback=e??null,Gs(n,s,i),t.current.lanes=i,ru(t,i,r),ar(t,r),t}function Ad(t,e,n,r){var i=e.current,s=Qn(),o=eo(i);return n=nC(n),e.context===null?e.context=n:e.pendingContext=n,e=Gi(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Gs(i,e,o),t!==null&&(si(t,i,o,s),Zf(t,i,o)),o}function Qh(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Jw(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function o1(t,e){Jw(t,e),(t=t.alternate)&&Jw(t,e)}function iD(){return null}var iC=typeof reportError=="function"?reportError:function(t){console.error(t)};function a1(t){this._internalRoot=t}ud.prototype.render=a1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(Se(409));Ad(t,e,null,null)};ud.prototype.unmount=a1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Zo(function(){Ad(null,t,null,null)}),e[ns]=null}};function ud(t){this._internalRoot=t}ud.prototype.unstable_scheduleHydration=function(t){if(t){var e=DS();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Ls.length&&e!==0&&e<Ls[n].priority;n++);Ls.splice(n,0,t),n===0&&LS(t)}};function l1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function fd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function e3(){}function sD(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var h=Qh(o);s.call(h)}}var o=rC(e,r,t,0,null,!1,!1,"",e3);return t._reactRootContainer=o,t[ns]=o.current,SA(t.nodeType===8?t.parentNode:t),Zo(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var h=Qh(u);a.call(h)}}var u=s1(t,0,!1,null,null,!1,!1,"",e3);return t._reactRootContainer=u,t[ns]=u.current,SA(t.nodeType===8?t.parentNode:t),Zo(function(){Ad(e,u,n,r)}),u}function hd(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var u=Qh(o);a.call(u)}}Ad(e,o,t,i)}else o=sD(n,e,t,i,r);return Qh(o)}OS=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Ic(e.pendingLanes);n!==0&&(C2(e,n|1),ar(e,Kt()),!(ft&6)&&(Ll=Kt()+500,fo()))}break;case 13:Zo(function(){var r=rs(t,1);if(r!==null){var i=Qn();si(r,t,1,i)}}),o1(t,1)}};P2=function(t){if(t.tag===13){var e=rs(t,134217728);if(e!==null){var n=Qn();si(e,t,134217728,n)}o1(t,134217728)}};NS=function(t){if(t.tag===13){var e=eo(t),n=rs(t,e);if(n!==null){var r=Qn();si(n,t,e,r)}o1(t,e)}};DS=function(){return Tt};BS=function(t,e){var n=Tt;try{return Tt=t,e()}finally{Tt=n}};am=function(t,e,n){switch(e){case"input":if(em(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=rd(r);if(!i)throw Error(Se(90));hS(r),em(r,i)}}}break;case"textarea":pS(t,n);break;case"select":e=n.value,e!=null&&_l(t,!!n.multiple,e,!1)}};bS=t1;xS=Zo;var oD={usingClientEntryPoint:!1,Events:[su,Za,rd,vS,wS,t1]},_c={findFiberByHostInstance:ko,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},aD={bundleType:_c.bundleType,version:_c.version,rendererPackageName:_c.rendererPackageName,rendererConfig:_c.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:As.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=SS(t),t===null?null:t.stateNode},findFiberByHostInstance:_c.findFiberByHostInstance||iD,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ku=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ku.isDisabled&&Ku.supportsFiber)try{J0=Ku.inject(aD),ki=Ku}catch{}}vr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oD;vr.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!l1(e))throw Error(Se(200));return rD(t,e,null,n)};vr.createRoot=function(t,e){if(!l1(t))throw Error(Se(299));var n=!1,r="",i=iC;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=s1(t,1,!1,null,null,n,!1,r,i),t[ns]=e.current,SA(t.nodeType===8?t.parentNode:t),new a1(e)};vr.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(Se(188)):(t=Object.keys(t).join(","),Error(Se(268,t)));return t=SS(e),t=t===null?null:t.stateNode,t};vr.flushSync=function(t){return Zo(t)};vr.hydrate=function(t,e,n){if(!fd(e))throw Error(Se(200));return hd(null,t,e,!0,n)};vr.hydrateRoot=function(t,e,n){if(!l1(t))throw Error(Se(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=iC;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=rC(e,null,t,1,n??null,i,!1,s,o),t[ns]=e.current,SA(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new ud(e)};vr.render=function(t,e,n){if(!fd(e))throw Error(Se(200));return hd(null,t,e,!1,n)};vr.unmountComponentAtNode=function(t){if(!fd(t))throw Error(Se(40));return t._reactRootContainer?(Zo(function(){hd(null,null,t,!1,function(){t._reactRootContainer=null,t[ns]=null})}),!0):!1};vr.unstable_batchedUpdates=t1;vr.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!fd(n))throw Error(Se(200));if(t==null||t._reactInternals===void 0)throw Error(Se(38));return hd(t,e,n,!1,r)};vr.version="18.3.1-next-f1338f8080-20240426";function sC(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(sC)}catch(t){console.error(t)}}sC(),sS.exports=vr;var c1=sS.exports,oC,t3=c1;oC=t3.createRoot,t3.hydrateRoot;const lD="modulepreload",cD=function(t){return"/"+t},n3={},AD=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=cD(s),s in n3)return;n3[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let p=i.length-1;p>=0;p--){const _=i[p];if(_.href===s&&(!o||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const h=document.createElement("link");if(h.rel=o?"stylesheet":lD,o||(h.as="script",h.crossOrigin=""),h.href=s,document.head.appendChild(h),o)return new Promise((p,_)=>{h.addEventListener("load",p),h.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},uD=Ce.createContext(null);function fD(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function Qi(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Qi(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!Qi(t[i],e[i]))return!1;return!0}return!1}function hD(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function r3(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();Qi(n,r)||e.setProjection(n)}function i3(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function s3(t,e){const n=e.viewState||e;let r=!1;if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}if(n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),"longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}return r}const dD=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function o3(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of dD)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}const a3={version:8,sources:{},layers:[]},l3={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Fp={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},c3={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},pD=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],gD=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Fl{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[c3[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[l3[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Fp[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Fl.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=a3}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||mD()||null,container:e,style:o3(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const p=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=p,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=p=>{this._inRender=!0,a.call(o,p),this._inRender=!1};const u=o._renderTaskQueue.run;o._renderTaskQueue.run=p=>{u.call(o._renderTaskQueue,p),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const h=o.fire;o.fire=this._fireEvent.bind(this,h),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),r3(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const p in l3)o.on(p,this._onPointerEvent);for(const p in Fp)o.on(p,this._onCameraEvent);for(const p in c3)o.on(p,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Fl.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=hD(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,u=r.isMoving();u&&(i.cameraElevationReference="sea");const h=s3(i,{...i3(r.transform),...e});if(u&&(i.cameraElevationReference="ground"),h&&n){const p=this._deferredEvents;p.move=!0,p.zoom||(p.zoom=s!==i.zoom),p.rotate||(p.rotate=a!==i.bearing),p.pitch||(p.pitch=o!==i.pitch)}return u||s3(r.transform,e),h}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of pD)if(s in e&&!Qi(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=a3,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(o3(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!Qi(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!Qi(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!Qi(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of gD){const u=(r=e[a])!==null&&r!==void 0?r:!0,h=(i=n[a])!==null&&i!==void 0?i:!0;Qi(u,h)||(o=!0,u?s[a].enable(u):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),u=a.length>0;!u&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,u&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Fp&&(typeof n=="object"&&(n.viewState=i3(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{r3(this._renderTransform,n),e.transform=n}}}Fl.savedMaps=[];function mD(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const _D=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function yD(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of vD(e))!(r in n)&&!_D.includes(r)&&(n[r]=e[r].bind(e));return n}function vD(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const wD=typeof document<"u"?Ce.useLayoutEffect:Ce.useEffect,bD=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function xD(t,e){for(const r of bD)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const dd=Ce.createContext(null);function TD(t,e,n){const r=Ce.useContext(uD),[i,s]=Ce.useState(null),o=Ce.useRef(),{current:a}=Ce.useRef({mapLib:null,map:null});Ce.useEffect(()=>{const p=t.mapLib;let _=!0,v;return Promise.resolve(p||n).then(b=>{if(!_)return;if(!b)throw new Error("Invalid mapLib");const E="Map"in b?b:b.default;if(!E.Map)throw new Error("Invalid mapLib");if(xD(E,t),!E.supported||E.supported(t))t.reuseMaps&&(v=Fl.reuse(t,o.current)),v||(v=new Fl(E.Map,t,o.current)),a.map=yD(v),a.mapLib=E,s(v),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(b=>{const{onError:E}=t;E?E({type:"error",target:null,originalEvent:null,error:b}):console.error(b)}),()=>{_=!1,v&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?v.recycle():v.destroy())}},[]),wD(()=>{i&&i.setProps(t)}),Ce.useImperativeHandle(e,()=>a.map,[i]);const u=Ce.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),h={height:"100%"};return Ce.createElement("div",{id:t.id,ref:o,style:u},i&&Ce.createElement(dd.Provider,{value:a},Ce.createElement("div",{"mapboxgl-children":"",style:h},t.children)))}const ED=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Aa(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!ED.test(r)?n[r]=`${i}px`:n[r]=i}}function SD(t,e){const{map:n,mapLib:r}=Ce.useContext(dd),i=Ce.useRef({props:t});i.current.props=t;const s=Ce.useMemo(()=>{let R=!1;Ce.Children.forEach(t.children,S=>{S&&(R=!0)});const D={...t,element:R?document.createElement("div"):null},P=new r.Marker(D);return P.setLngLat([t.longitude,t.latitude]),P.getElement().addEventListener("click",S=>{var k,M;(M=(k=i.current.props).onClick)===null||M===void 0||M.call(k,{type:"click",target:P,originalEvent:S})}),P.on("dragstart",S=>{var k,M;const V=S;V.lngLat=s.getLngLat(),(M=(k=i.current.props).onDragStart)===null||M===void 0||M.call(k,V)}),P.on("drag",S=>{var k,M;const V=S;V.lngLat=s.getLngLat(),(M=(k=i.current.props).onDrag)===null||M===void 0||M.call(k,V)}),P.on("dragend",S=>{var k,M;const V=S;V.lngLat=s.getLngLat(),(M=(k=i.current.props).onDragEnd)===null||M===void 0||M.call(k,V)}),P},[]);Ce.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:u,style:h,draggable:p=!1,popup:_=null,rotation:v=0,rotationAlignment:b="auto",pitchAlignment:E="auto"}=t;return Ce.useEffect(()=>{Aa(s.getElement(),h)},[h]),Ce.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),u&&!fD(s.getOffset(),u)&&s.setOffset(u),s.isDraggable()!==p&&s.setDraggable(p),s.getRotation()!==v&&s.setRotation(v),s.getRotationAlignment()!==b&&s.setRotationAlignment(b),s.getPitchAlignment()!==E&&s.setPitchAlignment(E),s.getPopup()!==_&&s.setPopup(_),c1.createPortal(t.children,s.getElement())}Ce.memo(Ce.forwardRef(SD));function A3(t){return new Set(t?t.trim().split(/\s+/):[])}function CD(t,e){const{map:n,mapLib:r}=Ce.useContext(dd),i=Ce.useMemo(()=>document.createElement("div"),[]),s=Ce.useRef({props:t});s.current.props=t;const o=Ce.useMemo(()=>{const a={...t},u=new r.Popup(a);return u.setLngLat([t.longitude,t.latitude]),u.once("open",h=>{var p,_;(_=(p=s.current.props).onOpen)===null||_===void 0||_.call(p,h)}),u},[]);if(Ce.useEffect(()=>{const a=u=>{var h,p;(p=(h=s.current.props).onClose)===null||p===void 0||p.call(h,u)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),Ce.useEffect(()=>{Aa(o.getElement(),t.style)},[t.style]),Ce.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!Qi(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=A3(o.options.className),u=A3(t.className);for(const h of a)u.has(h)||o.removeClassName(h);for(const h of u)a.has(h)||o.addClassName(h);o.options.className=t.className}return c1.createPortal(t.children,i)}Ce.memo(Ce.forwardRef(CD));function au(t,e,n,r){const i=Ce.useContext(dd),s=Ce.useMemo(()=>t(i),[]);return Ce.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,u=typeof n=="function"?n:typeof e=="function"?e:null,{map:h}=i;return h.hasControl(s)||(h.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{u&&u(i),h.hasControl(s)&&h.removeControl(s)}},[]),s}function PD(t){const e=au(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return Ce.useEffect(()=>{Aa(e._container,t.style)},[t.style]),null}Ce.memo(PD);function RD(t){const e=au(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return Ce.useEffect(()=>{Aa(e._controlContainer,t.style)},[t.style]),null}Ce.memo(RD);function kD(t,e){const n=Ce.useRef({props:t}),r=au(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var u,h;(h=(u=n.current.props).onGeolocate)===null||h===void 0||h.call(u,a)}),s.on("error",a=>{var u,h;(h=(u=n.current.props).onError)===null||h===void 0||h.call(u,a)}),s.on("outofmaxbounds",a=>{var u,h;(h=(u=n.current.props).onOutOfMaxBounds)===null||h===void 0||h.call(u,a)}),s.on("trackuserlocationstart",a=>{var u,h;(h=(u=n.current.props).onTrackUserLocationStart)===null||h===void 0||h.call(u,a)}),s.on("trackuserlocationend",a=>{var u,h;(h=(u=n.current.props).onTrackUserLocationEnd)===null||h===void 0||h.call(u,a)}),s},{position:t.position});return n.current.props=t,Ce.useImperativeHandle(e,()=>r,[]),Ce.useEffect(()=>{Aa(r._container,t.style)},[t.style]),null}Ce.memo(Ce.forwardRef(kD));function ID(t){const e=au(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return Ce.useEffect(()=>{Aa(e._container,t.style)},[t.style]),null}Ce.memo(ID);function MD(t){const e=au(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=Ce.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),Ce.useEffect(()=>{Aa(e._container,i)},[i]),null}Ce.memo(MD);const OD=AD(()=>import("./maplibre-gl-21419427.js").then(t=>t.m),[]),ND=(()=>Ce.forwardRef(function(e,n){return TD(e,n,OD)}))();function Yh(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Oo=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),u3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);u3&&parseFloat(u3[1]);const Gu=globalThis,Pa=globalThis.process||{},DD=globalThis.navigator||{};function aC(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function ua(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||aC()}function BD(t){return!t&&!ua()?"Node":aC(t)?"Electron":(t||DD.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const lC="4.1.0";function LD(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class FD{constructor(e,n,r="sessionStorage"){this.storage=LD(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function UD(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function zD(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var qh;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(qh||(qh={}));const VD=10;function f3(t){return typeof t!="string"?t:(t=t.toUpperCase(),qh[t]||qh.WHITE)}function $D(t,e,n){return!ua&&typeof t=="string"&&(e&&(t=`\x1B[${f3(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${f3(n)+VD}m${t}\x1B[49m`)),t}function WD(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function A1(t,e){if(!t)throw new Error(e||"Assertion failed")}function Ra(){var e,n,r;let t;if(ua()&&Gu.performance)t=(n=(e=Gu==null?void 0:Gu.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Pa){const i=(r=Pa==null?void 0:Pa.hrtime)==null?void 0:r.call(Pa);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const ka={debug:ua()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},jD={enabled:!0,level:0};function Ia(){}const h3={},d3={once:!0};class lu{constructor({id:e}={id:""}){this.VERSION=lC,this._startTs=Ra(),this._deltaTs=Ra(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new FD(`__probe-${this.id}__`,jD),this.timeStamp(`${this.id} started`),WD(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ra()-this._startTs).toPrecision(10))}getDelta(){return Number((Ra()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,ka.warn,arguments,d3)}error(e){return this._getLogFunction(0,e,ka.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,ka.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,ka.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,ka.debug||ka.info,arguments,d3)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Ia,r&&[r],{tag:XD(n)}):Ia}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Ia)}group(e,n,r={collapsed:!1}){const i=p3({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Ia)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=cC(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=p3({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,A1(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Ra();const o=s.tag||s.message;if(s.once&&o)if(!h3[o])h3[o]=Ra();else return Ia;return n=HD(this.id,s.message,s),r.bind(console,n,...s.args)}return Ia}}lu.VERSION=lC;function cC(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return A1(Number.isFinite(e)&&e>=0),e}function p3(t){const{logLevel:e,message:n}=t;t.logLevel=cC(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return A1(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function HD(t,e,n){if(typeof e=="string"){const r=n.time?zD(UD(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=$D(e,n.color,n.background)}return e}function XD(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const Up="4.3.3",QD=Up[0]>="0"&&Up[0]<="9"?`v${Up}`:"";function YD(){const t=new lu({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=t,globalThis.loaders.version=QD,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=t,t}const qD=YD();function ZD(t,e){return AC(t||{},e)}function AC(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=AC(r[i]||{},e[i],n+1):r[i]=e[i];return r}function KD(t){var e;globalThis.loaders||(globalThis.loaders={}),(e=globalThis.loaders).modules||(e.modules={}),Object.assign(globalThis.loaders.modules,t)}const GD="latest";function JD(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version}const eB=JD();function lo(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const zo=typeof process!="object"||String(process)!=="[object process]"||process.browser,tB=typeof window<"u"&&typeof window.orientation<"u",g3=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);g3&&parseFloat(g3[1]);class nB{constructor(e,n){L(this,"name");L(this,"workerThread");L(this,"isRunning",!0);L(this,"result");L(this,"_resolve",()=>{});L(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){lo(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){lo(this.isRunning),this.isRunning=!1,this._reject(e)}}class zp{terminate(){}}const Vp=new Map;function rB(t){lo(t.source&&!t.url||!t.source&&t.url);let e=Vp.get(t.source||t.url);return e||(t.url&&(e=iB(t.url),Vp.set(t.url,e)),t.source&&(e=uC(t.source),Vp.set(t.source,e))),lo(e),e}function iB(t){if(!t.startsWith("http"))return t;const e=sB(t);return uC(e)}function uC(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function sB(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function fC(t,e=!0,n){const r=n||new Set;if(t){if(m3(t))r.add(t);else if(m3(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)fC(t[i],e,r)}}return n===void 0?Array.from(r):[]}function m3(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const $p=()=>{};class zm{constructor(e){L(this,"name");L(this,"source");L(this,"url");L(this,"terminated",!1);L(this,"worker");L(this,"onMessage");L(this,"onError");L(this,"_loadableURL","");const{name:n,source:r,url:i}=e;lo(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=$p,this.onError=s=>console.log(s),this.worker=zo?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&zo||typeof zp<"u"&&!zo}destroy(){this.onMessage=$p,this.onError=$p,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||fC(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=rB({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new zp(r,{eval:!1})}else if(this.source)e=new zp(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class oB{constructor(e){L(this,"name","unnamed");L(this,"source");L(this,"url");L(this,"maxConcurrency",1);L(this,"maxMobileConcurrency",1);L(this,"onDebug",()=>{});L(this,"reuseWorkers",!0);L(this,"props",{});L(this,"jobQueue",[]);L(this,"idleQueue",[]);L(this,"count",0);L(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return zm.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new nB(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!zo||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new zm({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return tB?this.maxMobileConcurrency:this.maxConcurrency}}const aB={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},Ds=class Ds{constructor(e){L(this,"props");L(this,"workerPools",new Map);this.props={...aB},this.setProps(e),this.workerPools=new Map}static isSupported(){return zm.isSupported()}static getWorkerFarm(e={}){return Ds._workerFarm=Ds._workerFarm||new Ds({}),Ds._workerFarm.setProps(e),Ds._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new oB({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};L(Ds,"_workerFarm");let Zh=Ds;function lB(t,e={}){const n=e[t.id]||{},r=zo?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(zo?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=GD);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return lo(i),i}function cB(t,e=eB){lo(t,"no worker provided");const n=t.version;return!(!e||!n)}const vs={};function AB(t,e){return!Zh.isSupported()||!zo&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function uB(t,e,n,r,i){const s=t.id,o=lB(t,n),u=Zh.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const h=await u.startJob("process-on-worker",fB.bind(null,i));return h.postMessage("process",{input:e,options:n,context:r}),await(await h.result).result}async function fB(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const u=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:u})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function hB(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function dB(...t){return pB(t)}function pB(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function hC(t){const e=[];for await(const n of t)e.push(n);return dB(...e)}function _3(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class y3{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=_3(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(_3()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class cu{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof y3?i=e:i=new y3(n,r),this.stats[n]=i),i}}const gB="Queued Requests",mB="Active Requests",_B="Cancelled Requests",yB="Queued Requests Ever",vB="Active Requests Ever",wB={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class bB{constructor(e={}){L(this,"props");L(this,"stats");L(this,"activeRequestCount",0);L(this,"requestQueue",[]);L(this,"requestMap",new Map);L(this,"updateTimer",null);this.props={...wB,...e},this.stats=new cu({id:this.props.id}),this.stats.get(gB),this.stats.get(mB),this.stats.get(_B),this.stats.get(yB),this.stats.get(vB)}scheduleRequest(e,n=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);const r={handle:e,priority:0,getPriority:n},i=new Promise(s=>(r.resolve=s,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){const{handle:n,resolve:r}=e;let i=!1;const s=()=>{i||(i=!0,this.requestMap.delete(n),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){this.updateTimer!==null&&clearTimeout(this.updateTimer),this.updateTimer=null;const e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(e!==0){this._updateAllRequests();for(let n=0;n<e;++n){const r=this.requestQueue.shift();r&&this._issueRequest(r)}}}_updateAllRequests(){const e=this.requestQueue;for(let n=0;n<e.length;++n){const r=e[n];this._updateRequest(r)||(e.splice(n,1),this.requestMap.delete(r.handle),n--)}e.sort((n,r)=>n.priority-r.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),e.priority<0?(e.resolve(null),!1):!0}}let xB="";const v3={};function TB(t){for(const e in v3)if(t.startsWith(e)){const n=v3[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${xB}${t}`),t}function EB(t){return t&&typeof t=="object"&&t.isBuffer}function rl(t){if(EB(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function Ju(t){return e=>new Promise((n,r)=>t(e,(i,s)=>i?r(i):n(s)))}function dC(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function SB(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const CB=t=>typeof t=="boolean",Jc=t=>typeof t=="function",Au=t=>t!==null&&typeof t=="object",w3=t=>Au(t)&&t.constructor==={}.constructor,PB=t=>!!t&&typeof t[Symbol.iterator]=="function",RB=t=>t&&typeof t[Symbol.asyncIterator]=="function",fa=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,ha=t=>typeof Blob<"u"&&t instanceof Blob,kB=t=>t&&typeof t=="object"&&t.isBuffer,IB=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Au(t)&&Jc(t.tee)&&Jc(t.cancel)&&Jc(t.getReader),MB=t=>Au(t)&&Jc(t.read)&&Jc(t.pipe)&&CB(t.readable),pC=t=>IB(t)||MB(t);class OB extends Error{constructor(n,r){super(n);L(this,"reason");L(this,"url");L(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const NB=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,DB=/^([-\w.]+\/[-\w.+]+)/;function b3(t,e){return t.toLowerCase()===e.toLowerCase()}function BB(t){const e=DB.exec(t);return e?e[1]:t}function x3(t){const e=NB.exec(t);return e?e[1]:""}const gC=/\?.*/;function LB(t){const e=t.match(gC);return e&&e[0]}function u1(t){return t.replace(gC,"")}function FB(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function pd(t){return fa(t)?t.url:ha(t)?t.name||"":typeof t=="string"?t:""}function f1(t){if(fa(t)){const e=t,n=e.headers.get("content-type")||"",r=u1(e.url);return BB(n)||x3(r)}return ha(t)?t.type||"":typeof t=="string"?x3(t):""}function UB(t){return fa(t)?t.headers["content-length"]||-1:ha(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function mC(t){if(fa(t))return t;const e={},n=UB(t);n>=0&&(e["content-length"]=String(n));const r=pd(t),i=f1(t);i&&(e["content-type"]=i);const s=await $B(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function zB(t){if(!t.ok)throw await VB(t)}async function VB(t){const e=FB(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=!t.bodyUsed&&(i!=null&&i.includes("application/json"))?await t.json():await t.text()}catch{}return new OB(n,r)}async function $B(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${WB(n)}`}return null}function WB(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function jB(t){return!HB(t)&&!XB(t)}function HB(t){return t.startsWith("http:")||t.startsWith("https:")}function XB(t){return t.startsWith("data:")}async function T3(t,e){var n,r;if(typeof t=="string"){const i=TB(t);return jB(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await mC(t)}const E3=new lu({id:"loaders.gl"});class QB{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class YB{constructor(){L(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const _C={fetch:null,mimeType:void 0,nothrow:!1,log:new YB,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Oo,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},qB={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function yC(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function vC(){const t=yC();return t.globalOptions=t.globalOptions||{..._C},t.globalOptions}function ZB(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],KB(t,n),JB(e,t,r)}function KB(t,e){S3(t,null,_C,qB,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};S3(r,n.id,i,s,e)}}function S3(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const u=!e&&Au(t[a]),h=a==="baseUri"&&!e,p=a==="workerUrl"&&e;if(!(a in n)&&!h&&!p){if(a in r)E3.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!u){const _=GB(a,i);E3.warn(`${s} loader option '${o}${a}' not recognized. ${_}`)()}}}}function GB(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function JB(t,e,n){const i={...t.options||{}};return eL(i,n),i.log===null&&(i.log=new QB),C3(i,vC()),C3(i,e),i}function C3(t,e){for(const n in e)if(n in e){const r=e[n];w3(r)&&w3(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function eL(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function h1(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function d1(t){Yh(t,"null loader"),Yh(h1(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const wC=()=>{const t=yC();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function bC(t){const e=wC();t=Array.isArray(t)?t:[t];for(const n of t){const r=d1(n);e.find(i=>r===i)||e.unshift(r)}}function tL(){return wC()}const nL=/\.([^.]+)$/;async function rL(t,e=[],n,r){if(!xC(t))return null;let i=P3(t,e,{...n,nothrow:!0},r);if(i)return i;if(ha(t)&&(t=await t.slice(0,10).arrayBuffer(),i=P3(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(TC(t));return i}function P3(t,e=[],n,r){if(!xC(t))return null;if(e&&!Array.isArray(e))return d1(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...tL()),sL(i);const s=iL(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(TC(t));return s}function iL(t,e,n,r){const i=pd(t),s=f1(t),o=u1(i)||(r==null?void 0:r.url);let a=null,u="";return n!=null&&n.mimeType&&(a=Wp(e,n==null?void 0:n.mimeType),u=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||oL(e,o),u=u||(a?`matched url ${o}`:""),a=a||Wp(e,s),u=u||(a?`matched MIME type ${s}`:""),a=a||lL(e,t),u=u||(a?`matched initial data ${EC(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Wp(e,n==null?void 0:n.fallbackMimeType),u=u||(a?`matched fallback MIME type ${s}`:"")),u&&qD.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${u}.`),a}function xC(t){return!(t instanceof Response&&t.status===204)}function TC(t){const e=pd(t),n=f1(t);let r="No valid loader found (";r+=e?`${dC(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?EC(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function sL(t){for(const e of t)d1(e)}function oL(t,e){const n=e&&nL.exec(e),r=n&&n[1];return r?aL(t,r):null}function aL(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Wp(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>b3(e,i))||b3(e,`application/x.${r.id}`))return r;return null}function lL(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(cL(e,n))return n}else if(ArrayBuffer.isView(e)){if(R3(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&R3(e,0,n))return n;return null}function cL(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function R3(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>AL(t,e,n,i))}function AL(t,e,n,r){if(r instanceof ArrayBuffer)return hB(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=Vm(t,e,r.length);return r===i;default:return!1}}function EC(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Vm(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Vm(t,0,e):""}function Vm(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const uL=256*1024;function*fL(t,e){const n=(e==null?void 0:e.chunkSize)||uL;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const hL=256*1024;function*dL(t,e={}){const{chunkSize:n=hL}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const pL=1024*1024;async function*gL(t,e){const n=(e==null?void 0:e.chunkSize)||pL;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function k3(t,e){return Oo?mL(t,e):_L(t)}async function*mL(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield rl(o)}}catch{n.releaseLock()}}async function*_L(t,e){for await(const n of t)yield rl(n)}function yL(t,e){if(typeof t=="string")return fL(t,e);if(t instanceof ArrayBuffer)return dL(t,e);if(ha(t))return gL(t,e);if(pC(t))return k3(t,e);if(fa(t))return k3(t.body,e);throw new Error("makeIterator")}const SC="Cannot convert supplied data type";function vL(t,e,n){if(e.text&&typeof t=="string")return t;if(kB(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(SC)}async function wL(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return vL(t,e);if(ha(t)&&(t=await mC(t)),fa(t)){const i=t;return await zB(i),e.binary?await i.arrayBuffer():await i.text()}if(pC(t)&&(t=yL(t,n)),PB(t)||RB(t))return hC(t);throw new Error(SC)}function CC(t,e){const n=vC(),r=t||n;return typeof r.fetch=="function"?r.fetch:Au(r.fetch)?i=>T3(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:T3}function bL(t,e,n){if(n)return n;const r={fetch:CC(e,t),...t};if(r.url){const i=u1(r.url);r.baseUrl=i,r.queryString=LB(r.url),r.filename=dC(i),r.baseUrl=SB(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function xL(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function Kh(t,e,n,r){e&&!Array.isArray(e)&&!h1(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=pd(t),o=xL(e,r),a=await rL(t,o,n);return a?(n=ZB(n,a,o,i),r=bL({url:i,_parse:Kh,loaders:o},n,r||null),await TL(a,t,n,r)):null}async function TL(t,e,n,r){if(cB(t),n=ZD(t.options,n),fa(e)){const s=e,{ok:o,redirected:a,status:u,statusText:h,type:p,url:_}=s,v=Object.fromEntries(s.headers.entries());r.response={headers:v,ok:o,redirected:a,status:u,statusText:h,type:p,url:_}}e=await wL(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(AB(t,n))return await uB(t,e,n,r,Kh);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw lo(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Gh(t,e,n,r){let i,s;!Array.isArray(e)&&!h1(e)?(i=[],s=e):(i=e,s=n);const o=CC(s);let a=t;return typeof t=="string"&&(a=await o(t)),ha(t)&&(a=await o(t)),Array.isArray(i)?await Kh(a,i,s):await Kh(a,i,s)}const EL="4.3.3";var qE;const SL=(qE=globalThis.loaders)==null?void 0:qE.parseImageNode,$m=typeof Image<"u",Wm=typeof ImageBitmap<"u",CL=!!SL,jm=Oo?!0:CL;function PL(t){switch(t){case"auto":return Wm||$m||jm;case"imagebitmap":return Wm;case"image":return $m;case"data":return jm;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function RL(){if(Wm)return"imagebitmap";if($m)return"image";if(jm)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function kL(t){const e=ML(t);if(!e)throw new Error("Not an image");return e}function IL(t){switch(kL(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function ML(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const OL=/^data:image\/svg\+xml/,NL=/\.svg((\?|#).*)?$/;function p1(t){return t&&(OL.test(t)||NL.test(t))}function DL(t,e){if(p1(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return PC(t,e)}function PC(t,e){if(p1(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function RC(t,e,n){const r=DL(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await BL(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function BL(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const LL={};let I3=!0;async function FL(t,e,n){let r;p1(n)?r=await RC(t,e,n):r=PC(t,n);const i=e&&e.imagebitmap;return await UL(r,i)}async function UL(t,e=null){if((zL(e)||!I3)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),I3=!1}return await createImageBitmap(t)}function zL(t){for(const e in t||LL)return!1;return!0}function VL(t){return!HL(t,"ftyp",4)||!(t[8]&96)?null:$L(t)}function $L(t){switch(WL(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function WL(t,e,n){return String.fromCharCode(...t.slice(e,n))}function jL(t){return[...t].map(e=>e.charCodeAt(0))}function HL(t,e,n=0){const r=jL(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Ei=!1,eA=!0;function kC(t){const e=uu(t);return QL(e)||ZL(e)||YL(e)||qL(e)||XL(e)}function XL(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=VL(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function QL(t){const e=uu(t);return e.byteLength>=24&&e.getUint32(0,Ei)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Ei),height:e.getUint32(20,Ei)}:null}function YL(t){const e=uu(t);return e.byteLength>=10&&e.getUint32(0,Ei)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,eA),height:e.getUint16(8,eA)}:null}function qL(t){const e=uu(t);return e.byteLength>=14&&e.getUint16(0,Ei)===16973&&e.getUint32(2,eA)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,eA),height:e.getUint32(22,eA)}:null}function ZL(t){const e=uu(t);if(!(e.byteLength>=3&&e.getUint16(0,Ei)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=KL();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Ei);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Ei),width:e.getUint16(s+7,Ei)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Ei)}return null}function KL(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function uu(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function GL(t,e){var i;const{mimeType:n}=kC(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return Yh(r),await r(t,n)}async function JL(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=e5(i);let a;switch(o){case"imagebitmap":a=await FL(t,e,s);break;case"image":a=await RC(t,e,s);break;case"data":a=await GL(t);break;default:Yh(!1)}return i==="data"&&(a=IL(a)),a}function e5(t){switch(t){case"auto":case"data":return RL();default:return PL(t),t}}const t5=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],n5=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],r5={image:{type:"auto",decode:!0}},i5={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:EL,mimeTypes:n5,extensions:t5,parse:JL,tests:[t=>!!kC(new DataView(t))],options:r5},s5=new lu({id:"deck"}),ot=s5;let Hm={};function o5(t){Hm=t}function Dn(t,e,n,r){ot.level>0&&Hm[t]&&Hm[t].call(null,e,n,r)}function a5(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const l5={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:a5,parseTextSync:JSON.parse};function c5(){const t="9.2.0-alpha.2",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ot.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ot,_registerLoggers:o5},bC([l5,[i5,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const A5=c5();function g1(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const jp={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function u5(t){const e={};for(const[n,r]of Object.entries(t))e[n]=f5(r);return e}function f5(t){let e=M3(t);if(e!=="object")return{value:t,...jp[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...jp[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=M3(t.value),{...t,...jp[e],type:e}):{type:"object",value:null};throw new Error("props")}function M3(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const h5=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,d5=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,p5={vertex:h5,fragment:d5},O3=/void\s+main\s*\([^)]*\)\s*\{\n?/,N3=/}\n?[^{}]*$/,Hp=[],rh="__LUMA_INJECT_DECLARATIONS__";function g5(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=m5(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function m5(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Jh(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((u,h)=>u.order-h.order),Hp.length=o.length;for(let u=0,h=o.length;u<h;++u)Hp[u]=o[u].injection;const a=`${Hp.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(rh,a));break;case"vs:#main-start":i&&(t=t.replace(O3,u=>u+a));break;case"vs:#main-end":i&&(t=t.replace(N3,u=>a+u));break;case"fs:#decl":i||(t=t.replace(rh,a));break;case"fs:#main-start":i||(t=t.replace(O3,u=>u+a));break;case"fs:#main-end":i||(t=t.replace(N3,u=>a+u));break;default:t=t.replace(s,u=>u+a)}}return t=t.replace(rh,""),r&&(t=t.replace(/\}\s*$/,s=>s+p5[e])),t}function e0(t){t.map(e=>IC(e))}function IC(t){if(t.instance)return;e0(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:g5(r),parsedDeprecations:_5(n)};e&&(i.propValidators=u5(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[a,u])=>{const h=u==null?void 0:u.value;return h&&(o[a]=h),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function MC(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function _5(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function m1(t){e0(t);const e={},n={};OC({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return e0(r),r}function OC(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&OC({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function y5(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function v5(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=D3(t,w5),t;case"fragment":return t=D3(t,b5),t;default:throw new Error(e)}}const NC=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],w5=[...NC,[Xm("attribute"),"in $1"],[Xm("varying"),"out $1"]],b5=[...NC,[Xm("varying"),"in $1"]];function D3(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Xm(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function DC(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function BC(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),u=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=u;break;case"fs":e.fragment[a]=u;break;default:throw new Error(s)}}return e}function x5(t,e){return{name:T5(t,e),language:"glsl",version:E5(t)}}function T5(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function E5(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const LC=`

${rh}
`,S5=`precision highp float;
`;function C5(t){const e=m1(t.modules||[]);return{source:R5(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:FC(e)}}function P5(t){const{vs:e,fs:n}=t,r=m1(t.modules||[]);return{vs:B3(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:B3(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:FC(r)}}function R5(t,e){var R;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;g1(typeof n=="string","shader source must be a string");const u=n;let h="";const p=BC(s),_={},v={},b={};for(const D in o){const P=typeof o[D]=="string"?{injection:o[D],order:0}:o[D],S=/^(v|f)s:(#)?([\w-]+)$/.exec(D);if(S){const k=S[2],M=S[3];k?M==="decl"?v[D]=[P]:b[D]=[P]:_[D]=[P]}else b[D]=[P]}const E=i;for(const D of E){a&&MC(D,u,a);const P=UC(D,"wgsl");h+=P;const S=((R=D.injections)==null?void 0:R[r])||{};for(const k in S){const M=/^(v|f)s:#([\w-]+)$/.exec(k);if(M){const Y=M[2]==="decl"?v:b;Y[k]=Y[k]||[],Y[k].push(S[k])}else _[k]=_[k]||[],_[k].push(S[k])}}return h+=LC,h=Jh(h,r,v),h+=DC(p[r],_),h+=u,h=Jh(h,r,b),h}function B3(t,e){var le;const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:u=[],inject:h={},prologue:p=!0,log:_}=e;g1(typeof r=="string","shader source must be a string");const v=s==="glsl"?x5(r).version:-1,b=t.shaderLanguageVersion,E=v===100?"#version 100":"#version 300 es",D=r.split(`
`).slice(1).join(`
`),P={};o.forEach(I=>{Object.assign(P,I.defines)}),Object.assign(P,a);let S="";switch(s){case"wgsl":break;case"glsl":S=p?`${E}

// ----- PROLOGUE -------------------------
${k5({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${y5(t)}
${i==="fragment"?S5:""}

// ----- APPLICATION DEFINES -------------------------

${I5(P)}

`:`${E}
`;break}const k=BC(u),M={},V={},Y={};for(const I in h){const O=typeof h[I]=="string"?{injection:h[I],order:0}:h[I],U=/^(v|f)s:(#)?([\w-]+)$/.exec(I);if(U){const $=U[2],q=U[3];$?q==="decl"?V[I]=[O]:Y[I]=[O]:M[I]=[O]}else Y[I]=[O]}for(const I of o){_&&MC(I,D,_);const O=UC(I,i);S+=O;const U=((le=I.instance)==null?void 0:le.normalizedInjections[i])||{};for(const $ in U){const q=/^(v|f)s:#([\w-]+)$/.exec($);if(q){const ee=q[2]==="decl"?V:Y;ee[$]=ee[$]||[],ee[$].push(U[$])}else M[$]=M[$]||[],M[$].push(U[$])}}return S+="// ----- MAIN SHADER SOURCE -------------------------",S+=LC,S=Jh(S,i,V),S+=DC(k[i],M),S+=D,S=Jh(S,i,Y),s==="glsl"&&v!==b&&(S=v5(S,i)),S.trim()}function FC(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function k5(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function I5(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function UC(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:g1(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const M5=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,O5=/^\s*\#\s*endif\s*$/;function N5(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const a of n){const u=a.match(M5),h=a.match(O5);u?(s=u[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):h?i=!0:i&&r.push(a)}return r.join(`
`)}const Ro=class Ro{constructor(){L(this,"_hookFunctions",[]);L(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return Ro.defaultShaderAssembler=Ro.defaultShaderAssembler||new Ro,Ro.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=C5({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?N5(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...P5({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],u=a.name;n[i++]=a,r[u]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],u=a.name;r[u]||(n[i++]=a,r[u]=!0)}return n.length=i,e0(n),n}};L(Ro,"defaultShaderAssembler");let t0=Ro;const D5=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,B5=`#version 300 es
${D5}`;function L5(t){const{input:e,inputChannels:n,output:r}=t||{};if(!e)return B5;if(!n)throw new Error("inputChannels");const i=F5(n),s=U5(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function F5(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function U5(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class z5{constructor(){L(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new cu({id:e})),this.stats.get(e)}}const zC=new z5,Ee=new lu({id:"luma.gl"}),Xp={};function gd(t="id"){Xp[t]=Xp[t]||1;const e=Xp[t]++;return`${t}-${e}`}var Qg;let Ct=(Qg=class{constructor(e,n,r){L(this,"id");L(this,"props");L(this,"userData",{});L(this,"_device");L(this,"destroyed",!1);L(this,"allocatedBytes",0);L(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=V5(n,r);const i=this.props.id!=="undefined"?this.props.id:gd(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},L(Qg,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Qg);function V5(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const yn=class yn extends Ct{constructor(n,r){const i={...r};(r.usage||0)&yn.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,yn.defaultProps);L(this,"usage");L(this,"indexType");L(this,"updateTimestamp");L(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,yn.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};L(yn,"defaultProps",{...Ct.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),L(yn,"MAP_READ",1),L(yn,"MAP_WRITE",2),L(yn,"COPY_SRC",4),L(yn,"COPY_DST",8),L(yn,"INDEX",16),L(yn,"VERTEX",32),L(yn,"UNIFORM",64),L(yn,"STORAGE",128),L(yn,"INDIRECT",256),L(yn,"QUERY_RESOLVE",512),L(yn,"DEBUG_DATA_MAX_LENGTH",32);let Dt=yn;function VC(t){const e=L3[t],n=$5(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:L3[t],byteLength:n,integer:i,signed:s,normalized:r}}function $5(t){return W5[t]}const L3={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},W5={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},In="texture-compression-bc",St="texture-compression-astc",pi="texture-compression-etc2",j5="texture-compression-etc1-webgl",ef="texture-compression-pvrtc-webgl",Qp="texture-compression-atc-webgl",tf="float32-renderable-webgl",Yp="float16-renderable-webgl",H5="rgb9e5ufloat-renderable-webgl",qp="snorm8-renderable-webgl",yc="norm16-renderable-webgl",Zp="snorm16-renderable-webgl",nf="float32-filterable",F3="float16-filterable-webgl";function $C(t){const e=X5[t];if(!e)throw new Error(`Unsupported texture format ${t}`);return e}const X5={r8unorm:{},r8snorm:{render:qp},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:qp},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:Yp,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:yc},"r16snorm-webgl":{f:Zp},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:qp},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:Yp,filter:F3},"rg16unorm-webgl":{render:yc},"rg16snorm-webgl":{render:Zp},r32uint:{},r32sint:{},r32float:{render:tf,filter:nf},rgb9e5ufloat:{channels:"rgb",packed:!0,render:H5},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:tf},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:yc},"rgb16snorm-webgl":{f:yc},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:nf},rgba16uint:{},rgba16sint:{},rgba16float:{render:Yp,filter:F3},"rgba16unorm-webgl":{render:yc},"rgba16snorm-webgl":{render:Zp},"rgb32float-webgl":{render:tf,filter:nf},rgba32uint:{},rgba32sint:{},rgba32float:{render:tf,filter:nf},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:In},"bc1-rgb-unorm-srgb-webgl":{f:In},"bc1-rgba-unorm":{f:In},"bc1-rgba-unorm-srgb":{f:In},"bc2-rgba-unorm":{f:In},"bc2-rgba-unorm-srgb":{f:In},"bc3-rgba-unorm":{f:In},"bc3-rgba-unorm-srgb":{f:In},"bc4-r-unorm":{f:In},"bc4-r-snorm":{f:In},"bc5-rg-unorm":{f:In},"bc5-rg-snorm":{f:In},"bc6h-rgb-ufloat":{f:In},"bc6h-rgb-float":{f:In},"bc7-rgba-unorm":{f:In},"bc7-rgba-unorm-srgb":{f:In},"etc2-rgb8unorm":{f:pi},"etc2-rgb8unorm-srgb":{f:pi},"etc2-rgb8a1unorm":{f:pi},"etc2-rgb8a1unorm-srgb":{f:pi},"etc2-rgba8unorm":{f:pi},"etc2-rgba8unorm-srgb":{f:pi},"eac-r11unorm":{f:pi},"eac-r11snorm":{f:pi},"eac-rg11unorm":{f:pi},"eac-rg11snorm":{f:pi},"astc-4x4-unorm":{f:St},"astc-4x4-unorm-srgb":{f:St},"astc-5x4-unorm":{f:St},"astc-5x4-unorm-srgb":{f:St},"astc-5x5-unorm":{f:St},"astc-5x5-unorm-srgb":{f:St},"astc-6x5-unorm":{f:St},"astc-6x5-unorm-srgb":{f:St},"astc-6x6-unorm":{f:St},"astc-6x6-unorm-srgb":{f:St},"astc-8x5-unorm":{f:St},"astc-8x5-unorm-srgb":{f:St},"astc-8x6-unorm":{f:St},"astc-8x6-unorm-srgb":{f:St},"astc-8x8-unorm":{f:St},"astc-8x8-unorm-srgb":{f:St},"astc-10x5-unorm":{f:St},"astc-10x5-unorm-srgb":{f:St},"astc-10x6-unorm":{f:St},"astc-10x6-unorm-srgb":{f:St},"astc-10x8-unorm":{f:St},"astc-10x8-unorm-srgb":{f:St},"astc-10x10-unorm":{f:St},"astc-10x10-unorm-srgb":{f:St},"astc-12x10-unorm":{f:St},"astc-12x10-unorm-srgb":{f:St},"astc-12x12-unorm":{f:St},"astc-12x12-unorm-srgb":{f:St},"pvrtc-rgb4unorm-webgl":{f:ef},"pvrtc-rgba4unorm-webgl":{f:ef},"pvrtc-rbg2unorm-webgl":{f:ef},"pvrtc-rgba2unorm-webgl":{f:ef},"etc1-rbg-unorm-webgl":{f:j5},"atc-rgb-unorm-webgl":{f:Qp},"atc-rgba-unorm-webgl":{f:Qp},"atc-rgbai-unorm-webgl":{f:Qp}},Q5=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],Y5=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function WC(t){return Q5.some(e=>t.startsWith(e))}function _1(t){let e=q5(t);if(WC(t)){e.channels="rgb",e.components=3,e.bytesPerPixel=1,e.srgb=!1,e.compressed=!0;const r=Z5(t);r&&(e.blockWidth=r.blockWidth,e.blockHeight=r.blockHeight)}const n=Y5.exec(t);if(n){const[,r,i,s,o,a]=n,u=`${s}${i}`,h=VC(u),p=h.byteLength*8,_=r.length,v=[p,_>=2?p:0,_>=3?p:0,_>=4?p:0];e={format:t,attachment:e.attachment,dataType:h.dataType,components:_,channels:r,integer:h.integer,signed:h.signed,normalized:h.normalized,bitsPerChannel:v,bytesPerPixel:h.byteLength*r.length,packed:e.packed,srgb:e.srgb},a==="-webgl"&&(e.webgl=!0),o==="-srgb"&&(e.srgb=!0)}return t.endsWith("-webgl")&&(e.webgl=!0),t.endsWith("-srgb")&&(e.srgb=!0),e}function q5(t){var s;const e=$C(t),n=e.bytesPerPixel||1,r=e.bitsPerChannel||[8,8,8,8];return delete e.bitsPerChannel,delete e.bytesPerPixel,delete e.f,delete e.render,delete e.filter,delete e.blend,delete e.store,{...e,format:t,attachment:e.attachment||"color",channels:e.channels||"r",components:e.components||((s=e.channels)==null?void 0:s.length)||1,bytesPerPixel:n,bitsPerChannel:r,dataType:e.dataType||"uint8",srgb:e.srgb??!1,packed:e.packed??!1,webgl:e.webgl??!1,integer:e.integer??!1,signed:e.signed??!1,normalized:e.normalized??!1,compressed:e.compressed??!1}}function Z5(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}function K5(t){const e=$C(t),n={format:t,create:e.f??!0,render:e.render??!0,filter:e.filter??!0,blend:e.blend??!0,store:e.store??!0},r=_1(t),i=t.startsWith("depth")||t.startsWith("stencil"),s=r==null?void 0:r.signed,o=r==null?void 0:r.integer,a=r==null?void 0:r.webgl;return n.render&&(n.render=!s),n.filter&&(n.filter=!i&&!s&&!o&&!a),n}class G5{}class J5{constructor(e=[],n){L(this,"features");L(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const L0=class L0{constructor(e){L(this,"id");L(this,"props");L(this,"userData",{});L(this,"statsManager",zC);L(this,"timestamp",0);L(this,"_reused",!1);L(this,"_lumaData",{});this.props={...L0.defaultProps,...e},this.id=this.props.id||gd(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}getTextureFormatCapabilities(e){const n=K5(e),r=o=>(typeof o=="string"?this.features.has(o):o)??!0,i=r(n.create),s={format:e,create:i,render:i&&r(n.render),filter:i&&r(n.filter),blend:i&&r(n.blend),store:i&&r(n.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,n){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return WC(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}static _getCanvasContextProps(e){return e.createCanvasContext===!0?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&Dt.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":Ee.warn("indices buffer content must be of integer type")()),n}};L(L0,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>Ee.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:Ee.get("debug")||void 0,debugShaders:Ee.get("debug-shaders")||void 0,debugFramebuffers:!!Ee.get("debug-framebuffers"),debugWebGL:!!Ee.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let no=L0;const eF=ua()&&typeof document<"u",tF=()=>eF&&document.readyState==="complete",nF="set luma.log.level=1 (or higher) to trace rendering",U3="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Bs=class Bs{constructor(){L(this,"stats",zC);L(this,"log",Ee);L(this,"VERSION","9.1.9");L(this,"spector");L(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw Ee.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),Ee.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");Ee.error("This version of luma.gl has already been initialized")()}Ee.log(1,`${this.VERSION} - ${nF}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const n=this.getAdapterMap(e);return(i=(r=n.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Bs.defaultProps,e)}async createDevice(e={}){var a;e={...Bs.defaultProps,...e},e.waitForPageLoad&&await Bs.pageLoaded;const n=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||n).get(r),o=await((a=s==null?void 0:s.create)==null?void 0:a.call(s,e));if(o)return o;throw new Error(U3)}async attachDevice(e){var o;const n=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Bs.pageLoaded,e.handle===null&&(r="unknown");const i=n.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(U3)}enforceWebGL2(e=!0,n=[]){var s;const i=this.getAdapterMap(n).get("webgl");i||Ee.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}registerDevices(e){Ee.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const r=n.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};L(Bs,"defaultProps",{...no.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),L(Bs,"pageLoaded",rF().then(()=>{Ee.probe(2,"DOM is loaded")()}));let Qm=Bs;const Ym=new Qm;function rF(){return tF()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class iF{}const F0=class F0{constructor(e){L(this,"id");L(this,"props");L(this,"canvas");L(this,"htmlCanvas");L(this,"offscreenCanvas");L(this,"type");L(this,"width",1);L(this,"height",1);L(this,"resizeObserver");L(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...F0.defaultProps,...e},e=this.props,!ua()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=oF(e.canvas):this.canvas=e.canvas;else{const n=aF(e),r=sF((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}toString(){return`${this[Symbol.toStringTag]}(${this.id})`}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){var e;try{const[n]=this.getDrawingBufferSize(),r=this._canvasSizeInfo.clientWidth||((e=this.htmlCanvas)==null?void 0:e.clientWidth);return r?n/r:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return lF(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(Ee.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),u=Math.floor(i*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=u,this.device.gl){const[p,_]=this.getDrawingBufferSize();(p!==a||_!==u)&&(o=Math.min(p/r,_/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),Ee.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};L(F0,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let qm=F0;function sF(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function oF(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function aF(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id=gd("lumagl-auto-created-canvas"),r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function lF(t,e,n,r,i){const s=t,o=z3(s[0],e,n);let a=V3(s[1],e,r,i),u=z3(s[0]+1,e,n);const h=u===n-1?u:u-1;u=V3(s[1]+1,e,r,i);let p;return i?(u=u===0?u:u+1,p=a,a=u):p=u===r-1?u:u-1,{x:o,y:a,width:Math.max(h-o+1,1),height:Math.max(p-a+1,1)}}function z3(t,e,n){return Math.min(Math.round(t*e),n-1)}function V3(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const vn=class vn extends Ct{constructor(n,r){r=vn.normalizeProps(n,r);super(n,r,vn.defaultProps);L(this,"dimension");L(this,"format");L(this,"width");L(this,"height");L(this,"depth");L(this,"mipLevels");L(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=vn.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?vn.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const r=n==null?void 0:n.data;return ArrayBuffer.isView(r)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return vn.getTextureDataSize(n[0]);if(vn.isExternalImage(n))return vn.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const i=Object.values(n)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,r){let i;return ArrayBuffer.isView(n)?i=[{data:n,width:r.width,height:r.height}]:Array.isArray(n)?i=n:i=[n],i}static getMipLevelCount(n,r){return Math.floor(Math.log2(Math.max(n,r)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,r){var u,h;const i={...r},s=((h=(u=n==null?void 0:n.props)==null?void 0:u._resourceDefaults)==null?void 0:h.texture)||{};Object.assign(i,s);const{width:o,height:a}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}};L(vn,"COPY_SRC",1),L(vn,"COPY_DST",2),L(vn,"TEXTURE",4),L(vn,"STORAGE",8),L(vn,"RENDER_ATTACHMENT",16),L(vn,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),L(vn,"defaultProps",{...Ct.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),L(vn,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let Qt=vn;const U0=class U0 extends Ct{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,U0.defaultProps)}};L(U0,"defaultProps",{...Ct.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let n0=U0;function cF(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=jC(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const u=s[o++];r+=$3(u,i,u.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=$3(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function $3(t,e,n,r){if(r!=null&&r.inlineSource){const s=AF(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function AF(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=jC(s,e,n))}return r}function jC(t,e,n){const r=n!=null&&n.html?fF(t):t;return`${uF(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function uF(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function fF(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const z0=class z0 extends Ct{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:hF(r),...r},z0.defaultProps);L(this,"stage");L(this,"source");L(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var h;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=HC(this.source),i=`${this.stage} ${r}`;let s=cF(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),(h=document.getElementsByClassName("luma-compiler-log-error")[0])==null||h.scrollIntoView(),a.onclick=()=>{const p=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(p)}}};L(z0,"defaultProps",{...Ct.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let r0=z0;function hF(t){return HC(t.source)||t.id||gd(`unnamed ${t.stage}-shader`)}function HC(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const gA=class gA extends Ct{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=gA.normalizeProps(e,n),super(e,n,gA.defaultProps)}static normalizeProps(e,n){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...n,...r}}};L(gA,"defaultProps",{...Ct.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let i0=gA;const V0=class V0 extends Ct{constructor(n,r={}){super(n,r,V0.defaultProps);L(this,"width");L(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(Ee.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof Qt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof Qt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:Qt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:Qt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};L(V0,"defaultProps",{...Ct.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let s0=V0;const $0=class $0 extends Ct{constructor(n,r){super(n,r,$0.defaultProps);L(this,"shaderLayout");L(this,"bufferLayout");L(this,"linkStatus","pending");L(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};L($0,"defaultProps",{...Ct.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Ul=$0;const qr=class qr extends Ct{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=qr.normalizeProps(e,n),super(e,n,qr.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};L(qr,"defaultClearColor",[0,0,0,1]),L(qr,"defaultClearDepth",1),L(qr,"defaultClearStencil",0),L(qr,"defaultProps",{...Ct.defaultProps,framebuffer:null,parameters:void 0,clearColor:qr.defaultClearColor,clearColors:void 0,clearDepth:qr.defaultClearDepth,clearStencil:qr.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Zm=qr;const W0=class W0 extends Ct{constructor(n,r){super(n,r,W0.defaultProps);L(this,"hash","");L(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};L(W0,"defaultProps",{...Ct.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let o0=W0;const j0=class j0 extends Ct{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,j0.defaultProps)}};L(j0,"defaultProps",{...Ct.defaultProps,measureExecutionTime:void 0});let Km=j0;const H0=class H0 extends Ct{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,H0.defaultProps)}};L(H0,"defaultProps",{...Ct.defaultProps});let Gm=H0;function dF(t){const[e,n]=gF[t],r=e==="i32"||e==="u32",i=e!=="u32",s=mF[e]*n,o=pF(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function pF(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const gF={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},mF={f32:4,f16:2,i32:4,u32:4};function XC(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=VC(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function QC(t,e){const n={};for(const r of t.attributes){const i=yF(t,e,r.name);i&&(n[r.name]=i)}return n}function _F(t,e,n=16){const r=QC(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function yF(t,e,n){const r=vF(t,n),i=wF(e,n);if(!r)return null;const s=dF(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=XC(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function vF(t,e){const n=t.attributes.find(r=>r.name===e);return n||Ee.warn(`shader layout attribute "${e}" not present in shader`),n||null}function wF(t,e){bF(t);let n=xF(t,e);return n||(n=TF(t,e),n)?n:(Ee.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function bF(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&Ee.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function xF(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function TF(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=XC(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const X0=class X0 extends Ct{constructor(n,r){super(n,r,X0.defaultProps);L(this,"maxVertexAttributes");L(this,"attributeInfos");L(this,"indexBuffer",null);L(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=_F(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){this.device.reportError(new Error("constant attributes not supported"))}};L(X0,"defaultProps",{...Ct.defaultProps,renderPipeline:null});let Jm=X0;const Q0=class Q0 extends Ct{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,Q0.defaultProps)}};L(Q0,"defaultProps",{...Ct.defaultProps,layout:void 0,buffers:{}});let e_=Q0;const Y0=class Y0 extends Ct{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,Y0.defaultProps)}};L(Y0,"defaultProps",{...Ct.defaultProps,type:void 0,count:void 0});let t_=Y0;const EF={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function SF(t){return EF[t]}function CF(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let rf;function YC(t){return(!rf||rf.byteLength<t)&&(rf=new ArrayBuffer(t)),rf}function PF(t,e){const n=YC(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function RF(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function a0(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":RF(t)}const W3=1024;class kF{constructor(e){L(this,"layout",{});L(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=SF(s),{type:a,components:u}=o;n=CF(n,u);const h=n;n+=u,this.layout[i]={type:a,size:u,offset:h}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,W3)}getData(e){const n=Math.max(this.byteLength,W3),r=YC(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){Ee.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:u,size:h,offset:p}=a,_=i[u];if(h===1){if(typeof o!="number"&&typeof o!="boolean"){Ee.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}_[p]=Number(o)}else{if(!a0(o)){Ee.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}_.set(o,p)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function IF(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!a0(r))return!1;if(a0(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function MF(t){return a0(t)?t.slice():t}class OF{constructor(e){L(this,"name");L(this,"uniforms",{});L(this,"modifiedUniforms",{});L(this,"modified",!0);L(this,"bindingLayout",{});L(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){IF(this.uniforms[e],n)||(this.uniforms[e]=MF(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class NF{constructor(e){L(this,"uniformBlocks",new Map);L(this,"uniformBufferLayouts",new Map);L(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new kF(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new OF({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:Dt.UNIFORM|Dt.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:Dt.UNIFORM|Dt.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&Ee.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const a=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();Ee.log(4,`Writing to uniform buffer ${String(e)}`,o,a)()}return i}}function qC(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function ZC(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function DF(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=qC(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class Kp{constructor(e){L(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}getBufferIndex(e){const n=this.bufferLayouts.findIndex(r=>r.name===e);return n===-1&&Ee.warn(`BufferLayout: Missing buffer for "${e}".`)(),n}}function BF(t,e){const n=Object.fromEntries(t.attributes.map(i=>[i.name,i.location])),r=e.slice();return r.sort((i,s)=>{const o=i.attributes?i.attributes.map(p=>p.attribute):[i.name],a=s.attributes?s.attributes.map(p=>p.attribute):[s.name],u=Math.min(...o.map(p=>n[p])),h=Math.min(...a.map(p=>n[p]));return u-h}),r}class Nr{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class j3{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class $s extends Nr{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class ro extends Nr{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class n_ extends Nr{constructor(e,n,r){super(e,r),this.format=n}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class Ko extends Nr{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}var Os;(t=>{t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(Os||(Os={}));class sf{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}let LF=class{constructor(e,n){this.name=e,this.type=n}};class FF{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}let H3=class{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}};class UF{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class zF{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r}}class VF{constructor(e,n=null,r){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n,this.attributes=r}}class $F{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}function WF(t){var e=(32768&t)>>15,n=(31744&t)>>10,r=1023&t;return n==0?(e?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):n==31?r?NaN:1/0*(e?-1:1):(e?-1:1)*Math.pow(2,n-15)*(1+r/Math.pow(2,10))}const KC=new Float32Array(1),jF=new Int32Array(KC.buffer),Mn=new Uint16Array(1);function HF(t){KC[0]=t;const e=jF[0],n=e>>31&1;let r=e>>23&255,i=8388607&e;if(r===255)return Mn[0]=n<<15|31744|(i!==0?512:0),Mn[0];if(r===0){if(i===0)return Mn[0]=n<<15,Mn[0];i|=8388608;let s=113;for(;!(8388608&i);)i<<=1,s--;return r=127-s,i&=8388607,r>0?(i=(i>>126-r)+(i>>127-r&1),Mn[0]=n<<15|r<<10|i>>13,Mn[0]):(Mn[0]=n<<15,Mn[0])}return r=r-127+15,r>=31?(Mn[0]=n<<15|31744,Mn[0]):r<=0?r<-10?(Mn[0]=n<<15,Mn[0]):(i=(8388608|i)>>1-r,Mn[0]=n<<15|i>>13,Mn[0]):(i>>=13,Mn[0]=n<<15|r<<10|i,Mn[0])}const y1=new Uint32Array(1),GC=new Float32Array(y1.buffer,0,1);function X3(t){const e=112+(t>>6&31)<<23|(63&t)<<17;return y1[0]=e,GC[0]}function XF(t,e,n,r,i,s,o,a,u){const h=r*(o>>=i)*(s>>=i)+n*o+e*a;switch(u){case"r8unorm":return[gt(t,h,"8unorm",1)[0]];case"r8snorm":return[gt(t,h,"8snorm",1)[0]];case"r8uint":return[gt(t,h,"8uint",1)[0]];case"r8sint":return[gt(t,h,"8sint",1)[0]];case"rg8unorm":{const p=gt(t,h,"8unorm",2);return[p[0],p[1]]}case"rg8snorm":{const p=gt(t,h,"8snorm",2);return[p[0],p[1]]}case"rg8uint":{const p=gt(t,h,"8uint",2);return[p[0],p[1]]}case"rg8sint":{const p=gt(t,h,"8sint",2);return[p[0],p[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{const p=gt(t,h,"8unorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8snorm":{const p=gt(t,h,"8snorm",4);return[p[0],p[1],p[2],p[3]]}case"rgba8uint":{const p=gt(t,h,"8uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba8sint":{const p=gt(t,h,"8sint",4);return[p[0],p[1],p[2],p[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{const p=gt(t,h,"8unorm",4);return[p[2],p[1],p[0],p[3]]}case"r16uint":return[gt(t,h,"16uint",1)[0]];case"r16sint":return[gt(t,h,"16sint",1)[0]];case"r16float":return[gt(t,h,"16float",1)[0]];case"rg16uint":{const p=gt(t,h,"16uint",2);return[p[0],p[1]]}case"rg16sint":{const p=gt(t,h,"16sint",2);return[p[0],p[1]]}case"rg16float":{const p=gt(t,h,"16float",2);return[p[0],p[1]]}case"rgba16uint":{const p=gt(t,h,"16uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16sint":{const p=gt(t,h,"16sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba16float":{const p=gt(t,h,"16float",4);return[p[0],p[1],p[2],p[3]]}case"r32uint":return[gt(t,h,"32uint",1)[0]];case"r32sint":return[gt(t,h,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[gt(t,h,"32float",1)[0]];case"rg32uint":{const p=gt(t,h,"32uint",2);return[p[0],p[1]]}case"rg32sint":{const p=gt(t,h,"32sint",2);return[p[0],p[1]]}case"rg32float":{const p=gt(t,h,"32float",2);return[p[0],p[1]]}case"rgba32uint":{const p=gt(t,h,"32uint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32sint":{const p=gt(t,h,"32sint",4);return[p[0],p[1],p[2],p[3]]}case"rgba32float":{const p=gt(t,h,"32float",4);return[p[0],p[1],p[2],p[3]]}case"rg11b10ufloat":{const p=new Uint32Array(t.buffer,h,1)[0],_=(4192256&p)>>11,v=(4290772992&p)>>22;return[X3(2047&p),X3(_),function(b){const E=112+(b>>5&31)<<23|(31&b)<<18;return y1[0]=E,GC[0]}(v),1]}}return null}function gt(t,e,n,r){const i=[0,0,0,0];for(let s=0;s<r;++s)switch(n){case"8unorm":i[s]=t[e]/255,e++;break;case"8snorm":i[s]=t[e]/255*2-1,e++;break;case"8uint":i[s]=t[e],e++;break;case"8sint":i[s]=t[e]-127,e++;break;case"16uint":i[s]=t[e]|t[e+1]<<8,e+=2;break;case"16sint":i[s]=(t[e]|t[e+1]<<8)-32768,e+=2;break;case"16float":i[s]=WF(t[e]|t[e+1]<<8),e+=2;break;case"32uint":case"32sint":i[s]=t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24,e+=4;break;case"32float":i[s]=new Float32Array(t.buffer,e,1)[0],e+=4}return i}function vt(t,e,n,r,i){for(let s=0;s<r;++s)switch(n){case"8unorm":t[e]=255*i[s],e++;break;case"8snorm":t[e]=.5*(i[s]+1)*255,e++;break;case"8uint":t[e]=i[s],e++;break;case"8sint":t[e]=i[s]+127,e++;break;case"16uint":new Uint16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16sint":new Int16Array(t.buffer,e,1)[0]=i[s],e+=2;break;case"16float":{const o=HF(i[s]);new Uint16Array(t.buffer,e,1)[0]=o,e+=2;break}case"32uint":new Uint32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32sint":new Int32Array(t.buffer,e,1)[0]=i[s],e+=4;break;case"32float":new Float32Array(t.buffer,e,1)[0]=i[s],e+=4}return i}const Gp={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class jr{constructor(){this.id=jr._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,n){if(e){n(l0.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(c0.instance)}}constEvaluate(e,n){throw new Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}jr._id=0;class l0 extends jr{}l0.instance=new l0;class c0 extends jr{}c0.instance=new c0;const JC=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class Ut extends jr{constructor(){super()}}let DA=class extends Ut{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){if(this.attributes)for(const n of this.attributes)e(n);e(this);for(const n of this.args)e(n);this.searchBlock(this.body,e)}};class QF extends Ut{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class eP extends Ut{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class r_ extends Ut{constructor(e,n){super(),this.body=e,this.loopId=n}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}let tP=class extends Ut{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}};class Yi extends Ut{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class v1 extends Ut{constructor(e,n,r){super(),this.attributes=null,this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class tA extends Ut{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class ih extends Ut{constructor(e,n,r,i,s){super(),this.attributes=null,this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}constEvaluate(e,n){return this.value.constEvaluate(e,n)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var il,Oc,fe,ie;(t=>{t.increment="++",t.decrement="--"})(il||(il={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for IncrementOperator");return t[n]}})(il||(il={}));class nP extends Ut{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(t=>{t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(Oc||(Oc={})),(t=>{t.parse=function(e){const n=e;if(n=="parse")throw new Error("Invalid value for AssignOperator");return n}})(Oc||(Oc={}));class rP extends Ut{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class w1 extends Ut{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}isBuiltin(){return JC.has(this.name)}search(e){for(const n of this.args)n.search(e);e(this)}}class iP extends Ut{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}search(e){var n;this.searchBlock(this.body,e),(n=this.continuing)===null||n===void 0||n.search(e)}}class sP extends Ut{constructor(e,n){super(),this.condition=e,this.cases=n}get astNodeType(){return"switch"}search(e){e(this);for(const n of this.cases)n.search(e)}}class oP extends Ut{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class aP extends Ut{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class YF extends Ut{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class qF extends Ut{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class lP extends Ut{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class b1 extends Ut{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class ZF extends Ut{constructor(){super()}get astNodeType(){return"discard"}}class cP extends Ut{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}let AP=class extends Ut{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}};class ge extends Ut{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=ge._priority.get(n.name);ge._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?ge.i32:n}getTypeName(){return this.name}}ge.x32=new ge("x32"),ge.f32=new ge("f32"),ge.i32=new ge("i32"),ge.u32=new ge("u32"),ge.f16=new ge("f16"),ge.bool=new ge("bool"),ge.void=new ge("void"),ge._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class Q3 extends ge{constructor(e){super(e)}}class ji extends ge{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}search(e){for(const n of this.members)e(n)}}class ce extends ge{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(this.format!==null){if(e==="vec2"||e==="vec3"||e==="vec4"||e==="mat2x2"||e==="mat2x3"||e==="mat2x4"||e==="mat3x2"||e==="mat3x3"||e==="mat3x4"||e==="mat4x2"||e==="mat4x3"||e==="mat4x4"){if(this.format.name==="f32")return e+="f",e;if(this.format.name==="i32")return e+="i",e;if(this.format.name==="u32")return e+="u",e;if(this.format.name==="bool")return e+="b",e;if(this.format.name==="f16")return e+="h",e}e+=`<${this.format.name}>`}else if(e==="vec2"||e==="vec3"||e==="vec4")return e;return e}}ce.vec2f=new ce("vec2",ge.f32,null),ce.vec3f=new ce("vec3",ge.f32,null),ce.vec4f=new ce("vec4",ge.f32,null),ce.vec2i=new ce("vec2",ge.i32,null),ce.vec3i=new ce("vec3",ge.i32,null),ce.vec4i=new ce("vec4",ge.i32,null),ce.vec2u=new ce("vec2",ge.u32,null),ce.vec3u=new ce("vec3",ge.u32,null),ce.vec4u=new ce("vec4",ge.u32,null),ce.vec2h=new ce("vec2",ge.f16,null),ce.vec3h=new ce("vec3",ge.f16,null),ce.vec4h=new ce("vec4",ge.f16,null),ce.vec2b=new ce("vec2",ge.bool,null),ce.vec3b=new ce("vec3",ge.bool,null),ce.vec4b=new ce("vec4",ge.bool,null),ce.mat2x2f=new ce("mat2x2",ge.f32,null),ce.mat2x3f=new ce("mat2x3",ge.f32,null),ce.mat2x4f=new ce("mat2x4",ge.f32,null),ce.mat3x2f=new ce("mat3x2",ge.f32,null),ce.mat3x3f=new ce("mat3x3",ge.f32,null),ce.mat3x4f=new ce("mat3x4",ge.f32,null),ce.mat4x2f=new ce("mat4x2",ge.f32,null),ce.mat4x3f=new ce("mat4x3",ge.f32,null),ce.mat4x4f=new ce("mat4x4",ge.f32,null),ce.mat2x2h=new ce("mat2x2",ge.f16,null),ce.mat2x3h=new ce("mat2x3",ge.f16,null),ce.mat2x4h=new ce("mat2x4",ge.f16,null),ce.mat3x2h=new ce("mat3x2",ge.f16,null),ce.mat3x3h=new ce("mat3x3",ge.f16,null),ce.mat3x4h=new ce("mat3x4",ge.f16,null),ce.mat4x2h=new ce("mat4x2",ge.f16,null),ce.mat4x3h=new ce("mat4x3",ge.f16,null),ce.mat4x4h=new ce("mat4x4",ge.f16,null),ce.mat2x2i=new ce("mat2x2",ge.i32,null),ce.mat2x3i=new ce("mat2x3",ge.i32,null),ce.mat2x4i=new ce("mat2x4",ge.i32,null),ce.mat3x2i=new ce("mat3x2",ge.i32,null),ce.mat3x3i=new ce("mat3x3",ge.i32,null),ce.mat3x4i=new ce("mat3x4",ge.i32,null),ce.mat4x2i=new ce("mat4x2",ge.i32,null),ce.mat4x3i=new ce("mat4x3",ge.i32,null),ce.mat4x4i=new ce("mat4x4",ge.i32,null),ce.mat2x2u=new ce("mat2x2",ge.u32,null),ce.mat2x3u=new ce("mat2x3",ge.u32,null),ce.mat2x4u=new ce("mat2x4",ge.u32,null),ce.mat3x2u=new ce("mat3x2",ge.u32,null),ce.mat3x3u=new ce("mat3x3",ge.u32,null),ce.mat3x4u=new ce("mat3x4",ge.u32,null),ce.mat4x2u=new ce("mat4x2",ge.u32,null),ce.mat4x3u=new ce("mat4x3",ge.u32,null),ce.mat4x4u=new ce("mat4x4",ge.u32,null);class sh extends ge{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class nA extends ge{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Nc extends ge{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class ci extends jr{constructor(){super(),this.postfix=null}}class Go extends ci{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class wi extends ci{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(const n of this.args)n.search(e)}constEvaluate(e,n){return n&&(n[0]=this.type),e.evalExpression(this,e.context)}}class x1 extends ci{constructor(e,n){super(),this.cachedReturnValue=null,this.name=e,this.args=n}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return JC.has(this.name)}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){for(const n of this.args)n.search(e);e(this)}}class fr extends ci{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,n){return e.evalExpression(this,e.context)}}class uP extends ci{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}constEvaluate(e,n){if(this.initializer){const r=e.evalExpression(this.initializer,e.context);return r!==null&&this.postfix?r.getSubData(e,this.postfix,e.context):r}return null}search(e){this.initializer.search(e)}}class rn extends ci{constructor(e,n){super(),this.value=e,this.type=n}get astNodeType(){return"literalExpr"}constEvaluate(e,n){return n!==void 0&&(n[0]=this.type),this.value}get isScalar(){return this.value instanceof re}get isVector(){return this.value instanceof Q||this.value instanceof We}get scalarValue(){return this.value instanceof re?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof Q||this.value instanceof We?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class fP extends ci{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class zl extends ci{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class hP extends ci{constructor(){super()}}class en extends hP{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class Yr extends hP{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}_getPromotedType(e,n){return e.name===n.name?e:e.name==="f32"||n.name==="f32"?ge.f32:e.name==="u32"||n.name==="u32"?ge.u32:ge.i32}constEvaluate(e,n){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class dP extends jr{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class oh extends ci{constructor(){super()}get astNodeType(){return"default"}}class pP extends dP{constructor(e,n){super(n),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class gP extends dP{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class Y3 extends jr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class KF extends jr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class q3 extends jr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}class mP extends jr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}}class $r{constructor(e,n){this.parent=null,this.typeInfo=e,this.parent=n,this.id=$r._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,n,r,i){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,n,r){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}$r._id=0;class i_ extends $r{constructor(){super(new Nr("void",null),null)}toString(){return"void"}}i_.void=new i_;class Ma extends $r{constructor(e){super(new n_("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,n,r,i){this.reference.setDataValue(e,n,r,i)}getSubData(e,n,r){return n?this.reference.getSubData(e,n,r):this}toString(){return`&${this.reference.toString()}`}}class re extends $r{constructor(e,n,r=null){super(n,r),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:this.typeInfo.name==="x32"?e-Math.floor(e)!==0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):this.typeInfo.name==="i32"||this.typeInfo.name==="bool"?this.data=new Int32Array([e]):this.typeInfo.name==="u32"?this.data=new Uint32Array([e]):this.typeInfo.name==="f32"||this.typeInfo.name==="f16"?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",n)}clone(){if(this.data instanceof Float32Array)return new re(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new re(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new re(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,n,r,i){if(r)return void console.error("SetDataValue: Scalar data does not support postfix",r);if(!(n instanceof re))return void console.error("SetDataValue: Invalid value",n);let s=n.data[0];this.typeInfo.name==="i32"||this.typeInfo.name==="u32"?s=Math.floor(s):this.typeInfo.name==="bool"&&(s=s?1:0),this.data[0]=s}getSubData(e,n,r){return n?(console.error("getSubData: Scalar data does not support postfix",n),null):this}toString(){return`${this.value}`}}function GF(t,e,n){const r=e.length;return r===2?n==="f32"?new Q(new Float32Array(e),t.getTypeInfo("vec2f")):n==="i32"||n==="bool"?new Q(new Int32Array(e),t.getTypeInfo("vec2i")):n==="u32"?new Q(new Uint32Array(e),t.getTypeInfo("vec2u")):n==="f16"?new Q(new Float32Array(e),t.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${n}`),null):r===3?n==="f32"?new Q(new Float32Array(e),t.getTypeInfo("vec3f")):n==="i32"||n==="bool"?new Q(new Int32Array(e),t.getTypeInfo("vec3i")):n==="u32"?new Q(new Uint32Array(e),t.getTypeInfo("vec3u")):n==="f16"?new Q(new Float32Array(e),t.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${n}`),null):r===4?n==="f32"?new Q(new Float32Array(e),t.getTypeInfo("vec4f")):n==="i32"||n==="bool"?new Q(new Int32Array(e),t.getTypeInfo("vec4i")):n==="u32"?new Q(new Uint32Array(e),t.getTypeInfo("vec4u")):n==="f16"?new Q(new Float32Array(e),t.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${n}`),null):(console.error(`getSubData: Invalid vector size ${e.length}`),null)}class Q extends $r{constructor(e,n,r=null){if(super(n,r),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const i=this.typeInfo.name;i==="vec2f"||i==="vec3f"||i==="vec4f"?this.data=new Float32Array(e):i==="vec2i"||i==="vec3i"||i==="vec4i"?this.data=new Int32Array(e):i==="vec2u"||i==="vec3u"||i==="vec4u"?this.data=new Uint32Array(e):i==="vec2h"||i==="vec3h"||i==="vec4h"?this.data=new Float32Array(e):i==="vec2b"||i==="vec3b"||i==="vec4b"?this.data=new Int32Array(e):i==="vec2"||i==="vec3"||i==="vec4"?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${i}`)}}clone(){if(this.data instanceof Float32Array)return new Q(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new Q(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new Q(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,n,r,i){r instanceof Go?console.error("TODO: Set vector postfix"):n instanceof Q?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;let i=e.getTypeInfo("f32");if(this.typeInfo instanceof Ko)i=this.typeInfo.format||i;else{const o=this.typeInfo.name;o==="vec2f"||o==="vec3f"||o==="vec4f"?i=e.getTypeInfo("f32"):o==="vec2i"||o==="vec3i"||o==="vec4i"?i=e.getTypeInfo("i32"):o==="vec2b"||o==="vec3b"||o==="vec4b"?i=e.getTypeInfo("bool"):o==="vec2u"||o==="vec3u"||o==="vec4u"?i=e.getTypeInfo("u32"):o==="vec2h"||o==="vec3h"||o==="vec4h"?i=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${o}`)}let s=this;for(;n!==null&&s!==null;){if(n instanceof zl){const o=n.index;let a=-1;if(o instanceof rn){if(!(o.value instanceof re))return console.error(`GetSubData: Invalid array index ${o.value}`),null;a=o.value.value}else{const u=e.evalExpression(o,r);if(!(u instanceof re))return console.error("GetSubData: Unknown index type",o),null;a=u.value}if(a<0||a>=s.data.length)return console.error("GetSubData: Index out of range",a),null;if(s.data instanceof Float32Array){const u=new Float32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new re(u,i)}if(s.data instanceof Int32Array){const u=new Int32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new re(u,i)}if(s.data instanceof Uint32Array){const u=new Uint32Array(s.data.buffer,s.data.byteOffset+4*a,1);return new re(u,i)}throw"GetSubData: Invalid data type"}if(!(n instanceof Go))return console.error("GetSubData: Unknown postfix",n),null;{const o=n.value.toLowerCase();if(o.length===1){let u=0;if(o==="x"||o==="r")u=0;else if(o==="y"||o==="g")u=1;else if(o==="z"||o==="b")u=2;else{if(o!=="w"&&o!=="a")return console.error(`GetSubData: Unknown member ${o}`),null;u=3}if(this.data instanceof Float32Array){let h=new Float32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new re(h,i,this)}if(this.data instanceof Int32Array){let h=new Int32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new re(h,i,this)}if(this.data instanceof Uint32Array){let h=new Uint32Array(this.data.buffer,this.data.byteOffset+4*u,1);return new re(h,i,this)}}const a=[];for(const u of o)u==="x"||u==="r"?a.push(this.data[0]):u==="y"||u==="g"?a.push(this.data[1]):u==="z"||u==="b"?a.push(this.data[2]):u==="w"||u==="a"?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${u}`);s=GF(e,a,i.name)}n=n.postfix}return s}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class We extends $r{constructor(e,n,r=null){super(n,r),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new We(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,n,r,i){r instanceof Go?console.error("TODO: Set matrix postfix"):n instanceof We?this.data=n.data:console.error("SetDataValue: Invalid value",n)}getSubData(e,n,r){if(n===null)return this;const i=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof Ko)this.typeInfo.format;else if(i.endsWith("f"))e.getTypeInfo("f32");else if(i.endsWith("i"))e.getTypeInfo("i32");else if(i.endsWith("u"))e.getTypeInfo("u32");else{if(!i.endsWith("h"))return console.error(`GetDataValue: Unknown type ${i}`),null;e.getTypeInfo("f16")}if(n instanceof zl){const s=n.index;let o=-1;if(s instanceof rn){if(!(s.value instanceof re))return console.error(`GetDataValue: Invalid array index ${s.value}`),null;o=s.value.value}else{const h=e.evalExpression(s,r);if(!(h instanceof re))return console.error("GetDataValue: Unknown index type",s),null;o=h.value}if(o<0||o>=this.data.length)return console.error("GetDataValue: Index out of range",o),null;const a=i.endsWith("h")?"h":"f";let u;if(i==="mat2x2"||i==="mat2x2f"||i==="mat2x2h"||i==="mat3x2"||i==="mat3x2f"||i==="mat3x2h"||i==="mat4x2"||i==="mat4x2f"||i==="mat4x2h")u=new Q(new Float32Array(this.data.buffer,this.data.byteOffset+2*o*4,2),e.getTypeInfo(`vec2${a}`));else if(i==="mat2x3"||i==="mat2x3f"||i==="mat2x3h"||i==="mat3x3"||i==="mat3x3f"||i==="mat3x3h"||i==="mat4x3"||i==="mat4x3f"||i==="mat4x3h")u=new Q(new Float32Array(this.data.buffer,this.data.byteOffset+3*o*4,3),e.getTypeInfo(`vec3${a}`));else{if(i!=="mat2x4"&&i!=="mat2x4f"&&i!=="mat2x4h"&&i!=="mat3x4"&&i!=="mat3x4f"&&i!=="mat3x4h"&&i!=="mat4x4"&&i!=="mat4x4f"&&i!=="mat4x4h")return console.error(`GetDataValue: Unknown type ${i}`),null;u=new Q(new Float32Array(this.data.buffer,this.data.byteOffset+4*o*4,4),e.getTypeInfo(`vec4${a}`))}return n.postfix?u.getSubData(e,n.postfix,r):u}return console.error("GetDataValue: Invalid postfix",n),null}toString(){let e=`${this.data[0]}`;for(let n=1;n<this.data.length;++n)e+=`, ${this.data[n]}`;return e}}class Yt extends $r{constructor(e,n,r=0,i=null){super(n,i),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=r}clone(){const e=new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size));return new Yt(e.buffer,this.typeInfo,0,null)}setDataValue(e,n,r,i){if(n===null)return void console.log("setDataValue: NULL data.");let s=this.offset,o=this.typeInfo;for(;r;){if(r instanceof zl)if(o instanceof ro){const a=r.index;if(a instanceof rn){if(!(a.value instanceof re))return void console.error(`SetDataValue: Invalid index type ${a.value}`);s+=a.value.value*o.stride}else{const u=e.evalExpression(a,i);if(!(u instanceof re))return void console.error("SetDataValue: Unknown index type",a);s+=u.value*o.stride}o=o.format}else console.error(`SetDataValue: Type ${o.getTypeName()} is not an array`);else{if(!(r instanceof Go))return void console.error("SetDataValue: Unknown postfix type",r);{const a=r.value;if(o instanceof $s){let u=!1;for(const h of o.members)if(h.name===a){s+=h.offset,o=h.type,u=!0;break}if(!u)return void console.error(`SetDataValue: Member ${a} not found`)}else if(o instanceof Nr){const u=o.getTypeName();let h=0;if(a==="x"||a==="r")h=0;else if(a==="y"||a==="g")h=1;else if(a==="z"||a==="b")h=2;else{if(a!=="w"&&a!=="a")return void console.error(`SetDataValue: Unknown member ${a}`);h=3}if(!(n instanceof re))return void console.error("SetDataValue: Invalid value",n);const p=n.value;return u==="vec2f"?void(new Float32Array(this.buffer,s,2)[h]=p):u==="vec3f"?void(new Float32Array(this.buffer,s,3)[h]=p):u==="vec4f"?void(new Float32Array(this.buffer,s,4)[h]=p):u==="vec2i"?void(new Int32Array(this.buffer,s,2)[h]=p):u==="vec3i"?void(new Int32Array(this.buffer,s,3)[h]=p):u==="vec4i"?void(new Int32Array(this.buffer,s,4)[h]=p):u==="vec2u"?void(new Uint32Array(this.buffer,s,2)[h]=p):u==="vec3u"?void(new Uint32Array(this.buffer,s,3)[h]=p):u==="vec4u"?void(new Uint32Array(this.buffer,s,4)[h]=p):void console.error(`SetDataValue: Type ${u} is not a struct`)}}}r=r.postfix}this.setData(e,n,o,s,i)}setData(e,n,r,i,s){const o=r.getTypeName();if(o!=="f32"&&o!=="f16")if(o!=="i32"&&o!=="atomic<i32>"&&o!=="x32")if(o!=="u32"&&o!=="atomic<u32>")if(o!=="bool"){if(o==="vec2f"||o==="vec2h"){const a=new Float32Array(this.buffer,i,2);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3f"||o==="vec3h"){const a=new Float32Array(this.buffer,i,3);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4f"||o==="vec4h"){const a=new Float32Array(this.buffer,i,4);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="vec2i"){const a=new Int32Array(this.buffer,i,2);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3i"){const a=new Int32Array(this.buffer,i,3);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4i"){const a=new Int32Array(this.buffer,i,4);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="vec2u"){const a=new Uint32Array(this.buffer,i,2);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3u"){const a=new Uint32Array(this.buffer,i,3);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4u"){const a=new Uint32Array(this.buffer,i,4);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="vec2b"){const a=new Uint32Array(this.buffer,i,2);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1]):(a[0]=n[0],a[1]=n[1]))}if(o==="vec3b"){const a=new Uint32Array(this.buffer,i,3);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2]):(a[0]=n[0],a[1]=n[1],a[2]=n[2]))}if(o==="vec4b"){const a=new Uint32Array(this.buffer,i,4);return void(n instanceof Q?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="mat2x2f"||o==="mat2x2h"){const a=new Float32Array(this.buffer,i,4);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3]))}if(o==="mat2x3f"||o==="mat2x3h"){const a=new Float32Array(this.buffer,i,6);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5]))}if(o==="mat2x4f"||o==="mat2x4h"){const a=new Float32Array(this.buffer,i,8);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7]))}if(o==="mat3x2f"||o==="mat3x2h"){const a=new Float32Array(this.buffer,i,6);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5]))}if(o==="mat3x3f"||o==="mat3x3h"){const a=new Float32Array(this.buffer,i,9);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8]))}if(o==="mat3x4f"||o==="mat3x4h"){const a=new Float32Array(this.buffer,i,12);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]))}if(o==="mat4x2f"||o==="mat4x2h"){const a=new Float32Array(this.buffer,i,8);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7]))}if(o==="mat4x3f"||o==="mat4x3h"){const a=new Float32Array(this.buffer,i,12);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11]))}if(o==="mat4x4f"||o==="mat4x4h"){const a=new Float32Array(this.buffer,i,16);return void(n instanceof We?(a[0]=n.data[0],a[1]=n.data[1],a[2]=n.data[2],a[3]=n.data[3],a[4]=n.data[4],a[5]=n.data[5],a[6]=n.data[6],a[7]=n.data[7],a[8]=n.data[8],a[9]=n.data[9],a[10]=n.data[10],a[11]=n.data[11],a[12]=n.data[12],a[13]=n.data[13],a[14]=n.data[14],a[15]=n.data[15]):(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]))}if(n instanceof Yt){if(r===n.typeInfo)return void new Uint8Array(this.buffer,i,n.buffer.byteLength).set(new Uint8Array(n.buffer));console.error("SetDataValue: Type mismatch",o,n.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${o}`)}else n instanceof re&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof re&&(new Uint32Array(this.buffer,i,1)[0]=n.value);else n instanceof re&&(new Int32Array(this.buffer,i,1)[0]=n.value);else n instanceof re&&(new Float32Array(this.buffer,i,1)[0]=n.value)}getSubData(e,n,r){var i,s,o;if(n===null)return this;let a=this.offset,u=this.typeInfo;for(;n;){if(n instanceof zl){const p=n.index,_=p instanceof ci?e.evalExpression(p,r):p;let v=0;if(_ instanceof re?v=_.value:typeof _=="number"?v=_:console.error("GetDataValue: Invalid index type",p),u instanceof ro)a+=v*u.stride,u=u.format;else{const b=u.getTypeName();b==="mat4x4"||b==="mat4x4f"||b==="mat4x4h"?(a+=16*v,u=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${u.getTypeName()} is not an array`)}}else{if(!(n instanceof Go))return console.error("GetDataValue: Unknown postfix type",n),null;{const p=n.value;if(u instanceof $s){let _=!1;for(const v of u.members)if(v.name===p){a+=v.offset,u=v.type,_=!0;break}if(!_)return console.error(`GetDataValue: Member ${p} not found`),null}else if(u instanceof Nr){const _=u.getTypeName();if(_==="vec2f"||_==="vec3f"||_==="vec4f"||_==="vec2i"||_==="vec3i"||_==="vec4i"||_==="vec2u"||_==="vec3u"||_==="vec4u"||_==="vec2b"||_==="vec3b"||_==="vec4b"||_==="vec2h"||_==="vec3h"||_==="vec4h"||_==="vec2"||_==="vec3"||_==="vec4"){if(p.length>0&&p.length<5){let v="f";const b=[];for(let E=0;E<p.length;++E){const R=p[E].toLowerCase();let D=0;if(R==="x"||R==="r")D=0;else if(R==="y"||R==="g")D=1;else if(R==="z"||R==="b")D=2;else{if(R!=="w"&&R!=="a")return console.error(`Unknown member ${p}`),null;D=3}if(p.length===1){if(_.endsWith("f"))return this.buffer.byteLength<a+4*D+4?(console.log("Insufficient buffer data"),null):new re(new Float32Array(this.buffer,a+4*D,1),e.getTypeInfo("f32"),this);if(_.endsWith("h"))return new re(new Float32Array(this.buffer,a+4*D,1),e.getTypeInfo("f16"),this);if(_.endsWith("i"))return new re(new Int32Array(this.buffer,a+4*D,1),e.getTypeInfo("i32"),this);if(_.endsWith("b"))return new re(new Int32Array(this.buffer,a+4*D,1),e.getTypeInfo("bool"),this);if(_.endsWith("u"))return new re(new Uint32Array(this.buffer,a+4*D,1),e.getTypeInfo("i32"),this)}if(_==="vec2f")b.push(new Float32Array(this.buffer,a,2)[D]);else if(_==="vec3f"){if(a+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;const P=new Float32Array(this.buffer,a,3);b.push(P[D])}else if(_==="vec4f")b.push(new Float32Array(this.buffer,a,4)[D]);else if(_==="vec2i")v="i",b.push(new Int32Array(this.buffer,a,2)[D]);else if(_==="vec3i")v="i",b.push(new Int32Array(this.buffer,a,3)[D]);else if(_==="vec4i")v="i",b.push(new Int32Array(this.buffer,a,4)[D]);else if(_==="vec2u"){v="u";const P=new Uint32Array(this.buffer,a,2);b.push(P[D])}else _==="vec3u"?(v="u",b.push(new Uint32Array(this.buffer,a,3)[D])):_==="vec4u"&&(v="u",b.push(new Uint32Array(this.buffer,a,4)[D]))}return b.length===2?u=e.getTypeInfo(`vec2${v}`):b.length===3?u=e.getTypeInfo(`vec3${v}`):b.length===4?u=e.getTypeInfo(`vec4${v}`):console.error(`GetDataValue: Invalid vector length ${b.length}`),new Q(b,u,null)}return console.error(`GetDataValue: Unknown member ${p}`),null}return console.error(`GetDataValue: Type ${_} is not a struct`),null}}}n=n.postfix}const h=u.getTypeName();return h==="f32"?new re(new Float32Array(this.buffer,a,1),u,this):h==="i32"?new re(new Int32Array(this.buffer,a,1),u,this):h==="u32"?new re(new Uint32Array(this.buffer,a,1),u,this):h==="vec2f"?new Q(new Float32Array(this.buffer,a,2),u,this):h==="vec3f"?new Q(new Float32Array(this.buffer,a,3),u,this):h==="vec4f"?new Q(new Float32Array(this.buffer,a,4),u,this):h==="vec2i"?new Q(new Int32Array(this.buffer,a,2),u,this):h==="vec3i"?new Q(new Int32Array(this.buffer,a,3),u,this):h==="vec4i"?new Q(new Int32Array(this.buffer,a,4),u,this):h==="vec2u"?new Q(new Uint32Array(this.buffer,a,2),u,this):h==="vec3u"?new Q(new Uint32Array(this.buffer,a,3),u,this):h==="vec4u"?new Q(new Uint32Array(this.buffer,a,4),u,this):u instanceof Ko&&u.name==="atomic"?((i=u.format)===null||i===void 0?void 0:i.name)==="u32"?new re(new Uint32Array(this.buffer,a,1)[0],u.format,this):((s=u.format)===null||s===void 0?void 0:s.name)==="i32"?new re(new Int32Array(this.buffer,a,1)[0],u.format,this):(console.error(`GetDataValue: Invalid atomic format ${(o=u.format)===null||o===void 0?void 0:o.name}`),null):new Yt(this.buffer,u,a,this)}toString(){let e="";if(this.typeInfo instanceof ro)if(this.typeInfo.format.name==="f32"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="i32"){const n=new Int32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="u32"){const n=new Uint32Array(this.buffer,this.offset);e=`[${n[0]}`;for(let r=1;r<n.length;++r)e+=`, ${n[r]}`}else if(this.typeInfo.format.name==="vec2f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}]`;for(let r=1;r<n.length/2;++r)e+=`, [${n[2*r]}, ${n[2*r+1]}]`}else if(this.typeInfo.format.name==="vec3f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}]`}else if(this.typeInfo.format.name==="vec4f"){const n=new Float32Array(this.buffer,this.offset);e=`[${n[0]}, ${n[1]}, ${n[2]}, ${n[3]}]`;for(let r=4;r<n.length;r+=4)e+=`, [${n[r]}, ${n[r+1]}, ${n[r+2]}, ${n[r+3]}]`}else e="[...]";else this.typeInfo instanceof $s?e+="{...}":e="[...]";return e}}class Hi extends $r{constructor(e,n,r,i){super(n,null),this.data=e,this.descriptor=r,this.view=i}clone(){return new Hi(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>0?(e=r[0])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.width)!==null&&n!==void 0?n:0}get height(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>1?(e=r[1])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.height)!==null&&n!==void 0?n:0}get depthOrArrayLayers(){var e,n;const r=this.descriptor.size;return r instanceof Array&&r.length>2?(e=r[2])!==null&&e!==void 0?e:0:r instanceof Object&&(n=r.depthOrArrayLayers)!==null&&n!==void 0?n:0}get format(){var e;return this.descriptor&&(e=this.descriptor.format)!==null&&e!==void 0?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&(e=this.descriptor.sampleCount)!==null&&e!==void 0?e:1}get mipLevelCount(){var e;return this.descriptor&&(e=this.descriptor.mipLevelCount)!==null&&e!==void 0?e:1}get dimension(){var e;return this.descriptor&&(e=this.descriptor.dimension)!==null&&e!==void 0?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];const n=[this.width,this.height,this.depthOrArrayLayers];for(let r=0;r<n.length;++r)n[r]=Math.max(1,n[r]>>e);return n}get texelByteSize(){const e=this.format,n=Gp[e];return n?n.isDepthStencil?4:n.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){const e=this.format,n=Gp[e];return!!n&&n.isDepthStencil}getGpuSize(){const e=this.format,n=Gp[e],r=this.width;if(!e||r<=0||!n)return-1;const i=this.height,s=this.depthOrArrayLayers,o=this.dimension;return r/n.blockWidth*(o==="1d"?1:i/n.blockHeight)*n.bytesPerBlock*s}getPixel(e,n,r=0,i=0){const s=this.texelByteSize,o=this.bytesPerRow,a=this.height,u=this.data[i];return XF(new Uint8Array(u),e,n,r,i,a,o,s,this.format)}setPixel(e,n,r,i,s){const o=this.texelByteSize,a=this.bytesPerRow,u=this.height,h=this.data[i];(function(p,_,v,b,E,R,D,P,S,k){const M=b*(D>>=E)*(R>>=E)+v*D+_*P;switch(S){case"r8unorm":return void vt(p,M,"8unorm",1,k);case"r8snorm":return void vt(p,M,"8snorm",1,k);case"r8uint":return void vt(p,M,"8uint",1,k);case"r8sint":return void vt(p,M,"8sint",1,k);case"rg8unorm":return void vt(p,M,"8unorm",2,k);case"rg8snorm":return void vt(p,M,"8snorm",2,k);case"rg8uint":return void vt(p,M,"8uint",2,k);case"rg8sint":return void vt(p,M,"8sint",2,k);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return void vt(p,M,"8unorm",4,k);case"rgba8snorm":return void vt(p,M,"8snorm",4,k);case"rgba8uint":return void vt(p,M,"8uint",4,k);case"rgba8sint":return void vt(p,M,"8sint",4,k);case"r16uint":return void vt(p,M,"16uint",1,k);case"r16sint":return void vt(p,M,"16sint",1,k);case"r16float":return void vt(p,M,"16float",1,k);case"rg16uint":return void vt(p,M,"16uint",2,k);case"rg16sint":return void vt(p,M,"16sint",2,k);case"rg16float":return void vt(p,M,"16float",2,k);case"rgba16uint":return void vt(p,M,"16uint",4,k);case"rgba16sint":return void vt(p,M,"16sint",4,k);case"rgba16float":return void vt(p,M,"16float",4,k);case"r32uint":return void vt(p,M,"32uint",1,k);case"r32sint":return void vt(p,M,"32sint",1,k);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return void vt(p,M,"32float",1,k);case"rg32uint":return void vt(p,M,"32uint",2,k);case"rg32sint":return void vt(p,M,"32sint",2,k);case"rg32float":return void vt(p,M,"32float",2,k);case"rgba32uint":return void vt(p,M,"32uint",4,k);case"rgba32sint":return void vt(p,M,"32sint",4,k);case"rgba32float":return void vt(p,M,"32float",4,k);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}})(new Uint8Array(h),e,n,r,i,u,a,o,this.format,s)}}(t=>{t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(ie||(ie={}));class se{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class W{}fe=W,W.none=new se("",ie.reserved,""),W.eof=new se("EOF",ie.token,""),W.reserved={asm:new se("asm",ie.reserved,"asm"),bf16:new se("bf16",ie.reserved,"bf16"),do:new se("do",ie.reserved,"do"),enum:new se("enum",ie.reserved,"enum"),f16:new se("f16",ie.reserved,"f16"),f64:new se("f64",ie.reserved,"f64"),handle:new se("handle",ie.reserved,"handle"),i8:new se("i8",ie.reserved,"i8"),i16:new se("i16",ie.reserved,"i16"),i64:new se("i64",ie.reserved,"i64"),mat:new se("mat",ie.reserved,"mat"),premerge:new se("premerge",ie.reserved,"premerge"),regardless:new se("regardless",ie.reserved,"regardless"),typedef:new se("typedef",ie.reserved,"typedef"),u8:new se("u8",ie.reserved,"u8"),u16:new se("u16",ie.reserved,"u16"),u64:new se("u64",ie.reserved,"u64"),unless:new se("unless",ie.reserved,"unless"),using:new se("using",ie.reserved,"using"),vec:new se("vec",ie.reserved,"vec"),void:new se("void",ie.reserved,"void")},W.keywords={array:new se("array",ie.keyword,"array"),atomic:new se("atomic",ie.keyword,"atomic"),bool:new se("bool",ie.keyword,"bool"),f32:new se("f32",ie.keyword,"f32"),i32:new se("i32",ie.keyword,"i32"),mat2x2:new se("mat2x2",ie.keyword,"mat2x2"),mat2x3:new se("mat2x3",ie.keyword,"mat2x3"),mat2x4:new se("mat2x4",ie.keyword,"mat2x4"),mat3x2:new se("mat3x2",ie.keyword,"mat3x2"),mat3x3:new se("mat3x3",ie.keyword,"mat3x3"),mat3x4:new se("mat3x4",ie.keyword,"mat3x4"),mat4x2:new se("mat4x2",ie.keyword,"mat4x2"),mat4x3:new se("mat4x3",ie.keyword,"mat4x3"),mat4x4:new se("mat4x4",ie.keyword,"mat4x4"),ptr:new se("ptr",ie.keyword,"ptr"),sampler:new se("sampler",ie.keyword,"sampler"),sampler_comparison:new se("sampler_comparison",ie.keyword,"sampler_comparison"),struct:new se("struct",ie.keyword,"struct"),texture_1d:new se("texture_1d",ie.keyword,"texture_1d"),texture_2d:new se("texture_2d",ie.keyword,"texture_2d"),texture_2d_array:new se("texture_2d_array",ie.keyword,"texture_2d_array"),texture_3d:new se("texture_3d",ie.keyword,"texture_3d"),texture_cube:new se("texture_cube",ie.keyword,"texture_cube"),texture_cube_array:new se("texture_cube_array",ie.keyword,"texture_cube_array"),texture_multisampled_2d:new se("texture_multisampled_2d",ie.keyword,"texture_multisampled_2d"),texture_storage_1d:new se("texture_storage_1d",ie.keyword,"texture_storage_1d"),texture_storage_2d:new se("texture_storage_2d",ie.keyword,"texture_storage_2d"),texture_storage_2d_array:new se("texture_storage_2d_array",ie.keyword,"texture_storage_2d_array"),texture_storage_3d:new se("texture_storage_3d",ie.keyword,"texture_storage_3d"),texture_depth_2d:new se("texture_depth_2d",ie.keyword,"texture_depth_2d"),texture_depth_2d_array:new se("texture_depth_2d_array",ie.keyword,"texture_depth_2d_array"),texture_depth_cube:new se("texture_depth_cube",ie.keyword,"texture_depth_cube"),texture_depth_cube_array:new se("texture_depth_cube_array",ie.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new se("texture_depth_multisampled_2d",ie.keyword,"texture_depth_multisampled_2d"),texture_external:new se("texture_external",ie.keyword,"texture_external"),u32:new se("u32",ie.keyword,"u32"),vec2:new se("vec2",ie.keyword,"vec2"),vec3:new se("vec3",ie.keyword,"vec3"),vec4:new se("vec4",ie.keyword,"vec4"),bitcast:new se("bitcast",ie.keyword,"bitcast"),block:new se("block",ie.keyword,"block"),break:new se("break",ie.keyword,"break"),case:new se("case",ie.keyword,"case"),continue:new se("continue",ie.keyword,"continue"),continuing:new se("continuing",ie.keyword,"continuing"),default:new se("default",ie.keyword,"default"),diagnostic:new se("diagnostic",ie.keyword,"diagnostic"),discard:new se("discard",ie.keyword,"discard"),else:new se("else",ie.keyword,"else"),enable:new se("enable",ie.keyword,"enable"),fallthrough:new se("fallthrough",ie.keyword,"fallthrough"),false:new se("false",ie.keyword,"false"),fn:new se("fn",ie.keyword,"fn"),for:new se("for",ie.keyword,"for"),function:new se("function",ie.keyword,"function"),if:new se("if",ie.keyword,"if"),let:new se("let",ie.keyword,"let"),const:new se("const",ie.keyword,"const"),loop:new se("loop",ie.keyword,"loop"),while:new se("while",ie.keyword,"while"),private:new se("private",ie.keyword,"private"),read:new se("read",ie.keyword,"read"),read_write:new se("read_write",ie.keyword,"read_write"),return:new se("return",ie.keyword,"return"),requires:new se("requires",ie.keyword,"requires"),storage:new se("storage",ie.keyword,"storage"),switch:new se("switch",ie.keyword,"switch"),true:new se("true",ie.keyword,"true"),alias:new se("alias",ie.keyword,"alias"),type:new se("type",ie.keyword,"type"),uniform:new se("uniform",ie.keyword,"uniform"),var:new se("var",ie.keyword,"var"),override:new se("override",ie.keyword,"override"),workgroup:new se("workgroup",ie.keyword,"workgroup"),write:new se("write",ie.keyword,"write"),r8unorm:new se("r8unorm",ie.keyword,"r8unorm"),r8snorm:new se("r8snorm",ie.keyword,"r8snorm"),r8uint:new se("r8uint",ie.keyword,"r8uint"),r8sint:new se("r8sint",ie.keyword,"r8sint"),r16uint:new se("r16uint",ie.keyword,"r16uint"),r16sint:new se("r16sint",ie.keyword,"r16sint"),r16float:new se("r16float",ie.keyword,"r16float"),rg8unorm:new se("rg8unorm",ie.keyword,"rg8unorm"),rg8snorm:new se("rg8snorm",ie.keyword,"rg8snorm"),rg8uint:new se("rg8uint",ie.keyword,"rg8uint"),rg8sint:new se("rg8sint",ie.keyword,"rg8sint"),r32uint:new se("r32uint",ie.keyword,"r32uint"),r32sint:new se("r32sint",ie.keyword,"r32sint"),r32float:new se("r32float",ie.keyword,"r32float"),rg16uint:new se("rg16uint",ie.keyword,"rg16uint"),rg16sint:new se("rg16sint",ie.keyword,"rg16sint"),rg16float:new se("rg16float",ie.keyword,"rg16float"),rgba8unorm:new se("rgba8unorm",ie.keyword,"rgba8unorm"),rgba8unorm_srgb:new se("rgba8unorm_srgb",ie.keyword,"rgba8unorm_srgb"),rgba8snorm:new se("rgba8snorm",ie.keyword,"rgba8snorm"),rgba8uint:new se("rgba8uint",ie.keyword,"rgba8uint"),rgba8sint:new se("rgba8sint",ie.keyword,"rgba8sint"),bgra8unorm:new se("bgra8unorm",ie.keyword,"bgra8unorm"),bgra8unorm_srgb:new se("bgra8unorm_srgb",ie.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new se("rgb10a2unorm",ie.keyword,"rgb10a2unorm"),rg11b10float:new se("rg11b10float",ie.keyword,"rg11b10float"),rg32uint:new se("rg32uint",ie.keyword,"rg32uint"),rg32sint:new se("rg32sint",ie.keyword,"rg32sint"),rg32float:new se("rg32float",ie.keyword,"rg32float"),rgba16uint:new se("rgba16uint",ie.keyword,"rgba16uint"),rgba16sint:new se("rgba16sint",ie.keyword,"rgba16sint"),rgba16float:new se("rgba16float",ie.keyword,"rgba16float"),rgba32uint:new se("rgba32uint",ie.keyword,"rgba32uint"),rgba32sint:new se("rgba32sint",ie.keyword,"rgba32sint"),rgba32float:new se("rgba32float",ie.keyword,"rgba32float"),static_assert:new se("static_assert",ie.keyword,"static_assert")},W.tokens={decimal_float_literal:new se("decimal_float_literal",ie.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new se("hex_float_literal",ie.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new se("int_literal",ie.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new se("uint_literal",ie.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new se("name",ie.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new se("ident",ie.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new se("and",ie.token,"&"),and_and:new se("and_and",ie.token,"&&"),arrow:new se("arrow ",ie.token,"->"),attr:new se("attr",ie.token,"@"),forward_slash:new se("forward_slash",ie.token,"/"),bang:new se("bang",ie.token,"!"),bracket_left:new se("bracket_left",ie.token,"["),bracket_right:new se("bracket_right",ie.token,"]"),brace_left:new se("brace_left",ie.token,"{"),brace_right:new se("brace_right",ie.token,"}"),colon:new se("colon",ie.token,":"),comma:new se("comma",ie.token,","),equal:new se("equal",ie.token,"="),equal_equal:new se("equal_equal",ie.token,"=="),not_equal:new se("not_equal",ie.token,"!="),greater_than:new se("greater_than",ie.token,">"),greater_than_equal:new se("greater_than_equal",ie.token,">="),shift_right:new se("shift_right",ie.token,">>"),less_than:new se("less_than",ie.token,"<"),less_than_equal:new se("less_than_equal",ie.token,"<="),shift_left:new se("shift_left",ie.token,"<<"),modulo:new se("modulo",ie.token,"%"),minus:new se("minus",ie.token,"-"),minus_minus:new se("minus_minus",ie.token,"--"),period:new se("period",ie.token,"."),plus:new se("plus",ie.token,"+"),plus_plus:new se("plus_plus",ie.token,"++"),or:new se("or",ie.token,"|"),or_or:new se("or_or",ie.token,"||"),paren_left:new se("paren_left",ie.token,"("),paren_right:new se("paren_right",ie.token,")"),semicolon:new se("semicolon",ie.token,";"),star:new se("star",ie.token,"*"),tilde:new se("tilde",ie.token,"~"),underscore:new se("underscore",ie.token,"_"),xor:new se("xor",ie.token,"^"),plus_equal:new se("plus_equal",ie.token,"+="),minus_equal:new se("minus_equal",ie.token,"-="),times_equal:new se("times_equal",ie.token,"*="),division_equal:new se("division_equal",ie.token,"/="),modulo_equal:new se("modulo_equal",ie.token,"%="),and_equal:new se("and_equal",ie.token,"&="),or_equal:new se("or_equal",ie.token,"|="),xor_equal:new se("xor_equal",ie.token,"^="),shift_right_equal:new se("shift_right_equal",ie.token,">>="),shift_left_equal:new se("shift_left_equal",ie.token,"<<=")},W.simpleTokens={"@":fe.tokens.attr,"{":fe.tokens.brace_left,"}":fe.tokens.brace_right,":":fe.tokens.colon,",":fe.tokens.comma,"(":fe.tokens.paren_left,")":fe.tokens.paren_right,";":fe.tokens.semicolon},W.literalTokens={"&":fe.tokens.and,"&&":fe.tokens.and_and,"->":fe.tokens.arrow,"/":fe.tokens.forward_slash,"!":fe.tokens.bang,"[":fe.tokens.bracket_left,"]":fe.tokens.bracket_right,"=":fe.tokens.equal,"==":fe.tokens.equal_equal,"!=":fe.tokens.not_equal,">":fe.tokens.greater_than,">=":fe.tokens.greater_than_equal,">>":fe.tokens.shift_right,"<":fe.tokens.less_than,"<=":fe.tokens.less_than_equal,"<<":fe.tokens.shift_left,"%":fe.tokens.modulo,"-":fe.tokens.minus,"--":fe.tokens.minus_minus,".":fe.tokens.period,"+":fe.tokens.plus,"++":fe.tokens.plus_plus,"|":fe.tokens.or,"||":fe.tokens.or_or,"*":fe.tokens.star,"~":fe.tokens.tilde,_:fe.tokens.underscore,"^":fe.tokens.xor,"+=":fe.tokens.plus_equal,"-=":fe.tokens.minus_equal,"*=":fe.tokens.times_equal,"/=":fe.tokens.division_equal,"%=":fe.tokens.modulo_equal,"&=":fe.tokens.and_equal,"|=":fe.tokens.or_equal,"^=":fe.tokens.xor_equal,">>=":fe.tokens.shift_right_equal,"<<=":fe.tokens.shift_left_equal},W.regexTokens={decimal_float_literal:fe.tokens.decimal_float_literal,hex_float_literal:fe.tokens.hex_float_literal,int_literal:fe.tokens.int_literal,uint_literal:fe.tokens.uint_literal,ident:fe.tokens.ident},W.storage_class=[fe.keywords.function,fe.keywords.private,fe.keywords.workgroup,fe.keywords.uniform,fe.keywords.storage],W.access_mode=[fe.keywords.read,fe.keywords.write,fe.keywords.read_write],W.sampler_type=[fe.keywords.sampler,fe.keywords.sampler_comparison],W.sampled_texture_type=[fe.keywords.texture_1d,fe.keywords.texture_2d,fe.keywords.texture_2d_array,fe.keywords.texture_3d,fe.keywords.texture_cube,fe.keywords.texture_cube_array],W.multisampled_texture_type=[fe.keywords.texture_multisampled_2d],W.storage_texture_type=[fe.keywords.texture_storage_1d,fe.keywords.texture_storage_2d,fe.keywords.texture_storage_2d_array,fe.keywords.texture_storage_3d],W.depth_texture_type=[fe.keywords.texture_depth_2d,fe.keywords.texture_depth_2d_array,fe.keywords.texture_depth_cube,fe.keywords.texture_depth_cube_array,fe.keywords.texture_depth_multisampled_2d],W.texture_external_type=[fe.keywords.texture_external],W.any_texture_type=[...fe.sampled_texture_type,...fe.multisampled_texture_type,...fe.storage_texture_type,...fe.depth_texture_type,...fe.texture_external_type],W.texel_format=[fe.keywords.r8unorm,fe.keywords.r8snorm,fe.keywords.r8uint,fe.keywords.r8sint,fe.keywords.r16uint,fe.keywords.r16sint,fe.keywords.r16float,fe.keywords.rg8unorm,fe.keywords.rg8snorm,fe.keywords.rg8uint,fe.keywords.rg8sint,fe.keywords.r32uint,fe.keywords.r32sint,fe.keywords.r32float,fe.keywords.rg16uint,fe.keywords.rg16sint,fe.keywords.rg16float,fe.keywords.rgba8unorm,fe.keywords.rgba8unorm_srgb,fe.keywords.rgba8snorm,fe.keywords.rgba8uint,fe.keywords.rgba8sint,fe.keywords.bgra8unorm,fe.keywords.bgra8unorm_srgb,fe.keywords.rgb10a2unorm,fe.keywords.rg11b10float,fe.keywords.rg32uint,fe.keywords.rg32sint,fe.keywords.rg32float,fe.keywords.rgba16uint,fe.keywords.rgba16sint,fe.keywords.rgba16float,fe.keywords.rgba32uint,fe.keywords.rgba32sint,fe.keywords.rgba32float],W.const_literal=[fe.tokens.int_literal,fe.tokens.uint_literal,fe.tokens.decimal_float_literal,fe.tokens.hex_float_literal,fe.keywords.true,fe.keywords.false],W.literal_or_ident=[fe.tokens.ident,fe.tokens.int_literal,fe.tokens.uint_literal,fe.tokens.decimal_float_literal,fe.tokens.hex_float_literal,fe.tokens.name],W.element_count_expression=[fe.tokens.int_literal,fe.tokens.uint_literal,fe.tokens.ident],W.template_types=[fe.keywords.vec2,fe.keywords.vec3,fe.keywords.vec4,fe.keywords.mat2x2,fe.keywords.mat2x3,fe.keywords.mat2x4,fe.keywords.mat3x2,fe.keywords.mat3x3,fe.keywords.mat3x4,fe.keywords.mat4x2,fe.keywords.mat4x3,fe.keywords.mat4x4,fe.keywords.atomic,fe.keywords.bitcast,...fe.any_texture_type],W.attribute_name=[fe.tokens.ident,fe.keywords.block,fe.keywords.diagnostic],W.assignment_operators=[fe.tokens.equal,fe.tokens.plus_equal,fe.tokens.minus_equal,fe.tokens.times_equal,fe.tokens.division_equal,fe.tokens.modulo_equal,fe.tokens.and_equal,fe.tokens.or_equal,fe.tokens.xor_equal,fe.tokens.shift_right_equal,fe.tokens.shift_left_equal],W.increment_operators=[fe.tokens.plus_plus,fe.tokens.minus_minus];class Z3{constructor(e,n,r,i,s){this.type=e,this.lexeme=n,this.line=r,this.start=i,this.end=s}toString(){return this.lexeme}isTemplateType(){return W.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==W.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class JF{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new Z3(W.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=W.simpleTokens[e];if(n)return this._addToken(n),!0;let r=W.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=W.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(W.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e=="-"&&this._tokens.length>0){if(a=="=")return this._current++,e+=a,this._addToken(W.tokens.minus_equal),!0;if(a=="-")return this._current++,e+=a,this._addToken(W.tokens.minus_minus),!0;const u=this._tokens.length-1;if((W.literal_or_ident.indexOf(this._tokens[u].type)!=-1||this._tokens[u].type==W.tokens.paren_right)&&a!=">")return this._addToken(o),!0}if(e==">"&&(a==">"||a=="=")){let u=!1,h=this._tokens.length-1;for(let p=0;p<5&&h>=0&&W.assignment_operators.indexOf(this._tokens[h].type)===-1;++p,--h)if(this._tokens[h].type===W.tokens.less_than){h>0&&this._tokens[h-1].isArrayOrTemplateType()&&(u=!0);break}if(u)return this._addToken(o),!0}if(o===W.none){let u=e,h=0;const p=2;for(let _=0;_<p;++_)if(u+=this._peekAhead(_),o=this._findType(u),o!==W.none){h=_;break}if(o===W.none)return r!==W.none&&(this._current--,this._addToken(r),!0);e=u,this._current+=h+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r!==W.none&&(this._addToken(r),!0)}_findType(e){for(const r in W.regexTokens){const i=W.regexTokens[r];if(this._match(e,i.rule))return i}return W.literalTokens[e]||W.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&e!=="_"&&e!=="."&&e!=="("&&e!==")"&&e!=="["&&e!=="]"&&e!=="{"&&e!=="}"&&e!==","&&e!==";"&&e!==":"&&e!=="="&&e!=="!"&&e!=="<"&&e!==">"&&e!=="+"&&e!=="-"&&e!=="*"&&e!=="/"&&e!=="%"&&e!=="&"&&e!=="|"&&e!=="^"&&e!=="~"&&e!=="@"&&e!=="#"&&e!=="?"&&e!=="'"&&e!=="`"&&e!=='"'&&e!=="\\"&&e!==`
`&&e!=="\r"&&e!=="	"&&e!=="\0"}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||e==="_"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new Z3(e,n,this._line,this._start,this._current))}}function ke(t){return Array.isArray(t)||(t==null?void 0:t.buffer)instanceof ArrayBuffer}const A0=new Float32Array(1),e7=new Uint32Array(A0.buffer),t7=new Uint32Array(A0.buffer),u0=new Int32Array(1),n7=new Float32Array(u0.buffer),r7=new Uint32Array(u0.buffer),f0=new Uint32Array(1),i7=new Float32Array(f0.buffer),s7=new Int32Array(f0.buffer);function K3(t,e,n){if(e===n)return t;if(e==="f32"){if(n==="i32"||n==="x32")return A0[0]=t,e7[0];if(n==="u32")return A0[0]=t,t7[0]}else if(e==="i32"||e==="x32"){if(n==="f32")return u0[0]=t,n7[0];if(n==="u32")return u0[0]=t,r7[0]}else if(e==="u32"){if(n==="f32")return f0[0]=t,i7[0];if(n==="i32"||n==="x32")return f0[0]=t,s7[0]}return console.error(`Unsupported cast from ${e} to ${n}`),t}class o7{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class of{constructor(e,n){this.align=e,this.size=n}}class Pi{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new $F,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}updateAST(e){for(const n of e)n instanceof DA&&this._functions.set(n.name,new o7(n));for(const n of e)if(n instanceof ji){const r=this.getTypeInfo(n,null);r instanceof $s&&this.structs.push(r)}for(const n of e)if(n instanceof b1)this.aliases.push(this._getAliasInfo(n));else{if(n instanceof v1){const r=n,i=this._getAttributeNum(r.attributes,"id",0),s=r.type!=null?this.getTypeInfo(r.type,r.attributes):null;this.overrides.push(new UF(r.name,s,r.attributes,i));continue}if(this._isUniformVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new sf(r.name,o,i,s,r.attributes,Os.Uniform,r.access);a.access||(a.access="read"),this.uniforms.push(a);continue}if(this._isStorageVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),u=new sf(r.name,o,i,s,r.attributes,a?Os.StorageTexture:Os.Storage,r.access);u.access||(u.access="read"),this.storage.push(u);continue}if(this._isTextureVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=this._isStorageTexture(o),u=new sf(r.name,o,i,s,r.attributes,a?Os.StorageTexture:Os.Texture,r.access);u.access||(u.access="read"),a?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(n)){const r=n,i=this._getAttributeNum(r.attributes,"group",0),s=this._getAttributeNum(r.attributes,"binding",0),o=this.getTypeInfo(r.type,r.attributes),a=new sf(r.name,o,i,s,r.attributes,Os.Sampler,r.access);this.samplers.push(a);continue}}for(const n of e)if(n instanceof DA){const r=this._getAttribute(n,"vertex"),i=this._getAttribute(n,"fragment"),s=this._getAttribute(n,"compute"),o=r||i||s,a=new VF(n.name,o==null?void 0:o.name,n.attributes);a.attributes=n.attributes,a.startLine=n.startLine,a.endLine=n.endLine,this.functions.push(a),this._functions.get(n.name).info=a,o&&(this._functions.get(n.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(n,!!o),a.inputs=this._getInputs(n.args),a.outputs=this._getOutputs(n.returnType),this.entry[o.name].push(a)),a.arguments=n.args.map(u=>new zF(u.name,this.getTypeInfo(u.type,u.attributes),u.attributes)),a.returnType=n.returnType?this.getTypeInfo(n.returnType,n.attributes):null;continue}for(const n of this._functions.values())n.info&&(n.info.inUse=n.inUse,this._addCalls(n.node,n.info.calls));for(const n of this._functions.values())n.node.search(r=>{var i,s,o;if(r instanceof mP){if(r.value)if(ke(r.value))for(const a of r.value)for(const u of this.overrides)a===u.name&&((i=n.info)===null||i===void 0||i.overrides.push(u));else for(const a of this.overrides)r.value===a.name&&((s=n.info)===null||s===void 0||s.overrides.push(a))}else if(r instanceof fr)for(const a of this.overrides)r.name===a.name&&((o=n.info)===null||o===void 0||o.overrides.push(a))});for(const n of this.uniforms)this._markStructsInUse(n.type);for(const n of this.storage)this._markStructsInUse(n.type)}getFunctionInfo(e){for(const n of this.functions)if(n.name==e)return n;return null}getStructInfo(e){for(const n of this.structs)if(n.name==e)return n;return null}getOverrideInfo(e){for(const n of this.overrides)if(n.name==e)return n;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n,r){if(r){for(const i of this.entry.compute)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.vertex)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}for(const i of this.entry.fragment)if(i.name===r){for(const s of i.resources)if(s.group==e&&s.binding==n)return s}}for(const i of this.uniforms)if(i.group==e&&i.binding==n)return i;for(const i of this.storage)if(i.group==e&&i.binding==n)return i;for(const i of this.textures)if(i.group==e&&i.binding==n)return i;for(const i of this.samplers)if(i.group==e&&i.binding==n)return i;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this.getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof l0)s.push({});else if(o instanceof c0)s.pop();else if(o instanceof Yi){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof wi){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof tA){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof fr){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const u=i._findResource(a.name);u&&r.push(u)}else if(o instanceof x1){const a=o,u=i._functions.get(a.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}else if(o instanceof w1){const a=o,u=i._functions.get(a.name);u&&(n&&(u.inUse=!0),e.calls.add(u.node),u.resources===null&&(u.resources=i._findResources(u.node,n)),r.push(...u.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.storage)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.textures)n(r.group,r.binding),e[r.group][r.binding]=r;for(const r of this.samplers)n(r.group,r.binding),e[r.group][r.binding]=r;return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof ji)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof ji)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this.getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new H3(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this.getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new H3("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof ji)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof ji)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this.getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new FF(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new LF(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(const n of this.structs)if(n.name==e)return n;for(const n of this.aliases)if(n.name==e)return n.type;return null}getTypeInfo(e,n=null){if(this._types.has(e))return this._types.get(e);if(e instanceof sh){const i=e.type?this.getTypeInfo(e.type,e.attributes):null,s=new n_(e.name,i,n);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof nA){const i=e,s=i.format?this.getTypeInfo(i.format,i.attributes):null,o=new ro(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ji){const i=e,s=new $s(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this.getTypeInfo(o.type,o.attributes);s.members.push(new j3(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Nc){const i=e,s=i.format instanceof ge,o=i.format?s?this.getTypeInfo(i.format,null):new Nr(i.format,null):null,a=new Ko(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof ce){const i=e,s=i.format?this.getTypeInfo(i.format,null):null,o=new Ko(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new Nr(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r,i;const s=this._getTypeSize(e);if(e.size=(n=s==null?void 0:s.size)!==null&&n!==void 0?n:0,e instanceof ro&&e.format){const o=this._getTypeSize(e.format);e.stride=Math.max((r=o==null?void 0:o.size)!==null&&r!==void 0?r:0,(i=o==null?void 0:o.align)!==null&&i!==void 0?i:0),this._updateTypeInfo(e.format)}e instanceof n_&&this._updateTypeInfo(e.format),e instanceof $s&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,u=e.members.length;a<u;++a){const h=e.members[a],p=this._getTypeSize(h);if(!p)continue;(n=this._getAlias(h.type.name))!==null&&n!==void 0||h.type;const _=p.align,v=p.size;r=this._roundUp(_,r+i),i=v,s=r,o=Math.max(o,_),h.offset=r,h.size=v,this._updateTypeInfo(h.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n,r;if(e==null)return null;const i=this._getAttributeNum(e.attributes,"size",0),s=this._getAttributeNum(e.attributes,"align",0);if(e instanceof j3&&(e=e.type),e instanceof Nr){const o=this._getAlias(e.name);o!==null&&(e=o)}{const o=Pi._typeInfo[e.name];if(o!==void 0){const a=((n=e.format)===null||n===void 0?void 0:n.name)==="f16"?2:1;return new of(Math.max(s,o.align/a),Math.max(i,o.size/a))}}{const o=Pi._typeInfo[e.name.substring(0,e.name.length-1)];if(o){const a=e.name[e.name.length-1]==="h"?2:1;return new of(Math.max(s,o.align/a),Math.max(i,o.size/a))}}if(e instanceof ro){let o=e,a=8,u=8;const h=this._getTypeSize(o.format);return h!==null&&(u=h.size,a=h.align),u=o.count*this._getAttributeNum((r=e==null?void 0:e.attributes)!==null&&r!==void 0?r:null,"stride",this._roundUp(a,u)),i&&(u=i),new of(Math.max(s,a),Math.max(i,u))}if(e instanceof $s){let o=0,a=0,u=0,h=0,p=0;for(const _ of e.members){const v=this._getTypeSize(_.type);v!==null&&(o=Math.max(v.align,o),u=this._roundUp(v.align,u+h),h=v.size,p=u)}return a=this._roundUp(o,p+h),new of(Math.max(s,o),Math.max(i,a))}return null}_isUniformVar(e){return e instanceof Yi&&e.storage=="uniform"}_isStorageVar(e){return e instanceof Yi&&e.storage=="storage"}_isTextureVar(e){return e instanceof Yi&&e.type!==null&&Pi._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof Yi&&e.type!==null&&Pi._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}Pi._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Pi._textureTypes=W.any_texture_type.map(t=>t.name),Pi._samplerTypes=W.sampler_type.map(t=>t.name);let T1=0;class E1{constructor(e,n,r){this.id=T1++,this.name=e,this.value=n,this.node=r}clone(){return new E1(this.name,this.value,this.node)}}class S1{constructor(e){this.id=T1++,this.name=e.name,this.node=e}clone(){return new S1(this.node)}}class C1{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=T1++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var n;return this.variables.has(e)?(n=this.variables.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var n;return this.functions.has(e)?(n=this.functions.get(e))!==null&&n!==void 0?n:null:this.parent?this.parent.getFunction(e):null}createVariable(e,n,r){this.variables.set(e,new E1(e,n,r??null))}setVariable(e,n,r){const i=this.getVariable(e);i!==null?i.value=n:this.createVariable(e,n,r)}getVariableValue(e){var n;const r=this.getVariable(e);return(n=r==null?void 0:r.value)!==null&&n!==void 0?n:null}clone(){return new C1(this)}}class a7{evalExpression(e,n){return null}getTypeInfo(e){return null}getVariableName(e,n){return""}}class l7{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,n){const r=this.exec.evalExpression(e.args[0],n);let i=!0;if(r instanceof Q)return r.data.forEach(s=>{s||(i=!1)}),new re(i?1:0,this.getTypeInfo("bool"));throw new Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q){const i=r.data.some(s=>s);return new re(i?1:0,this.getTypeInfo("bool"))}throw new Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,n){const r=this.exec.evalExpression(e.args[2],n);if(!(r instanceof re))throw new Error(`Select() expects a bool condition. Line ${e.line}`);return r.value?this.exec.evalExpression(e.args[1],n):this.exec.evalExpression(e.args[0],n)}ArrayLength(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.evalExpression(r,n);if(i instanceof Yt&&i.typeInfo.size===0){const s=i.typeInfo,o=i.buffer.byteLength/s.stride;return new re(o,this.getTypeInfo("u32"))}return new re(i.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.abs(s)),r.typeInfo);const i=r;return new re(Math.abs(i.value),i.typeInfo)}Acos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.acos(s)),r.typeInfo);const i=r;return new re(Math.acos(i.value),r.typeInfo)}Acosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.acosh(s)),r.typeInfo);const i=r;return new re(Math.acosh(i.value),r.typeInfo)}Asin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.asin(s)),r.typeInfo);const i=r;return new re(Math.asin(i.value),r.typeInfo)}Asinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.asinh(s)),r.typeInfo);const i=r;return new re(Math.asinh(i.value),r.typeInfo)}Atan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.atan(s)),r.typeInfo);const i=r;return new re(Math.atan(i.value),r.typeInfo)}Atanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.atanh(s)),r.typeInfo);const i=r;return new re(Math.atanh(i.value),r.typeInfo)}Atan2(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q)return new Q(r.data.map((a,u)=>Math.atan2(a,i.data[u])),r.typeInfo);const s=r,o=i;return new re(Math.atan2(s.value,o.value),r.typeInfo)}Ceil(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.ceil(s)),r.typeInfo);const i=r;return new re(Math.ceil(i.value),r.typeInfo)}_clamp(e,n,r){return Math.min(Math.max(e,n),r)}Clamp(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof Q&&i instanceof Q&&s instanceof Q)return new Q(r.data.map((h,p)=>this._clamp(h,i.data[p],s.data[p])),r.typeInfo);const o=r,a=i,u=s;return new re(this._clamp(o.value,a.value,u.value),r.typeInfo)}Cos(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.cos(s)),r.typeInfo);const i=r;return new re(Math.cos(i.value),r.typeInfo)}Cosh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.cosh(s)),r.typeInfo);const i=r;return new re(Math.cos(i.value),r.typeInfo)}CountLeadingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.clz32(s)),r.typeInfo);const i=r;return new re(Math.clz32(i.value),r.typeInfo)}_countOneBits(e){let n=0;for(;e!==0;)1&e&&n++,e>>=1;return n}CountOneBits(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>this._countOneBits(s)),r.typeInfo);const i=r;return new re(this._countOneBits(i.value),r.typeInfo)}_countTrailingZeros(e){if(e===0)return 32;let n=0;for(;!(1&e);)e>>=1,n++;return n}CountTrailingZeros(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>this._countTrailingZeros(s)),r.typeInfo);const i=r;return new re(this._countTrailingZeros(i.value),r.typeInfo)}Cross(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q){if(r.data.length!==3||i.data.length!==3)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;const s=r.data,o=i.data;return new Q([s[1]*o[2]-o[1]*s[2],s[2]*o[0]-o[2]*s[0],s[0]*o[1]-o[0]*s[1]],r.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,n){const r=this.exec.evalExpression(e.args[0],n),i=180/Math.PI;return r instanceof Q?new Q(r.data.map(s=>s*i),r.typeInfo):new re(r.value*i,this.getTypeInfo("f32"))}Determinant(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof We){const i=r.data,s=r.typeInfo.getTypeName(),o=s.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if(s==="mat2x2"||s==="mat2x2f"||s==="mat2x2h")return new re(i[0]*i[3]-i[1]*i[2],o);if(s==="mat2x3"||s==="mat2x3f"||s==="mat2x3h")return new re(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);if(s==="mat2x4"||s==="mat2x4f"||s==="mat2x4h")console.error(`TODO: Determinant for ${s}`);else if(s==="mat3x2"||s==="mat3x2f"||s==="mat3x2h")console.error(`TODO: Determinant for ${s}`);else{if(s==="mat3x3"||s==="mat3x3f"||s==="mat3x3h")return new re(i[0]*(i[4]*i[8]-i[5]*i[7])-i[1]*(i[3]*i[8]-i[5]*i[6])+i[2]*(i[3]*i[7]-i[4]*i[6]),o);s==="mat3x4"||s==="mat3x4f"||s==="mat3x4h"||s==="mat4x2"||s==="mat4x2f"||s==="mat4x2h"||s==="mat4x3"||s==="mat4x3f"||s==="mat4x3h"?console.error(`TODO: Determinant for ${s}`):s!=="mat4x4"&&s!=="mat4x4f"&&s!=="mat4x4h"||console.error(`TODO: Determinant for ${s}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q){let a=0;for(let u=0;u<r.data.length;++u)a+=(r.data[u]-i.data[u])*(r.data[u]-i.data[u]);return new re(Math.sqrt(a),this.getTypeInfo("f32"))}const s=r,o=i;return new re(Math.abs(s.value-o.value),r.typeInfo)}_dot(e,n){let r=0;for(let i=0;i<e.length;++i)r+=n[i]*e[i];return r}Dot(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);return r instanceof Q&&i instanceof Q?new re(this._dot(r.data,i.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,n){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,n){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.exp(s)),r.typeInfo);const i=r;return new re(Math.exp(i.value),r.typeInfo)}Exp2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.pow(2,s)),r.typeInfo);const i=r;return new re(Math.pow(2,i.value),r.typeInfo)}ExtractBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(i.typeInfo.name!=="u32"&&i.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;const o=i.value,a=s.value;if(r instanceof Q)return new Q(r.data.map(h=>h>>o&(1<<a)-1),r.typeInfo);if(r.typeInfo.name!=="i32"&&r.typeInfo.name!=="x32")return console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null;const u=r.value;return new re(u>>o&(1<<a)-1,this.getTypeInfo("i32"))}FaceForward(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof Q&&i instanceof Q&&s instanceof Q){const o=this._dot(i.data,s.data);return new Q(o<0?Array.from(r.data):r.data.map(a=>-a),r.typeInfo)}return console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null}_firstLeadingBit(e){return e===0?-1:31-Math.clz32(e)}FirstLeadingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>this._firstLeadingBit(s)),r.typeInfo);const i=r;return new re(this._firstLeadingBit(i.value),r.typeInfo)}_firstTrailingBit(e){return e===0?-1:Math.log2(e&-e)}FirstTrailingBit(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>this._firstTrailingBit(s)),r.typeInfo);const i=r;return new re(this._firstTrailingBit(i.value),r.typeInfo)}Floor(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.floor(s)),r.typeInfo);const i=r;return new re(Math.floor(i.value),r.typeInfo)}Fma(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof Q&&i instanceof Q&&s instanceof Q)return r.data.length!==i.data.length||r.data.length!==s.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new Q(r.data.map((h,p)=>h*i.data[p]+s.data[p]),r.typeInfo);const o=r,a=i,u=s;return new re(o.value*a.value+u.value,o.typeInfo)}Fract(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>s-Math.floor(s)),r.typeInfo);const i=r;return new re(i.value-Math.floor(i.value),r.typeInfo)}Frexp(e,n){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n),o=this.exec.evalExpression(e.args[3],n);if(s.typeInfo.name!=="u32"&&s.typeInfo.name!=="x32")return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;const a=s.value,u=(1<<o.value)-1<<a,h=~u;if(r instanceof Q&&i instanceof Q)return new Q(r.data.map((v,b)=>v&h|i.data[b]<<a&u),r.typeInfo);const p=r.value,_=i.value;return new re(p&h|_<<a&u,r.typeInfo)}InverseSqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>1/Math.sqrt(s)),r.typeInfo);const i=r;return new re(1/Math.sqrt(i.value),r.typeInfo)}Ldexp(e,n){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q){let s=0;return r.data.forEach(o=>{s+=o*o}),new re(Math.sqrt(s),this.getTypeInfo("f32"))}const i=r;return new re(Math.abs(i.value),r.typeInfo)}Log(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.log(s)),r.typeInfo);const i=r;return new re(Math.log(i.value),r.typeInfo)}Log2(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.log2(s)),r.typeInfo);const i=r;return new re(Math.log2(i.value),r.typeInfo)}Max(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q)return new Q(r.data.map((a,u)=>Math.max(a,i.data[u])),r.typeInfo);const s=r,o=i;return new re(Math.max(s.value,o.value),r.typeInfo)}Min(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q)return new Q(r.data.map((a,u)=>Math.min(a,i.data[u])),r.typeInfo);const s=r,o=i;return new re(Math.min(s.value,o.value),r.typeInfo)}Mix(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof Q&&i instanceof Q&&s instanceof Q)return new Q(r.data.map((u,h)=>r.data[h]*(1-s.data[h])+i.data[h]*s.data[h]),r.typeInfo);const o=i,a=s;return new re(r.value*(1-a.value)+o.value*a.value,r.typeInfo)}Modf(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q)return new Q(r.data.map((o,a)=>o%i.data[a]),r.typeInfo);const s=i;return new re(r.value%s.value,r.typeInfo)}Normalize(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q){const i=this.Length(e,n).value;return new Q(r.data.map(s=>s/i),r.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q)return new Q(r.data.map((a,u)=>Math.pow(a,i.data[u])),r.typeInfo);const s=r,o=i;return new re(Math.pow(s.value,o.value),r.typeInfo)}QuantizeToF16(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof Q?new Q(r.data.map(i=>i),r.typeInfo):new re(r.value,r.typeInfo)}Radians(e,n){const r=this.exec.evalExpression(e.args[0],n);return r instanceof Q?new Q(r.data.map(i=>i*Math.PI/180),r.typeInfo):new re(r.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(r instanceof Q&&i instanceof Q){const s=this._dot(r.data,i.data);return new Q(r.data.map((o,a)=>o-2*s*i.data[a]),r.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,n){let r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(r instanceof Q&&i instanceof Q&&s instanceof re){const o=this._dot(i.data,r.data);return new Q(r.data.map((a,u)=>{const h=1-s.value*s.value*(1-o*o);if(h<0)return 0;const p=Math.sqrt(h);return s.value*a-(s.value*o+p)*i.data[u]}),r.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,n){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.round(s)),r.typeInfo);const i=r;return new re(Math.round(i.value),r.typeInfo)}Saturate(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.min(Math.max(s,0),1)),r.typeInfo);const i=r;return new re(Math.min(Math.max(i.value,0),1),r.typeInfo)}Sign(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.sign(s)),r.typeInfo);const i=r;return new re(Math.sign(i.value),r.typeInfo)}Sin(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.sin(s)),r.typeInfo);const i=r;return new re(Math.sin(i.value),r.typeInfo)}Sinh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.sinh(s)),r.typeInfo);const i=r;return new re(Math.sinh(i.value),r.typeInfo)}_smoothstep(e,n,r){const i=Math.min(Math.max((r-e)/(n-e),0),1);return i*i*(3-2*i)}SmoothStep(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n),s=this.exec.evalExpression(e.args[2],n);if(s instanceof Q&&r instanceof Q&&i instanceof Q)return new Q(s.data.map((h,p)=>this._smoothstep(r.data[p],i.data[p],h)),s.typeInfo);const o=r,a=i,u=s;return new re(this._smoothstep(o.value,a.value,u.value),s.typeInfo)}Sqrt(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.sqrt(s)),r.typeInfo);const i=r;return new re(Math.sqrt(i.value),r.typeInfo)}Step(e,n){const r=this.exec.evalExpression(e.args[0],n),i=this.exec.evalExpression(e.args[1],n);if(i instanceof Q&&r instanceof Q)return new Q(i.data.map((o,a)=>o<r.data[a]?0:1),i.typeInfo);const s=r;return new re(i.value<s.value?0:1,s.typeInfo)}Tan(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.tan(s)),r.typeInfo);const i=r;return new re(Math.tan(i.value),r.typeInfo)}Tanh(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.tanh(s)),r.typeInfo);const i=r;return new re(Math.tanh(i.value),r.typeInfo)}_getTransposeType(e){const n=e.getTypeName();return n==="mat2x2f"||n==="mat2x2h"?e:n==="mat2x3f"?this.getTypeInfo("mat3x2f"):n==="mat2x3h"?this.getTypeInfo("mat3x2h"):n==="mat2x4f"?this.getTypeInfo("mat4x2f"):n==="mat2x4h"?this.getTypeInfo("mat4x2h"):n==="mat3x2f"?this.getTypeInfo("mat2x3f"):n==="mat3x2h"?this.getTypeInfo("mat2x3h"):n==="mat3x3f"||n==="mat3x3h"?e:n==="mat3x4f"?this.getTypeInfo("mat4x3f"):n==="mat3x4h"?this.getTypeInfo("mat4x3h"):n==="mat4x2f"?this.getTypeInfo("mat2x4f"):n==="mat4x2h"?this.getTypeInfo("mat2x4h"):n==="mat4x3f"?this.getTypeInfo("mat3x4f"):n==="mat4x3h"?this.getTypeInfo("mat3x4h"):(n==="mat4x4f"||n==="mat4x4h"||console.error(`Invalid matrix type ${n}`),e)}Transpose(e,n){const r=this.exec.evalExpression(e.args[0],n);if(!(r instanceof We))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;const i=this._getTransposeType(r.typeInfo);if(r.typeInfo.name==="mat2x2"||r.typeInfo.name==="mat2x2f"||r.typeInfo.name==="mat2x2h"){const s=r.data;return new We([s[0],s[2],s[1],s[3]],i)}if(r.typeInfo.name==="mat2x3"||r.typeInfo.name==="mat2x3f"||r.typeInfo.name==="mat2x3h"){const s=r.data;return new We([s[0],s[3],s[6],s[1],s[4],s[7]],i)}if(r.typeInfo.name==="mat2x4"||r.typeInfo.name==="mat2x4f"||r.typeInfo.name==="mat2x4h"){const s=r.data;return new We([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13]],i)}if(r.typeInfo.name==="mat3x2"||r.typeInfo.name==="mat3x2f"||r.typeInfo.name==="mat3x2h"){const s=r.data;return new We([s[0],s[3],s[1],s[4],s[2],s[5]],i)}if(r.typeInfo.name==="mat3x3"||r.typeInfo.name==="mat3x3f"||r.typeInfo.name==="mat3x3h"){const s=r.data;return new We([s[0],s[3],s[6],s[1],s[4],s[7],s[2],s[5],s[8]],i)}if(r.typeInfo.name==="mat3x4"||r.typeInfo.name==="mat3x4f"||r.typeInfo.name==="mat3x4h"){const s=r.data;return new We([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14]],i)}if(r.typeInfo.name==="mat4x2"||r.typeInfo.name==="mat4x2f"||r.typeInfo.name==="mat4x2h"){const s=r.data;return new We([s[0],s[4],s[1],s[5],s[2],s[6]],i)}if(r.typeInfo.name==="mat4x3"||r.typeInfo.name==="mat4x3f"||r.typeInfo.name==="mat4x3h"){const s=r.data;return new We([s[0],s[4],s[8],s[1],s[5],s[9],s[2],s[6],s[10]],i)}if(r.typeInfo.name==="mat4x4"||r.typeInfo.name==="mat4x4f"||r.typeInfo.name==="mat4x4h"){const s=r.data;return new We([s[0],s[4],s[8],s[12],s[1],s[5],s[9],s[13],s[2],s[6],s[10],s[14],s[3],s[7],s[11],s[15]],i)}return console.error(`Invalid matrix type ${r.typeInfo.name}`),null}Trunc(e,n){const r=this.exec.evalExpression(e.args[0],n);if(r instanceof Q)return new Q(r.data.map(s=>Math.trunc(s)),r.typeInfo);const i=r;return new re(Math.trunc(i.value),r.typeInfo)}Dpdx(e,n){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,n){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,n){return console.error("TODO: dpdxFine"),null}Dpdy(e,n){return console.error("TODO: dpdy"),null}DpdyCoarse(e,n){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,n){return console.error("TODO: dpdyFine"),null}Fwidth(e,n){return console.error("TODO: fwidth"),null}FwidthCoarse(e,n){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,n){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,n){const r=e.args[0],i=e.args.length>1?this.exec.evalExpression(e.args[1],n).value:0;if(r instanceof fr){const s=r.name,o=n.getVariableValue(s);if(o instanceof Hi){if(i<0||i>=o.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;const a=o.getMipLevelSize(i),u=o.dimension;return u==="1d"?new re(a[0],this.getTypeInfo("u32")):u==="3d"?new Q(a,this.getTypeInfo("vec3u")):u==="2d"?new Q(a.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${u} not found. Line ${e.line}`),null)}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,n){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,n){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length>2?this.exec.evalExpression(e.args[2],n).value:0;if(!(i instanceof Q)||i.data.length!==2)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(r instanceof fr){const o=r.name,a=n.getVariableValue(o);if(a instanceof Hi){const u=Math.floor(i.data[0]),h=Math.floor(i.data[1]);if(u<0||u>=a.width||h<0||h>=a.height)return console.error(`Texture ${o} out of bounds. Line ${e.line}`),null;const p=a.getPixel(u,h,0,s);return p===null?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new Q(p,this.getTypeInfo("vec4f"))}return console.error(`Texture ${o} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,n){const r=e.args[0];if(r instanceof fr){const i=r.name,s=n.getVariableValue(i);return s instanceof Hi?new re(s.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,n){const r=e.args[0];if(r instanceof fr){const i=r.name,s=n.getVariableValue(i);return s instanceof Hi?new re(s.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,n){const r=e.args[0];if(r instanceof fr){const i=r.name,s=n.getVariableValue(i);return s instanceof Hi?new re(s.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${i} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,n){return console.error("TODO: textureSample"),null}TextureSampleBias(e,n){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,n){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,n){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,n){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,n){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,n){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,n){const r=e.args[0],i=this.exec.evalExpression(e.args[1],n),s=e.args.length===4?this.exec.evalExpression(e.args[2],n).value:0,o=e.args.length===4?this.exec.evalExpression(e.args[3],n).data:this.exec.evalExpression(e.args[2],n).data;if(o.length!==4)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(i instanceof Q)||i.data.length!==2)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(r instanceof fr){const a=r.name,u=n.getVariableValue(a);if(u instanceof Hi){const h=u.getMipLevelSize(0),p=Math.floor(i.data[0]),_=Math.floor(i.data[1]);return p<0||p>=h[0]||_<0||_>=h[1]?(console.error(`Texture ${a} out of bounds. Line ${e.line}`),null):(u.setPixel(p,_,0,s,Array.from(o)),null)}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n);return n.getVariable(i).value.getSubData(this.exec,r.postfix,n)}AtomicStore(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n);return u instanceof re&&a instanceof re&&(u.value=a.value),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),null}AtomicAdd(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value+=a.value),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicSub(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value-=a.value),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicMax(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value=Math.max(u.value,a.value)),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicMin(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value=Math.min(u.value,a.value)),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicAnd(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value=u.value&a.value),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicOr(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value=u.value|a.value),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicXor(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value=u.value^a.value),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicExchange(e,n){let r=e.args[0];r instanceof en&&(r=r.right);const i=this.exec.getVariableName(r,n),s=n.getVariable(i);let o=e.args[1];const a=this.exec.evalExpression(o,n),u=s.value.getSubData(this.exec,r.postfix,n),h=new re(u.value,u.typeInfo);return u instanceof re&&a instanceof re&&(u.value=a.value),s.value instanceof Yt&&s.value.setDataValue(this.exec,u,r.postfix,n),h}AtomicCompareExchangeWeak(e,n){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,n){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,n){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,n){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,n){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,n){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,n){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,n){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,n){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,n){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,n){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,n){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,n){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,n){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,n){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,n){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,n){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,n){return null}TextureBarrier(e,n){return null}WorkgroupBarrier(e,n){return null}WorkgroupUniformLoad(e,n){return null}SubgroupAdd(e,n){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,n){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,n){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,n){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,n){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,n){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,n){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,n){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,n){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,n){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,n){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,n){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,n){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,n){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,n){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,n){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,n){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,n){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,n){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,n){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,n){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,n){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,n){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,n){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,n){return console.error("TODO: quadSwapY"),null}}const Jp={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},Vn={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class Nn extends a7{constructor(e,n){var r;super(),this.ast=e??[],this.reflection=new Pi,this.reflection.updateAST(this.ast),this.context=(r=n==null?void 0:n.clone())!==null&&r!==void 0?r:new C1,this.builtins=new l7(this),this.typeInfo={bool:this.getTypeInfo(ge.bool),i32:this.getTypeInfo(ge.i32),u32:this.getTypeInfo(ge.u32),f32:this.getTypeInfo(ge.f32),f16:this.getTypeInfo(ge.f16),vec2f:this.getTypeInfo(ce.vec2f),vec2u:this.getTypeInfo(ce.vec2u),vec2i:this.getTypeInfo(ce.vec2i),vec2h:this.getTypeInfo(ce.vec2h),vec3f:this.getTypeInfo(ce.vec3f),vec3u:this.getTypeInfo(ce.vec3u),vec3i:this.getTypeInfo(ce.vec3i),vec3h:this.getTypeInfo(ce.vec3h),vec4f:this.getTypeInfo(ce.vec4f),vec4u:this.getTypeInfo(ce.vec4u),vec4i:this.getTypeInfo(ce.vec4i),vec4h:this.getTypeInfo(ce.vec4h),mat2x2f:this.getTypeInfo(ce.mat2x2f),mat2x3f:this.getTypeInfo(ce.mat2x3f),mat2x4f:this.getTypeInfo(ce.mat2x4f),mat3x2f:this.getTypeInfo(ce.mat3x2f),mat3x3f:this.getTypeInfo(ce.mat3x3f),mat3x4f:this.getTypeInfo(ce.mat3x4f),mat4x2f:this.getTypeInfo(ce.mat4x2f),mat4x3f:this.getTypeInfo(ce.mat4x3f),mat4x4f:this.getTypeInfo(ce.mat4x4f)}}getVariableValue(e){var n,r;const i=(r=(n=this.context.getVariable(e))===null||n===void 0?void 0:n.value)!==null&&r!==void 0?r:null;if(i===null)return null;if(i instanceof re)return i.value;if(i instanceof Q||i instanceof We)return Array.from(i.data);if(i instanceof Yt&&i.typeInfo instanceof ro){if(i.typeInfo.format.name==="u32")return Array.from(new Uint32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="i32")return Array.from(new Int32Array(i.buffer,i.offset,i.typeInfo.count));if(i.typeInfo.format.name==="f32")return Array.from(new Float32Array(i.buffer,i.offset,i.typeInfo.count))}return console.error(`Unsupported return variable type ${i.typeInfo.name}`),null}execute(e){(e=e??{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,n,r,i){const s=this.context.clone();(i=i??{}).constants&&this._setOverrides(i.constants,s),this._execStatements(this.ast,s);const o=s.getFunction(e);if(!o)return void console.error(`Function ${e} not found`);if(typeof n=="number")n=[n,1,1];else{if(n.length===0)return void console.error("Invalid dispatch count");n.length===1?n=[n[0],1,1]:n.length===2?n=[n[0],n[1],1]:n.length>3&&(n=[n[0],n[1],n[2]])}const a=n[0],u=n[1],h=n[2],p=this.getTypeInfo("vec3u");s.setVariable("@num_workgroups",new Q(n,p));const _=this.reflection.getFunctionInfo(e);_===null&&console.error(`Function ${e} not found in reflection data`);for(const v in r)for(const b in r[v]){const E=r[v][b];s.variables.forEach(R=>{var D;const P=R.node;if(P!=null&&P.attributes){let S=null,k=null;for(const M of P.attributes)M.name==="binding"?S=M.value:M.name==="group"&&(k=M.value);if(b==S&&v==k){let M=!1;for(const V of _.resources)if(V.name===R.name&&V.group===parseInt(v)&&V.binding===parseInt(b)){M=!0;break}if(M)if(E.texture!==void 0&&E.descriptor!==void 0){const V=new Hi(E.texture,this.getTypeInfo(P.type),E.descriptor,(D=E.texture.view)!==null&&D!==void 0?D:null);R.value=V}else E.uniform!==void 0?R.value=new Yt(E.uniform,this.getTypeInfo(P.type)):R.value=new Yt(E,this.getTypeInfo(P.type))}}})}for(let v=0;v<h;++v)for(let b=0;b<u;++b)for(let E=0;E<a;++E)s.setVariable("@workgroup_id",new Q([E,b,v],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(o,[E,b,v],s)}execStatement(e,n){if(e instanceof aP)return this.evalExpression(e.value,n);if(e instanceof cP){if(e.condition){const r=this.evalExpression(e.condition,n);if(!(r instanceof re))throw new Error("Invalid break-if condition");if(!r.value)return null}return Nn._breakObj}if(e instanceof AP)return Nn._continueObj;if(e instanceof tA)this._let(e,n);else if(e instanceof Yi)this._var(e,n);else if(e instanceof ih)this._const(e,n);else if(e instanceof DA)this._function(e,n);else{if(e instanceof oP)return this._if(e,n);if(e instanceof sP)return this._switch(e,n);if(e instanceof tP)return this._for(e,n);if(e instanceof eP)return this._while(e,n);if(e instanceof iP)return this._loop(e,n);if(e instanceof r_){const r=n.clone();return r.currentFunctionName=n.currentFunctionName,this._execStatements(e.body,r)}if(e instanceof rP)this._assign(e,n);else if(e instanceof nP)this._increment(e,n);else{if(e instanceof ji)return null;if(e instanceof v1){const r=e.name;n.getVariable(r)===null&&n.setVariable(r,new re(0,this.getTypeInfo("u32")))}else if(e instanceof w1)this._call(e,n);else{if(e instanceof lP||e instanceof b1)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,n){return e instanceof Yr?this._evalBinaryOp(e,n):e instanceof rn?this._evalLiteral(e,n):e instanceof fr?this._evalVariable(e,n):e instanceof x1?this._evalCall(e,n):e instanceof wi?this._evalCreate(e,n):e instanceof uP?this._evalConst(e,n):e instanceof fP?this._evalBitcast(e,n):e instanceof en?this._evalUnaryOp(e,n):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var n;if(e instanceof ge){const i=this.reflection.getTypeInfo(e);if(i!==null)return i}let r=(n=this.typeInfo[e])!==null&&n!==void 0?n:null;return r!==null||(r=this.reflection.getTypeInfoByName(e)),r}_setOverrides(e,n){for(const r in e){const i=e[r],s=this.reflection.getOverrideInfo(r);s!==null?(s.type===null&&(s.type=this.getTypeInfo("u32")),s.type.name==="u32"||s.type.name==="i32"||s.type.name==="f32"||s.type.name==="f16"?n.setVariable(r,new re(i,s.type)):s.type.name==="bool"?n.setVariable(r,new re(i?1:0,s.type)):s.type.name==="vec2"||s.type.name==="vec3"||s.type.name==="vec4"||s.type.name==="vec2f"||s.type.name==="vec3f"||s.type.name==="vec4f"||s.type.name==="vec2i"||s.type.name==="vec3i"||s.type.name==="vec4i"||s.type.name==="vec2u"||s.type.name==="vec3u"||s.type.name==="vec4u"||s.type.name==="vec2h"||s.type.name==="vec3h"||s.type.name==="vec4h"?n.setVariable(r,new Q(i,s.type)):console.error(`Invalid constant type for ${r}`)):console.error(`Override ${r} does not exist in the shader.`)}}_dispatchWorkgroup(e,n,r){const i=[1,1,1];for(const p of e.node.attributes)if(p.name==="workgroup_size"){if(p.value.length>0){const _=r.getVariableValue(p.value[0]);i[0]=_ instanceof re?_.value:parseInt(p.value[0])}if(p.value.length>1){const _=r.getVariableValue(p.value[1]);i[1]=_ instanceof re?_.value:parseInt(p.value[1])}if(p.value.length>2){const _=r.getVariableValue(p.value[2]);i[2]=_ instanceof re?_.value:parseInt(p.value[2])}}const s=this.getTypeInfo("vec3u"),o=this.getTypeInfo("u32");r.setVariable("@workgroup_size",new Q(i,s));const a=i[0],u=i[1],h=i[2];for(let p=0,_=0;p<h;++p)for(let v=0;v<u;++v)for(let b=0;b<a;++b,++_){const E=[b,v,p],R=[b+n[0]*i[0],v+n[1]*i[1],p+n[2]*i[2]];r.setVariable("@local_invocation_id",new Q(E,s)),r.setVariable("@global_invocation_id",new Q(R,s)),r.setVariable("@local_invocation_index",new re(_,o)),this._dispatchExec(e,r)}}_dispatchExec(e,n){for(const r of e.node.args)for(const i of r.attributes)if(i.name==="builtin"){const s=`@${i.value}`,o=n.getVariable(s);o!==void 0&&n.variables.set(r.name,o)}this._execStatements(e.node.body,n)}getVariableName(e,n){for(;e instanceof en;)e=e.right;return e instanceof fr?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,n){for(const r of e){if(r instanceof Array){const s=n.clone(),o=this._execStatements(r,s);if(o)return o;continue}const i=this.execStatement(r,n);if(i)return i}return null}_call(e,n){const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(i){for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.setVariable(o.name,a,o)}this._execStatements(i.node.body,r)}else e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)&&this._evalCreate(e,n)}_increment(e,n){const r=this.getVariableName(e.variable,n),i=n.getVariable(r);i?e.operator==="++"?i.value instanceof re?i.value.value++:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):e.operator==="--"?i.value instanceof re?i.value.value--:console.error(`Variable ${r} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${r} not found. Line ${e.line}`)}_getVariableData(e,n){if(e instanceof fr){const r=this.getVariableName(e,n),i=n.getVariable(r);return i===null?(console.error(`Variable ${r} not found. Line ${e.line}`),null):i.value.getSubData(this,e.postfix,n)}if(e instanceof en){if(e.operator==="*"){const r=this._getVariableData(e.right,n);return r instanceof Ma?r.reference.getSubData(this,e.postfix,n):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if(e.operator==="&"){const r=this._getVariableData(e.right,n);return new Ma(r)}}return null}_assign(e,n){let r=null,i="<var>",s=null;if(e.variable instanceof en){const u=this._getVariableData(e.variable,n),h=this.evalExpression(e.value,n),p=e.operator;if(p==="="){if(u instanceof re||u instanceof Q||u instanceof We){if(h instanceof re||h instanceof Q||h instanceof We&&u.data.length===h.data.length)return void u.data.set(h.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(u instanceof Yt&&h instanceof Yt&&u.buffer.byteLength-u.offset>=h.buffer.byteLength-h.offset)return void(u.buffer.byteLength%4==0?new Uint32Array(u.buffer,u.offset,u.typeInfo.size/4).set(new Uint32Array(h.buffer,h.offset,h.typeInfo.size/4)):new Uint8Array(u.buffer,u.offset,u.typeInfo.size).set(new Uint8Array(h.buffer,h.offset,h.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if(p==="+=")return u instanceof re||u instanceof Q||u instanceof We?h instanceof re||h instanceof Q||h instanceof We?void u.data.set(h.data.map((_,v)=>u.data[v]+_)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if(p==="-=")return(u instanceof re||u instanceof Q||u instanceof We)&&(h instanceof re||h instanceof Q||h instanceof We)?void u.data.set(h.data.map((_,v)=>u.data[v]-_)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof en){if(e.variable.operator==="*"){i=this.getVariableName(e.variable.right,n);const u=n.getVariable(i);if(!(u&&u.value instanceof Ma))return void console.error(`Variable ${i} is not a pointer. Line ${e.line}`);r=u.value.reference;let h=e.variable.postfix;if(!h){let p=e.variable.right;for(;p instanceof en;){if(p.postfix){h=p.postfix;break}p=p.right}}h&&(r=r.getSubData(this,h,n))}}else{s=e.variable.postfix,i=this.getVariableName(e.variable,n);const u=n.getVariable(i);if(u===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);r=u.value}if(r instanceof Ma&&(r=r.reference),r===null)return void console.error(`Variable ${i} not found. Line ${e.line}`);const o=this.evalExpression(e.value,n),a=e.operator;if(a!=="="){const u=r.getSubData(this,s,n);if(u instanceof Q&&o instanceof re){const h=u.data,p=o.value;if(a==="+=")for(let _=0;_<h.length;++_)h[_]+=p;else if(a==="-=")for(let _=0;_<h.length;++_)h[_]-=p;else if(a==="*=")for(let _=0;_<h.length;++_)h[_]*=p;else if(a==="/=")for(let _=0;_<h.length;++_)h[_]/=p;else if(a==="%=")for(let _=0;_<h.length;++_)h[_]%=p;else if(a==="&=")for(let _=0;_<h.length;++_)h[_]&=p;else if(a==="|=")for(let _=0;_<h.length;++_)h[_]|=p;else if(a==="^=")for(let _=0;_<h.length;++_)h[_]^=p;else if(a==="<<=")for(let _=0;_<h.length;++_)h[_]<<=p;else if(a===">>=")for(let _=0;_<h.length;++_)h[_]>>=p;else console.error(`Invalid operator ${a}. Line ${e.line}`)}else if(u instanceof Q&&o instanceof Q){const h=u.data,p=o.data;if(h.length!==p.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if(a==="+=")for(let _=0;_<h.length;++_)h[_]+=p[_];else if(a==="-=")for(let _=0;_<h.length;++_)h[_]-=p[_];else if(a==="*=")for(let _=0;_<h.length;++_)h[_]*=p[_];else if(a==="/=")for(let _=0;_<h.length;++_)h[_]/=p[_];else if(a==="%=")for(let _=0;_<h.length;++_)h[_]%=p[_];else if(a==="&=")for(let _=0;_<h.length;++_)h[_]&=p[_];else if(a==="|=")for(let _=0;_<h.length;++_)h[_]|=p[_];else if(a==="^=")for(let _=0;_<h.length;++_)h[_]^=p[_];else if(a==="<<=")for(let _=0;_<h.length;++_)h[_]<<=p[_];else if(a===">>=")for(let _=0;_<h.length;++_)h[_]>>=p[_];else console.error(`Invalid operator ${a}. Line ${e.line}`)}else{if(!(u instanceof re&&o instanceof re))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);a==="+="?u.value+=o.value:a==="-="?u.value-=o.value:a==="*="?u.value*=o.value:a==="/="?u.value/=o.value:a==="%="?u.value%=o.value:a==="&="?u.value&=o.value:a==="|="?u.value|=o.value:a==="^="?u.value^=o.value:a==="<<="?u.value<<=o.value:a===">>="?u.value>>=o.value:console.error(`Invalid operator ${a}. Line ${e.line}`)}return void(r instanceof Yt&&r.setDataValue(this,u,s,n))}if(r instanceof Yt)r.setDataValue(this,o,s,n);else if(s){if(!(r instanceof Q||r instanceof We))return void console.error(`Variable ${i} is not a vector or matrix. Line ${e.line}`);if(s instanceof zl){const u=this.evalExpression(s.index,n).value;if(r instanceof Q){if(!(o instanceof re))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[u]=o.value}else{if(!(r instanceof We))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const h=this.evalExpression(s.index,n).value;if(h<0)return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(o instanceof Q))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);{const p=r.typeInfo.getTypeName();if(p==="mat2x2"||p==="mat2x2f"||p==="mat2x2h"){if(!(h<2&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(p==="mat2x3"||p==="mat2x3f"||p==="mat2x3h"){if(!(h<2&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else if(p==="mat2x4"||p==="mat2x4f"||p==="mat2x4h"){if(!(h<2&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}else if(p==="mat3x2"||p==="mat3x2f"||p==="mat3x2h"){if(!(h<3&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(p==="mat3x3"||p==="mat3x3f"||p==="mat3x3h"){if(!(h<3&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else if(p==="mat3x4"||p==="mat3x4f"||p==="mat3x4h"){if(!(h<3&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}else if(p==="mat4x2"||p==="mat4x2f"||p==="mat4x2h"){if(!(h<4&&o.data.length===2))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[2*h]=o.data[0],r.data[2*h+1]=o.data[1]}else if(p==="mat4x3"||p==="mat4x3f"||p==="mat4x3h"){if(!(h<4&&o.data.length===3))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[3*h]=o.data[0],r.data[3*h+1]=o.data[1],r.data[3*h+2]=o.data[2]}else{if(p!=="mat4x4"&&p!=="mat4x4f"&&p!=="mat4x4h")return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(!(h<4&&o.data.length===4))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);r.data[4*h]=o.data[0],r.data[4*h+1]=o.data[1],r.data[4*h+2]=o.data[2],r.data[4*h+3]=o.data[3]}}}}}else if(s instanceof Go){const u=s.value;if(!(r instanceof Q))return void console.error(`Invalid assignment to ${u}. Variable ${i} is not a vector. Line ${e.line}`);if(o instanceof re){if(u.length>1)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);if(u==="x")r.data[0]=o.value;else if(u==="y"){if(r.data.length<2)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[1]=o.value}else if(u==="z"){if(r.data.length<3)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[2]=o.value}else if(u==="w"){if(r.data.length<4)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);r.data[3]=o.value}}else{if(!(o instanceof Q))return void console.error(`Invalid assignment to ${i}. Line ${e.line}`);if(u.length!==o.data.length)return void console.error(`Invalid assignment to ${u} for variable ${i}. Line ${e.line}`);for(let h=0;h<u.length;++h){const p=u[h];if(p==="x"||p==="r")r.data[0]=o.data[h];else if(p==="y"||p==="g"){if(o.data.length<2)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);r.data[1]=o.data[h]}else if(p==="z"||p==="b"){if(o.data.length<3)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);r.data[2]=o.data[h]}else{if(p!=="w"&&p!=="a")return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);if(o.data.length<4)return void console.error(`Invalid assignment to ${p} for variable ${i}. Line ${e.line}`);r.data[3]=o.data[h]}}}}}else r instanceof re&&o instanceof re?r.value=o.value:r instanceof Q&&o instanceof Q||r instanceof We&&o instanceof We?r.data.set(o.data):console.error(`Invalid assignment to ${i}. Line ${e.line}`)}_function(e,n){const r=new S1(e);n.functions.set(e.name,r)}_const(e,n){let r=null;e.value!==null&&(r=this.evalExpression(e.value,n)),n.createVariable(e.name,r,e)}_let(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof en||(r=r.clone())}else{const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||i==="array"){const s=new wi(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_var(e,n){let r=null;if(e.value!==null){if(r=this.evalExpression(e.value,n),r===null)return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof en||(r=r.clone())}else{if(e.type===null)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);const i=e.type.name;if(i==="f32"||i==="i32"||i==="u32"||i==="bool"||i==="f16"||i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2b"||i==="vec3b"||i==="vec4b"||i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"||e.type instanceof nA||e.type instanceof ji||e.type instanceof ce){const s=new wi(e.type,[]);r=this._evalCreate(s,n)}}n.createVariable(e.name,r,e)}_switch(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof re))return console.error(`Invalid if condition. Line ${e.line}`),null;let i=null;for(const s of e.cases)if(s instanceof pP)for(const o of s.selectors){if(o instanceof oh){i=s;continue}const a=this.evalExpression(o,n);if(!(a instanceof re))return console.error(`Invalid case selector. Line ${e.line}`),null;if(a.value===r.value)return this._execStatements(s.body,n)}else s instanceof gP&&(i=s);return i?this._execStatements(i.body,n):null}_if(e,n){n=n.clone();const r=this.evalExpression(e.condition,n);if(!(r instanceof re))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(e.body,n);for(const i of e.elseif){const s=this.evalExpression(i.condition,n);if(!(s instanceof re))return console.error(`Invalid if condition. Line ${e.line}`),null;if(s.value)return this._execStatements(i.body,n)}return e.else?this._execStatements(e.else,n):null}_getScalarValue(e){return e instanceof re?e.value:(console.error("Expected scalar value.",e),0)}_for(e,n){for(n=n.clone(),this.execStatement(e.init,n);this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===Nn._breakObj)break;if(r!==null&&r!==Nn._continueObj)return r;this.execStatement(e.increment,n)}return null}_loop(e,n){for(n=n.clone();;){const r=this._execStatements(e.body,n);if(r===Nn._breakObj)break;if(r===Nn._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,n)===Nn._breakObj)break}else if(r!==null)return r}return null}_while(e,n){for(n=n.clone();this._getScalarValue(this.evalExpression(e.condition,n));){const r=this._execStatements(e.body,n);if(r===Nn._breakObj)break;if(r!==Nn._continueObj&&r!==null)return r}return null}_evalBitcast(e,n){const r=this.evalExpression(e.value,n),i=e.type;if(r instanceof re){const s=K3(r.value,r.typeInfo.name,i.name);return new re(s,this.getTypeInfo(i))}if(r instanceof Q){const s=r.typeInfo.getTypeName();let o="";if(s.endsWith("f"))o="f32";else if(s.endsWith("i"))o="i32";else if(s.endsWith("u"))o="u32";else if(s.endsWith("b"))o="bool";else{if(!s.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;o="f16"}const a=i.getTypeName();let u="";if(a.endsWith("f"))u="f32";else if(a.endsWith("i"))u="i32";else if(a.endsWith("u"))u="u32";else if(a.endsWith("b"))u="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${u}. Line ${e.line}`),null;u="f16"}const h=function(p,_,v){if(_===v)return p;const b=new Array(p.length);for(let E=0;E<p.length;E++)b[E]=K3(p[E],_,v);return b}(Array.from(r.data),o,u);return new Q(h,this.getTypeInfo(i))}return console.error(`TODO: bitcast for ${r.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,n){return n.getVariableValue(e.name).clone().getSubData(this,e.postfix,n)}_evalCreate(e,n){var r;if(e instanceof wi){if(e.type===null)return i_.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,n);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,n);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,n)}}const i=e instanceof wi?e.type.name:e.name,s=e instanceof wi?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(s===null)return console.error(`Unknown type ${i}. Line ${e.line}`),null;if(s.size===0)return null;const o=new Yt(new ArrayBuffer(s.size),s,0);if(s instanceof $s){if(e.args)for(let a=0;a<e.args.length;++a){const u=s.members[a],h=e.args[a],p=this.evalExpression(h,n);o.setData(this,p,u.type,u.offset,n)}}else if(s instanceof ro){let a=0;if(e.args)for(let u=0;u<e.args.length;++u){const h=e.args[u],p=this.evalExpression(h,n);s.format===null&&(((r=p.typeInfo)===null||r===void 0?void 0:r.name)==="x32"?s.format=this.getTypeInfo("i32"):s.format=p.typeInfo),o.setData(this,p,s.format,a,n),a+=s.stride}}else console.error(`Unknown type "${i}". Line ${e.line}`);return e instanceof wi?o.getSubData(this,e.postfix,n):o}_evalLiteral(e,n){const r=this.getTypeInfo(e.type),i=r.name;return i==="x32"||i==="u32"||i==="f32"||i==="f16"||i==="i32"||i==="bool"?new re(e.scalarValue,r):i==="vec2"||i==="vec3"||i==="vec4"||i==="vec2f"||i==="vec3f"||i==="vec4f"||i==="vec2h"||i==="vec3h"||i==="vec4h"||i==="vec2i"||i==="vec3i"||i==="vec4i"||i==="vec2u"||i==="vec3u"||i==="vec4u"?this._callConstructorVec(e,n):i==="mat2x2"||i==="mat2x3"||i==="mat2x4"||i==="mat3x2"||i==="mat3x3"||i==="mat3x4"||i==="mat4x2"||i==="mat4x3"||i==="mat4x4"||i==="mat2x2f"||i==="mat2x3f"||i==="mat2x4f"||i==="mat3x2f"||i==="mat3x3f"||i==="mat3x4f"||i==="mat4x2f"||i==="mat4x3f"||i==="mat4x4f"||i==="mat2x2h"||i==="mat2x3h"||i==="mat2x4h"||i==="mat3x2h"||i==="mat3x3h"||i==="mat3x4h"||i==="mat4x2h"||i==="mat4x3h"||i==="mat4x4h"?this._callConstructorMatrix(e,n):e.value}_evalVariable(e,n){const r=n.getVariableValue(e.name);return r===null?r:r.getSubData(this,e.postfix,n)}_maxFormatTypeInfo(e){let n=e[0];if(n.name==="f32")return n;for(let r=1;r<e.length;++r){const i=Nn._priority.get(n.name);Nn._priority.get(e[r].name)<i&&(n=e[r])}return n.name==="x32"?this.getTypeInfo("i32"):n}_evalUnaryOp(e,n){const r=this.evalExpression(e.right,n);if(e.operator==="&")return new Ma(r);if(e.operator==="*")return r instanceof Ma?r.reference.getSubData(this,e.postfix,n):(console.error(`Invalid dereference. Line ${e.line}`),null);const i=r instanceof re?r.value:r instanceof Q?Array.from(r.data):null;switch(e.operator){case"+":{if(ke(i)){const a=i.map((u,h)=>+u);return new Q(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new re(+s,o)}case"-":{if(ke(i)){const a=i.map((u,h)=>-u);return new Q(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new re(-s,o)}case"!":{if(ke(i)){const a=i.map((u,h)=>u?0:1);return new Q(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new re(s?0:1,o)}case"~":{if(ke(i)){const a=i.map((u,h)=>~u);return new Q(a,r.typeInfo)}const s=i,o=this._maxFormatTypeInfo([r.typeInfo,r.typeInfo]);return new re(~s,o)}}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,n){const r=this.evalExpression(e.left,n),i=this.evalExpression(e.right,n),s=r instanceof re?r.value:r instanceof Q||r instanceof We?Array.from(r.data):null,o=i instanceof re?i.value:i instanceof Q||i instanceof We?Array.from(i.data):null;switch(e.operator){case"+":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b+_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v+p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p+v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a+u,h)}case"-":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b-_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v-p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p-v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a-u,h)}case"*":{if(ke(s)&&ke(o)){const p=s,_=o;if(r instanceof We&&i instanceof We){const v=function(D,P,S,k){if(Vn[P.name]===void 0||Vn[k.name]===void 0)return null;const M=Vn[P.name][0],V=Vn[P.name][1],Y=Vn[k.name][0];if(M!==Vn[k.name][1])return null;const le=new Array(Y*V);for(let I=0;I<V;I++)for(let O=0;O<Y;O++){let U=0;for(let $=0;$<M;$++)U+=D[$*V+I]*S[O*M+$];le[I*Y+O]=U}return le}(p,r.typeInfo,_,i.typeInfo);if(v===null)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;const b=Vn[i.typeInfo.name][0],E=Vn[r.typeInfo.name][1],R=this.getTypeInfo(`mat${b}x${E}f`);return new We(v,R)}if(r instanceof We&&i instanceof Q){const v=function(b,E,R,D){if(Vn[E.name]===void 0||Jp[D.name]===void 0)return null;const P=Vn[E.name][0],S=Vn[E.name][1];if(P!==R.length)return null;const k=new Array(S);for(let M=0;M<S;M++){let V=0;for(let Y=0;Y<P;Y++)V+=b[Y*S+M]*R[Y];k[M]=V}return k}(p,r.typeInfo,_,i.typeInfo);return v===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Q(v,i.typeInfo)}if(r instanceof Q&&i instanceof We){const v=function(b,E,R,D){if(Jp[E.name]===void 0||Vn[D.name]===void 0)return null;const P=Vn[D.name][0],S=Vn[D.name][1];if(S!==b.length)return null;const k=[];for(let M=0;M<P;M++){let V=0;for(let Y=0;Y<S;Y++)V+=b[Y]*R[Y*P+M];k[M]=V}return k}(p,r.typeInfo,_,i.typeInfo);return v===null?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new Q(v,r.typeInfo)}{if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b*_[E]);return new Q(v,r.typeInfo)}}if(ke(s)){const p=o,_=s.map((v,b)=>v*p);return r instanceof We?new We(_,r.typeInfo):new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p*v);return i instanceof We?new We(_,i.typeInfo):new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a*u,h)}case"%":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b%_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v%p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p%v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a%u,h)}case"/":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b/_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v/p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p/v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a/u,h)}case"&":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b&_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v&p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p&v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a&u,h)}case"|":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b|_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v|p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p|v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a|u,h)}case"^":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b^_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v^p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p^v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a^u,h)}case"<<":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b<<_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v<<p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p<<v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a<<u,h)}case">>":{if(ke(s)&&ke(o)){const p=s,_=o;if(p.length!==_.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const v=p.map((b,E)=>b>>_[E]);return new Q(v,r.typeInfo)}if(ke(s)){const p=o,_=s.map((v,b)=>v>>p);return new Q(_,r.typeInfo)}if(ke(o)){const p=s,_=o.map((v,b)=>p>>v);return new Q(_,i.typeInfo)}const a=s,u=o,h=this._maxFormatTypeInfo([r.typeInfo,i.typeInfo]);return new re(a>>u,h)}case">":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p>u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h>a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a>h?1:0);return new Q(u,i.typeInfo)}return new re(s>o?1:0,this.getTypeInfo("bool"));case"<":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p<u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h<a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a<h?1:0);return new Q(u,i.typeInfo)}return new re(s<o?1:0,this.getTypeInfo("bool"));case"==":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p===u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h==a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a==h?1:0);return new Q(u,i.typeInfo)}return new re(s===o?1:0,this.getTypeInfo("bool"));case"!=":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p!==u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h!==a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a!==h?1:0);return new Q(u,i.typeInfo)}return new re(s!==o?1:0,this.getTypeInfo("bool"));case">=":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p>=u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h>=a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a>=h?1:0);return new Q(u,i.typeInfo)}return new re(s>=o?1:0,this.getTypeInfo("bool"));case"<=":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p<=u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h<=a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a<=h?1:0);return new Q(u,i.typeInfo)}return new re(s<=o?1:0,this.getTypeInfo("bool"));case"&&":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p&&u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h&&a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a&&h?1:0);return new Q(u,i.typeInfo)}return new re(s&&o?1:0,this.getTypeInfo("bool"));case"||":if(ke(s)&&ke(o)){const a=s,u=o;if(a.length!==u.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;const h=a.map((p,_)=>p||u[_]?1:0);return new Q(h,r.typeInfo)}if(ke(s)){const a=o,u=s.map((h,p)=>h||a?1:0);return new Q(u,r.typeInfo)}if(ke(o)){const a=s,u=o.map((h,p)=>a||h?1:0);return new Q(u,i.typeInfo)}return new re(s||o?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,n){if(e.cachedReturnValue!==null)return e.cachedReturnValue;const r=n.clone();r.currentFunctionName=e.name;const i=n.getFunction(e.name);if(!i)return e.isBuiltin?this._callBuiltinFunction(e,r):this.getTypeInfo(e.name)?this._evalCreate(e,n):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let s=0;s<i.node.args.length;++s){const o=i.node.args[s],a=this.evalExpression(e.args[s],r);r.createVariable(o.name,a,o)}return this._execStatements(i.node.body,r)}_callBuiltinFunction(e,n){switch(e.name){case"all":return this.builtins.All(e,n);case"any":return this.builtins.Any(e,n);case"select":return this.builtins.Select(e,n);case"arrayLength":return this.builtins.ArrayLength(e,n);case"abs":return this.builtins.Abs(e,n);case"acos":return this.builtins.Acos(e,n);case"acosh":return this.builtins.Acosh(e,n);case"asin":return this.builtins.Asin(e,n);case"asinh":return this.builtins.Asinh(e,n);case"atan":return this.builtins.Atan(e,n);case"atanh":return this.builtins.Atanh(e,n);case"atan2":return this.builtins.Atan2(e,n);case"ceil":return this.builtins.Ceil(e,n);case"clamp":return this.builtins.Clamp(e,n);case"cos":return this.builtins.Cos(e,n);case"cosh":return this.builtins.Cosh(e,n);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,n);case"countOneBits":return this.builtins.CountOneBits(e,n);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,n);case"cross":return this.builtins.Cross(e,n);case"degrees":return this.builtins.Degrees(e,n);case"determinant":return this.builtins.Determinant(e,n);case"distance":return this.builtins.Distance(e,n);case"dot":return this.builtins.Dot(e,n);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,n);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,n);case"exp":return this.builtins.Exp(e,n);case"exp2":return this.builtins.Exp2(e,n);case"extractBits":return this.builtins.ExtractBits(e,n);case"faceForward":return this.builtins.FaceForward(e,n);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,n);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,n);case"floor":return this.builtins.Floor(e,n);case"fma":return this.builtins.Fma(e,n);case"fract":return this.builtins.Fract(e,n);case"frexp":return this.builtins.Frexp(e,n);case"insertBits":return this.builtins.InsertBits(e,n);case"inverseSqrt":return this.builtins.InverseSqrt(e,n);case"ldexp":return this.builtins.Ldexp(e,n);case"length":return this.builtins.Length(e,n);case"log":return this.builtins.Log(e,n);case"log2":return this.builtins.Log2(e,n);case"max":return this.builtins.Max(e,n);case"min":return this.builtins.Min(e,n);case"mix":return this.builtins.Mix(e,n);case"modf":return this.builtins.Modf(e,n);case"normalize":return this.builtins.Normalize(e,n);case"pow":return this.builtins.Pow(e,n);case"quantizeToF16":return this.builtins.QuantizeToF16(e,n);case"radians":return this.builtins.Radians(e,n);case"reflect":return this.builtins.Reflect(e,n);case"refract":return this.builtins.Refract(e,n);case"reverseBits":return this.builtins.ReverseBits(e,n);case"round":return this.builtins.Round(e,n);case"saturate":return this.builtins.Saturate(e,n);case"sign":return this.builtins.Sign(e,n);case"sin":return this.builtins.Sin(e,n);case"sinh":return this.builtins.Sinh(e,n);case"smoothstep":return this.builtins.SmoothStep(e,n);case"sqrt":return this.builtins.Sqrt(e,n);case"step":return this.builtins.Step(e,n);case"tan":return this.builtins.Tan(e,n);case"tanh":return this.builtins.Tanh(e,n);case"transpose":return this.builtins.Transpose(e,n);case"trunc":return this.builtins.Trunc(e,n);case"dpdx":return this.builtins.Dpdx(e,n);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,n);case"dpdxFine":return this.builtins.DpdxFine(e,n);case"dpdy":return this.builtins.Dpdy(e,n);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,n);case"dpdyFine":return this.builtins.DpdyFine(e,n);case"fwidth":return this.builtins.Fwidth(e,n);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,n);case"fwidthFine":return this.builtins.FwidthFine(e,n);case"textureDimensions":return this.builtins.TextureDimensions(e,n);case"textureGather":return this.builtins.TextureGather(e,n);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,n);case"textureLoad":return this.builtins.TextureLoad(e,n);case"textureNumLayers":return this.builtins.TextureNumLayers(e,n);case"textureNumLevels":return this.builtins.TextureNumLevels(e,n);case"textureNumSamples":return this.builtins.TextureNumSamples(e,n);case"textureSample":return this.builtins.TextureSample(e,n);case"textureSampleBias":return this.builtins.TextureSampleBias(e,n);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,n);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,n);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,n);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,n);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,n);case"textureStore":return this.builtins.TextureStore(e,n);case"atomicLoad":return this.builtins.AtomicLoad(e,n);case"atomicStore":return this.builtins.AtomicStore(e,n);case"atomicAdd":return this.builtins.AtomicAdd(e,n);case"atomicSub":return this.builtins.AtomicSub(e,n);case"atomicMax":return this.builtins.AtomicMax(e,n);case"atomicMin":return this.builtins.AtomicMin(e,n);case"atomicAnd":return this.builtins.AtomicAnd(e,n);case"atomicOr":return this.builtins.AtomicOr(e,n);case"atomicXor":return this.builtins.AtomicXor(e,n);case"atomicExchange":return this.builtins.AtomicExchange(e,n);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,n);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,n);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,n);case"pack4xI8":return this.builtins.Pack4xI8(e,n);case"pack4xU8":return this.builtins.Pack4xU8(e,n);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,n);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,n);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,n);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,n);case"pack2x16float":return this.builtins.Pack2x16float(e,n);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,n);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,n);case"unpack4xI8":return this.builtins.Unpack4xI8(e,n);case"unpack4xU8":return this.builtins.Unpack4xU8(e,n);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,n);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,n);case"unpack2x16float":return this.builtins.Unpack2x16float(e,n);case"storageBarrier":return this.builtins.StorageBarrier(e,n);case"textureBarrier":return this.builtins.TextureBarrier(e,n);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,n);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,n);case"subgroupAdd":return this.builtins.SubgroupAdd(e,n);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,n);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,n);case"subgroupAll":return this.builtins.SubgroupAll(e,n);case"subgroupAnd":return this.builtins.SubgroupAnd(e,n);case"subgroupAny":return this.builtins.SubgroupAny(e,n);case"subgroupBallot":return this.builtins.SubgroupBallot(e,n);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,n);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,n);case"subgroupElect":return this.builtins.SubgroupElect(e,n);case"subgroupMax":return this.builtins.SubgroupMax(e,n);case"subgroupMin":return this.builtins.SubgroupMin(e,n);case"subgroupMul":return this.builtins.SubgroupMul(e,n);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,n);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,n);case"subgroupOr":return this.builtins.SubgroupOr(e,n);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,n);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,n);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,n);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,n);case"subgroupXor":return this.builtins.SubgroupXor(e,n);case"quadBroadcast":return this.builtins.QuadBroadcast(e,n);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,n);case"quadSwapX":return this.builtins.QuadSwapX(e,n);case"quadSwapY":return this.builtins.QuadSwapY(e,n)}const r=n.getFunction(e.name);if(r){const i=n.clone();for(let s=0;s<r.node.args.length;++s){const o=r.node.args[s],a=this.evalExpression(e.args[s],i);i.setVariable(o.name,a,o)}return this._execStatements(r.node.body,i)}return null}_callConstructorValue(e,n){if(!e.args||e.args.length===0)return new re(0,this.getTypeInfo(e.type));const r=this.evalExpression(e.args[0],n);return r.typeInfo=this.getTypeInfo(e.type),r.getSubData(this,e.postfix,n).clone()}_callConstructorVec(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Jp[i];if(s===void 0)return console.error(`Invalid vec constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof rn)if(e.isVector){const a=e.vectorValue;for(const u of a)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const u=this.evalExpression(a,n);if(u instanceof Q){const h=u.data;for(let p=0;p<h.length;++p){let _=h[p];o.push(_)}}else if(u instanceof re){let h=u.value;o.push(h)}}if(e.type instanceof ce&&e.type.format===null&&(e.type.format=ce.f32),o.length===0){const a=new Array(s).fill(0);return new Q(a,r).getSubData(this,e.postfix,n)}if(o.length===1)for(;o.length<s;)o.push(o[0]);return o.length<s?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new Q(o.length>s?o.slice(0,s):o,r).getSubData(this,e.postfix,n)}_callConstructorMatrix(e,n){const r=this.getTypeInfo(e.type),i=e.type.getTypeName(),s=Vn[i];if(s===void 0)return console.error(`Invalid matrix constructor ${i}. Line ${e.line}`),null;const o=[];if(e instanceof rn)if(e.isVector){const a=e.vectorValue;for(const u of a)o.push(u)}else o.push(e.scalarValue);else if(e.args)for(const a of e.args){const u=this.evalExpression(a,n);u instanceof Q?o.push(...u.data):u instanceof re?o.push(u.value):u instanceof We&&o.push(...u.data)}if(r instanceof Ko&&r.format===null&&(r.format=this.getTypeInfo("f32")),o.length===0){const a=new Array(s[2]).fill(0);return new We(a,r).getSubData(this,e.postfix,n)}return o.length!==s[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new We(o,r).getSubData(this,e.postfix,n)}}Nn._breakObj=new $r(new Nr("BREAK",null),null),Nn._continueObj=new $r(new Nr("CONTINUE",null),null),Nn._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class c7{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class A7{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new c7,this._exec=new Nn,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof fr){const o=s.name,a=this._context.constants.get(o);if(a)try{const u=a.constEvaluate(this._exec);i.count=u}catch{}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(const r of n)r.search(i=>{i instanceof q3||i instanceof sh?i.type=this._forwardType(i.type):i instanceof nA?i.format=this._forwardType(i.format):i instanceof Yi||i instanceof tA||i instanceof ih?i.type=this._forwardType(i.type):i instanceof DA?i.returnType=this._forwardType(i.returnType):i instanceof Y3&&(i.type=this._forwardType(i.type))});return n}_forwardType(e){if(e instanceof Q3){const n=this._getType(e.name);if(n)return n}else e instanceof sh?e.type=this._forwardType(e.type):e instanceof nA&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if(typeof e=="string"){const n=new JF(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,n){return e.line=n??this._currentLine,e}_error(e,n){return{token:e,message:n,toString:()=>`${n}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==W.eof}_match(e){if(e instanceof se)return!!this._check(e)&&(this._advance(),!0);for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),`${n}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;let i=!1;for(const s of e){if(r===s)return!0;s===W.tokens.name&&(i=!0)}if(i){const s=W.tokens.name.rule.exec(n.lexeme);if(s&&s.index==0&&s[0]==n.lexeme)return!0}return!1}if(n.type===e)return!0;if(e===W.tokens.name){const r=W.tokens.name.rule.exec(n.lexeme);return r&&r.index==0&&r[0]==n.lexeme}return!1}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(W.tokens.semicolon)&&!this._isAtEnd(););if(this._match(W.keywords.alias)){const n=this._type_alias();return this._consume(W.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(W.keywords.diagnostic)){const n=this._diagnostic();return this._consume(W.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(W.keywords.requires)){const n=this._requires_directive();return this._consume(W.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}if(this._match(W.keywords.enable)){const n=this._enable_directive();return this._consume(W.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([n]),n}const e=this._attribute();if(this._check(W.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(W.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(W.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(W.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(W.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(W.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(W.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(W.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([n]),n}if(this._check(W.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}if(this._check(W.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),this._exec.reflection.updateAST([n]),n}return null}_function_decl(){if(!this._match(W.keywords.fn))return null;const e=this._currentLine,n=this._consume(W.tokens.ident,"Expected function name.").toString();this._consume(W.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(W.tokens.paren_right))do{if(this._check(W.tokens.paren_right))break;const a=this._attribute(),u=this._consume(W.tokens.name,"Expected argument name.").toString();this._consume(W.tokens.colon,"Expected ':' for argument type.");const h=this._attribute(),p=this._type_decl();p!=null&&(p.attributes=h,r.push(this._updateNode(new Y3(u,p,a))))}while(this._match(W.tokens.comma));this._consume(W.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(W.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return this._updateNode(new DA(n,r,i,s,e,o),e)}_compound_statement(){const e=[];for(this._consume(W.tokens.brace_left,"Expected '{' for block.");!this._check(W.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(W.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(W.tokens.semicolon)&&!this._isAtEnd(););if(this._check(W.tokens.attr)&&this._attribute(),this._check(W.keywords.if))return this._if_statement();if(this._check(W.keywords.switch))return this._switch_statement();if(this._check(W.keywords.loop))return this._loop_statement();if(this._check(W.keywords.for))return this._for_statement();if(this._check(W.keywords.while))return this._while_statement();if(this._check(W.keywords.continuing))return this._continuing_statement();if(this._check(W.keywords.static_assert))return this._static_assert_statement();if(this._check(W.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(W.keywords.return))e=this._return_statement();else if(this._check([W.keywords.var,W.keywords.let,W.keywords.const]))e=this._variable_statement();else if(this._match(W.keywords.discard))e=this._updateNode(new ZF);else if(this._match(W.keywords.break)){const n=this._updateNode(new cP);if(this._currentLoop.length>0){const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n,this._check(W.keywords.if)&&(this._advance(),n.condition=this._optional_paren_expression())}else if(this._match(W.keywords.continue)){const n=this._updateNode(new AP);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${n.line}`);{const r=this._currentLoop[this._currentLoop.length-1];n.loopId=r.id}e=n}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return e!=null&&this._consume(W.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(W.keywords.static_assert))return null;const e=this._currentLine,n=this._optional_paren_expression();return this._updateNode(new QF(n),e)}_while_statement(){if(!this._match(W.keywords.while))return null;const e=this._updateNode(new eP(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(W.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){const e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(W.keywords.continuing))return null;const n=this._currentLine,r=this._compound_statement();return this._updateNode(new r_(r,e),n)}_for_statement(){if(!this._match(W.keywords.for))return null;this._consume(W.tokens.paren_left,"Expected '('.");const e=this._updateNode(new tP(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(W.tokens.semicolon)?null:this._for_init(),this._consume(W.tokens.semicolon,"Expected ';'."),e.condition=this._check(W.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(W.tokens.semicolon,"Expected ';'."),e.increment=this._check(W.tokens.paren_right)?null:this._for_increment(),this._consume(W.tokens.paren_right,"Expected ')'."),this._check(W.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(W.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(W.tokens.equal)&&(n=this._short_circuit_or_expression()),this._updateNode(new Yi(e.name,e.type,e.storage,e.access,n),e.line)}if(this._match(W.keywords.let)){const e=this._currentLine,n=this._consume(W.tokens.name,"Expected name for let.").toString();let r=null;if(this._match(W.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(W.tokens.equal,"Expected '=' for let.");const i=this._short_circuit_or_expression();return this._updateNode(new tA(n,r,null,null,i),e)}if(this._match(W.keywords.const)){const e=this._currentLine,n=this._consume(W.tokens.name,"Expected name for const.").toString();let r=null;if(this._match(W.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}this._consume(W.tokens.equal,"Expected '=' for const.");const i=this._short_circuit_or_expression();return r===null&&i instanceof rn&&(r=i.type),this._updateNode(new ih(n,r,null,null,i),e)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(W.increment_operators))return this._current=e,null;const r=this._consume(W.increment_operators,"Expected increment operator");return this._updateNode(new nP(r.type===W.tokens.plus_plus?il.increment:il.decrement,n))}_assignment_statement(){let e=null;const n=this._currentLine;if(this._check(W.tokens.brace_right))return null;let r=this._match(W.tokens.underscore);if(r||(e=this._unary_expression()),!r&&e==null)return null;const i=this._consume(W.assignment_operators,"Expected assignment operator."),s=this._short_circuit_or_expression();return this._updateNode(new rP(Oc.parse(i.lexeme),e,s),n)}_func_call_statement(){if(!this._check(W.tokens.ident))return null;const e=this._currentLine,n=this._current,r=this._consume(W.tokens.ident,"Expected function name."),i=this._argument_expression_list();return i===null?(this._current=n,null):this._updateNode(new w1(r.lexeme,i),e)}_loop_statement(){if(!this._match(W.keywords.loop))return null;this._check(W.tokens.attr)&&this._attribute(),this._consume(W.tokens.brace_left,"Expected '{' for loop.");const e=this._updateNode(new iP([],null));this._currentLoop.push(e);let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let r of n)e.body.push(r);else e.body.push(n);if(n instanceof r_){e.continuing=n;break}n=this._statement()}return this._currentLoop.pop(),this._consume(W.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(W.keywords.switch))return null;const e=this._updateNode(new sP(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(W.tokens.attr)&&this._attribute(),this._consume(W.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),e.cases==null||e.cases.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(W.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){const e=[];let n=!1;for(;this._check([W.keywords.default,W.keywords.case]);){if(this._match(W.keywords.case)){const r=this._case_selectors();for(const s of r)if(s instanceof oh){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");n=!0;break}this._match(W.tokens.colon),this._check(W.tokens.attr)&&this._attribute(),this._consume(W.tokens.brace_left,"Exected '{' for switch case.");const i=this._case_body();this._consume(W.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new pP(r,i)))}if(this._match(W.keywords.default)){if(n)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(W.tokens.colon),this._check(W.tokens.attr)&&this._attribute(),this._consume(W.tokens.brace_left,"Exected '{' for switch default.");const r=this._case_body();this._consume(W.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new gP(r)))}}return e}_case_selectors(){const e=[];for(this._match(W.keywords.default)?e.push(this._updateNode(new oh)):e.push(this._shift_expression());this._match(W.tokens.comma);)this._match(W.keywords.default)?e.push(this._updateNode(new oh)):e.push(this._shift_expression());return e}_case_body(){if(this._match(W.keywords.fallthrough))return this._consume(W.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(W.keywords.if))return null;const e=this._currentLine,n=this._optional_paren_expression();this._check(W.tokens.attr)&&this._attribute();const r=this._compound_statement();let i=[];this._match_elseif()&&(this._check(W.tokens.attr)&&this._attribute(),i=this._elseif_statement(i));let s=null;return this._match(W.keywords.else)&&(this._check(W.tokens.attr)&&this._attribute(),s=this._compound_statement()),this._updateNode(new oP(n,r,i,s),e)}_match_elseif(){return this._tokens[this._current].type===W.keywords.else&&this._tokens[this._current+1].type===W.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(this._updateNode(new KF(n,r))),this._match_elseif()&&(this._check(W.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(W.keywords.return))return null;const e=this._short_circuit_or_expression();return this._updateNode(new aP(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(W.tokens.or_or);)e=this._updateNode(new Yr(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(W.tokens.and_and);)e=this._updateNode(new Yr(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(W.tokens.or);)e=this._updateNode(new Yr(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(W.tokens.xor);)e=this._updateNode(new Yr(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(W.tokens.and);)e=this._updateNode(new Yr(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){const e=this._relational_expression();return this._match([W.tokens.equal_equal,W.tokens.not_equal])?this._updateNode(new Yr(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([W.tokens.less_than,W.tokens.greater_than,W.tokens.less_than_equal,W.tokens.greater_than_equal]);)e=this._updateNode(new Yr(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([W.tokens.shift_left,W.tokens.shift_right]);)e=this._updateNode(new Yr(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([W.tokens.plus,W.tokens.minus]);)e=this._updateNode(new Yr(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([W.tokens.star,W.tokens.forward_slash,W.tokens.modulo]);)e=this._updateNode(new Yr(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([W.tokens.minus,W.tokens.bang,W.tokens.tilde,W.tokens.star,W.tokens.and])?this._updateNode(new en(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(W.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(W.tokens.bracket_right,"Expected ']'.");const n=this._updateNode(new zl(e)),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(W.tokens.period)){const e=this._consume(W.tokens.name,"Expected member name."),n=this._postfix_expression(),r=this._updateNode(new Go(e.lexeme));return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){const n=this._getStruct(e);if(n!==null)return n;switch(e){case"void":return ge.void;case"bool":return ge.bool;case"i32":return ge.i32;case"u32":return ge.u32;case"f32":return ge.f32;case"f16":return ge.f16;case"vec2f":return ce.vec2f;case"vec3f":return ce.vec3f;case"vec4f":return ce.vec4f;case"vec2i":return ce.vec2i;case"vec3i":return ce.vec3i;case"vec4i":return ce.vec4i;case"vec2u":return ce.vec2u;case"vec3u":return ce.vec3u;case"vec4u":return ce.vec4u;case"vec2h":return ce.vec2h;case"vec3h":return ce.vec3h;case"vec4h":return ce.vec4h;case"mat2x2f":return ce.mat2x2f;case"mat2x3f":return ce.mat2x3f;case"mat2x4f":return ce.mat2x4f;case"mat3x2f":return ce.mat3x2f;case"mat3x3f":return ce.mat3x3f;case"mat3x4f":return ce.mat3x4f;case"mat4x2f":return ce.mat4x2f;case"mat4x3f":return ce.mat4x3f;case"mat4x4f":return ce.mat4x4f;case"mat2x2h":return ce.mat2x2h;case"mat2x3h":return ce.mat2x3h;case"mat2x4h":return ce.mat2x4h;case"mat3x2h":return ce.mat3x2h;case"mat3x3h":return ce.mat3x3h;case"mat3x4h":return ce.mat3x4h;case"mat4x2h":return ce.mat4x2h;case"mat4x3h":return ce.mat4x3h;case"mat4x4h":return ce.mat4x4h;case"mat2x2i":return ce.mat2x2i;case"mat2x3i":return ce.mat2x3i;case"mat2x4i":return ce.mat2x4i;case"mat3x2i":return ce.mat3x2i;case"mat3x3i":return ce.mat3x3i;case"mat3x4i":return ce.mat3x4i;case"mat4x2i":return ce.mat4x2i;case"mat4x3i":return ce.mat4x3i;case"mat4x4i":return ce.mat4x4i;case"mat2x2u":return ce.mat2x2u;case"mat2x3u":return ce.mat2x3u;case"mat2x4u":return ce.mat2x4u;case"mat3x2u":return ce.mat3x2u;case"mat3x3u":return ce.mat3x3u;case"mat3x4u":return ce.mat3x4u;case"mat4x2u":return ce.mat4x2u;case"mat4x3u":return ce.mat4x3u;case"mat4x4u":return ce.mat4x4u}return null}_validateTypeRange(e,n){if(n.name==="i32"){if(e<-2147483648||e>2147483647)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if(n.name==="u32"&&(e<0||e>4294967295))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(W.tokens.ident)){const r=this._previous().toString();if(this._check(W.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getType(r);return s!==null?this._updateNode(new wi(s,i)):this._updateNode(new x1(r,i))}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return this._updateNode(new uP(r,i.value))}return this._updateNode(new fr(r))}if(this._match(W.tokens.int_literal)){const r=this._previous().toString();let i=r.endsWith("i")||r.endsWith("i")?ge.i32:r.endsWith("u")||r.endsWith("U")?ge.u32:ge.x32;const s=parseInt(r);return this._validateTypeRange(s,i),this._updateNode(new rn(new re(s,this._exec.getTypeInfo(i)),i))}if(this._match(W.tokens.uint_literal)){const r=parseInt(this._previous().toString());return this._validateTypeRange(r,ge.u32),this._updateNode(new rn(new re(r,this._exec.getTypeInfo(ge.u32)),ge.u32))}if(this._match([W.tokens.decimal_float_literal,W.tokens.hex_float_literal])){let r=this._previous().toString(),i=r.endsWith("h");i&&(r=r.substring(0,r.length-1));const s=parseFloat(r);this._validateTypeRange(s,i?ge.f16:ge.f32);const o=i?ge.f16:ge.f32;return this._updateNode(new rn(new re(s,this._exec.getTypeInfo(o)),o))}if(this._match([W.keywords.true,W.keywords.false])){let r=this._previous().toString()===W.keywords.true.rule;return this._updateNode(new rn(new re(r?1:0,this._exec.getTypeInfo(ge.bool)),ge.bool))}if(this._check(W.tokens.paren_left))return this._paren_expression();if(this._match(W.keywords.bitcast)){this._consume(W.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(W.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return this._updateNode(new fP(r,i))}const e=this._type_decl(),n=this._argument_expression_list();return this._updateNode(new wi(e,n))}_argument_expression_list(){if(!this._match(W.tokens.paren_left))return null;const e=[];do{if(this._check(W.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(W.tokens.comma));return this._consume(W.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(W.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(W.tokens.paren_right),e}_paren_expression(){this._consume(W.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(W.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(W.keywords.struct))return null;const e=this._currentLine,n=this._consume(W.tokens.ident,"Expected name for struct.").toString();this._consume(W.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(W.tokens.brace_right);){const o=this._attribute(),a=this._consume(W.tokens.name,"Expected variable name.").toString();this._consume(W.tokens.colon,"Expected ':' for struct member type.");const u=this._attribute(),h=this._type_decl();h!=null&&(h.attributes=u),this._check(W.tokens.brace_right)?this._match(W.tokens.comma):this._consume(W.tokens.comma,"Expected ',' for struct member."),r.push(this._updateNode(new q3(a,h,o)))}this._consume(W.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=this._updateNode(new ji(n,r,e,i),e);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();if(!e)return null;if(this._match(W.tokens.equal)){const n=this._const_expression();e.value=n}if(e.type!==null&&e.value instanceof rn){if(e.value.type.name!=="x32"&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else e.type===null&&e.value instanceof rn&&(e.type=e.value.type.name==="x32"?ge.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(W.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(W.keywords.const))return null;const n=this._consume(W.tokens.name,"Expected variable name"),r=this._currentLine;let i=null;if(this._match(W.tokens.colon)){const u=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=u)}let s=null;this._consume(W.tokens.equal,"const declarations require an assignment");const o=this._short_circuit_or_expression();try{let u=[ge.f32],h=o.constEvaluate(this._exec,u);h instanceof re&&this._validateTypeRange(h.value,u[0]),u[0]instanceof ce&&u[0].format===null&&h.typeInfo instanceof Ko&&h.typeInfo.format!==null&&(h.typeInfo.format.name==="f16"?u[0].format=ge.f16:h.typeInfo.format.name==="f32"?u[0].format=ge.f32:h.typeInfo.format.name==="i32"?u[0].format=ge.i32:h.typeInfo.format.name==="u32"?u[0].format=ge.u32:h.typeInfo.format.name==="bool"?u[0].format=ge.bool:console.error(`TODO: impelement template format type ${h.typeInfo.format.name}`)),s=this._updateNode(new rn(h,u[0])),this._exec.context.setVariable(n.toString(),h)}catch{s=o}if(i!==null&&s instanceof rn){if(s.type.name!=="x32"&&i.getTypeName()!==s.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${s.type.name} to ${i.name}. Line:${this._currentLine}`);s.type=i,s.isScalar&&this._validateTypeRange(s.scalarValue,s.type)}else i===null&&s instanceof rn&&(i=(e=s==null?void 0:s.type)!==null&&e!==void 0?e:ge.f32,i===ge.x32&&(i=ge.i32));const a=this._updateNode(new ih(n.toString(),i,"","",s),r);return this._context.constants.set(a.name,a),a}_global_let_decl(){if(!this._match(W.keywords.let))return null;const e=this._currentLine,n=this._consume(W.tokens.name,"Expected variable name");let r=null;if(this._match(W.tokens.colon)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}let i=null;if(this._match(W.tokens.equal)&&(i=this._const_expression()),r!==null&&i instanceof rn){if(i.type.name!=="x32"&&r.getTypeName()!==i.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${i.type.name} to ${r.name}. Line:${this._currentLine}`);i.type=r}else r===null&&i instanceof rn&&(r=i.type.name==="x32"?ge.i32:i.type);return i instanceof rn&&i.isScalar&&this._validateTypeRange(i.scalarValue,r),this._updateNode(new tA(n.toString(),r,"","",i),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(W.keywords.var))return null;const e=this._currentLine;let n="",r="";this._match(W.tokens.less_than)&&(n=this._consume(W.storage_class,"Expected storage_class.").toString(),this._match(W.tokens.comma)&&(r=this._consume(W.access_mode,"Expected access_mode.").toString()),this._consume(W.tokens.greater_than,"Expected '>'."));const i=this._consume(W.tokens.name,"Expected variable name");let s=null;if(this._match(W.tokens.colon)){const o=this._attribute();s=this._type_decl(),s!=null&&(s.attributes=o)}return this._updateNode(new Yi(i.toString(),s,n,r,null),e)}_override_decl(){if(!this._match(W.keywords.override))return null;const e=this._consume(W.tokens.name,"Expected variable name");let n=null;if(this._match(W.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return this._updateNode(new v1(e.toString(),n,null))}_diagnostic(){this._consume(W.tokens.paren_left,"Expected '('");const e=this._consume(W.tokens.ident,"Expected severity control name.");this._consume(W.tokens.comma,"Expected ','");let n=this._consume(W.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(W.tokens.period)&&(n+=`.${this._consume(W.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(W.tokens.paren_right,"Expected ')'"),this._updateNode(new lP(e.toString(),n))}_enable_directive(){const e=this._consume(W.tokens.ident,"identity expected.");return this._updateNode(new YF(e.toString()))}_requires_directive(){const e=[this._consume(W.tokens.ident,"identity expected.").toString()];for(;this._match(W.tokens.comma);){const n=this._consume(W.tokens.ident,"identity expected.");e.push(n.toString())}return this._updateNode(new qF(e))}_type_alias(){const e=this._consume(W.tokens.ident,"identity expected.");this._consume(W.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=this._updateNode(new b1(e.toString(),n));return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([W.tokens.ident,...W.texel_format,W.keywords.bool,W.keywords.f32,W.keywords.i32,W.keywords.u32])){const r=this._advance().toString();if(this._context.structs.has(r))return this._context.structs.get(r);if(this._context.aliases.has(r))return this._context.aliases.get(r).type;if(!this._getType(r)){const i=this._updateNode(new Q3(r));return this._forwardTypeCount++,i}return this._updateNode(new ge(r))}let e=this._texture_sampler_types();if(e)return e;if(this._check(W.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(W.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(W.tokens.comma)&&(s=this._consume(W.access_mode,"Expected access_mode for pointer").toString()),this._consume(W.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new ce(r,i,s))}if(this._match(W.keywords.ptr)){let r=this._previous().toString();this._consume(W.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(W.storage_class,"Expected storage_class for pointer");this._consume(W.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(W.tokens.comma)&&(o=this._consume(W.access_mode,"Expected access_mode for pointer").toString()),this._consume(W.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new sh(r,i.toString(),s,o))}const n=this._attribute();if(this._match(W.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(W.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let u="";if(this._match(W.tokens.comma)){o=this._shift_expression();try{u=o.constEvaluate(this._exec).toString(),o=null}catch{u="1"}}this._consume(W.tokens.greater_than,"Expected '>' for array."),i=u?parseInt(u):0}const a=this._updateNode(new nA(s.toString(),n,r,i));return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(W.sampler_type))return this._updateNode(new Nc(this._previous().toString(),null,null));if(this._match(W.depth_texture_type))return this._updateNode(new Nc(this._previous().toString(),null,null));if(this._match(W.sampled_texture_type)||this._match(W.multisampled_texture_type)){const e=this._previous();this._consume(W.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(W.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Nc(e.toString(),n,null))}if(this._match(W.storage_texture_type)){const e=this._previous();this._consume(W.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(W.texel_format,"Invalid texel format.").toString();this._consume(W.tokens.comma,"Expected ',' after texel format.");const r=this._consume(W.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(W.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new Nc(e.toString(),n,r))}return null}_attribute(){let e=[];for(;this._match(W.tokens.attr);){const n=this._consume(W.attribute_name,"Expected attribute name"),r=this._updateNode(new mP(n.toString(),null));if(this._match(W.tokens.paren_left)){if(r.value=this._consume(W.literal_or_ident,"Expected attribute value").toString(),this._check(W.tokens.comma)){this._advance();do{const i=this._consume(W.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(W.tokens.comma))}this._consume(W.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class u7 extends Pi{constructor(e){super(),e&&this.update(e)}update(e){const n=new A7().parse(e);this.updateAST(n)}}function f7(t){var s;const e={attributes:[],bindings:[]};let n;try{n=h7(t)}catch(o){return Ee.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const u of((s=o.type)==null?void 0:s.members)||[])a.push({name:u.name,type:G3(u.type)});e.bindings.push({type:"uniform",name:o.name,group:o.group,location:o.binding,members:a})}for(const o of n.textures)e.bindings.push({type:"texture",name:o.name,group:o.group,location:o.binding});for(const o of n.samplers)e.bindings.push({type:"sampler",name:o.name,group:o.group,location:o.binding});const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const u=G3(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:u})}}return e}function G3(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function h7(t){try{return new u7(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const d7={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...d7}};const Hn=globalThis.mathgl.config;function p7(t,{precision:e=Hn.precision}={}){return t=g7(t),`${parseFloat(t.toPrecision(e))}`}function Jo(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ws(t,e,n){return _7(t,r=>Math.max(e,Math.min(n,r)))}function h0(t,e,n){return Jo(t)?t.map((r,i)=>h0(r,e[i],n)):n*e+(1-n)*t}function Ji(t,e,n){const r=Hn.EPSILON;n&&(Hn.EPSILON=n);try{if(t===e)return!0;if(Jo(t)&&Jo(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Ji(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=Hn.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{Hn.EPSILON=r}}function g7(t){return Math.round(t/Hn.EPSILON)*Hn.EPSILON}function m7(t){return t.clone?t.clone():new Array(t.length)}function _7(t,e,n){if(Jo(t)){const r=t;n=n||m7(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class P1 extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Jo(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Hn)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+p7(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Ji(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(Hn.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function y7(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function Rt(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function rA(t,e,n=""){if(Hn.debug&&!y7(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function BA(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class _P extends P1{get x(){return this[0]}set x(e){this[0]=Rt(e)}get y(){return this[1]}set y(e){this[1]=Rt(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return Rt(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return Rt(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return BA(e>=0&&e<this.ELEMENTS,"index is out of range"),Rt(this[e])}setComponent(e,n){return BA(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const iA=1e-6;let li=typeof Float32Array<"u"?Float32Array:Array;function v7(){const t=new li(2);return li!=Float32Array&&(t[0]=0,t[1]=0),t}function J3(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function w7(t,e){return t[0]=-e[0],t[1]=-e[1],t}function yP(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function b7(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[3]*i+n[6],t[1]=n[1]*r+n[4]*i+n[7],t}function x7(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=v7();return function(e,n,r,i,s,o){let a,u;for(n||(n=2),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function T7(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function vP(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function E7(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function S7(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t[3]=e[3],t}function wP(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=n[0]*r+n[3]*i+n[6]*s,t[1]=n[1]*r+n[4]*i+n[7]*s,t[2]=n[2]*r+n[5]*i+n[8]*s,t[3]=e[3],t}function bP(){const t=new li(3);return li!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function C7(t){const e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function eb(t,e,n){const r=new li(3);return r[0]=t,r[1]=e,r[2]=n,r}function P7(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function R7(t){const e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function k7(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function I7(t,e){const n=e[0],r=e[1],i=e[2];let s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function xP(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ah(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}function M7(t,e,n,r){const i=e[0],s=e[1],o=e[2];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t}function R1(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function TP(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function EP(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],u=e[1],h=e[2];let p=i*h-s*u,_=s*a-r*h,v=r*u-i*a,b=i*v-s*_,E=s*p-r*v,R=r*_-i*p;const D=o*2;return p*=D,_*=D,v*=D,b*=2,E*=2,R*=2,t[0]=a+p+b,t[1]=u+_+E,t[2]=h+v+R,t}function O7(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function N7(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function D7(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function B7(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],u=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),h=u&&xP(t,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))}const SP=P7,CP=C7,eg=R7;(function(){const t=bP();return function(e,n,r,i,s,o){let a,u;for(n||(n=3),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const tg=[0,0,0];let af;class Ne extends _P{static get ZERO(){return af||(af=new Ne(0,0,0),Object.freeze(af)),af}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Jo(e)?this.copy(e):(Hn.debug&&(Rt(e),Rt(n),Rt(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Hn.debug&&(Rt(e.x),Rt(e.y),Rt(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Rt(e)}angle(e){return B7(this,e)}cross(e){return ah(this,this,e),this.check()}rotateX({radians:e,origin:n=tg}){return O7(this,this,n,e),this.check()}rotateY({radians:e,origin:n=tg}){return N7(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=tg}){return D7(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return R1(this,this,e),this.check()}transformAsVector(e){return vP(this,this,e),this.check()}transformByMatrix3(e){return TP(this,this,e),this.check()}transformByMatrix2(e){return E7(this,this,e),this.check()}transformByQuaternion(e){return EP(this,this,e),this.check()}}let lf;class k1 extends _P{static get ZERO(){return lf||(lf=new k1(0,0,0,0),Object.freeze(lf)),lf}constructor(e=0,n=0,r=0,i=0){super(-0,-0,-0,-0),Jo(e)&&arguments.length===1?this.copy(e):(Hn.debug&&(Rt(e),Rt(n),Rt(r),Rt(i)),this[0]=e,this[1]=n,this[2]=r,this[3]=i)}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return Hn.debug&&(Rt(e.x),Rt(e.y),Rt(e.z),Rt(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=Rt(e)}get w(){return this[3]}set w(e){this[3]=Rt(e)}transform(e){return R1(this,this,e),this.check()}transformByMatrix3(e){return wP(this,this,e),this.check()}transformByMatrix2(e){return S7(this,this,e),this.check()}transformByQuaternion(e){return EP(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}class PP extends P1{toString(){let e="[";if(Hn.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=Rt(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function L7(){const t=new li(9);return li!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function F7(t,e){if(t===e){const n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function U7(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],p=e[8],_=p*o-a*h,v=-p*s+a*u,b=h*s-o*u;let E=n*_+r*v+i*b;return E?(E=1/E,t[0]=_*E,t[1]=(-p*r+i*h)*E,t[2]=(a*r-i*o)*E,t[3]=v*E,t[4]=(p*n-i*u)*E,t[5]=(-a*n+i*s)*E,t[6]=b*E,t[7]=(-h*n+r*u)*E,t[8]=(o*n-r*s)*E,t):null}function z7(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8];return e*(h*s-o*u)+n*(-h*i+o*a)+r*(u*i-s*a)}function tb(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],p=e[7],_=e[8],v=n[0],b=n[1],E=n[2],R=n[3],D=n[4],P=n[5],S=n[6],k=n[7],M=n[8];return t[0]=v*r+b*o+E*h,t[1]=v*i+b*a+E*p,t[2]=v*s+b*u+E*_,t[3]=R*r+D*o+P*h,t[4]=R*i+D*a+P*p,t[5]=R*s+D*u+P*_,t[6]=S*r+k*o+M*h,t[7]=S*i+k*a+M*p,t[8]=S*s+k*u+M*_,t}function V7(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],p=e[7],_=e[8],v=n[0],b=n[1];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=u,t[6]=v*r+b*o+h,t[7]=v*i+b*a+p,t[8]=v*s+b*u+_,t}function $7(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],p=e[7],_=e[8],v=Math.sin(n),b=Math.cos(n);return t[0]=b*r+v*o,t[1]=b*i+v*a,t[2]=b*s+v*u,t[3]=b*o-v*r,t[4]=b*a-v*i,t[5]=b*u-v*s,t[6]=h,t[7]=p,t[8]=_,t}function nb(t,e,n){const r=n[0],i=n[1];return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function W7(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,h=n*o,p=r*o,_=r*a,v=i*o,b=i*a,E=i*u,R=s*o,D=s*a,P=s*u;return t[0]=1-_-E,t[3]=p-P,t[6]=v+D,t[1]=p+P,t[4]=1-h-E,t[7]=b-R,t[2]=v-D,t[5]=b+R,t[8]=1-h-_,t}var s_;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL1ROW0=3]="COL1ROW0",t[t.COL1ROW1=4]="COL1ROW1",t[t.COL1ROW2=5]="COL1ROW2",t[t.COL2ROW0=6]="COL2ROW0",t[t.COL2ROW1=7]="COL2ROW1",t[t.COL2ROW2=8]="COL2ROW2"})(s_||(s_={}));const j7=Object.freeze([1,0,0,0,1,0,0,0,1]);class xn extends PP{static get IDENTITY(){return X7()}static get ZERO(){return H7()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return s_}constructor(e,...n){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):n.length>0?this.copy([e,...n]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(j7)}fromObject(e){return this.check()}fromQuaternion(e){return W7(this,e),this.check()}set(e,n,r,i,s,o,a,u,h){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=u,this[8]=h,this.check()}setRowMajor(e,n,r,i,s,o,a,u,h){return this[0]=e,this[1]=i,this[2]=a,this[3]=n,this[4]=s,this[5]=u,this[6]=r,this[7]=o,this[8]=h,this.check()}determinant(){return z7(this)}transpose(){return F7(this,this),this.check()}invert(){return U7(this,this),this.check()}multiplyLeft(e){return tb(this,e,this),this.check()}multiplyRight(e){return tb(this,this,e),this.check()}rotate(e){return $7(this,this,e),this.check()}scale(e){return Array.isArray(e)?nb(this,this,e):nb(this,this,[e,e]),this.check()}translate(e){return V7(this,this,e),this.check()}transform(e,n){let r;switch(e.length){case 2:r=b7(n||[-0,-0],e,this);break;case 3:r=TP(n||[-0,-0,-0],e,this);break;case 4:r=wP(n||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rA(r,e.length),r}transformVector(e,n){return this.transform(e,n)}transformVector2(e,n){return this.transform(e,n)}transformVector3(e,n){return this.transform(e,n)}}let cf,Af=null;function H7(){return cf||(cf=new xn([0,0,0,0,0,0,0,0,0]),Object.freeze(cf)),cf}function X7(){return Af||(Af=new xn,Object.freeze(Af)),Af}function Q7(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Y7(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function o_(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],u=e[6],h=e[7],p=e[8],_=e[9],v=e[10],b=e[11],E=e[12],R=e[13],D=e[14],P=e[15],S=n*a-r*o,k=n*u-i*o,M=n*h-s*o,V=r*u-i*a,Y=r*h-s*a,le=i*h-s*u,I=p*R-_*E,O=p*D-v*E,U=p*P-b*E,$=_*D-v*R,q=_*P-b*R,Z=v*P-b*D;let ee=S*Z-k*q+M*$+V*U-Y*O+le*I;return ee?(ee=1/ee,t[0]=(a*Z-u*q+h*$)*ee,t[1]=(i*q-r*Z-s*$)*ee,t[2]=(R*le-D*Y+P*V)*ee,t[3]=(v*Y-_*le-b*V)*ee,t[4]=(u*U-o*Z-h*O)*ee,t[5]=(n*Z-i*U+s*O)*ee,t[6]=(D*M-E*le-P*k)*ee,t[7]=(p*le-v*M+b*k)*ee,t[8]=(o*q-a*U+h*I)*ee,t[9]=(r*U-n*q-s*I)*ee,t[10]=(E*Y-R*M+P*S)*ee,t[11]=(_*M-p*Y-b*S)*ee,t[12]=(a*O-o*$-u*I)*ee,t[13]=(n*$-r*O+i*I)*ee,t[14]=(R*k-E*V-D*S)*ee,t[15]=(p*V-_*k+v*S)*ee,t):null}function q7(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],u=t[7],h=t[8],p=t[9],_=t[10],v=t[11],b=t[12],E=t[13],R=t[14],D=t[15],P=e*o-n*s,S=e*a-r*s,k=n*a-r*o,M=h*E-p*b,V=h*R-_*b,Y=p*R-_*E,le=e*Y-n*V+r*M,I=s*Y-o*V+a*M,O=h*k-p*S+_*P,U=b*k-E*S+R*P;return u*le-i*I+D*O-v*U}function Vo(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],u=e[5],h=e[6],p=e[7],_=e[8],v=e[9],b=e[10],E=e[11],R=e[12],D=e[13],P=e[14],S=e[15];let k=n[0],M=n[1],V=n[2],Y=n[3];return t[0]=k*r+M*a+V*_+Y*R,t[1]=k*i+M*u+V*v+Y*D,t[2]=k*s+M*h+V*b+Y*P,t[3]=k*o+M*p+V*E+Y*S,k=n[4],M=n[5],V=n[6],Y=n[7],t[4]=k*r+M*a+V*_+Y*R,t[5]=k*i+M*u+V*v+Y*D,t[6]=k*s+M*h+V*b+Y*P,t[7]=k*o+M*p+V*E+Y*S,k=n[8],M=n[9],V=n[10],Y=n[11],t[8]=k*r+M*a+V*_+Y*R,t[9]=k*i+M*u+V*v+Y*D,t[10]=k*s+M*h+V*b+Y*P,t[11]=k*o+M*p+V*E+Y*S,k=n[12],M=n[13],V=n[14],Y=n[15],t[12]=k*r+M*a+V*_+Y*R,t[13]=k*i+M*u+V*v+Y*D,t[14]=k*s+M*h+V*b+Y*P,t[15]=k*o+M*p+V*E+Y*S,t}function d0(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,u,h,p,_,v,b,E,R,D,P;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],u=e[2],h=e[3],p=e[4],_=e[5],v=e[6],b=e[7],E=e[8],R=e[9],D=e[10],P=e[11],t[0]=o,t[1]=a,t[2]=u,t[3]=h,t[4]=p,t[5]=_,t[6]=v,t[7]=b,t[8]=E,t[9]=R,t[10]=D,t[11]=P,t[12]=o*r+p*i+E*s+e[12],t[13]=a*r+_*i+R*s+e[13],t[14]=u*r+v*i+D*s+e[14],t[15]=h*r+b*i+P*s+e[15]),t}function I1(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Z7(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),u,h,p,_,v,b,E,R,D,P,S,k,M,V,Y,le,I,O,U,$,q,Z,ee,G;return a<iA?null:(a=1/a,i*=a,s*=a,o*=a,h=Math.sin(n),u=Math.cos(n),p=1-u,_=e[0],v=e[1],b=e[2],E=e[3],R=e[4],D=e[5],P=e[6],S=e[7],k=e[8],M=e[9],V=e[10],Y=e[11],le=i*i*p+u,I=s*i*p+o*h,O=o*i*p-s*h,U=i*s*p-o*h,$=s*s*p+u,q=o*s*p+i*h,Z=i*o*p+s*h,ee=s*o*p-i*h,G=o*o*p+u,t[0]=_*le+R*I+k*O,t[1]=v*le+D*I+M*O,t[2]=b*le+P*I+V*O,t[3]=E*le+S*I+Y*O,t[4]=_*U+R*$+k*q,t[5]=v*U+D*$+M*q,t[6]=b*U+P*$+V*q,t[7]=E*U+S*$+Y*q,t[8]=_*Z+R*ee+k*G,t[9]=v*Z+D*ee+M*G,t[10]=b*Z+P*ee+V*G,t[11]=E*Z+S*ee+Y*G,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function RP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],u=e[7],h=e[8],p=e[9],_=e[10],v=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+h*r,t[5]=o*i+p*r,t[6]=a*i+_*r,t[7]=u*i+v*r,t[8]=h*i-s*r,t[9]=p*i-o*r,t[10]=_*i-a*r,t[11]=v*i-u*r,t}function K7(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],h=e[8],p=e[9],_=e[10],v=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-h*r,t[1]=o*i-p*r,t[2]=a*i-_*r,t[3]=u*i-v*r,t[8]=s*r+h*i,t[9]=o*r+p*i,t[10]=a*r+_*i,t[11]=u*r+v*i,t}function kP(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],u=e[3],h=e[4],p=e[5],_=e[6],v=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+h*r,t[1]=o*i+p*r,t[2]=a*i+_*r,t[3]=u*i+v*r,t[4]=h*i-s*r,t[5]=p*i-o*r,t[6]=_*i-a*r,t[7]=v*i-u*r,t}function G7(t,e){const n=e[0],r=e[1],i=e[2],s=e[4],o=e[5],a=e[6],u=e[8],h=e[9],p=e[10];return t[0]=Math.sqrt(n*n+r*r+i*i),t[1]=Math.sqrt(s*s+o*o+a*a),t[2]=Math.sqrt(u*u+h*h+p*p),t}function J7(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,u=i+i,h=n*o,p=r*o,_=r*a,v=i*o,b=i*a,E=i*u,R=s*o,D=s*a,P=s*u;return t[0]=1-_-E,t[1]=p+P,t[2]=v-D,t[3]=0,t[4]=p-P,t[5]=1-h-E,t[6]=b+R,t[7]=0,t[8]=v+D,t[9]=b-R,t[10]=1-h-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function eU(t,e,n,r,i,s,o){const a=1/(n-e),u=1/(i-r),h=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*u,t[10]=(o+s)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*h,t[15]=0,t}function tU(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const nU=tU;function rU(t,e,n,r,i,s,o){const a=1/(e-n),u=1/(r-i),h=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*u,t[14]=(o+s)*h,t[15]=1,t}const iU=rU;function sU(t,e,n,r){let i,s,o,a,u,h,p,_,v,b;const E=e[0],R=e[1],D=e[2],P=r[0],S=r[1],k=r[2],M=n[0],V=n[1],Y=n[2];return Math.abs(E-M)<iA&&Math.abs(R-V)<iA&&Math.abs(D-Y)<iA?Q7(t):(_=E-M,v=R-V,b=D-Y,i=1/Math.sqrt(_*_+v*v+b*b),_*=i,v*=i,b*=i,s=S*b-k*v,o=k*_-P*b,a=P*v-S*_,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),u=v*a-b*o,h=b*s-_*a,p=_*o-v*s,i=Math.sqrt(u*u+h*h+p*p),i?(i=1/i,u*=i,h*=i,p*=i):(u=0,h=0,p=0),t[0]=s,t[1]=u,t[2]=_,t[3]=0,t[4]=o,t[5]=h,t[6]=v,t[7]=0,t[8]=a,t[9]=p,t[10]=b,t[11]=0,t[12]=-(s*E+o*R+a*D),t[13]=-(u*E+h*R+p*D),t[14]=-(_*E+v*R+b*D),t[15]=1,t)}function oU(){const t=new li(4);return li!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function aU(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function M1(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function lU(t){const e=t[0],n=t[1],r=t[2],i=t[3];return Math.sqrt(e*e+n*n+r*r+i*i)}function cU(t){const e=t[0],n=t[1],r=t[2],i=t[3];return e*e+n*n+r*r+i*i}function AU(t,e){const n=e[0],r=e[1],i=e[2],s=e[3];let o=n*n+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=n*o,t[1]=r*o,t[2]=i*o,t[3]=s*o,t}function uU(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function fU(t,e,n,r){const i=e[0],s=e[1],o=e[2],a=e[3];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t[2]=o+r*(n[2]-o),t[3]=a+r*(n[3]-a),t}function ql(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function hU(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],u=n[2],h=n[3],p=h*r+a*s-u*i,_=h*i+u*r-o*s,v=h*s+o*i-a*r,b=-o*r-a*i-u*s;return t[0]=p*h+b*-o+_*-u-v*-a,t[1]=_*h+b*-a+v*-o-p*-u,t[2]=v*h+b*-u+p*-a-_*-o,t[3]=e[3],t}(function(){const t=oU();return function(e,n,r,i,s,o){let a,u;for(n||(n=4),r||(r=0),i?u=Math.min(i*n+r,e.length):u=e.length,a=r;a<u;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var a_;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(a_||(a_={}));const dU=45*Math.PI/180,pU=1,ng=.1,rg=500,gU=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class Xn extends PP{static get IDENTITY(){return _U()}static get ZERO(){return mU()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return a_}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,u,h,p,_,v,b,E,R,D){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=u,this[8]=h,this[9]=p,this[10]=_,this[11]=v,this[12]=b,this[13]=E,this[14]=R,this[15]=D,this.check()}setRowMajor(e,n,r,i,s,o,a,u,h,p,_,v,b,E,R,D){return this[0]=e,this[1]=s,this[2]=h,this[3]=b,this[4]=n,this[5]=o,this[6]=p,this[7]=E,this[8]=r,this[9]=a,this[10]=_,this[11]=R,this[12]=i,this[13]=u,this[14]=v,this[15]=D,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(gU)}fromObject(e){return this.check()}fromQuaternion(e){return J7(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=ng,far:a=rg}=e;return a===1/0?yU(this,n,r,i,s,o):eU(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return sU(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=ng,far:a=rg}=e;return iU(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=dU,aspect:r=pU,focalDistance:i=1,near:s=ng,far:o=rg}=e;rb(n);const a=n/2,u=i*Math.tan(a),h=u*r;return this.ortho({left:-h,right:h,bottom:-u,top:u,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return rb(n),nU(this,n,r,i,s),this.check()}determinant(){return q7(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return Y7(this,this),this.check()}invert(){return o_(this,this),this.check()}multiplyLeft(e){return Vo(this,e,this),this.check()}multiplyRight(e){return Vo(this,this,e),this.check()}rotateX(e){return RP(this,this,e),this.check()}rotateY(e){return K7(this,this,e),this.check()}rotateZ(e){return kP(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return Z7(this,this,e,n),this.check()}scale(e){return I1(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return d0(this,this,e),this.check()}transform(e,n){return e.length===4?(n=ql(n||[-0,-0,-0,-0],e,this),rA(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=x7(n||[-0,-0],e,this);break;case 3:i=R1(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rA(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=T7(n||[-0,-0],e,this);break;case 3:r=vP(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return rA(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let uf,ff;function mU(){return uf||(uf=new Xn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(uf)),uf}function _U(){return ff||(ff=new Xn,Object.freeze(ff)),ff}function rb(t){if(t>Math.PI*2)throw Error("expected radians")}function yU(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),u=(n+e)/(n-e),h=(i+r)/(i-r),p=-1,_=-1,v=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=u,t[9]=h,t[10]=p,t[11]=_,t[12]=0,t[13]=0,t[14]=v,t[15]=0,t}function ib(){const t=new li(4);return li!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vU(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function IP(t,e,n){n=n*.5;const r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t}function sb(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=n[0],u=n[1],h=n[2],p=n[3];return t[0]=r*p+o*a+i*h-s*u,t[1]=i*p+o*u+s*a-r*h,t[2]=s*p+o*h+r*u-i*a,t[3]=o*p-r*a-i*u-s*h,t}function wU(t,e,n){n*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*a,t[1]=i*u+s*a,t[2]=s*u-i*a,t[3]=o*u-r*a,t}function bU(t,e,n){n*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u-s*a,t[1]=i*u+o*a,t[2]=s*u+r*a,t[3]=o*u-i*a,t}function xU(t,e,n){n*=.5;const r=e[0],i=e[1],s=e[2],o=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=r*u+i*a,t[1]=i*u-r*a,t[2]=s*u+o*a,t[3]=o*u-s*a,t}function TU(t,e){const n=e[0],r=e[1],i=e[2];return t[0]=n,t[1]=r,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-r*r-i*i)),t}function lh(t,e,n,r){const i=e[0],s=e[1],o=e[2],a=e[3];let u=n[0],h=n[1],p=n[2],_=n[3],v,b,E,R,D;return v=i*u+s*h+o*p+a*_,v<0&&(v=-v,u=-u,h=-h,p=-p,_=-_),1-v>iA?(b=Math.acos(v),D=Math.sin(b),E=Math.sin((1-r)*b)/D,R=Math.sin(r*b)/D):(E=1-r,R=r),t[0]=E*i+R*u,t[1]=E*s+R*h,t[2]=E*o+R*p,t[3]=E*a+R*_,t}function EU(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n*n+r*r+i*i+s*s,a=o?1/o:0;return t[0]=-n*a,t[1]=-r*a,t[2]=-i*a,t[3]=s*a,t}function SU(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function MP(t,e){const n=e[0]+e[4]+e[8];let r;if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{let i=0;e[4]>e[0]&&(i=1),e[8]>e[i*3+i]&&(i=2);const s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[i*3+i]-e[s*3+s]-e[o*3+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[s*3+o]-e[o*3+s])*r,t[s]=(e[s*3+i]+e[i*3+s])*r,t[o]=(e[o*3+i]+e[i*3+o])*r}return t}const CU=aU,PU=M1,RU=uU,kU=fU,IU=lU,MU=cU,OP=AU,OU=function(){const t=bP(),e=eb(1,0,0),n=eb(0,1,0);return function(r,i,s){const o=xP(i,s);return o<-.999999?(ah(t,e,i),CP(t)<1e-6&&ah(t,n,i),I7(t,t),IP(r,t,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ah(t,i,s),r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=1+o,OP(r,r))}}();(function(){const t=ib(),e=ib();return function(n,r,i,s,o,a){return lh(t,r,o,a),lh(e,i,s,a),lh(n,t,e,2*a*(1-a)),n}})();(function(){const t=L7();return function(e,n,r,i){return t[0]=r[0],t[3]=r[1],t[6]=r[2],t[1]=i[0],t[4]=i[1],t[7]=i[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],OP(e,MP(e,t))}})();const NU=[0,0,0,1];class ob extends P1{constructor(e=0,n=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&arguments.length===1?this.copy(e):this.set(e,n,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,n,r,i){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return MP(this,e),this.check()}fromAxisRotation(e,n){return IP(this,e,n),this.check()}identity(){return vU(this),this.check()}setAxisAngle(e,n){return this.fromAxisRotation(e,n)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=Rt(e)}get y(){return this[1]}set y(e){this[1]=Rt(e)}get z(){return this[2]}set z(e){this[2]=Rt(e)}get w(){return this[3]}set w(e){this[3]=Rt(e)}len(){return IU(this)}lengthSquared(){return MU(this)}dot(e){return RU(this,e)}rotationTo(e,n){return OU(this,e,n),this.check()}add(e){return CU(this,this,e),this.check()}calculateW(){return TU(this,this),this.check()}conjugate(){return SU(this,this),this.check()}invert(){return EU(this,this),this.check()}lerp(e,n,r){return r===void 0?this.lerp(this,e,n):(kU(this,e,n,r),this.check())}multiplyRight(e){return sb(this,this,e),this.check()}multiplyLeft(e){return sb(this,e,this),this.check()}normalize(){const e=this.len(),n=e>0?1/e:0;return this[0]=this[0]*n,this[1]=this[1]*n,this[2]=this[2]*n,this[3]=this[3]*n,e===0&&(this[3]=1),this.check()}rotateX(e){return wU(this,this,e),this.check()}rotateY(e){return bU(this,this,e),this.check()}rotateZ(e){return xU(this,this,e),this.check()}scale(e){return PU(this,this,e),this.check()}slerp(e,n,r){let i,s,o;switch(arguments.length){case 1:({start:i=NU,target:s,ratio:o}=e);break;case 2:i=this,s=e,o=n;break;default:i=e,s=n,o=r}return lh(this,i,s,o),this.check()}transformVector4(e,n=new k1){return hU(n,e,this),rA(n,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,n){return this.setAxisAngle(e,n)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}const DU=1e-15,BU=1e-20;function NP(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function LU(t){return t-Math.fround(t)}function FU(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;NP(t[r*4+n],e,i*2)}return e}const UU=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,zU={name:"fp32",vs:UU},VU=`
uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,$U={ONE:1},WU={name:"fp64arithmetic",vs:VU,defaultUniforms:$U,uniformTypes:{ONE:"f32"},fp64ify:NP,fp64LowPart:LU,fp64ifyMatrix4:FU},jU=[0,1,1,1],HU=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,XU=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,ab={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:jU},vs:HU,fs:XU,getUniforms:QU};function QU(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const lb=`precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,YU=`// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`,DP=3,qU=255;var LA;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(LA||(LA={}));const ch={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:DP},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:LA.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:YU,vs:lb,fs:lb,getUniforms:ZU};function ZU(t,e={}){if(t=t&&{...t},!t)return{...ch.defaultUniforms};t.lights&&(t={...t,...GU(t.lights),lights:void 0});const{ambientLight:n,pointLights:r,directionalLights:i}=t||{};if(!(n||r&&r.length>0||i&&i.length>0))return{...ch.defaultUniforms,enabled:0};const o={...ch.defaultUniforms,...e,...KU({ambientLight:n,pointLights:r,directionalLights:i})};return t.enabled!==void 0&&(o.enabled=t.enabled?1:0),o}function KU({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};r.ambientLightColor=ig(t);let i=0;for(const s of e){r.lightType=LA.POINT;const o=i;r[`lightColor${o}`]=ig(s),r[`lightPosition${o}`]=s.position,r[`lightAttenuation${o}`]=s.attenuation||[1,0,0],i++}for(const s of n){r.lightType=LA.DIRECTIONAL;const o=i;r[`lightColor${o}`]=ig(s),r[`lightDirection${o}`]=s.direction,i++}return i>DP&&Ee.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=n.length,r.pointLightCount=e.length,r}function GU(t){var n,r;const e={pointLights:[],directionalLights:[]};for(const i of t||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(n=e.directionalLights)==null||n.push(i);break;case"point":(r=e.pointLights)==null||r.push(i);break}return e}function ig(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/qU)}const JU=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,e9=`uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,t9=`struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,BP={props:{},name:"gouraudMaterial",vs:e9.replace("phongMaterial","gouraudMaterial"),fs:JU.replace("phongMaterial","gouraudMaterial"),source:t9.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[ch],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{...BP.defaultUniforms,...e}}},cb=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,n9={name:"layer",vs:cb,fs:cb,getUniforms:t=>({opacity:Math.pow(t.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},r9=`const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,LP="#define SMOOTH_EDGE_RADIUS 0.5",i9=`${LP}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,s9=`${LP}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,FP={name:"geometry",source:r9,vs:i9,fs:s9},o9=25;var nn;(function(t){t[t.Start=1]="Start",t[t.Move=2]="Move",t[t.End=4]="End",t[t.Cancel=8]="Cancel"})(nn||(nn={}));var sn;(function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Right=2]="Right",t[t.Up=4]="Up",t[t.Down=8]="Down",t[t.Horizontal=3]="Horizontal",t[t.Vertical=12]="Vertical",t[t.All=15]="All"})(sn||(sn={}));var et;(function(t){t[t.Possible=1]="Possible",t[t.Began=2]="Began",t[t.Changed=4]="Changed",t[t.Ended=8]="Ended",t[t.Recognized=8]="Recognized",t[t.Cancelled=16]="Cancelled",t[t.Failed=32]="Failed"})(et||(et={}));const a9="compute",l9="auto",l_="manipulation",Ah="none",c_="pan-x",A_="pan-y";function c9(t){if(t.includes(Ah))return Ah;const e=t.includes(c_),n=t.includes(A_);return e&&n?Ah:e||n?e?c_:A_:t.includes(l_)?l_:l9}class A9{constructor(e,n){this.actions="",this.manager=e,this.set(n)}set(e){e===a9&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(const n of this.manager.recognizers)n.options.enable&&(e=e.concat(n.getTouchAction()));return c9(e.join(" "))}}function p0(t){return t.trim().split(/\s+/g)}function sg(t,e,n){if(t)for(const r of p0(e))t.addEventListener(r,n,!1)}function og(t,e,n){if(t)for(const r of p0(e))t.removeEventListener(r,n,!1)}function Ab(t){return(t.ownerDocument||t).defaultView}function u9(t,e){let n=t;for(;n;){if(n===e)return!0;n=n.parentNode}return!1}function UP(t){const e=t.length;if(e===1)return{x:Math.round(t[0].clientX),y:Math.round(t[0].clientY)};let n=0,r=0,i=0;for(;i<e;)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:Math.round(n/e),y:Math.round(r/e)}}function ub(t){const e=[];let n=0;for(;n<t.pointers.length;)e[n]={clientX:Math.round(t.pointers[n].clientX),clientY:Math.round(t.pointers[n].clientY)},n++;return{timeStamp:Date.now(),pointers:e,center:UP(e),deltaX:t.deltaX,deltaY:t.deltaY}}function zP(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)}function fb(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.sqrt(n*n+r*r)}function f9(t,e){const n=e.x-t.x,r=e.y-t.y;return Math.atan2(r,n)*180/Math.PI}function hb(t,e){const n=e.clientX-t.clientX,r=e.clientY-t.clientY;return Math.atan2(r,n)*180/Math.PI}function VP(t,e){return t===e?sn.None:Math.abs(t)>=Math.abs(e)?t<0?sn.Left:sn.Right:e<0?sn.Up:sn.Down}function h9(t,e){const n=e.center;let r=t.offsetDelta,i=t.prevDelta;const s=t.prevInput;return(e.eventType===nn.Start||(s==null?void 0:s.eventType)===nn.End)&&(i=t.prevDelta={x:(s==null?void 0:s.deltaX)||0,y:(s==null?void 0:s.deltaY)||0},r=t.offsetDelta={x:n.x,y:n.y}),{deltaX:i.x+(n.x-r.x),deltaY:i.y+(n.y-r.y)}}function $P(t,e,n){return{x:e/t||0,y:n/t||0}}function d9(t,e){return fb(e[0],e[1])/fb(t[0],t[1])}function p9(t,e){return hb(e[1],e[0])-hb(t[1],t[0])}function g9(t,e){const n=t.lastInterval||e,r=e.timeStamp-n.timeStamp;let i,s,o,a;if(e.eventType!==nn.Cancel&&(r>o9||n.velocity===void 0)){const u=e.deltaX-n.deltaX,h=e.deltaY-n.deltaY,p=$P(r,u,h);s=p.x,o=p.y,i=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,a=VP(u,h),t.lastInterval=e}else i=n.velocity,s=n.velocityX,o=n.velocityY,a=n.direction;e.velocity=i,e.velocityX=s,e.velocityY=o,e.direction=a}function m9(t,e){const{session:n}=t,{pointers:r}=e,{length:i}=r;n.firstInput||(n.firstInput=ub(e)),i>1&&!n.firstMultiple?n.firstMultiple=ub(e):i===1&&(n.firstMultiple=!1);const{firstInput:s,firstMultiple:o}=n,a=o?o.center:s.center,u=e.center=UP(r);e.timeStamp=Date.now(),e.deltaTime=e.timeStamp-s.timeStamp,e.angle=f9(a,u),e.distance=zP(a,u);const{deltaX:h,deltaY:p}=h9(n,e);e.deltaX=h,e.deltaY=p,e.offsetDirection=VP(e.deltaX,e.deltaY);const _=$P(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=_.x,e.overallVelocityY=_.y,e.overallVelocity=Math.abs(_.x)>Math.abs(_.y)?_.x:_.y,e.scale=o?d9(o.pointers,r):1,e.rotation=o?p9(o.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length;let v=t.element;return u9(e.srcEvent.target,v)&&(v=e.srcEvent.target),e.target=v,g9(n,e),e}function _9(t,e,n){const r=n.pointers.length,i=n.changedPointers.length,s=e&nn.Start&&r-i===0,o=e&(nn.End|nn.Cancel)&&r-i===0;n.isFirst=!!s,n.isFinal=!!o,s&&(t.session={}),n.eventType=e;const a=m9(t,n);t.emit("hammer.input",a),t.recognize(a),t.session.prevInput=a}let y9=class{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=n=>{this.manager.options.enable&&this.handler(n)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,n){_9(this.manager,e,n)}init(){sg(this.element,this.evEl,this.domHandler),sg(this.target,this.evTarget,this.domHandler),sg(Ab(this.element),this.evWin,this.domHandler)}destroy(){og(this.element,this.evEl,this.domHandler),og(this.target,this.evTarget,this.domHandler),og(Ab(this.element),this.evWin,this.domHandler)}};const v9={pointerdown:nn.Start,pointermove:nn.Move,pointerup:nn.End,pointercancel:nn.Cancel,pointerout:nn.Cancel},w9="pointerdown",b9="pointermove pointerup pointercancel";class x9 extends y9{constructor(e){super(e),this.evEl=w9,this.evWin=b9,this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){const{store:n}=this;let r=!1;const i=v9[e.type],s=e.pointerType,o=s==="touch";let a=n.findIndex(u=>u.pointerId===e.pointerId);i&nn.Start&&(e.buttons||o)?a<0&&(n.push(e),a=n.length-1):i&(nn.End|nn.Cancel)&&(r=!0),!(a<0)&&(n[a]=e,this.callback(i,{pointers:n,changedPointers:[e],eventType:i,pointerType:s,srcEvent:e}),r&&n.splice(a,1))}}const T9=["","webkit","Moz","MS","ms","o"];function E9(t,e){const n=e[0].toUpperCase()+e.slice(1);for(const r of T9){const i=r?r+n:e;if(i in t)return i}}const S9=1,db=2,pb={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class C9{constructor(e,n){this.options={...pb,...n,cssProps:{...pb.cssProps,...n.cssProps},inputTarget:n.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new x9(this),this.touchAction=new A9(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?db:S9}recognize(e){const{session:n}=this;if(n.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let r;const{recognizers:i}=this;let{curRecognizer:s}=n;(!s||s&&s.state&et.Recognized)&&(s=n.curRecognizer=null);let o=0;for(;o<i.length;)r=i[o],n.stopped!==db&&(!s||r===s||r.canRecognizeWith(s))?r.recognize(e):r.reset(),!s&&r.state&(et.Began|et.Changed|et.Ended)&&(s=n.curRecognizer=r),o++}get(e){const{recognizers:n}=this;for(let r=0;r<n.length;r++)if(n[r].options.event===e)return n[r];return null}add(e){if(Array.isArray(e)){for(const r of e)this.add(r);return this}const n=this.get(e.options.event);return n&&this.remove(n),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(const r of e)this.remove(r);return this}const n=typeof e=="string"?this.get(e):e;if(n){const{recognizers:r}=this,i=r.indexOf(n);i!==-1&&(r.splice(i,1),this.touchAction.update())}return this}on(e,n){if(!e||!n)return;const{handlers:r}=this;for(const i of p0(e))r[i]=r[i]||[],r[i].push(n)}off(e,n){if(!e)return;const{handlers:r}=this;for(const i of p0(e))n?r[i]&&r[i].splice(r[i].indexOf(n),1):delete r[i]}emit(e,n){const r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;const i=n;i.type=e,i.preventDefault=function(){n.srcEvent.preventDefault()};let s=0;for(;s<r.length;)r[s](i),s++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){const{element:n}=this;if(n){for(const[r,i]of Object.entries(this.options.cssProps)){const s=E9(n.style,r);e?(this.oldCssProps[s]=n.style[s],n.style[s]=i):n.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let P9=1;function R9(){return P9++}function gb(t){return t&et.Cancelled?"cancel":t&et.Ended?"end":t&et.Changed?"move":t&et.Began?"start":""}class WP{constructor(e){this.options=e,this.id=R9(),this.state=et.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){if(Array.isArray(e)){for(const i of e)this.recognizeWith(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{simultaneous:r}=this;return r[n.id]||(r[n.id]=n,n.recognizeWith(this)),this}dropRecognizeWith(e){if(Array.isArray(e)){for(const r of e)this.dropRecognizeWith(r);return this}let n;return typeof e=="string"?n=this.manager.get(e):n=e,n&&delete this.simultaneous[n.id],this}requireFailure(e){if(Array.isArray(e)){for(const i of e)this.requireFailure(i);return this}let n;if(typeof e=="string"){if(n=this.manager.get(e),!n)throw new Error(`Cannot find recognizer ${e}`)}else n=e;const{requireFail:r}=this;return r.indexOf(n)===-1&&(r.push(n),n.requireFailure(this)),this}dropRequireFailure(e){if(Array.isArray(e)){for(const r of e)this.dropRequireFailure(r);return this}let n;if(typeof e=="string"?n=this.manager.get(e):n=e,n){const r=this.requireFail.indexOf(n);r>-1&&this.requireFail.splice(r,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;const{state:n}=this;n<et.Ended&&this.manager.emit(this.options.event+gb(n),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),n>=et.Ended&&this.manager.emit(this.options.event+gb(n),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=et.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(et.Failed|et.Possible)))return!1;e++}return!0}recognize(e){const n={...e};if(!this.options.enable){this.reset(),this.state=et.Failed;return}this.state&(et.Recognized|et.Cancelled|et.Failed)&&(this.state=et.Possible),this.state=this.process(n),this.state&(et.Began|et.Changed|et.Ended|et.Cancelled)&&this.tryEmit(n)}getEventNames(){return[this.options.event]}reset(){}}class jP extends WP{attrTest(e){const n=this.options.pointers;return n===0||e.pointers.length===n}process(e){const{state:n}=this,{eventType:r}=e,i=n&(et.Began|et.Changed),s=this.attrTest(e);return i&&(r&nn.Cancel||!s)?n|et.Cancelled:i||s?r&nn.End?n|et.Ended:n&et.Began?n|et.Changed:et.Began:et.Failed}}class mb extends WP{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[l_]}process(e){const{options:n}=this,r=e.pointers.length===n.pointers,i=e.distance<n.threshold,s=e.deltaTime<n.time;if(this.reset(),e.eventType&nn.Start&&this.count===0)return this.failTimeout();if(i&&s&&r){if(e.eventType!==nn.End)return this.failTimeout();const o=this.pTime?e.timeStamp-this.pTime<n.interval:!0,a=!this.pCenter||zP(this.pCenter,e.center)<n.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,!a||!o?this.count=1:this.count+=1,this._input=e,this.count%n.taps===0)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=et.Recognized,this.tryEmit(this._input)},n.interval),et.Began):et.Recognized}return et.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=et.Failed},this.options.interval),et.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===et.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}const k9=["","start","move","end","cancel","up","down","left","right"];class _b extends jP{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:sn.All,...e}),this.pX=null,this.pY=null}getTouchAction(){const{options:{direction:e}}=this,n=[];return e&sn.Horizontal&&n.push(A_),e&sn.Vertical&&n.push(c_),n}getEventNames(){return k9.map(e=>this.options.event+e)}directionTest(e){const{options:n}=this;let r=!0,{distance:i}=e,{direction:s}=e;const o=e.deltaX,a=e.deltaY;return s&n.direction||(n.direction&sn.Horizontal?(s=o===0?sn.None:o<0?sn.Left:sn.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(s=a===0?sn.None:a<0?sn.Up:sn.Down,r=a!==this.pY,i=Math.abs(e.deltaY))),e.direction=s,r&&i>n.threshold&&!!(s&n.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&et.Began)||!(this.state&et.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;const n=sn[e.direction].toLowerCase();n&&(e.additionalEvent=this.options.event+n),super.emit(e)}}const I9=["","start","move","end","cancel","in","out"];class M9 extends jP{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[Ah]}getEventNames(){return I9.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&et.Began))}emit(e){if(e.scale!==1){const n=e.scale<1?"in":"out";e.additionalEvent=this.options.event+n}super.emit(e)}}class md{constructor(e,n,r){this.element=e,this.callback=n,this.options=r}}const O9=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",N9=O9.indexOf("firefox")!==-1,yb=4.000244140625,D9=40,B9=.25;class L9 extends md{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;globalThis.WheelEvent&&(N9&&i.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(s/=globalThis.devicePixelRatio),i.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(s*=D9)),s!==0&&s%yb===0&&(s=Math.floor(s/yb)),i.shiftKey&&s&&(s=s*B9),this.callback({type:"wheel",center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,n){e==="wheel"&&(this.options.enable=n)}}const vb=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class F9 extends md{constructor(e,n,r){super(e,n,{enable:!0,...r}),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,vb.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){vb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){switch(e){case"pointermove":this.enableMoveEvent=n;break;case"pointerover":this.enableOverEvent=n;break;case"pointerout":this.enableOutEvent=n;break;case"pointerenter":this.enableEnterEvent=n;break;case"pointerleave":this.enableLeaveEvent=n;break}}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const wb=["keydown","keyup"];class U9 extends md{constructor(e,n,r){super(e,n,{enable:!0,tabIndex:0,...r}),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:"keydown",srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:"keyup",srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",wb.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){wb.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e==="keydown"&&(this.enableDownEvent=n),e==="keyup"&&(this.enableUpEvent=n)}}class z9 extends md{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e==="contextmenu"&&(this.options.enable=n)}}const bb=1,u_=2,xb=4,V9={pointerdown:bb,pointermove:u_,pointerup:xb,mousedown:bb,mousemove:u_,mouseup:xb},$9=0,W9=1,j9=2,H9=1,X9=2,Q9=4;function Y9(t){const e=V9[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===u_?(i=!!(n&H9),s=!!(n&Q9),o=!!(n&X9)):(i=r===$9,s=r===W9,o=r===j9),{leftButton:i,middleButton:s,rightButton:o}}function q9(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const Z9={srcElement:"root",priority:0};class K9{constructor(e,n){this.handleEvent=r=>{if(this.isEmpty())return;const i=this._normalizeEvent(r);let s=r.srcEvent.target;for(;s&&s!==i.rootElement;){if(this._emit(i,s),i.handled)return;s=s.parentNode}this._emit(i,"root")},this.eventManager=e,this.recognizerName=n,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this,u={...Z9,...r};let h=a.get(u.srcElement);h||(h=[],a.set(u.srcElement,h));const p={type:e,handler:n,srcElement:u.srcElement,priority:u.priority};i&&(p.once=!0),s&&(p.passive=!0),o.push(p),this._active=this._active||!p.passive;let _=h.length-1;for(;_>=0&&!(h[_].priority>=p.priority);)_--;h.splice(_+1,0,p)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let u=0;u<r.length;u++){const{type:h,handler:p,once:_}=r[u];if(p({...e,type:h,stopPropagation:s,stopImmediatePropagation:o}),_&&a.push(r[u]),i)break}for(let u=0;u<a.length;u++){const{type:h,handler:p}=a[u];this.remove(h,p)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...Y9(e),...q9(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}function G9(t){if("recognizer"in t)return t;let e;const n=Array.isArray(t)?[...t]:[t];if(typeof n[0]=="function"){const r=n.shift(),i=n.shift()||{};e=new r(i)}else e=n.shift();return{recognizer:e,recognizeWith:typeof n[0]=="string"?[n[0]]:n[0],requireFailure:typeof n[1]=="string"?[n[1]]:n[1]}}class J9{constructor(e=null,n={}){if(this._onBasicInput=r=>{this.manager.emit(r.srcEvent.type,r)},this._onOtherEvent=r=>{this.manager.emit(r.type,r)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...n},this.events=new Map,this.element=e,!!e){this.manager=new C9(e,this.options);for(const r of this.options.recognizers){const{recognizer:i,recognizeWith:s,requireFailure:o}=G9(r);this.manager.add(i),s&&i.recognizeWith(s),o&&i.requireFailure(o)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new L9(e,this._onOtherEvent,{enable:!1}),this.moveInput=new F9(e,this._onOtherEvent,{enable:!1}),this.keyInput=new U9(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new z9(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){var s,o,a,u;const{manager:r}=this;if(!r)return;const i=r.get(e);i&&(i.set({enable:n}),r.touchAction.update()),(s=this.wheelInput)==null||s.enableEventType(e,n),(o=this.moveInput)==null||o.enableEventType(e,n),(a=this.keyInput)==null||a.enableEventType(e,n),(u=this.contextmenuInput)==null||u.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const[h,p]of Object.entries(e))this._addEventHandler(h,p,r,i,s);return}const{manager:o,events:a}=this;if(!o)return;let u=a.get(e);if(!u){const h=this._getRecognizerName(e)||e;u=new K9(this,h),a.set(e,u),o&&o.on(e,u.handleEvent)}u.add(e,n,r,i,s),u.isEmpty()||this._toggleRecognizer(u.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const[s,o]of Object.entries(e))this._removeEventHandler(s,o);return}const{events:r}=this,i=r.get(e);if(i&&(i.remove(e,n),i.isEmpty())){const{recognizerName:s}=i;let o=!1;for(const a of r.values())if(a.recognizerName===s&&!a.isEmpty()){o=!0;break}o||this._toggleRecognizer(s,!1)}}_getRecognizerName(e){var n;return(n=this.manager.recognizers.find(r=>r.getEventNames().includes(e)))==null?void 0:n.options.event}}const ut={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ut,"IDENTITY",{get:()=>(ot.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const dr={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},ss={common:0,meters:1,pixels:2},f_={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},Tb={multipan:[_b,{threshold:10,direction:sn.Vertical,pointers:2}],pinch:[M9,{},null,["multipan"]],pan:[_b,{threshold:1},["pinch"],["multipan"]],dblclick:[mb,{event:"dblclick",taps:2}],click:[mb,{event:"click"},null,["dblclick"]]};function ez(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function fu(t){let e={},n;return r=>{for(const i in r)if(!ez(r[i],e[i])){n=t(r),e=r;break}return n}}const Eb=[0,0,0,0],tz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],HP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],nz=[0,0,0],XP=[0,0,0],rz=fu(oz);function QP(t,e,n=XP){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===ut.LNGLAT_OFFSETS||e===ut.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case dr.WEB_MERCATOR:(e===ut.LNGLAT||e===ut.CARTESIAN)&&(i=[0,0,0],s=!1);break;case dr.WEB_MERCATOR_AUTO_OFFSET:e===ut.LNGLAT?r=i:e===ut.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case dr.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case dr.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function iz(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Eb,u=Eb,h=t.cameraPosition;const{geospatialOrigin:p,shaderCoordinateOrigin:_,offsetMode:v}=QP(t,e,n);return v&&(u=t.projectPosition(p||_),h=[h[0]-u[0],h[1]-u[1],h[2]-u[2]],u[3]=1,a=ql([],u,o),s=r||s,o=Vo([],i,s),o=Vo([],o,tz)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:u,cameraPosCommon:h,shaderCoordinateOrigin:_,geospatialOrigin:p}}function sz({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=ut.DEFAULT,coordinateOrigin:i=XP,autoWrapLongitude:s=!1}){r===ut.DEFAULT&&(r=t.isGeospatial?ut.LNGLAT:ut.CARTESIAN);const o=rz({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||HP,o}function oz({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:u,geospatialOrigin:h}=iz(t,n,r),p=t.getDistanceScales(),_=[t.width*e,t.height*e],v=ql([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,b={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:u,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:_,devicePixelRatio:e,focalDistance:v,commonUnitsPerMeter:p.unitsPerMeter,commonUnitsPerWorldUnit:p.unitsPerMeter,commonUnitsPerWorldUnit2:nz,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:HP,cameraPosition:a};if(h){const E=t.getDistanceScales(h);switch(n){case ut.METER_OFFSETS:b.commonUnitsPerWorldUnit=E.unitsPerMeter,b.commonUnitsPerWorldUnit2=E.unitsPerMeter2;break;case ut.LNGLAT:case ut.LNGLAT_OFFSETS:t._pseudoMeters||(b.commonUnitsPerMeter=E.unitsPerMeter),b.commonUnitsPerWorldUnit=E.unitsPerDegree,b.commonUnitsPerWorldUnit2=E.unitsPerDegree2;break;case ut.CARTESIAN:b.commonUnitsPerWorldUnit=[1,1,E.unitsPerMeter[2]],b.commonUnitsPerWorldUnit2=[0,0,E.unitsPerMeter2[2]];break}}return b}const az=Object.keys(ut).map(t=>`const COORDINATE_SYSTEM_${t}: i32 = ${ut[t]};`).join(""),lz=Object.keys(dr).map(t=>`const PROJECTION_MODE_${t}: i32 = ${dr[t]};`).join(""),cz=Object.keys(ss).map(t=>`const UNIT_${t.toUpperCase()}: i32 = ${ss[t]};`).join(""),Az=`${az}
${lz}
${cz}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,uz=`${Az}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the z‑axis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,fz=Object.keys(ut).map(t=>`const int COORDINATE_SYSTEM_${t} = ${ut[t]};`).join(""),hz=Object.keys(dr).map(t=>`const int PROJECTION_MODE_${t} = ${dr[t]};`).join(""),dz=Object.keys(ss).map(t=>`const int UNIT_${t.toUpperCase()} = ${ss[t]};`).join(""),pz=`${fz}
${hz}
${dz}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,gz={};function mz(t=gz){return"viewport"in t?sz(t):{}}const O1={name:"project",dependencies:[zU,FP],source:uz,vs:pz,getUniforms:mz,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},_z=`// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,yz=`vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,hu={name:"project32",dependencies:[O1],source:_z,vs:yz};function vz(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Tl(t,e){const n=ql([],e,t);return M1(n,n,1/n[3]),n}function Sb(t,e){const n=t%e;return n<0?e+n:n}function h_(t,e,n){return t<e?e:t>n?n:t}function wz(t){return Math.log(t)*Math.LOG2E}const N1=Math.log2||wz;function os(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const ti=Math.PI,YP=ti/4,Dr=ti/180,d_=180/ti,Vl=512,g0=4003e4,sl=85.051129,bz=1.5;function xz(t){return N1(t)}function $l(t){const[e,n]=t;os(Number.isFinite(e)),os(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Dr,i=n*Dr,s=Vl*(r+ti)/(2*ti),o=Vl*(ti+Math.log(Math.tan(YP+i*.5)))/(2*ti);return[s,o]}function Oi(t){const[e,n]=t,r=e/Vl*(2*ti)-ti,i=2*(Math.atan(Math.exp(n/Vl*(2*ti)-ti))-YP);return[r*d_,i*d_]}function Tz(t){const{latitude:e}=t;os(Number.isFinite(e));const n=Math.cos(e*Dr);return xz(g0*n)-9}function ag(t){const e=Math.cos(t*Dr);return Vl/g0/e}function p_(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;os(Number.isFinite(e)&&Number.isFinite(n));const i=Vl,s=Math.cos(e*Dr),o=i/360,a=o/s,u=i/g0/s,h={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[o,a,u],degreesPerUnit:[1/o,1/a,1/u]};if(r){const p=Dr*Math.tan(e*Dr)/s,_=o*p/2,v=i/g0*p,b=v/a*u;h.unitsPerDegree2=[0,_,v],h.unitsPerMeter2=[b,0,b]}return h}function qP(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:u,unitsPerMeter2:h}=p_({longitude:n,latitude:r,highPrecision:!0}),p=$l(t);p[0]+=s*(u[0]+h[0]*o),p[1]+=o*(u[1]+h[1]*o);const _=Oi(p),v=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[_[0],_[1],v]:_}function Ez(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=vz();d0(a,a,[0,0,-i]),RP(a,a,-n*Dr),kP(a,a,r*Dr);const u=s/e;return I1(a,a,[u,u,u]),o&&d0(a,a,k7([],o)),a}function Sz(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:u=1,farZMultiplier:h=1}=t;let{fovy:p=FA(bz)}=t;r!==void 0&&(p=FA(r));const _=p*Dr,v=i*Dr,b=D1(p);let E=b;o&&(E+=o[2]*a/Math.cos(v)/n);const R=_*(.5+(s?s[1]:0)/n),D=Math.sin(R)*E/Math.sin(h_(Math.PI/2-v-R,.01,Math.PI-.01)),P=Math.sin(v)*D+E,S=E*10,k=Math.min(P*h,S);return{fov:_,aspect:e/n,focalDistance:b,near:u,far:k}}function FA(t){return 2*Math.atan(.5/t)*d_}function D1(t){return .5/Math.tan(.5*t*Dr)}function ZP(t,e){const[n,r,i=0]=t;return os(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),Tl(e,[n,r,i,1])}function B1(t,e,n=0){const[r,i,s]=t;if(os(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Tl(e,[r,i,s,1]);const o=Tl(e,[r,i,0,1]),a=Tl(e,[r,i,1,1]),u=o[2],h=a[2],p=u===h?0:((n||0)-u)/(h-u);return yP([],o,a,p)}function Cz(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,u],[h,p]]=r,_=Pz(t.padding),v=$l([a,h_(p,-sl,sl)]),b=$l([h,h_(u,-sl,sl)]),E=[Math.max(Math.abs(b[0]-v[0]),i),Math.max(Math.abs(b[1]-v[1]),i)],R=[e-_.left-_.right-Math.abs(o[0])*2,n-_.top-_.bottom-Math.abs(o[1])*2];os(R[0]>0&&R[1]>0);const D=R[0]/E[0],P=R[1]/E[1],S=(_.right-_.left)/2/D,k=(_.top-_.bottom)/2/P,M=[(b[0]+v[0])/2+S,(b[1]+v[1])/2+k],V=Oi(M),Y=Math.min(s,N1(Math.abs(Math.min(D,P))));return os(Number.isFinite(Y)),{longitude:V[0],latitude:V[1],zoom:Y}}function Pz(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(os(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Cb=Math.PI/180;function Rz(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let u,h;const p=t.fovy?.5*t.fovy*Cb:Math.atan(.5/t.altitude),_=(90-t.pitch)*Cb;return p>_-.01?(u=Pb(t,0,e),h=Pb(t,n,e)):(u=i([0,0],s),h=i([n,0],s)),[o,a,h,u]}function Pb(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=Tl(r,[e,0,1,1]),s=Tl(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),u=yP([],i,s,a),h=Oi(u);return h.push(n),h}const Rb=512;function kz(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=Sb(i+180,360)-180),(a<-180||a>180)&&(a=Sb(a+180,360)-180);const u=N1(n/Rb);if(o<=u)o=u,s=0;else{const h=n/2/Math.pow(2,o),p=Oi([0,h])[1];if(s<p)s=p;else{const _=Oi([0,Rb-h])[1];s>_&&(s=_)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const KP=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,Iz=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,Mz=`
${KP}
${Iz}
`,Oz=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,Nz=`
${KP}
${Oz}
`,Dz=fu(zz),Bz=fu(Vz),Lz=[0,0,0,1],Fz=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function Uz(t,e){const[n,r,i]=t,s=B1([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function zz({viewport:t,center:e}){return new Xn(t.viewProjectionMatrix).invert().transform(e)}function Vz({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>Uz(o,r));for(const o of e){const a=o.clone().translate(new Ne(t.center).negate()),u=s.map(p=>a.transform(p)),h=new Xn().ortho({left:Math.min(...u.map(p=>p[0])),right:Math.max(...u.map(p=>p[0])),bottom:Math.min(...u.map(p=>p[1])),top:Math.max(...u.map(p=>p[1])),near:Math.min(...u.map(p=>-p[2])),far:Math.max(...u.map(p=>-p[2]))});n.push(h.multiplyRight(o))}return n}function $z(t){const{shadowEnabled:e=!0,project:n}=t;if(!e||!n||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r=O1.getUniforms(n),i=Dz({viewport:n.viewport,center:r.center}),s=[],o=Bz({shadowMatrices:t.shadowMatrices,viewport:n.viewport}).slice();for(let u=0;u<t.shadowMatrices.length;u++){const h=o[u],p=h.clone().translate(new Ne(n.viewport.center).negate());r.coordinateSystem===ut.LNGLAT&&r.projectionMode===dr.WEB_MERCATOR?(o[u]=p,s[u]=i):(o[u]=h.clone().multiplyRight(Fz),s[u]=p.transform(i))}const a={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||Lz,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let u=0;u<o.length;u++)a[`viewProjectionMatrix${u}`]=o[u],a[`projectCenter${u}`]=s[u];for(let u=0;u<2;u++)a[`shadow_uShadowMap${u}`]=t.shadowMaps&&t.shadowMaps[u]||t.dummyShadowMap;return a}const kb={name:"shadow",dependencies:[O1],vs:Mz,fs:Nz,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:$z,uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},du={...ab,defaultUniforms:{...ab.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},Wz=[FP],jz=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],Hz=[];function Xz(t){const e=t0.getDefaultShaderAssembler();for(const r of Wz)e.addDefaultModule(r);const n=t==="glsl"?jz:Hz;for(const r of n)e.addShaderHook(r);return e}const Qz=[255,255,255],Yz=1;let qz=0;class Zz{constructor(e={}){this.type="ambient";const{color:n=Qz}=e,{intensity:r=Yz}=e;this.id=e.id||`ambient-${qz++}`,this.color=n,this.intensity=r}}const Kz=[255,255,255],Gz=1,Jz=[0,0,-1];let eV=0;class Ib{constructor(e={}){this.type="directional";const{color:n=Kz}=e,{intensity:r=Gz}=e,{direction:i=Jz}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${eV++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new Ne(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class GP{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class L1 extends GP{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,u=e.colorMask??15,h={viewport:[0,0,n,r]};e.colorMask&&(h.colorMask=u),e.scissorRect&&(h.scissorRect=e.scissorRect);const p=this.device.beginRenderPass({framebuffer:e.target,parameters:h,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(p,e)}finally{p.end(),this.device.submit()}}_drawLayers(e,n){const{target:r,shaderModuleProps:i,viewports:s,views:o,onViewportActive:a,clearStack:u=!0}=n;n.pass=n.pass||"unknown",u&&(this._lastRenderIndex=-1);const h=[];for(const p of s){const _=o&&o[p.id];a==null||a(p);const v=this._getDrawLayerParams(p,n),b=p.subViewports||[p];for(const E of b){const R=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:E,view:_,pass:n.pass,layers:n.layers},v);h.push(R)}}return h}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,shaderModuleProps:u},h=!1){var E;const p=[],_=JP(this._lastRenderIndex+1),v={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},b={};for(let R=0;R<n.length;R++){const D=n[R],P=this._shouldDrawLayer(D,v,s,b),S={shouldDrawLayer:P};P&&!h&&(S.shouldDrawLayer=!0,S.layerRenderIndex=_(D,P),S.shaderModuleProps=this._getShaderModuleProps(D,a,r,u),S.layerParameters={...(E=D.context.deck)==null?void 0:E.props.parameters,...this.getLayerParameters(D,R,e)}),p[R]=S}return p}_drawLayersInViewport(e,{layers:n,shaderModuleProps:r,pass:i,target:s,viewport:o,view:a},u){const h=tV(this.device,{shaderModuleProps:r,target:s,viewport:o});if(a&&a.props.clear){const _=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:h,scissorRect:h},clearColor:_.color?[0,0,0,0]:!1,clearDepth:_.depth?1:!1}).end()}const p={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:h});for(let _=0;_<n.length;_++){const v=n[_],b=u[_],{shouldDrawLayer:E}=b;if(E&&v.props.pickable&&p.pickableCount++,v.isComposite&&p.compositeCount++,v.isDrawable&&b.shouldDrawLayer){const{layerRenderIndex:R,shaderModuleProps:D,layerParameters:P}=b;p.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,R),D.project&&(D.project.viewport=o),v.context.renderPass=e;try{v._drawLayer({renderPass:e,shaderModuleProps:D,uniforms:{layerIndex:R},parameters:P})}catch(S){v.raiseError(S,`drawing ${v} to ${i}`)}}}return p}shouldDrawLayer(e){return!0}getShaderModuleProps(e,n,r){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getShaderModuleProps(e,n,r,i){var u,h;const s=this.device.canvasContext.cssToDeviceRatio(),o=((u=e.internalState)==null?void 0:u.propsInTransition)||e.props,a={layer:o,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:o.modelMatrix,coordinateSystem:o.coordinateSystem,coordinateOrigin:o.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(n)for(const p of n)Mb(a,(h=p.getShaderModuleProps)==null?void 0:h.call(p,e,a));return Mb(a,this.getShaderModuleProps(e,n,a),i)}}function JP(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,u=i.parent&&i.parent.id;let h;if(u&&!(u in e)&&r(i.parent,!1),u in n){const p=n[u]=n[u]||JP(e[u],e);h=p(i,s),n[a]=p}else Number.isFinite(o)?(h=o+(e[u]||0),n[a]=null):h=t;return s&&h>=t&&(t=h+1),e[a]=h,h};return r}function tV(t,{shaderModuleProps:e,target:n,viewport:r}){var u;const i=((u=e==null?void 0:e.project)==null?void 0:u.devicePixelRatio)??t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}function Mb(t,...e){for(const n of e)if(n)for(const r in n)t[r]?Object.assign(t[r],n[r]):t[r]=n[r];return t}class nV extends L1{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getShaderModuleProps(e,n,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}const rV={color:[255,255,255],intensity:1},Ob=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],iV=[0,0,0,200/255];class eR{constructor(e={}){this.id="lighting-effect",this.shadowColor=iV,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(kb),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,n){const r=this.shadow?{project:n.project,shadowMaps:this.shadowPasses.map(o=>o.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(o=>o.getProjectedLight({layer:e})),pointLights:this.pointLights.map(o=>o.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(kb))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new Xn().lookAt({eye:new Ne(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new nV(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new Zz(rV),this.directionalLights.push(new Ib(Ob[0]),new Ib(Ob[1])))}}class sV{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:u}){const h=i||e&&e.constructor||Float32Array,p=n*r+s;if(ArrayBuffer.isView(e)){if(p<=e.length)return e;if(p*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new h(e.buffer,0,p)}let _=1/0;u&&(_=u*r+s);const v=this._allocate(h,p,a,_);return e&&o?v.set(e):a||v.fill(0,0,4),this._release(e),v}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,u=o.findIndex(h=>h.byteLength>=a);if(u>=0){const h=new e(o.splice(u,1)[0],0,s);return r&&h.fill(0),h}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const Wl=new sV;function Dc(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function oV(t){return[t[12],t[13],t[14]]}function aV(t){return{left:Oa(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:Oa(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:Oa(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:Oa(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:Oa(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:Oa(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Nb=new Ne;function Oa(t,e,n,r){Nb.set(t,e,n);const i=Nb.len();return{distance:r/i,normal:new Ne(-t/i,-e/i,-n/i)}}function lV(t){return t-Math.fround(t)}let vc;function lg(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;vc=Wl.allocate(vc,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let u=0;u<n;u++){const h=t[o++];vc[a+u]=h,vc[a+u+n]=lV(h)}a+=n*2}return vc.subarray(0,s*n*2)}function cV(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const AV=Math.PI/180,uV=Dc(),Db=[0,0,0],fV={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function hV({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const u=t/e,h=n?new Xn().orthographic({fovy:r,aspect:u,focalDistance:i,near:o,far:a}):new Xn().perspective({fovy:r,aspect:u,near:o,far:a});if(s){const{left:p=0,right:_=0,top:v=0,bottom:b=0}=s,E=Ws((p+t-_)/2,0,t)-t/2,R=Ws((v+e-b)/2,0,e)-e/2;h[8]-=E*2/t,h[9]+=R*2/e}return h}class _d{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||fV,this.focalDistance=e.focalDistance||1,this.position=e.position||Db,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?dr.WEB_MERCATOR:dr.WEB_MERCATOR_AUTO_OFFSET:dr.IDENTITY}equals(e){return e instanceof _d?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Ji(e.projectionMatrix,this.projectionMatrix)&&Ji(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=ZP(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,u=r&&r*this.distanceScales.unitsPerMeter[2],h=B1([i,a,o],this.pixelUnprojectionMatrix,u),[p,_,v]=this.unprojectPosition(h);return Number.isFinite(o)?[p,_,v]:Number.isFinite(r)?[p,_,r]:[p,_]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=$l(e);return n[1]=Ws(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?Oi(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?p_({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,aV(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=Tz({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||p_({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=Db;if(s&&(a=o?new Xn(o).transformAsVector(s,[]):s),this.isGeospatial){const u=this.projectPosition([n,r,0]);this.center=new Ne(a).scale(this.distanceScales.unitsPerMeter).add(u)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=uV,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:u=1e3,padding:h=null,focalDistance:p=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new Xn().multiplyRight(n).translate(new Ne(this.center).negate()),this.projectionMatrix=r||hV({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*AV,focalDistance:p,padding:h,near:a,far:u});const _=Dc();Vo(_,_,this.projectionMatrix),Vo(_,_,this.viewMatrix),this.viewProjectionMatrix=_,this.viewMatrixInverse=o_([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=oV(this.viewMatrixInverse);const v=Dc(),b=Dc();I1(v,v,[this.width/2,-this.height/2,1]),d0(v,v,[1,-1,0]),Vo(b,v,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=o_(Dc(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ot.warn("Pixel project matrix not invertible")()}}_d.displayName="Viewport";const F1=_d;class UA extends F1{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:u=1.01,nearZ:h,farZ:p,orthographic:_=!1,projectionMatrix:v,repeat:b=!1,worldOffset:E=0,position:R,padding:D,legacyMeterSizes:P=!1}=e;let{width:S,height:k,altitude:M=1.5}=e;const V=Math.pow(2,i);S=S||1,k=k||1;let Y,le=null;if(v)M=v[5]/2,Y=FA(M);else{e.fovy?(Y=e.fovy,M=D1(Y)):Y=FA(M);let O;if(D){const{top:U=0,bottom:$=0}=D;O=[0,Ws((U+k-$)/2,0,k)-k/2]}le=Sz({width:S,height:k,scale:V,center:R&&[0,0,R[2]*ag(n)],offset:O,pitch:s,fovy:Y,nearZMultiplier:a,farZMultiplier:u}),Number.isFinite(h)&&(le.near=h),Number.isFinite(p)&&(le.far=p)}let I=Ez({height:k,pitch:s,bearing:o,scale:V,altitude:M});E&&(I=new Xn().translate([512*E,0,0]).multiplyLeft(I)),super({...e,width:S,height:k,viewMatrix:I,longitude:r,latitude:n,zoom:i,...le,fovy:Y,focalDistance:M}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=M,this.fovy=Y,this.orthographic=_,this._subViewports=b?[]:null,this._pseudoMeters=P,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new UA({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*ag(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/ag(r);return[n,r,i]}addMetersToLngLat(e,n){return qP(e,n)}panByPosition(e,n){const r=B1(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=J3([],i,w7([],r)),o=J3([],this.center,s),[a,u]=this.unprojectFlat(o);return{longitude:a,latitude:u}}getBounds(e={}){const n=Rz(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=Cz({width:r,height:i,bounds:e,...n});return new UA({width:r,height:i,longitude:s,latitude:o,zoom:a})}}UA.displayName="WebMercatorViewport";const m0=UA,Bb=[0,0,0];function cg(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof m0){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function dV(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===ut.DEFAULT&&(i=e.isGeospatial?ut.LNGLAT:ut.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function tR(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,u=0]=t;switch(n&&([o,a,u]=ql([],[o,a,u,1],n)),r){case ut.LNGLAT:return cg([o,a,u],e,s);case ut.LNGLAT_OFFSETS:return cg([o+i[0],a+i[1],u+(i[2]||0)],e,s);case ut.METER_OFFSETS:return cg(qP(i,[o,a,u]),e,s);case ut.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],u+i[2]]:e.projectPosition([o,a,u])}}function pV(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=dV(e),{autoOffset:u=!0}=e,{geospatialOrigin:h=Bb,shaderCoordinateOrigin:p=Bb,offsetMode:_=!1}=u?QP(n,r,i):{},v=tR(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:_});if(_){const b=n.projectPosition(h||p);SP(v,v,b)}return v}let gV=1,mV=1;class nR{constructor(){L(this,"time",0);L(this,"channels",new Map);L(this,"animations",new Map);L(this,"playing",!1);L(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=gV++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=mV++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function _V(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function yV(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let vV=0;const wV={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:Ym.stats.get(`animation-loop-${vV++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class bV{constructor(e){L(this,"device",null);L(this,"canvas",null);L(this,"props");L(this,"animationProps",null);L(this,"timeline",null);L(this,"stats");L(this,"cpuTime");L(this,"gpuTime");L(this,"frameRate");L(this,"display");L(this,"needsRedraw","initialized");L(this,"_initialized",!1);L(this,"_running",!1);L(this,"_animationFrameId",null);L(this,"_nextFramePromise",null);L(this,"_resolveNextFrame",null);L(this,"_cpuStartTime",0);L(this,"_error",null);if(this.props={...wV,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new cu({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=_V(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(yV(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,r;const e=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,u;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(u=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:u.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const Ag={};function pu(t="id"){Ag[t]=Ag[t]||1;const e=Ag[t]++;return`${t}-${e}`}class Lb{constructor(e){L(this,"id");L(this,"userData",{});L(this,"topology");L(this,"bufferLayout",[]);L(this,"vertexCount");L(this,"indices");L(this,"attributes");if(this.id=e.id||pu("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&Dt.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function xV(t,e){if(e instanceof Lb)return e;const n=TV(t,e),{attributes:r,bufferLayout:i}=EV(t,e);return new Lb({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function TV(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:Dt.INDEX,data:n})}function EV(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:u,size:h,normalized:p}=o;n.push({name:a,format:DF(u,h,p)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const q0=class q0{constructor(e){L(this,"device");L(this,"destroyPolicy");L(this,"_hashCounter",0);L(this,"_hashes",{});L(this,"_renderPipelineCache",{});L(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new q0(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Ul.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...o0.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof o0?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&this.destroyPolicy==="unused"&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};L(q0,"defaultProps",{...Ul.defaultProps});let g_=q0;const Z0=class Z0{constructor(e){L(this,"device");L(this,"destroyPolicy");L(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new Z0(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};L(Z0,"defaultProps",{...r0.defaultProps});let m_=Z0;function SV(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let fn=null,xo=null;function CV(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){fn||(fn=document.createElement("canvas"),fn.id=e,fn.title=e,fn.style.zIndex="100",fn.style.position="absolute",fn.style.top=i,fn.style.left=s,fn.style.border="blue 5px solid",fn.style.transform="scaleY(-1)",document.body.appendChild(fn),xo=fn.getContext("2d")),(fn.width!==t.width||fn.height!==t.height)&&(fn.width=t.width/2,fn.height=t.height/2,fn.style.width="400px",fn.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),u=xo==null?void 0:xo.createImageData(t.width,t.height);if(u){for(let p=0;p<a.length;p+=4)u.data[0+p+0]=a[p+0]*o,u.data[0+p+1]=a[p+1]*o,u.data[0+p+2]=a[p+2]*o,u.data[0+p+3]=r?255:a[p+3]*o;xo==null||xo.putImageData(u,0,0)}}function __(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!__(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!__(t[s],e[s],n-1))return!1;return!0}return!1}function PV(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function RV(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function rR(t){return PV(t)||RV(t)}function kV(t){return rR(t)||typeof t=="number"||typeof t=="boolean"}function iR(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];kV(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class IV{constructor(e,n){L(this,"options",{disableWarnings:!1});L(this,"modules");L(this,"moduleUniforms");L(this,"moduleBindings");Object.assign(this.options,n);const r=m1(Object.values(e).filter(i=>i.dependencies));for(const i of r)e[i.name]=i;Ee.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[i,s]of Object.entries(e))this._addModule(s),s.name&&i!==s.name&&!this.options.disableWarnings&&Ee.warn(`Module name: ${i} vs ${s.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){this.options.disableWarnings||Ee.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],u=this.moduleBindings[i],h=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:p,bindings:_}=iR(h);this.moduleUniforms[i]={...a,...p},this.moduleBindings[i]={...u,..._}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let MV="";async function OV(t,e){const n=new Image;return n.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",n.src=t.startsWith("http")?t:MV+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class ug{constructor(e,n){L(this,"device");L(this,"id");L(this,"texture");L(this,"sampler");L(this,"view");L(this,"ready");L(this,"isReady",!1);L(this,"destroyed",!1);L(this,"resolveReady",()=>{});L(this,"rejectReady",()=>{});this.device=e,this.id=n.id||pu("async-texture"),typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:OV(n.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(n)}get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}async initAsync(e){const n=e.data;let r;try{r=await sR(n)}catch(s){this.rejectReady(s)}if(this.destroyed)return;const i={...e,data:r};this.texture=this.device.createTexture(i),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0,this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function sR(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(sR));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const To=2,NV=1e4,K0=class K0{constructor(e,n){L(this,"device");L(this,"id");L(this,"source");L(this,"vs");L(this,"fs");L(this,"pipelineFactory");L(this,"shaderFactory");L(this,"userData",{});L(this,"parameters");L(this,"topology");L(this,"bufferLayout");L(this,"isInstanced");L(this,"instanceCount",0);L(this,"vertexCount");L(this,"indexBuffer",null);L(this,"bufferAttributes",{});L(this,"constantAttributes",{});L(this,"bindings",{});L(this,"uniforms",{});L(this,"vertexArray");L(this,"transformFeedback",null);L(this,"pipeline");L(this,"shaderInputs");L(this,"_uniformStore");L(this,"_attributeInfos",{});L(this,"_gpuGeometry",null);L(this,"_getModuleUniforms");L(this,"props");L(this,"_pipelineNeedsUpdate","newly created");L(this,"_needsRedraw","initializing");L(this,"_destroyed",!1);L(this,"_lastDrawTimestamp",-1);L(this,"_lastLogTime",0);L(this,"_logOpen",!1);L(this,"_drawCount",0);var u,h,p,_;this.props={...K0.defaultProps,...n},n=this.props,this.id=n.id||pu("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((u=this.props.modules)==null?void 0:u.map(v=>[v.name,v]))||[]),i=n.shaderInputs||new IV(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);const s=BV(e),o=(((h=this.props.modules)==null?void 0:h.length)>0?this.props.modules:(p=this.shaderInputs)==null?void 0:p.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){const{source:v,getUniforms:b}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:o});this.source=v,this._getModuleUniforms=b,(_=this.props).shaderLayout||(_.shaderLayout=f7(this.source))}else{const{vs:v,fs:b,getUniforms:E}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:o});this.vs=v,this.fs=b,this._getModuleUniforms=E}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||g_.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||m_.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniformsWebGL(n.uniforms),n.moduleSettings&&this.updateModuleSettingsWebGL(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){const n=this._areBindingsLoading();if(n)return Ee.info(To,`>>> DRAWING ABORTED ${this.id}: ${n} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}let r;try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();const i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings}),y_(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:s}=this.vertexArray,o=s?s.byteLength/(s.indexType==="uint32"?4:2):void 0;r=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:o,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),r?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",r}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&xV(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new Kp(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new Kp(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){__(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new NF(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(DV(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&Ee.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=BF(this.pipeline.shaderLayout,this.bufferLayout);const i=new Kp(this.bufferLayout);for(const[s,o]of Object.entries(e)){const a=i.getBufferLayout(s);if(!a){r||Ee.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const u=i.getAttributeNamesForBuffer(a);let h=!1;for(const p of u){const _=this._attributeInfos[p];if(_){const v=this.device.type==="webgpu"?i.getBufferIndex(_.bufferName):_.location;this.vertexArray.setBuffer(v,o),h=!0}}!h&&!r&&Ee.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||Ee.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){y_(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){const{bindings:n,uniforms:r}=iR(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(const e of Object.values(this.bindings))if(e instanceof ug&&!e.isReady)return e.id;return!1}_getBindings(){const e={};for(const[n,r]of Object.entries(this.bindings))r instanceof ug?r.isReady&&(e[n]=r.texture):e[n]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof n0?e=Math.max(e,n.texture.updateTimestamp):n instanceof Dt||n instanceof Qt?e=Math.max(e,n.updateTimestamp):n instanceof ug?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof i0||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(Ee.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=QC(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=Ee.level>3?0:NV;Ee.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,Ee.group(To,`>>> DRAWING MODEL ${this.id}`,{collapsed:Ee.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=SV(this.pipeline.shaderLayout,this.id);Ee.table(To,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};Ee.table(To,n)();const r=this._getAttributeDebugTable();Ee.table(To,this._attributeInfos)(),Ee.table(To,r)(),Ee.groupEnd(To)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&CV(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=ZC(n);return(e instanceof Dt?new r(e.debugData):e).toString()}};L(K0,"defaultProps",{...Ul.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:t0.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Br=K0;function DV(t){return!!(t.uniformTypes&&!y_(t.uniformTypes))}function BV(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function y_(t){for(const e in t)return!1;return!0}const mA=class mA{constructor(e,n=mA.defaultProps){L(this,"device");L(this,"model");L(this,"transformFeedback");if(!mA.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Br(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||L5(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof Dt)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};L(mA,"defaultProps",{...Br.defaultProps,outputs:void 0,feedbackBuffers:void 0});let zA=mA;class ea{constructor(e){L(this,"id");L(this,"topology");L(this,"vertexCount");L(this,"indices");L(this,"attributes");L(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||pu("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const LV=`struct VertexInputs {
  @location(0) clipSpacePosition: vec2<f32>,
  @location(1) texCoord: vec2<f32>,
  @location(2) coordinate: vec2<f32>  
}

struct FragmentInputs {
  @builtin(position) Position : vec4<f32>,
  @location(0) position : vec2<f32>,
  @location(1) coordinate : vec2<f32>,
  @location(2) uv : vec2<f32>
};

@vertex
fn vertexMain(inputs: VertexInputs) -> FragmentInputs {
  var outputs: FragmentInputs;
  outputs.Position = vec4(inputs.clipSpacePosition, 0., 1.);
  outputs.position = inputs.clipSpacePosition;
  outputs.coordinate = inputs.coordinate;
  outputs.uv = inputs.texCoord;
  return outputs;
}
`,FV=`#version 300 es
in vec2 clipSpacePositions;
in vec2 texCoords;
in vec2 coordinates;

out vec2 position;
out vec2 coordinate;
out vec2 uv;

void main(void) {
  gl_Position = vec4(clipSpacePositions, 0., 1.);
  position = clipSpacePositions;
  coordinate = coordinates;
  uv = texCoords;
}
`,Fb=[-1,-1,1,-1,-1,1,1,1];class UV extends Br{constructor(e,n){const r=Fb.map(i=>i===-1?0:i);n.source&&(n={...n,source:`${LV}
${n.source}`}),super(e,{id:n.id||pu("clip-space"),...n,vs:FV,vertexCount:4,geometry:new ea({topology:"triangle-strip",vertexCount:4,attributes:{clipSpacePositions:{size:2,value:new Float32Array(Fb)},texCoords:{size:2,value:new Float32Array(r)},coordinates:{size:2,value:new Float32Array(r)}}})})}}const zV=`uniform screenUniforms {
  vec2 texSize;
} screen;
`,VV={name:"screen",fs:zV,uniformTypes:{texSize:"vec2<f32>"}};class $V extends GP{constructor(e,n){super(e,n);const{module:r,fs:i,id:s}=n,o={depthWriteEnabled:!1,depthCompare:"always"};this.model=new UV(e,{id:s,fs:i,modules:[r,VV],parameters:o})}render(e){this._renderPass(this.device,e)}delete(){this.model.destroy(),this.model=null}_renderPass(e,n){const{clearCanvas:r,inputBuffer:i,outputBuffer:s}=n,o=[i.width,i.height],a={texSrc:i.colorAttachments[0],texSize:o};this.model.shaderInputs.setProps({screen:a,...n.moduleProps});const u=this.device.beginRenderPass({framebuffer:s,parameters:{viewport:[0,0,...o]},clearColor:r?[0,0,0,0]:!1,clearDepth:1,clearStencil:!1});this.model.draw(u),u.end()}}class WV{constructor(e,n){this.id=`${e.name}-pass`,this.props=n,IC(e),this.module=e}setup({device:e}){this.passes=jV(e,this.module,this.id)}setProps(e){this.props=e}preRender(){}postRender(e){const n=this.passes,{target:r}=e;let i=e.inputBuffer,s=e.swapBuffer;for(let o=0;o<n.length;o++){const a=o===n.length-1,u=r!==void 0&&a;u&&(s=r);const h=!u||!!e.clearCanvas,p={},_=this.module.passes[o].uniforms;p[this.module.name]={...this.props,..._},n[o].render({clearCanvas:h,inputBuffer:i,outputBuffer:s,moduleProps:p});const v=s;s=i,i=v}return i}cleanup(){if(this.passes){for(const e of this.passes)e.delete();this.passes=void 0}}}function jV(t,e,n){return e.passes.map((r,i)=>{const s=QV(e,r),o=`${n}-${i}`;return new $V(t,{id:o,module:e,fs:s})})}const oR=`#version 300 es
uniform sampler2D texSrc;

in vec2 position;
in vec2 coordinate;
in vec2 uv;

out vec4 fragColor;
`,HV=t=>`${oR}
void main() {
  fragColor = texture(texSrc, coordinate);
  fragColor = ${t}(fragColor, screen.texSize, coordinate);
}
`,XV=t=>`${oR}
void main() {
  fragColor = ${t}(texSrc, screen.texSize, coordinate);
}
`;function QV(t,e){if(e.filter){const n=typeof e.filter=="string"?e.filter:`${t.name}_filterColor_ext`;return HV(n)}if(e.sampler){const n=typeof e.sampler=="string"?e.sampler:`${t.name}_sampleColor`;return XV(n)}return""}const YV={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class aR extends L1{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:u,width:h,height:p},cullRect:_,effects:v,pass:b="picking",pickZ:E,shaderModuleProps:R}){this.pickZ=E;const D=this._resetColorEncoder(E),P=[a,u,h,p],S=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:_,effects:v==null?void 0:v.filter(M=>M.useInPicking),pass:b,isPicking:!0,shaderModuleProps:R,clearColor:[0,0,0,0],colorMask:15,scissorRect:P});return this._colorEncoderState=null,{decodePickingColor:D&&ZV.bind(null,D),stats:S}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,n,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,n,r){const i={...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,YV),i.blend=!0,i.blendColor=qV(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function qV(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(ot.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function ZV(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Wa={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},_0=Symbol.for("component"),io=Symbol.for("propTypes"),fg=Symbol.for("deprecatedProps"),El=Symbol.for("asyncPropDefaults"),ta=Symbol.for("asyncPropOriginal"),js=Symbol.for("asyncPropResolved");function yd(t,e=()=>!0){return Array.isArray(t)?lR(t,e,[]):e(t)?[t]:[]}function lR(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?lR(i,e,n):e(i)&&n.push(i)}return n}function KV({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class GV{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Gh(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class JV{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new GV(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const u=a&&a.resourceId&&this._resources[a.resourceId];u&&(u.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const e$="layerManager.setLayers",t$="layerManager.activateViewport";class n${constructor(e,n){var a;this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=u=>{Dn(t$,this,u),u&&(this.context.viewport=u)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new JV({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:Xz(((a=e==null?void 0:e.info)==null?void 0:a.shadingLanguage)||"glsl"),defaultShaderModules:[n9],renderPass:void 0,stats:i||new cu({id:"deck.gl"}),viewport:s||new F1({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new nR,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){Dn(e$,this,n,e),this._lastRenderedLayers=e;const r=yd(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?ot.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&ot.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Wa.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Wa.MATCHED,n!==e&&(e.lifecycle=Wa.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Wa.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Wa.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function pr(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!pr(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!pr(t[s],e[s],n-1))return!1;return!0}return!1}class r${constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=yd(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!pr(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ot.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let u=n[s.id];const h=!!s.controller;h&&!u&&(r=!0),(r||!h)&&u&&(u.finalize(),u=null),this.controllers[s.id]=this._updateController(s,o,a,u),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const i$=/([0-9]+\.?[0-9]*)(%|px)/;function ws(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=i$.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function bs(t,e){return t.relative?Math.round(t.position*e):t.position}class jl{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=ws(r),this._y=ws(i),this._width=ws(s),this._height=ws(o),this._padding=a&&{left:ws(a.left||0),right:ws(a.right||0),top:ws(a.top||0),bottom:ws(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.constructor===e.constructor&&pr(this.props,e.props,2)}clone(e){const n=this.constructor;return new n({...this.props,...e})}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});if(!i.height||!i.width)return null;const s=this.getViewportType(r);return new s({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:bs(this._x,e),y:bs(this._y,n),width:bs(this._width,e),height:bs(this._height,n)};return this._padding&&(r.padding={left:bs(this._padding.left,e),top:bs(this._padding.top,n),right:bs(this._padding.right,e),bottom:bs(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class vd{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Ub=()=>{},v_={BREAK:1,SNAP_TO_END:2,IGNORE:3},s$=t=>t,o$=v_.BREAK;class a${constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:u}}=n,h=u(r/a),p=i.interpolateProps(s,o,h);this.propsInTransition=this.getControllerState({...this.props,...p}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new vd(e.timeline),this.onViewStateChange=e.onViewStateChange||Ub,this.onStateChange=e.onStateChange||Ub}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===v_.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===v_.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const u={duration:o,easing:n.transitionEasing||s$,interpolator:s,interruption:n.transitionInterruption||o$,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(u),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function bn(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class l${constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Ji(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];bn(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const c$=["longitude","latitude","zoom","bearing","pitch"],A$=["longitude","latitude","zoom"];class cR extends l${constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:c$,required:A$},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),u=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(u),aroundPosition:u,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=h0(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,h0(e.around,n.around,r)))}return i}}const xs={transitionDuration:0},u$=300,hf=t=>1-(1-t)*(1-t),Na={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},Eo={};class f${constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new a$({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return n?!1:this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?u$:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:u=!1,keyboard:h=!0}=e,p=!!this.onViewStateChange;this.toggleEvents(Na.WHEEL,p&&r),this.toggleEvents(Na.PAN,p),this.toggleEvents(Na.PINCH,p&&(a||u)),this.toggleEvents(Na.MULTI_PAN,p&&u),this.toggleEvents(Na.DOUBLE_CLICK,p&&o),this.toggleEvents(Na.KEYBOARD,p&&h),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=u,this.keyboard=h}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,xs,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,xs,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:hf},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,xs,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:hf},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,xs,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,xs,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:hf},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return Eo._startPinchRotation=e.rotation,Eo._lastPinchEvent=e,this.updateViewport(r,xs,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:Eo._startPinchRotation-r})}return this.updateViewport(n,xs,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),Eo._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=Eo;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),u=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:u}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:hf},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return Eo._startPinchRotation=null,Eo._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let u;const h={};switch(e.srcEvent.code){case"Minus":u=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),h.isZooming=!0;break;case"Equal":u=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),h.isZooming=!0;break;case"ArrowLeft":n?(u=a.rotateLeft(s),h.isRotating=!0):(u=a.moveLeft(i),h.isPanning=!0);break;case"ArrowRight":n?(u=a.rotateRight(s),h.isRotating=!0):(u=a.moveRight(i),h.isPanning=!0);break;case"ArrowUp":n?(u=a.rotateUp(o),h.isRotating=!0):(u=a.moveUp(i),h.isPanning=!0);break;case"ArrowDown":n?(u=a.rotateDown(o),h.isRotating=!0):(u=a.moveDown(i),h.isPanning=!0);break;default:return!1}return this.updateViewport(u,this._getTransitionProps(),h),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?xs:e?{...n,transitionInterpolator:new cR({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class h${constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const zb=5,d$=1.2;class p$ extends h${constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:u=0,altitude:h=1.5,position:p=[0,0,0],maxZoom:_=20,minZoom:v=0,maxPitch:b=60,minPitch:E=0,startPanLngLat:R,startZoomLngLat:D,startRotatePos:P,startBearing:S,startPitch:k,startZoom:M,normalize:V=!0}=e;bn(Number.isFinite(s)),bn(Number.isFinite(i)),bn(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:u,altitude:h,maxZoom:_,minZoom:v,maxPitch:b,minPitch:E,normalize:V,position:p},{startPanLngLat:R,startZoomLngLat:D,startRotatePos:P,startBearing:S,startPitch:k,startZoom:M}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let u=i+Math.log2(r);u=Ws(u,a,o);const h=this.makeViewport({...this.getViewportProps(),zoom:u});return this._getUpdatedState({zoom:u,...h.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Ws(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=Ws(a,o,s);const{normalize:u=!0}=e;return u&&Object.assign(e,kz(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],u=n[1],{width:h,height:p}=this.getViewportProps(),_=s/h;let v=0;o>0?Math.abs(p-u)>zb&&(v=o/(u-p)*d$):o<0&&u>zb&&(v=1-a/u),v=Ws(v,-1,1);const{minPitch:b,maxPitch:E}=this.getViewportProps(),R=i+180*_;let D=r;return v>0?D=r+v*(E-r):v<0&&(D=r-v*(b-r)),{pitch:D,bearing:R}}}class g$ extends f${constructor(){super(...arguments),this.ControllerState=p$,this.transition={transitionDuration:300,transitionInterpolator:new cR({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class AR extends jl{constructor(e={}){super(e)}getViewportType(){return m0}get ControllerType(){return g$}}AR.displayName="MapView";const m$=AR,_$=new eR;function y$(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class v${constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>y$(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(pr(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof eR)||this._resolvedEffects.push(_$),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class w$ extends L1{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const b$="deckRenderer.renderLayers";class x${constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new w$(e),this.pickLayersPass=new aR(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,Dn(b$,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const T$={pickedColor:null,pickedObjectIndex:-1};function E$({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:u,height:h}=s;let p=i*i,_=-1,v=0;for(let b=0;b<h;b++){const E=b+a-r,R=E*E;if(R>p)v+=4*u;else for(let D=0;D<u;D++){if(t[v+3]-1>=0){const S=D+o-n,k=S*S+R;k<=p&&(p=k,_=v)}v+=4}}if(_>=0){const b=t.slice(_,_+4),E=e(b);if(E){const R=Math.floor(_/4/u),D=_/4-R*u;return{...E,pickedColor:b,pickedX:o+D,pickedY:a+R}}ot.error("Picked non-existent layer. Is picking buffer corrupt?")()}return T$}function S$({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):ot.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function uR({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=P$((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const u=[r-o.x,i-o.y];s!==void 0&&(u[2]=s),a=o.unproject(u)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function C$(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,u=o?[o]:[];if(r==="hover"){const _=n.index,v=n.layerId,b=o?o.props.id:null;if(b!==v||a!==_){if(b!==v){const E=i.find(R=>R.props.id===v);E&&u.unshift(E)}n.layerId=b,n.index=a,n.info=null}}const h=uR(t),p=new Map;return p.set(null,h),u.forEach(_=>{let v={...h};_===o&&(v.color=s,v.index=a,v.picked=!0),v=fR({layer:_,info:v,mode:r});const b=v.layer;_===o&&r==="hover"&&(n.info=v),p.set(b.id,v),r==="hover"&&b.updateAutoHighlight(v)}),p}function fR({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function P$(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class R${constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new aR(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,u=o?r.find(v=>v.id===o):null,h=a&&i.find(v=>v.id===a)||i[0],p=h&&h.unproject([e-h.x,n-h.y]);return{...s,...{x:e,y:n,viewport:h,coordinate:p,layer:u}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getDefaultCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:u="query",unproject3D:h,onViewportActive:p,effects:_}){const v=this.device.canvasContext.cssToDeviceRatio(),b=this._getPickable(e);if(!b||r.length===0)return{result:[],emptyInfo:uR({viewports:r,x:i,y:s,pixelRatio:v})};this._resizeBuffer();const E=this.device.canvasContext.cssToDevicePixels([i,s],!0),R=[E.x+Math.floor(E.width/2),E.y+Math.floor(E.height/2)],D=Math.round(o*v),{width:P,height:S}=this.pickingFBO,k=this._getPickingRect({deviceX:R[0],deviceY:R[1],deviceRadius:D,deviceWidth:P,deviceHeight:S}),M={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let V;const Y=[],le=new Set;for(let I=0;I<a;I++){let O;if(k){const $=this._drawAndSample({layers:b,views:n,viewports:r,onViewportActive:p,deviceRect:k,cullRect:M,effects:_,pass:`picking:${u}`});O=E$({...$,deviceX:R[0],deviceY:R[1],deviceRadius:D,deviceRect:k})}else O={pickedColor:null,pickedObjectIndex:-1};let U;if(O.pickedLayer&&h&&this.depthFBO){const{pickedColors:$}=this._drawAndSample({layers:[O.pickedLayer],views:n,viewports:r,onViewportActive:p,deviceRect:{x:O.pickedX,y:O.pickedY,width:1,height:1},cullRect:M,effects:_,pass:`picking:${u}:z`},!0);$[3]&&(U=$[0])}O.pickedLayer&&I+1<a&&(le.add(O.pickedLayer),O.pickedLayer.disablePickingIndex(O.pickedObjectIndex)),V=C$({pickInfo:O,lastPickedInfo:this.lastPickedInfo,mode:u,layers:b,viewports:r,x:i,y:s,z:U,pixelRatio:v});for(const $ of V.values())$.layer&&Y.push($);if(!O.pickedColor)break}for(const I of le)I.restorePickingColors();return{result:Y,emptyInfo:V.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:u="query",maxObjects:h=null,onViewportActive:p,effects:_}){const v=this._getPickable(e);if(!v||r.length===0)return[];this._resizeBuffer();const b=this.device.canvasContext.cssToDeviceRatio(),E=this.device.canvasContext.cssToDevicePixels([i,s],!0),R=E.x,D=E.y+E.height,P=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),S=P.x+P.width,k=P.y,M={x:R,y:k,width:S-R,height:D-k},V=this._drawAndSample({layers:v,views:n,viewports:r,onViewportActive:p,deviceRect:M,cullRect:{x:i,y:s,width:o,height:a},effects:_,pass:`picking:${u}`}),Y=S$(V),le=new Map,I=[],O=Number.isFinite(h);for(let U=0;U<Y.length&&!(O&&I.length>=h);U++){const $=Y[U];let q={color:$.pickedColor,layer:null,index:$.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:b};q=fR({layer:$.pickedLayer,info:q,mode:u});const Z=q.layer.id;le.has(Z)||le.set(Z,new Set);const ee=le.get(Z),G=q.object??q.index;ee.has(G)||(ee.add(G),I.push(q))}return I}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:u},h=!1){const p=h?this.depthFBO:this.pickingFBO,_={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:p,deviceRect:s,cullRect:o,effects:a,pass:u,pickZ:h,preRenderStats:{},isPicking:!0};for(const S of a)S.useInPicking&&(_.preRenderStats[S.id]=S.preRender(_));const{decodePickingColor:v}=this.pickLayersPass.render(_),{x:b,y:E,width:R,height:D}=s,P=new(h?Float32Array:Uint8Array)(R*D*4);return this.device.readPixelsToArrayWebGL(p,{sourceX:b,sourceY:E,sourceWidth:R,sourceHeight:D,target:P}),{pickedColors:P,decodePickingColor:v}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),u=Math.min(i,e+r+1)-o,h=Math.min(s,n+r+1)-a;return u<=0||h<=0?null:{x:o,y:a,width:u,height:h}}}const k$={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},I$="top-left",Vb="__root";class M${constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,n==null||n.classList.add("deck-widget-container"),this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!pr(e.widgets,this.widgets,1)){const n=e.widgets.filter(Boolean);this._setWidgets(n)}}finalize(){for(const e of this.getWidgets())this._removeWidget(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:n}){var i,s;const r=e.reduce((o,a)=>(o[a.id]=a,o),{});for(const o of this.getWidgets()){const{viewId:a}=o;if(a){const u=r[a];u&&(o.onViewportChange&&o.onViewportChange(u),(i=o.onRedraw)==null||i.call(o,{viewports:[u],layers:n}))}else{if(o.onViewportChange)for(const u of e)o.onViewportChange(u);(s=o.onRedraw)==null||s.call(o,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=f_[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r])==null||s.call(o,e,n))}}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._removeWidget(i),this._addWidget(r)):r!==i&&(i.setProps(r.props),r=i):this._addWidget(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._removeWidget(i)}this.widgets=e}_addWidget(e){var i;const{viewId:n=null,placement:r=I$}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e.onCreateRootElement(),e.rootElement&&this._getContainer(n,r).append(e.rootElement),(i=e.onAdd)==null||i.call(e,{deck:this.deck,viewId:n}),e.updateHTML()}_removeWidget(e){var n;(n=e.onRemove)==null||n.call(e),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,n){var o;const r=e||Vb;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=globalThis.document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,k$[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===Vb||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}}function $b(t,e){e&&Object.entries(e).map(([n,r])=>{n.startsWith("--")?t.style.setProperty(n,r):t.style[n]=r})}function O$(t,e){e&&Object.keys(e).map(n=>{n.startsWith("--")?t.style.removeProperty(n):t.style[n]=""})}class U1{constructor(e,n){this.viewId=null,this.props={...n,...e},this.id=this.props.id}setProps(e){const n=this.props,r=this.rootElement;r&&n.className!==e.className&&(n.className&&r.classList.remove(n.className),e.className&&r.classList.add(e.className)),r&&!pr(n.style,e.style,1)&&(O$(r,n.style),$b(r,e.style)),Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){const e=["deck-widget",this.className,this.props.className],n=document.createElement("div");return e.filter(r=>typeof r=="string"&&r.length>0).forEach(r=>n.classList.add(r)),$b(n,this.props.style),n}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,n){}onClick(e,n){}onDrag(e,n){}onDragStart(e,n){}onDragEnd(e,n){}}U1.defaultProps={id:"widget",style:{},className:""};const N$={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class wd extends U1{constructor(e={}){super(e,wd.defaultProps),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){const e=document.createElement("div");return e.className=this.className,Object.assign(e.style,N$),e}onRenderHTML(e){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.rootElement;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}wd.defaultProps={...U1.defaultProps};var ol;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(ol||(ol={}));const z1={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Jt=(t,e,n)=>e?t.enable(n):t.disable(n),Wb=(t,e,n)=>t.hint(n,e),Ar=(t,e,n)=>t.pixelStorei(n,e),jb=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},wc=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function hg(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const D$={3042:Jt,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Jt,2885:(t,e)=>t.cullFace(e),2929:Jt,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Jt,35723:Wb,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:jb,36010:jb,34964:wc,36662:wc,36663:wc,35053:wc,35055:wc,2886:(t,e)=>t.frontFace(e),33170:Wb,2849:(t,e)=>t.lineWidth(e),32823:Jt,32824:"polygonOffset",10752:"polygonOffset",35977:Jt,32926:Jt,32928:Jt,32938:"sampleCoverage",32939:"sampleCoverage",3089:Jt,3088:(t,e)=>t.scissor(...e),2960:Jt,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Jt,10754:Jt,12288:Jt,12289:Jt,12290:Jt,12291:Jt,12292:Jt,12293:Jt,12294:Jt,12295:Jt,3333:Ar,3317:Ar,37440:Ar,37441:Ar,37443:Ar,3330:Ar,3332:Ar,3331:Ar,3314:Ar,32878:Ar,3316:Ar,3315:Ar,32877:Ar,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=hg(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=hg(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=hg(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function Xt(t,e,n){return e[t]!==void 0?e[t]:n[t]}const B$={blendEquation:(t,e,n)=>t.blendEquationSeparate(Xt(32777,e,n),Xt(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(Xt(32969,e,n),Xt(32968,e,n),Xt(32971,e,n),Xt(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(Xt(32824,e,n),Xt(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(Xt(32938,e,n),Xt(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,Xt(2962,e,n),Xt(2967,e,n),Xt(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,Xt(34816,e,n),Xt(36003,e,n),Xt(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,Xt(2964,e,n),Xt(2965,e,n),Xt(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,Xt(34817,e,n),Xt(34818,e,n),Xt(34819,e,n))},Hb={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},gi=(t,e)=>t.isEnabled(e),Xb={3042:gi,2884:gi,2929:gi,3024:gi,32823:gi,32926:gi,32928:gi,3089:gi,2960:gi,35977:gi},L$=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Zl(t,e){if(U$(e))return;const n={};for(const i in e){const s=Number(i),o=D$[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=B$[i];s(t,e,r)}}function hR(t,e=z1){if(typeof e=="number"){const i=e,s=Xb[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=Xb[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function F$(t){Zl(t,z1)}function U$(t){for(const e in t)return!1;return!0}function z$(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class $o{constructor(e,n){L(this,"gl");L(this,"program",null);L(this,"stateStack",[]);L(this,"enable",!0);L(this,"cache",null);L(this,"log");L(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Zl(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?hR(e):Object.assign({},z1),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,$$(e);for(const r in Hb){const i=Hb[r];V$(e,r,i)}Qb(e,"getParameter"),Qb(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],a=this.cache[s];z$(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function Qb(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||L$.has(i))return n(i);const s=$o.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function V$(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=$o.get(t),{valueChanged:a,oldValue:u}=n(o._updateCache,...s);return a&&r(...s),u},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function $$(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=$o.get(t);i.program!==r&&(e(r),i.program=r)}}function W$(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:a}=e;return t.addEventListener("webglcontextlost",u=>o(u),!1),t.addEventListener("webglcontextrestored",u=>a(u),!1),s.luma||(s.luma={}),s}function Hl(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function j$(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);Hl(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,u=o||r,h=t.getParameter(7938),p=dR(a,u),_=H$(a,u),v=X$(a,u);return{type:"webgl",gpu:p,gpuType:v,gpuBackend:_,vendor:a,renderer:u,version:h,shadingLanguage:"glsl",shadingLanguageVersion:300}}function dR(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function H$(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function X$(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(dR(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function pR(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const Bc="WEBGL_compressed_texture_s3tc",Lc="WEBGL_compressed_texture_s3tc_srgb",al="EXT_texture_compression_rgtc",ll="EXT_texture_compression_bptc",Q$="WEBGL_compressed_texture_etc",Y$="WEBGL_compressed_texture_astc",q$="WEBGL_compressed_texture_etc1",Z$="WEBGL_compressed_texture_pvrtc",K$="WEBGL_compressed_texture_atc",Yb="EXT_texture_norm16",qb="EXT_render_snorm",G$="EXT_color_buffer_float",V1={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[qb],"norm16-renderable-webgl":[Yb],"snorm16-renderable-webgl":[Yb,qb],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Bc,Lc,al,ll],"texture-compression-bc5-webgl":[al],"texture-compression-bc7-webgl":[ll],"texture-compression-etc2":[Q$],"texture-compression-astc":[Y$],"texture-compression-etc1-webgl":[q$],"texture-compression-pvrtc-webgl":[Z$],"texture-compression-atc-webgl":[K$]};function J$(t){return t in V1}function eW(t,e,n){return(V1[e]||[]).every(i=>Hl(t,i,n))}const $1={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:G$,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Bc},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Lc},"bc1-rgba-unorm":{gl:33777,x:Bc},"bc1-rgba-unorm-srgb":{gl:35916,x:Lc},"bc2-rgba-unorm":{gl:33778,x:Bc},"bc2-rgba-unorm-srgb":{gl:35918,x:Lc},"bc3-rgba-unorm":{gl:33779,x:Bc},"bc3-rgba-unorm-srgb":{gl:35919,x:Lc},"bc4-r-unorm":{gl:36283,x:al},"bc4-r-snorm":{gl:36284,x:al},"bc5-rg-unorm":{gl:36285,x:al},"bc5-rg-snorm":{gl:36286,x:al},"bc6h-rgb-ufloat":{gl:36495,x:ll},"bc6h-rgb-float":{gl:36494,x:ll},"bc7-rgba-unorm":{gl:36492,x:ll},"bc7-rgba-unorm-srgb":{gl:36493,x:ll},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function tW(t,e,n){let r=e.create;const i=$1[e.format];return(i==null?void 0:i.gl)===void 0&&(r=!1),i!=null&&i.x&&(r=r&&!!Hl(t,i.x,n)),{format:e.format,create:r&&e.create,render:r&&e.render,filter:r&&e.filter,blend:r&&e.blend,store:r&&e.store}}function gR(t){var i;const e=$1[t],n=iW(t),r=_1(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||rW(r.channels,r.integer,r.normalized,n),type:r.dataType?pR(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function nW(t){switch(_1(t).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw new Error(`Not a depth stencil format: ${t}`)}}function rW(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function iW(t){const e=$1[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const Zb={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class sW extends J5{constructor(n,r,i){super([],i);L(this,"gl");L(this,"extensions");L(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,Hl(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),J$(n)&&eW(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(Zb),...Object.keys(V1)]}getWebGLFeature(n){const r=Zb[n];return typeof r=="string"?!!Hl(this.gl,r,this.extensions):!!r}}class oW extends G5{constructor(n){super();L(this,"gl");L(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class sA extends s0{constructor(n,r){super(n,r);L(this,"device");L(this,"gl");L(this,"handle");L(this,"colorAttachments",[]);L(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=nW(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${lW(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,a);break;case 34067:const u=aW(a);i.framebufferTexture2D(36160,n,u,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function aW(t){return t<34069?t+34069:t}function lW(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class cW extends qm{constructor(n,r){super(r);L(this,"device");L(this,"format","rgba8unorm");L(this,"depthStencilFormat","depth24plus");L(this,"presentationSize");L(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}get[Symbol.toStringTag](){return"WebGLCanvasContext"}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new sA(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}async function mR(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const AW=1;let Pt=null,Kb=!1;const W1={debugSpectorJS:Ee.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function uW(t){if(!globalThis.SPECTOR)try{await mR(t.debugSpectorJSUrl||W1.debugSpectorJSUrl)}catch(e){Ee.warn(String(e))}}function fW(t){var e;if(t={...W1,...t},!t.debugSpectorJS)return null;if(!Pt&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){Ee.probe(AW,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;Pt=new n,globalThis.luma&&(globalThis.luma.spector=Pt)}if(!Pt)return null;if(Kb||(Kb=!0,Pt.spyCanvases(),Pt==null||Pt.onCaptureStarted.add(n=>Ee.info("Spector capture started:",n)()),Pt==null||Pt.onCapture.add(n=>{Ee.info("Spector capture complete:",n)(),Pt==null||Pt.getResultUI(),Pt==null||Pt.resultView.display(),Pt==null||Pt.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;Pt==null||Pt.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{Ee.info("Spector capture stopped after 2 seconds")(),Pt==null||Pt.stopCapture()})}return Pt}const hW="https://unpkg.com/webgl-debug@2.0.1/index.js";function _R(t){return t.luma=t.luma||{},t.luma}async function dW(){ua()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await mR(hW))}function pW(t,e={}){return e.debugWebGL||e.traceWebGL?mW(t,e):gW(t)}function gW(t){const e=_R(t);return e.realContext?e.realContext:t}function mW(t,e){if(!globalThis.WebGLDebugUtils)return Ee.warn("webgl-debug not loaded")(),t;const n=_R(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...ol,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,_W.bind(null,e),yW.bind(null,e));for(const o in ol)!(o in r)&&typeof ol[o]=="number"&&(r[o]=ol[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function Gb(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function _W(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;Ee.error(o)();debugger}function yW(t,e,n){let r="";Ee.level>=1&&(r=Gb(e,n),t.traceWebGL&&Ee.log(1,r)());for(const i of n)if(i===void 0){r=r||Gb(e,n);debugger}}const dg={};function vW(t="id"){dg[t]=dg[t]||1;const e=dg[t]++;return`${t}-${e}`}class oA extends Dt{constructor(n,r={}){super(n,r);L(this,"device");L(this,"gl");L(this,"handle");L(this,"glTarget");L(this,"glUsage");L(this,"glIndexType",5123);L(this,"byteLength");L(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=wW(this.props.usage),this.glUsage=bW(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function wW(t){return t&Dt.INDEX?34963:t&Dt.VERTEX?34962:t&Dt.UNIFORM?35345:34962}function bW(t){return t&Dt.INDEX||t&Dt.VERTEX?35044:t&Dt.UNIFORM?35048:35044}function xW(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[_,v]=i;n.push({message:v.trim(),type:Jb(_),lineNum:0,linePos:0});continue}const[s,o,a,...u]=i;let h=parseInt(a,10);isNaN(h)&&(h=0);let p=parseInt(o,10);isNaN(p)&&(p=0),n.push({message:u.join(":").trim(),type:Jb(s),lineNum:h,linePos:p})}return n}function Jb(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class TW extends r0{constructor(n,r){super(n,r);L(this,"device");L(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?xW(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}Ee.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),Ee.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function EW(t,e,n,r){if(RW(e))return r(t);const i=t;i.pushState();try{return SW(t,e),Zl(i.gl,n),r(t)}finally{i.popState()}}function SW(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Wo("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Wo("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Wo("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(PW("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(w_("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&Ee.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=w_("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=pg("stencilPassOperation",e.stencilPassOperation),s=pg("stencilFailOperation",e.stencilFailOperation),o=pg("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=ex("blendColorOperation",e.blendColorOperation||"add"),s=ex("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=df("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=df("blendColorDstFactor",e.blendColorDstFactor||"zero"),u=df("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),h=df("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,u,h)}}function w_(t,e){return Wo(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function pg(t,e){return Wo(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function ex(t,e){return Wo(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function df(t,e){return Wo(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function CW(t,e){return`Illegal parameter ${e} for ${t}`}function Wo(t,e,n){if(!(e in n))throw new Error(CW(t,e));return n[e]}function PW(t,e){return e}function RW(t){let e=!0;for(const n in t){e=!1;break}return e}function yR(t){const e={};return t.addressModeU&&(e[10242]=gg(t.addressModeU)),t.addressModeV&&(e[10243]=gg(t.addressModeV)),t.addressModeW&&(e[32882]=gg(t.addressModeW)),t.magFilter&&(e[10240]=b_(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=kW(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=w_("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function gg(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function b_(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function kW(t,e="none"){if(!e)return b_(t);switch(e){case"none":return b_(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class x_ extends i0{constructor(n,r){super(n,r);L(this,"device");L(this,"handle");L(this,"parameters");this.device=n,this.parameters=yR(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class cl extends n0{constructor(n,r){super(n,{...Qt.defaultProps,...r});L(this,"device");L(this,"gl");L(this,"handle");L(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const IW="Failed to deduce GL constant from typed array";function MW(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(IW)}}function OW(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function vR(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function NW(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function y0(t,e,n){if(DW(e))return n(t);const{nocatch:r=!0}=e,i=$o.get(t);i.push(),Zl(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function DW(t){for(const e in t)return!1;return!0}function BW(t,e,n){const{dimension:r,width:i,height:s,depth:o=0}=n,{glInternalFormat:a}=n,u=n.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(u,e,a,i,s,o);break;default:t.texStorage2D(u,e,a,i,s)}}function tx(t,e,n,r){const{width:i,height:s}=r,{dimension:o,depth:a=0,mipLevel:u=0}=r,{x:h=0,y:p=0,z:_=0}=r,{glFormat:v,glType:b}=r,E=wR(r.glTarget,o,a),R=r.flipY?{37440:!0}:{};y0(t,R,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(E,e),t.texSubImage3D(E,u,h,p,_,i,s,a,v,b,n),t.bindTexture(E,null);break;case"2d":case"cube":t.bindTexture(E,e),t.texSubImage2D(E,u,h,p,i,s,v,b,n),t.bindTexture(E,null);break;default:throw new Error(o)}})}function nx(t,e,n){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:a=0,byteOffset:u=0}=n,{x:h=0,y:p=0,z:_=0}=n,{glFormat:v,glType:b,compressed:E}=n,R=wR(n.glTarget,r,o);switch(r){case"2d-array":case"3d":E?t.compressedTexSubImage3D(R,a,h,p,_,i,s,o,v,e,u):t.texSubImage3D(R,a,h,p,_,i,s,o,v,b,e,u);break;case"2d":case"cube":E?t.compressedTexSubImage2D(R,a,h,p,i,s,v,e,u):t.texSubImage2D(R,a,h,p,i,s,v,b,e,u);break;default:throw new Error(r)}}function LW(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function wR(t,e,n){return e==="cube"?34069+n:t}function FW(t,e){var P;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:a,sourceDepth:u,sourceFormat:h,sourceType:p}=e||{};const{framebuffer:_,deleteFramebuffer:v}=bR(t),{gl:b,handle:E}=_;o||(o=_.width),a||(a=_.height);const R=(P=_.colorAttachments[i])==null?void 0:P.texture;if(!R)throw new Error(`Invalid framebuffer attachment ${i}`);u=(R==null?void 0:R.depth)||1,h||(h=(R==null?void 0:R.glFormat)||6408),p||(p=(R==null?void 0:R.glType)||5121),s=VW(s,p,h,o,a),p=p||MW(s);const D=b.bindFramebuffer(36160,E);return b.readBuffer(36064+i),b.readPixels(n,r,o,a,h,p,s),b.readBuffer(36064),b.bindFramebuffer(36160,D||null),v&&_.destroy(),s}function UW(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:u,sourceType:h}=e||{};const{framebuffer:p,deleteFramebuffer:_}=bR(t);a=a||p.width,u=u||p.height;const v=p;h=h||5121;let b=n;if(!b){const R=vR(s),D=NW(h),P=o+a*u*R*D;b=v.device.createBuffer({byteLength:P})}const E=t.device.createCommandEncoder();return E.copyTextureToBuffer({sourceTexture:t,width:a,height:u,origin:[r,i],destinationBuffer:b,byteOffset:o}),E.destroy(),_&&p.destroy(),b}function bR(t){return t instanceof s0?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:zW(t),deleteFramebuffer:!0}}function zW(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function VW(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=OW(e,{clamped:!1}),a=vR(n);return new o(r*i*a)}class aA extends Qt{constructor(n,r){super(n,r);L(this,"device");L(this,"gl");L(this,"handle");L(this,"sampler");L(this,"view");L(this,"mipmaps");L(this,"compressed");L(this,"glTarget");L(this,"glFormat");L(this,"glType");L(this,"glInternalFormat");L(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=n,this.gl=this.device.gl,this.glTarget=LW(this.props.dimension);const s=gR(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:r,height:i}=n;if(!r||!i){const s=Qt.getTextureDataSize(n.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=n.depth,this.setSampler(n.sampler),this.view=new cl(this.device,{...this.props,texture:this}),this.bind(),BW(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new cl(this.device,{...n,texture:this})}setSampler(n={}){let r;n instanceof x_?(this.sampler=n,r=n.props):(this.sampler=new x_(this.device,n),r=n);const i=yR(r);this._setSamplerParameters(i)}generateMipmap(n){if(!(!(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format))&&(Ee.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),!(n!=null&&n.force))))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(i){Ee.warn(`Error generating mipmap for ${this}: ${i.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const r=Qt.getExternalImageSize(n.image),i={...Qt.defaultCopyExternalImageOptions,...r,...n},{image:s,depth:o,mipLevel:a,x:u,y:h,z:p,flipY:_}=i;let{width:v,height:b}=i;const{dimension:E,glTarget:R,glFormat:D,glInternalFormat:P,glType:S}=this;if(v=Math.min(v,this.width-u),b=Math.min(b,this.height-h),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return tx(this.device.gl,this.handle,s,{dimension:E,mipLevel:a,x:u,y:h,z:p,width:v,height:b,depth:o,glFormat:D,glInternalFormat:P,glType:S,glTarget:R,flipY:_}),{width:i.width,height:i.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,r=0){this.bind();const i=Qt.normalizeTextureData(n,this);i.length>1&&this.props.mipmaps!==!1&&Ee.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),nx(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of Qt.CubeFaces)this.setTextureCubeFaceData(n[i],i)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&Ee.warn(`${this.id} has mipmap and multiple LODs.`)();const s=Qt.CubeFaces.indexOf(r);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:u=6408,type:h=5121}=n,{gl:p}=this,_=o||a;this.bind(),_ instanceof Promise?_.then(v=>this.setImageDataForFace(Object.assign({},n,{face:r,data:v,pixels:v}))):this.width||this.height?p.texImage2D(r,0,u,i,s,0,u,h,_):p.texImage2D(r,0,u,u,h,_)}_getImageDataMap(n){for(let r=0;r<Qt.CubeFaces.length;++r){const i=Qt.CubeFaces[r];n[i]&&(n[34069+r]=n[i],delete n[i])}return n}_setSamplerParameters(n){Ee.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,r,i,s=this.glTarget){if(Qt.isExternalImage(i)){tx(this.device.gl,this.handle,i,{...this,depth:n,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(Qt.isTextureLevelData(i)){nx(this.device.gl,i.data,{...this,depth:n,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}const $W=[1,2,4,8];class WW extends Zm{constructor(n,r){var o;super(n,r);L(this,"device");L(this,"glParameters");this.device=n;let i;if(!((o=r==null?void 0:r.parameters)!=null&&o.viewport))if(r!=null&&r.framebuffer){const{width:a,height:u}=r.framebuffer;i=[0,0,a,u]}else{const[a,u]=n.getCanvasContext().getDrawingBufferSize();i=[0,0,a,u]}this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters});const s=this.props.framebuffer;if(s!=null&&s.handle)if(this.props.framebuffer){const a=this.props.framebuffer.colorAttachments.map((u,h)=>36064+h);this.device.gl.drawBuffers(a)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=$W.map(i=>!!(i&n.colorMask))),this.glParameters=r,Zl(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&y0(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){y0(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function jW(t){return HW.includes(t)}const HW=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],xR={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function TR(t){const e=xR[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function XW(t){const e=xR[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function QW(t,e){const n={attributes:[],bindings:[]};n.attributes=YW(t,e);const r=KW(t,e);for(const a of r){const u=a.uniforms.map(h=>({name:h.name,format:h.format,byteOffset:h.byteOffset,byteStride:h.byteStride,arrayLength:h.arrayLength}));n.bindings.push({type:"uniform",name:a.name,group:0,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:u})}const i=ZW(t,e);let s=0;for(const a of i)if(jW(a.type)){const{viewDimension:u,sampleType:h}=JW(a.type);n.bindings.push({type:"texture",name:a.name,group:0,location:s,viewDimension:u,sampleType:h}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=qW(t,e);return o!=null&&o.length&&(n.varyings=o),n}function YW(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,u=t.getAttribLocation(e,o);if(u>=0){const{attributeType:h}=XW(a),p=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:u,stepMode:p,type:h})}}return n.sort((i,s)=>i.location-s.location),n}function qW(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:u}=s,{glType:h,components:p}=TR(a),_={location:i,name:o,type:h,size:u*p};n.push(_)}return n.sort((i,s)=>i.location-s.location),n}function ZW(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:u}=s,{name:h,isArray:p}=ej(o);let _=t.getUniformLocation(e,h);const v={location:_,name:h,size:a,type:u,isArray:p};if(n.push(v),v.size>1)for(let b=0;b<v.size;b++){const E=`${h}[${b}]`;_=t.getUniformLocation(e,E);const R={...v,name:E,location:_};n.push(R)}}return n}function KW(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],u=t.getActiveUniforms(e,a,35383),h=t.getActiveUniforms(e,a,35384),p=t.getActiveUniforms(e,a,35387),_=t.getActiveUniforms(e,a,35388);for(let v=0;v<o.uniformCount;++v){const b=t.getActiveUniform(e,a[v]);if(!b)throw new Error("activeInfo");o.uniforms.push({name:b.name,format:TR(u[v]).format,type:u[v],arrayLength:h[v],byteOffset:p[v],byteStride:_[v]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const GW={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function JW(t){const e=GW[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function ej(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function tj(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function nj(t){return rR(t)!==null||typeof t=="number"||typeof t=="boolean"}function rj(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];nj(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function ij(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function sj(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const rx=4;class oj extends Ul{constructor(n,r){super(n,r);L(this,"device");L(this,"handle");L(this,"vs");L(this,"fs");L(this,"introspectedLayout");L(this,"uniforms",{});L(this,"bindings",{});L(this,"varyings",null);L(this,"_uniformCount",0);L(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),Ee.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=QW(this.device.gl,this.handle),Ee.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=aj(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(u=>`"${u.name}"`).join(", ");r!=null&&r.disableWarnings||Ee.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${a}`,s)();continue}switch(s||Ee.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof oA)&&!(s.buffer instanceof oA))throw new Error("buffer value");break;case"texture":if(!(s instanceof cl||s instanceof aA||s instanceof sA))throw new Error("texture value");break;case"sampler":Ee.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var D;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:u,isInstanced:h=!1,firstVertex:p=0,transformFeedback:_}=n,v=ij(s),b=!!o.indexBuffer,E=(D=o.indexBuffer)==null?void 0:D.glIndexType;if(this.linkStatus!=="success")return Ee.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return Ee.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),_&&_.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const R=r;return EW(this.device,i,R.glParameters,()=>{b&&h?this.device.gl.drawElementsInstanced(v,a||0,E,p,u||0):b?this.device.gl.drawElements(v,a||0,E,p):h?this.device.gl.drawArraysInstanced(v,p,a||0,u||0):this.device.gl.drawArrays(v,p,a||0),_&&_.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=rj(n);Object.keys(r).forEach(i=>{Ee.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),Ee.time(rx,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),Ee.timeEnd(rx,`linkProgram for ${this.id}`)(),Ee.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}Ee.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),Ee.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${i}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(Ee.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,u=n.getUniformBlockIndex(this.handle,a);if(u===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,u),o instanceof oA?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof cl||o instanceof aA||o instanceof sA))throw new Error("texture");let h;if(o instanceof cl)h=o.texture;else if(o instanceof aA)h=o;else if(o instanceof sA&&o.colorAttachments[0]instanceof cl)Ee.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),h=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(h.glTarget,h.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&tj(this.device.gl,i,s,a)}}}function aj(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):Ee.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class lj extends Gm{constructor(n){super(n,{});L(this,"device");L(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":cj(this.device,r.options);break;case"copy-buffer-to-texture":Aj(this.device,r.options);break;case"copy-texture-to-buffer":uj(this.device,r.options);break;case"copy-texture-to-texture":fj(this.device,r.options);break;default:throw new Error(r.name)}}}function cj(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function Aj(t,e){throw new Error("Not implemented")}function uj(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:u=[0,0],destinationBuffer:h,byteOffset:p=0,bytesPerRow:_,rowsPerImage:v}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||_||v)throw new Error("not implemented");const{framebuffer:b,destroyFramebuffer:E}=ER(n);let R;try{const D=h,P=s||b.width,S=o||b.height,k=gR(b.colorAttachments[0].texture.props.format),M=k.format,V=k.type;t.gl.bindBuffer(35051,D.handle),R=t.gl.bindFramebuffer(36160,b.handle),t.gl.readPixels(u[0],u[1],P,S,M,V,p)}finally{t.gl.bindBuffer(35051,null),R!==void 0&&t.gl.bindFramebuffer(36160,R),E&&b.destroy()}}function fj(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:a=e.destinationTexture.width,height:u=e.destinationTexture.height}=e;const{framebuffer:h,destroyFramebuffer:p}=ER(n),[_,v]=i,[b,E,R]=s,D=t.gl.bindFramebuffer(36160,h.handle);let P=null,S;if(o instanceof aA)P=o,a=Number.isFinite(a)?a:P.width,u=Number.isFinite(u)?u:P.height,P.bind(0),S=P.glTarget;else throw new Error("invalid destination");switch(S){case 3553:case 34067:t.gl.copyTexSubImage2D(S,r,b,E,_,v,a,u);break;case 35866:case 32879:t.gl.copyTexSubImage3D(S,r,b,E,R,_,v,a,u);break}P&&P.unbind(),t.gl.bindFramebuffer(36160,D),p&&h.destroy()}function ER(t){if(t instanceof Qt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class hj extends Km{constructor(n,r){super(n,r);L(this,"device");L(this,"commandBuffer");this.device=n,this.commandBuffer=new lj(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function dj(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let u=r;a<s;a++)e[u++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}class j1 extends Jm{constructor(n,r){super(n,r);L(this,"device");L(this,"handle");L(this,"buffer",null);L(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return BD()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:u,normalized:h,integer:p,divisor:_}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),p?this.device.gl.vertexAttribIPointer(n,s,o,a,u):this.device.gl.vertexAttribPointer(n,s,o,h,a,u),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,_||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=pR(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=j1.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=pj(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!gj(i,this.bufferValue),a){const u=PF(r.constructor,o);dj({target:u,source:i,start:0,count:o}),this.buffer.write(u),this.bufferValue=r}return this.buffer}}function pj(t){return Array.isArray(t)?new Float32Array(t):t}function gj(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class mj extends e_{constructor(n,r){super(n,r);L(this,"device");L(this,"gl");L(this,"handle");L(this,"layout");L(this,"buffers",{});L(this,"unusedBuffers",{});L(this,"bindOnUse",!0);L(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(sj(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,Ee.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(ix(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof oA)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(ix(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function ix(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class _j extends t_{constructor(n,r){super(n,r);L(this,"device");L(this,"handle");L(this,"target",null);L(this,"_queryPending",!1);L(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}class Al extends no{constructor(n){var _,v;super({...n,id:n.id||vW("webgl-device")});L(this,"type","webgl");L(this,"handle");L(this,"features");L(this,"limits");L(this,"info");L(this,"canvasContext");L(this,"lost");L(this,"_resolveContextLost");L(this,"gl");L(this,"debug",!1);L(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});L(this,"_extensions",{});L(this,"_polyfilled",!1);L(this,"spectorJS");L(this,"renderPass",null);L(this,"_constants");const r=no._getCanvasContextProps(n);if(!r)throw new Error("WebGLDevice requires props.createCanvasContext to be set");let i=(v=(_=r.canvas)==null?void 0:_.gl)==null?void 0:v.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new cW(this,r),this.lost=new Promise(b=>{this._resolveContextLost=b});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const a=this.props._handle||W$(this.canvasContext.canvas,{onContextLost:b=>{var E;return(E=this._resolveContextLost)==null?void 0:E.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:b=>console.log("WebGL context restored")},s);if(!a)throw new Error("WebGL context creation failed");if(i=a.device,i){if(n._reuseDevices)return Ee.log(1,`Not creating a new Device, instead returning a reference to Device ${i.id} already attached to WebGL context`,i)(),i._reused=!0,i;throw new Error(`WebGL context already attached to device ${i.id}`)}this.handle=a,this.gl=a,this.spectorJS=fW({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=j$(this.gl,this._extensions),this.limits=new oW(this.gl),this.features=new sW(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),r.autoResize!==!1&&this.canvasContext.resize(),new $o(this.gl,{log:(...b)=>Ee.log(1,...b)()}).trackState(this.gl,{copyState:!1});const h=n.debugWebGL||n.debug,p=n.debugWebGL;h&&(this.gl=pW(this.gl,{debugWebGL:h,traceWebGL:p}),Ee.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(Ee.level=Math.max(Ee.level,1)))}destroy(){!this.props._reuseDevices&&!this._reused&&delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new oA(this,r)}createTexture(n){return new aA(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new x_(this,n)}createShader(n){return new TW(this,n)}createFramebuffer(n){return new sA(this,n)}createVertexArray(n){return new j1(this,n)}createTransformFeedback(n){return new mj(this,n)}createQuerySet(n){return new _j(this,n)}createRenderPipeline(n){return new oj(this,n)}beginRenderPass(n){return new WW(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new hj(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return FW(n,r)}readPixelsToBufferWebGL(n,r){return UW(n,r)}setParametersWebGL(n){Zl(this.gl,n)}getParametersWebGL(n){return hR(this.gl,n)}withParametersWebGL(n,r){return y0(this.gl,n,r)}resetWebGL(){Ee.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),F$(this.gl)}_getDeviceSpecificTextureFormatCapabilities(n){return tW(this.gl,n,this._extensions)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){$o.get(this.gl).push()}popState(){$o.get(this.gl).pop()}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&bj(s,r)&&Ee.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:yj(this,n,r);break;case Int32Array:vj(this,n,r);break;case Uint32Array:wj(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return Hl(this.gl,n,this._extensions),this._extensions}}function yj(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function vj(t,e,n){t.gl.vertexAttribI4iv(e,n)}function wj(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function bj(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const xj={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},Tj=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Ej=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),Sj=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function Cj(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&Pj(i),i}return this.originalGetContext(n,r)}}function Pj(t){t.getExtension("EXT_color_buffer_float");const e={...xj,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:Tj(t),OES_vertex_array_object:Ej(t),ANGLE_instanced_arrays:Sj(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const pf=1;class Rj extends iF{constructor(){super();L(this,"type","webgl");no.defaultProps={...no.defaultProps,...W1},Al.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){Cj(n)}async attach(n){if(n instanceof Al)return n;if((n==null?void 0:n.device)instanceof no)return n.device;if(!kj(n))throw new Error("Invalid WebGL2RenderingContext");return new Al({_handle:n,createCanvasContext:{canvas:n.canvas,autoResize:!1}})}async create(n={}){Ee.groupCollapsed(pf,"WebGLDevice created")();const r=[];(n.debugWebGL||n.debug)&&r.push(dW()),n.debugSpectorJS&&r.push(uW(n));const i=await Promise.allSettled(r);for(const a of i)a.status==="rejected"&&Ee.error(`Failed to initialize debug libraries ${a.reason}`)();const s=new Al(n),o=`${s._reused?"Reusing":"Created"} device with WebGL2 ${s.debug?"debug ":""}context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return Ee.probe(pf,o)(),Ee.table(pf,s.info)(),Ee.groupEnd(pf)(),s}}function kj(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const sx=new Rj;function Ts(){}const Ij=({isDragging:t})=>t?"grabbing":"grab",SR={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Ts,onWebGLInitialized:Ts,onResize:Ts,onViewStateChange:Ts,onInteractionStateChange:Ts,onBeforeRender:Ts,onAfterRender:Ts,onLoad:Ts,onError:t=>ot.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Ij,getTooltip:null,debug:!1,drawPickingColors:!1};class H1{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new cu({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=f_[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:u}=a,h=u&&(u[i]||u.props[i]),p=this.props[i];let _=!1;h&&(_=h.call(u,a,r)),_||(p==null||p(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{var o;if(((o=this.device)==null?void 0:o.type)==="webgpu")return;const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...SR,...e},e=this.props,e.viewState&&e.initialViewState&&ot.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&ot.error("WebGL1 context not supported.")(),n=sx.attach(e.gl)),n||(n=Ym.createDevice({type:"best-available",_reuseDevices:!0,adapters:[sx],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&Wl.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,u,h,p;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(u=this.eventManager)==null||u.destroy(),this.eventManager=null,(h=this.widgetManager)==null||h.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((p=this.canvas.parentElement)==null||p.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ot.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ot.removed("onLayerClick","onClick")(),e.initialViewState&&!pr(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return bn(this.viewManager),this.viewManager.views}getViewports(e){return bn(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){bn(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),bn(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new bV({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new m$({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i,s;if(((n=this.device)==null?void 0:n.type)==="webgpu")return;const{_pickRequest:e}=this;if(e.event){const{result:o,emptyInfo:a}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=o.length>0;let u=a,h=!1;for(const p of o)u=p,h=((r=p.layer)==null?void 0:r.onHover(p,e.event))||h;h||((s=(i=this.props).onHover)==null||s.call(i,u,e.event),this.widgetManager.onHover(u,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.type==="webgl"&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device.type==="webgl"&&this.props.onWebGLInitialized(this.device.gl);const n=new nR;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new J9(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(Tb).map(o=>{var b;const[a,u,h,p]=Tb[o],_=(b=this.props.eventRecognizerOptions)==null?void 0:b[o],v={...u,..._,event:o};return{recognizer:new a(v),recognizeWith:h,requestFailure:p}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in f_)this.eventManager.on(o,this._onEvent);this.viewManager=new r$({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new n$(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new v$({deck:this,device:this.device}),this.deckRenderer=new x$(this.device),this.deckPicker=new R$(this.device),this.widgetManager=new M$({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new wd),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){var e;this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ot.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),((e=this.device)==null?void 0:e.type)!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=Ym.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}H1.defaultProps=SR;H1.VERSION=A5;const Mj=H1;function Oj(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return ZC(t)}}const Nj=qC;function gf(t,e,n){const r=n==="webgpu"&&e.type==="uint8"?"unorm8":e.type;return{attribute:t,format:e.size>1?`${r}x${e.size}`:e.type,byteOffset:e.offset||0}}function No(t){return t.stride||t.size*t.bytesPerElement}function Dj(t,e){return t.type===e.type&&t.size===e.size&&No(t)===No(e)&&(t.offset||0)===(e.offset||0)}function T_(t,e){e.offset&&ot.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=No(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function Bj(t,e){const n=T_(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class Lj{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let u=Oj(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(u=Float32Array),this.value=null,this.settings={...n,defaultType:u,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:u.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*No(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),Wl.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=T_(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:No(r),attributes:i};if(this.doublePrecision){const o=Bj(r,n||{});i.push(gf(e,{...r,...o.high},this.device.type),gf(`${e}64Low`,{...r,...o.low},this.device.type))}else if(n){const o=T_(r,n);i.push(gf(e,{...r,...o},this.device.type))}else i.push(gf(e,r,this.device.type));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let u=0;u<s;)for(let h=0;h<i;h++){const p=n[u++];p<o[h]&&(o[h]=p),p>a[h]&&(a[h]=p)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof Dt?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=Nj(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=No(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=No(i),u=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=lg(s,i)),this.settings.isIndexed){const p=this.settings.defaultType;s.constructor!==p&&(s=new p(s))}const h=s.byteLength+u+a*2;(!o||o.byteLength<h)&&(o=this._createBuffer(h)),o.write(s,u)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?lg(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=Wl.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?lg(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ot.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:(n?Dt.INDEX:Dt.VERTEX)|Dt.COPY_DST,indexType:n?r:void 0,byteLength:e}),this._buffer}}const ox=[],ax=[];function gu(t,e=0,n=1/0){let r=ox;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(ax.length=t.length,r=ax):r=ox,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function CR(t){return t&&t[Symbol.asyncIterator]}function PR(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,u=r?r/a:n,h=i?i/a:0,p=Math.floor((t.length-h)/u);return(_,{index:v,target:b})=>{if(!s){const P=v*u+h;for(let S=0;S<n;S++)b[S]=t[P+S];return b}const E=s[v],R=s[v+1]||p;let D;if(o){D=new Array(R-E);for(let P=E;P<R;P++){const S=P*u+h;b=new Array(n);for(let k=0;k<n;k++)b[k]=t[S+k];D[P-E]=b}}else if(u===n)D=t.subarray(E*n+h,R*n+h);else{D=new t.constructor((R-E)*n);let P=0;for(let S=E;S<R;S++){const k=S*u+h;for(let M=0;M<n;M++)D[P++]=t[k+M]}}return D}}const Fj=[],uh=[[0,1/0]];function Uj(t,e){if(t===uh||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const zj={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function RR(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...zj[n],...e,...t,type:n}}class kR extends Lj{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:uh}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!Dj(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return RR(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=Uj(this.state.updateRanges,[r,i])}else this.state.updateRanges=uh}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Fj}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==uh),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let u=!0;if(o){for(const[h,p]of s)o.call(i,this,{data:n,startRow:h,endRow:p,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[h,p]of s){const _=Number.isFinite(h)?this.getVertexOffset(h):0,v=Number.isFinite(p)?this.getVertexOffset(p):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:_,endOffset:v})}this._checkAttributeArray()}else u=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),u}setConstantValue(e){return this.device.type==="webgpu"||e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;bn(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=PR(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant&&this.context.device.type!=="webgpu")return;const{settings:a,state:u,value:h,size:p,startIndices:_}=e,{accessor:v,transform:b}=a;let E=u.binaryAccessor||(typeof v=="function"?v:s[v]);typeof E!="function"&&(E=()=>E),bn(typeof E=="function",`accessor "${v}" is not a function`);let R=e.getVertexOffset(r);const{iterable:D,objectInfo:P}=gu(n,r,i);for(const S of D){P.index++;let k=E(S,P);if(b&&(k=b.call(this,k)),_){const M=(P.index<_.length-1?_[P.index+1]:o)-_[P.index];if(k&&Array.isArray(k[0])){let V=R;for(const Y of k)e._normalizeValue(Y,h,V),V+=p}else k&&k.length>p?h.set(k,R):(e._normalizeValue(k,P.target,0),KV({target:h,source:P.target,start:R,count:M}));R+=M*p}else e._normalizeValue(k,h,R),R+=p}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function mg(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,u=o-r;if(a>u){n.set(e.subarray(0,u),r);return}if(n.set(e,r),!s)return;let h=a;for(;h<u;){const p=s(h,e);for(let _=0;_<i;_++)n[r+h]=p[_]||0,h++}}function Vj({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return mg({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const u=r&&((p,_)=>r(p+a,_)),h=Math.min(i.length,s.length);for(let p=1;p<h;p++){const _=i[p]*n,v=s[p]*n;mg({source:t.subarray(o,_),target:e,start:a,end:v,size:n,getData:u}),o=_,a=v}return a<e.length&&mg({source:[],target:e,start:a,size:n,getData:u}),e}function $j(t){const{device:e,settings:n,value:r}=t,i=new kR(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function IR(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function MR(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function OR(t){t.push(t.shift())}function Wj(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:u}=t.settings;if(u)for(const h of Object.values(u))a=Math.max(a,h.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function NR({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function DR({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,u=n.size*a,h=n.byteOffset,p=n.settings.bytesPerElement<4?h/n.settings.bytesPerElement*4:h,_=n.startIndices,v=s&&_,b=n.isConstant;if(!v&&e&&r>=i)return e;const E=n.value instanceof Float64Array?Float32Array:n.value.constructor,R=b?n.value:new E(n.getBuffer().readSyncWebGL(h,i*E.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!b){const k=o;o=(M,V)=>n.normalizeConstant(k(M,V))}const D=b?(k,M)=>o(R,M):(k,M)=>o(R.subarray(k+h,k+h+u),M),P=e?new Float32Array(e.readSyncWebGL(p,r*4).buffer):new Float32Array(0),S=new Float32Array(i);return Vj({source:P,target:S,sourceStartIndices:s,targetStartIndices:_,size:u,getData:D}),(!e||e.byteLength<S.byteLength+p)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:S.byteLength+p,usage:35050})),e.write(S,p),e}class BR{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new vd(r),this.attribute=n,this.attributeInTransition=$j(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Wj(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class jj extends BR{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=Yj(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;OR(s),s[0]=DR({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=NR({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,u=a.model;let h=Math.floor(this.currentLength/o.size);LR(o)&&(h/=2),u.setVertexCount(h),o.isConstant?(u.setAttributes({aFrom:s[0]}),u.setConstantAttributes({aTo:o.value})):u.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Hj=`uniform interpolationUniforms {
  float time;
} interpolation;
`,lx={name:"interpolation",vs:Hj,uniformTypes:{time:"f32"}},Xj=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,Qj=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function LR(t){return t.doublePrecision&&t.value instanceof Float64Array}function Yj(t,e){const n=e.size,r=IR(n),i=MR(n),s=e.getBufferLayout();return LR(e)?new zA(t,{vs:Qj,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[WU,lx],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new zA(t,{vs:Xj,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[lx],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class qj extends BR{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=tH(e),this.framebuffer=nH(e,this.texture),this.transform=eH(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let u=0;u<2;u++)s[u]=DR({device:this.device,buffer:s[u],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=NR({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),OR(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Zj=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,Kj={name:"spring",vs:Zj,uniformTypes:{damping:"f32",stiffness:"f32"}},Gj=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,Jj=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function eH(t,e){const n=IR(e.size),r=MR(e.size);return new zA(t,{vs:Gj,fs:Jj,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[Kj],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function tH(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function nH(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const rH={interpolation:jj,spring:qj};class iH{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=rH[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(ot.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const cx="attributeManager.invalidate",sH="attributeManager.updateStart",oH="attributeManager.updateEnd",aH="attribute.updateStart",lH="attribute.allocate",cH="attribute.updateEnd";class AH{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=fu(cV),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new iH(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);Dn(cx,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);Dn(cx,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let u=!1;Dn(sH,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const h in this.attributes){const p=this.attributes[h],_=p.settings.accessor;p.startIndices=r,p.numInstances=n,s[h]&&ot.removed(`props.${h}`,`data.attributes.${h}`)(),p.setExternalBuffer(o[h])||p.setBinaryValue(typeof _=="string"?o[_]:void 0,e.startIndices)||typeof _=="string"&&!o[_]&&p.setConstantValue(s[_])||p.needsUpdate()&&(u=!0,this._updateAttribute({attribute:p,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||p.needsRedraw()}u&&Dn(oH,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new kR(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(Dn(aH,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&Dn(lH,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,Dn(cH,n,r))}}class uH extends vd{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=h0(n,r,o)}}const Ax=1e-5;function ux(t,e,n,r,i){const s=e-t,a=(n-e)*i,u=-s*r;return a+u+s+e}function fH(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=ux(t[o],e[o],n[o],r,i);return s}return ux(t,e,n,r,i)}function fx(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class hH extends vd{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=fH(s,o,n,r,i);const u=fx(a,n),h=fx(a,o);u<Ax&&h<Ax&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const dH={interpolation:uH,spring:hH};class pH{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const u=s.get(e),{value:h=u.settings.fromValue}=u;n=h,this.remove(e)}if(i=RR(i),!i)return;const o=dH[i.type];if(!o){ot.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function gH(t){const e=t[io];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function mH(t,e){const n=FR({newProps:t,oldProps:e,propTypes:t[io],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=yH(t,e);let i=!1;return r||(i=vH(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:wH(t,e),transitionsChanged:_H(t,e)}}function _H(t,e){if(!t.transitions)return!1;const n={},r=t[io];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&E_(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function FR({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=E_(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=E_(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function E_(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function yH(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function vH(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&hx(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&hx(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function wH(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function hx(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},FR({oldProps:i,newProps:r,triggerName:n})}const bH="count(): argument not an object",xH="count(): argument not a container";function TH(t){if(!SH(t))throw new Error(bH);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(EH(t))return Object.keys(t).length;throw new Error(xH)}function EH(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function SH(t){return t!==null&&typeof t=="object"}function dx(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const CH={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},S_={};function PH(t,e,n,r){if(n instanceof Qt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...CH,...i,...r},mipmaps:!0});return S_[s.id]=t,s}function RH(t,e){!e||!(e instanceof Qt)||S_[e.id]===t&&(e.delete(),delete S_[e.id])}const kH={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||C_(t)&&(t.length===3||t.length===4)},equal(t,e,n){return pr(t,e,1)}},accessor:{validate(t,e){const n=v0(t);return n==="function"||n===v0(e.value)},equal(t,e,n){return typeof e=="function"?!0:pr(t,e,1)}},array:{validate(t,e){return e.optional&&!t||C_(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?pr(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?pr(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:PH(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{RH(n.id,t)}}};function IH(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=MH(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function MH(t,e){switch(v0(e)){case"object":return bc(t,e);case"array":return bc(t,{type:"array",value:e,compare:!1});case"boolean":return bc(t,{type:"boolean",value:e});case"number":return bc(t,{type:"number",value:e});case"function":return bc(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function bc(t,e){return"type"in e?{name:t,...kH[e.type],...e}:"value"in e?{name:t,type:v0(e.value),...e}:{name:t,type:"object",value:e}}function C_(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function v0(t){return C_(t)?"array":t===null?"null":typeof t}function OH(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=P_(t.constructor,n),i=Object.create(r);i[_0]=t,i[ta]={},i[js]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const NH="_mergedDefaultProps";function P_(t,e){if(!(t instanceof zR.constructor))return{};let n=NH;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=UR(t,n);return r||(t[n]=DH(t,e||[]))}function DH(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=P_(r),s=UR(t,"defaultProps")||{},o=IH(s),a=Object.assign(Object.create(null),i,o.defaultProps),u=Object.assign(Object.create(null),i==null?void 0:i[io],o.propTypes),h=Object.assign(Object.create(null),i==null?void 0:i[fg],o.deprecatedProps);for(const p of e){const _=P_(p.constructor);_&&(Object.assign(a,_),Object.assign(u,_[io]),Object.assign(h,_[fg]))}return BH(a,t),FH(a,u),LH(a,h),a[io]=u,a[fg]=h,e.length===0&&!X1(t,"_propTypes")&&(t._propTypes=u),a}function BH(t,e){const n=zH(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function LH(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])X1(this,s)||(this[s]=r);ot.deprecated(i,e[n].join("/"))()}})}function FH(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=UH(o))}t[El]=n,t[ta]={},Object.defineProperties(t,r)}function UH(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||CR(e)?this[ta][t]=e:this[js][t]=e},get(){if(this[js]){if(t in this[js])return this[js][t]||this[El][t];if(t in this[ta]){const e=this[_0]&&this[_0].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[El][t]}}return this[El][t]}}}function X1(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function UR(t,e){return X1(t,e)&&t[e]}function zH(t){const e=t.componentName;return e||ot.warn(`${t.name}.componentName not specified`)(),e||t.name}let VH=0;class Q1{constructor(...e){this.props=OH(this,e),this.id=this.props.id,this.count=VH++}clone(e){const{props:n}=this,r={};for(const i in n[El])i in n[js]?r[i]=n[js][i]:i in n[ta]&&(r[i]=n[ta][i]);return new this.constructor({...n,...r,...e})}}Q1.componentName="Component";Q1.defaultProps={};const zR=Q1,$H=Object.freeze({});class WH{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||$H}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[_0]||this.component;const n=e[js]||{},r=e[ta]||e,i=e[El]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(CR(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:u}=this.component.props;u?s=u(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[io];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class jH extends WH{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const HH="layer.changeFlag",XH="layer.initialize",QH="layer.update",YH="layer.finalize",qH="layer.matched",px=2**24-1,ZH=Object.freeze([]),KH=fu(({oldViewport:t,viewport:e})=>t.equals(e));let Xr=new Uint8ClampedArray(0);const GH={data:{type:"data",value:ZH,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:Gh(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:u=>{var h;return(h=n.internalState)==null?void 0:h.reloadAsyncProp(e,u)},consumerId:n.id,requestId:e}):Gh(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ut.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class Y1 extends zR{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Wa.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){bn(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=tR(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=ZP(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return bn(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){bn(this.internalState);const r=this.internalState.viewport||this.context.viewport;return pV(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ut.DEFAULT||e===ut.LNGLAT||e===ut.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){bn(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:TH(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=dx(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=dx(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:u}=n.attributes,h=a||u;h&&(o&&h.constant&&(h.constant=!1,n.invalidate(h.id)),!h.value&&!o&&(h.constant=!0,h.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e.renderPass)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!KH({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Xr.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>px&&ot.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Xr=Wl.allocate(Xr,n,{size:4,copy:!0,maxCount:Math.max(n,px)});const i=Math.floor(Xr.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Xr[o*4+0]=s[0],Xr[o*4+1]=s[1],Xr[o*4+2]=s[2],Xr[o*4+3]=0}e.value=Xr.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const u=this.getAttributeManager();e.setBufferLayout(u.getBufferLayouts(e)),n=u.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const u in n){if(i[u])continue;const h=n[u].getValue();for(const p in h){const _=h[p];_ instanceof Dt?n[u].settings.isIndexed?e.setIndexBuffer(_):s[p]=_:_&&(o[p]=_)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,u=this.encodePickingColor(e);for(let h=0;h<n.length;h++){const p=s.getVertexOffset(h);a[p]===u[0]&&a[p+1]===u[1]&&a[p+2]===u[2]&&this._disablePickingIndex(h)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Xr.buffer&&(r.value=Xr.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){bn(!this.internalState),bn(Number.isFinite(this.props.coordinateSystem)),Dn(XH,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new jH({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ot.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new pH(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){Dn(qH,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(Dn(QH,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),u=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const p of this.props.extensions)p.updateState.call(this,a,p);this.setNeedsRedraw(),this._updateAttributes();const h=this.getModels()[0]!==u[0];this._postUpdate(a,h)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){Dn(YH,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;try{n&&this.setShaderModuleProps(n);const{getPolygonOffset:a}=this.props,u=a&&a(r)||[0,0];o.device instanceof Al&&o.device.setParametersWebGL({polygonOffset:u});for(const h of this.getModels())h.device.type==="webgpu"?h.setParameters({...h.parameters,...i}):h.setParameters(i);if(o.device instanceof Al)o.device.withParametersWebGL(i,()=>{const h={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)});else{const h={renderPass:e,shaderModuleProps:n,uniforms:r,parameters:i,context:o};for(const p of this.props.extensions)p.draw.call(this,h,p);this.draw(h)}}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&Dn(HH,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=mH(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){gH(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new AH(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:u}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==u){const h={};Array.isArray(u)&&(h.highlightColor=u),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(h.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:h})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}Y1.defaultProps=GH;Y1.layerName="Layer";const ho=Y1,JH="compositeLayer.renderLayers";class VR extends ho{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var le;const{opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:u,highlightColor:h,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:v,positionFormat:b,modelMatrix:E,extensions:R,fetch:D,operation:P,_subLayerProps:S}=this.props,k={id:"",updateTriggers:{},opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:u,highlightColor:h,coordinateSystem:p,coordinateOrigin:_,wrapLongitude:v,positionFormat:b,modelMatrix:E,extensions:R,fetch:D,operation:P},M=S&&e.id&&S[e.id],V=M&&M.updateTriggers,Y=e.id||"sublayer";if(M){const I=this.props[io],O=e.type?e.type._propTypes:{};for(const U in M){const $=O[U]||I[U];$&&$.type==="accessor"&&(M[U]=this.getSubLayerAccessor(M[U]))}}Object.assign(k,e,M),k.id=`${this.props.id}-${Y}`,k.updateTriggers={all:(le=this.props.updateTriggers)==null?void 0:le.all,...e.updateTriggers,...V};for(const I of R){const O=I.getSubLayerProps.call(this,I);O&&Object.assign(k,O,{updateTriggers:Object.assign(k.updateTriggers,O.updateTriggers)})}return k}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=yd(s,Boolean),this.internalState.subLayers=r}Dn(JH,this,i,r);for(const s of r)s.parent=this}}VR.layerName="CompositeLayer";const da=VR,mf=Math.PI/180,gx=180/Math.PI,fh=6370972,ul=256;function eX(){const t=ul/fh,e=Math.PI/180*ul;return{unitsPerMeter:[t,t,t],unitsPerMeter2:[0,0,0],metersPerUnit:[1/t,1/t,1/t],unitsPerDegree:[e,e,t],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,1/t]}}class tX extends F1{constructor(e={}){const{longitude:n=0,zoom:r=0,nearZMultiplier:i=.5,farZMultiplier:s=1,resolution:o=10}=e;let{latitude:a=0,height:u,altitude:h=1.5,fovy:p}=e;a=Math.max(Math.min(a,sl),-sl),u=u||1,p?h=D1(p):p=FA(h);const _=1/Math.PI/Math.cos(a*Math.PI/180),v=Math.pow(2,r)*_,b=e.nearZ??i,E=e.farZ??(h+ul*2*v/u)*s,R=new Xn().lookAt({eye:[0,-h,0],up:[0,0,1]});R.rotateX(a*mf),R.rotateZ(-n*mf),R.scale(v/u),super({...e,height:u,viewMatrix:R,longitude:n,latitude:a,zoom:r,distanceScales:eX(),fovy:p,focalDistance:h,near:b,far:E}),this.scale=v,this.latitude=a,this.longitude=n,this.resolution=o}get projectionMode(){return dr.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,this.height/2],n),i=this.unproject([this.width/2,0],n),s=this.unproject([this.width,this.height/2],n),o=this.unproject([this.width/2,this.height],n);return s[0]<this.longitude&&(s[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],s[0],i[0],o[0]),Math.min(r[1],s[1],i[1],o[1]),Math.max(r[0],s[0],i[0],o[0]),Math.max(r[1],s[1],i[1],o[1])]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,{pixelUnprojectionMatrix:u}=this;let h;if(Number.isFinite(o))h=_g(u,[i,a,o,1]);else{const b=_g(u,[i,a,-1,1]),E=_g(u,[i,a,1,1]),R=((r||0)/fh+1)*ul,D=eg(SP([],b,E)),P=eg(b),S=eg(E),M=4*((4*P*S-(D-P-S)**2)/16)/D,V=Math.sqrt(P-M),Y=Math.sqrt(Math.max(0,R*R-M)),le=(V-Y)/Math.sqrt(D);h=M7([],b,E,le)}const[p,_,v]=this.unprojectPosition(h);return Number.isFinite(o)?[p,_,v]:Number.isFinite(r)?[p,_,r]:[p,_]}projectPosition(e){const[n,r,i=0]=e,s=n*mf,o=r*mf,a=Math.cos(o),u=(i/fh+1)*ul;return[Math.sin(s)*a*u,-Math.cos(s)*a*u,Math.sin(o)*u]}unprojectPosition(e){const[n,r,i]=e,s=CP(e),o=Math.asin(i/s),u=Math.atan2(n,-r)*gx,h=o*gx,p=(s/ul-1)*fh;return[u,h,p]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,n){const r=this.unproject(n);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function _g(t,e){const n=ql([],e,t);return M1(n,n,1/n[3]),n}class $R{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=Wl,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:u=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=u,s&&(bn(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),u||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const h of a)this._rebuildGeometry(h);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?PR(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const u=s[a];u.copy=n,r[a]=o.allocate(r[a],e,u)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=gu(i,n,r);for(const u of o){a.index++;const h=s?s(u,a):null;e(h,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:u=1/0}=e||{},h={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((_,v)=>{const b=_&&this.normalizeGeometry(_);h[v]=b,r[v+1]=r[v]+(b?this.getGeometrySize(b):0)},a,u),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof Dt){const _=this.positionSize*4;i=i||o.byteLength/_}else if(o.buffer){const _=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/_}else if(o.value){const _=o.value,v=o.stride/_.BYTES_PER_ELEMENT||this.positionSize;i=i||_.length/v}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const p={};this._forEachGeometry((_,v)=>{const b=h[v]||_;p.vertexStart=r[v],p.indexStart=n[v];const E=v<r.length-1?r[v+1]:i;p.geometrySize=E-r[v],p.geometryIndex=v,this.updateGeometryAttributes(b,p)},a,u),this.vertexCount=n[n.length-1]}}const nX=typeof window<"u"?Ce.useLayoutEffect:Ce.useEffect,rX=nX;function w0(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const iX={position:"absolute",zIndex:-1};function WR(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>WR(n,e));if(bd(t)){if(sX(t))return e.style=iX,Ce.cloneElement(t,e);if(oX(t))return Ce.cloneElement(t,e)}return t}function bd(t){return t&&typeof t=="object"&&"type"in t||!1}function sX(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function oX(t){const e=t.type;return e&&e.deckGLViewProps}function R_(t){if(typeof t=="function")return Ce.createElement(jl,{},t);if(Array.isArray(t))return t.map(R_);if(bd(t)){if(t.type===Ce.Fragment)return R_(t.props.children);if(w0(t.type,jl))return t}return t}function aX({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return Ce.Children.forEach(R_(t),o=>{if(bd(o)){const a=o.type;if(w0(a,ho)){const u=lX(a,o.props);i.push(u)}else r.push(o);if(w0(a,jl)&&a!==jl&&o.props.id){const u=new a(o.props);s[u.id]=u}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function lX(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}const cX=Ce.createContext();function AX({children:t,deck:e,ContextProvider:n=cX.Provider}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,u=o;bd(o)&&w0(o.type,jl)&&(a=o.props.id||s,u=o.props.children);const h=r.getViewport(a),p=r.getViewState(a);if(h){p.padding=h.padding;const{x:_,y:v,width:b,height:E}=h;u=WR(u,{x:_,y:v,width:b,height:E,viewport:h,viewState:p}),i[a]||(i[a]={viewport:h,children:[]}),i[a].children.push(u)}}return Object.keys(i).map(o=>{const{viewport:a,children:u}=i[o],{x:h,y:p,width:_,height:v}=a,b={position:"absolute",left:h,top:p,width:_,height:v},E=`view-${o}`,R=Ce.createElement("div",{key:E,id:E,style:b},...u),D={deck:e,viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:S=>{S.viewId=o,e._onViewStateChange(S)},widgets:[]},P=`view-${o}-context`;return Ce.createElement(n,{key:P,value:D},R)})}const uX={mixBlendMode:null};function fX({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in uX?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function hX(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function jR(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function dX(t,e,n){var i,s,o;const r=new e({...n,_customRender:((o=(s=(i=n.deviceProps)==null?void 0:i.adapters)==null?void 0:s[0])==null?void 0:o.type)==="webgpu"?void 0:a=>{t.redrawReason=a;const u=r.getViewports();t.lastRenderedViewports!==u?t.forceUpdate():jR(t)}});return r}function pX(t,e){const[n,r]=Ce.useState(0),s=Ce.useRef({control:null,version:n,forceUpdate:()=>r(V=>V+1)}).current,o=Ce.useRef(null),a=Ce.useRef(null),u=Ce.useMemo(()=>aX(t),[t.layers,t.views,t.children]);let h=!0;const p=V=>{var Y;return h&&t.viewState?(s.viewStateUpdateRequested=V,null):(s.viewStateUpdateRequested=null,(Y=t.onViewStateChange)==null?void 0:Y.call(t,V))},_=V=>{var Y;h?s.interactionStateUpdateRequested=V:(s.interactionStateUpdateRequested=null,(Y=t.onInteractionStateChange)==null||Y.call(t,V))},v=Ce.useMemo(()=>{const V={widgets:[],...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:u.layers,views:u.views,onViewStateChange:p,onInteractionStateChange:_};return delete V._customRender,s.deck&&s.deck.setProps(V),V},[t]);Ce.useEffect(()=>{const V=t.Deck||Mj;return s.deck=dX(s,V,{...v,parent:o.current,canvas:a.current}),()=>{var Y;return(Y=s.deck)==null?void 0:Y.finalize()}},[]),rX(()=>{jR(s);const{viewStateUpdateRequested:V,interactionStateUpdateRequested:Y}=s;V&&p(V),Y&&_(Y)}),Ce.useImperativeHandle(e,()=>hX(s),[]);const b=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:E,width:R="100%",height:D="100%",id:P,style:S}=t,{containerStyle:k,canvasStyle:M}=Ce.useMemo(()=>fX({width:R,height:D,style:S}),[R,D,S]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===b||s.version!==n){s.lastRenderedViewports=b,s.version=n;const V=AX({children:u.children,deck:s.deck,ContextProvider:E}),Y=Ce.createElement("canvas",{key:"canvas",id:P||"deckgl-overlay",ref:a,style:M});s.control=Ce.createElement("div",{id:`${P||"deckgl"}-wrapper`,ref:o,style:k},[Y,V])}return h=!1,s.control}const gX=Ce.forwardRef(pX),mX=gX,mx=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,_X={name:"icon",vs:mx,fs:mx,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},yX=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,vX=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,wX=1024,bX=4,_x=()=>{},yx={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},xX={x:0,y:0,width:0,height:0};function TX(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function EX(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{image:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{image:t.canvas,width:s,height:o})}function VA(t){return t&&(t.id||t.url)}function SX(t,e,n,r){const{width:i,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:r,mipmaps:!0}),u=o.createCommandEncoder();return u.copyTextureToTexture({sourceTexture:t,destinationTexture:a,width:i,height:s}),u.finish(),t.destroy(),a}function vx(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=VA(i);t[o]={...i,x:s,y:n}}}function CX({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let u=0;u<t.length;u++){const h=t[u],p=VA(h);if(!n[p]){const{height:_,width:v}=h;r+v+e>o&&(vx(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:h,xOffset:r}),r=r+v+e,s=Math.max(s,_)}}return a.length>0&&vx(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:TX(s+i+e)}}function PX(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=gu(t);for(const o of i){s.index++;const a=e(o,s),u=VA(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[u]&&(!n[u]||a.url!==n[u].url)&&(r[u]={...a,source:o,sourceIndex:s.index})}return r}class RX{constructor(e,{onUpdate:n=_x,onError:r=_x}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=bX,this._canvasWidth=wX,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?VA(e):e;return this._mapping[n]||xX}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(PX(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:u}=CX({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=u,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||yx,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=SX(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||yx)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Gh(r.url,this._loadOptions).then(i=>{var E;const s=VA(r),o=this._mapping[s],{x:a,y:u,width:h,height:p}=o,{image:_,width:v,height:b}=EX(n,i,h,p);(E=this._texture)==null||E.copyExternalImage({image:_,x:a+(h-v)/2,y:u+(p-b)/2,width:v,height:b}),o.width=v,o.height=b,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const HR=[0,0,0,255],kX={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:HR},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}};class q1 extends ho{getShaders(){return super.getShaders({vs:yX,fs:vX,modules:[hu,du,_X]})}initializeState(){this.state={iconManager:new RX(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:HR},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var b;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:u,getIcon:h,textureParameters:p}=n,{iconManager:_}=this.state;if(typeof o=="string")return;const v=o||this.internalState.isAsyncPropLoading("iconAtlas");_.setProps({loadOptions:n.loadOptions,autoPacking:!v,iconAtlas:o,iconMapping:v?a:null,textureParameters:p}),v?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&_.packIcons(u,h),i.extensionsChanged&&((b=this.state.model)==null||b.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:u}=this.state,h=u.getTexture();if(h){const p=this.state.model,_={iconsTexture:h,iconsTextureDim:[h.width,h.height],sizeUnits:ss[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a};p.shaderInputs.setProps({icon:_}),p.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Br(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ea({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const n=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;n?n(e):ot.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}}q1.defaultProps=kX;q1.layerName="IconLayer";const XR=q1,wx=`uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,IX={name:"scatterplot",vs:wx,fs:wx,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},MX=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,OX=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,NX=`// TODO(ibgreen): Hack for Layer uniforms (move to new "color" module?)

struct LayerUniforms {
  opacity: f32,
};

var<private> layer: LayerUniforms = LayerUniforms(1.0);
// @group(0) @binding(1) var<uniform> layer: LayerUniforms;

// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * layer.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    // discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        // discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    // discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,bx=[0,0,0,255],DX={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:bx},getLineColor:{type:"accessor",value:bx},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class Z1 extends ho{getShaders(){return super.getShaders({vs:MX,fs:OX,source:NX,modules:[hu,du,IX]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:u,antialiasing:h,lineWidthUnits:p,lineWidthScale:_,lineWidthMinPixels:v,lineWidthMaxPixels:b}=this.props,E={stroked:o,filled:a,billboard:u,antialiasing:h,radiusUnits:ss[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:ss[p],lineWidthScale:_,lineWidthMinPixels:v,lineWidthMaxPixels:b},R=this.state.model;R.shaderInputs.setProps({scatterplot:E}),R.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Br(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ea({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}}Z1.defaultProps=DX;Z1.layerName="ScatterplotLayer";const BX=Z1,QR={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function YR(t,e,n={}){return LX(t,n)!==e?(UX(t,n),!0):!1}function LX(t,e={}){return Math.sign(FX(t,e))}const xx={x:0,y:1,z:2};function FX(t,e={}){const{start:n=0,end:r=t.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=xx[i[0]],u=xx[i[1]];for(let h=n,p=r-s;h<r;h+=s)o+=(t[h+a]-t[p+a])*(t[h+u]+t[p+u]),p=h;return o/2}function UX(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const u=n+a*i,h=n+(s-1-a)*i;for(let p=0;p<i;++p){const _=t[u+p];t[u+p]=t[h+p],t[h+p]=_}}}function ni(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function k_(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function $A(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function I_(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function hh(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function qR(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},u=(a-o)/n;let h=[];const p=[h],_=$A(t,0,n,o);let v,b;const E=KR(_,i,s,[]),R=[];ni(h,_);for(let D=1;D<u;D++){for(v=$A(t,D,n,o,v),b=hh(v,E);b;){I_(_,v,b,E,R);const P=hh(R,E);P&&(I_(_,R,P,E,R),b=P),ni(h,R),k_(_,R),VX(E,i,b),r&&h.length>n&&(h=[],p.push(h),ni(h,_)),b=hh(v,E)}ni(h,v),k_(_,v)}return r?p:p[0]}const Tx=0,zX=1;function ZR(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],u=[{pos:t,types:o?new Array(t.length/r).fill(zX):null,holes:e||[]}],h=[[],[]];let p=[];for(;u.length;){const{pos:_,types:v,holes:b}=u.shift();$X(_,r,b[0]||_.length,h),p=KR(h[0],i,s,p);const E=hh(h[1],p);if(E){let R=Ex(_,v,r,0,b[0]||_.length,p,E);const D={pos:R[0].pos,types:R[0].types,holes:[]},P={pos:R[1].pos,types:R[1].types,holes:[]};u.push(D,P);for(let S=0;S<b.length;S++)R=Ex(_,v,r,b[S],b[S+1]||_.length,p,E),R[0]&&(D.holes.push(D.pos.length),D.pos=_f(D.pos,R[0].pos),o&&(D.types=_f(D.types,R[0].types))),R[1]&&(P.holes.push(P.pos.length),P.pos=_f(P.pos,R[1].pos),o&&(P.types=_f(P.types,R[1].types)))}else{const R={positions:_};o&&(R.edgeTypes=v),b.length&&(R.holeIndices=b),a.push(R)}}return a}function Ex(t,e,n,r,i,s,o){const a=(i-r)/n,u=[],h=[],p=[],_=[],v=[];let b,E,R;const D=$A(t,a-1,n,r);let P=Math.sign(o&8?D[1]-s[3]:D[0]-s[2]),S=e&&e[a-1],k=0,M=0;for(let V=0;V<a;V++)b=$A(t,V,n,r,b),E=Math.sign(o&8?b[1]-s[3]:b[0]-s[2]),R=e&&e[r/n+V],E&&P&&P!==E&&(I_(D,b,o,s,v),ni(u,v)&&p.push(S),ni(h,v)&&_.push(S)),E<=0?(ni(u,b)&&p.push(R),k-=E):p.length&&(p[p.length-1]=Tx),E>=0?(ni(h,b)&&_.push(R),M+=E):_.length&&(_[_.length-1]=Tx),k_(D,b),P=E,S=R;return[k?{pos:u,types:e&&p}:null,M?{pos:h,types:e&&_}:null]}function KR(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function VX(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function $X(t,e,n,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let u=0;u<n;u+=e){const h=t[u],p=t[u+1];i=h<i?h:i,s=h>s?h:s,o=p<o?p:o,a=p>a?p:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}function _f(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const WX=85.051129;function jX(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);GR(o,n,0,i-r);const a=qR(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const u of a)JR(u,n);return a}function HX(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let u=0,h=0;for(let _=0;_<=e.length;_++){const v=e[_]||t.length,b=h,E=XX(t,r,u,v);for(let R=E;R<v;R++)o[h++]=t[R];for(let R=u;R<E;R++)o[h++]=t[R];GR(o,r,b,h),QX(o,r,b,h,n==null?void 0:n.maxLatitude),u=v,a[_]=h}a.pop();const p=ZR(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const _ of p)JR(_.positions,r);return p}function XX(t,e,n,r){let i=-1,s=-1;for(let o=n+1;o<r;o+=e){const a=Math.abs(t[o]);a>i&&(i=a,s=o-1)}return s}function QX(t,e,n,r,i=WX){const s=t[n],o=t[r-e];if(Math.abs(s-o)>180){const a=$A(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,ni(t,a),a[1]=Math.sign(a[1])*i,ni(t,a),a[0]=s,ni(t,a)}}function GR(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function JR(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}function YX(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?qR(i,{size:e,gridResolution:n}):r?jX(i,{size:e}):i}const qX=1,ZX=2,yg=4;class KX extends $R{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?YX(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Sx(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Sx(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=yg,r[s+o-2]=yg):(r[s]+=qX,r[s+o-2]+=ZX),r[s+o-1]=yg}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,u=0;u<s;a++,u++)this.getPointOnPath(e,u,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function Sx(t){return Array.isArray(t[0])}const Cx=`uniform pathUniforms {
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  float jointType;
  float capType;
  float miterLimit;
  bool billboard;
  highp int widthUnits;
} path;
`,GX={name:"path",vs:Cx,fs:Cx,uniformTypes:{widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",jointType:"f32",capType:"f32",miterLimit:"f32",billboard:"f32",widthUnits:"i32"}},JX=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !path.billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * path.capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = path.capType;
} else {
vJointType = path.jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * layer.opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * path.widthScale, path.widthUnits),
path.widthMinPixels, path.widthMaxPixels) / 2.0);
vec3 width;
if (path.billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,eQ=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > path.miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,ek=[0,0,0,255],tQ={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:ek},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},vg={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class K1 extends ho{getShaders(){return super.getShaders({vs:JX,fs:eQ,modules:[hu,du,GX]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:vg,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:vg,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:vg,defaultValue:ek},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new KX({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,u=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:u.getPath,buffers:u,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:u,widthMaxPixels:h}=this.props,p=this.state.model,_={jointType:Number(n),capType:Number(r),billboard:i,widthUnits:ss[o],widthScale:a,miterLimit:s,widthMinPixels:u,widthMaxPixels:h};p.shaderInputs.setProps({path:_}),p.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Br(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ea({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}}K1.defaultProps=tQ;K1.layerName="PathLayer";const tk=K1;var G1={exports:{}};G1.exports=xd;G1.exports.default=xd;function xd(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=nk(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,u,h,p,_,v,b;if(r&&(s=oQ(t,e,s,n)),t.length>80*n){a=h=t[0],u=p=t[1];for(var E=n;E<i;E+=n)_=t[E],v=t[E+1],_<a&&(a=_),v<u&&(u=v),_>h&&(h=_),v>p&&(p=v);b=Math.max(h-a,p-u),b=b!==0?32767/b:0}return WA(s,o,n,a,u,b,0),o}function nk(t,e,n,r,i){var s,o;if(i===N_(t,e,n,r)>0)for(s=e;s<n;s+=r)o=Px(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=Px(s,t[s],t[s+1],o);return o&&Td(o,o.next)&&(HA(o),o=o.next),o}function na(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(Td(n,n.next)||Wt(n.prev,n,n.next)===0)){if(HA(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function WA(t,e,n,r,i,s,o){if(t){!o&&s&&uQ(t,r,i,s);for(var a=t,u,h;t.prev!==t.next;){if(u=t.prev,h=t.next,s?rQ(t,r,i,s):nQ(t)){e.push(u.i/n|0),e.push(t.i/n|0),e.push(h.i/n|0),HA(t),t=h.next,a=h.next;continue}if(t=h,t===a){o?o===1?(t=iQ(na(t),e,n),WA(t,e,n,r,i,s,2)):o===2&&sQ(t,e,n,r,i,s):WA(na(t),e,n,r,i,s,1);break}}}}function nQ(t){var e=t.prev,n=t,r=t.next;if(Wt(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,u=n.y,h=r.y,p=i<s?i<o?i:o:s<o?s:o,_=a<u?a<h?a:h:u<h?u:h,v=i>s?i>o?i:o:s>o?s:o,b=a>u?a>h?a:h:u>h?u:h,E=r.next;E!==e;){if(E.x>=p&&E.x<=v&&E.y>=_&&E.y<=b&&fl(i,a,s,u,o,h,E.x,E.y)&&Wt(E.prev,E,E.next)>=0)return!1;E=E.next}return!0}function rQ(t,e,n,r){var i=t.prev,s=t,o=t.next;if(Wt(i,s,o)>=0)return!1;for(var a=i.x,u=s.x,h=o.x,p=i.y,_=s.y,v=o.y,b=a<u?a<h?a:h:u<h?u:h,E=p<_?p<v?p:v:_<v?_:v,R=a>u?a>h?a:h:u>h?u:h,D=p>_?p>v?p:v:_>v?_:v,P=M_(b,E,e,n,r),S=M_(R,D,e,n,r),k=t.prevZ,M=t.nextZ;k&&k.z>=P&&M&&M.z<=S;){if(k.x>=b&&k.x<=R&&k.y>=E&&k.y<=D&&k!==i&&k!==o&&fl(a,p,u,_,h,v,k.x,k.y)&&Wt(k.prev,k,k.next)>=0||(k=k.prevZ,M.x>=b&&M.x<=R&&M.y>=E&&M.y<=D&&M!==i&&M!==o&&fl(a,p,u,_,h,v,M.x,M.y)&&Wt(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;k&&k.z>=P;){if(k.x>=b&&k.x<=R&&k.y>=E&&k.y<=D&&k!==i&&k!==o&&fl(a,p,u,_,h,v,k.x,k.y)&&Wt(k.prev,k,k.next)>=0)return!1;k=k.prevZ}for(;M&&M.z<=S;){if(M.x>=b&&M.x<=R&&M.y>=E&&M.y<=D&&M!==i&&M!==o&&fl(a,p,u,_,h,v,M.x,M.y)&&Wt(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function iQ(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!Td(i,s)&&rk(i,r,r.next,s)&&jA(i,s)&&jA(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),HA(r),HA(r.next),r=t=s),r=r.next}while(r!==t);return na(r)}function sQ(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&dQ(o,a)){var u=ik(o,a);o=na(o,o.next),u=na(u,u.next),WA(o,e,n,r,i,s,0),WA(u,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function oQ(t,e,n,r){var i=[],s,o,a,u,h;for(s=0,o=e.length;s<o;s++)a=e[s]*r,u=s<o-1?e[s+1]*r:t.length,h=nk(t,a,u,r,!1),h===h.next&&(h.steiner=!0),i.push(hQ(h));for(i.sort(aQ),s=0;s<i.length;s++)n=lQ(i[s],n);return n}function aQ(t,e){return t.x-e.x}function lQ(t,e){var n=cQ(t,e);if(!n)return e;var r=ik(n,t);return na(r,r.next),na(n,n.next)}function cQ(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===r))return o}n=n.next}while(n!==e);if(!o)return null;var u=o,h=o.x,p=o.y,_=1/0,v;n=o;do r>=n.x&&n.x>=h&&r!==n.x&&fl(i<p?r:s,i,h,p,i<p?s:r,i,n.x,n.y)&&(v=Math.abs(i-n.y)/(r-n.x),jA(n,t)&&(v<_||v===_&&(n.x>o.x||n.x===o.x&&AQ(o,n)))&&(o=n,_=v)),n=n.next;while(n!==u);return o}function AQ(t,e){return Wt(t.prev,t,e.prev)<0&&Wt(e.next,t,t.next)<0}function uQ(t,e,n,r){var i=t;do i.z===0&&(i.z=M_(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,fQ(i)}function fQ(t){var e,n,r,i,s,o,a,u,h=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<h&&(a++,r=r.nextZ,!!r);e++);for(u=h;a>0||u>0&&r;)a!==0&&(u===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,u--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,h*=2}while(o>1);return t}function M_(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function hQ(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function fl(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function dQ(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!pQ(t,e)&&(jA(t,e)&&jA(e,t)&&gQ(t,e)&&(Wt(t.prev,t,e.prev)||Wt(t,e.prev,e))||Td(t,e)&&Wt(t.prev,t,t.next)>0&&Wt(e.prev,e,e.next)>0)}function Wt(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Td(t,e){return t.x===e.x&&t.y===e.y}function rk(t,e,n,r){var i=vf(Wt(t,e,n)),s=vf(Wt(t,e,r)),o=vf(Wt(n,r,t)),a=vf(Wt(n,r,e));return!!(i!==s&&o!==a||i===0&&yf(t,n,e)||s===0&&yf(t,r,e)||o===0&&yf(n,t,r)||a===0&&yf(n,e,r))}function yf(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function vf(t){return t>0?1:t<0?-1:0}function pQ(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&rk(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function jA(t,e){return Wt(t.prev,t,t.next)<0?Wt(t,e,t.next)>=0&&Wt(t,t.prev,e)>=0:Wt(t,e,t.prev)<0||Wt(t,t.next,e)<0}function gQ(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function ik(t,e){var n=new O_(t.i,t.x,t.y),r=new O_(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function Px(t,e,n,r){var i=new O_(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function HA(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function O_(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}xd.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(N_(t,0,s,n));if(i)for(var a=0,u=e.length;a<u;a++){var h=e[a]*n,p=a<u-1?e[a+1]*n:t.length;o-=Math.abs(N_(t,h,p,n))}var _=0;for(a=0;a<r.length;a+=3){var v=r[a]*n,b=r[a+1]*n,E=r[a+2]*n;_+=Math.abs((t[v]-t[E])*(t[b+1]-t[v+1])-(t[v]-t[b])*(t[E+1]-t[v+1]))}return o===0&&_===0?0:Math.abs((_-o)/o)};function N_(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}xd.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var mQ=G1.exports;const _Q=G0(mQ),wf=QR.CLOCKWISE,Rx=QR.COUNTER_CLOCKWISE,Hs={isClosed:!0};function yQ(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Fc(t){return"positions"in t?t.positions:t}function dh(t){return"holeIndices"in t?t.holeIndices:null}function vQ(t){return Array.isArray(t[0])}function wQ(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function bQ(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function xQ(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function kx(t,e,n,r,i){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let u=0;u<r;u++)t[s++]=n[a][u]||0;if(!bQ(n))for(let a=0;a<r;a++)t[s++]=n[0][a]||0;return Hs.start=e,Hs.end=s,Hs.size=r,YR(t,i,Hs),s}function Ix(t,e,n,r,i=0,s,o){s=s||n.length;const a=s-i;if(a<=0)return e;let u=e;for(let h=0;h<a;h++)t[u++]=n[i+h];if(!xQ(n,r,i,s))for(let h=0;h<r;h++)t[u++]=n[i+h];return Hs.start=e,Hs.end=u,Hs.size=r,YR(t,o,Hs),u}function sk(t,e){yQ(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=Ix(n,o,i,e,s[a-1],s[a],a===0?wf:Rx),r.push(o);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!vQ(t))return Ix(n,0,t,e,0,n.length,wf),n;if(!wQ(t)){let i=0;for(const[s,o]of t.entries())i=kx(n,i,o,e,s===0?wf:Rx),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return kx(n,0,t,e,wf),n}function wg(t,e,n){const r=t.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=t[s*3+e]*t[o*3+n],i-=t[o*3+e]*t[s*3+n]}return Math.abs(i/2)}function Mx(t,e,n,r){const i=t.length/3;for(let s=0;s<i;s++){const o=s*3,a=t[o+0],u=t[o+1],h=t[o+2];t[o+e]=a,t[o+n]=u,t[o+r]=h}}function TQ(t,e,n,r){let i=dh(t);i&&(i=i.map(a=>a/e));let s=Fc(t);const o=r&&e===3;if(n){const a=s.length;s=s.slice();const u=[];for(let h=0;h<a;h+=e){u[0]=s[h],u[1]=s[h+1],o&&(u[2]=s[h+2]);const p=n(u);s[h]=p[0],s[h+1]=p[1],o&&(s[h+2]=p[2])}}if(o){const a=wg(s,0,1),u=wg(s,0,2),h=wg(s,1,2);if(!a&&!u&&!h)return[];a>u&&a>h||(u>h?(n||(s=s.slice()),Mx(s,0,2,1)):(n||(s=s.slice()),Mx(s,2,0,1)))}return _Q(s,i,e)}class EQ extends $R{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=sk(e,this.positionSize);return this.opts.resolution?ZR(Fc(n),dh(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?HX(Fc(n),dh(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(Ox(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return Fc(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&Ox(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const r=e;this._updateIndices(r,n),this._updatePositions(r,n),this._updateVertexValid(r,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let u=s.indices;if(!u||!e)return;let h=i;const p=TQ(e,this.positionSize,this.opts.preproject,this.opts.full3d);u=a.allocate(u,i+p.length,{copy:!0});for(let _=0;_<p.length;_++)u[h++]=p[_]+r;o[n+1]=i+p.length,s.indices=u}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=Fc(e);for(let a=n,u=0;u<r;a++,u++){const h=o[u*s],p=o[u*s+1],_=s>2?o[u*s+2]:0;i[a*3]=h,i[a*3+1]=p,i[a*3+2]=_}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&dh(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+r),o)for(let a=0;a<o.length;a++)s[n+o[a]/i-1]=0;s[n+r-1]=0}}function Ox(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const Nx=`uniform solidPolygonUniforms {
  bool extruded;
  bool isWireframe;
  float elevationScale;
} solidPolygon;
`,SQ={name:"solidPolygon",vs:Nx,fs:Nx,uniformTypes:{extruded:"f32",isWireframe:"f32",elevationScale:"f32"}},ok=`in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
out vec4 vColor;
struct PolygonProps {
vec3 positions;
vec3 positions64Low;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project.commonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = solidPolygon.isWireframe ? lineColors : fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = pickingColors;
if (solidPolygon.extruded) {
pos.z += props.elevations * solidPolygon.elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (solidPolygon.extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * layer.opacity);
} else {
vColor = vec4(colors.rgb, colors.a * layer.opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,CQ=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
${ok}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,PQ=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 vertexPositions;
in vec3 nextVertexPositions;
in vec3 vertexPositions64Low;
in vec3 nextVertexPositions64Low;
in float elevations;
in float instanceVertexValid;
${ok}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = vertexPositions;
pos64Low = vertexPositions64Low;
nextPos = nextVertexPositions;
nextPos64Low = nextVertexPositions64Low;
#else
pos = nextVertexPositions;
pos64Low = nextVertexPositions64Low;
nextPos = vertexPositions;
nextPos64Low = vertexPositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = elevations * positions.y;
calculatePosition(props);
}
`,RQ=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
geometry.uv = vec2(0.);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,b0=[0,0,0,255],kQ={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:b0},getLineColor:{type:"accessor",value:b0},material:!0},bf={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t};class J1 extends ho{getShaders(e){return super.getShaders({vs:e==="top"?CQ:PQ,fs:RQ,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[hu,BP,du,SQ]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&n===ut.DEFAULT&&(n=ut.LNGLAT);let i;n===ut.LNGLAT&&(r?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new EQ({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",stepMode:"dynamic",fp64:this.use64bitPositions(),transition:bf,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{nextVertexPositions:{vertexOffset:1}}},instanceVertexValid:{size:1,type:"uint16",stepMode:"instance",update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,stepMode:"dynamic",transition:bf,accessor:"getElevation"},fillColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:bf,accessor:"getFillColor",defaultValue:b0},lineColors:{size:this.props.colorFormat.length,type:"unorm8",stepMode:"dynamic",transition:bf,accessor:"getLineColor",defaultValue:b0},pickingColors:{size:4,type:"uint8",stepMode:"dynamic",accessor:(a,{index:u,target:h})=>this.encodePickingColor(a&&a.__source?a.__source.index:u,h)}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:u,polygonTesselator:h}=this.state,p={extruded:!!n,elevationScale:s,isWireframe:!1};u&&i&&(u.setInstanceCount(h.instanceCount-1),u.shaderInputs.setProps({solidPolygon:{...p,isWireframe:!0}}),u.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(h.instanceCount-1),a.shaderInputs.setProps({solidPolygon:p}),a.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(h.vertexCount),o.shaderInputs.setProps({solidPolygon:p}),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(u=>u.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:r}=this.props;let i,s,o;if(n){const a=this.getShaders("top");a.defines.NON_INSTANCED_MODEL=1;const u=this.getAttributeManager().getBufferLayouts({isInstanced:!1});i=new Br(this.context.device,{...a,id:`${e}-top`,topology:"triangle-list",bufferLayout:u,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}if(r){const a=this.getAttributeManager().getBufferLayouts({isInstanced:!0});s=new Br(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,geometry:new ea({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}}),o=new Br(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,geometry:new ea({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:!0,userData:{excludeAttributes:{indices:!0}}})}return{models:[s,o,i].filter(Boolean),topModel:i,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}}J1.defaultProps=kQ;J1.layerName="SolidPolygonLayer";const ey=J1;function ak({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:s=1/0}=n,o=t.length;let a=o,u=o;for(let v=0;v<o;v++){const b=e(t[v]);if(a>v&&b>=i&&(a=v),b>=s){u=v;break}}let h=a;const _=u-a!==r.length?t.slice(u):void 0;for(let v=0;v<r.length;v++)t[h++]=r[v];if(_){for(let v=0;v<_.length;v++)t[h++]=_[v];t.length=h}return{startRow:a,endRow:a+r.length}}const lk=[0,0,0,255],IQ=[0,0,0,255],MQ={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:IQ},getLineColor:{type:"accessor",value:lk},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class ty extends da{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&ot.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),i=e.dataChanged.map(s=>ak({data:r,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:r,pathsDiff:i})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:r,positionFormat:i,_normalize:s}=this.props,o=[],a=i==="XY"?2:3,{startRow:u,endRow:h}=e,{iterable:p,objectInfo:_}=gu(n,u,h);for(const v of p){_.index++;let b=r(v,_);s&&(b=sk(b,a));const{holeIndices:E}=b,R=b.positions||b;if(E)for(let D=0;D<=E.length;D++){const P=R.slice(E[D-1]||0,E[D]||R.length);o.push(this.getSubLayerRow({path:P},v,_.index))}else o.push(this.getSubLayerRow({path:R},v,_.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:r,filled:i,extruded:s,wireframe:o,_normalize:a,_windingOrder:u,elevationScale:h,transitions:p,positionFormat:_}=this.props,{lineWidthUnits:v,lineWidthScale:b,lineWidthMinPixels:E,lineWidthMaxPixels:R,lineJointRounded:D,lineMiterLimit:P,lineDashJustified:S}=this.props,{getFillColor:k,getLineColor:M,getLineWidth:V,getLineDashArray:Y,getElevation:le,getPolygon:I,updateTriggers:O,material:U}=this.props,{paths:$,pathsDiff:q}=this.state,Z=this.getSubLayerClass("fill",ey),ee=this.getSubLayerClass("stroke",tk),G=this.shouldRenderSubLayer("fill",$)&&new Z({_dataDiff:n,extruded:s,elevationScale:h,filled:i,wireframe:o,_normalize:a,_windingOrder:u,getElevation:le,getFillColor:k,getLineColor:s&&o?M:lk,material:U,transitions:p},this.getSubLayerProps({id:"fill",updateTriggers:O&&{getPolygon:O.getPolygon,getElevation:O.getElevation,getFillColor:O.getFillColor,lineColors:s&&o,getLineColor:O.getLineColor}}),{data:e,positionFormat:_,getPolygon:I}),oe=!s&&r&&this.shouldRenderSubLayer("stroke",$)&&new ee({_dataDiff:q&&(()=>q),widthUnits:v,widthScale:b,widthMinPixels:E,widthMaxPixels:R,jointRounded:D,miterLimit:P,dashJustified:S,_pathType:"loop",transitions:p&&{getWidth:p.getLineWidth,getColor:p.getLineColor,getPath:p.getPolygon},getColor:this.getSubLayerAccessor(M),getWidth:this.getSubLayerAccessor(V),getDashArray:this.getSubLayerAccessor(Y)},this.getSubLayerProps({id:"stroke",updateTriggers:O&&{getWidth:O.getLineWidth,getColor:O.getLineColor,getDashArray:O.getLineDashArray}}),{data:$,positionFormat:_,getPath:ue=>ue.path});return[!s&&G,oe,s&&G]}}ty.layerName="PolygonLayer";ty.defaultProps=MQ;const ck=ty;function OQ(t,e){if(!t)return null;const n="startIndices"in t?t.startIndices[e]:e,r=t.featureIds.value[n];return n!==-1?NQ(t,r,n):null}function NQ(t,e,n){const r={properties:{...t.properties[e]}};for(const i in t.numericProps)r.properties[i]=t.numericProps[i].value[n];return r}function DQ(t,e){const n={points:null,lines:null,polygons:null};for(const r in n){const i=t[r].globalFeatureIds.value;n[r]=new Uint8ClampedArray(i.length*4);const s=[];for(let o=0;o<i.length;o++)e(i[o],s),n[r][o*4+0]=s[0],n[r][o*4+1]=s[1],n[r][o*4+2]=s[2],n[r][o*4+3]=255}return n}const Dx=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,BQ={name:"sdf",vs:Dx,fs:Dx,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},LQ=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,bg=192/256,Bx=[],FQ={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}};class ny extends XR{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,BQ],fs:LQ}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&ot.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,bg*(1-i)):-1,a=this.state.model,u={buffer:bg,outlineBuffer:o,gamma:r,enabled:!!n,outlineColor:s};if(a.shaderInputs.setProps({sdf:u}),super.draw(e),n&&i){const{iconManager:h}=this.state;h.getTexture()&&(a.shaderInputs.setProps({sdf:{...u,outlineBuffer:bg}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Bx}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Bx}}ny.defaultProps=FQ;ny.layerName="MultiIconLayer";const UQ=ny,lA=1e20;class zQ{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal",lang:u=null}={}){this.buffer=n,this.cutoff=i,this.radius=r,this.lang=u;const h=this.size=e+n*4,p=this._createCanvas(h),_=this.ctx=p.getContext("2d",{willReadFrequently:!0});_.font=`${a} ${o} ${e}px ${s}`,_.textBaseline="alphabetic",_.textAlign="left",_.fillStyle="black",this.gridOuter=new Float64Array(h*h),this.gridInner=new Float64Array(h*h),this.f=new Float64Array(h),this.z=new Float64Array(h+1),this.v=new Uint16Array(h)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),u=0,h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),p=Math.min(this.size-this.buffer,a+Math.ceil(i)),_=h+2*this.buffer,v=p+2*this.buffer,b=Math.max(_*v,0),E=new Uint8ClampedArray(b),R={data:E,width:_,height:v,glyphWidth:h,glyphHeight:p,glyphTop:a,glyphLeft:u,glyphAdvance:n};if(h===0||p===0)return R;const{ctx:D,buffer:P,gridInner:S,gridOuter:k}=this;this.lang&&(D.lang=this.lang),D.clearRect(P,P,h,p),D.fillText(e,P,P+a);const M=D.getImageData(P,P,h,p);k.fill(lA,0,b),S.fill(0,0,b);for(let V=0;V<p;V++)for(let Y=0;Y<h;Y++){const le=M.data[4*(V*h+Y)+3]/255;if(le===0)continue;const I=(V+P)*_+Y+P;if(le===1)k[I]=0,S[I]=lA;else{const O=.5-le;k[I]=O>0?O*O:0,S[I]=O<0?O*O:0}}Lx(k,0,0,_,v,_,this.f,this.v,this.z),Lx(S,P,P,h,p,_,this.f,this.v,this.z);for(let V=0;V<b;V++){const Y=Math.sqrt(k[V])-Math.sqrt(S[V]);E[V]=Math.round(255-255*(Y/this.radius+this.cutoff))}return R}}function Lx(t,e,n,r,i,s,o,a,u){for(let h=e;h<e+r;h++)Fx(t,n*s+h,s,i,o,a,u);for(let h=n;h<n+i;h++)Fx(t,h*s+e,1,r,o,a,u)}function Fx(t,e,n,r,i,s,o){s[0]=0,o[0]=-lA,o[1]=lA,i[0]=t[e];for(let a=1,u=0,h=0;a<r;a++){i[a]=t[e+a*n];const p=a*a;do{const _=s[u];h=(i[a]-i[_]+p-_*_)/(a-_)/2}while(h<=o[u]&&--u>-1);u++,s[u]=a,o[u]=h,o[u+1]=lA}for(let a=0,u=0;a<r;a++){for(;o[u+1]<a;)u++;const h=s[u],p=a-h;t[e+a*n]=i[h]+p*p}}const VQ=32,$Q=[];function WQ(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function jQ({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let u=0,h=o;const p=n+r*2;for(const _ of t)if(!s[_]){const v=e(_);h+v+r*2>i&&(h=0,u++),s[_]={x:h+r,y:a+u*p+r,width:v,height:p,layoutWidth:v,layoutHeight:n},h+=v+r*2}return{mapping:s,xOffset:h,yOffset:a+u*p,canvasHeight:WQ(a+(u+1)*p)}}function Ak(t,e,n,r){var s;let i=0;for(let o=e;o<n;o++){const a=t[o];i+=((s=r[a])==null?void 0:s.layoutWidth)||0}return i}function uk(t,e,n,r,i,s){let o=e,a=0;for(let u=e;u<n;u++){const h=Ak(t,u,u+1,i);a+h>r&&(o<u&&s.push(u),o=u,a=0),a+=h}return a}function HQ(t,e,n,r,i,s){let o=e,a=e,u=e,h=0;for(let p=e;p<n;p++)if((t[p]===" "||t[p+1]===" "||p+1===n)&&(u=p+1),u>a){let _=Ak(t,a,u,i);h+_>r&&(o<a&&(s.push(a),o=a,h=0),_>r&&(_=uk(t,a,u,r,i,s),o=s[s.length-1])),a=u,h+=_}return h}function XQ(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?uk(t,i,s,n,r,o):HQ(t,i,s,n,r,o),o}function QQ(t,e,n,r,i,s){let o=0,a=0;for(let u=e;u<n;u++){const h=t[u],p=r[h];p?(a||(a=p.layoutHeight),i[u]=o+p.layoutWidth/2,o+=p.layoutWidth):(ot.warn(`Missing character: ${h} (${h.codePointAt(0)})`)(),i[u]=o,o+=VQ)}s[0]=o,s[1]=a}function YQ(t,e,n,r,i){var D;const s=Array.from(t),o=s.length,a=new Array(o),u=new Array(o),h=new Array(o),p=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,_=[0,0],v=[0,0];let b=0,E=0,R=0;for(let P=0;P<=o;P++){const S=s[P];if((S===`
`||P===o)&&(R=P),R>E){const k=p?XQ(s,n,r,i,E,R):$Q;for(let M=0;M<=k.length;M++){const V=M===0?E:k[M-1],Y=M<k.length?k[M]:R;QQ(s,V,Y,i,a,v);for(let le=V;le<Y;le++){const I=s[le],O=((D=i[I])==null?void 0:D.layoutOffsetY)||0;u[le]=b+v[1]/2+O,h[le]=v[0]}b=b+v[1]*e,_[0]=Math.max(_[0],v[0])}E=R}S===`
`&&(a[E]=0,u[E]=0,h[E]=0,E++)}return _[1]=b,{x:a,y:u,rowWidth:h,size:_}}function qQ({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,u=r?r/o:0,h=i[e]||Math.ceil((t.length-u)/a),p=s&&new Set,_=new Array(e);let v=t;if(a>1||u>0){const b=t.constructor;v=new b(h);for(let E=0;E<h;E++)v[E]=t[E*a+u]}for(let b=0;b<e;b++){const E=i[b],R=i[b+1]||h,D=v.subarray(E,R);_[b]=String.fromCodePoint.apply(null,D),p&&D.forEach(p.add,p)}if(p)for(const b of p)s.add(String.fromCodePoint(b));return{texts:_,characterCount:h}}class fk{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function ZQ(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Sl={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:ZQ(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},Ux=1024,zx=.9,Vx=1.2,hk=3;let x0=new fk(hk);function KQ(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=x0.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function GQ(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function $x(t,e,n,r){t.font=`${r} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function JQ(t){ot.assert(Number.isFinite(t)&&t>=hk,"Invalid cache limit"),x0=new fk(t)}class eY{constructor(){this.props={...Sl}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*Vx+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=KQ(this._key,this.props.characterSet),r=x0.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,x0.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:u,cutoff:h}=this.props;let p=n&&n.data;p||(p=document.createElement("canvas"),p.width=Ux);const _=p.getContext("2d",{willReadFrequently:!0});$x(_,r,s,i);const{mapping:v,canvasHeight:b,xOffset:E,yOffset:R}=jQ({getFontWidth:D=>_.measureText(D).width,fontHeight:s*Vx,buffer:o,characterSet:e,maxCanvasWidth:Ux,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(p.height!==b){const D=_.getImageData(0,0,p.width,p.height);p.height=b,_.putImageData(D,0,0)}if($x(_,r,s,i),a){const D=new zQ({fontSize:s,buffer:o,radius:u,cutoff:h,fontFamily:r,fontWeight:`${i}`});for(const P of e){const{data:S,width:k,height:M,glyphTop:V}=D.draw(P);v[P].width=k,v[P].layoutOffsetY=s*zx-V;const Y=_.createImageData(k,M);GQ(S,Y),_.putImageData(Y,v[P].x,v[P].y)}}else for(const D of e)_.fillText(D,v[D].x,v[D].y+o+s*zx);return{xOffset:E,yOffset:R,mapping:v,data:p,width:p.width,height:p.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${n} ${r} ${i} ${o} ${a}`:`${e} ${n} ${r} ${i}`}}const Wx=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 borderRadius;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,tY={name:"textBackground",vs:Wx,fs:Wx,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",borderRadius:"vec4<f32>",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},nY=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,rY=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
float round_rect(vec2 p, vec2 size, vec4 radii) {
vec2 pixelPositionCB = (p - 0.5) * size;
vec2 sizeCB = size * 0.5;
float maxBorderRadius = min(size.x, size.y) * 0.5;
vec4 borderRadius = vec4(min(radii, maxBorderRadius));
borderRadius.xy =
(pixelPositionCB.x > 0.0) ? borderRadius.xy : borderRadius.zw;
borderRadius.x = (pixelPositionCB.y > 0.0) ? borderRadius.x : borderRadius.y;
vec2 q = abs(pixelPositionCB) - sizeCB + borderRadius.x;
return -(min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - borderRadius.x);
}
float rect(vec2 p, vec2 size) {
vec2 pixelPosition = p * size;
return min(min(pixelPosition.x, size.x - pixelPosition.x),
min(pixelPosition.y, size.y - pixelPosition.y));
}
vec4 get_stroked_fragColor(float dist) {
float isBorder = smoothedge(dist, vLineWidth);
return mix(vFillColor, vLineColor, isBorder);
}
void main(void) {
geometry.uv = uv;
if (textBackground.borderRadius != vec4(0.0)) {
float distToEdge = round_rect(uv, dimensions, textBackground.borderRadius);
if (textBackground.stroked) {
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
float shapeAlpha = smoothedge(-distToEdge, 0.0);
fragColor.a *= shapeAlpha;
} else {
if (textBackground.stroked) {
float distToEdge = rect(uv, dimensions);
fragColor = get_stroked_fragColor(distToEdge);
} else {
fragColor = vFillColor;
}
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,iY={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,borderRadius:{type:"object",value:0},padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}};class ry extends ho{getShaders(){return super.getShaders({vs:nY,fs:rY,modules:[hu,du,tY]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:u,borderRadius:h}=this.props;u.length<4&&(u=[u[0],u[1],u[0],u[1]]),Array.isArray(h)||(h=[h,h,h,h]);const p=this.state.model,_={billboard:n,stroked:!!a,borderRadius:h,padding:u,sizeUnits:ss[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o};p.shaderInputs.setProps({textBackground:_}),p.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Br(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new ea({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}}ry.defaultProps=iY;ry.layerName="TextBackgroundLayer";const sY=ry,jx={start:1,middle:0,end:-1},Hx={top:1,center:0,bottom:-1},xg=[0,0,0,255],oY=1,aY={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:xg},getBorderWidth:{type:"accessor",value:0},backgroundBorderRadius:{type:"object",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Sl.characterSet},fontFamily:Sl.fontFamily,fontWeight:Sl.fontWeight,lineHeight:oY,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:xg},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:xg},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}};class iy extends da{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[r,i]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,u=jx[typeof o=="function"?o(e,n):o],h=Hx[typeof a=="function"?a(e,n):a];return[(u-1)*r/2,(h-1)*i/2,r,i]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:a,size:[u,h]}=this.transformParagraph(e,n),p=jx[typeof r=="function"?r(e,n):r],_=Hx[typeof i=="function"?i(e,n):i],v=s.length,b=new Array(v*2);let E=0;for(let R=0;R<v;R++){const D=(1-p)*(u-a[R])/2;b[E++]=(p-1)*u/2+D+s[R],b[E++]=(_-1)*h/2+o[R]}return b}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new eY},this.props.maxWidth>0&&ot.once(1,"v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var u;const{data:e,characterSet:n}=this.props,r=(u=e.attributes)==null?void 0:u.getText;let{getText:i}=this.props,s=e.startIndices,o;const a=n==="auto"&&new Set;if(r&&s){const{texts:h,characterCount:p}=qQ({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:a});o=p,i=(_,{index:v})=>h[v]}else{const{iterable:h,objectInfo:p}=gu(e);s=[0],o=0;for(const _ of h){p.index++;const v=Array.from(i(_,p)||"");a&&v.forEach(a.add,a),o+=v.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:u}=this.props,h=s(e,n)||"";return YQ(h,a,o,u*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:a}=this.state,{data:u,_dataDiff:h,getPosition:p,getColor:_,getSize:v,getAngle:b,getPixelOffset:E,getBackgroundColor:R,getBorderColor:D,getBorderWidth:P,backgroundBorderRadius:S,backgroundPadding:k,background:M,billboard:V,fontSettings:Y,outlineWidth:le,outlineColor:I,sizeScale:O,sizeUnits:U,sizeMinPixels:$,sizeMaxPixels:q,transitions:Z,updateTriggers:ee}=this.props,G=this.getSubLayerClass("characters",UQ),oe=this.getSubLayerClass("background",sY);return[M&&new oe({getFillColor:R,getLineColor:D,getLineWidth:P,borderRadius:S,padding:k,getPosition:p,getSize:v,getAngle:b,getPixelOffset:E,billboard:V,sizeScale:O,sizeUnits:U,sizeMinPixels:$,sizeMaxPixels:q,transitions:Z&&{getPosition:Z.getPosition,getAngle:Z.getAngle,getSize:Z.getSize,getFillColor:Z.getBackgroundColor,getLineColor:Z.getBorderColor,getLineWidth:Z.getBorderWidth,getPixelOffset:Z.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:ee.getPosition,getAngle:ee.getAngle,getSize:ee.getSize,getFillColor:ee.getBackgroundColor,getLineColor:ee.getBorderColor,getLineWidth:ee.getBorderWidth,getPixelOffset:ee.getPixelOffset,getBoundingRect:{getText:ee.getText,getTextAnchor:ee.getTextAnchor,getAlignmentBaseline:ee.getAlignmentBaseline,styleVersion:a}}}),{data:u.attributes&&u.attributes.background?{length:u.length,attributes:u.attributes.background}:u,_dataDiff:h,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new G({sdf:Y.sdf,smoothing:Number.isFinite(Y.smoothing)?Y.smoothing:Sl.smoothing,outlineWidth:le/(Y.radius||Sl.radius),outlineColor:I,iconAtlas:s,iconMapping:o,getPosition:p,getColor:_,getSize:v,getAngle:b,getPixelOffset:E,billboard:V,sizeScale:O*i,sizeUnits:U,sizeMinPixels:$*i,sizeMaxPixels:q*i,transitions:Z&&{getPosition:Z.getPosition,getAngle:Z.getAngle,getColor:Z.getColor,getSize:Z.getSize,getPixelOffset:Z.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:ee.getText,getPosition:ee.getPosition,getAngle:ee.getAngle,getColor:ee.getColor,getSize:ee.getSize,getPixelOffset:ee.getPixelOffset,getIconOffsets:{getTextAnchor:ee.getTextAnchor,getAlignmentBaseline:ee.getAlignmentBaseline,styleVersion:a}}}),{data:u,_dataDiff:h,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){JQ(e)}}iy.defaultProps=aY;iy.layerName="TextLayer";const lY=iy,ph={circle:{type:BX,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:XR,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:lY,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},gh={type:tk,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},D_={type:ey,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function xc({type:t,props:e}){const n={};for(const r in e)n[r]=t.defaultProps[e[r]];return n}function Tg(t,e){const{transitions:n,updateTriggers:r}=t.props,i={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(const s in e){const o=e[s];let a=t.props[s];s.startsWith("get")&&(a=t.getSubLayerAccessor(a),i.updateTriggers[o]=r[s],n&&(i.transitions[o]=n[s])),i[o]=a}return i}function cY(t){if(Array.isArray(t))return t;switch(ot.assert(t.type,"GeoJSON does not have type"),t.type){case"Feature":return[t];case"FeatureCollection":return ot.assert(Array.isArray(t.features),"GeoJSON does not have features array"),t.features;default:return[{geometry:t}]}}function Xx(t,e,n={}){const r={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},{startRow:i=0,endRow:s=t.length}=n;for(let o=i;o<s;o++){const a=t[o],{geometry:u}=a;if(u)if(u.type==="GeometryCollection"){ot.assert(Array.isArray(u.geometries),"GeoJSON does not have geometries array");const{geometries:h}=u;for(let p=0;p<h.length;p++){const _=h[p];Qx(_,r,e,a,o)}}else Qx(u,r,e,a,o)}return r}function Qx(t,e,n,r,i){const{type:s,coordinates:o}=t,{pointFeatures:a,lineFeatures:u,polygonFeatures:h,polygonOutlineFeatures:p}=e;if(!uY(s,o)){ot.warn(`${s} coordinates are malformed`)();return}switch(s){case"Point":a.push(n({geometry:t},r,i));break;case"MultiPoint":o.forEach(_=>{a.push(n({geometry:{type:"Point",coordinates:_}},r,i))});break;case"LineString":u.push(n({geometry:t},r,i));break;case"MultiLineString":o.forEach(_=>{u.push(n({geometry:{type:"LineString",coordinates:_}},r,i))});break;case"Polygon":h.push(n({geometry:t},r,i)),o.forEach(_=>{p.push(n({geometry:{type:"LineString",coordinates:_}},r,i))});break;case"MultiPolygon":o.forEach(_=>{h.push(n({geometry:{type:"Polygon",coordinates:_}},r,i)),_.forEach(v=>{p.push(n({geometry:{type:"LineString",coordinates:v}},r,i))})});break}}const AY={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function uY(t,e){let n=AY[t];for(ot.assert(n,`Unknown GeoJSON type ${t}`);e&&--n>0;)e=e[0];return e&&Number.isFinite(e[0])}function dk(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function xf(t){return t.geometry.coordinates}function fY(t,e){const n=dk(),{pointFeatures:r,lineFeatures:i,polygonFeatures:s,polygonOutlineFeatures:o}=t;return n.points.data=r,n.points._dataDiff=e.pointFeatures&&(()=>e.pointFeatures),n.points.getPosition=xf,n.lines.data=i,n.lines._dataDiff=e.lineFeatures&&(()=>e.lineFeatures),n.lines.getPath=xf,n.polygons.data=s,n.polygons._dataDiff=e.polygonFeatures&&(()=>e.polygonFeatures),n.polygons.getPolygon=xf,n.polygonsOutline.data=o,n.polygonsOutline._dataDiff=e.polygonOutlineFeatures&&(()=>e.polygonOutlineFeatures),n.polygonsOutline.getPath=xf,n}function hY(t,e){const n=dk(),{points:r,lines:i,polygons:s}=t,o=DQ(t,e);return n.points.data={length:r.positions.value.length/r.positions.size,attributes:{...r.attributes,getPosition:r.positions,instancePickingColors:{size:4,value:o.points}},properties:r.properties,numericProps:r.numericProps,featureIds:r.featureIds},n.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:{...i.attributes,getPath:i.positions,instancePickingColors:{size:4,value:o.lines}},properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},n.lines._pathType="open",n.polygons.data={length:s.polygonIndices.value.length-1,startIndices:s.polygonIndices.value,attributes:{...s.attributes,getPolygon:s.positions,pickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygons._normalize=!1,s.triangles&&(n.polygons.data.attributes.indices=s.triangles.value),n.polygonsOutline.data={length:s.primitivePolygonIndices.value.length-1,startIndices:s.primitivePolygonIndices.value,attributes:{...s.attributes,getPath:s.positions,instancePickingColors:{size:4,value:o.polygons}},properties:s.properties,numericProps:s.numericProps,featureIds:s.featureIds},n.polygonsOutline._pathType="open",n}const dY=["points","linestrings","polygons"],pY={...xc(ph.circle),...xc(ph.icon),...xc(ph.text),...xc(gh),...xc(D_),stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:t=>t.properties.icon},getText:{type:"accessor",value:t=>t.properties.text},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}};class sy extends da{initializeState(){this.state={layerProps:{},features:{},featuresDiff:{}}}updateState({props:e,changeFlags:n}){if(!n.dataChanged)return;const{data:r}=this.props,i=r&&"points"in r&&"polygons"in r&&"lines"in r;this.setState({binary:i}),i?this._updateStateBinary({props:e,changeFlags:n}):this._updateStateJSON({props:e,changeFlags:n})}_updateStateBinary({props:e,changeFlags:n}){const r=hY(e.data,this.encodePickingColor);this.setState({layerProps:r})}_updateStateJSON({props:e,changeFlags:n}){const r=cY(e.data),i=this.getSubLayerRow.bind(this);let s={};const o={};if(Array.isArray(n.dataChanged)){const u=this.state.features;for(const h in u)s[h]=u[h].slice(),o[h]=[];for(const h of n.dataChanged){const p=Xx(r,i,h);for(const _ in u)o[_].push(ak({data:s[_],getIndex:v=>v.__source.index,dataRange:h,replace:p[_]}))}}else s=Xx(r,i);const a=fY(s,o);this.setState({features:s,featuresDiff:o,layerProps:a})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r,sourceLayer:i}=n;return n.featureType=dY.find(s=>i.id.startsWith(`${this.id}-${s}-`)),r>=0&&i.id.startsWith(`${this.id}-points-text`)&&this.state.binary&&(n.index=this.props.data.points.globalFeatureIds.value[r]),n}_updateAutoHighlight(e){const n=`${this.id}-points-`,r=e.featureType==="points";for(const i of this.getSubLayers())i.id.startsWith(n)===r&&i.updateAutoHighlight(e)}_renderPolygonLayer(){var o;const{extruded:e,wireframe:n}=this.props,{layerProps:r}=this.state,i="polygons-fill",s=this.shouldRenderSubLayer(i,(o=r.polygons)==null?void 0:o.data)&&this.getSubLayerClass(i,D_.type);if(s){const a=Tg(this,D_.props),u=e&&n;return u||delete a.getLineColor,a.updateTriggers.lineColors=u,new s(a,this.getSubLayerProps({id:i,updateTriggers:a.updateTriggers}),r.polygons)}return null}_renderLineLayers(){var u,h;const{extruded:e,stroked:n}=this.props,{layerProps:r}=this.state,i="polygons-stroke",s="linestrings",o=!e&&n&&this.shouldRenderSubLayer(i,(u=r.polygonsOutline)==null?void 0:u.data)&&this.getSubLayerClass(i,gh.type),a=this.shouldRenderSubLayer(s,(h=r.lines)==null?void 0:h.data)&&this.getSubLayerClass(s,gh.type);if(o||a){const p=Tg(this,gh.props);return[o&&new o(p,this.getSubLayerProps({id:i,updateTriggers:p.updateTriggers}),r.polygonsOutline),a&&new a(p,this.getSubLayerProps({id:s,updateTriggers:p.updateTriggers}),r.lines)]}return null}_renderPointLayers(){var a;const{pointType:e}=this.props,{layerProps:n,binary:r}=this.state;let{highlightedObjectIndex:i}=this.props;!r&&Number.isFinite(i)&&(i=n.points.data.findIndex(u=>u.__source.index===i));const s=new Set(e.split("+")),o=[];for(const u of s){const h=`points-${u}`,p=ph[u],_=p&&this.shouldRenderSubLayer(h,(a=n.points)==null?void 0:a.data)&&this.getSubLayerClass(h,p.type);if(_){const v=Tg(this,p.props);let b=n.points;if(u==="text"&&r){const{instancePickingColors:E,...R}=b.data.attributes;b={...b,data:{...b.data,attributes:R}}}o.push(new _(v,this.getSubLayerProps({id:h,updateTriggers:v.updateTriggers,highlightedObjectIndex:i}),b))}}return o}renderLayers(){const{extruded:e}=this.props,n=this._renderPolygonLayer(),r=this._renderLineLayers(),i=this._renderPointLayers();return[!e&&n,r,i,e&&n]}getSubLayerAccessor(e){const{binary:n}=this.state;return!n||typeof e!="function"?super.getSubLayerAccessor(e):(r,i)=>{const{data:s,index:o}=i,a=OQ(s,o);return e(a,i)}}}sy.layerName="GeoJsonLayer";sy.defaultProps=pY;const gY=sy,mY={...ck.defaultProps};class oy extends da{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:n,wireframe:r,filled:i,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:u,lineWidthMaxPixels:h,lineJointRounded:p,lineMiterLimit:_,lineDashJustified:v,getElevation:b,getFillColor:E,getLineColor:R,getLineWidth:D}=this.props,{updateTriggers:P,material:S,transitions:k}=this.props,M=this.getSubLayerClass("cell",ck),{updateTriggers:V,...Y}=this.indexToBounds()||{};return new M({filled:i,wireframe:r,extruded:n,elevationScale:e,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:u,lineWidthMaxPixels:h,lineJointRounded:p,lineMiterLimit:_,lineDashJustified:v,material:S,transitions:k,getElevation:b,getFillColor:E,getLineColor:R,getLineWidth:D},this.getSubLayerProps({id:"cell",updateTriggers:P&&{...V,getElevation:P.getElevation,getFillColor:P.getFillColor,getLineColor:P.getLineColor,getLineWidth:P.getLineWidth}}),Y)}}oy.layerName="GeoCellLayer";oy.defaultProps=mY;const _Y=oy;var Ot=function(t){t=t||{};var e=typeof t<"u"?t:{},n={},r;for(r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);var i="";function s(he){return e.locateFile?e.locateFile(he,i):i+he}var o;typeof document<"u"&&document.currentScript&&(i=document.currentScript.src),i.indexOf("blob:")!==0?i=i.substr(0,i.lastIndexOf("/")+1):i="",o=function(me,Pe,_e){var c=new XMLHttpRequest;c.open("GET",me,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status==200||c.status==0&&c.response){Pe(c.response);return}var ct=Bd(me);if(ct){Pe(ct.buffer);return}_e()},c.onerror=_e,c.send(null)};var a=e.print||console.log.bind(console),u=e.printErr||console.warn.bind(console);for(r in n)n.hasOwnProperty(r)&&(e[r]=n[r]);n=null,e.arguments&&e.arguments;var h=0,p=function(he){h=he},_=function(){return h},v=8;function b(he,me,Pe,_e){switch(Pe=Pe||"i8",Pe.charAt(Pe.length-1)==="*"&&(Pe="i32"),Pe){case"i1":q[he>>0]=me;break;case"i8":q[he>>0]=me;break;case"i16":ee[he>>1]=me;break;case"i32":G[he>>2]=me;break;case"i64":Dd=[me>>>0,(_a=me,+Zn(_a)>=1?_a>0?(RM(+Bt(_a/4294967296),4294967295)|0)>>>0:~~+mn((_a-+(~~_a>>>0))/4294967296)>>>0:0)],G[he>>2]=Dd[0],G[he+4>>2]=Dd[1];break;case"float":oe[he>>2]=me;break;case"double":ue[he>>3]=me;break;default:mo("invalid type for setValue: "+Pe)}}function E(he,me,Pe){switch(me=me||"i8",me.charAt(me.length-1)==="*"&&(me="i32"),me){case"i1":return q[he>>0];case"i8":return q[he>>0];case"i16":return ee[he>>1];case"i32":return G[he>>2];case"i64":return G[he>>2];case"float":return oe[he>>2];case"double":return ue[he>>3];default:mo("invalid type for getValue: "+me)}return null}var R=!1;function D(he,me){he||mo("Assertion failed: "+me)}function P(he){var me=e["_"+he];return D(me,"Cannot call unknown function "+he+", make sure it is exported"),me}function S(he,me,Pe,_e,c){var N={string:function(nt){var xr=0;if(nt!=null&&nt!==0){var Eu=(nt.length<<2)+1;xr=Zy(Eu),I(nt,xr,Eu)}return xr},array:function(nt){var xr=Zy(nt.length);return O(nt,xr),xr}};function ct(nt){return me==="string"?Y(nt):me==="boolean"?!!nt:nt}var yt=P(he),cn=[],tt=0;if(_e)for(var At=0;At<_e.length;At++){var fs=N[Pe[At]];fs?(tt===0&&(tt=XM()),cn[At]=fs(_e[At])):cn[At]=_e[At]}var ht=yt.apply(null,cn);return ht=ct(ht),tt!==0&&HM(tt),ht}function k(he,me,Pe,_e){Pe=Pe||[];var c=Pe.every(function(ct){return ct==="number"}),N=me!=="string";return N&&c&&!_e?P(he):function(){return S(he,me,Pe,arguments)}}var M=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function V(he,me,Pe){for(var _e=me+Pe,c=me;he[c]&&!(c>=_e);)++c;if(c-me>16&&he.subarray&&M)return M.decode(he.subarray(me,c));for(var N="";me<c;){var ct=he[me++];if(!(ct&128)){N+=String.fromCharCode(ct);continue}var yt=he[me++]&63;if((ct&224)==192){N+=String.fromCharCode((ct&31)<<6|yt);continue}var cn=he[me++]&63;if((ct&240)==224?ct=(ct&15)<<12|yt<<6|cn:ct=(ct&7)<<18|yt<<12|cn<<6|he[me++]&63,ct<65536)N+=String.fromCharCode(ct);else{var tt=ct-65536;N+=String.fromCharCode(55296|tt>>10,56320|tt&1023)}}return N}function Y(he,me){return he?V(Z,he,me):""}function le(he,me,Pe,_e){if(!(_e>0))return 0;for(var c=Pe,N=Pe+_e-1,ct=0;ct<he.length;++ct){var yt=he.charCodeAt(ct);if(yt>=55296&&yt<=57343){var cn=he.charCodeAt(++ct);yt=65536+((yt&1023)<<10)|cn&1023}if(yt<=127){if(Pe>=N)break;me[Pe++]=yt}else if(yt<=2047){if(Pe+1>=N)break;me[Pe++]=192|yt>>6,me[Pe++]=128|yt&63}else if(yt<=65535){if(Pe+2>=N)break;me[Pe++]=224|yt>>12,me[Pe++]=128|yt>>6&63,me[Pe++]=128|yt&63}else{if(Pe+3>=N)break;me[Pe++]=240|yt>>18,me[Pe++]=128|yt>>12&63,me[Pe++]=128|yt>>6&63,me[Pe++]=128|yt&63}}return me[Pe]=0,Pe-c}function I(he,me,Pe){return le(he,Z,me,Pe)}typeof TextDecoder<"u"&&new TextDecoder("utf-16le");function O(he,me){q.set(he,me)}function U(he,me){return he%me>0&&(he+=me-he%me),he}var $,q,Z,ee,G,oe,ue;function K(he){$=he,e.HEAP8=q=new Int8Array(he),e.HEAP16=ee=new Int16Array(he),e.HEAP32=G=new Int32Array(he),e.HEAPU8=Z=new Uint8Array(he),e.HEAPU16=new Uint16Array(he),e.HEAPU32=new Uint32Array(he),e.HEAPF32=oe=new Float32Array(he),e.HEAPF64=ue=new Float64Array(he)}var de=5271520,be=28608,Re=e.TOTAL_MEMORY||33554432;e.buffer?$=e.buffer:$=new ArrayBuffer(Re),Re=$.byteLength,K($),G[be>>2]=de;function ze(he){for(;he.length>0;){var me=he.shift();if(typeof me=="function"){me();continue}var Pe=me.func;typeof Pe=="number"?me.arg===void 0?e.dynCall_v(Pe):e.dynCall_vi(Pe,me.arg):Pe(me.arg===void 0?null:me.arg)}}var _t=[],wt=[],it=[],st=[];function zt(){if(e.preRun)for(typeof e.preRun=="function"&&(e.preRun=[e.preRun]);e.preRun.length;)br(e.preRun.shift());ze(_t)}function ma(){ze(wt)}function tc(){ze(it)}function nc(){if(e.postRun)for(typeof e.postRun=="function"&&(e.postRun=[e.postRun]);e.postRun.length;)po(e.postRun.shift());ze(st)}function br(he){_t.unshift(he)}function po(he){st.unshift(he)}var Zn=Math.abs,mn=Math.ceil,Bt=Math.floor,RM=Math.min,go=0,rc=null;function kM(he){go++,e.monitorRunDependencies&&e.monitorRunDependencies(go)}function IM(he){if(go--,e.monitorRunDependencies&&e.monitorRunDependencies(go),go==0&&rc){var me=rc;rc=null,me()}}e.preloadedImages={},e.preloadedAudios={};var Di=null,Nd="data:application/octet-stream;base64,";function Hy(he){return String.prototype.startsWith?he.startsWith(Nd):he.indexOf(Nd)===0}var _a,Dd;Di="data:application/octet-stream;base64,AAAAAAAAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAAAQAAAAQAAAADAAAABgAAAAUAAAACAAAAAAAAAAIAAAADAAAAAQAAAAQAAAAGAAAAAAAAAAUAAAADAAAABgAAAAQAAAAFAAAAAAAAAAEAAAACAAAABAAAAAUAAAAGAAAAAAAAAAIAAAADAAAAAQAAAAUAAAACAAAAAAAAAAEAAAADAAAABgAAAAQAAAAGAAAAAAAAAAUAAAACAAAAAQAAAAQAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAAAAAAEAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAYAAAAAAAAABQAAAAAAAAAAAAAABAAAAAUAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAYAAAAAAAAABgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAABAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAgAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAMAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAAEAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABQAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAYAAAAAAAAAAQAAAAIAAAADAAAABAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAIAAAAAAAAAAAAAAAYAAAAAAAAAAwAAAAIAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAFAAAABAAAAAAAAAABAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAYAAAAAAAAABAAAAAAAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAgAAAAQAAAADAAAACAAAAAEAAAAHAAAABgAAAAkAAAAAAAAAAwAAAAIAAAACAAAABgAAAAoAAAALAAAAAAAAAAEAAAAFAAAAAwAAAA0AAAABAAAABwAAAAQAAAAMAAAAAAAAAAQAAAB/AAAADwAAAAgAAAADAAAAAAAAAAwAAAAFAAAAAgAAABIAAAAKAAAACAAAAAAAAAAQAAAABgAAAA4AAAALAAAAEQAAAAEAAAAJAAAAAgAAAAcAAAAVAAAACQAAABMAAAADAAAADQAAAAEAAAAIAAAABQAAABYAAAAQAAAABAAAAAAAAAAPAAAACQAAABMAAAAOAAAAFAAAAAEAAAAHAAAABgAAAAoAAAALAAAAGAAAABcAAAAFAAAAAgAAABIAAAALAAAAEQAAABcAAAAZAAAAAgAAAAYAAAAKAAAADAAAABwAAAANAAAAGgAAAAQAAAAPAAAAAwAAAA0AAAAaAAAAFQAAAB0AAAADAAAADAAAAAcAAAAOAAAAfwAAABEAAAAbAAAACQAAABQAAAAGAAAADwAAABYAAAAcAAAAHwAAAAQAAAAIAAAADAAAABAAAAASAAAAIQAAAB4AAAAIAAAABQAAABYAAAARAAAACwAAAA4AAAAGAAAAIwAAABkAAAAbAAAAEgAAABgAAAAeAAAAIAAAAAUAAAAKAAAAEAAAABMAAAAiAAAAFAAAACQAAAAHAAAAFQAAAAkAAAAUAAAADgAAABMAAAAJAAAAKAAAABsAAAAkAAAAFQAAACYAAAATAAAAIgAAAA0AAAAdAAAABwAAABYAAAAQAAAAKQAAACEAAAAPAAAACAAAAB8AAAAXAAAAGAAAAAsAAAAKAAAAJwAAACUAAAAZAAAAGAAAAH8AAAAgAAAAJQAAAAoAAAAXAAAAEgAAABkAAAAXAAAAEQAAAAsAAAAtAAAAJwAAACMAAAAaAAAAKgAAAB0AAAArAAAADAAAABwAAAANAAAAGwAAACgAAAAjAAAALgAAAA4AAAAUAAAAEQAAABwAAAAfAAAAKgAAACwAAAAMAAAADwAAABoAAAAdAAAAKwAAACYAAAAvAAAADQAAABoAAAAVAAAAHgAAACAAAAAwAAAAMgAAABAAAAASAAAAIQAAAB8AAAApAAAALAAAADUAAAAPAAAAFgAAABwAAAAgAAAAHgAAABgAAAASAAAANAAAADIAAAAlAAAAIQAAAB4AAAAxAAAAMAAAABYAAAAQAAAAKQAAACIAAAATAAAAJgAAABUAAAA2AAAAJAAAADMAAAAjAAAALgAAAC0AAAA4AAAAEQAAABsAAAAZAAAAJAAAABQAAAAiAAAAEwAAADcAAAAoAAAANgAAACUAAAAnAAAANAAAADkAAAAYAAAAFwAAACAAAAAmAAAAfwAAACIAAAAzAAAAHQAAAC8AAAAVAAAAJwAAACUAAAAZAAAAFwAAADsAAAA5AAAALQAAACgAAAAbAAAAJAAAABQAAAA8AAAALgAAADcAAAApAAAAMQAAADUAAAA9AAAAFgAAACEAAAAfAAAAKgAAADoAAAArAAAAPgAAABwAAAAsAAAAGgAAACsAAAA+AAAALwAAAEAAAAAaAAAAKgAAAB0AAAAsAAAANQAAADoAAABBAAAAHAAAAB8AAAAqAAAALQAAACcAAAAjAAAAGQAAAD8AAAA7AAAAOAAAAC4AAAA8AAAAOAAAAEQAAAAbAAAAKAAAACMAAAAvAAAAJgAAACsAAAAdAAAARQAAADMAAABAAAAAMAAAADEAAAAeAAAAIQAAAEMAAABCAAAAMgAAADEAAAB/AAAAPQAAAEIAAAAhAAAAMAAAACkAAAAyAAAAMAAAACAAAAAeAAAARgAAAEMAAAA0AAAAMwAAAEUAAAA2AAAARwAAACYAAAAvAAAAIgAAADQAAAA5AAAARgAAAEoAAAAgAAAAJQAAADIAAAA1AAAAPQAAAEEAAABLAAAAHwAAACkAAAAsAAAANgAAAEcAAAA3AAAASQAAACIAAAAzAAAAJAAAADcAAAAoAAAANgAAACQAAABIAAAAPAAAAEkAAAA4AAAARAAAAD8AAABNAAAAIwAAAC4AAAAtAAAAOQAAADsAAABKAAAATgAAACUAAAAnAAAANAAAADoAAAB/AAAAPgAAAEwAAAAsAAAAQQAAACoAAAA7AAAAPwAAAE4AAABPAAAAJwAAAC0AAAA5AAAAPAAAAEgAAABEAAAAUAAAACgAAAA3AAAALgAAAD0AAAA1AAAAMQAAACkAAABRAAAASwAAAEIAAAA+AAAAKwAAADoAAAAqAAAAUgAAAEAAAABMAAAAPwAAAH8AAAA4AAAALQAAAE8AAAA7AAAATQAAAEAAAAAvAAAAPgAAACsAAABUAAAARQAAAFIAAABBAAAAOgAAADUAAAAsAAAAVgAAAEwAAABLAAAAQgAAAEMAAABRAAAAVQAAADEAAAAwAAAAPQAAAEMAAABCAAAAMgAAADAAAABXAAAAVQAAAEYAAABEAAAAOAAAADwAAAAuAAAAWgAAAE0AAABQAAAARQAAADMAAABAAAAALwAAAFkAAABHAAAAVAAAAEYAAABDAAAANAAAADIAAABTAAAAVwAAAEoAAABHAAAAWQAAAEkAAABbAAAAMwAAAEUAAAA2AAAASAAAAH8AAABJAAAANwAAAFAAAAA8AAAAWAAAAEkAAABbAAAASAAAAFgAAAA2AAAARwAAADcAAABKAAAATgAAAFMAAABcAAAANAAAADkAAABGAAAASwAAAEEAAAA9AAAANQAAAF4AAABWAAAAUQAAAEwAAABWAAAAUgAAAGAAAAA6AAAAQQAAAD4AAABNAAAAPwAAAEQAAAA4AAAAXQAAAE8AAABaAAAATgAAAEoAAAA7AAAAOQAAAF8AAABcAAAATwAAAE8AAABOAAAAPwAAADsAAABdAAAAXwAAAE0AAABQAAAARAAAAEgAAAA8AAAAYwAAAFoAAABYAAAAUQAAAFUAAABeAAAAZQAAAD0AAABCAAAASwAAAFIAAABgAAAAVAAAAGIAAAA+AAAATAAAAEAAAABTAAAAfwAAAEoAAABGAAAAZAAAAFcAAABcAAAAVAAAAEUAAABSAAAAQAAAAGEAAABZAAAAYgAAAFUAAABXAAAAZQAAAGYAAABCAAAAQwAAAFEAAABWAAAATAAAAEsAAABBAAAAaAAAAGAAAABeAAAAVwAAAFMAAABmAAAAZAAAAEMAAABGAAAAVQAAAFgAAABIAAAAWwAAAEkAAABjAAAAUAAAAGkAAABZAAAAYQAAAFsAAABnAAAARQAAAFQAAABHAAAAWgAAAE0AAABQAAAARAAAAGoAAABdAAAAYwAAAFsAAABJAAAAWQAAAEcAAABpAAAAWAAAAGcAAABcAAAAUwAAAE4AAABKAAAAbAAAAGQAAABfAAAAXQAAAE8AAABaAAAATQAAAG0AAABfAAAAagAAAF4AAABWAAAAUQAAAEsAAABrAAAAaAAAAGUAAABfAAAAXAAAAE8AAABOAAAAbQAAAGwAAABdAAAAYAAAAGgAAABiAAAAbgAAAEwAAABWAAAAUgAAAGEAAAB/AAAAYgAAAFQAAABnAAAAWQAAAG8AAABiAAAAbgAAAGEAAABvAAAAUgAAAGAAAABUAAAAYwAAAFAAAABpAAAAWAAAAGoAAABaAAAAcQAAAGQAAABmAAAAUwAAAFcAAABsAAAAcgAAAFwAAABlAAAAZgAAAGsAAABwAAAAUQAAAFUAAABeAAAAZgAAAGUAAABXAAAAVQAAAHIAAABwAAAAZAAAAGcAAABbAAAAYQAAAFkAAAB0AAAAaQAAAG8AAABoAAAAawAAAG4AAABzAAAAVgAAAF4AAABgAAAAaQAAAFgAAABnAAAAWwAAAHEAAABjAAAAdAAAAGoAAABdAAAAYwAAAFoAAAB1AAAAbQAAAHEAAABrAAAAfwAAAGUAAABeAAAAcwAAAGgAAABwAAAAbAAAAGQAAABfAAAAXAAAAHYAAAByAAAAbQAAAG0AAABsAAAAXQAAAF8AAAB1AAAAdgAAAGoAAABuAAAAYgAAAGgAAABgAAAAdwAAAG8AAABzAAAAbwAAAGEAAABuAAAAYgAAAHQAAABnAAAAdwAAAHAAAABrAAAAZgAAAGUAAAB4AAAAcwAAAHIAAABxAAAAYwAAAHQAAABpAAAAdQAAAGoAAAB5AAAAcgAAAHAAAABkAAAAZgAAAHYAAAB4AAAAbAAAAHMAAABuAAAAawAAAGgAAAB4AAAAdwAAAHAAAAB0AAAAZwAAAHcAAABvAAAAcQAAAGkAAAB5AAAAdQAAAH8AAABtAAAAdgAAAHEAAAB5AAAAagAAAHYAAAB4AAAAbAAAAHIAAAB1AAAAeQAAAG0AAAB3AAAAbwAAAHMAAABuAAAAeQAAAHQAAAB4AAAAeAAAAHMAAAByAAAAcAAAAHkAAAB3AAAAdgAAAHkAAAB0AAAAeAAAAHcAAAB1AAAAcQAAAHYAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAACAAAABQAAAAEAAAAAAAAA/////wEAAAAAAAAAAwAAAAQAAAACAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAFAAAAAQAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAAAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAABQAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAEAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAQAAAAMAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAFAAAABQAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAAAAAD/////AwAAAAAAAAAFAAAAAgAAAAAAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAADAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAAAAAABAAAAAwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAADAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAADAAAAAwAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAwAAAAAAAAAAAAAA/////wMAAAAAAAAABQAAAAIAAAAAAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAwAAAAAAAAADAAAAAwAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAMAAAADAAAAAwAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAAAAAAAAwAAAAUAAAABAAAAAAAAAP////8DAAAAAAAAAAUAAAACAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAABAAAAAUAAAABAAAAAAAAAAMAAAADAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAIAAAAFAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAADAAAAAQAAAAAAAAABAAAAAAAAAAUAAAAAAAAAAAAAAAUAAAAFAAAAAAAAAAAAAAD/////AQAAAAAAAAADAAAABAAAAAIAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAAAAAAAAAAAFAAAABQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAUAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAEAAAD//////////wEAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAAAAAAAAAAABAAAAAgAAAAYAAAAEAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAcAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAYAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAAAAAAAAAAAAQAAAAEAAAAFAAAABgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAACAAAAAAAAAAAAAAABAAAAAwAAAAcAAAAGAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAADgAAAAIAAAAAAAAAAAAAAAEAAAAAAAAACQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACgAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAMAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAIAAAAAAAAAAAAAAAEAAAAEAAAACAAAAAoAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAAAAAAAAAAAAQAAAAsAAAAPAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAIAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAABQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAgAAAAAAAAAAAAAAAQAAAAwAAAAQAAAADAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAoAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAPAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAADwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAADQAAAAEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAACAAAAAAAAAAAAAAABAAAACgAAABMAAAAIAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAQAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAQAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAACQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAAAAAAAAAAAAAEAAAANAAAAEQAAAA0AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAARAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAEAAAABAAAAAAAAAAAAAAAAAAAAEQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAA0AAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkAAAACAAAAAAAAAAAAAAABAAAADgAAABIAAAAPAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAADwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAASAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEwAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAABEAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAABIAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAATAAAAAgAAAAAAAAAAAAAAAQAAAP//////////EwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAATAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAEgAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAASAAAAAAAAABgAAAAAAAAAIQAAAAAAAAAeAAAAAAAAACAAAAADAAAAMQAAAAEAAAAwAAAAAwAAADIAAAADAAAACAAAAAAAAAAFAAAABQAAAAoAAAAFAAAAFgAAAAAAAAAQAAAAAAAAABIAAAAAAAAAKQAAAAEAAAAhAAAAAAAAAB4AAAAAAAAABAAAAAAAAAAAAAAABQAAAAIAAAAFAAAADwAAAAEAAAAIAAAAAAAAAAUAAAAFAAAAHwAAAAEAAAAWAAAAAAAAABAAAAAAAAAAAgAAAAAAAAAGAAAAAAAAAA4AAAAAAAAACgAAAAAAAAALAAAAAAAAABEAAAADAAAAGAAAAAEAAAAXAAAAAwAAABkAAAADAAAAAAAAAAAAAAABAAAABQAAAAkAAAAFAAAABQAAAAAAAAACAAAAAAAAAAYAAAAAAAAAEgAAAAEAAAAKAAAAAAAAAAsAAAAAAAAABAAAAAEAAAADAAAABQAAAAcAAAAFAAAACAAAAAEAAAAAAAAAAAAAAAEAAAAFAAAAEAAAAAEAAAAFAAAAAAAAAAIAAAAAAAAABwAAAAAAAAAVAAAAAAAAACYAAAAAAAAACQAAAAAAAAATAAAAAAAAACIAAAADAAAADgAAAAEAAAAUAAAAAwAAACQAAAADAAAAAwAAAAAAAAANAAAABQAAAB0AAAAFAAAAAQAAAAAAAAAHAAAAAAAAABUAAAAAAAAABgAAAAEAAAAJAAAAAAAAABMAAAAAAAAABAAAAAIAAAAMAAAABQAAABoAAAAFAAAAAAAAAAEAAAADAAAAAAAAAA0AAAAFAAAAAgAAAAEAAAABAAAAAAAAAAcAAAAAAAAAGgAAAAAAAAAqAAAAAAAAADoAAAAAAAAAHQAAAAAAAAArAAAAAAAAAD4AAAADAAAAJgAAAAEAAAAvAAAAAwAAAEAAAAADAAAADAAAAAAAAAAcAAAABQAAACwAAAAFAAAADQAAAAAAAAAaAAAAAAAAACoAAAAAAAAAFQAAAAEAAAAdAAAAAAAAACsAAAAAAAAABAAAAAMAAAAPAAAABQAAAB8AAAAFAAAAAwAAAAEAAAAMAAAAAAAAABwAAAAFAAAABwAAAAEAAAANAAAAAAAAABoAAAAAAAAAHwAAAAAAAAApAAAAAAAAADEAAAAAAAAALAAAAAAAAAA1AAAAAAAAAD0AAAADAAAAOgAAAAEAAABBAAAAAwAAAEsAAAADAAAADwAAAAAAAAAWAAAABQAAACEAAAAFAAAAHAAAAAAAAAAfAAAAAAAAACkAAAAAAAAAKgAAAAEAAAAsAAAAAAAAADUAAAAAAAAABAAAAAQAAAAIAAAABQAAABAAAAAFAAAADAAAAAEAAAAPAAAAAAAAABYAAAAFAAAAGgAAAAEAAAAcAAAAAAAAAB8AAAAAAAAAMgAAAAAAAAAwAAAAAAAAADEAAAADAAAAIAAAAAAAAAAeAAAAAwAAACEAAAADAAAAGAAAAAMAAAASAAAAAwAAABAAAAADAAAARgAAAAAAAABDAAAAAAAAAEIAAAADAAAANAAAAAMAAAAyAAAAAAAAADAAAAAAAAAAJQAAAAMAAAAgAAAAAAAAAB4AAAADAAAAUwAAAAAAAABXAAAAAwAAAFUAAAADAAAASgAAAAMAAABGAAAAAAAAAEMAAAAAAAAAOQAAAAEAAAA0AAAAAwAAADIAAAAAAAAAGQAAAAAAAAAXAAAAAAAAABgAAAADAAAAEQAAAAAAAAALAAAAAwAAAAoAAAADAAAADgAAAAMAAAAGAAAAAwAAAAIAAAADAAAALQAAAAAAAAAnAAAAAAAAACUAAAADAAAAIwAAAAMAAAAZAAAAAAAAABcAAAAAAAAAGwAAAAMAAAARAAAAAAAAAAsAAAADAAAAPwAAAAAAAAA7AAAAAwAAADkAAAADAAAAOAAAAAMAAAAtAAAAAAAAACcAAAAAAAAALgAAAAMAAAAjAAAAAwAAABkAAAAAAAAAJAAAAAAAAAAUAAAAAAAAAA4AAAADAAAAIgAAAAAAAAATAAAAAwAAAAkAAAADAAAAJgAAAAMAAAAVAAAAAwAAAAcAAAADAAAANwAAAAAAAAAoAAAAAAAAABsAAAADAAAANgAAAAMAAAAkAAAAAAAAABQAAAAAAAAAMwAAAAMAAAAiAAAAAAAAABMAAAADAAAASAAAAAAAAAA8AAAAAwAAAC4AAAADAAAASQAAAAMAAAA3AAAAAAAAACgAAAAAAAAARwAAAAMAAAA2AAAAAwAAACQAAAAAAAAAQAAAAAAAAAAvAAAAAAAAACYAAAADAAAAPgAAAAAAAAArAAAAAwAAAB0AAAADAAAAOgAAAAMAAAAqAAAAAwAAABoAAAADAAAAVAAAAAAAAABFAAAAAAAAADMAAAADAAAAUgAAAAMAAABAAAAAAAAAAC8AAAAAAAAATAAAAAMAAAA+AAAAAAAAACsAAAADAAAAYQAAAAAAAABZAAAAAwAAAEcAAAADAAAAYgAAAAMAAABUAAAAAAAAAEUAAAAAAAAAYAAAAAMAAABSAAAAAwAAAEAAAAAAAAAASwAAAAAAAABBAAAAAAAAADoAAAADAAAAPQAAAAAAAAA1AAAAAwAAACwAAAADAAAAMQAAAAMAAAApAAAAAwAAAB8AAAADAAAAXgAAAAAAAABWAAAAAAAAAEwAAAADAAAAUQAAAAMAAABLAAAAAAAAAEEAAAAAAAAAQgAAAAMAAAA9AAAAAAAAADUAAAADAAAAawAAAAAAAABoAAAAAwAAAGAAAAADAAAAZQAAAAMAAABeAAAAAAAAAFYAAAAAAAAAVQAAAAMAAABRAAAAAwAAAEsAAAAAAAAAOQAAAAAAAAA7AAAAAAAAAD8AAAADAAAASgAAAAAAAABOAAAAAwAAAE8AAAADAAAAUwAAAAMAAABcAAAAAwAAAF8AAAADAAAAJQAAAAAAAAAnAAAAAwAAAC0AAAADAAAANAAAAAAAAAA5AAAAAAAAADsAAAAAAAAARgAAAAMAAABKAAAAAAAAAE4AAAADAAAAGAAAAAAAAAAXAAAAAwAAABkAAAADAAAAIAAAAAMAAAAlAAAAAAAAACcAAAADAAAAMgAAAAMAAAA0AAAAAAAAADkAAAAAAAAALgAAAAAAAAA8AAAAAAAAAEgAAAADAAAAOAAAAAAAAABEAAAAAwAAAFAAAAADAAAAPwAAAAMAAABNAAAAAwAAAFoAAAADAAAAGwAAAAAAAAAoAAAAAwAAADcAAAADAAAAIwAAAAAAAAAuAAAAAAAAADwAAAAAAAAALQAAAAMAAAA4AAAAAAAAAEQAAAADAAAADgAAAAAAAAAUAAAAAwAAACQAAAADAAAAEQAAAAMAAAAbAAAAAAAAACgAAAADAAAAGQAAAAMAAAAjAAAAAAAAAC4AAAAAAAAARwAAAAAAAABZAAAAAAAAAGEAAAADAAAASQAAAAAAAABbAAAAAwAAAGcAAAADAAAASAAAAAMAAABYAAAAAwAAAGkAAAADAAAAMwAAAAAAAABFAAAAAwAAAFQAAAADAAAANgAAAAAAAABHAAAAAAAAAFkAAAAAAAAANwAAAAMAAABJAAAAAAAAAFsAAAADAAAAJgAAAAAAAAAvAAAAAwAAAEAAAAADAAAAIgAAAAMAAAAzAAAAAAAAAEUAAAADAAAAJAAAAAMAAAA2AAAAAAAAAEcAAAAAAAAAYAAAAAAAAABoAAAAAAAAAGsAAAADAAAAYgAAAAAAAABuAAAAAwAAAHMAAAADAAAAYQAAAAMAAABvAAAAAwAAAHcAAAADAAAATAAAAAAAAABWAAAAAwAAAF4AAAADAAAAUgAAAAAAAABgAAAAAAAAAGgAAAAAAAAAVAAAAAMAAABiAAAAAAAAAG4AAAADAAAAOgAAAAAAAABBAAAAAwAAAEsAAAADAAAAPgAAAAMAAABMAAAAAAAAAFYAAAADAAAAQAAAAAMAAABSAAAAAAAAAGAAAAAAAAAAVQAAAAAAAABXAAAAAAAAAFMAAAADAAAAZQAAAAAAAABmAAAAAwAAAGQAAAADAAAAawAAAAMAAABwAAAAAwAAAHIAAAADAAAAQgAAAAAAAABDAAAAAwAAAEYAAAADAAAAUQAAAAAAAABVAAAAAAAAAFcAAAAAAAAAXgAAAAMAAABlAAAAAAAAAGYAAAADAAAAMQAAAAAAAAAwAAAAAwAAADIAAAADAAAAPQAAAAMAAABCAAAAAAAAAEMAAAADAAAASwAAAAMAAABRAAAAAAAAAFUAAAAAAAAAXwAAAAAAAABcAAAAAAAAAFMAAAAAAAAATwAAAAAAAABOAAAAAAAAAEoAAAADAAAAPwAAAAEAAAA7AAAAAwAAADkAAAADAAAAbQAAAAAAAABsAAAAAAAAAGQAAAAFAAAAXQAAAAEAAABfAAAAAAAAAFwAAAAAAAAATQAAAAEAAABPAAAAAAAAAE4AAAAAAAAAdQAAAAQAAAB2AAAABQAAAHIAAAAFAAAAagAAAAEAAABtAAAAAAAAAGwAAAAAAAAAWgAAAAEAAABdAAAAAQAAAF8AAAAAAAAAWgAAAAAAAABNAAAAAAAAAD8AAAAAAAAAUAAAAAAAAABEAAAAAAAAADgAAAADAAAASAAAAAEAAAA8AAAAAwAAAC4AAAADAAAAagAAAAAAAABdAAAAAAAAAE8AAAAFAAAAYwAAAAEAAABaAAAAAAAAAE0AAAAAAAAAWAAAAAEAAABQAAAAAAAAAEQAAAAAAAAAdQAAAAMAAABtAAAABQAAAF8AAAAFAAAAcQAAAAEAAABqAAAAAAAAAF0AAAAAAAAAaQAAAAEAAABjAAAAAQAAAFoAAAAAAAAAaQAAAAAAAABYAAAAAAAAAEgAAAAAAAAAZwAAAAAAAABbAAAAAAAAAEkAAAADAAAAYQAAAAEAAABZAAAAAwAAAEcAAAADAAAAcQAAAAAAAABjAAAAAAAAAFAAAAAFAAAAdAAAAAEAAABpAAAAAAAAAFgAAAAAAAAAbwAAAAEAAABnAAAAAAAAAFsAAAAAAAAAdQAAAAIAAABqAAAABQAAAFoAAAAFAAAAeQAAAAEAAABxAAAAAAAAAGMAAAAAAAAAdwAAAAEAAAB0AAAAAQAAAGkAAAAAAAAAdwAAAAAAAABvAAAAAAAAAGEAAAAAAAAAcwAAAAAAAABuAAAAAAAAAGIAAAADAAAAawAAAAEAAABoAAAAAwAAAGAAAAADAAAAeQAAAAAAAAB0AAAAAAAAAGcAAAAFAAAAeAAAAAEAAAB3AAAAAAAAAG8AAAAAAAAAcAAAAAEAAABzAAAAAAAAAG4AAAAAAAAAdQAAAAEAAABxAAAABQAAAGkAAAAFAAAAdgAAAAEAAAB5AAAAAAAAAHQAAAAAAAAAcgAAAAEAAAB4AAAAAQAAAHcAAAAAAAAAcgAAAAAAAABwAAAAAAAAAGsAAAAAAAAAZAAAAAAAAABmAAAAAAAAAGUAAAADAAAAUwAAAAEAAABXAAAAAwAAAFUAAAADAAAAdgAAAAAAAAB4AAAAAAAAAHMAAAAFAAAAbAAAAAEAAAByAAAAAAAAAHAAAAAAAAAAXAAAAAEAAABkAAAAAAAAAGYAAAAAAAAAdQAAAAAAAAB5AAAABQAAAHcAAAAFAAAAbQAAAAEAAAB2AAAAAAAAAHgAAAAAAAAAXwAAAAEAAABsAAAAAQAAAHIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAGAAAAAgAAAAUAAAABAAAABAAAAAAAAAAAAAAABQAAAAMAAAABAAAABgAAAAQAAAACAAAAAAAAAH6iBfbytuk/Gq6akm/58z/Xrm0Liez0P5doSdOpSwRAWs602ULg8D/dT7Rcbo/1v1N1RQHFNOM/g9Snx7HW3L8HWsP8Q3jfP6VwOLosutk/9rjk1YQcxj+gnmKMsNn6P/HDeuPFY+M/YHwDjqKhB0Ci19/fCVrbP4UxKkDWOP6/pvljWa09tL9wi7wrQXjnv/Z6yLImkM2/3yTlOzY14D+m+WNZrT20PzwKVQnrQwNA9nrIsiaQzT/g40rFrRQFwPa45NWEHMa/kbslHEZq97/xw3rjxWPjv4cLC2SMBci/otff3wla27+rKF5oIAv0P1N1RQHFNOO/iDJPGyWHBUAHWsP8Q3jfvwQf/by16gXAfqIF9vK26b8XrO0Vh0r+v9eubQuJ7PS/BxLrA0ZZ479azrTZQuDwv1MK1EuItPw/yscgV9Z6FkAwHBR2WjQMQJNRzXsQ5vY/GlUHVJYKF0DONuFv2lMNQNCGZ28QJfk/0WUwoIL36D8ggDOMQuATQNqMOeAy/wZAWFYOYM+M2z/LWC4uH3oSQDE+LyTsMgRAkJzhRGWFGEDd4soovCQQQKqk0DJMEP8/rGmNdwOLBUAW2X/9xCbjP4hu3dcqJhNAzuYItRvdB0CgzW3zJW/sPxotm/Y2TxRAQAk9XmdDDEC1Kx9MKgT3P1M+NctcghZAFVqcLlb0C0Bgzd3sB2b2P77mZDPUWhZAFROHJpUGCEDAfma5CxXtPz1DWq/zYxRAmhYY5824F0DOuQKWSbAOQNCMqrvu3fs/L6DR22K2wT9nAAxPBU8RQGiN6mW43AFAZhu25b633D8c1YgmzowSQNM25BRKWARArGS08/lNxD+LFssHwmMRQLC5aNcxBgJABL9HT0WRF0CjCmJmOGEOQHsuaVzMP/s/TWJCaGGwBUCeu1PAPLzjP9nqN9DZOBNAKE4JcydbCkCGtbd1qjPzP8dgm9U8jhVAtPeKTkVwDkCeCLss5l37P401XMPLmBdAFd29VMVQDUBg0yA55h75Pz6odcYLCRdApBM4rBrkAkDyAVWgQxbRP4XDMnK20hFAymLlF7EmzD8GUgo9XBHlP3lbK7T9COc/k+OhPthhy7+YGEpnrOvCPzBFhLs15u4/epbqB6H4uz9IuuLF5svev6lzLKY31es/CaQ0envF5z8ZY0xlUADXv7zaz7HYEuI/CfbK1sn16T8uAQfWwxLWPzKn/YuFN94/5KdbC1AFu793fyCSnlfvPzK2y4doAMY/NRg5t1/X6b/shq4QJaHDP5yNIAKPOeI/vpn7BSE30r/X4YQrO6nrv78Ziv/Thto/DqJ1Y6+y5z9l51NaxFrlv8QlA65HOLS/86dxiEc96z+Hj0+LFjneP6LzBZ8LTc2/DaJ1Y6+y579l51NaxFrlP8QlA65HOLQ/8qdxiEc967+Jj0+LFjnev6LzBZ8LTc0/1qdbC1AFuz93fyCSnlfvvzK2y4doAMa/NRg5t1/X6T/vhq4QJaHDv5yNIAKPOeK/wJn7BSE30j/W4YQrO6nrP78Ziv/Thtq/CaQ0envF578XY0xlUADXP7zaz7HYEuK/CvbK1sn16b8rAQfWwxLWvzKn/YuFN96/zWLlF7EmzL8GUgo9XBHlv3lbK7T9COe/kOOhPthhyz+cGEpnrOvCvzBFhLs15u6/c5bqB6H4u79IuuLF5sveP6lzLKY31eu/AQAAAP////8HAAAA/////zEAAAD/////VwEAAP////9hCQAA/////6dBAAD/////kcsBAP/////3kAwA/////8H2VwAAAAAAAAAAAAAAAAACAAAA/////w4AAAD/////YgAAAP////+uAgAA/////8ISAAD/////ToMAAP////8ilwMA/////+4hGQD/////gu2vAAAAAAAAAAAAAAAAAAAAAAACAAAA//////////8BAAAAAwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////////////////////AQAAAAAAAAACAAAA////////////////AwAAAP//////////////////////////////////////////////////////////AgAAAP//////////AQAAAAAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD/////////////////////AQAAAP///////////////wIAAAD///////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAD///////////////8CAAAAAQAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8BAAAAAgAAAP///////////////wAAAAD/////////////////////AwAAAP///////////////////////////////wIAAAD///////////////8BAAAA/////////////////////wAAAAD/////////////////////AwAAAP////////////////////////////////////////////////////8DAAAA/////////////////////wAAAAABAAAA//////////8CAAAA//////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAA////////////////AgAAAAAAAAABAAAA//////////////////////////////////////////////////////////////////////////8DAAAAAQAAAP//////////AgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAACAAAAAAAAAAIAAAABAAAAAQAAAAIAAAACAAAAAAAAAAUAAAAFAAAAAAAAAAIAAAACAAAAAwAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAgAAAAEAAAACAAAAAgAAAAIAAAAAAAAABQAAAAYAAAAAAAAAAgAAAAIAAAADAAAAAgAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAgAAAAAAAAACAAAAAQAAAAMAAAACAAAAAgAAAAAAAAAFAAAABwAAAAAAAAACAAAAAgAAAAMAAAADAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAACAAAAAAAAAAIAAAABAAAABAAAAAIAAAACAAAAAAAAAAUAAAAIAAAAAAAAAAIAAAACAAAAAwAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAIAAAAAAAAAAgAAAAEAAAAAAAAAAgAAAAIAAAAAAAAABQAAAAkAAAAAAAAAAgAAAAIAAAADAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAKAAAAAgAAAAIAAAAAAAAAAwAAAA4AAAACAAAAAAAAAAIAAAADAAAAAAAAAAAAAAACAAAAAgAAAAMAAAAGAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAACAAAAAgAAAAAAAAADAAAACgAAAAIAAAAAAAAAAgAAAAMAAAABAAAAAAAAAAIAAAACAAAAAwAAAAcAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAIAAAACAAAAAAAAAAMAAAALAAAAAgAAAAAAAAACAAAAAwAAAAIAAAAAAAAAAgAAAAIAAAADAAAACAAAAAAAAAAAAAAAAAAAAAAAAAANAAAAAgAAAAIAAAAAAAAAAwAAAAwAAAACAAAAAAAAAAIAAAADAAAAAwAAAAAAAAACAAAAAgAAAAMAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAACAAAAAgAAAAAAAAADAAAADQAAAAIAAAAAAAAAAgAAAAMAAAAEAAAAAAAAAAIAAAACAAAAAwAAAAoAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAIAAAACAAAAAAAAAAMAAAAGAAAAAgAAAAAAAAACAAAAAwAAAA8AAAAAAAAAAgAAAAIAAAADAAAACwAAAAAAAAAAAAAAAAAAAAAAAAAGAAAAAgAAAAIAAAAAAAAAAwAAAAcAAAACAAAAAAAAAAIAAAADAAAAEAAAAAAAAAACAAAAAgAAAAMAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAcAAAACAAAAAgAAAAAAAAADAAAACAAAAAIAAAAAAAAAAgAAAAMAAAARAAAAAAAAAAIAAAACAAAAAwAAAA0AAAAAAAAAAAAAAAAAAAAAAAAACAAAAAIAAAACAAAAAAAAAAMAAAAJAAAAAgAAAAAAAAACAAAAAwAAABIAAAAAAAAAAgAAAAIAAAADAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAJAAAAAgAAAAIAAAAAAAAAAwAAAAUAAAACAAAAAAAAAAIAAAADAAAAEwAAAAAAAAACAAAAAgAAAAMAAAAPAAAAAAAAAAAAAAAAAAAAAAAAABAAAAACAAAAAAAAAAIAAAABAAAAEwAAAAIAAAACAAAAAAAAAAUAAAAKAAAAAAAAAAIAAAACAAAAAwAAABAAAAAAAAAAAAAAAAAAAAAAAAAAEQAAAAIAAAAAAAAAAgAAAAEAAAAPAAAAAgAAAAIAAAAAAAAABQAAAAsAAAAAAAAAAgAAAAIAAAADAAAAEQAAAAAAAAAAAAAAAAAAAAAAAAASAAAAAgAAAAAAAAACAAAAAQAAABAAAAACAAAAAgAAAAAAAAAFAAAADAAAAAAAAAACAAAAAgAAAAMAAAASAAAAAAAAAAAAAAAAAAAAAAAAABMAAAACAAAAAAAAAAIAAAABAAAAEQAAAAIAAAACAAAAAAAAAAUAAAANAAAAAAAAAAIAAAACAAAAAwAAABMAAAAAAAAAAAAAAAAAAAAAAAAADwAAAAIAAAAAAAAAAgAAAAEAAAASAAAAAgAAAAIAAAAAAAAABQAAAA4AAAAAAAAAAgAAAAIAAAADAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAAAAAAAAAAAAAIAAAABAAAAAAAAAAEAAAACAAAAAQAAAAAAAAACAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAAAAAACAAAAAQAAAAAAAAABAAAAAgAAAAAAAAAAAAAAAgAAAAEAAAAAAAAAAQAAAAIAAAABAAAAAAAAAAIAAAACAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAEAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAFAAAABAAAAAAAAAABAAAABQAAAAQAAAAAAAAABQAAAAUAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAEAAAAAAAAAAAEAAAAAAQAAAAAAAAAAAQAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAABAAAAAAAAAAAAAQAAAAAAAAAAAAA6B6FaUp9QQTPXMuL4myJBraiDfBwx9UBYJseitzTIQOL5if9jqZtAnXX+Z+ycb0C3pucbhRBCQG8wJBYqpRRAlWbDCzCY5z/eFWBUEve6P/+qo4Q50Y4/D9YM3iCcYT8fcA2QJSA0P4ADxu0qAAc/BNcGolVJ2j5d9FACqwquPh9z7MthtI9CSUSYJke/YUJQ/64OyjU0Qpi0+HCmFQdCm3GfIVdh2kHsJ11kAyauQYC3UDFJOoFBSJsFV1OwU0FK5fcxX4AmQWhy/zZIt/lACqaCPsBjzUDbdUNIScugQMYQlVJ4MXNANiuq8GTvRUDxTXnulxEZQFZ8QX5kpuw/qmG/JwYFlEAluh3Q6DB+QKn4vyNq0GZAKOXekas+UUB8xabXXhI6QG63C2pLtSNAdDBtyNfLDUDyOcu67ID2P0rCMvRXAeE/Ki2TSVyzyT9Dk+8Sz2uzP5J+w5ARWp0/NQAoOiMuhj9YnP+RyMJwPxgW7TvQVFk/KgsLYF0kQz9g5dAC6IwzQcgHPVvDex1B1XjppodHBkHJq3OMM9fwQNvcmJ7wddlAInGPpQs/w0BRobq5EBmtQJZ2ai7n+ZVAtv2G5E+bgECG+gIfKBlpQK5f8jdI91JAL39sL/WpPEB8rGxhDqklQK6yUf43XhBAxL9y/tK8+D86XyZpgrHiPwAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAP////8AAAAAAAAAAAAAAAABAAAAAAAAAAAAAAD/////AAAAAAAAAAABAAAAAQAAAAAAAAAAAAAA/////wAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAP////8FAAAABQAAAAAAAAAAAAAAAAAAAAAAAAD/////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA/////////////////////////////////////wAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP////////////////////////////////////8AAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAFAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/////////////////////////////////////AAAAAAEAAAABAAAAAQAAAAEAAAABAAAAAQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAQAAAAEAAAABAAAAAAAAAAEAAAAAAAAABQAAAAEAAAABAAAAAAAAAAAAAAABAAAAAQAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAQAAAAAAAQABAAABAQAAAAAAAQAAAAEAAAABAAEAAAAAAAAAAAAAAAAAAAAAquJYWJZl+D9jaeZNtj/zPwwdI9KqaeO/qGefXwdHdz+q4lhYlmX4P+OrlPMN3PI/DB0j0qpp47+7SQLV4VIEQKriWFiWZfg/r2kma3tz8T82eQmLqNIGwMRIWXMqSvo/fcCszPux9j+jara6ozTwP6hnn18HR3c/MSoKLequ8r+SabgA2nj0P7jBLbDOHO8/1Ym/ICfH4T+6lxjvlFXHv73m373LRPU/0vXyDVxo7T+ToKRHJXMAQF/33578aPE/pAyy64tD9T8+U/hCvyruPwxv8Y7YYwLAuXYr8NAiCEB4+LDK0Sn0P1Qeuy4j+eo/OMx50n7K7L+TrGB/nyf8v5ehC2fbYPM/aXMKexiT6z8mFRIMjg/zP7yUVwGGBNw/E6opHERf8z/z0wR2g9DqPw4pBpcOhvu/NbA29uWAA8DMaTExyXzyP02biiQ+Ruk/S8jz2/FKBEB1pzZnpbb9P7pQU4wLfPI//7ZcQXeG6D9CqEQvAYoIwDB2VB6sSgRAVyv8H5We8T+EHWF8XNPmPzB2wT8Nrrg/SEi+cX+w4L8of+GtdSDxP1sjk5AdouU/6ZjOVru13r8K0obqI6bxvwVbdNXyhfA/w5GG024n5z+rwmtMzP8BwLw9pSX49QXABe/2uQxP8D+b6wCzCvXkP7uGT87fK+Q/pz/JWw4coj+qoBf2J0nwP/yE3PUo0+I/vFJeHcaC+D96luSIqvntP/bf8sHUYu8/gZNN41mL4z9bhOqVOF4FwO6lmAh1hQhAbCVxbdhk7z+1C8NdDcfiPwG36x/0OQBAx0WJ76c2+D9nlSHXANfuP2HlfZ3gqOE/EwnVlVPg9r96+oHzEH//v5bXzdT1Auw/DM3GwLsA4D9p/8uoKcr+v+U9x5DQVAPAehjSdghb7D9sc1IetODgP8MVwwB1pu6/azPk6OGe978W8t/TUc3rP+0QMvYfP+A/RsG/QpSE8D+l3uwScxzgPwQaifgujuw/k1Vti1I43z8MAwLnSh0GQH5nYnwwZgJAiGUzWC5s6j8WyyI/BbLgPw4iUapGeQJAB3W+imnp/j9BLWR4ssrpP2t+gG5Pstk/cpBsfm6DCMCOpU9dOZsFQEv8nFypHeo/ehJ6i+6S2D9jqlGEmarLv7STC5TRiOa/bC+x8WZD6D9H3yUkWpDZP8gZvmCMuQLAreY19/eRBsCoPOc8UzzpP6KI/QV+y9g/t/MoboyWzT+Hv5q3Zu3Mvy2xROCT4uY/9gQitMMg1T9abAqhWMDkv1oLTavoUfG/PMUJP9CD5j+fHRX3t6fSPz7W2gk6bvs/WRnuHwqN9D8YFturGCTmP1EZczv0b9I/5t4exabB5D/1ESLh5fTEP9X2z6SYweQ/6lv3I2zT0D9zkRGNUNMAQKoSvc4EIfs/Xggt8wQI5T+mJHHg/w/SP4lhT/9t8vQ/DrZ/DbwH7D+XlhbYZrjkP34LIpFt6c4/lwfp8fLX9L+j96CTTf76v3WdNhEv9uM/d8c3o4lV0D/vFdCHVcsFwAHeDq0F1QhApbYqcZiN5D9KoilqByXLPwX0/diA0vq/0fo0GxnxAMBbaTkvlCzjP/RrFrWXrMs/UYTrky7jA0DB9f4FiZYAQEGAk/3QzeE/r/TeqE8t0D/OqjlsnPbvvz8RKU8JOfW/smSEbK/O4T8MzuyPm3DDP/rFtctq9gZAfb1EVEaSA0Dts5dVInnhP18SFMc79MM/7y34cw6LAMDFrRJsZO0DwC2KLvLSYuA/hx5wcUHewz+49SnK/4ruPyeS0PX9a+E/ZxaaLvvZ3z8WPu5T2QS8Pygo4RIvMqa/BJ0Kqsd0279cKW4ay8jdP3b05bmZ364/10/qtdxk2r+Bcz6CDMvpv54qOw+Amdw/qLV71pW7sT/YKc80nIPUP8OfIaBJ77G/LyTuD1un2z+diYu8efWzP1wU7ACkfwjAZroyPL1yBkAmv3lKJJbbPysKSE4W+p0/dIgqY79TA8ATLTOQ3tsGwJ2zweD/Xdg/XO/jXeFUaL8VW2qLFKfov1cA9Aa6XfK/tIa7YGgI2T+f3hu/sxqPv2nXdPpf3Pc/jkw8Jbda8j+tT/z8tGPVP1yBHpJd35k/KYvYOy1s8j/yz+kCQjPrP9+agH7x59g/PZfJ9aBhpr/rDKzvYBb+PwtkiaGCt/c/vb1mVr+f1T/JIHwHc8Govw7aeF6+9vG/Xv7kD6fp979isYioQYHVP7AIQZuSFrG/3z1AdUTnAUDN3XY9O7f9P0AdQ9ljYNQ/dJANJPTOrb8kLECUiiPlP4yF7UgmStA/9xGmXxCG1T9qZzix4W2zv2SGJRJVrPe/Fh9a2M/B/b8IexzFCoPSP9y1QFD2bLe/Q86cWLJe/b+mOOfYm78BwOTjkPAGE9E/8aPCUKu/ub9pPZyLCiUGwBA7Mev/BQlALOmrlRi+0j+AMJ/dKULBv7iLtL6a6QRAEMDV/yajAUDa62dE3crJP1P70RgBUbq/38hVnR6esT/s1tG10Z/Ov/zLwalHPss/dTS9NKTXx78nMcRzCIEHQAabxDsAmQRA0tyLK3gSyT+Aui7nOhDGv5Gs58z3WgHATN3forJuBMCAui7nOhDGP9Lciyt4Esm/WAJyHQ4c7z8UP5HFIs3iP3U0vTSk18c//MvBqUc+y7+cvv8HLg/Kvy1I/mHsI+K/U/vRGAFRuj/a62dE3crJv8p+WV8KlQjAuQ/nOP43B0CAMJ/dKULBPyzpq5UYvtK/ZoU+VoLh4L9etLlRUfvtv/GjwlCrv7k/5OOQ8AYT0b9DfT9FhufXPwUX8hJp+4u/3LVAUPZstz8IexzFCoPSv9+L609E5fQ/q9Fz7X2J7T9qZzix4W2zP/cRpl8QhtW/vtNilqGX+j8MOy7QJoL0P3SQDST0zq0/QB1D2WNg1L8IIjSvGNkDwGB8Jou2GAfAsAhBm5IWsT9isYioQYHVvyS9D3zb6uy/gnwRa7uM9L/JIHwHc8GoP729Zla/n9W/CsAHJZwmAEDEW6OYT1r6Pz2XyfWgYaY/35qAfvHn2L83Tdy4lS30vxf2/gZ0jPq/XIEekl3fmb+tT/z8tGPVvybPr2zJ1/+/K7mJ0ypVAsCf3hu/sxqPPwCGu2BoCNm/5oITrpZn+r+UDUyDP+n/v1zv413hVGg/nbPB4P9d2L9MlmkxNvgCQMtZlKE85v8/KwpIThb6nb8mv3lKJJbbv8+SZsTvOOc/pQCIIOYw0j+diYu8efWzvy8k7g9bp9u/kxYDa+pKtD9XlYvA8HnVv6i1e9aVu7G/nio7D4CZ3L/WR6rNh5EGwCkgQweBkghAdvTluZnfrr9cKW4ay8jdvxbjhr1f1QVAR5C0MzivAkAWPu5T2QS8v2cWmi772d+/cKj4lzLJCEBx2QJfYrMFQIcecHFB3sO/LYou8tJi4L+jr7lhO38BwIcI0Nb7xgTAXxIUxzv0w7/ts5dVInnhv0T+l8DZLfE/MP3FoFvS5D8MzuyPm3DDv7JkhGyvzuG/tzhzRIRc0b9Ovv3/0z7mv6/03qhPLdC/m4CT/dDN4b9dwjU5VCQBQBBJX1ntCv0/9GsWtZesy79baTkvlCzjv1mjYgEz++S/oW6KnOQW8b9KoilqByXLv6W2KnGYjeS/SmaKz3Vx9z+BZB5yxGHwP3fHN6OJVdC/dZ02ES/2478PuaBjLrXaP4/JU81pPaO/fgsikW3pzr+XlhbYZrjkv4tSn7YDbP0/f2LnFKlF9z+mJHHg/w/Sv14ILfMECOW/mfg4qYhR/b+OP+RQDCACwOpb9yNs09C/1fbPpJjB5L9pN2WOVZ3wv3hHy9nxIve/URlzO/Rv0r8YFturGCTmv1d1/KKR8QPA8gsy9qzSB8CfHRX3t6fSvzzFCT/Qg+a/EYStnrzV9r/2QJqI7Lb9v/YEIrTDINW/LbFE4JPi5r/7kQEs5fEDQHunnf4GeQBAooj9BX7L2L+oPOc8Uzzpv+ydYY2SSAfAL4HK6CRTB0BH3yUkWpDZv2wvsfFmQ+i/Ik0Yzruh6T8fM3LoGoDUP3oSeovukti/S/ycXKkd6r9rEv+7UWcHQCRIQe/GfwNAa36Abk+y2b9BLWR4ssrpv9KT87qa0bM/FTyktw823L8WyyI/BbLgv4hlM1gubOq/DizMp9Ki6r8b5ckdjVrzv5NVbYtSON+/BBqJ+C6O7L/dUBFqgyXYv00Wh18r7+q/7RAy9h8/4L8W8t/TUc3rv4RM5DKx3wDAfvWIj94aBcBsc1IetODgv3oY0nYIW+y/oGcTFF54AUDkJqS/FKX6PwzNxsC7AOC/ltfN1PUC7L+5Wrz/zHnzP6688w2rNOc/YeV9neCo4b9nlSHXANfuvw9RsxKjY/s/1V8GteXE8j+1C8NdDcfiv2wlcW3YZO+/IOywaA7Q8b9bFP+4Tg36v4GTTeNZi+O/9t/ywdRi77+tRc3yFR7eP2bkcHXJkLO//ITc9SjT4r+qoBf2J0nwv2YHKoswwfm/iQcLspCjAcCb6wCzCvXkvwXv9rkMT/C/YkuwYAMXBMApCNUai9kIwMORhtNuJ+e/BVt01fKF8L+ZqWEfvIjsP6h693QZYNk/WyOTkB2i5b8of+GtdSDxvwpaaulDSwVADMQAX+lOAECEHWF8XNPmv1cr/B+VnvG/XyFG6opcCMD/mtR32/UEQP+2XEF3hui/ulBTjAt88r/imfCfRP+yP9zbvtc8XeO/TZuKJD5G6b/MaTExyXzyvxiTQeElXOO/rbJRQVGN9L/z0wR2g9DqvxOqKRxEX/O/FDGCEei99j9x8zV4VYTmP2lzCnsYk+u/l6ELZ9tg878pRXacaDT/v3k6GZRqoQXAVB67LiP56r94+LDK0Sn0vwO6pZ9b7wFAvK0nKVcc9j8+U/hCvyruv6QMsuuLQ/W/FPhKFYv46j8MyxaDTOW/v9L18g1caO2/vebfvctE9b/7GD8ZrF3xv3gx1AR9bQDAuMEtsM4c77+SabgA2nj0v5xKFIwxsATArKNSBaKsB0Cjara6ozTwv33ArMz7sfa/dF2U0FcWCcDxL357DJX/P69pJmt7c/G/quJYWJZl+L/YntVJlnrSP4sRLzXM+fe/46uU8w3c8r+q4lhYlmX4v85lu5+QRwRAsI0H/WU8479jaeZNtj/zv6riWFiWZfi/sI0H/WU847/OZbufkEcEQHAoPUBrnss/9exKzDtFtT88wM8kax+gP9OqeKeAYog/MW0ItiZvcj+ph+smvt5bP2lCaV5dEUU/StaUmQDaLz+kK9y22BMYP0O3whZuMwI/IIbgZGWE6z7UkjYaEM3UPuezxwa9cr8+LybxRMnFpz6E1N8DbPiRPsYjySMvK3s+//////8fAAj//////zMQCP////9/MiAI/////28yMAj/////YzJACP///z9iMlAI////N2IyYAj///8zYjJwCP//vzNiMoAI//+rM2IykAj/f6szYjKgCP8PqzNiMrAI/wOrM2IywAi/A6szYjLQCJ8DqzNiMuAImQOrM2Iy8Aj//////z8PCP//////Kx8I/////38pLwj/////Pyk/CP////85KU8I////PzgpXwj///8POClvCP///w44KX8I//8fDjgpjwj//w8OOCmfCP9/DQ44Ka8I/w8NDjgpvwj/DQ0OOCnPCP8MDQ44Kd8IxwwNDjgp7wjEDA0OOCn/CAcAAAAHAAAAAQAAAAIAAAAEAAAAAwAAAAAAAAAAAAAABwAAAAMAAAABAAAAAgAAAAUAAAAEAAAAAAAAAAAAAAAEAAAABAAAAAAAAAACAAAAAQAAAAMAAAAOAAAABgAAAAsAAAACAAAABwAAAAEAAAAYAAAABQAAAAoAAAABAAAABgAAAAAAAAAmAAAABwAAAAwAAAADAAAACAAAAAIAAAAxAAAACQAAAA4AAAAAAAAABQAAAAQAAAA6AAAACAAAAA0AAAAEAAAACQAAAAMAAAA/AAAACwAAAAYAAAAPAAAACgAAABAAAABIAAAADAAAAAcAAAAQAAAACwAAABEAAABTAAAACgAAAAUAAAATAAAADgAAAA8AAABhAAAADQAAAAgAAAARAAAADAAAABIAAABrAAAADgAAAAkAAAASAAAADQAAABMAAAB1AAAADwAAABMAAAARAAAAEgAAABAAAAAGAAAAAgAAAAMAAAAFAAAABAAAAAAAAAAAAAAAAAAAAAYAAAACAAAAAwAAAAEAAAAFAAAABAAAAAAAAAAAAAAABwAAAAUAAAADAAAABAAAAAEAAAAAAAAAAgAAAAAAAAACAAAAAwAAAAEAAAAFAAAABAAAAAYAAAAAAAAAAAAAABgtRFT7Ifk/GC1EVPsh+b8YLURU+yEJQBgtRFT7IQnAYWxnb3MuYwBoM05laWdoYm9yUm90YXRpb25zAGNvb3JkaWprLmMAX3VwQXA3Q2hlY2tlZABfdXBBcDdyQ2hlY2tlZABkaXJlY3RlZEVkZ2UuYwBkaXJlY3RlZEVkZ2VUb0JvdW5kYXJ5AGFkamFjZW50RmFjZURpclt0bXBGaWprLmZhY2VdW2ZpamsuZmFjZV0gPT0gS0kAZmFjZWlqay5jAF9mYWNlSWprUGVudFRvQ2VsbEJvdW5kYXJ5AGFkamFjZW50RmFjZURpcltjZW50ZXJJSksuZmFjZV1bZmFjZTJdID09IEtJAF9mYWNlSWprVG9DZWxsQm91bmRhcnkAaDNJbmRleC5jAGNvbXBhY3RDZWxscwBsYXRMbmdUb0NlbGwAY2VsbFRvQ2hpbGRQb3MAdmFsaWRhdGVDaGlsZFBvcwBsYXRMbmcuYwBjZWxsQXJlYVJhZHMyAHBvbHlnb24tPm5leHQgPT0gTlVMTABsaW5rZWRHZW8uYwBhZGROZXdMaW5rZWRQb2x5Z29uAG5leHQgIT0gTlVMTABsb29wICE9IE5VTEwAYWRkTmV3TGlua2VkTG9vcABwb2x5Z29uLT5maXJzdCA9PSBOVUxMAGFkZExpbmtlZExvb3AAY29vcmQgIT0gTlVMTABhZGRMaW5rZWRDb29yZABsb29wLT5maXJzdCA9PSBOVUxMAGlubmVyTG9vcHMgIT0gTlVMTABub3JtYWxpemVNdWx0aVBvbHlnb24AYmJveGVzICE9IE5VTEwAY2FuZGlkYXRlcyAhPSBOVUxMAGZpbmRQb2x5Z29uRm9ySG9sZQBjYW5kaWRhdGVCQm94ZXMgIT0gTlVMTAByZXZEaXIgIT0gSU5WQUxJRF9ESUdJVABsb2NhbGlqLmMAY2VsbFRvTG9jYWxJamsAYmFzZUNlbGwgIT0gb3JpZ2luQmFzZUNlbGwAIShvcmlnaW5PblBlbnQgJiYgaW5kZXhPblBlbnQpAGJhc2VDZWxsID09IG9yaWdpbkJhc2VDZWxsAGJhc2VDZWxsICE9IElOVkFMSURfQkFTRV9DRUxMAGxvY2FsSWprVG9DZWxsACFfaXNCYXNlQ2VsbFBlbnRhZ29uKGJhc2VDZWxsKQBiYXNlQ2VsbFJvdGF0aW9ucyA+PSAwAGdyaWRQYXRoQ2VsbHMAcG9seWZpbGwuYwBpdGVyU3RlcFBvbHlnb25Db21wYWN0ADAAdmVydGV4LmMAY2VsbFRvVmVydGV4AGdyYXBoLT5idWNrZXRzICE9IE5VTEwAdmVydGV4R3JhcGguYwBpbml0VmVydGV4R3JhcGgAbm9kZSAhPSBOVUxMAGFkZFZlcnRleE5vZGU=";var MM=28624;function OM(he){return he}function Xy(he){var me=/\b__Z[\w\d_]+/g;return he.replace(me,function(Pe){var _e=Pe;return Pe===_e?Pe:_e+" ["+Pe+"]"})}function Qy(){var he=new Error;if(!he.stack){try{throw new Error(0)}catch(me){he=me}if(!he.stack)return"(no stack trace available)"}return he.stack.toString()}function NM(){var he=Qy();return e.extraStackTrace&&(he+=`
`+e.extraStackTrace()),Xy(he)}function DM(he,me,Pe,_e){mo("Assertion failed: "+Y(he)+", at: "+[me?Y(me):"unknown filename",Pe,_e?Y(_e):"unknown function"])}function Yy(){return q.length}function BM(he,me,Pe){Z.set(Z.subarray(me,me+Pe),he)}function LM(he){return e.___errno_location&&(G[e.___errno_location()>>2]=he),he}function FM(he){mo("OOM")}function qy(he){try{var me=new ArrayBuffer(he);return me.byteLength!=he?void 0:(new Int8Array(me).set(q),jM(me),K(me),1)}catch{}}function UM(he){var me=Yy(),Pe=16777216,_e=2147483648-Pe;if(he>_e)return!1;for(var c=16777216,N=Math.max(me,c);N<he;)N<=536870912?N=U(2*N,Pe):N=Math.min(U((3*N+2147483648)/4,Pe),_e);var ct=qy(N);return!!ct}var zM=typeof atob=="function"?atob:function(he){var me="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Pe="",_e,c,N,ct,yt,cn,tt,At=0;he=he.replace(/[^A-Za-z0-9\+\/\=]/g,"");do ct=me.indexOf(he.charAt(At++)),yt=me.indexOf(he.charAt(At++)),cn=me.indexOf(he.charAt(At++)),tt=me.indexOf(he.charAt(At++)),_e=ct<<2|yt>>4,c=(yt&15)<<4|cn>>2,N=(cn&3)<<6|tt,Pe=Pe+String.fromCharCode(_e),cn!==64&&(Pe=Pe+String.fromCharCode(c)),tt!==64&&(Pe=Pe+String.fromCharCode(N));while(At<he.length);return Pe};function VM(he){try{for(var me=zM(he),Pe=new Uint8Array(me.length),_e=0;_e<me.length;++_e)Pe[_e]=me.charCodeAt(_e);return Pe}catch{throw new Error("Converting base64 string to bytes failed.")}}function Bd(he){if(Hy(he))return VM(he.slice(Nd.length))}var $M={Math,Int8Array,Int32Array,Uint8Array,Float32Array,Float64Array},WM={a:mo,b:p,c:_,d:DM,e:LM,f:Yy,g:BM,h:UM,i:FM,j:OM,k:Xy,l:qy,m:Qy,n:NM,o:MM,p:be},ve=function(he,me,Pe){"almost asm";var _e=new he.Int8Array(Pe),c=new he.Int32Array(Pe);new he.Uint8Array(Pe),new he.Float32Array(Pe);var N=new he.Float64Array(Pe),ct=me.o|0,yt=me.p|0,cn=he.Math.floor,tt=he.Math.abs,At=he.Math.sqrt,fs=he.Math.pow,ht=he.Math.cos,nt=he.Math.sin,xr=he.Math.tan,Eu=he.Math.acos,QM=he.Math.asin,Ud=he.Math.atan,Tr=he.Math.atan2,ya=he.Math.ceil,ui=he.Math.imul,zd=he.Math.min,YM=he.Math.max,Bi=he.Math.clz32,qe=me.b,z=me.c,je=me.d,ev=me.e,qM=me.f,ZM=me.g,KM=me.h,GM=me.i,B=28640;function JM(l){return _e=new Int8Array(l),c=new Int32Array(l),N=new Float64Array(l),Pe=l,!0}function e6(l){l=l|0;var A=0;return A=B,B=B+l|0,B=B+15&-16,A|0}function t6(){return B|0}function n6(l){l=l|0,B=l}function r6(l,A){l=l|0,B=l}function i6(l,A){l=l|0,A=A|0;var f=0,d=0,g=0;return(l|0)<0?(A=2,A|0):(l|0)>13780509?(A=ku(15,A)|0,A|0):(f=((l|0)<0)<<31>>31,g=un(l|0,f|0,3,0)|0,d=z()|0,f=Fe(l|0,f|0,1,0)|0,f=un(g|0,d|0,f|0,z()|0)|0,f=Fe(f|0,z()|0,1,0)|0,l=z()|0,c[A>>2]=f,c[A+4>>2]=l,A=0,A|0)}function tv(l,A,f,d){return l=l|0,A=A|0,f=f|0,d=d|0,nv(l,A,f,d,0)|0}function nv(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0;if(x=B,B=B+16|0,y=x,!(rv(l,A,f,d,g)|0))return d=0,B=x,d|0;do if((f|0)>=0){if((f|0)>13780509){if(m=ku(15,y)|0,m|0)break;w=y,y=c[w>>2]|0,w=c[w+4>>2]|0}else m=((f|0)<0)<<31>>31,T=un(f|0,m|0,3,0)|0,w=z()|0,m=Fe(f|0,m|0,1,0)|0,m=un(T|0,w|0,m|0,z()|0)|0,m=Fe(m|0,z()|0,1,0)|0,w=z()|0,c[y>>2]=m,c[y+4>>2]=w,y=m;if(ms(d|0,0,y<<3|0)|0,g|0){ms(g|0,0,y<<2|0)|0,m=fi(l,A,f,d,g,y,w,0)|0;break}m=Gn(y,4)|0,m?(T=fi(l,A,f,d,m,y,w,0)|0,Ue(m),m=T):m=13}else m=2;while(0);return T=m,B=x,T|0}function rv(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0;if(J=B,B=B+16|0,H=J,X=J+8|0,j=H,c[j>>2]=l,c[j+4>>2]=A,(f|0)<0)return X=2,B=J,X|0;if(m=d,c[m>>2]=l,c[m+4>>2]=A,m=(g|0)!=0,m&&(c[g>>2]=0),Et(l,A)|0)return X=9,B=J,X|0;c[X>>2]=0;e:do if((f|0)>=1)if(m)for(C=1,T=0,F=0,j=1,m=l;;){if(!(T|F)){if(m=An(m,A,4,X,H)|0,m|0)break e;if(A=H,m=c[A>>2]|0,A=c[A+4>>2]|0,Et(m,A)|0){m=9;break e}}if(m=An(m,A,c[26800+(F<<2)>>2]|0,X,H)|0,m|0)break e;if(A=H,m=c[A>>2]|0,A=c[A+4>>2]|0,l=d+(C<<3)|0,c[l>>2]=m,c[l+4>>2]=A,c[g+(C<<2)>>2]=j,l=T+1|0,y=(l|0)==(j|0),w=F+1|0,x=(w|0)==6,Et(m,A)|0){m=9;break e}if(j=j+(x&y&1)|0,(j|0)>(f|0)){m=0;break}else C=C+1|0,T=y?0:l,F=y?x?0:w:F}else for(C=1,T=0,F=0,j=1,m=l;;){if(!(T|F)){if(m=An(m,A,4,X,H)|0,m|0)break e;if(A=H,m=c[A>>2]|0,A=c[A+4>>2]|0,Et(m,A)|0){m=9;break e}}if(m=An(m,A,c[26800+(F<<2)>>2]|0,X,H)|0,m|0)break e;if(A=H,m=c[A>>2]|0,A=c[A+4>>2]|0,l=d+(C<<3)|0,c[l>>2]=m,c[l+4>>2]=A,l=T+1|0,y=(l|0)==(j|0),w=F+1|0,x=(w|0)==6,Et(m,A)|0){m=9;break e}if(j=j+(x&y&1)|0,(j|0)>(f|0)){m=0;break}else C=C+1|0,T=y?0:l,F=y?x?0:w:F}else m=0;while(0);return X=m,B=J,X|0}function fi(l,A,f,d,g,m,y,w){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0,m=m|0,y=y|0,w=w|0;var x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0;if(J=B,B=B+16|0,H=J+8|0,X=J,x=Ea(l|0,A|0,m|0,y|0)|0,C=z()|0,F=d+(x<<3)|0,ne=F,pe=c[ne>>2]|0,ne=c[ne+4>>2]|0,T=(pe|0)==(l|0)&(ne|0)==(A|0),!((pe|0)==0&(ne|0)==0|T))do x=Fe(x|0,C|0,1,0)|0,x=Ta(x|0,z()|0,m|0,y|0)|0,C=z()|0,F=d+(x<<3)|0,pe=F,ne=c[pe>>2]|0,pe=c[pe+4>>2]|0,T=(ne|0)==(l|0)&(pe|0)==(A|0);while(!((ne|0)==0&(pe|0)==0|T));if(x=g+(x<<2)|0,T&&(c[x>>2]|0)<=(w|0)||(pe=F,c[pe>>2]=l,c[pe+4>>2]=A,c[x>>2]=w,(w|0)>=(f|0)))return pe=0,B=J,pe|0;switch(T=w+1|0,c[H>>2]=0,x=An(l,A,2,H,X)|0,x|0){case 9:{j=9;break}case 0:{x=X,x=fi(c[x>>2]|0,c[x+4>>2]|0,f,d,g,m,y,T)|0,x||(j=9);break}}e:do if((j|0)==9){switch(c[H>>2]=0,x=An(l,A,3,H,X)|0,x|0){case 9:break;case 0:{if(x=X,x=fi(c[x>>2]|0,c[x+4>>2]|0,f,d,g,m,y,T)|0,x|0)break e;break}default:break e}switch(c[H>>2]=0,x=An(l,A,1,H,X)|0,x|0){case 9:break;case 0:{if(x=X,x=fi(c[x>>2]|0,c[x+4>>2]|0,f,d,g,m,y,T)|0,x|0)break e;break}default:break e}switch(c[H>>2]=0,x=An(l,A,5,H,X)|0,x|0){case 9:break;case 0:{if(x=X,x=fi(c[x>>2]|0,c[x+4>>2]|0,f,d,g,m,y,T)|0,x|0)break e;break}default:break e}switch(c[H>>2]=0,x=An(l,A,4,H,X)|0,x|0){case 9:break;case 0:{if(x=X,x=fi(c[x>>2]|0,c[x+4>>2]|0,f,d,g,m,y,T)|0,x|0)break e;break}default:break e}switch(c[H>>2]=0,x=An(l,A,6,H,X)|0,x|0){case 9:break;case 0:{if(x=X,x=fi(c[x>>2]|0,c[x+4>>2]|0,f,d,g,m,y,T)|0,x|0)break e;break}default:break e}return pe=0,B=J,pe|0}while(0);return pe=x,B=J,pe|0}function An(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0;if(f>>>0>6)return g=1,g|0;if(F=(c[d>>2]|0)%6|0,c[d>>2]=F,(F|0)>0){m=0;do f=vo(f)|0,m=m+1|0;while((m|0)<(c[d>>2]|0))}if(F=ye(l|0,A|0,45)|0,z()|0,C=F&127,C>>>0>121)return g=5,g|0;x=Kn(l,A)|0,m=ye(l|0,A|0,52)|0,z()|0,m=m&15;e:do if(!m)T=8;else{for(;;){if(y=(15-m|0)*3|0,w=ye(l|0,A|0,y|0)|0,z()|0,w=w&7,(w|0)==7){A=5;break}if(X=(Er(m)|0)==0,m=m+-1|0,j=Te(7,0,y|0)|0,A=A&~(z()|0),H=Te(c[(X?432:16)+(w*28|0)+(f<<2)>>2]|0,0,y|0)|0,y=z()|0,f=c[(X?640:224)+(w*28|0)+(f<<2)>>2]|0,l=H|l&~j,A=y|A,!f){f=0;break e}if(!m){T=8;break e}}return A|0}while(0);(T|0)==8&&(X=c[848+(C*28|0)+(f<<2)>>2]|0,H=Te(X|0,0,45)|0,l=H|l,A=z()|0|A&-1040385,f=c[4272+(C*28|0)+(f<<2)>>2]|0,(X&127|0)==127&&(X=Te(c[848+(C*28|0)+20>>2]|0,0,45)|0,A=z()|0|A&-1040385,f=c[4272+(C*28|0)+20>>2]|0,l=wo(X|l,A)|0,A=z()|0,c[d>>2]=(c[d>>2]|0)+1)),w=ye(l|0,A|0,45)|0,z()|0,w=w&127;e:do if(It(w)|0){t:do if((Kn(l,A)|0)==1){if((C|0)!=(w|0))if(av(w,c[7696+(C*28|0)>>2]|0)|0){l=tp(l,A)|0,y=1,A=z()|0;break}else je(27795,26864,533,26872);switch(x|0){case 3:{l=wo(l,A)|0,A=z()|0,c[d>>2]=(c[d>>2]|0)+1,y=0;break t}case 5:{l=tp(l,A)|0,A=z()|0,c[d>>2]=(c[d>>2]|0)+5,y=0;break t}case 0:return X=9,X|0;default:return X=1,X|0}}else y=0;while(0);if((f|0)>0){m=0;do l=ep(l,A)|0,A=z()|0,m=m+1|0;while((m|0)!=(f|0))}if((C|0)!=(w|0)){if(!($d(w)|0)){if((y|0)!=0|(Kn(l,A)|0)!=5)break;c[d>>2]=(c[d>>2]|0)+1;break}switch(F&127){case 8:case 118:break e}(Kn(l,A)|0)!=3&&(c[d>>2]=(c[d>>2]|0)+1)}}else if((f|0)>0){m=0;do l=wo(l,A)|0,A=z()|0,m=m+1|0;while((m|0)!=(f|0))}while(0);return c[d>>2]=((c[d>>2]|0)+f|0)%6|0,X=g,c[X>>2]=l,c[X+4>>2]=A,X=0,X|0}function s6(l,A,f,d){return l=l|0,A=A|0,f=f|0,d=d|0,iv(l,A,f,d)|0?(ms(d|0,0,f*48|0)|0,d=o6(l,A,f,d)|0,d|0):(d=0,d|0)}function iv(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0;if(X=B,B=B+16|0,j=X,H=X+8|0,F=j,c[F>>2]=l,c[F+4>>2]=A,(f|0)<0)return H=2,B=X,H|0;if(!f)return H=d,c[H>>2]=l,c[H+4>>2]=A,H=0,B=X,H|0;c[H>>2]=0;e:do if(Et(l,A)|0)l=9;else{g=0,F=l;do{if(l=An(F,A,4,H,j)|0,l|0)break e;if(A=j,F=c[A>>2]|0,A=c[A+4>>2]|0,g=g+1|0,Et(F,A)|0){l=9;break e}}while((g|0)<(f|0));C=d,c[C>>2]=F,c[C+4>>2]=A,C=f+-1|0,T=0,l=1;do{if(g=26800+(T<<2)|0,(T|0)==5)for(y=c[g>>2]|0,m=0,g=l;;){if(l=j,l=An(c[l>>2]|0,c[l+4>>2]|0,y,H,j)|0,l|0)break e;if((m|0)!=(C|0))if(x=j,w=c[x>>2]|0,x=c[x+4>>2]|0,l=d+(g<<3)|0,c[l>>2]=w,c[l+4>>2]=x,!(Et(w,x)|0))l=g+1|0;else{l=9;break e}else l=g;if(m=m+1|0,(m|0)>=(f|0))break;g=l}else for(y=j,x=c[g>>2]|0,w=0,g=l,m=c[y>>2]|0,y=c[y+4>>2]|0;;){if(l=An(m,y,x,H,j)|0,l|0)break e;if(y=j,m=c[y>>2]|0,y=c[y+4>>2]|0,l=d+(g<<3)|0,c[l>>2]=m,c[l+4>>2]=y,l=g+1|0,Et(m,y)|0){l=9;break e}if(w=w+1|0,(w|0)>=(f|0))break;g=l}T=T+1|0}while(T>>>0<6);l=j,l=(F|0)==(c[l>>2]|0)&&(A|0)==(c[l+4>>2]|0)?0:9}while(0);return H=l,B=X,H|0}function o6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0;if(F=B,B=B+16|0,y=F,!f)return c[d>>2]=l,c[d+4>>2]=A,d=0,B=F,d|0;do if((f|0)>=0){if((f|0)>13780509){if(g=ku(15,y)|0,g|0)break;m=y,g=c[m>>2]|0,m=c[m+4>>2]|0}else g=((f|0)<0)<<31>>31,C=un(f|0,g|0,3,0)|0,m=z()|0,g=Fe(f|0,g|0,1,0)|0,g=un(C|0,m|0,g|0,z()|0)|0,g=Fe(g|0,z()|0,1,0)|0,m=z()|0,C=y,c[C>>2]=g,c[C+4>>2]=m;if(T=Gn(g,8)|0,!T)g=13;else{if(C=Gn(g,4)|0,!C){Ue(T),g=13;break}if(g=fi(l,A,f,T,C,g,m,0)|0,g|0){Ue(T),Ue(C);break}if(A=c[y>>2]|0,y=c[y+4>>2]|0,(y|0)>0|(y|0)==0&A>>>0>0){g=0,w=0,x=0;do l=T+(w<<3)|0,m=c[l>>2]|0,l=c[l+4>>2]|0,!((m|0)==0&(l|0)==0)&&(c[C+(w<<2)>>2]|0)==(f|0)&&(j=d+(g<<3)|0,c[j>>2]=m,c[j+4>>2]=l,g=g+1|0),w=Fe(w|0,x|0,1,0)|0,x=z()|0;while((x|0)<(y|0)|(x|0)==(y|0)&w>>>0<A>>>0)}Ue(T),Ue(C),g=0}}else g=2;while(0);return j=g,B=F,j|0}function Vd(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0;for(w=B,B=B+16|0,m=w,y=w+8|0,g=(Et(l,A)|0)==0,g=g?1:2;;){if(c[y>>2]=0,T=(An(l,A,g,y,m)|0)==0,x=m,T&((c[x>>2]|0)==(f|0)?(c[x+4>>2]|0)==(d|0):0)){l=4;break}if(g=g+1|0,g>>>0>=7){g=7,l=4;break}}return(l|0)==4?(B=w,g|0):0}function a6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0;if(w=B,B=B+48|0,g=w+16|0,m=w+8|0,y=w,f=cc(f)|0,f|0)return y=f,B=w,y|0;if(T=l,x=c[T+4>>2]|0,f=m,c[f>>2]=c[T>>2],c[f+4>>2]=x,Mv(m,g),f=uv(g,A,y)|0,!f){if(A=c[m>>2]|0,m=c[l+8>>2]|0,(m|0)>0){g=c[l+12>>2]|0,f=0;do A=(c[g+(f<<3)>>2]|0)+A|0,f=f+1|0;while((f|0)<(m|0))}f=y,g=c[f>>2]|0,f=c[f+4>>2]|0,m=((A|0)<0)<<31>>31,(f|0)<(m|0)|(f|0)==(m|0)&g>>>0<A>>>0?(f=y,c[f>>2]=A,c[f+4>>2]=m,f=m):A=g,x=Fe(A|0,f|0,12,0)|0,T=z()|0,f=y,c[f>>2]=x,c[f+4>>2]=T,f=d,c[f>>2]=x,c[f+4>>2]=T,f=0}return T=f,B=w,T|0}function sv(l,A,f,d,g,m,y){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0,m=m|0,y=y|0;var w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0,Ze=0,rt=0,$e=0,Le=0,we=0,Ge=0,bt=0,Ke=0,xt=0,zn=0,Xv=0;if(bt=B,B=B+64|0,$e=bt+48|0,Le=bt+32|0,we=bt+24|0,xe=bt+8|0,Be=bt,x=c[l>>2]|0,(x|0)<=0)return Ge=0,B=bt,Ge|0;for(Ie=l+4|0,Ye=$e+8|0,Ze=Le+8|0,rt=xe+8|0,w=0,ae=0;;){T=c[Ie>>2]|0,Ae=T+(ae<<4)|0,c[$e>>2]=c[Ae>>2],c[$e+4>>2]=c[Ae+4>>2],c[$e+8>>2]=c[Ae+8>>2],c[$e+12>>2]=c[Ae+12>>2],(ae|0)==(x+-1|0)?(c[Le>>2]=c[T>>2],c[Le+4>>2]=c[T+4>>2],c[Le+8>>2]=c[T+8>>2],c[Le+12>>2]=c[T+12>>2]):(Ae=T+(ae+1<<4)|0,c[Le>>2]=c[Ae>>2],c[Le+4>>2]=c[Ae+4>>2],c[Le+8>>2]=c[Ae+8>>2],c[Le+12>>2]=c[Ae+12>>2]),x=y6($e,Le,d,we)|0;e:do if(x)T=0,w=x;else if(x=we,T=c[x>>2]|0,x=c[x+4>>2]|0,(x|0)>0|(x|0)==0&T>>>0>0){pe=0,Ae=0;t:for(;;){if(xt=1/(+(T>>>0)+4294967296*+(x|0)),Xv=+N[$e>>3],x=_n(T|0,x|0,pe|0,Ae|0)|0,zn=+(x>>>0)+4294967296*+(z()|0),Ke=+(pe>>>0)+4294967296*+(Ae|0),N[xe>>3]=xt*(Xv*zn)+xt*(+N[Le>>3]*Ke),N[rt>>3]=xt*(+N[Ye>>3]*zn)+xt*(+N[Ze>>3]*Ke),x=np(xe,d,Be)|0,x|0){w=x;break}ne=Be,J=c[ne>>2]|0,ne=c[ne+4>>2]|0,j=Ea(J|0,ne|0,A|0,f|0)|0,C=z()|0,x=y+(j<<3)|0,F=x,T=c[F>>2]|0,F=c[F+4>>2]|0;n:do if((T|0)==0&(F|0)==0)te=x,Ge=16;else for(H=0,X=0;;){if((H|0)>(f|0)|(H|0)==(f|0)&X>>>0>A>>>0){w=1;break t}if((T|0)==(J|0)&(F|0)==(ne|0))break n;if(x=Fe(j|0,C|0,1,0)|0,j=Ta(x|0,z()|0,A|0,f|0)|0,C=z()|0,X=Fe(X|0,H|0,1,0)|0,H=z()|0,x=y+(j<<3)|0,F=x,T=c[F>>2]|0,F=c[F+4>>2]|0,(T|0)==0&(F|0)==0){te=x,Ge=16;break}}while(0);if((Ge|0)==16&&(Ge=0,!((J|0)==0&(ne|0)==0))&&(X=te,c[X>>2]=J,c[X+4>>2]=ne,X=m+(c[g>>2]<<3)|0,c[X>>2]=J,c[X+4>>2]=ne,X=g,X=Fe(c[X>>2]|0,c[X+4>>2]|0,1,0)|0,J=z()|0,ne=g,c[ne>>2]=X,c[ne+4>>2]=J),pe=Fe(pe|0,Ae|0,1,0)|0,Ae=z()|0,x=we,T=c[x>>2]|0,x=c[x+4>>2]|0,!((x|0)>(Ae|0)|(x|0)==(Ae|0)&T>>>0>pe>>>0)){T=1;break e}}T=0}else T=1;while(0);if(ae=ae+1|0,!T){Ge=21;break}if(x=c[l>>2]|0,(ae|0)>=(x|0)){w=0,Ge=21;break}}return(Ge|0)==21?(B=bt,w|0):0}function l6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0,Ze=0,rt=0,$e=0,Le=0,we=0,Ge=0,bt=0,Ke=0,xt=0,zn=0;if(zn=B,B=B+112|0,Ge=zn+80|0,x=zn+72|0,bt=zn,Ke=zn+56|0,g=cc(f)|0,g|0)return xt=g,B=zn,xt|0;if(T=l+8|0,xt=hi((c[T>>2]<<5)+32|0)|0,!xt)return xt=13,B=zn,xt|0;if(cp(l,xt),g=cc(f)|0,!g){if(Le=l,we=c[Le+4>>2]|0,g=x,c[g>>2]=c[Le>>2],c[g+4>>2]=we,Mv(x,Ge),g=uv(Ge,A,bt)|0,g)Le=0,we=0;else{if(g=c[x>>2]|0,m=c[T>>2]|0,(m|0)>0){y=c[l+12>>2]|0,f=0;do g=(c[y+(f<<3)>>2]|0)+g|0,f=f+1|0;while((f|0)!=(m|0));f=g}else f=g;g=bt,m=c[g>>2]|0,g=c[g+4>>2]|0,y=((f|0)<0)<<31>>31,(g|0)<(y|0)|(g|0)==(y|0)&m>>>0<f>>>0?(g=bt,c[g>>2]=f,c[g+4>>2]=y,g=y):f=m,Le=Fe(f|0,g|0,12,0)|0,we=z()|0,g=bt,c[g>>2]=Le,c[g+4>>2]=we,g=0}if(!g){if(f=Gn(Le,8)|0,!f)return Ue(xt),xt=13,B=zn,xt|0;if(w=Gn(Le,8)|0,!w)return Ue(xt),Ue(f),xt=13,B=zn,xt|0;rt=Ge,c[rt>>2]=0,c[rt+4>>2]=0,rt=l,$e=c[rt+4>>2]|0,g=x,c[g>>2]=c[rt>>2],c[g+4>>2]=$e,g=sv(x,Le,we,A,Ge,f,w)|0;e:do if(g)Ue(f),Ue(w),Ue(xt);else{t:do if((c[T>>2]|0)>0){for(y=l+12|0,m=0;g=sv((c[y>>2]|0)+(m<<3)|0,Le,we,A,Ge,f,w)|0,m=m+1|0,!(g|0);)if((m|0)>=(c[T>>2]|0))break t;Ue(f),Ue(w),Ue(xt);break e}while(0);(we|0)>0|(we|0)==0&Le>>>0>0&&ms(w|0,0,Le<<3|0)|0,$e=Ge,rt=c[$e+4>>2]|0;t:do if((rt|0)>0|(rt|0)==0&(c[$e>>2]|0)>>>0>0){Ie=f,Ye=w,Ze=f,rt=w,$e=f,g=f,te=f,xe=w,Be=w,f=w;n:for(;;){for(ne=0,pe=0,Ae=0,ae=0,m=0,y=0;;){w=bt,x=w+56|0;do c[w>>2]=0,w=w+4|0;while((w|0)<(x|0));if(A=Ie+(ne<<3)|0,T=c[A>>2]|0,A=c[A+4>>2]|0,rv(T,A,1,bt,0)|0){w=bt,x=w+56|0;do c[w>>2]=0,w=w+4|0;while((w|0)<(x|0));w=Gn(7,4)|0,w|0&&(fi(T,A,1,bt,w,7,0,0)|0,Ue(w))}for(J=0;;){X=bt+(J<<3)|0,H=c[X>>2]|0,X=c[X+4>>2]|0;r:do if((H|0)==0&(X|0)==0)w=m,x=y;else{if(C=Ea(H|0,X|0,Le|0,we|0)|0,T=z()|0,w=d+(C<<3)|0,A=w,x=c[A>>2]|0,A=c[A+4>>2]|0,!((x|0)==0&(A|0)==0)){F=0,j=0;do{if((F|0)>(we|0)|(F|0)==(we|0)&j>>>0>Le>>>0)break n;if((x|0)==(H|0)&(A|0)==(X|0)){w=m,x=y;break r}w=Fe(C|0,T|0,1,0)|0,C=Ta(w|0,z()|0,Le|0,we|0)|0,T=z()|0,j=Fe(j|0,F|0,1,0)|0,F=z()|0,w=d+(C<<3)|0,A=w,x=c[A>>2]|0,A=c[A+4>>2]|0}while(!((x|0)==0&(A|0)==0))}if((H|0)==0&(X|0)==0){w=m,x=y;break}bo(H,X,Ke)|0,Ap(l,xt,Ke)|0&&(j=Fe(m|0,y|0,1,0)|0,y=z()|0,F=w,c[F>>2]=H,c[F+4>>2]=X,m=Ye+(m<<3)|0,c[m>>2]=H,c[m+4>>2]=X,m=j),w=m,x=y}while(0);if(J=J+1|0,J>>>0>=7)break;m=w,y=x}if(ne=Fe(ne|0,pe|0,1,0)|0,pe=z()|0,Ae=Fe(Ae|0,ae|0,1,0)|0,ae=z()|0,y=Ge,m=c[y>>2]|0,y=c[y+4>>2]|0,(ae|0)<(y|0)|(ae|0)==(y|0)&Ae>>>0<m>>>0)m=w,y=x;else break}if((y|0)>0|(y|0)==0&m>>>0>0){m=0,y=0;do ae=Ie+(m<<3)|0,c[ae>>2]=0,c[ae+4>>2]=0,m=Fe(m|0,y|0,1,0)|0,y=z()|0,ae=Ge,Ae=c[ae+4>>2]|0;while((y|0)<(Ae|0)|((y|0)==(Ae|0)?m>>>0<(c[ae>>2]|0)>>>0:0))}if(ae=Ge,c[ae>>2]=w,c[ae+4>>2]=x,(x|0)>0|(x|0)==0&w>>>0>0)J=f,ne=Be,pe=$e,Ae=xe,ae=Ye,f=te,Be=g,xe=Ze,te=J,g=ne,$e=rt,rt=pe,Ze=Ae,Ye=Ie,Ie=ae;else break t}Ue(Ze),Ue(rt),Ue(xt),g=1;break e}else g=w;while(0);Ue(xt),Ue(f),Ue(g),g=0}while(0);return xt=g,B=zn,xt|0}}return Ue(xt),xt=g,B=zn,xt|0}function c6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(C=B,B=B+176|0,x=C,(A|0)<1)return Lv(f,0,0),T=0,B=C,T|0;for(w=l,w=ye(c[w>>2]|0,c[w+4>>2]|0,52)|0,z()|0,Lv(f,(A|0)>6?A:6,w&15),w=0;d=l+(w<<3)|0,d=ba(c[d>>2]|0,c[d+4>>2]|0,x)|0,!(d|0);){if(d=c[x>>2]|0,(d|0)>0){y=0;do m=x+8+(y<<4)|0,y=y+1|0,d=x+8+(((y|0)%(d|0)|0)<<4)|0,g=L8(f,d,m)|0,g?zv(f,g)|0:B8(f,m,d)|0,d=c[x>>2]|0;while((y|0)<(d|0))}if(w=w+1|0,(w|0)>=(A|0)){d=0,T=13;break}}return(T|0)==13?(B=C,d|0):(Fv(f),T=d,B=C,T|0)}function A6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0;if(m=B,B=B+32|0,d=m,g=m+16|0,l=c6(l,A,g)|0,l|0)return f=l,B=m,f|0;if(c[f>>2]=0,c[f+4>>2]=0,c[f+8>>2]=0,l=Uv(g)|0,l|0)do{A=u8(f)|0;do f8(A,l)|0,y=l+16|0,c[d>>2]=c[y>>2],c[d+4>>2]=c[y+4>>2],c[d+8>>2]=c[y+8>>2],c[d+12>>2]=c[y+12>>2],zv(g,l)|0,l=F8(g,d)|0;while(l|0);l=Uv(g)|0}while(l|0);return Fv(g),l=h8(f)|0,l?(Pv(f),y=l,B=m,y|0):(y=0,B=m,y|0)}function It(l){return l=l|0,l>>>0>121?(l=0,l|0):(l=c[7696+(l*28|0)+16>>2]|0,l|0)}function $d(l){return l=l|0,(l|0)==4|(l|0)==117|0}function ov(l){return l=l|0,c[11120+((c[l>>2]|0)*216|0)+((c[l+4>>2]|0)*72|0)+((c[l+8>>2]|0)*24|0)+(c[l+12>>2]<<3)>>2]|0}function u6(l){return l=l|0,c[11120+((c[l>>2]|0)*216|0)+((c[l+4>>2]|0)*72|0)+((c[l+8>>2]|0)*24|0)+(c[l+12>>2]<<3)+4>>2]|0}function f6(l,A){l=l|0,A=A|0,l=7696+(l*28|0)|0,c[A>>2]=c[l>>2],c[A+4>>2]=c[l+4>>2],c[A+8>>2]=c[l+8>>2],c[A+12>>2]=c[l+12>>2]}function h6(l,A){l=l|0,A=A|0;var f=0,d=0;if(A>>>0>20)return A=-1,A|0;do if((c[11120+(A*216|0)>>2]|0)!=(l|0))if((c[11120+(A*216|0)+8>>2]|0)!=(l|0))if((c[11120+(A*216|0)+16>>2]|0)!=(l|0))if((c[11120+(A*216|0)+24>>2]|0)!=(l|0))if((c[11120+(A*216|0)+32>>2]|0)!=(l|0))if((c[11120+(A*216|0)+40>>2]|0)!=(l|0))if((c[11120+(A*216|0)+48>>2]|0)!=(l|0))if((c[11120+(A*216|0)+56>>2]|0)!=(l|0))if((c[11120+(A*216|0)+64>>2]|0)!=(l|0))if((c[11120+(A*216|0)+72>>2]|0)!=(l|0))if((c[11120+(A*216|0)+80>>2]|0)!=(l|0))if((c[11120+(A*216|0)+88>>2]|0)!=(l|0))if((c[11120+(A*216|0)+96>>2]|0)!=(l|0))if((c[11120+(A*216|0)+104>>2]|0)!=(l|0))if((c[11120+(A*216|0)+112>>2]|0)!=(l|0))if((c[11120+(A*216|0)+120>>2]|0)!=(l|0))if((c[11120+(A*216|0)+128>>2]|0)!=(l|0))if((c[11120+(A*216|0)+136>>2]|0)==(l|0))l=2,f=1,d=2;else{if((c[11120+(A*216|0)+144>>2]|0)==(l|0)){l=0,f=2,d=0;break}if((c[11120+(A*216|0)+152>>2]|0)==(l|0)){l=0,f=2,d=1;break}if((c[11120+(A*216|0)+160>>2]|0)==(l|0)){l=0,f=2,d=2;break}if((c[11120+(A*216|0)+168>>2]|0)==(l|0)){l=1,f=2,d=0;break}if((c[11120+(A*216|0)+176>>2]|0)==(l|0)){l=1,f=2,d=1;break}if((c[11120+(A*216|0)+184>>2]|0)==(l|0)){l=1,f=2,d=2;break}if((c[11120+(A*216|0)+192>>2]|0)==(l|0)){l=2,f=2,d=0;break}if((c[11120+(A*216|0)+200>>2]|0)==(l|0)){l=2,f=2,d=1;break}if((c[11120+(A*216|0)+208>>2]|0)==(l|0)){l=2,f=2,d=2;break}else l=-1;return l|0}else l=2,f=1,d=1;else l=2,f=1,d=0;else l=1,f=1,d=2;else l=1,f=1,d=1;else l=1,f=1,d=0;else l=0,f=1,d=2;else l=0,f=1,d=1;else l=0,f=1,d=0;else l=2,f=0,d=2;else l=2,f=0,d=1;else l=2,f=0,d=0;else l=1,f=0,d=2;else l=1,f=0,d=1;else l=1,f=0,d=0;else l=0,f=0,d=2;else l=0,f=0,d=1;else l=0,f=0,d=0;while(0);return A=c[11120+(A*216|0)+(f*72|0)+(l*24|0)+(d<<3)+4>>2]|0,A|0}function av(l,A){return l=l|0,A=A|0,(c[7696+(l*28|0)+20>>2]|0)==(A|0)?(A=1,A|0):(A=(c[7696+(l*28|0)+24>>2]|0)==(A|0),A|0)}function Wd(l,A){return l=l|0,A=A|0,c[848+(l*28|0)+(A<<2)>>2]|0}function jd(l,A){return l=l|0,A=A|0,(c[848+(l*28|0)>>2]|0)==(A|0)?(A=0,A|0):(c[848+(l*28|0)+4>>2]|0)==(A|0)?(A=1,A|0):(c[848+(l*28|0)+8>>2]|0)==(A|0)?(A=2,A|0):(c[848+(l*28|0)+12>>2]|0)==(A|0)?(A=3,A|0):(c[848+(l*28|0)+16>>2]|0)==(A|0)?(A=4,A|0):(c[848+(l*28|0)+20>>2]|0)==(A|0)?(A=5,A|0):((c[848+(l*28|0)+24>>2]|0)==(A|0)?6:7)|0}function d6(){return 122}function p6(l){l=l|0;var A=0,f=0,d=0;A=0;do Te(A|0,0,45)|0,d=z()|0|134225919,f=l+(A<<3)|0,c[f>>2]=-1,c[f+4>>2]=d,A=A+1|0;while((A|0)!=122);return 0}function g6(l){l=l|0;var A=0,f=0,d=0;return d=+N[l+16>>3],f=+N[l+24>>3],A=d-f,+(d<f?A+6.283185307179586:A)}function lv(l){return l=l|0,+N[l+16>>3]<+N[l+24>>3]|0}function m6(l){return l=l|0,+(+N[l>>3]-+N[l+8>>3])}function Hd(l,A){l=l|0,A=A|0;var f=0,d=0,g=0;return f=+N[A>>3],!(f>=+N[l+8>>3])||!(f<=+N[l>>3])?(A=0,A|0):(d=+N[l+16>>3],f=+N[l+24>>3],g=+N[A+8>>3],A=g>=f,l=g<=d&1,d<f?A&&(l=1):A||(l=0),A=(l|0)!=0,A|0)}function Xd(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;return+N[l>>3]<+N[A+8>>3]||+N[l+8>>3]>+N[A>>3]?(d=0,d|0):(m=+N[l+16>>3],f=l+24|0,C=+N[f>>3],y=m<C,d=A+16|0,T=+N[d>>3],g=A+24|0,x=+N[g>>3],w=T<x,A=C-T<x-m,l=y?w|A?1:2:0,A=w?y?1:A?2:1:0,m=+cr(m,l),m<+cr(+N[g>>3],A)||(C=+cr(+N[f>>3],l),C>+cr(+N[d>>3],A))?(w=0,w|0):(w=1,w|0))}function _6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0;m=+N[l+16>>3],x=+N[l+24>>3],l=m<x,w=+N[A+16>>3],y=+N[A+24>>3],g=w<y,A=x-w<y-m,c[f>>2]=l?g|A?1:2:0,c[d>>2]=g?l?1:A?2:1:0}function cv(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;return+N[l>>3]<+N[A>>3]||+N[l+8>>3]>+N[A+8>>3]?(d=0,d|0):(d=l+16|0,x=+N[d>>3],m=+N[l+24>>3],y=x<m,f=A+16|0,C=+N[f>>3],g=A+24|0,T=+N[g>>3],w=C<T,A=m-C<T-x,l=y?w|A?1:2:0,A=w?y?1:A?2:1:0,m=+cr(m,l),m<=+cr(+N[g>>3],A)?(C=+cr(+N[d>>3],l),w=C>=+cr(+N[f>>3],A),w|0):(w=0,w|0))}function Av(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0;g=B,B=B+176|0,d=g,c[d>>2]=4,w=+N[A>>3],N[d+8>>3]=w,m=+N[A+16>>3],N[d+16>>3]=m,N[d+24>>3]=w,w=+N[A+24>>3],N[d+32>>3]=w,y=+N[A+8>>3],N[d+40>>3]=y,N[d+48>>3]=w,N[d+56>>3]=y,N[d+64>>3]=m,A=d+72|0,f=A+96|0;do c[A>>2]=0,A=A+4|0;while((A|0)<(f|0));Sa(l|0,d|0,168)|0,B=g}function uv(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0;X=B,B=B+288|0,C=X+264|0,F=X+96|0,T=X,w=T,x=w+96|0;do c[w>>2]=0,w=w+4|0;while((w|0)<(x|0));return A=ip(A,T)|0,A|0?(H=A,B=X,H|0):(x=T,T=c[x>>2]|0,x=c[x+4>>2]|0,bo(T,x,C)|0,ba(T,x,F)|0,y=+ac(C,F+8|0),N[C>>3]=+N[l>>3],x=C+8|0,N[x>>3]=+N[l+16>>3],N[F>>3]=+N[l+8>>3],T=F+8|0,N[T>>3]=+N[l+24>>3],g=+ac(C,F),ne=+N[x>>3]-+N[T>>3],m=+tt(+ne),J=+N[C>>3]-+N[F>>3],d=+tt(+J),!(ne==0|J==0)&&(ne=+jv(+m,+d),ne=+ya(+(g*g/+Ou(+(ne/+Ou(+m,+d)),3)/(y*(y*2.59807621135)*.8))),N[ct>>3]=ne,j=~~ne>>>0,H=+tt(ne)>=1?ne>0?~~+zd(+cn(ne/4294967296),4294967295)>>>0:~~+ya((ne-+(~~ne>>>0))/4294967296)>>>0:0,(c[ct+4>>2]&2146435072|0)!=2146435072)?(F=(j|0)==0&(H|0)==0,A=f,c[A>>2]=F?1:j,c[A+4>>2]=F?0:H,A=0):A=1,H=A,B=X,H|0)}function y6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0;T=B,B=B+288|0,y=T+264|0,w=T+96|0,x=T,g=x,m=g+96|0;do c[g>>2]=0,g=g+4|0;while((g|0)<(m|0));return f=ip(f,x)|0,f|0?(d=f,B=T,d|0):(f=x,g=c[f>>2]|0,f=c[f+4>>2]|0,bo(g,f,y)|0,ba(g,f,w)|0,C=+ac(y,w+8|0),C=+ya(+(+ac(l,A)/(C*2))),N[ct>>3]=C,f=~~C>>>0,g=+tt(C)>=1?C>0?~~+zd(+cn(C/4294967296),4294967295)>>>0:~~+ya((C-+(~~C>>>0))/4294967296)>>>0:0,(c[ct+4>>2]&2146435072|0)==2146435072?(d=1,B=T,d|0):(x=(f|0)==0&(g|0)==0,c[d>>2]=x?1:f,c[d+4>>2]=x?0:g,d=0,B=T,d|0))}function v6(l,A){l=l|0,A=+A;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;m=l+16|0,y=+N[m>>3],f=l+24|0,g=+N[f>>3],d=y-g,d=y<g?d+6.283185307179586:d,T=+N[l>>3],w=l+8|0,x=+N[w>>3],C=T-x,d=(d*A-d)*.5,A=(C*A-C)*.5,T=T+A,N[l>>3]=T>1.5707963267948966?1.5707963267948966:T,A=x-A,N[w>>3]=A<-1.5707963267948966?-1.5707963267948966:A,A=y+d,A=A>3.141592653589793?A+-6.283185307179586:A,N[m>>3]=A<-3.141592653589793?A+6.283185307179586:A,A=g-d,A=A>3.141592653589793?A+-6.283185307179586:A,N[f>>3]=A<-3.141592653589793?A+6.283185307179586:A}function w6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0,c[l>>2]=A,c[l+4>>2]=f,c[l+8>>2]=d}function b6(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0;F=A+8|0,c[F>>2]=0,x=+N[l>>3],y=+tt(+x),T=+N[l+8>>3],w=+tt(+T)*1.1547005383792515,y=y+w*.5,f=~~y,l=~~w,y=y-+(f|0),w=w-+(l|0);do if(y<.5)if(y<.3333333333333333)if(c[A>>2]=f,w<(y+1)*.5){c[A+4>>2]=l;break}else{l=l+1|0,c[A+4>>2]=l;break}else if(j=1-y,l=(!(w<j)&1)+l|0,c[A+4>>2]=l,j<=w&w<y*2){f=f+1|0,c[A>>2]=f;break}else{c[A>>2]=f;break}else{if(!(y<.6666666666666666))if(f=f+1|0,c[A>>2]=f,w<y*.5){c[A+4>>2]=l;break}else{l=l+1|0,c[A+4>>2]=l;break}if(w<1-y){if(c[A+4>>2]=l,y*2+-1<w){c[A>>2]=f;break}}else l=l+1|0,c[A+4>>2]=l;f=f+1|0,c[A>>2]=f}while(0);do if(x<0)if(l&1){C=(l+1|0)/2|0,C=_n(f|0,((f|0)<0)<<31>>31|0,C|0,((C|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-((+(C>>>0)+4294967296*+(z()|0))*2+1)),c[A>>2]=f;break}else{C=(l|0)/2|0,C=_n(f|0,((f|0)<0)<<31>>31|0,C|0,((C|0)<0)<<31>>31|0)|0,f=~~(+(f|0)-(+(C>>>0)+4294967296*+(z()|0))*2),c[A>>2]=f;break}while(0);C=A+4|0,T<0&&(f=f-((l<<1|1|0)/2|0)|0,c[A>>2]=f,l=0-l|0,c[C>>2]=l),d=l-f|0,(f|0)<0?(g=0-f|0,c[C>>2]=d,c[F>>2]=g,c[A>>2]=0,l=d,f=0):g=0,(l|0)<0&&(f=f-l|0,c[A>>2]=f,g=g-l|0,c[F>>2]=g,c[C>>2]=0,l=0),m=f-g|0,d=l-g|0,(g|0)<0&&(c[A>>2]=m,c[C>>2]=d,c[F>>2]=0,l=d,f=m,g=0),d=(l|0)<(f|0)?l:f,d=(g|0)<(d|0)?g:d,!((d|0)<=0)&&(c[A>>2]=f-d,c[C>>2]=l-d,c[F>>2]=g-d)}function Pn(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0;A=c[l>>2]|0,y=l+4|0,f=c[y>>2]|0,(A|0)<0&&(f=f-A|0,c[y>>2]=f,m=l+8|0,c[m>>2]=(c[m>>2]|0)-A,c[l>>2]=0,A=0),(f|0)<0?(A=A-f|0,c[l>>2]=A,m=l+8|0,g=(c[m>>2]|0)-f|0,c[m>>2]=g,c[y>>2]=0,f=0):(g=l+8|0,m=g,g=c[g>>2]|0),(g|0)<0&&(A=A-g|0,c[l>>2]=A,f=f-g|0,c[y>>2]=f,c[m>>2]=0,g=0),d=(f|0)<(A|0)?f:A,d=(g|0)<(d|0)?g:d,!((d|0)<=0)&&(c[l>>2]=A-d,c[y>>2]=f-d,c[m>>2]=g-d)}function _o(l,A){l=l|0,A=A|0;var f=0,d=0;d=c[l+8>>2]|0,f=+((c[l+4>>2]|0)-d|0),N[A>>3]=+((c[l>>2]|0)-d|0)-f*.5,N[A+8>>3]=f*.8660254037844386}function Un(l,A,f){l=l|0,A=A|0,f=f|0,c[f>>2]=(c[A>>2]|0)+(c[l>>2]|0),c[f+4>>2]=(c[A+4>>2]|0)+(c[l+4>>2]|0),c[f+8>>2]=(c[A+8>>2]|0)+(c[l+8>>2]|0)}function Qd(l,A,f){l=l|0,A=A|0,f=f|0,c[f>>2]=(c[l>>2]|0)-(c[A>>2]|0),c[f+4>>2]=(c[l+4>>2]|0)-(c[A+4>>2]|0),c[f+8>>2]=(c[l+8>>2]|0)-(c[A+8>>2]|0)}function fv(l,A){l=l|0,A=A|0;var f=0,d=0;f=ui(c[l>>2]|0,A)|0,c[l>>2]=f,f=l+4|0,d=ui(c[f>>2]|0,A)|0,c[f>>2]=d,l=l+8|0,A=ui(c[l>>2]|0,A)|0,c[l>>2]=A}function Su(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;y=c[l>>2]|0,w=(y|0)<0,d=(c[l+4>>2]|0)-(w?y:0)|0,m=(d|0)<0,g=(m?0-d|0:0)+((c[l+8>>2]|0)-(w?y:0))|0,f=(g|0)<0,l=f?0:g,A=(m?0:d)-(f?g:0)|0,g=(w?0:y)-(m?d:0)-(f?g:0)|0,f=(A|0)<(g|0)?A:g,f=(l|0)<(f|0)?l:f,d=(f|0)>0,l=l-(d?f:0)|0,A=A-(d?f:0)|0;e:do switch(g-(d?f:0)|0){case 0:switch(A|0){case 0:return w=l|0?(l|0)==1?1:7:0,w|0;case 1:return w=l|0?(l|0)==1?3:7:2,w|0;default:break e}case 1:switch(A|0){case 0:return w=l|0?(l|0)==1?5:7:4,w|0;case 1:{if(!l)l=6;else break e;return l|0}default:break e}}while(0);return w=7,w|0}function x6(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0;if(x=l+8|0,y=c[x>>2]|0,w=(c[l>>2]|0)-y|0,T=l+4|0,y=(c[T>>2]|0)-y|0,w>>>0>715827881|y>>>0>715827881){if(d=(w|0)>0,g=2147483647-w|0,m=-2147483648-w|0,(d?(g|0)<(w|0):(m|0)>(w|0))||(f=w<<1,d?(2147483647-f|0)<(w|0):(-2147483648-f|0)>(w|0))||((y|0)>0?(2147483647-y|0)<(y|0):(-2147483648-y|0)>(y|0))||(A=w*3|0,f=y<<1,(d?(g|0)<(f|0):(m|0)>(f|0))||((w|0)>-1?(A|-2147483648|0)>=(y|0):(A^-2147483648|0)<(y|0))))return T=1,T|0}else f=y<<1,A=w*3|0;return d=ps(+(A-y|0)*.14285714285714285)|0,c[l>>2]=d,g=ps(+(f+w|0)*.14285714285714285)|0,c[T>>2]=g,c[x>>2]=0,f=(g|0)<(d|0),A=f?d:g,f=f?g:d,(f|0)<0&&(((f|0)==-2147483648||((A|0)>0?(2147483647-A|0)<(f|0):(-2147483648-A|0)>(f|0)))&&je(27795,26892,354,26903),((A|0)>-1?(A|-2147483648|0)>=(f|0):(A^-2147483648|0)<(f|0))&&je(27795,26892,354,26903)),A=g-d|0,(d|0)<0?(f=0-d|0,c[T>>2]=A,c[x>>2]=f,c[l>>2]=0,d=0):(A=g,f=0),(A|0)<0&&(d=d-A|0,c[l>>2]=d,f=f-A|0,c[x>>2]=f,c[T>>2]=0,A=0),m=d-f|0,g=A-f|0,(f|0)<0?(c[l>>2]=m,c[T>>2]=g,c[x>>2]=0,A=g,g=m,f=0):g=d,d=(A|0)<(g|0)?A:g,d=(f|0)<(d|0)?f:d,(d|0)<=0?(T=0,T|0):(c[l>>2]=g-d,c[T>>2]=A-d,c[x>>2]=f-d,T=0,T|0)}function T6(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0,x=0;if(y=l+8|0,g=c[y>>2]|0,m=(c[l>>2]|0)-g|0,w=l+4|0,g=(c[w>>2]|0)-g|0,m>>>0>715827881|g>>>0>715827881){if(f=(m|0)>0,(f?(2147483647-m|0)<(m|0):(-2147483648-m|0)>(m|0))||(A=m<<1,d=(g|0)>0,d?(2147483647-g|0)<(g|0):(-2147483648-g|0)>(g|0)))return w=1,w|0;if(x=g<<1,(d?(2147483647-x|0)<(g|0):(-2147483648-x|0)>(g|0))||(f?(2147483647-A|0)<(g|0):(-2147483648-A|0)>(g|0))||(f=g*3|0,(g|0)>-1?(f|-2147483648|0)>=(m|0):(f^-2147483648|0)<(m|0)))return x=1,x|0}else f=g*3|0,A=m<<1;return d=ps(+(A+g|0)*.14285714285714285)|0,c[l>>2]=d,g=ps(+(f-m|0)*.14285714285714285)|0,c[w>>2]=g,c[y>>2]=0,f=(g|0)<(d|0),A=f?d:g,f=f?g:d,(f|0)<0&&(((f|0)==-2147483648||((A|0)>0?(2147483647-A|0)<(f|0):(-2147483648-A|0)>(f|0)))&&je(27795,26892,402,26917),((A|0)>-1?(A|-2147483648|0)>=(f|0):(A^-2147483648|0)<(f|0))&&je(27795,26892,402,26917)),A=g-d|0,(d|0)<0?(f=0-d|0,c[w>>2]=A,c[y>>2]=f,c[l>>2]=0,d=0):(A=g,f=0),(A|0)<0&&(d=d-A|0,c[l>>2]=d,f=f-A|0,c[y>>2]=f,c[w>>2]=0,A=0),m=d-f|0,g=A-f|0,(f|0)<0?(c[l>>2]=m,c[w>>2]=g,c[y>>2]=0,A=g,g=m,f=0):g=d,d=(A|0)<(g|0)?A:g,d=(f|0)<(d|0)?f:d,(d|0)<=0?(x=0,x|0):(c[l>>2]=g-d,c[w>>2]=A-d,c[y>>2]=f-d,x=0,x|0)}function E6(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;y=l+8|0,f=c[y>>2]|0,A=(c[l>>2]|0)-f|0,w=l+4|0,f=(c[w>>2]|0)-f|0,d=ps(+((A*3|0)-f|0)*.14285714285714285)|0,c[l>>2]=d,A=ps(+((f<<1)+A|0)*.14285714285714285)|0,c[w>>2]=A,c[y>>2]=0,f=A-d|0,(d|0)<0?(m=0-d|0,c[w>>2]=f,c[y>>2]=m,c[l>>2]=0,A=f,d=0,f=m):f=0,(A|0)<0&&(d=d-A|0,c[l>>2]=d,f=f-A|0,c[y>>2]=f,c[w>>2]=0,A=0),m=d-f|0,g=A-f|0,(f|0)<0?(c[l>>2]=m,c[w>>2]=g,c[y>>2]=0,A=g,g=m,f=0):g=d,d=(A|0)<(g|0)?A:g,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(c[l>>2]=g-d,c[w>>2]=A-d,c[y>>2]=f-d)}function hv(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;y=l+8|0,f=c[y>>2]|0,A=(c[l>>2]|0)-f|0,w=l+4|0,f=(c[w>>2]|0)-f|0,d=ps(+((A<<1)+f|0)*.14285714285714285)|0,c[l>>2]=d,A=ps(+((f*3|0)-A|0)*.14285714285714285)|0,c[w>>2]=A,c[y>>2]=0,f=A-d|0,(d|0)<0?(m=0-d|0,c[w>>2]=f,c[y>>2]=m,c[l>>2]=0,A=f,d=0,f=m):f=0,(A|0)<0&&(d=d-A|0,c[l>>2]=d,f=f-A|0,c[y>>2]=f,c[w>>2]=0,A=0),m=d-f|0,g=A-f|0,(f|0)<0?(c[l>>2]=m,c[w>>2]=g,c[y>>2]=0,A=g,g=m,f=0):g=d,d=(A|0)<(g|0)?A:g,d=(f|0)<(d|0)?f:d,!((d|0)<=0)&&(c[l>>2]=g-d,c[w>>2]=A-d,c[y>>2]=f-d)}function Cu(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;A=c[l>>2]|0,y=l+4|0,f=c[y>>2]|0,w=l+8|0,d=c[w>>2]|0,g=f+(A*3|0)|0,c[l>>2]=g,f=d+(f*3|0)|0,c[y>>2]=f,A=(d*3|0)+A|0,c[w>>2]=A,d=f-g|0,(g|0)<0?(A=A-g|0,c[y>>2]=d,c[w>>2]=A,c[l>>2]=0,f=d,d=0):d=g,(f|0)<0&&(d=d-f|0,c[l>>2]=d,A=A-f|0,c[w>>2]=A,c[y>>2]=0,f=0),m=d-A|0,g=f-A|0,(A|0)<0?(c[l>>2]=m,c[y>>2]=g,c[w>>2]=0,d=m,A=0):g=f,f=(g|0)<(d|0)?g:d,f=(A|0)<(f|0)?A:f,!((f|0)<=0)&&(c[l>>2]=d-f,c[y>>2]=g-f,c[w>>2]=A-f)}function yo(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;g=c[l>>2]|0,y=l+4|0,A=c[y>>2]|0,w=l+8|0,f=c[w>>2]|0,d=(A*3|0)+g|0,g=f+(g*3|0)|0,c[l>>2]=g,c[y>>2]=d,A=(f*3|0)+A|0,c[w>>2]=A,f=d-g|0,(g|0)<0?(A=A-g|0,c[y>>2]=f,c[w>>2]=A,c[l>>2]=0,g=0):f=d,(f|0)<0&&(g=g-f|0,c[l>>2]=g,A=A-f|0,c[w>>2]=A,c[y>>2]=0,f=0),m=g-A|0,d=f-A|0,(A|0)<0?(c[l>>2]=m,c[y>>2]=d,c[w>>2]=0,g=m,A=0):d=f,f=(d|0)<(g|0)?d:g,f=(A|0)<(f|0)?A:f,!((f|0)<=0)&&(c[l>>2]=g-f,c[y>>2]=d-f,c[w>>2]=A-f)}function dv(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0;(A+-1|0)>>>0>=6||(g=(c[15440+(A*12|0)>>2]|0)+(c[l>>2]|0)|0,c[l>>2]=g,w=l+4|0,d=(c[15440+(A*12|0)+4>>2]|0)+(c[w>>2]|0)|0,c[w>>2]=d,y=l+8|0,A=(c[15440+(A*12|0)+8>>2]|0)+(c[y>>2]|0)|0,c[y>>2]=A,f=d-g|0,(g|0)<0?(A=A-g|0,c[w>>2]=f,c[y>>2]=A,c[l>>2]=0,d=0):(f=d,d=g),(f|0)<0&&(d=d-f|0,c[l>>2]=d,A=A-f|0,c[y>>2]=A,c[w>>2]=0,f=0),m=d-A|0,g=f-A|0,(A|0)<0?(c[l>>2]=m,c[w>>2]=g,c[y>>2]=0,d=m,A=0):g=f,f=(g|0)<(d|0)?g:d,f=(A|0)<(f|0)?A:f,!((f|0)<=0)&&(c[l>>2]=d-f,c[w>>2]=g-f,c[y>>2]=A-f))}function pv(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;g=c[l>>2]|0,y=l+4|0,A=c[y>>2]|0,w=l+8|0,f=c[w>>2]|0,d=A+g|0,g=f+g|0,c[l>>2]=g,c[y>>2]=d,A=f+A|0,c[w>>2]=A,f=d-g|0,(g|0)<0?(A=A-g|0,c[y>>2]=f,c[w>>2]=A,c[l>>2]=0,d=0):(f=d,d=g),(f|0)<0&&(d=d-f|0,c[l>>2]=d,A=A-f|0,c[w>>2]=A,c[y>>2]=0,f=0),m=d-A|0,g=f-A|0,(A|0)<0?(c[l>>2]=m,c[y>>2]=g,c[w>>2]=0,d=m,A=0):g=f,f=(g|0)<(d|0)?g:d,f=(A|0)<(f|0)?A:f,!((f|0)<=0)&&(c[l>>2]=d-f,c[y>>2]=g-f,c[w>>2]=A-f)}function Pu(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;A=c[l>>2]|0,y=l+4|0,d=c[y>>2]|0,w=l+8|0,f=c[w>>2]|0,g=d+A|0,c[l>>2]=g,d=f+d|0,c[y>>2]=d,A=f+A|0,c[w>>2]=A,f=d-g|0,(g|0)<0?(A=A-g|0,c[y>>2]=f,c[w>>2]=A,c[l>>2]=0,d=0):(f=d,d=g),(f|0)<0&&(d=d-f|0,c[l>>2]=d,A=A-f|0,c[w>>2]=A,c[y>>2]=0,f=0),m=d-A|0,g=f-A|0,(A|0)<0?(c[l>>2]=m,c[y>>2]=g,c[w>>2]=0,d=m,A=0):g=f,f=(g|0)<(d|0)?g:d,f=(A|0)<(f|0)?A:f,!((f|0)<=0)&&(c[l>>2]=d-f,c[y>>2]=g-f,c[w>>2]=A-f)}function vo(l){switch(l=l|0,l|0){case 1:{l=5;break}case 5:{l=4;break}case 4:{l=6;break}case 6:{l=2;break}case 2:{l=3;break}case 3:{l=1;break}}return l|0}function hs(l){switch(l=l|0,l|0){case 1:{l=3;break}case 3:{l=2;break}case 2:{l=6;break}case 6:{l=4;break}case 4:{l=5;break}case 5:{l=1;break}}return l|0}function gv(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;A=c[l>>2]|0,y=l+4|0,f=c[y>>2]|0,w=l+8|0,d=c[w>>2]|0,g=f+(A<<1)|0,c[l>>2]=g,f=d+(f<<1)|0,c[y>>2]=f,A=(d<<1)+A|0,c[w>>2]=A,d=f-g|0,(g|0)<0?(A=A-g|0,c[y>>2]=d,c[w>>2]=A,c[l>>2]=0,f=d,d=0):d=g,(f|0)<0&&(d=d-f|0,c[l>>2]=d,A=A-f|0,c[w>>2]=A,c[y>>2]=0,f=0),m=d-A|0,g=f-A|0,(A|0)<0?(c[l>>2]=m,c[y>>2]=g,c[w>>2]=0,d=m,A=0):g=f,f=(g|0)<(d|0)?g:d,f=(A|0)<(f|0)?A:f,!((f|0)<=0)&&(c[l>>2]=d-f,c[y>>2]=g-f,c[w>>2]=A-f)}function mv(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;g=c[l>>2]|0,y=l+4|0,A=c[y>>2]|0,w=l+8|0,f=c[w>>2]|0,d=(A<<1)+g|0,g=f+(g<<1)|0,c[l>>2]=g,c[y>>2]=d,A=(f<<1)+A|0,c[w>>2]=A,f=d-g|0,(g|0)<0?(A=A-g|0,c[y>>2]=f,c[w>>2]=A,c[l>>2]=0,g=0):f=d,(f|0)<0&&(g=g-f|0,c[l>>2]=g,A=A-f|0,c[w>>2]=A,c[y>>2]=0,f=0),m=g-A|0,d=f-A|0,(A|0)<0?(c[l>>2]=m,c[y>>2]=d,c[w>>2]=0,g=m,A=0):d=f,f=(d|0)<(g|0)?d:g,f=(A|0)<(f|0)?A:f,!((f|0)<=0)&&(c[l>>2]=g-f,c[y>>2]=d-f,c[w>>2]=A-f)}function Yd(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0;return y=(c[l>>2]|0)-(c[A>>2]|0)|0,w=(y|0)<0,d=(c[l+4>>2]|0)-(c[A+4>>2]|0)-(w?y:0)|0,m=(d|0)<0,g=(w?0-y|0:0)+(c[l+8>>2]|0)-(c[A+8>>2]|0)+(m?0-d|0:0)|0,l=(g|0)<0,A=l?0:g,f=(m?0:d)-(l?g:0)|0,g=(w?0:y)-(m?d:0)-(l?g:0)|0,l=(f|0)<(g|0)?f:g,l=(A|0)<(l|0)?A:l,d=(l|0)>0,A=A-(d?l:0)|0,f=f-(d?l:0)|0,l=g-(d?l:0)|0,l=(l|0)>-1?l:0-l|0,f=(f|0)>-1?f:0-f|0,A=(A|0)>-1?A:0-A|0,A=(f|0)>(A|0)?f:A,((l|0)>(A|0)?l:A)|0}function S6(l,A){l=l|0,A=A|0;var f=0;f=c[l+8>>2]|0,c[A>>2]=(c[l>>2]|0)-f,c[A+4>>2]=(c[l+4>>2]|0)-f}function C6(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0;return d=c[l>>2]|0,c[A>>2]=d,g=c[l+4>>2]|0,y=A+4|0,c[y>>2]=g,w=A+8|0,c[w>>2]=0,f=(g|0)<(d|0),l=f?d:g,f=f?g:d,(f|0)<0&&((f|0)==-2147483648||((l|0)>0?(2147483647-l|0)<(f|0):(-2147483648-l|0)>(f|0))||((l|0)>-1?(l|-2147483648|0)>=(f|0):(l^-2147483648|0)<(f|0)))?(A=1,A|0):(l=g-d|0,(d|0)<0?(f=0-d|0,c[y>>2]=l,c[w>>2]=f,c[A>>2]=0,d=0):(l=g,f=0),(l|0)<0&&(d=d-l|0,c[A>>2]=d,f=f-l|0,c[w>>2]=f,c[y>>2]=0,l=0),m=d-f|0,g=l-f|0,(f|0)<0?(c[A>>2]=m,c[y>>2]=g,c[w>>2]=0,l=g,g=m,f=0):g=d,d=(l|0)<(g|0)?l:g,d=(f|0)<(d|0)?f:d,(d|0)<=0?(A=0,A|0):(c[A>>2]=g-d,c[y>>2]=l-d,c[w>>2]=f-d,A=0,A|0))}function _v(l){l=l|0;var A=0,f=0,d=0,g=0;A=l+8|0,g=c[A>>2]|0,f=g-(c[l>>2]|0)|0,c[l>>2]=f,d=l+4|0,l=(c[d>>2]|0)-g|0,c[d>>2]=l,c[A>>2]=0-(l+f)}function P6(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;f=c[l>>2]|0,A=0-f|0,c[l>>2]=A,y=l+8|0,c[y>>2]=0,w=l+4|0,d=c[w>>2]|0,g=d+f|0,(f|0)>0?(c[w>>2]=g,c[y>>2]=f,c[l>>2]=0,A=0,d=g):f=0,(d|0)<0?(m=A-d|0,c[l>>2]=m,f=f-d|0,c[y>>2]=f,c[w>>2]=0,g=m-f|0,A=0-f|0,(f|0)<0?(c[l>>2]=g,c[w>>2]=A,c[y>>2]=0,d=A,f=0):(d=0,g=m)):g=A,A=(d|0)<(g|0)?d:g,A=(f|0)<(A|0)?f:A,!((A|0)<=0)&&(c[l>>2]=g-A,c[w>>2]=d-A,c[y>>2]=f-A)}function R6(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0;if(F=B,B=B+64|0,C=F,w=F+56|0,!(!0&(A&2013265920|0)==134217728&(!0&(d&2013265920|0)==134217728)))return g=5,B=F,g|0;if((l|0)==(f|0)&(A|0)==(d|0))return c[g>>2]=0,g=0,B=F,g|0;if(y=ye(l|0,A|0,52)|0,z()|0,y=y&15,T=ye(f|0,d|0,52)|0,z()|0,(y|0)!=(T&15|0))return g=12,B=F,g|0;if(m=y+-1|0,y>>>0>1){Jd(l,A,m,C)|0,Jd(f,d,m,w)|0,T=C,x=c[T>>2]|0,T=c[T+4>>2]|0;e:do if((x|0)==(c[w>>2]|0)&&(T|0)==(c[w+4>>2]|0)){y=(y^15)*3|0,m=ye(l|0,A|0,y|0)|0,z()|0,m=m&7,y=ye(f|0,d|0,y|0)|0,z()|0,y=y&7;do if((m|0)==0|(y|0)==0)c[g>>2]=1,m=0;else if((m|0)==7)m=5;else{if((m|0)==1|(y|0)==1&&Et(x,T)|0){m=5;break}if((c[15536+(m<<2)>>2]|0)!=(y|0)&&(c[15568+(m<<2)>>2]|0)!=(y|0))break e;c[g>>2]=1,m=0}while(0);return g=m,B=F,g|0}while(0)}m=C,y=m+56|0;do c[m>>2]=0,m=m+4|0;while((m|0)<(y|0));return tv(l,A,1,C)|0,A=C,!((c[A>>2]|0)==(f|0)&&(c[A+4>>2]|0)==(d|0))&&(A=C+8|0,!((c[A>>2]|0)==(f|0)&&(c[A+4>>2]|0)==(d|0)))&&(A=C+16|0,!((c[A>>2]|0)==(f|0)&&(c[A+4>>2]|0)==(d|0)))&&(A=C+24|0,!((c[A>>2]|0)==(f|0)&&(c[A+4>>2]|0)==(d|0)))&&(A=C+32|0,!((c[A>>2]|0)==(f|0)&&(c[A+4>>2]|0)==(d|0)))&&(A=C+40|0,!((c[A>>2]|0)==(f|0)&&(c[A+4>>2]|0)==(d|0)))?(m=C+48|0,m=((c[m>>2]|0)==(f|0)?(c[m+4>>2]|0)==(d|0):0)&1):m=1,c[g>>2]=m,g=0,B=F,g|0}function k6(l,A,f,d,g){return l=l|0,A=A|0,f=f|0,d=d|0,g=g|0,f=Vd(l,A,f,d)|0,(f|0)==7?(g=11,g|0):(d=Te(f|0,0,56)|0,A=A&-2130706433|(z()|0)|268435456,c[g>>2]=l|d,c[g+4>>2]=A,g=0,g|0)}function I6(l,A,f){return l=l|0,A=A|0,f=f|0,!0&(A&2013265920|0)==268435456?(c[f>>2]=l,c[f+4>>2]=A&-2130706433|134217728,f=0,f|0):(f=6,f|0)}function M6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;return g=B,B=B+16|0,d=g,c[d>>2]=0,!0&(A&2013265920|0)==268435456?(m=ye(l|0,A|0,56)|0,z()|0,d=An(l,A&-2130706433|134217728,m&7,d,f)|0,B=g,d|0):(d=6,B=g,d|0)}function O6(l,A){l=l|0,A=A|0;var f=0;switch(f=ye(l|0,A|0,56)|0,z()|0,f&7){case 0:case 7:return f=0,f|0}return f=A&-2130706433|134217728,!(!0&(A&2013265920|0)==268435456)||!0&(A&117440512|0)==16777216&(Et(l,f)|0)!=0?(f=0,f|0):(f=Kd(l,f)|0,f|0)}function N6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0;return g=B,B=B+16|0,d=g,!0&(A&2013265920|0)==268435456?(m=A&-2130706433|134217728,y=f,c[y>>2]=l,c[y+4>>2]=m,c[d>>2]=0,A=ye(l|0,A|0,56)|0,z()|0,d=An(l,m,A&7,d,f+8|0)|0,B=g,d|0):(d=6,B=g,d|0)}function D6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0;return g=(Et(l,A)|0)==0,A=A&-2130706433,d=f,c[d>>2]=g?l:0,c[d+4>>2]=g?A|285212672:0,d=f+8|0,c[d>>2]=l,c[d+4>>2]=A|301989888,d=f+16|0,c[d>>2]=l,c[d+4>>2]=A|318767104,d=f+24|0,c[d>>2]=l,c[d+4>>2]=A|335544320,d=f+32|0,c[d>>2]=l,c[d+4>>2]=A|352321536,f=f+40|0,c[f>>2]=l,c[f+4>>2]=A|369098752,0}function Ru(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0;return y=B,B=B+16|0,g=y,m=A&-2130706433|134217728,!0&(A&2013265920|0)==268435456?(d=ye(l|0,A|0,56)|0,z()|0,d=M8(l,m,d&7)|0,(d|0)==-1?(c[f>>2]=0,m=6,B=y,m|0):(wa(l,m,g)|0&&je(27795,26932,282,26947),A=ye(l|0,A|0,52)|0,z()|0,A=A&15,Et(l,m)|0?qd(g,A,d,2,f):Zd(g,A,d,2,f),m=0,B=y,m|0)):(m=6,B=y,m|0)}function B6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0;d=B,B=B+16|0,g=d,L6(l,A,f,g),b6(g,f+4|0),B=d}function L6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0;if(w=B,B=B+16|0,x=w,F6(l,f,x),m=+Eu(+(1-+N[x>>3]*.5)),m<1e-16){c[d>>2]=0,c[d+4>>2]=0,c[d+8>>2]=0,c[d+12>>2]=0,B=w;return}if(x=c[f>>2]|0,g=+N[15920+(x*24|0)>>3],g=+oc(g-+oc(+t8(15600+(x<<4)|0,l))),Er(A)|0?y=+oc(g+-.3334731722518321):y=g,g=+xr(+m)*2.618033988749896,(A|0)>0){l=0;do g=g*2.6457513110645907,l=l+1|0;while((l|0)!=(A|0))}m=+ht(+y)*g,N[d>>3]=m,y=+nt(+y)*g,N[d+8>>3]=y,B=w}function F6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;if(m=B,B=B+32|0,g=m,I8(l,g),c[A>>2]=0,N[f>>3]=5,d=+Gt(16400,g),d<+N[f>>3]&&(c[A>>2]=0,N[f>>3]=d),d=+Gt(16424,g),d<+N[f>>3]&&(c[A>>2]=1,N[f>>3]=d),d=+Gt(16448,g),d<+N[f>>3]&&(c[A>>2]=2,N[f>>3]=d),d=+Gt(16472,g),d<+N[f>>3]&&(c[A>>2]=3,N[f>>3]=d),d=+Gt(16496,g),d<+N[f>>3]&&(c[A>>2]=4,N[f>>3]=d),d=+Gt(16520,g),d<+N[f>>3]&&(c[A>>2]=5,N[f>>3]=d),d=+Gt(16544,g),d<+N[f>>3]&&(c[A>>2]=6,N[f>>3]=d),d=+Gt(16568,g),d<+N[f>>3]&&(c[A>>2]=7,N[f>>3]=d),d=+Gt(16592,g),d<+N[f>>3]&&(c[A>>2]=8,N[f>>3]=d),d=+Gt(16616,g),d<+N[f>>3]&&(c[A>>2]=9,N[f>>3]=d),d=+Gt(16640,g),d<+N[f>>3]&&(c[A>>2]=10,N[f>>3]=d),d=+Gt(16664,g),d<+N[f>>3]&&(c[A>>2]=11,N[f>>3]=d),d=+Gt(16688,g),d<+N[f>>3]&&(c[A>>2]=12,N[f>>3]=d),d=+Gt(16712,g),d<+N[f>>3]&&(c[A>>2]=13,N[f>>3]=d),d=+Gt(16736,g),d<+N[f>>3]&&(c[A>>2]=14,N[f>>3]=d),d=+Gt(16760,g),d<+N[f>>3]&&(c[A>>2]=15,N[f>>3]=d),d=+Gt(16784,g),d<+N[f>>3]&&(c[A>>2]=16,N[f>>3]=d),d=+Gt(16808,g),d<+N[f>>3]&&(c[A>>2]=17,N[f>>3]=d),d=+Gt(16832,g),d<+N[f>>3]&&(c[A>>2]=18,N[f>>3]=d),d=+Gt(16856,g),!(d<+N[f>>3])){B=m;return}c[A>>2]=19,N[f>>3]=d,B=m}function ic(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0;if(m=+k8(l),m<1e-16){A=15600+(A<<4)|0,c[g>>2]=c[A>>2],c[g+4>>2]=c[A+4>>2],c[g+8>>2]=c[A+8>>2],c[g+12>>2]=c[A+12>>2];return}if(y=+Tr(+ +N[l+8>>3],+ +N[l>>3]),(f|0)>0){l=0;do m=m*.37796447300922725,l=l+1|0;while((l|0)!=(f|0))}w=m*.3333333333333333,d?(f=(Er(f)|0)==0,m=+Ud(+((f?w:w*.37796447300922725)*.381966011250105))):(m=+Ud(+(m*.381966011250105)),Er(f)|0&&(y=+oc(y+.3334731722518321))),n8(15600+(A<<4)|0,+oc(+N[15920+(A*24|0)>>3]-y),m,g)}function U6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0;d=B,B=B+16|0,g=d,_o(l+4|0,g),ic(g,c[l>>2]|0,A,0,f),B=d}function qd(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0,Ze=0,rt=0,$e=0,Le=0,we=0,Ge=0,bt=0,Ke=0;if(Ge=B,B=B+272|0,m=Ge+256|0,Ae=Ge+240|0,$e=Ge,Le=Ge+224|0,we=Ge+208|0,ae=Ge+176|0,te=Ge+160|0,xe=Ge+192|0,Be=Ge+144|0,Ie=Ge+128|0,Ye=Ge+112|0,Ze=Ge+96|0,rt=Ge+80|0,c[m>>2]=A,c[Ae>>2]=c[l>>2],c[Ae+4>>2]=c[l+4>>2],c[Ae+8>>2]=c[l+8>>2],c[Ae+12>>2]=c[l+12>>2],yv(Ae,m,$e),c[g>>2]=0,Ae=d+f+((d|0)==5&1)|0,(Ae|0)<=(f|0)){B=Ge;return}x=c[m>>2]|0,T=Le+4|0,C=ae+4|0,F=f+5|0,j=16880+(x<<2)|0,H=16960+(x<<2)|0,X=Ie+8|0,J=Ye+8|0,ne=Ze+8|0,pe=we+4|0,w=f;e:for(;;){y=$e+(((w|0)%5|0)<<4)|0,c[we>>2]=c[y>>2],c[we+4>>2]=c[y+4>>2],c[we+8>>2]=c[y+8>>2],c[we+12>>2]=c[y+12>>2];do;while((va(we,x,0,1)|0)==2);if((w|0)>(f|0)&(Er(A)|0)!=0){if(c[ae>>2]=c[we>>2],c[ae+4>>2]=c[we+4>>2],c[ae+8>>2]=c[we+8>>2],c[ae+12>>2]=c[we+12>>2],_o(T,te),d=c[ae>>2]|0,m=c[17040+(d*80|0)+(c[Le>>2]<<2)>>2]|0,c[ae>>2]=c[18640+(d*80|0)+(m*20|0)>>2],y=c[18640+(d*80|0)+(m*20|0)+16>>2]|0,(y|0)>0){l=0;do pv(C),l=l+1|0;while((l|0)<(y|0))}switch(y=18640+(d*80|0)+(m*20|0)+4|0,c[xe>>2]=c[y>>2],c[xe+4>>2]=c[y+4>>2],c[xe+8>>2]=c[y+8>>2],fv(xe,(c[j>>2]|0)*3|0),Un(C,xe,C),Pn(C),_o(C,Be),bt=+(c[H>>2]|0),N[Ie>>3]=bt*3,N[X>>3]=0,Ke=bt*-1.5,N[Ye>>3]=Ke,N[J>>3]=bt*2.598076211353316,N[Ze>>3]=Ke,N[ne>>3]=bt*-2.598076211353316,c[17040+((c[ae>>2]|0)*80|0)+(c[we>>2]<<2)>>2]|0){case 1:{l=Ye,d=Ie;break}case 3:{l=Ze,d=Ye;break}case 2:{l=Ie,d=Ze;break}default:{l=12;break e}}Dv(te,Be,d,l,rt),ic(rt,c[ae>>2]|0,x,1,g+8+(c[g>>2]<<4)|0),c[g>>2]=(c[g>>2]|0)+1}if((w|0)<(F|0)&&(_o(pe,ae),ic(ae,c[we>>2]|0,x,1,g+8+(c[g>>2]<<4)|0),c[g>>2]=(c[g>>2]|0)+1),c[Le>>2]=c[we>>2],c[Le+4>>2]=c[we+4>>2],c[Le+8>>2]=c[we+8>>2],c[Le+12>>2]=c[we+12>>2],w=w+1|0,(w|0)>=(Ae|0)){l=3;break}}if((l|0)==3){B=Ge;return}else(l|0)==12&&je(26970,27017,572,27027)}function yv(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0;x=B,B=B+128|0,d=x+64|0,g=x,m=d,y=20240,w=m+60|0;do c[m>>2]=c[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(w|0));m=g,y=20304,w=m+60|0;do c[m>>2]=c[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(w|0));w=(Er(c[A>>2]|0)|0)==0,d=w?d:g,g=l+4|0,gv(g),mv(g),Er(c[A>>2]|0)|0&&(yo(g),c[A>>2]=(c[A>>2]|0)+1),c[f>>2]=c[l>>2],A=f+4|0,Un(g,d,A),Pn(A),c[f+16>>2]=c[l>>2],A=f+20|0,Un(g,d+12|0,A),Pn(A),c[f+32>>2]=c[l>>2],A=f+36|0,Un(g,d+24|0,A),Pn(A),c[f+48>>2]=c[l>>2],A=f+52|0,Un(g,d+36|0,A),Pn(A),c[f+64>>2]=c[l>>2],f=f+68|0,Un(g,d+48|0,f),Pn(f),B=x}function va(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0;if(X=B,B=B+32|0,j=X+12|0,w=X,H=l+4|0,F=c[16960+(A<<2)>>2]|0,C=(d|0)!=0,F=C?F*3|0:F,g=c[H>>2]|0,T=l+8|0,y=c[T>>2]|0,C){if(m=l+12|0,d=c[m>>2]|0,g=y+g+d|0,(g|0)==(F|0))return H=1,B=X,H|0;x=m}else x=l+12|0,d=c[x>>2]|0,g=y+g+d|0;if((g|0)<=(F|0))return H=0,B=X,H|0;do if((d|0)>0){if(d=c[l>>2]|0,(y|0)>0){m=18640+(d*80|0)+60|0,d=l;break}d=18640+(d*80|0)+40|0,f?(w6(j,F,0,0),Qd(H,j,w),Pu(w),Un(w,j,H),m=d,d=l):(m=d,d=l)}else m=18640+((c[l>>2]|0)*80|0)+20|0,d=l;while(0);if(c[d>>2]=c[m>>2],g=m+16|0,(c[g>>2]|0)>0){d=0;do pv(H),d=d+1|0;while((d|0)<(c[g>>2]|0))}return l=m+4|0,c[j>>2]=c[l>>2],c[j+4>>2]=c[l+4>>2],c[j+8>>2]=c[l+8>>2],A=c[16880+(A<<2)>>2]|0,fv(j,C?A*3|0:A),Un(H,j,H),Pn(H),C?d=((c[T>>2]|0)+(c[H>>2]|0)+(c[x>>2]|0)|0)==(F|0)?1:2:d=2,H=d,B=X,H|0}function z6(l,A){l=l|0,A=A|0;var f=0;do f=va(l,A,0,1)|0;while((f|0)==2);return f|0}function Zd(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0,Ze=0,rt=0,$e=0;if(Ze=B,B=B+240|0,m=Ze+224|0,xe=Ze+208|0,Be=Ze,Ie=Ze+192|0,Ye=Ze+176|0,ne=Ze+160|0,pe=Ze+144|0,Ae=Ze+128|0,ae=Ze+112|0,te=Ze+96|0,c[m>>2]=A,c[xe>>2]=c[l>>2],c[xe+4>>2]=c[l+4>>2],c[xe+8>>2]=c[l+8>>2],c[xe+12>>2]=c[l+12>>2],vv(xe,m,Be),c[g>>2]=0,J=d+f+((d|0)==6&1)|0,(J|0)<=(f|0)){B=Ze;return}x=c[m>>2]|0,T=f+6|0,C=16960+(x<<2)|0,F=pe+8|0,j=Ae+8|0,H=ae+8|0,X=Ie+4|0,y=0,w=f,d=-1;e:for(;;){if(m=(w|0)%6|0,l=Be+(m<<4)|0,c[Ie>>2]=c[l>>2],c[Ie+4>>2]=c[l+4>>2],c[Ie+8>>2]=c[l+8>>2],c[Ie+12>>2]=c[l+12>>2],l=y,y=va(Ie,x,0,1)|0,(w|0)>(f|0)&(Er(A)|0)!=0&&(l|0)!=1&&(c[Ie>>2]|0)!=(d|0)){switch(_o(Be+(((m+5|0)%6|0)<<4)+4|0,Ye),_o(Be+(m<<4)+4|0,ne),rt=+(c[C>>2]|0),N[pe>>3]=rt*3,N[F>>3]=0,$e=rt*-1.5,N[Ae>>3]=$e,N[j>>3]=rt*2.598076211353316,N[ae>>3]=$e,N[H>>3]=rt*-2.598076211353316,m=c[xe>>2]|0,c[17040+(m*80|0)+(((d|0)==(m|0)?c[Ie>>2]|0:d)<<2)>>2]|0){case 1:{l=Ae,d=pe;break}case 3:{l=ae,d=Ae;break}case 2:{l=pe,d=ae;break}default:{l=8;break e}}Dv(Ye,ne,d,l,te),!(Bv(Ye,te)|0)&&!(Bv(ne,te)|0)&&(ic(te,c[xe>>2]|0,x,1,g+8+(c[g>>2]<<4)|0),c[g>>2]=(c[g>>2]|0)+1)}if((w|0)<(T|0)&&(_o(X,Ye),ic(Ye,c[Ie>>2]|0,x,1,g+8+(c[g>>2]<<4)|0),c[g>>2]=(c[g>>2]|0)+1),w=w+1|0,(w|0)>=(J|0)){l=3;break}else d=c[Ie>>2]|0}if((l|0)==3){B=Ze;return}else(l|0)==8&&je(27054,27017,737,27099)}function vv(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0;x=B,B=B+160|0,d=x+80|0,g=x,m=d,y=20368,w=m+72|0;do c[m>>2]=c[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(w|0));m=g,y=20448,w=m+72|0;do c[m>>2]=c[y>>2],m=m+4|0,y=y+4|0;while((m|0)<(w|0));w=(Er(c[A>>2]|0)|0)==0,d=w?d:g,g=l+4|0,gv(g),mv(g),Er(c[A>>2]|0)|0&&(yo(g),c[A>>2]=(c[A>>2]|0)+1),c[f>>2]=c[l>>2],A=f+4|0,Un(g,d,A),Pn(A),c[f+16>>2]=c[l>>2],A=f+20|0,Un(g,d+12|0,A),Pn(A),c[f+32>>2]=c[l>>2],A=f+36|0,Un(g,d+24|0,A),Pn(A),c[f+48>>2]=c[l>>2],A=f+52|0,Un(g,d+36|0,A),Pn(A),c[f+64>>2]=c[l>>2],A=f+68|0,Un(g,d+48|0,A),Pn(A),c[f+80>>2]=c[l>>2],f=f+84|0,Un(g,d+60|0,f),Pn(f),B=x}function V6(l,A){return l=l|0,A=A|0,A=ye(l|0,A|0,52)|0,z()|0,A&15|0}function wv(l,A){return l=l|0,A=A|0,A=ye(l|0,A|0,45)|0,z()|0,A&127|0}function Kd(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0;return!(!0&(A&-16777216|0)==134217728)||(d=ye(l|0,A|0,52)|0,z()|0,d=d&15,f=ye(l|0,A|0,45)|0,z()|0,f=f&127,f>>>0>121)?(l=0,l|0):(y=(d^15)*3|0,g=ye(l|0,A|0,y|0)|0,y=Te(g|0,z()|0,y|0)|0,g=z()|0,m=_n(-1227133514,-1171,y|0,g|0)|0,!((y&613566756&m|0)==0&(g&4681&(z()|0)|0)==0)||(y=(d*3|0)+19|0,m=Te(~l|0,~A|0,y|0)|0,y=ye(m|0,z()|0,y|0)|0,!((d|0)==15|(y|0)==0&(z()|0)==0))?(y=0,y|0):!(_e[20528+f>>0]|0)||(A=A&8191,(l|0)==0&(A|0)==0)?(y=1,y|0):(y=Wv(l|0,A|0)|0,z()|0,((63-y|0)%3|0|0)!=0|0))}function Gd(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0;if(g=Te(A|0,0,52)|0,m=z()|0,f=Te(f|0,0,45)|0,f=m|(z()|0)|134225919,(A|0)<1){m=-1,d=f,A=l,c[A>>2]=m,l=l+4|0,c[l>>2]=d;return}for(m=1,g=-1;y=(15-m|0)*3|0,w=Te(7,0,y|0)|0,f=f&~(z()|0),y=Te(d|0,0,y|0)|0,g=g&~w|y,f=f|(z()|0),(m|0)!=(A|0);)m=m+1|0;w=l,y=w,c[y>>2]=g,w=w+4|0,c[w>>2]=f}function Jd(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0;if(m=ye(l|0,A|0,52)|0,z()|0,m=m&15,f>>>0>15)return d=4,d|0;if((m|0)<(f|0))return d=12,d|0;if((m|0)==(f|0))return c[d>>2]=l,c[d+4>>2]=A,d=0,d|0;if(g=Te(f|0,0,52)|0,g=g|l,l=z()|0|A&-15728641,(m|0)>(f|0))do A=Te(7,0,(14-f|0)*3|0)|0,f=f+1|0,g=A|g,l=z()|0|l;while((f|0)<(m|0));return c[d>>2]=g,c[d+4>>2]=l,d=0,d|0}function sc(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0;if(m=ye(l|0,A|0,52)|0,z()|0,m=m&15,!((f|0)<16&(m|0)<=(f|0)))return d=4,d|0;g=f-m|0,f=ye(l|0,A|0,45)|0,z()|0;e:do if(!(It(f&127)|0))f=ds(7,0,g,((g|0)<0)<<31>>31)|0,g=z()|0;else{t:do if(m|0){for(f=1;y=Te(7,0,(15-f|0)*3|0)|0,!!((y&l|0)==0&((z()|0)&A|0)==0);)if(f>>>0<m>>>0)f=f+1|0;else break t;f=ds(7,0,g,((g|0)<0)<<31>>31)|0,g=z()|0;break e}while(0);f=ds(7,0,g,((g|0)<0)<<31>>31)|0,f=un(f|0,z()|0,5,0)|0,f=Fe(f|0,z()|0,-5,-1)|0,f=gs(f|0,z()|0,6,0)|0,f=Fe(f|0,z()|0,1,0)|0,g=z()|0}while(0);return y=d,c[y>>2]=f,c[y+4>>2]=g,y=0,y|0}function Et(l,A){l=l|0,A=A|0;var f=0,d=0,g=0;if(g=ye(l|0,A|0,45)|0,z()|0,!(It(g&127)|0))return g=0,g|0;g=ye(l|0,A|0,52)|0,z()|0,g=g&15;e:do if(!g)f=0;else for(d=1;;){if(f=ye(l|0,A|0,(15-d|0)*3|0)|0,z()|0,f=f&7,f|0)break e;if(d>>>0<g>>>0)d=d+1|0;else{f=0;break}}while(0);return g=(f|0)==0&1,g|0}function $6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0;if(y=B,B=B+16|0,m=y,sp(m,l,A,f),A=m,l=c[A>>2]|0,A=c[A+4>>2]|0,(l|0)==0&(A|0)==0)return B=y,0;g=0,f=0;do w=d+(g<<3)|0,c[w>>2]=l,c[w+4>>2]=A,g=Fe(g|0,f|0,1,0)|0,f=z()|0,op(m),w=m,l=c[w>>2]|0,A=c[w+4>>2]|0;while(!((l|0)==0&(A|0)==0));return B=y,0}function bv(l,A,f,d){return l=l|0,A=A|0,f=f|0,d=d|0,(d|0)<(f|0)?(f=A,d=l,qe(f|0),d|0):(f=Te(-1,-1,((d-f|0)*3|0)+3|0)|0,d=Te(~f|0,~(z()|0)|0,(15-d|0)*3|0)|0,f=~(z()|0)&A,d=~d&l,qe(f|0),d|0)}function xv(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0;return g=ye(l|0,A|0,52)|0,z()|0,g=g&15,(f|0)<16&(g|0)<=(f|0)?((g|0)<(f|0)&&(g=Te(-1,-1,((f+-1-g|0)*3|0)+3|0)|0,g=Te(~g|0,~(z()|0)|0,(15-f|0)*3|0)|0,A=~(z()|0)&A,l=~g&l),g=Te(f|0,0,52)|0,f=A&-15728641|(z()|0),c[d>>2]=l|g,c[d+4>>2]=f,d=0,d|0):(d=4,d|0)}function W6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0,Ze=0,rt=0,$e=0,Le=0,we=0;if((f|0)==0&(d|0)==0)return we=0,we|0;if(g=l,m=c[g>>2]|0,g=c[g+4>>2]|0,!0&(g&15728640|0)==0){if(!((d|0)>0|(d|0)==0&f>>>0>0)||(we=A,c[we>>2]=m,c[we+4>>2]=g,(f|0)==1&(d|0)==0))return we=0,we|0;g=1,m=0;do $e=l+(g<<3)|0,Le=c[$e+4>>2]|0,we=A+(g<<3)|0,c[we>>2]=c[$e>>2],c[we+4>>2]=Le,g=Fe(g|0,m|0,1,0)|0,m=z()|0;while((m|0)<(d|0)|(m|0)==(d|0)&g>>>0<f>>>0);return g=0,g|0}if(rt=f<<3,Le=hi(rt)|0,!Le)return we=13,we|0;if(Sa(Le|0,l|0,rt|0)|0,$e=Gn(f,8)|0,!$e)return Ue(Le),we=13,we|0;e:for(;;){g=Le,T=c[g>>2]|0,g=c[g+4>>2]|0,Ye=ye(T|0,g|0,52)|0,z()|0,Ye=Ye&15,Ze=Ye+-1|0,Ie=(Ye|0)!=0,Be=(d|0)>0|(d|0)==0&f>>>0>0;t:do if(Ie&Be){if(Ae=Te(Ze|0,0,52)|0,ae=z()|0,Ze>>>0>15){if(!((T|0)==0&(g|0)==0)){we=16;break e}for(m=0,l=0;;){if(m=Fe(m|0,l|0,1,0)|0,l=z()|0,!((l|0)<(d|0)|(l|0)==(d|0)&m>>>0<f>>>0))break t;if(y=Le+(m<<3)|0,xe=c[y>>2]|0,y=c[y+4>>2]|0,!((xe|0)==0&(y|0)==0)){g=y,we=16;break e}}}for(w=T,l=g,m=0,y=0;;){if(!((w|0)==0&(l|0)==0)){if(!(!0&(l&117440512|0)==0)){we=21;break e}if(C=ye(w|0,l|0,52)|0,z()|0,C=C&15,(C|0)<(Ze|0)){g=12,we=27;break e}if((C|0)!=(Ze|0)&&(w=w|Ae,l=l&-15728641|ae,C>>>0>=Ye>>>0)){x=Ze;do xe=Te(7,0,(14-x|0)*3|0)|0,x=x+1|0,w=xe|w,l=z()|0|l;while(x>>>0<C>>>0)}if(j=Ea(w|0,l|0,f|0,d|0)|0,H=z()|0,x=$e+(j<<3)|0,C=x,F=c[C>>2]|0,C=c[C+4>>2]|0,!((F|0)==0&(C|0)==0)){ne=0,pe=0;do{if((ne|0)>(d|0)|(ne|0)==(d|0)&pe>>>0>f>>>0){we=31;break e}if((F|0)==(w|0)&(C&-117440513|0)==(l|0)){X=ye(F|0,C|0,56)|0,z()|0,X=X&7,J=X+1|0,xe=ye(F|0,C|0,45)|0,z()|0;n:do if(!(It(xe&127)|0))C=7;else{if(F=ye(F|0,C|0,52)|0,z()|0,F=F&15,!F){C=6;break}for(C=1;;){if(xe=Te(7,0,(15-C|0)*3|0)|0,!((xe&w|0)==0&((z()|0)&l|0)==0)){C=7;break n}if(C>>>0<F>>>0)C=C+1|0;else{C=6;break}}}while(0);if((X+2|0)>>>0>C>>>0){we=41;break e}xe=Te(J|0,0,56)|0,l=z()|0|l&-117440513,te=x,c[te>>2]=0,c[te+4>>2]=0,w=xe|w}else j=Fe(j|0,H|0,1,0)|0,j=Ta(j|0,z()|0,f|0,d|0)|0,H=z()|0;pe=Fe(pe|0,ne|0,1,0)|0,ne=z()|0,x=$e+(j<<3)|0,C=x,F=c[C>>2]|0,C=c[C+4>>2]|0}while(!((F|0)==0&(C|0)==0))}xe=x,c[xe>>2]=w,c[xe+4>>2]=l}if(m=Fe(m|0,y|0,1,0)|0,y=z()|0,!((y|0)<(d|0)|(y|0)==(d|0)&m>>>0<f>>>0))break t;l=Le+(m<<3)|0,w=c[l>>2]|0,l=c[l+4>>2]|0}}while(0);if(xe=Fe(f|0,d|0,5,0)|0,te=z()|0,te>>>0<0|(te|0)==0&xe>>>0<11){we=85;break}if(xe=gs(f|0,d|0,6,0)|0,z()|0,xe=Gn(xe,8)|0,!xe){we=48;break}do if(Be){for(J=0,l=0,X=0,ne=0;;){if(C=$e+(J<<3)|0,y=C,m=c[y>>2]|0,y=c[y+4>>2]|0,(m|0)==0&(y|0)==0)te=X;else{F=ye(m|0,y|0,56)|0,z()|0,F=F&7,w=F+1|0,j=y&-117440513,te=ye(m|0,y|0,45)|0,z()|0;t:do if(It(te&127)|0){if(H=ye(m|0,y|0,52)|0,z()|0,H=H&15,H|0)for(x=1;;){if(te=Te(7,0,(15-x|0)*3|0)|0,!((m&te|0)==0&(j&(z()|0)|0)==0))break t;if(x>>>0<H>>>0)x=x+1|0;else break}y=Te(w|0,0,56)|0,m=y|m,y=z()|0|j,w=C,c[w>>2]=m,c[w+4>>2]=y,w=F+2|0}while(0);(w|0)==7?(te=xe+(l<<3)|0,c[te>>2]=m,c[te+4>>2]=y&-117440513,l=Fe(l|0,X|0,1,0)|0,te=z()|0):te=X}if(J=Fe(J|0,ne|0,1,0)|0,ne=z()|0,(ne|0)<(d|0)|(ne|0)==(d|0)&J>>>0<f>>>0)X=te;else break}if(Be){if(pe=Ze>>>0>15,Ae=Te(Ze|0,0,52)|0,ae=z()|0,!Ie){for(m=0,x=0,w=0,y=0;(T|0)==0&(g|0)==0||(Ze=A+(m<<3)|0,c[Ze>>2]=T,c[Ze+4>>2]=g,m=Fe(m|0,x|0,1,0)|0,x=z()|0),w=Fe(w|0,y|0,1,0)|0,y=z()|0,!!((y|0)<(d|0)|(y|0)==(d|0)&w>>>0<f>>>0);)g=Le+(w<<3)|0,T=c[g>>2]|0,g=c[g+4>>2]|0;g=te;break}for(m=0,x=0,y=0,w=0;;){do if(!((T|0)==0&(g|0)==0)){if(H=ye(T|0,g|0,52)|0,z()|0,H=H&15,pe|(H|0)<(Ze|0)){we=80;break e}if((H|0)!=(Ze|0)){if(C=T|Ae,F=g&-15728641|ae,H>>>0>=Ye>>>0){j=Ze;do Ie=Te(7,0,(14-j|0)*3|0)|0,j=j+1|0,C=Ie|C,F=z()|0|F;while(j>>>0<H>>>0)}}else C=T,F=g;X=Ea(C|0,F|0,f|0,d|0)|0,j=0,H=0,ne=z()|0;do{if((j|0)>(d|0)|(j|0)==(d|0)&H>>>0>f>>>0){we=81;break e}if(Ie=$e+(X<<3)|0,J=c[Ie+4>>2]|0,(J&-117440513|0)==(F|0)&&(c[Ie>>2]|0)==(C|0)){we=65;break}Ie=Fe(X|0,ne|0,1,0)|0,X=Ta(Ie|0,z()|0,f|0,d|0)|0,ne=z()|0,H=Fe(H|0,j|0,1,0)|0,j=z()|0,Ie=$e+(X<<3)|0}while(!((c[Ie>>2]|0)==(C|0)&&(c[Ie+4>>2]|0)==(F|0)));if((we|0)==65&&(we=0,!0&(J&117440512|0)==100663296))break;Ie=A+(m<<3)|0,c[Ie>>2]=T,c[Ie+4>>2]=g,m=Fe(m|0,x|0,1,0)|0,x=z()|0}while(0);if(y=Fe(y|0,w|0,1,0)|0,w=z()|0,!((w|0)<(d|0)|(w|0)==(d|0)&y>>>0<f>>>0))break;g=Le+(y<<3)|0,T=c[g>>2]|0,g=c[g+4>>2]|0}g=te}else m=0,g=te}else m=0,l=0,g=0;while(0);if(ms($e|0,0,rt|0)|0,Sa(Le|0,xe|0,l<<3|0)|0,Ue(xe),(l|0)==0&(g|0)==0){we=89;break}else A=A+(m<<3)|0,d=g,f=l}if((we|0)==16)!0&(g&117440512|0)==0?(g=4,we=27):we=21;else if((we|0)==31)je(27795,27122,529,27132);else{if((we|0)==41)return Ue(Le),Ue($e),we=10,we|0;if((we|0)==48)return Ue(Le),Ue($e),we=13,we|0;(we|0)==80?je(27795,27122,620,27132):(we|0)==81?je(27795,27122,632,27132):(we|0)==85&&(Sa(A|0,Le|0,f<<3|0)|0,we=89)}return(we|0)==21?(Ue(Le),Ue($e),we=5,we|0):(we|0)==27?(Ue(Le),Ue($e),we=g,we|0):(we|0)==89?(Ue(Le),Ue($e),we=0,we|0):0}function j6(l,A,f,d,g,m,y){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0,m=m|0,y=y|0;var w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0;if(J=B,B=B+16|0,X=J,!((f|0)>0|(f|0)==0&A>>>0>0))return X=0,B=J,X|0;if((y|0)>=16)return X=12,B=J,X|0;j=0,H=0,F=0,w=0;e:for(;;){if(T=l+(j<<3)|0,x=c[T>>2]|0,T=c[T+4>>2]|0,C=ye(x|0,T|0,52)|0,z()|0,(C&15|0)>(y|0)){w=12,x=11;break}if(sp(X,x,T,y),C=X,T=c[C>>2]|0,C=c[C+4>>2]|0,(T|0)==0&(C|0)==0)x=F;else{x=F;do{if(!((w|0)<(m|0)|(w|0)==(m|0)&x>>>0<g>>>0)){x=10;break e}F=d+(x<<3)|0,c[F>>2]=T,c[F+4>>2]=C,x=Fe(x|0,w|0,1,0)|0,w=z()|0,op(X),F=X,T=c[F>>2]|0,C=c[F+4>>2]|0}while(!((T|0)==0&(C|0)==0))}if(j=Fe(j|0,H|0,1,0)|0,H=z()|0,(H|0)<(f|0)|(H|0)==(f|0)&j>>>0<A>>>0)F=x;else{w=0,x=11;break}}return(x|0)==10?(X=14,B=J,X|0):(x|0)==11?(B=J,w|0):0}function H6(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0;j=B,B=B+16|0,F=j;e:do if((f|0)>0|(f|0)==0&A>>>0>0){for(T=0,y=0,m=0,C=0;;){if(x=l+(T<<3)|0,w=c[x>>2]|0,x=c[x+4>>2]|0,!((w|0)==0&(x|0)==0)&&(x=(sc(w,x,d,F)|0)==0,w=F,y=Fe(c[w>>2]|0,c[w+4>>2]|0,y|0,m|0)|0,m=z()|0,!x)){m=12;break}if(T=Fe(T|0,C|0,1,0)|0,C=z()|0,!((C|0)<(f|0)|(C|0)==(f|0)&T>>>0<A>>>0))break e}return B=j,m|0}else y=0,m=0;while(0);return c[g>>2]=y,c[g+4>>2]=m,g=0,B=j,g|0}function X6(l,A){return l=l|0,A=A|0,A=ye(l|0,A|0,52)|0,z()|0,A&1|0}function Kn(l,A){l=l|0,A=A|0;var f=0,d=0,g=0;if(g=ye(l|0,A|0,52)|0,z()|0,g=g&15,!g)return g=0,g|0;for(d=1;;){if(f=ye(l|0,A|0,(15-d|0)*3|0)|0,z()|0,f=f&7,f|0){d=5;break}if(d>>>0<g>>>0)d=d+1|0;else{f=0,d=5;break}}return(d|0)==5?f|0:0}function ep(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0;if(x=ye(l|0,A|0,52)|0,z()|0,x=x&15,!x)return w=A,x=l,qe(w|0),x|0;for(w=1,f=0;;){m=(15-w|0)*3|0,d=Te(7,0,m|0)|0,g=z()|0,y=ye(l|0,A|0,m|0)|0,z()|0,m=Te(vo(y&7)|0,0,m|0)|0,y=z()|0,l=m|l&~d,A=y|A&~g;e:do if(!f)if((m&d|0)==0&(y&g|0)==0)f=0;else if(d=ye(l|0,A|0,52)|0,z()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(y=ye(l|0,A|0,(15-f|0)*3|0)|0,z()|0,y&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(y=(15-f|0)*3|0,g=ye(l|0,A|0,y|0)|0,z()|0,m=Te(7,0,y|0)|0,A=A&~(z()|0),y=Te(vo(g&7)|0,0,y|0)|0,l=l&~m|y,A=A|(z()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(0);if(w>>>0<x>>>0)w=w+1|0;else break}return qe(A|0),l|0}function wo(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0;if(d=ye(l|0,A|0,52)|0,z()|0,d=d&15,!d)return f=A,d=l,qe(f|0),d|0;for(f=1;m=(15-f|0)*3|0,y=ye(l|0,A|0,m|0)|0,z()|0,g=Te(7,0,m|0)|0,A=A&~(z()|0),m=Te(vo(y&7)|0,0,m|0)|0,l=m|l&~g,A=z()|0|A,f>>>0<d>>>0;)f=f+1|0;return qe(A|0),l|0}function Q6(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0;if(x=ye(l|0,A|0,52)|0,z()|0,x=x&15,!x)return w=A,x=l,qe(w|0),x|0;for(w=1,f=0;;){m=(15-w|0)*3|0,d=Te(7,0,m|0)|0,g=z()|0,y=ye(l|0,A|0,m|0)|0,z()|0,m=Te(hs(y&7)|0,0,m|0)|0,y=z()|0,l=m|l&~d,A=y|A&~g;e:do if(!f)if((m&d|0)==0&(y&g|0)==0)f=0;else if(d=ye(l|0,A|0,52)|0,z()|0,d=d&15,!d)f=1;else{f=1;t:for(;;){switch(y=ye(l|0,A|0,(15-f|0)*3|0)|0,z()|0,y&7){case 1:break t;case 0:break;default:{f=1;break e}}if(f>>>0<d>>>0)f=f+1|0;else{f=1;break e}}for(f=1;;)if(g=(15-f|0)*3|0,m=Te(7,0,g|0)|0,y=A&~(z()|0),A=ye(l|0,A|0,g|0)|0,z()|0,A=Te(hs(A&7)|0,0,g|0)|0,l=l&~m|A,A=y|(z()|0),f>>>0<d>>>0)f=f+1|0;else{f=1;break}}while(0);if(w>>>0<x>>>0)w=w+1|0;else break}return qe(A|0),l|0}function tp(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0;if(d=ye(l|0,A|0,52)|0,z()|0,d=d&15,!d)return f=A,d=l,qe(f|0),d|0;for(f=1;y=(15-f|0)*3|0,m=Te(7,0,y|0)|0,g=A&~(z()|0),A=ye(l|0,A|0,y|0)|0,z()|0,A=Te(hs(A&7)|0,0,y|0)|0,l=A|l&~m,A=z()|0|g,f>>>0<d>>>0;)f=f+1|0;return qe(A|0),l|0}function Y6(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(x=B,B=B+64|0,w=x+40|0,d=x+24|0,g=x+12|0,m=x,Te(A|0,0,52)|0,f=z()|0|134225919,!A)return(c[l+4>>2]|0)>2||(c[l+8>>2]|0)>2||(c[l+12>>2]|0)>2?(y=0,w=0,qe(y|0),B=x,w|0):(Te(ov(l)|0,0,45)|0,y=z()|0|f,w=-1,qe(y|0),B=x,w|0);if(c[w>>2]=c[l>>2],c[w+4>>2]=c[l+4>>2],c[w+8>>2]=c[l+8>>2],c[w+12>>2]=c[l+12>>2],y=w+4|0,(A|0)>0)for(l=-1;c[d>>2]=c[y>>2],c[d+4>>2]=c[y+4>>2],c[d+8>>2]=c[y+8>>2],A&1?(E6(y),c[g>>2]=c[y>>2],c[g+4>>2]=c[y+4>>2],c[g+8>>2]=c[y+8>>2],Cu(g)):(hv(y),c[g>>2]=c[y>>2],c[g+4>>2]=c[y+4>>2],c[g+8>>2]=c[y+8>>2],yo(g)),Qd(d,g,m),Pn(m),C=(15-A|0)*3|0,T=Te(7,0,C|0)|0,f=f&~(z()|0),C=Te(Su(m)|0,0,C|0)|0,l=C|l&~T,f=z()|0|f,(A|0)>1;)A=A+-1|0;else l=-1;e:do if((c[y>>2]|0)<=2&&(c[w+8>>2]|0)<=2&&(c[w+12>>2]|0)<=2){if(d=ov(w)|0,A=Te(d|0,0,45)|0,A=A|l,l=z()|0|f&-1040385,m=u6(w)|0,!(It(d)|0)){if((m|0)<=0)break;for(g=0;;){if(d=ye(A|0,l|0,52)|0,z()|0,d=d&15,d)for(f=1;C=(15-f|0)*3|0,w=ye(A|0,l|0,C|0)|0,z()|0,T=Te(7,0,C|0)|0,l=l&~(z()|0),C=Te(vo(w&7)|0,0,C|0)|0,A=A&~T|C,l=l|(z()|0),f>>>0<d>>>0;)f=f+1|0;if(g=g+1|0,(g|0)==(m|0))break e}}g=ye(A|0,l|0,52)|0,z()|0,g=g&15;t:do if(g){f=1;n:for(;;){switch(C=ye(A|0,l|0,(15-f|0)*3|0)|0,z()|0,C&7){case 1:break n;case 0:break;default:break t}if(f>>>0<g>>>0)f=f+1|0;else break t}if(av(d,c[w>>2]|0)|0)for(f=1;w=(15-f|0)*3|0,T=Te(7,0,w|0)|0,C=l&~(z()|0),l=ye(A|0,l|0,w|0)|0,z()|0,l=Te(hs(l&7)|0,0,w|0)|0,A=A&~T|l,l=C|(z()|0),f>>>0<g>>>0;)f=f+1|0;else for(f=1;C=(15-f|0)*3|0,w=ye(A|0,l|0,C|0)|0,z()|0,T=Te(7,0,C|0)|0,l=l&~(z()|0),C=Te(vo(w&7)|0,0,C|0)|0,A=A&~T|C,l=l|(z()|0),f>>>0<g>>>0;)f=f+1|0}while(0);if((m|0)>0){f=0;do A=ep(A,l)|0,l=z()|0,f=f+1|0;while((f|0)!=(m|0))}}else A=0,l=0;while(0);return T=l,C=A,qe(T|0),B=x,C|0}function Er(l){return l=l|0,(l|0)%2|0|0}function np(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0;return g=B,B=B+16|0,d=g,A>>>0>15?(d=4,B=g,d|0):(c[l+4>>2]&2146435072|0)==2146435072||(c[l+8+4>>2]&2146435072|0)==2146435072?(d=3,B=g,d|0):(B6(l,A,d),A=Y6(d,A)|0,d=z()|0,c[f>>2]=A,c[f+4>>2]=d,(A|0)==0&(d|0)==0&&je(27795,27122,959,27145),d=0,B=g,d|0)}function rp(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0;if(g=f+4|0,m=ye(l|0,A|0,52)|0,z()|0,m=m&15,y=ye(l|0,A|0,45)|0,z()|0,d=(m|0)==0,It(y&127)|0){if(d)return y=1,y|0;d=1}else{if(d)return y=0,y|0;!(c[g>>2]|0)&&!(c[f+8>>2]|0)?d=(c[f+12>>2]|0)!=0&1:d=1}for(f=1;f&1?Cu(g):yo(g),y=ye(l|0,A|0,(15-f|0)*3|0)|0,z()|0,dv(g,y&7),f>>>0<m>>>0;)f=f+1|0;return d|0}function wa(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(C=B,B=B+16|0,x=C,T=ye(l|0,A|0,45)|0,z()|0,T=T&127,T>>>0>121)return c[f>>2]=0,c[f+4>>2]=0,c[f+8>>2]=0,c[f+12>>2]=0,T=5,B=C,T|0;e:do if(It(T)|0&&(m=ye(l|0,A|0,52)|0,z()|0,m=m&15,(m|0)!=0)){d=1;t:for(;;){switch(w=ye(l|0,A|0,(15-d|0)*3|0)|0,z()|0,w&7){case 5:break t;case 0:break;default:{d=A;break e}}if(d>>>0<m>>>0)d=d+1|0;else{d=A;break e}}for(g=1,d=A;A=(15-g|0)*3|0,y=Te(7,0,A|0)|0,w=d&~(z()|0),d=ye(l|0,d|0,A|0)|0,z()|0,d=Te(hs(d&7)|0,0,A|0)|0,l=l&~y|d,d=w|(z()|0),g>>>0<m>>>0;)g=g+1|0}else d=A;while(0);if(w=7696+(T*28|0)|0,c[f>>2]=c[w>>2],c[f+4>>2]=c[w+4>>2],c[f+8>>2]=c[w+8>>2],c[f+12>>2]=c[w+12>>2],!(rp(l,d,f)|0))return T=0,B=C,T|0;if(y=f+4|0,c[x>>2]=c[y>>2],c[x+4>>2]=c[y+4>>2],c[x+8>>2]=c[y+8>>2],m=ye(l|0,d|0,52)|0,z()|0,w=m&15,m&1?(yo(y),m=w+1|0):m=w,!(It(T)|0))d=0;else{e:do if(!w)d=0;else for(A=1;;){if(g=ye(l|0,d|0,(15-A|0)*3|0)|0,z()|0,g=g&7,g|0){d=g;break e}if(A>>>0<w>>>0)A=A+1|0;else{d=0;break}}while(0);d=(d|0)==4&1}if(!(va(f,m,d,0)|0))(m|0)!=(w|0)&&(c[y>>2]=c[x>>2],c[y+4>>2]=c[x+4>>2],c[y+8>>2]=c[x+8>>2]);else{if(It(T)|0)do;while(va(f,m,0,0)|0);(m|0)!=(w|0)&&hv(y)}return T=0,B=C,T|0}function bo(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;return m=B,B=B+16|0,d=m,g=wa(l,A,d)|0,g|0?(B=m,g|0):(g=ye(l|0,A|0,52)|0,z()|0,U6(d,g&15,f),g=0,B=m,g|0)}function ba(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0;if(y=B,B=B+16|0,m=y,d=wa(l,A,m)|0,d|0)return m=d,B=y,m|0;d=ye(l|0,A|0,45)|0,z()|0,d=(It(d&127)|0)==0,g=ye(l|0,A|0,52)|0,z()|0,g=g&15;e:do if(!d){if(g|0)for(d=1;;){if(w=Te(7,0,(15-d|0)*3|0)|0,!((w&l|0)==0&((z()|0)&A|0)==0))break e;if(d>>>0<g>>>0)d=d+1|0;else break}return qd(m,g,0,5,f),w=0,B=y,w|0}while(0);return Zd(m,g,0,6,f),w=0,B=y,w|0}function q6(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;if(g=ye(l|0,A|0,45)|0,z()|0,!(It(g&127)|0))return g=2,c[f>>2]=g,0;if(g=ye(l|0,A|0,52)|0,z()|0,g=g&15,!g)return g=5,c[f>>2]=g,0;for(d=1;;){if(m=Te(7,0,(15-d|0)*3|0)|0,!((m&l|0)==0&((z()|0)&A|0)==0)){d=2,l=6;break}if(d>>>0<g>>>0)d=d+1|0;else{d=5,l=6;break}}return(l|0)==6&&(c[f>>2]=d),0}function Tv(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0;F=B,B=B+128|0,T=F+112|0,m=F+96|0,C=F,g=ye(l|0,A|0,52)|0,z()|0,w=g&15,c[T>>2]=w,y=ye(l|0,A|0,45)|0,z()|0,y=y&127;e:do if(It(y)|0){if(w|0)for(d=1;;){if(x=Te(7,0,(15-d|0)*3|0)|0,!((x&l|0)==0&((z()|0)&A|0)==0)){g=0;break e}if(d>>>0<w>>>0)d=d+1|0;else break}if(g&1)g=1;else return x=Te(w+1|0,0,52)|0,C=z()|0|A&-15728641,T=Te(7,0,(14-w|0)*3|0)|0,C=Tv((x|l)&~T,C&~(z()|0),f)|0,B=F,C|0}else g=0;while(0);if(d=wa(l,A,m)|0,!d){g?(yv(m,T,C),x=5):(vv(m,T,C),x=6);e:do if(It(y)|0)if(!w)l=5;else for(d=1;;){if(y=Te(7,0,(15-d|0)*3|0)|0,!((y&l|0)==0&((z()|0)&A|0)==0)){l=2;break e}if(d>>>0<w>>>0)d=d+1|0;else{l=5;break}}else l=2;while(0);ms(f|0,-1,l<<2|0)|0;e:do if(g)for(m=0;;){if(y=C+(m<<4)|0,z6(y,c[T>>2]|0)|0,y=c[y>>2]|0,w=c[f>>2]|0,(w|0)==-1|(w|0)==(y|0))d=f;else{g=0;do{if(g=g+1|0,g>>>0>=l>>>0){d=1;break e}d=f+(g<<2)|0,w=c[d>>2]|0}while(!((w|0)==-1|(w|0)==(y|0)))}if(c[d>>2]=y,m=m+1|0,m>>>0>=x>>>0){d=0;break}}else for(m=0;;){if(y=C+(m<<4)|0,va(y,c[T>>2]|0,0,1)|0,y=c[y>>2]|0,w=c[f>>2]|0,(w|0)==-1|(w|0)==(y|0))d=f;else{g=0;do{if(g=g+1|0,g>>>0>=l>>>0){d=1;break e}d=f+(g<<2)|0,w=c[d>>2]|0}while(!((w|0)==-1|(w|0)==(y|0)))}if(c[d>>2]=y,m=m+1|0,m>>>0>=x>>>0){d=0;break}}while(0)}return C=d,B=F,C|0}function Z6(){return 12}function ip(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0;if(l>>>0>15)return w=4,w|0;if(Te(l|0,0,52)|0,w=z()|0|134225919,!l){f=0,d=0;do It(d)|0&&(Te(d|0,0,45)|0,y=w|(z()|0),l=A+(f<<3)|0,c[l>>2]=-1,c[l+4>>2]=y,f=f+1|0),d=d+1|0;while((d|0)!=122);return f=0,f|0}f=0,y=0;do{if(It(y)|0){for(Te(y|0,0,45)|0,d=1,g=-1,m=w|(z()|0);x=Te(7,0,(15-d|0)*3|0)|0,g=g&~x,m=m&~(z()|0),(d|0)!=(l|0);)d=d+1|0;x=A+(f<<3)|0,c[x>>2]=g,c[x+4>>2]=m,f=f+1|0}y=y+1|0}while((y|0)!=122);return f=0,f|0}function K6(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0;if(Ae=B,B=B+16|0,ne=Ae,pe=ye(l|0,A|0,52)|0,z()|0,pe=pe&15,f>>>0>15)return pe=4,B=Ae,pe|0;if((pe|0)<(f|0))return pe=12,B=Ae,pe|0;if((pe|0)!=(f|0))if(m=Te(f|0,0,52)|0,m=m|l,w=z()|0|A&-15728641,(pe|0)>(f|0)){x=f;do J=Te(7,0,(14-x|0)*3|0)|0,x=x+1|0,m=J|m,w=z()|0|w;while((x|0)<(pe|0));J=m}else J=m;else J=l,w=A;X=ye(J|0,w|0,45)|0,z()|0;e:do if(It(X&127)|0){if(x=ye(J|0,w|0,52)|0,z()|0,x=x&15,x|0)for(m=1;;){if(X=Te(7,0,(15-m|0)*3|0)|0,!((X&J|0)==0&((z()|0)&w|0)==0)){T=33;break e}if(m>>>0<x>>>0)m=m+1|0;else break}if(X=d,c[X>>2]=0,c[X+4>>2]=0,(pe|0)>(f|0)){for(X=A&-15728641,H=pe;;){if(j=H,H=H+-1|0,H>>>0>15|(pe|0)<(H|0)){T=19;break}if((pe|0)!=(H|0))if(m=Te(H|0,0,52)|0,m=m|l,x=z()|0|X,(pe|0)<(j|0))F=m;else{T=H;do F=Te(7,0,(14-T|0)*3|0)|0,T=T+1|0,m=F|m,x=z()|0|x;while((T|0)<(pe|0));F=m}else F=l,x=A;if(C=ye(F|0,x|0,45)|0,z()|0,!(It(C&127)|0))m=0;else{C=ye(F|0,x|0,52)|0,z()|0,C=C&15;t:do if(!C)m=0;else for(T=1;;){if(m=ye(F|0,x|0,(15-T|0)*3|0)|0,z()|0,m=m&7,m|0)break t;if(T>>>0<C>>>0)T=T+1|0;else{m=0;break}}while(0);m=(m|0)==0&1}if(x=ye(l|0,A|0,(15-j|0)*3|0)|0,z()|0,x=x&7,(x|0)==7){g=5,T=42;break}if(m=(m|0)!=0,(x|0)==1&m){g=5,T=42;break}if(F=x+(((x|0)!=0&m)<<31>>31)|0,F|0&&(T=pe-j|0,T=ds(7,0,T,((T|0)<0)<<31>>31)|0,C=z()|0,m?(m=un(T|0,C|0,5,0)|0,m=Fe(m|0,z()|0,-5,-1)|0,m=gs(m|0,z()|0,6,0)|0,m=Fe(m|0,z()|0,1,0)|0,x=z()|0):(m=T,x=C),j=F+-1|0,j=un(T|0,C|0,j|0,((j|0)<0)<<31>>31|0)|0,j=Fe(m|0,x|0,j|0,z()|0)|0,F=z()|0,C=d,C=Fe(j|0,F|0,c[C>>2]|0,c[C+4>>2]|0)|0,F=z()|0,j=d,c[j>>2]=C,c[j+4>>2]=F),(H|0)<=(f|0)){T=37;break}}if((T|0)==19)je(27795,27122,1276,27158);else if((T|0)==37){y=d,g=c[y+4>>2]|0,y=c[y>>2]|0;break}else if((T|0)==42)return B=Ae,g|0}else g=0,y=0}else T=33;while(0);e:do if((T|0)==33)if(X=d,c[X>>2]=0,c[X+4>>2]=0,(pe|0)>(f|0)){for(m=pe;;){if(g=ye(l|0,A|0,(15-m|0)*3|0)|0,z()|0,g=g&7,(g|0)==7){g=5;break}if(y=pe-m|0,y=ds(7,0,y,((y|0)<0)<<31>>31)|0,g=un(y|0,z()|0,g|0,0)|0,y=z()|0,X=d,y=Fe(c[X>>2]|0,c[X+4>>2]|0,g|0,y|0)|0,g=z()|0,X=d,c[X>>2]=y,c[X+4>>2]=g,m=m+-1|0,(m|0)<=(f|0))break e}return B=Ae,g|0}else g=0,y=0;while(0);return sc(J,w,pe,ne)|0&&je(27795,27122,1236,27173),pe=ne,ne=c[pe+4>>2]|0,((g|0)>-1|(g|0)==-1&y>>>0>4294967295)&((ne|0)>(g|0)|((ne|0)==(g|0)?(c[pe>>2]|0)>>>0>y>>>0:0))?(pe=0,B=Ae,pe|0):(je(27795,27122,1316,27158),0)}function G6(l,A,f,d,g,m){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0,m=m|0;var y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0;if(F=B,B=B+16|0,y=F,g>>>0>15)return m=4,B=F,m|0;if(w=ye(f|0,d|0,52)|0,z()|0,w=w&15,(w|0)>(g|0))return m=12,B=F,m|0;if(sc(f,d,g,y)|0&&je(27795,27122,1236,27173),C=y,T=c[C+4>>2]|0,!(((A|0)>-1|(A|0)==-1&l>>>0>4294967295)&((T|0)>(A|0)|((T|0)==(A|0)?(c[C>>2]|0)>>>0>l>>>0:0))))return m=2,B=F,m|0;C=g-w|0,g=Te(g|0,0,52)|0,x=z()|0|d&-15728641,T=m,c[T>>2]=g|f,c[T+4>>2]=x,T=ye(f|0,d|0,45)|0,z()|0;e:do if(It(T&127)|0){if(w|0)for(y=1;;){if(T=Te(7,0,(15-y|0)*3|0)|0,!((T&f|0)==0&((z()|0)&d|0)==0))break e;if(y>>>0<w>>>0)y=y+1|0;else break}if((C|0)<1)return m=0,B=F,m|0;for(T=w^15,d=-1,x=1,y=1;;){w=C-x|0,w=ds(7,0,w,((w|0)<0)<<31>>31)|0,f=z()|0;do if(y)if(y=un(w|0,f|0,5,0)|0,y=Fe(y|0,z()|0,-5,-1)|0,y=gs(y|0,z()|0,6,0)|0,g=z()|0,(A|0)>(g|0)|(A|0)==(g|0)&l>>>0>y>>>0){A=Fe(l|0,A|0,-1,-1)|0,A=_n(A|0,z()|0,y|0,g|0)|0,y=z()|0,j=m,X=c[j>>2]|0,j=c[j+4>>2]|0,J=(T+d|0)*3|0,H=Te(7,0,J|0)|0,j=j&~(z()|0),d=gs(A|0,y|0,w|0,f|0)|0,l=z()|0,g=Fe(d|0,l|0,2,0)|0,J=Te(g|0,z()|0,J|0)|0,j=z()|0|j,g=m,c[g>>2]=J|X&~H,c[g+4>>2]=j,l=un(d|0,l|0,w|0,f|0)|0,l=_n(A|0,y|0,l|0,z()|0)|0,y=0,A=z()|0;break}else{J=m,H=c[J>>2]|0,J=c[J+4>>2]|0,X=Te(7,0,(T+d|0)*3|0)|0,J=J&~(z()|0),y=m,c[y>>2]=H&~X,c[y+4>>2]=J,y=1;break}else H=m,g=c[H>>2]|0,H=c[H+4>>2]|0,d=(T+d|0)*3|0,j=Te(7,0,d|0)|0,H=H&~(z()|0),J=gs(l|0,A|0,w|0,f|0)|0,y=z()|0,d=Te(J|0,y|0,d|0)|0,H=z()|0|H,X=m,c[X>>2]=d|g&~j,c[X+4>>2]=H,y=un(J|0,y|0,w|0,f|0)|0,l=_n(l|0,A|0,y|0,z()|0)|0,y=0,A=z()|0;while(0);if((C|0)>(x|0))d=~x,x=x+1|0;else{A=0;break}}return B=F,A|0}while(0);if((C|0)<1)return J=0,B=F,J|0;for(g=w^15,y=1;;)if(X=C-y|0,X=ds(7,0,X,((X|0)<0)<<31>>31)|0,J=z()|0,x=m,f=c[x>>2]|0,x=c[x+4>>2]|0,w=(g-y|0)*3|0,d=Te(7,0,w|0)|0,x=x&~(z()|0),j=gs(l|0,A|0,X|0,J|0)|0,H=z()|0,w=Te(j|0,H|0,w|0)|0,x=z()|0|x,T=m,c[T>>2]=w|f&~d,c[T+4>>2]=x,J=un(j|0,H|0,X|0,J|0)|0,l=_n(l|0,A|0,J|0,z()|0)|0,A=z()|0,(C|0)<=(y|0)){A=0;break}else y=y+1|0;return B=F,A|0}function sp(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0;g=ye(A|0,f|0,52)|0,z()|0,g=g&15,(A|0)==0&(f|0)==0|((d|0)>15|(g|0)>(d|0))?(m=-1,A=-1,f=0,g=0):(A=bv(A,f,g+1|0,d)|0,y=(z()|0)&-15728641,f=Te(d|0,0,52)|0,f=A|f,y=y|(z()|0),A=(Et(f,y)|0)==0,m=g,A=A?-1:d,g=y),y=l,c[y>>2]=f,c[y+4>>2]=g,c[l+8>>2]=m,c[l+12>>2]=A}function Ev(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0;if(g=ye(l|0,A|0,52)|0,z()|0,g=g&15,m=d+8|0,c[m>>2]=g,(l|0)==0&(A|0)==0|((f|0)>15|(g|0)>(f|0))){f=d,c[f>>2]=0,c[f+4>>2]=0,c[m>>2]=-1,c[d+12>>2]=-1;return}if(l=bv(l,A,g+1|0,f)|0,m=(z()|0)&-15728641,g=Te(f|0,0,52)|0,g=l|g,m=m|(z()|0),l=d,c[l>>2]=g,c[l+4>>2]=m,l=d+12|0,Et(g,m)|0){c[l>>2]=f;return}else{c[l>>2]=-1;return}}function op(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0;if(f=l,A=c[f>>2]|0,f=c[f+4>>2]|0,!((A|0)==0&(f|0)==0)&&(d=ye(A|0,f|0,52)|0,z()|0,d=d&15,w=Te(1,0,(d^15)*3|0)|0,A=Fe(w|0,z()|0,A|0,f|0)|0,f=z()|0,w=l,c[w>>2]=A,c[w+4>>2]=f,w=l+8|0,y=c[w>>2]|0,!((d|0)<(y|0)))){for(x=l+12|0,m=d;;){if((m|0)==(y|0)){d=5;break}if(T=(m|0)==(c[x>>2]|0),g=(15-m|0)*3|0,d=ye(A|0,f|0,g|0)|0,z()|0,d=d&7,T&((d|0)==1&!0)){d=7;break}if(!((d|0)==7&!0)){d=10;break}if(T=Te(1,0,g|0)|0,A=Fe(A|0,f|0,T|0,z()|0)|0,f=z()|0,T=l,c[T>>2]=A,c[T+4>>2]=f,(m|0)>(y|0))m=m+-1|0;else{d=10;break}}if((d|0)==5){T=l,c[T>>2]=0,c[T+4>>2]=0,c[w>>2]=-1,c[x>>2]=-1;return}else if((d|0)==7){y=Te(1,0,g|0)|0,y=Fe(A|0,f|0,y|0,z()|0)|0,w=z()|0,T=l,c[T>>2]=y,c[T+4>>2]=w,c[x>>2]=m+-1;return}else if((d|0)==10)return}}function oc(l){l=+l;var A=0;return A=l<0?l+6.283185307179586:l,+(l>=6.283185307179586?A+-6.283185307179586:A)}function xa(l,A){return l=l|0,A=A|0,+tt(+(+N[l>>3]-+N[A>>3]))<17453292519943298e-27?(A=+tt(+(+N[l+8>>3]-+N[A+8>>3]))<17453292519943298e-27,A|0):(A=0,A|0)}function cr(l,A){switch(l=+l,A=A|0,A|0){case 1:{l=l<0?l+6.283185307179586:l;break}case 2:{l=l>0?l+-6.283185307179586:l;break}}return+l}function J6(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0;return g=+N[A>>3],d=+N[l>>3],m=+nt(+((g-d)*.5)),f=+nt(+((+N[A+8>>3]-+N[l+8>>3])*.5)),f=m*m+f*(+ht(+g)*+ht(+d)*f),+(+Tr(+ +At(+f),+ +At(+(1-f)))*2)}function ac(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0;return g=+N[A>>3],d=+N[l>>3],m=+nt(+((g-d)*.5)),f=+nt(+((+N[A+8>>3]-+N[l+8>>3])*.5)),f=m*m+f*(+ht(+g)*+ht(+d)*f),+(+Tr(+ +At(+f),+ +At(+(1-f)))*2*6371.007180918475)}function e8(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0;return g=+N[A>>3],d=+N[l>>3],m=+nt(+((g-d)*.5)),f=+nt(+((+N[A+8>>3]-+N[l+8>>3])*.5)),f=m*m+f*(+ht(+g)*+ht(+d)*f),+(+Tr(+ +At(+f),+ +At(+(1-f)))*2*6371.007180918475*1e3)}function t8(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0;return m=+N[A>>3],d=+ht(+m),g=+N[A+8>>3]-+N[l+8>>3],y=d*+nt(+g),f=+N[l>>3],+ +Tr(+y,+(+nt(+m)*+ht(+f)-+ht(+g)*(d*+nt(+f))))}function n8(l,A,f,d){l=l|0,A=+A,f=+f,d=d|0;var g=0,m=0,y=0,w=0;if(f<1e-16){c[d>>2]=c[l>>2],c[d+4>>2]=c[l+4>>2],c[d+8>>2]=c[l+8>>2],c[d+12>>2]=c[l+12>>2];return}m=A<0?A+6.283185307179586:A,m=A>=6.283185307179586?m+-6.283185307179586:m;do if(m<1e-16)A=+N[l>>3]+f,N[d>>3]=A,g=d;else{if(g=+tt(+(m+-3.141592653589793))<1e-16,A=+N[l>>3],g){A=A-f,N[d>>3]=A,g=d;break}if(y=+ht(+f),f=+nt(+f),A=y*+nt(+A)+ +ht(+m)*(f*+ht(+A)),A=A>1?1:A,A=+QM(+(A<-1?-1:A)),N[d>>3]=A,+tt(+(A+-1.5707963267948966))<1e-16){N[d>>3]=1.5707963267948966,N[d+8>>3]=0;return}if(+tt(+(A+1.5707963267948966))<1e-16){N[d>>3]=-1.5707963267948966,N[d+8>>3]=0;return}if(w=1/+ht(+A),m=f*+nt(+m)*w,f=+N[l>>3],A=w*((y-+nt(+A)*+nt(+f))/+ht(+f)),y=m>1?1:m,A=A>1?1:A,A=+N[l+8>>3]+ +Tr(+(y<-1?-1:y),+(A<-1?-1:A)),A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);N[d+8>>3]=A;return}while(0);if(+tt(+(A+-1.5707963267948966))<1e-16){N[g>>3]=1.5707963267948966,N[d+8>>3]=0;return}if(+tt(+(A+1.5707963267948966))<1e-16){N[g>>3]=-1.5707963267948966,N[d+8>>3]=0;return}if(A=+N[l+8>>3],A>3.141592653589793)do A=A+-6.283185307179586;while(A>3.141592653589793);if(A<-3.141592653589793)do A=A+6.283185307179586;while(A<-3.141592653589793);N[d+8>>3]=A}function Sv(l,A){return l=l|0,A=A|0,l>>>0>15?(A=4,A|0):(N[A>>3]=+N[20656+(l<<3)>>3],A=0,A|0)}function r8(l,A){return l=l|0,A=A|0,l>>>0>15?(A=4,A|0):(N[A>>3]=+N[20784+(l<<3)>>3],A=0,A|0)}function i8(l,A){return l=l|0,A=A|0,l>>>0>15?(A=4,A|0):(N[A>>3]=+N[20912+(l<<3)>>3],A=0,A|0)}function s8(l,A){return l=l|0,A=A|0,l>>>0>15?(A=4,A|0):(N[A>>3]=+N[21040+(l<<3)>>3],A=0,A|0)}function ku(l,A){l=l|0,A=A|0;var f=0;return l>>>0>15?(A=4,A|0):(f=ds(7,0,l,((l|0)<0)<<31>>31)|0,f=un(f|0,z()|0,120,0)|0,l=z()|0,c[A>>2]=f|2,c[A+4>>2]=l,A=0,A|0)}function Cv(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0;return j=+N[A>>3],C=+N[l>>3],x=+nt(+((j-C)*.5)),m=+N[A+8>>3],T=+N[l+8>>3],y=+nt(+((m-T)*.5)),w=+ht(+C),F=+ht(+j),y=x*x+y*(F*w*y),y=+Tr(+ +At(+y),+ +At(+(1-y)))*2,x=+N[f>>3],j=+nt(+((x-j)*.5)),d=+N[f+8>>3],m=+nt(+((d-m)*.5)),g=+ht(+x),m=j*j+m*(F*g*m),m=+Tr(+ +At(+m),+ +At(+(1-m)))*2,x=+nt(+((C-x)*.5)),d=+nt(+((T-d)*.5)),d=x*x+d*(w*g*d),d=+Tr(+ +At(+d),+ +At(+(1-d)))*2,g=(y+m+d)*.5,+(+Ud(+ +At(+(+xr(+(g*.5))*+xr(+((g-y)*.5))*+xr(+((g-m)*.5))*+xr(+((g-d)*.5)))))*4)}function ap(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0;if(w=B,B=B+192|0,m=w+168|0,y=w,g=bo(l,A,m)|0,g|0)return f=g,B=w,f|0;if(ba(l,A,y)|0&&je(27795,27190,415,27199),A=c[y>>2]|0,(A|0)>0){if(d=+Cv(y+8|0,y+8+(((A|0)!=1&1)<<4)|0,m)+0,(A|0)!=1){l=1;do g=l,l=l+1|0,d=d+ +Cv(y+8+(g<<4)|0,y+8+(((l|0)%(A|0)|0)<<4)|0,m);while((l|0)<(A|0))}}else d=0;return N[f>>3]=d,f=0,B=w,f|0}function o8(l,A,f){return l=l|0,A=A|0,f=f|0,l=ap(l,A,f)|0,l|0||(N[f>>3]=+N[f>>3]*6371.007180918475*6371.007180918475),l|0}function a8(l,A,f){return l=l|0,A=A|0,f=f|0,l=ap(l,A,f)|0,l|0||(N[f>>3]=+N[f>>3]*6371.007180918475*6371.007180918475*1e3*1e3),l|0}function l8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(w=B,B=B+176|0,y=w,l=Ru(l,A,y)|0,l|0)return y=l,B=w,y|0;if(N[f>>3]=0,l=c[y>>2]|0,(l|0)<=1)return y=0,B=w,y|0;A=l+-1|0,l=0,d=+N[y+8>>3],g=+N[y+16>>3],m=0;do l=l+1|0,T=d,d=+N[y+8+(l<<4)>>3],C=+nt(+((d-T)*.5)),x=g,g=+N[y+8+(l<<4)+8>>3],x=+nt(+((g-x)*.5)),x=C*C+x*(+ht(+d)*+ht(+T)*x),m=m+ +Tr(+ +At(+x),+ +At(+(1-x)))*2;while((l|0)<(A|0));return N[f>>3]=m,y=0,B=w,y|0}function c8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(w=B,B=B+176|0,y=w,l=Ru(l,A,y)|0,l|0)return y=l,m=+N[f>>3],m=m*6371.007180918475,N[f>>3]=m,B=w,y|0;if(N[f>>3]=0,l=c[y>>2]|0,(l|0)<=1)return y=0,m=0,m=m*6371.007180918475,N[f>>3]=m,B=w,y|0;A=l+-1|0,l=0,d=+N[y+8>>3],g=+N[y+16>>3],m=0;do l=l+1|0,T=d,d=+N[y+8+(l<<4)>>3],C=+nt(+((d-T)*.5)),x=g,g=+N[y+8+(l<<4)+8>>3],x=+nt(+((g-x)*.5)),x=C*C+x*(+ht(+T)*+ht(+d)*x),m=m+ +Tr(+ +At(+x),+ +At(+(1-x)))*2;while((l|0)!=(A|0));return N[f>>3]=m,y=0,C=m,C=C*6371.007180918475,N[f>>3]=C,B=w,y|0}function A8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(w=B,B=B+176|0,y=w,l=Ru(l,A,y)|0,l|0)return y=l,m=+N[f>>3],m=m*6371.007180918475,m=m*1e3,N[f>>3]=m,B=w,y|0;if(N[f>>3]=0,l=c[y>>2]|0,(l|0)<=1)return y=0,m=0,m=m*6371.007180918475,m=m*1e3,N[f>>3]=m,B=w,y|0;A=l+-1|0,l=0,d=+N[y+8>>3],g=+N[y+16>>3],m=0;do l=l+1|0,T=d,d=+N[y+8+(l<<4)>>3],C=+nt(+((d-T)*.5)),x=g,g=+N[y+8+(l<<4)+8>>3],x=+nt(+((g-x)*.5)),x=C*C+x*(+ht(+T)*+ht(+d)*x),m=m+ +Tr(+ +At(+x),+ +At(+(1-x)))*2;while((l|0)!=(A|0));return N[f>>3]=m,y=0,C=m,C=C*6371.007180918475,C=C*1e3,N[f>>3]=C,B=w,y|0}function u8(l){l=l|0;var A=0,f=0,d=0;return A=Gn(1,12)|0,A||je(27280,27235,49,27293),f=l+4|0,d=c[f>>2]|0,d|0?(d=d+8|0,c[d>>2]=A,c[f>>2]=A,A|0):(c[l>>2]|0&&je(27310,27235,61,27333),d=l,c[d>>2]=A,c[f>>2]=A,A|0)}function f8(l,A){l=l|0,A=A|0;var f=0,d=0;return d=hi(24)|0,d||je(27347,27235,78,27361),c[d>>2]=c[A>>2],c[d+4>>2]=c[A+4>>2],c[d+8>>2]=c[A+8>>2],c[d+12>>2]=c[A+12>>2],c[d+16>>2]=0,A=l+4|0,f=c[A>>2]|0,f|0?(c[f+16>>2]=d,c[A>>2]=d,d|0):(c[l>>2]|0&&je(27376,27235,82,27361),c[l>>2]=d,c[A>>2]=d,d|0)}function Pv(l){l=l|0;var A=0,f=0,d=0,g=0;if(l)for(d=1;;){if(A=c[l>>2]|0,A|0)do{if(f=c[A>>2]|0,f|0)do g=f,f=c[f+16>>2]|0,Ue(g);while(f|0);g=A,A=c[A+8>>2]|0,Ue(g)}while(A|0);if(A=l,l=c[l+8>>2]|0,d||Ue(A),l)d=0;else break}}function h8(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0,Ze=0,rt=0,$e=0,Le=0,we=0,Ge=0,bt=0,Ke=0;if(g=l+8|0,c[g>>2]|0)return Ke=1,Ke|0;if(d=c[l>>2]|0,!d)return Ke=0,Ke|0;A=d,f=0;do f=f+1|0,A=c[A+8>>2]|0;while(A|0);if(f>>>0<2)return Ke=0,Ke|0;Ge=hi(f<<2)|0,Ge||je(27396,27235,317,27415),we=hi(f<<5)|0,we||je(27437,27235,321,27415),c[l>>2]=0,Be=l+4|0,c[Be>>2]=0,c[g>>2]=0,f=0,Le=0,xe=0,F=0;e:for(;;){if(C=c[d>>2]|0,C){m=0,y=C;do{if(x=+N[y+8>>3],A=y,y=c[y+16>>2]|0,T=(y|0)==0,g=T?C:y,w=+N[g+8>>3],+tt(+(x-w))>3.141592653589793){Ke=14;break}m=m+(w-x)*(+N[A>>3]+ +N[g>>3])}while(!T);if((Ke|0)==14){Ke=0,m=0,A=C;do te=+N[A+8>>3],$e=A+16|0,rt=c[$e>>2]|0,rt=rt|0?rt:C,ae=+N[rt+8>>3],m=m+(+N[A>>3]+ +N[rt>>3])*((ae<0?ae+6.283185307179586:ae)-(te<0?te+6.283185307179586:te)),A=c[(A|0?$e:d)>>2]|0;while(A|0)}m>0?(c[Ge+(Le<<2)>>2]=d,Le=Le+1|0,g=xe,A=F):Ke=19}else Ke=19;if((Ke|0)==19){Ke=0;do if(f){if(A=f+8|0,c[A>>2]|0){Ke=21;break e}if(f=Gn(1,12)|0,!f){Ke=23;break e}c[A>>2]=f,g=f+4|0,y=f,A=F}else if(F){g=Be,y=F+8|0,A=d,f=l;break}else if(c[l>>2]|0){Ke=27;break e}else{g=Be,y=l,A=d,f=l;break}while(0);if(c[y>>2]=d,c[g>>2]=d,y=we+(xe<<5)|0,T=c[d>>2]|0,T){for(C=we+(xe<<5)+8|0,N[C>>3]=17976931348623157e292,F=we+(xe<<5)+24|0,N[F>>3]=17976931348623157e292,N[y>>3]=-17976931348623157e292,j=we+(xe<<5)+16|0,N[j>>3]=-17976931348623157e292,pe=17976931348623157e292,Ae=-17976931348623157e292,g=0,H=T,x=17976931348623157e292,J=17976931348623157e292,ne=-17976931348623157e292,w=-17976931348623157e292;m=+N[H>>3],te=+N[H+8>>3],H=c[H+16>>2]|0,X=(H|0)==0,ae=+N[(X?T:H)+8>>3],m<x&&(N[C>>3]=m,x=m),te<J&&(N[F>>3]=te,J=te),m>ne?N[y>>3]=m:m=ne,te>w&&(N[j>>3]=te,w=te),pe=te>0&te<pe?te:pe,Ae=te<0&te>Ae?te:Ae,g=g|+tt(+(te-ae))>3.141592653589793,!X;)ne=m;g&&(N[j>>3]=Ae,N[F>>3]=pe)}else c[y>>2]=0,c[y+4>>2]=0,c[y+8>>2]=0,c[y+12>>2]=0,c[y+16>>2]=0,c[y+20>>2]=0,c[y+24>>2]=0,c[y+28>>2]=0;g=xe+1|0}if($e=d+8|0,d=c[$e>>2]|0,c[$e>>2]=0,d)xe=g,F=A;else{Ke=45;break}}if((Ke|0)==21)je(27213,27235,35,27247);else if((Ke|0)==23)je(27267,27235,37,27247);else if((Ke|0)==27)je(27310,27235,61,27333);else if((Ke|0)==45){e:do if((Le|0)>0){for($e=(g|0)==0,Ze=g<<2,rt=(l|0)==0,Ye=0,A=0;;){if(Ie=c[Ge+(Ye<<2)>>2]|0,$e)Ke=73;else{if(xe=hi(Ze)|0,!xe){Ke=50;break}if(Be=hi(Ze)|0,!Be){Ke=52;break}t:do if(rt)f=0;else{for(g=0,f=0,y=l;d=we+(g<<5)|0,Rv(c[y>>2]|0,d,c[Ie>>2]|0)|0?(c[xe+(f<<2)>>2]=y,c[Be+(f<<2)>>2]=d,X=f+1|0):X=f,y=c[y+8>>2]|0,y;)g=g+1|0,f=X;if((X|0)>0)if(d=c[xe>>2]|0,(X|0)==1)f=d;else for(j=0,H=-1,f=d,F=d;;){for(T=c[F>>2]|0,d=0,y=0;g=c[c[xe+(y<<2)>>2]>>2]|0,(g|0)==(T|0)?C=d:C=d+((Rv(g,c[Be+(y<<2)>>2]|0,c[T>>2]|0)|0)&1)|0,y=y+1|0,(y|0)!=(X|0);)d=C;if(g=(C|0)>(H|0),f=g?F:f,d=j+1|0,(d|0)==(X|0))break t;j=d,H=g?C:H,F=c[xe+(d<<2)>>2]|0}else f=0}while(0);if(Ue(xe),Ue(Be),f){if(g=f+4|0,d=c[g>>2]|0,d)f=d+8|0;else if(c[f>>2]|0){Ke=70;break}c[f>>2]=Ie,c[g>>2]=Ie}else Ke=73}if((Ke|0)==73){if(Ke=0,A=c[Ie>>2]|0,A|0)do Be=A,A=c[A+16>>2]|0,Ue(Be);while(A|0);Ue(Ie),A=1}if(Ye=Ye+1|0,(Ye|0)>=(Le|0)){bt=A;break e}}(Ke|0)==50?je(27452,27235,249,27471):(Ke|0)==52?je(27490,27235,252,27471):(Ke|0)==70&&je(27310,27235,61,27333)}else bt=0;while(0);return Ue(Ge),Ue(we),Ke=bt,Ke|0}return 0}function Rv(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(!(Hd(A,f)|0)||(A=lv(A)|0,d=+N[f>>3],g=+N[f+8>>3],g=A&g<0?g+6.283185307179586:g,l=c[l>>2]|0,!l))return l=0,l|0;if(A){A=0,T=g,f=l;e:for(;;){for(;y=+N[f>>3],g=+N[f+8>>3],f=f+16|0,C=c[f>>2]|0,C=C|0?C:l,m=+N[C>>3],w=+N[C+8>>3],y>m?(x=y,y=w):(x=m,m=y,y=g,g=w),d=d==m|d==x?d+2220446049250313e-31:d,!!(d<m|d>x);)if(f=c[f>>2]|0,!f){f=22;break e}if(w=y<0?y+6.283185307179586:y,y=g<0?g+6.283185307179586:g,T=w==T|y==T?T+-2220446049250313e-31:T,x=w+(y-w)*((d-m)/(x-m)),(x<0?x+6.283185307179586:x)>T&&(A=A^1),f=c[f>>2]|0,!f){f=22;break}}if((f|0)==22)return A|0}else{A=0,T=g,f=l;e:for(;;){for(;y=+N[f>>3],g=+N[f+8>>3],f=f+16|0,C=c[f>>2]|0,C=C|0?C:l,m=+N[C>>3],w=+N[C+8>>3],y>m?(x=y,y=w):(x=m,m=y,y=g,g=w),d=d==m|d==x?d+2220446049250313e-31:d,!!(d<m|d>x);)if(f=c[f>>2]|0,!f){f=22;break e}if(T=y==T|g==T?T+-2220446049250313e-31:T,y+(g-y)*((d-m)/(x-m))>T&&(A=A^1),f=c[f>>2]|0,!f){f=22;break}}if((f|0)==22)return A|0}return 0}function Li(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0;if(Ae=B,B=B+32|0,pe=Ae+16|0,ne=Ae,m=ye(l|0,A|0,52)|0,z()|0,m=m&15,H=ye(f|0,d|0,52)|0,z()|0,(m|0)!=(H&15|0))return pe=12,B=Ae,pe|0;if(T=ye(l|0,A|0,45)|0,z()|0,T=T&127,C=ye(f|0,d|0,45)|0,z()|0,C=C&127,T>>>0>121|C>>>0>121)return pe=5,B=Ae,pe|0;if(H=(T|0)!=(C|0),H){if(w=jd(T,C)|0,(w|0)==7)return pe=1,B=Ae,pe|0;x=jd(C,T)|0,(x|0)==7?je(27514,27538,161,27548):(X=w,y=x)}else X=0,y=0;F=It(T)|0,j=It(C)|0,c[pe>>2]=0,c[pe+4>>2]=0,c[pe+8>>2]=0,c[pe+12>>2]=0;do if(X){if(C=c[4272+(T*28|0)+(X<<2)>>2]|0,w=(C|0)>0,j)if(w){T=0,x=f,w=d;do x=Q6(x,w)|0,w=z()|0,y=hs(y)|0,(y|0)==1&&(y=hs(1)|0),T=T+1|0;while((T|0)!=(C|0));C=y,T=x,x=w}else C=y,T=f,x=d;else if(w){T=0,x=f,w=d;do x=tp(x,w)|0,w=z()|0,y=hs(y)|0,T=T+1|0;while((T|0)!=(C|0));C=y,T=x,x=w}else C=y,T=f,x=d;if(rp(T,x,pe)|0,H||je(27563,27538,191,27548),w=(F|0)!=0,y=(j|0)!=0,w&y&&je(27590,27538,192,27548),w){if(y=Kn(l,A)|0,(y|0)==7){m=5;break}if(_e[22e3+(y*7|0)+X>>0]|0){m=1;break}x=c[21168+(y*28|0)+(X<<2)>>2]|0,T=x}else if(y){if(y=Kn(T,x)|0,(y|0)==7){m=5;break}if(_e[22e3+(y*7|0)+C>>0]|0){m=1;break}T=0,x=c[21168+(C*28|0)+(y<<2)>>2]|0}else T=0,x=0;if((T|x|0)<0)m=5;else{if((x|0)>0){w=pe+4|0,y=0;do Pu(w),y=y+1|0;while((y|0)!=(x|0))}if(c[ne>>2]=0,c[ne+4>>2]=0,c[ne+8>>2]=0,dv(ne,X),m|0)for(;Er(m)|0?Cu(ne):yo(ne),(m|0)>1;)m=m+-1|0;if((T|0)>0){m=0;do Pu(ne),m=m+1|0;while((m|0)!=(T|0))}J=pe+4|0,Un(J,ne,J),Pn(J),J=51}}else if(rp(f,d,pe)|0,(F|0)!=0&(j|0)!=0)if((C|0)!=(T|0)&&je(27621,27538,261,27548),y=Kn(l,A)|0,m=Kn(f,d)|0,(y|0)==7|(m|0)==7)m=5;else if(_e[22e3+(y*7|0)+m>>0]|0)m=1;else if(y=c[21168+(y*28|0)+(m<<2)>>2]|0,(y|0)>0){w=pe+4|0,m=0;do Pu(w),m=m+1|0;while((m|0)!=(y|0));J=51}else J=51;else J=51;while(0);return(J|0)==51&&(m=pe+4|0,c[g>>2]=c[m>>2],c[g+4>>2]=c[m+4>>2],c[g+8>>2]=c[m+8>>2],m=0),pe=m,B=Ae,pe|0}function kv(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0;if(J=B,B=B+48|0,T=J+36|0,y=J+24|0,w=J+12|0,x=J,g=ye(l|0,A|0,52)|0,z()|0,g=g&15,j=ye(l|0,A|0,45)|0,z()|0,j=j&127,j>>>0>121)return d=5,B=J,d|0;if(C=It(j)|0,Te(g|0,0,52)|0,ne=z()|0|134225919,m=d,c[m>>2]=-1,c[m+4>>2]=ne,!g)return g=Su(f)|0,(g|0)==7||(g=Wd(j,g)|0,(g|0)==127)?(ne=1,B=J,ne|0):(H=Te(g|0,0,45)|0,X=z()|0,j=d,X=c[j+4>>2]&-1040385|X,ne=d,c[ne>>2]=c[j>>2]|H,c[ne+4>>2]=X,ne=0,B=J,ne|0);for(c[T>>2]=c[f>>2],c[T+4>>2]=c[f+4>>2],c[T+8>>2]=c[f+8>>2],f=g;;){if(m=f,f=f+-1|0,c[y>>2]=c[T>>2],c[y+4>>2]=c[T+4>>2],c[y+8>>2]=c[T+8>>2],Er(m)|0){if(g=x6(T)|0,g|0){f=13;break}c[w>>2]=c[T>>2],c[w+4>>2]=c[T+4>>2],c[w+8>>2]=c[T+8>>2],Cu(w)}else{if(g=T6(T)|0,g|0){f=13;break}c[w>>2]=c[T>>2],c[w+4>>2]=c[T+4>>2],c[w+8>>2]=c[T+8>>2],yo(w)}if(Qd(y,w,x),Pn(x),g=d,Ae=c[g>>2]|0,g=c[g+4>>2]|0,ae=(15-m|0)*3|0,pe=Te(7,0,ae|0)|0,g=g&~(z()|0),ae=Te(Su(x)|0,0,ae|0)|0,g=z()|0|g,ne=d,c[ne>>2]=ae|Ae&~pe,c[ne+4>>2]=g,(m|0)<=1){f=14;break}}e:do if((f|0)!=13&&(f|0)==14)if((c[T>>2]|0)<=1&&(c[T+4>>2]|0)<=1&&(c[T+8>>2]|0)<=1){f=Su(T)|0,g=Wd(j,f)|0,(g|0)==127?x=0:x=It(g)|0;t:do if(f){if(C){if(g=Kn(l,A)|0,(g|0)==7){g=5;break e}if(m=c[21376+(g*28|0)+(f<<2)>>2]|0,(m|0)>0){g=f,f=0;do g=vo(g)|0,f=f+1|0;while((f|0)!=(m|0))}else g=f;if((g|0)==1){g=9;break e}f=Wd(j,g)|0,(f|0)==127&&je(27648,27538,411,27678),It(f)|0?je(27693,27538,412,27678):(X=f,H=m,F=g)}else X=g,H=0,F=f;if(w=c[4272+(j*28|0)+(F<<2)>>2]|0,(w|0)<=-1&&je(27724,27538,419,27678),!x){if((H|0)<0){g=5;break e}if(H|0){m=d,g=0,f=c[m>>2]|0,m=c[m+4>>2]|0;do f=wo(f,m)|0,m=z()|0,ae=d,c[ae>>2]=f,c[ae+4>>2]=m,g=g+1|0;while((g|0)<(H|0))}if((w|0)<=0){g=X,f=58;break}for(m=d,g=0,f=c[m>>2]|0,m=c[m+4>>2]|0;;)if(f=wo(f,m)|0,m=z()|0,ae=d,c[ae>>2]=f,c[ae+4>>2]=m,g=g+1|0,(g|0)==(w|0)){g=X,f=58;break t}}if(y=jd(X,j)|0,(y|0)==7&&je(27514,27538,428,27678),g=d,f=c[g>>2]|0,g=c[g+4>>2]|0,(w|0)>0){m=0;do f=wo(f,g)|0,g=z()|0,ae=d,c[ae>>2]=f,c[ae+4>>2]=g,m=m+1|0;while((m|0)!=(w|0))}if(g=Kn(f,g)|0,(g|0)==7&&je(27795,27538,440,27678),f=$d(X)|0,f=c[(f?21792:21584)+(y*28|0)+(g<<2)>>2]|0,(f|0)<0&&je(27795,27538,454,27678),!f)g=X,f=58;else{y=d,g=0,m=c[y>>2]|0,y=c[y+4>>2]|0;do m=ep(m,y)|0,y=z()|0,ae=d,c[ae>>2]=m,c[ae+4>>2]=y,g=g+1|0;while((g|0)<(f|0));g=X,f=58}}else if((C|0)!=0&(x|0)!=0){if(f=Kn(l,A)|0,m=d,m=Kn(c[m>>2]|0,c[m+4>>2]|0)|0,(f|0)==7|(m|0)==7){g=5;break e}if(m=c[21376+(f*28|0)+(m<<2)>>2]|0,(m|0)<0){g=5;break e}if(!m)f=59;else{w=d,f=0,y=c[w>>2]|0,w=c[w+4>>2]|0;do y=wo(y,w)|0,w=z()|0,ae=d,c[ae>>2]=y,c[ae+4>>2]=w,f=f+1|0;while((f|0)<(m|0));f=58}}else f=58;while(0);if((f|0)==58&&x&&(f=59),(f|0)==59&&(ae=d,(Kn(c[ae>>2]|0,c[ae+4>>2]|0)|0)==1)){g=9;break}ae=d,pe=c[ae>>2]|0,ae=c[ae+4>>2]&-1040385,Ae=Te(g|0,0,45)|0,ae=ae|(z()|0),g=d,c[g>>2]=pe|Ae,c[g+4>>2]=ae,g=0}else g=1;while(0);return ae=g,B=J,ae|0}function d8(l,A,f,d,g,m){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0,m=m|0;var y=0,w=0;return w=B,B=B+16|0,y=w,g?l=15:(l=Li(l,A,f,d,y)|0,l||(S6(y,m),l=0)),B=w,l|0}function p8(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0;return y=B,B=B+16|0,m=y,d?f=15:(f=C6(f,m)|0,f||(f=kv(l,A,m,g)|0)),B=y,f|0}function g8(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0;return x=B,B=B+32|0,y=x+12|0,w=x,m=Li(l,A,l,A,y)|0,m|0?(w=m,B=x,w|0):(l=Li(l,A,f,d,w)|0,l|0?(w=l,B=x,w|0):(y=Yd(y,w)|0,w=g,c[w>>2]=y,c[w+4>>2]=((y|0)<0)<<31>>31,w=0,B=x,w|0))}function m8(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0;return x=B,B=B+32|0,y=x+12|0,w=x,m=Li(l,A,l,A,y)|0,!m&&(m=Li(l,A,f,d,w)|0,!m)?(d=Yd(y,w)|0,d=Fe(d|0,((d|0)<0)<<31>>31|0,1,0)|0,y=z()|0,w=g,c[w>>2]=d,c[w+4>>2]=y,w=0,B=x,w|0):(w=m,B=x,w|0)}function _8(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0;if(Ie=B,B=B+48|0,xe=Ie+24|0,y=Ie+12|0,Be=Ie,m=Li(l,A,l,A,xe)|0,!m&&(m=Li(l,A,f,d,y)|0,!m)){ae=Yd(xe,y)|0,te=((ae|0)<0)<<31>>31,c[xe>>2]=0,c[xe+4>>2]=0,c[xe+8>>2]=0,c[y>>2]=0,c[y+4>>2]=0,c[y+8>>2]=0,Li(l,A,l,A,xe)|0&&je(27795,27538,692,27747),Li(l,A,f,d,y)|0&&je(27795,27538,697,27747),_v(xe),_v(y),C=ae|0?1/+(ae|0):0,f=c[xe>>2]|0,J=C*+((c[y>>2]|0)-f|0),ne=xe+4|0,d=c[ne>>2]|0,pe=C*+((c[y+4>>2]|0)-d|0),Ae=xe+8|0,m=c[Ae>>2]|0,C=C*+((c[y+8>>2]|0)-m|0),c[Be>>2]=f,F=Be+4|0,c[F>>2]=d,j=Be+8|0,c[j>>2]=m;e:do if((ae|0)<0)m=0;else for(H=0,X=0;;){x=+(X>>>0)+4294967296*+(H|0),Ye=J*x+ +(f|0),w=pe*x+ +(d|0),x=C*x+ +(m|0),f=~~+Nu(+Ye),y=~~+Nu(+w),m=~~+Nu(+x),Ye=+tt(+(+(f|0)-Ye)),w=+tt(+(+(y|0)-w)),x=+tt(+(+(m|0)-x));do if(Ye>w&Ye>x)f=0-(y+m)|0,d=y;else if(T=0-f|0,w>x){d=T-m|0;break}else{d=y,m=T-y|0;break}while(0);if(c[Be>>2]=f,c[F>>2]=d,c[j>>2]=m,P6(Be),m=kv(l,A,Be,g+(X<<3)|0)|0,m|0)break e;if(!((H|0)<(te|0)|(H|0)==(te|0)&X>>>0<ae>>>0)){m=0;break e}f=Fe(X|0,H|0,1,0)|0,d=z()|0,H=d,X=f,f=c[xe>>2]|0,d=c[ne>>2]|0,m=c[Ae>>2]|0}while(0);return Be=m,B=Ie,Be|0}return Be=m,B=Ie,Be|0}function ds(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0;if((f|0)==0&(d|0)==0)return g=0,m=1,qe(g|0),m|0;m=l,g=A,l=1,A=0;do y=(f&1|0)==0&!0,l=un((y?1:m)|0,(y?0:g)|0,l|0,A|0)|0,A=z()|0,f=$v(f|0,d|0,1)|0,d=z()|0,m=un(m|0,g|0,m|0,g|0)|0,g=z()|0;while(!((f|0)==0&(d|0)==0));return qe(A|0),l|0}function lp(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0;w=B,B=B+16|0,m=w,y=ye(l|0,A|0,52)|0,z()|0,y=y&15;do if(y){if(g=bo(l,A,m)|0,!g){T=+N[m>>3],x=1/+ht(+T),C=+N[25968+(y<<3)>>3],N[f>>3]=T+C,N[f+8>>3]=T-C,T=+N[m+8>>3],x=C*x,N[f+16>>3]=x+T,N[f+24>>3]=T-x;break}return y=g,B=w,y|0}else{if(g=ye(l|0,A|0,45)|0,z()|0,g=g&127,g>>>0>121)return y=5,B=w,y|0;m=22064+(g<<5)|0,c[f>>2]=c[m>>2],c[f+4>>2]=c[m+4>>2],c[f+8>>2]=c[m+8>>2],c[f+12>>2]=c[m+12>>2],c[f+16>>2]=c[m+16>>2],c[f+20>>2]=c[m+20>>2],c[f+24>>2]=c[m+24>>2],c[f+28>>2]=c[m+28>>2];break}while(0);return v6(f,d?1.4:1.1),d=26096+(y<<3)|0,(c[d>>2]|0)==(l|0)&&(c[d+4>>2]|0)==(A|0)&&(N[f>>3]=1.5707963267948966),y=26224+(y<<3)|0,(c[y>>2]|0)==(l|0)&&(c[y+4>>2]|0)==(A|0)&&(N[f+8>>3]=-1.5707963267948966),+N[f>>3]!=1.5707963267948966&&+N[f+8>>3]!=-1.5707963267948966?(y=0,B=w,y|0):(N[f+16>>3]=3.141592653589793,N[f+24>>3]=-3.141592653589793,y=0,B=w,y|0)}function y8(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0;T=B,B=B+48|0,y=T+32|0,m=T+40|0,w=T,Gd(y,0,0,0),x=c[y>>2]|0,y=c[y+4>>2]|0;do if(f>>>0<=15){if(g=cc(d)|0,g|0){d=w,c[d>>2]=0,c[d+4>>2]=0,c[w+8>>2]=g,c[w+12>>2]=-1,d=w+16|0,x=w+29|0,c[d>>2]=0,c[d+4>>2]=0,c[d+8>>2]=0,_e[d+12>>0]=0,_e[x>>0]=_e[m>>0]|0,_e[x+1>>0]=_e[m+1>>0]|0,_e[x+2>>0]=_e[m+2>>0]|0;break}if(g=Gn((c[A+8>>2]|0)+1|0,32)|0,g){cp(A,g),C=w,c[C>>2]=x,c[C+4>>2]=y,c[w+8>>2]=0,c[w+12>>2]=f,c[w+16>>2]=d,c[w+20>>2]=A,c[w+24>>2]=g,_e[w+28>>0]=0,x=w+29|0,_e[x>>0]=_e[m>>0]|0,_e[x+1>>0]=_e[m+1>>0]|0,_e[x+2>>0]=_e[m+2>>0]|0;break}else{d=w,c[d>>2]=0,c[d+4>>2]=0,c[w+8>>2]=13,c[w+12>>2]=-1,d=w+16|0,x=w+29|0,c[d>>2]=0,c[d+4>>2]=0,c[d+8>>2]=0,_e[d+12>>0]=0,_e[x>>0]=_e[m>>0]|0,_e[x+1>>0]=_e[m+1>>0]|0,_e[x+2>>0]=_e[m+2>>0]|0;break}}else x=w,c[x>>2]=0,c[x+4>>2]=0,c[w+8>>2]=4,c[w+12>>2]=-1,x=w+16|0,C=w+29|0,c[x>>2]=0,c[x+4>>2]=0,c[x+8>>2]=0,_e[x+12>>0]=0,_e[C>>0]=_e[m>>0]|0,_e[C+1>>0]=_e[m+1>>0]|0,_e[C+2>>0]=_e[m+2>>0]|0;while(0);Iu(w),c[l>>2]=c[w>>2],c[l+4>>2]=c[w+4>>2],c[l+8>>2]=c[w+8>>2],c[l+12>>2]=c[w+12>>2],c[l+16>>2]=c[w+16>>2],c[l+20>>2]=c[w+20>>2],c[l+24>>2]=c[w+24>>2],c[l+28>>2]=c[w+28>>2],B=T}function Iu(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0;if(te=B,B=B+336|0,H=te+168|0,X=te,d=l,f=c[d>>2]|0,d=c[d+4>>2]|0,(f|0)==0&(d|0)==0){B=te;return}if(A=l+28|0,_e[A>>0]|0?(f=Iv(f,d)|0,d=z()|0):_e[A>>0]=1,ae=l+20|0,!(c[c[ae>>2]>>2]|0)){A=l+24|0,f=c[A>>2]|0,f|0&&Ue(f),Ae=l,c[Ae>>2]=0,c[Ae+4>>2]=0,c[l+8>>2]=0,c[ae>>2]=0,c[l+12>>2]=-1,c[l+16>>2]=0,c[A>>2]=0,B=te;return}Ae=l+16|0,A=c[Ae>>2]|0,g=A&15;e:do if((f|0)==0&(d|0)==0)pe=l+24|0;else{J=l+12|0,F=(g|0)==3,C=A&255,x=(g|1|0)==3,j=l+24|0,T=(g+-1|0)>>>0<3,y=(g|2|0)==3,w=X+8|0;t:for(;;){if(m=ye(f|0,d|0,52)|0,z()|0,m=m&15,(m|0)==(c[J>>2]|0)){switch(C&15){case 0:case 2:case 3:{if(g=bo(f,d,H)|0,g|0){ne=15;break t}if(Ap(c[ae>>2]|0,c[j>>2]|0,H)|0){ne=19;break t}break}}if(x&&(g=c[(c[ae>>2]|0)+4>>2]|0,c[H>>2]=c[g>>2],c[H+4>>2]=c[g+4>>2],c[H+8>>2]=c[g+8>>2],c[H+12>>2]=c[g+12>>2],Hd(26832,H)|0)){if(np(c[(c[ae>>2]|0)+4>>2]|0,m,X)|0){ne=25;break}if(g=X,(c[g>>2]|0)==(f|0)&&(c[g+4>>2]|0)==(d|0)){ne=29;break}}if(T){if(g=ba(f,d,H)|0,g|0){ne=32;break}if(lp(f,d,X,0)|0){ne=36;break}if(y&&Ov(c[ae>>2]|0,c[j>>2]|0,H,X)|0){ne=42;break}if(x&&Nv(c[ae>>2]|0,c[j>>2]|0,H,X)|0){ne=42;break}}if(F){if(A=lp(f,d,H,1)|0,g=c[j>>2]|0,A|0){ne=45;break}if(Xd(g,H)|0){if(Av(X,H),cv(H,c[j>>2]|0)|0){ne=53;break}if(Ap(c[ae>>2]|0,c[j>>2]|0,w)|0){ne=53;break}if(Nv(c[ae>>2]|0,c[j>>2]|0,X,H)|0){ne=53;break}}}}do if((m|0)<(c[J>>2]|0)){if(A=lp(f,d,H,1)|0,g=c[j>>2]|0,A|0){ne=58;break t}if(!(Xd(g,H)|0)){ne=73;break}if(cv(c[j>>2]|0,H)|0&&(Av(X,H),Ov(c[ae>>2]|0,c[j>>2]|0,X,H)|0)){ne=65;break t}if(f=xv(f,d,m+1|0,X)|0,f|0){ne=67;break t}d=X,f=c[d>>2]|0,d=c[d+4>>2]|0}else ne=73;while(0);if((ne|0)==73&&(ne=0,f=Iv(f,d)|0,d=z()|0),(f|0)==0&(d|0)==0){pe=j;break e}}switch(ne|0){case 15:{A=c[j>>2]|0,A|0&&Ue(A),ne=l,c[ne>>2]=0,c[ne+4>>2]=0,c[ae>>2]=0,c[J>>2]=-1,c[Ae>>2]=0,c[j>>2]=0,c[l+8>>2]=g,ne=20;break}case 19:{c[l>>2]=f,c[l+4>>2]=d,ne=20;break}case 25:{je(27795,27761,470,27772);break}case 29:{c[l>>2]=f,c[l+4>>2]=d,B=te;return}case 32:{A=c[j>>2]|0,A|0&&Ue(A),pe=l,c[pe>>2]=0,c[pe+4>>2]=0,c[ae>>2]=0,c[J>>2]=-1,c[Ae>>2]=0,c[j>>2]=0,c[l+8>>2]=g,B=te;return}case 36:{je(27795,27761,493,27772);break}case 42:{c[l>>2]=f,c[l+4>>2]=d,B=te;return}case 45:{g|0&&Ue(g),ne=l,c[ne>>2]=0,c[ne+4>>2]=0,c[ae>>2]=0,c[J>>2]=-1,c[Ae>>2]=0,c[j>>2]=0,c[l+8>>2]=A,ne=55;break}case 53:{c[l>>2]=f,c[l+4>>2]=d,ne=55;break}case 58:{g|0&&Ue(g),ne=l,c[ne>>2]=0,c[ne+4>>2]=0,c[ae>>2]=0,c[J>>2]=-1,c[Ae>>2]=0,c[j>>2]=0,c[l+8>>2]=A,ne=71;break}case 65:{c[l>>2]=f,c[l+4>>2]=d,ne=71;break}case 67:{A=c[j>>2]|0,A|0&&Ue(A),pe=l,c[pe>>2]=0,c[pe+4>>2]=0,c[ae>>2]=0,c[J>>2]=-1,c[Ae>>2]=0,c[j>>2]=0,c[l+8>>2]=f,B=te;return}}if((ne|0)==20){B=te;return}else if((ne|0)==55){B=te;return}else if((ne|0)==71){B=te;return}}while(0);A=c[pe>>2]|0,A|0&&Ue(A),ne=l,c[ne>>2]=0,c[ne+4>>2]=0,c[l+8>>2]=0,c[ae>>2]=0,c[l+12>>2]=-1,c[Ae>>2]=0,c[pe>>2]=0,B=te}function Iv(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0;F=B,B=B+16|0,C=F,d=ye(l|0,A|0,52)|0,z()|0,d=d&15,f=ye(l|0,A|0,45)|0,z()|0;do if(d){for(;f=Te(d+4095|0,0,52)|0,g=z()|0|A&-15728641,m=(15-d|0)*3|0,y=Te(7,0,m|0)|0,w=z()|0,f=f|l|y,g=g|w,x=ye(l|0,A|0,m|0)|0,z()|0,x=x&7,d=d+-1|0,!(x>>>0<6);)if(d)A=g,l=f;else{T=4;break}if((T|0)==4){f=ye(f|0,g|0,45)|0,z()|0;break}return C=(x|0)==0&(Et(f,g)|0)!=0,C=Te((C?2:1)+x|0,0,m|0)|0,T=z()|0|A&~w,C=C|l&~y,qe(T|0),B=F,C|0}while(0);return f=f&127,f>>>0>120?(T=0,C=0,qe(T|0),B=F,C|0):(Gd(C,0,f+1|0,0),T=c[C+4>>2]|0,C=c[C>>2]|0,qe(T|0),B=F,C|0)}function v8(l,A,f,d,g,m){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0,m=m|0;var y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0;ne=B,B=B+160|0,F=ne+80|0,w=ne+64|0,j=ne+112|0,J=ne,y8(F,l,A,f),T=F,sp(w,c[T>>2]|0,c[T+4>>2]|0,A),T=w,x=c[T>>2]|0,T=c[T+4>>2]|0,y=c[F+8>>2]|0,H=j+4|0,c[H>>2]=c[F>>2],c[H+4>>2]=c[F+4>>2],c[H+8>>2]=c[F+8>>2],c[H+12>>2]=c[F+12>>2],c[H+16>>2]=c[F+16>>2],c[H+20>>2]=c[F+20>>2],c[H+24>>2]=c[F+24>>2],c[H+28>>2]=c[F+28>>2],H=J,c[H>>2]=x,c[H+4>>2]=T,H=J+8|0,c[H>>2]=y,l=J+12|0,A=j,f=l+36|0;do c[l>>2]=c[A>>2],l=l+4|0,A=A+4|0;while((l|0)<(f|0));if(j=J+48|0,c[j>>2]=c[w>>2],c[j+4>>2]=c[w+4>>2],c[j+8>>2]=c[w+8>>2],c[j+12>>2]=c[w+12>>2],(x|0)==0&(T|0)==0)return J=y,B=ne,J|0;f=J+16|0,C=J+24|0,F=J+28|0,y=0,w=0,A=x,l=T;do{if(!((y|0)<(g|0)|(y|0)==(g|0)&w>>>0<d>>>0)){X=4;break}if(T=w,w=Fe(w|0,y|0,1,0)|0,y=z()|0,T=m+(T<<3)|0,c[T>>2]=A,c[T+4>>2]=l,op(j),l=j,A=c[l>>2]|0,l=c[l+4>>2]|0,(A|0)==0&(l|0)==0){if(Iu(f),A=f,l=c[A>>2]|0,A=c[A+4>>2]|0,(l|0)==0&(A|0)==0){X=10;break}Ev(l,A,c[F>>2]|0,j),l=j,A=c[l>>2]|0,l=c[l+4>>2]|0}T=J,c[T>>2]=A,c[T+4>>2]=l}while(!((A|0)==0&(l|0)==0));return(X|0)==4?(l=J+40|0,A=c[l>>2]|0,A|0&&Ue(A),X=J+16|0,c[X>>2]=0,c[X+4>>2]=0,c[C>>2]=0,c[J+36>>2]=0,c[F>>2]=-1,c[J+32>>2]=0,c[l>>2]=0,Ev(0,0,0,j),c[J>>2]=0,c[J+4>>2]=0,c[H>>2]=0,J=14,B=ne,J|0):((X|0)==10&&(c[J>>2]=0,c[J+4>>2]=0,c[H>>2]=c[C>>2]),J=c[H>>2]|0,B=ne,J|0)}function w8(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0;if(F=B,B=B+48|0,x=F+32|0,w=F+40|0,T=F,!(c[l>>2]|0))return C=d,c[C>>2]=0,c[C+4>>2]=0,C=0,B=F,C|0;Gd(x,0,0,0),y=x,g=c[y>>2]|0,y=c[y+4>>2]|0;do if(A>>>0>15)C=T,c[C>>2]=0,c[C+4>>2]=0,c[T+8>>2]=4,c[T+12>>2]=-1,C=T+16|0,f=T+29|0,c[C>>2]=0,c[C+4>>2]=0,c[C+8>>2]=0,_e[C+12>>0]=0,_e[f>>0]=_e[w>>0]|0,_e[f+1>>0]=_e[w+1>>0]|0,_e[f+2>>0]=_e[w+2>>0]|0,f=4,C=9;else{if(f=cc(f)|0,f|0){x=T,c[x>>2]=0,c[x+4>>2]=0,c[T+8>>2]=f,c[T+12>>2]=-1,x=T+16|0,C=T+29|0,c[x>>2]=0,c[x+4>>2]=0,c[x+8>>2]=0,_e[x+12>>0]=0,_e[C>>0]=_e[w>>0]|0,_e[C+1>>0]=_e[w+1>>0]|0,_e[C+2>>0]=_e[w+2>>0]|0,C=9;break}if(f=Gn((c[l+8>>2]|0)+1|0,32)|0,!f){C=T,c[C>>2]=0,c[C+4>>2]=0,c[T+8>>2]=13,c[T+12>>2]=-1,C=T+16|0,f=T+29|0,c[C>>2]=0,c[C+4>>2]=0,c[C+8>>2]=0,_e[C+12>>0]=0,_e[f>>0]=_e[w>>0]|0,_e[f+1>>0]=_e[w+1>>0]|0,_e[f+2>>0]=_e[w+2>>0]|0,f=13,C=9;break}cp(l,f),H=T,c[H>>2]=g,c[H+4>>2]=y,y=T+8|0,c[y>>2]=0,c[T+12>>2]=A,c[T+20>>2]=l,c[T+24>>2]=f,_e[T+28>>0]=0,g=T+29|0,_e[g>>0]=_e[w>>0]|0,_e[g+1>>0]=_e[w+1>>0]|0,_e[g+2>>0]=_e[w+2>>0]|0,c[T+16>>2]=3,j=+m6(f),j=j*+g6(f),m=+tt(+ +N[f>>3]),m=j/+ht(+ +Ou(+m,+ +tt(+ +N[f+8>>3])))*6371.007180918475*6371.007180918475,g=T+12|0,f=c[g>>2]|0;e:do if((f|0)>0)do{if(Sv(f+-1|0,x)|0,!(m/+N[x>>3]>10))break e;H=c[g>>2]|0,f=H+-1|0,c[g>>2]=f}while((H|0)>1);while(0);if(Iu(T),g=d,c[g>>2]=0,c[g+4>>2]=0,g=T,f=c[g>>2]|0,g=c[g+4>>2]|0,!((f|0)==0&(g|0)==0))do sc(f,g,A,x)|0,w=x,l=d,w=Fe(c[l>>2]|0,c[l+4>>2]|0,c[w>>2]|0,c[w+4>>2]|0)|0,l=z()|0,H=d,c[H>>2]=w,c[H+4>>2]=l,Iu(T),H=T,f=c[H>>2]|0,g=c[H+4>>2]|0;while(!((f|0)==0&(g|0)==0));f=c[y>>2]|0}while(0);return H=f,B=F,H|0}function lc(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0;if(!(Hd(A,f)|0)||(A=lv(A)|0,d=+N[f>>3],g=+N[f+8>>3],g=A&g<0?g+6.283185307179586:g,j=c[l>>2]|0,(j|0)<=0))return j=0,j|0;if(F=c[l+4>>2]|0,A){A=0,C=g,f=-1,l=0;e:for(;;){for(T=l;y=+N[F+(T<<4)>>3],g=+N[F+(T<<4)+8>>3],l=(f+2|0)%(j|0)|0,m=+N[F+(l<<4)>>3],w=+N[F+(l<<4)+8>>3],y>m?(x=y,y=w):(x=m,m=y,y=g,g=w),d=d==m|d==x?d+2220446049250313e-31:d,!!(d<m|d>x);)if(f=T+1|0,(f|0)>=(j|0)){f=22;break e}else l=T,T=f,f=l;if(w=y<0?y+6.283185307179586:y,y=g<0?g+6.283185307179586:g,C=w==C|y==C?C+-2220446049250313e-31:C,x=w+(y-w)*((d-m)/(x-m)),(x<0?x+6.283185307179586:x)>C&&(A=A^1),l=T+1|0,(l|0)>=(j|0)){f=22;break}else f=T}if((f|0)==22)return A|0}else{A=0,C=g,f=-1,l=0;e:for(;;){for(T=l;y=+N[F+(T<<4)>>3],g=+N[F+(T<<4)+8>>3],l=(f+2|0)%(j|0)|0,m=+N[F+(l<<4)>>3],w=+N[F+(l<<4)+8>>3],y>m?(x=y,y=w):(x=m,m=y,y=g,g=w),d=d==m|d==x?d+2220446049250313e-31:d,!!(d<m|d>x);)if(f=T+1|0,(f|0)>=(j|0)){f=22;break e}else l=T,T=f,f=l;if(C=y==C|g==C?C+-2220446049250313e-31:C,y+(g-y)*((d-m)/(x-m))>C&&(A=A^1),l=T+1|0,(l|0)>=(j|0)){f=22;break}else f=T}if((f|0)==22)return A|0}return 0}function Mv(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0;if(X=c[l>>2]|0,!X){c[A>>2]=0,c[A+4>>2]=0,c[A+8>>2]=0,c[A+12>>2]=0,c[A+16>>2]=0,c[A+20>>2]=0,c[A+24>>2]=0,c[A+28>>2]=0;return}if(J=A+8|0,N[J>>3]=17976931348623157e292,ne=A+24|0,N[ne>>3]=17976931348623157e292,N[A>>3]=-17976931348623157e292,pe=A+16|0,N[pe>>3]=-17976931348623157e292,!((X|0)<=0)){for(j=c[l+4>>2]|0,T=17976931348623157e292,C=-17976931348623157e292,F=0,l=-1,m=17976931348623157e292,y=17976931348623157e292,x=-17976931348623157e292,d=-17976931348623157e292,H=0;f=+N[j+(H<<4)>>3],w=+N[j+(H<<4)+8>>3],l=l+2|0,g=+N[j+(((l|0)==(X|0)?0:l)<<4)+8>>3],f<m&&(N[J>>3]=f,m=f),w<y&&(N[ne>>3]=w,y=w),f>x?N[A>>3]=f:f=x,w>d&&(N[pe>>3]=w,d=w),T=w>0&w<T?w:T,C=w<0&w>C?w:C,F=F|+tt(+(w-g))>3.141592653589793,l=H+1|0,(l|0)!=(X|0);)Ae=H,x=f,H=l,l=Ae;F&&(N[pe>>3]=C,N[ne>>3]=T)}}function cc(l){return l=l|0,(l>>>0<4?0:15)|0}function cp(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0;if(X=c[l>>2]|0,X){if(J=A+8|0,N[J>>3]=17976931348623157e292,ne=A+24|0,N[ne>>3]=17976931348623157e292,N[A>>3]=-17976931348623157e292,pe=A+16|0,N[pe>>3]=-17976931348623157e292,(X|0)>0){for(g=c[l+4>>2]|0,j=17976931348623157e292,H=-17976931348623157e292,d=0,f=-1,x=17976931348623157e292,T=17976931348623157e292,F=-17976931348623157e292,y=-17976931348623157e292,Ae=0;m=+N[g+(Ae<<4)>>3],C=+N[g+(Ae<<4)+8>>3],Be=f+2|0,w=+N[g+(((Be|0)==(X|0)?0:Be)<<4)+8>>3],m<x&&(N[J>>3]=m,x=m),C<T&&(N[ne>>3]=C,T=C),m>F?N[A>>3]=m:m=F,C>y&&(N[pe>>3]=C,y=C),j=C>0&C<j?C:j,H=C<0&C>H?C:H,d=d|+tt(+(C-w))>3.141592653589793,f=Ae+1|0,(f|0)!=(X|0);)Be=Ae,F=m,Ae=f,f=Be;d&&(N[pe>>3]=H,N[ne>>3]=j)}}else c[A>>2]=0,c[A+4>>2]=0,c[A+8>>2]=0,c[A+12>>2]=0,c[A+16>>2]=0,c[A+20>>2]=0,c[A+24>>2]=0,c[A+28>>2]=0;if(Be=l+8|0,f=c[Be>>2]|0,!((f|0)<=0)){xe=l+12|0,te=0;do if(g=c[xe>>2]|0,d=te,te=te+1|0,ne=A+(te<<5)|0,pe=c[g+(d<<3)>>2]|0,pe){if(Ae=A+(te<<5)+8|0,N[Ae>>3]=17976931348623157e292,l=A+(te<<5)+24|0,N[l>>3]=17976931348623157e292,N[ne>>3]=-17976931348623157e292,ae=A+(te<<5)+16|0,N[ae>>3]=-17976931348623157e292,(pe|0)>0){for(X=c[g+(d<<3)+4>>2]|0,j=17976931348623157e292,H=-17976931348623157e292,g=0,d=-1,J=0,x=17976931348623157e292,T=17976931348623157e292,C=-17976931348623157e292,y=-17976931348623157e292;m=+N[X+(J<<4)>>3],F=+N[X+(J<<4)+8>>3],d=d+2|0,w=+N[X+(((d|0)==(pe|0)?0:d)<<4)+8>>3],m<x&&(N[Ae>>3]=m,x=m),F<T&&(N[l>>3]=F,T=F),m>C?N[ne>>3]=m:m=C,F>y&&(N[ae>>3]=F,y=F),j=F>0&F<j?F:j,H=F<0&F>H?F:H,g=g|+tt(+(F-w))>3.141592653589793,d=J+1|0,(d|0)!=(pe|0);)Ie=J,J=d,C=m,d=Ie;g&&(N[ae>>3]=H,N[l>>3]=j)}}else c[ne>>2]=0,c[ne+4>>2]=0,c[ne+8>>2]=0,c[ne+12>>2]=0,c[ne+16>>2]=0,c[ne+20>>2]=0,c[ne+24>>2]=0,c[ne+28>>2]=0,f=c[Be>>2]|0;while((te|0)<(f|0))}}function Ap(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;if(!(lc(l,A,f)|0))return g=0,g|0;if(g=l+8|0,(c[g>>2]|0)<=0)return g=1,g|0;for(d=l+12|0,l=0;;){if(m=l,l=l+1|0,lc((c[d>>2]|0)+(m<<3)|0,A+(l<<5)|0,f)|0){l=0,d=6;break}if((l|0)>=(c[g>>2]|0)){l=1,d=6;break}}return(d|0)==6?l|0:0}function Ov(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0;if(T=B,B=B+16|0,w=T,y=f+8|0,!(lc(l,A,y)|0))return x=0,B=T,x|0;x=l+8|0;e:do if((c[x>>2]|0)>0){for(m=l+12|0,g=0;;){if(C=g,g=g+1|0,lc((c[m>>2]|0)+(C<<3)|0,A+(g<<5)|0,y)|0){g=0;break}if((g|0)>=(c[x>>2]|0))break e}return B=T,g|0}while(0);if(Mu(l,A,f,d)|0)return C=0,B=T,C|0;c[w>>2]=c[f>>2],c[w+4>>2]=y,g=c[x>>2]|0;e:do if((g|0)>0)for(l=l+12|0,y=0,m=g;;){if(g=c[l>>2]|0,(c[g+(y<<3)>>2]|0)>0){if(lc(w,d,c[g+(y<<3)+4>>2]|0)|0){g=0;break e}if(g=y+1|0,Mu((c[l>>2]|0)+(y<<3)|0,A+(g<<5)|0,f,d)|0){g=0;break e}m=c[x>>2]|0}else g=y+1|0;if((g|0)<(m|0))y=g;else{g=1;break}}else g=1;while(0);return C=g,B=T,C|0}function Mu(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0,Be=0,Ie=0,Ye=0;if(Be=B,B=B+176|0,Ae=Be+172|0,g=Be+168|0,ae=Be,!(Xd(A,d)|0))return l=0,B=Be,l|0;if(_6(A,d,Ae,g),Sa(ae|0,f|0,168)|0,(c[f>>2]|0)>0){A=0;do Ie=ae+8+(A<<4)+8|0,pe=+cr(+N[Ie>>3],c[g>>2]|0),N[Ie>>3]=pe,A=A+1|0;while((A|0)<(c[f>>2]|0))}J=+N[d>>3],ne=+N[d+8>>3],pe=+cr(+N[d+16>>3],c[g>>2]|0),H=+cr(+N[d+24>>3],c[g>>2]|0);e:do if((c[l>>2]|0)>0){if(d=l+4|0,g=c[ae>>2]|0,(g|0)<=0){for(A=0;;)if(A=A+1|0,(A|0)>=(c[l>>2]|0)){A=0;break e}}for(f=0;;){if(A=c[d>>2]|0,j=+N[A+(f<<4)>>3],X=+cr(+N[A+(f<<4)+8>>3],c[Ae>>2]|0),A=c[d>>2]|0,f=f+1|0,Ie=(f|0)%(c[l>>2]|0)|0,m=+N[A+(Ie<<4)>>3],y=+cr(+N[A+(Ie<<4)+8>>3],c[Ae>>2]|0),!(j>=J)|!(m>=J)&&!(j<=ne)|!(m<=ne)&&!(X<=H)|!(y<=H)&&!(X>=pe)|!(y>=pe)){F=m-j,T=y-X,A=0;do if(Ye=A,A=A+1|0,Ie=(A|0)==(g|0)?0:A,m=+N[ae+8+(Ye<<4)+8>>3],y=+N[ae+8+(Ie<<4)+8>>3]-m,w=+N[ae+8+(Ye<<4)>>3],x=+N[ae+8+(Ie<<4)>>3]-w,C=F*y-T*x,C!=0&&(te=X-m,xe=j-w,x=(te*x-y*xe)/C,!(x<0|x>1))&&(C=(F*te-T*xe)/C,C>=0&C<=1)){A=1;break e}while((A|0)<(g|0))}if((f|0)>=(c[l>>2]|0)){A=0;break}}}else A=0;while(0);return Ye=A,B=Be,Ye|0}function Nv(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0;if(Mu(l,A,f,d)|0)return m=1,m|0;if(m=l+8|0,(c[m>>2]|0)<=0)return m=0,m|0;for(g=l+12|0,l=0;;){if(y=l,l=l+1|0,Mu((c[g>>2]|0)+(y<<3)|0,A+(l<<5)|0,f,d)|0){l=1,g=6;break}if((l|0)>=(c[m>>2]|0)){l=0,g=6;break}}return(g|0)==6?l|0:0}function b8(){return 8}function x8(){return 16}function T8(){return 168}function E8(){return 8}function S8(){return 16}function C8(){return 12}function P8(){return 8}function R8(l){return l=l|0,+(+((c[l>>2]|0)>>>0)+4294967296*+(c[l+4>>2]|0))}function k8(l){l=l|0;var A=0,f=0;return f=+N[l>>3],A=+N[l+8>>3],+ +At(+(f*f+A*A))}function Dv(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0;T=+N[l>>3],x=+N[A>>3]-T,w=+N[l+8>>3],y=+N[A+8>>3]-w,F=+N[f>>3],m=+N[d>>3]-F,j=+N[f+8>>3],C=+N[d+8>>3]-j,m=(m*(w-j)-(T-F)*C)/(x*C-y*m),N[g>>3]=T+x*m,N[g+8>>3]=w+y*m}function Bv(l,A){return l=l|0,A=A|0,+tt(+(+N[l>>3]-+N[A>>3]))<11920928955078125e-23?(A=+tt(+(+N[l+8>>3]-+N[A+8>>3]))<11920928955078125e-23,A|0):(A=0,A|0)}function Gt(l,A){l=l|0,A=A|0;var f=0,d=0,g=0;return g=+N[l>>3]-+N[A>>3],d=+N[l+8>>3]-+N[A+8>>3],f=+N[l+16>>3]-+N[A+16>>3],+(g*g+d*d+f*f)}function I8(l,A){l=l|0,A=A|0;var f=0,d=0,g=0;f=+N[l>>3],d=+ht(+f),f=+nt(+f),N[A+16>>3]=f,f=+N[l+8>>3],g=d*+ht(+f),N[A>>3]=g,f=d*+nt(+f),N[A+8>>3]=f}function M8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;if(m=B,B=B+16|0,g=m,d=Et(l,A)|0,(f+-1|0)>>>0>5||(d=(d|0)!=0,(f|0)==1&d))return g=-1,B=m,g|0;do if(Ac(l,A,g)|0)d=-1;else if(d){d=((c[26352+(f<<2)>>2]|0)+5-(c[g>>2]|0)|0)%5|0;break}else{d=((c[26384+(f<<2)>>2]|0)+6-(c[g>>2]|0)|0)%6|0;break}while(0);return g=d,B=m,g|0}function Ac(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0,T=0;if(T=B,B=B+32|0,y=T+16|0,w=T,d=wa(l,A,y)|0,d|0)return f=d,B=T,f|0;m=wv(l,A)|0,x=Kn(l,A)|0,f6(m,w),d=h6(m,c[y>>2]|0)|0;e:do if(It(m)|0){do switch(m|0){case 4:{l=0;break}case 14:{l=1;break}case 24:{l=2;break}case 38:{l=3;break}case 49:{l=4;break}case 58:{l=5;break}case 63:{l=6;break}case 72:{l=7;break}case 83:{l=8;break}case 97:{l=9;break}case 107:{l=10;break}case 117:{l=11;break}default:{d=1;break e}}while(0);if(g=c[26416+(l*24|0)+8>>2]|0,A=c[26416+(l*24|0)+16>>2]|0,l=c[y>>2]|0,(l|0)!=(c[w>>2]|0)&&(w=$d(m)|0,l=c[y>>2]|0,w|(l|0)==(A|0)&&(d=(d+1|0)%6|0)),(x|0)==3&(l|0)==(A|0)){d=(d+5|0)%6|0,g=22;break}(x|0)==5&(l|0)==(g|0)&&(d=(d+1|0)%6|0),g=22}else g=22;while(0);return(g|0)==22&&(c[f>>2]=d,d=0),f=d,B=T,f|0}function Sr(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0;if(ae=B,B=B+32|0,Ae=ae+24|0,ne=ae+20|0,X=ae+8|0,H=ae+16|0,j=ae,x=(Et(l,A)|0)==0,x=x?6:5,C=ye(l|0,A|0,52)|0,z()|0,C=C&15,x>>>0<=f>>>0)return d=2,B=ae,d|0;F=(C|0)==0,!F&&(J=Te(7,0,(C^15)*3|0)|0,(J&l|0)==0&((z()|0)&A|0)==0)?g=f:m=4;e:do if((m|0)==4){if(g=(Et(l,A)|0)!=0,((g?4:5)|0)<(f|0)||Ac(l,A,Ae)|0||(m=(c[Ae>>2]|0)+f|0,g?g=26704+(((m|0)%5|0)<<2)|0:g=26736+(((m|0)%6|0)<<2)|0,J=c[g>>2]|0,(J|0)==7))return d=1,B=ae,d|0;c[ne>>2]=0,g=An(l,A,J,ne,X)|0;do if(!g){if(w=X,T=c[w>>2]|0,w=c[w+4>>2]|0,y=w>>>0<A>>>0|(w|0)==(A|0)&T>>>0<l>>>0,m=y?T:l,y=y?w:A,!F&&(F=Te(7,0,(C^15)*3|0)|0,(T&F|0)==0&(w&(z()|0)|0)==0))g=f;else{if(w=(f+-1+x|0)%(x|0)|0,g=Et(l,A)|0,(w|0)<0&&je(27795,27797,246,27806),x=(g|0)!=0,((x?4:5)|0)<(w|0)&&je(27795,27797,246,27806),Ac(l,A,Ae)|0&&je(27795,27797,246,27806),g=(c[Ae>>2]|0)+w|0,x?g=26704+(((g|0)%5|0)<<2)|0:g=26736+(((g|0)%6|0)<<2)|0,w=c[g>>2]|0,(w|0)==7&&je(27795,27797,246,27806),c[H>>2]=0,g=An(l,A,w,H,j)|0,g|0)break;T=j,x=c[T>>2]|0,T=c[T+4>>2]|0;do if(T>>>0<y>>>0|(T|0)==(y|0)&x>>>0<m>>>0){if(Et(x,T)|0?m=Vd(x,T,l,A)|0:m=c[26800+((((c[H>>2]|0)+(c[26768+(w<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,g=Et(x,T)|0,(m+-1|0)>>>0>5){g=-1,m=x,y=T;break}if(g=(g|0)!=0,(m|0)==1&g){g=-1,m=x,y=T;break}do if(Ac(x,T,Ae)|0)g=-1;else if(g){g=((c[26352+(m<<2)>>2]|0)+5-(c[Ae>>2]|0)|0)%5|0;break}else{g=((c[26384+(m<<2)>>2]|0)+6-(c[Ae>>2]|0)|0)%6|0;break}while(0);m=x,y=T}else g=f;while(0);w=X,T=c[w>>2]|0,w=c[w+4>>2]|0}if((m|0)==(T|0)&(y|0)==(w|0)){if(x=(Et(T,w)|0)!=0,x?l=Vd(T,w,l,A)|0:l=c[26800+((((c[ne>>2]|0)+(c[26768+(J<<2)>>2]|0)|0)%6|0)<<2)>>2]|0,g=Et(T,w)|0,(l+-1|0)>>>0<=5&&(pe=(g|0)!=0,!((l|0)==1&pe)))do if(Ac(T,w,Ae)|0)g=-1;else if(pe){g=((c[26352+(l<<2)>>2]|0)+5-(c[Ae>>2]|0)|0)%5|0;break}else{g=((c[26384+(l<<2)>>2]|0)+6-(c[Ae>>2]|0)|0)%6|0;break}while(0);else g=-1;g=g+1|0,g=(g|0)==6|x&(g|0)==5?0:g}A=y,l=m;break e}while(0);return d=g,B=ae,d|0}while(0);return pe=Te(g|0,0,56)|0,Ae=z()|0|A&-2130706433|536870912,c[d>>2]=pe|l,c[d+4>>2]=Ae,d=0,B=ae,d|0}function O8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;return m=(Et(l,A)|0)==0,d=Sr(l,A,0,f)|0,g=(d|0)==0,m?!g||(d=Sr(l,A,1,f+8|0)|0,d|0)||(d=Sr(l,A,2,f+16|0)|0,d|0)||(d=Sr(l,A,3,f+24|0)|0,d|0)||(d=Sr(l,A,4,f+32|0)|0,d)?(m=d,m|0):Sr(l,A,5,f+40|0)|0:!g||(d=Sr(l,A,1,f+8|0)|0,d|0)||(d=Sr(l,A,2,f+16|0)|0,d|0)||(d=Sr(l,A,3,f+24|0)|0,d|0)||(d=Sr(l,A,4,f+32|0)|0,d|0)?(m=d,m|0):(m=f+40|0,c[m>>2]=0,c[m+4>>2]=0,m=0,m|0)}function N8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0,w=0,x=0;return x=B,B=B+192|0,g=x,m=x+168|0,y=ye(l|0,A|0,56)|0,z()|0,y=y&7,w=A&-2130706433|134217728,d=wa(l,w,m)|0,d|0?(w=d,B=x,w|0):(A=ye(l|0,A|0,52)|0,z()|0,A=A&15,Et(l,w)|0?qd(m,A,y,1,g):Zd(m,A,y,1,g),w=g+8|0,c[f>>2]=c[w>>2],c[f+4>>2]=c[w+4>>2],c[f+8>>2]=c[w+8>>2],c[f+12>>2]=c[w+12>>2],w=0,B=x,w|0)}function D8(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0;return g=B,B=B+16|0,f=g,!(!0&(A&2013265920|0)==536870912)||(d=A&-2130706433|134217728,!(Kd(l,d)|0))?(d=0,B=g,d|0):(m=ye(l|0,A|0,56)|0,z()|0,m=(Sr(l,d,m&7,f)|0)==0,d=f,d=m&((c[d>>2]|0)==(l|0)?(c[d+4>>2]|0)==(A|0):0)&1,B=g,d|0)}function Lv(l,A,f){l=l|0,A=A|0,f=f|0;var d=0;(A|0)>0?(d=Gn(A,4)|0,c[l>>2]=d,d||je(27819,27842,40,27856)):c[l>>2]=0,c[l+4>>2]=A,c[l+8>>2]=0,c[l+12>>2]=f}function Fv(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0;g=l+4|0,m=l+12|0,y=l+8|0;e:for(;;){for(f=c[g>>2]|0,A=0;;){if((A|0)>=(f|0))break e;if(d=c[l>>2]|0,w=c[d+(A<<2)>>2]|0,!w)A=A+1|0;else break}A=d+(~~(+tt(+(+fs(10,+ +(15-(c[m>>2]|0)|0))*(+N[w>>3]+ +N[w+8>>3])))%+(f|0))>>>0<<2)|0,f=c[A>>2]|0;t:do if(f|0){if(d=w+32|0,(f|0)==(w|0))c[A>>2]=c[d>>2];else{if(f=f+32|0,A=c[f>>2]|0,!A)break;for(;(A|0)!=(w|0);)if(f=A+32|0,A=c[f>>2]|0,!A)break t;c[f>>2]=c[d>>2]}Ue(w),c[y>>2]=(c[y>>2]|0)+-1}while(0)}Ue(c[l>>2]|0)}function Uv(l){l=l|0;var A=0,f=0,d=0;for(d=c[l+4>>2]|0,f=0;;){if((f|0)>=(d|0)){A=0,f=4;break}if(A=c[(c[l>>2]|0)+(f<<2)>>2]|0,!A)f=f+1|0;else{f=4;break}}return(f|0)==4?A|0:0}function zv(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0;if(f=~~(+tt(+(+fs(10,+ +(15-(c[l+12>>2]|0)|0))*(+N[A>>3]+ +N[A+8>>3])))%+(c[l+4>>2]|0))>>>0,f=(c[l>>2]|0)+(f<<2)|0,d=c[f>>2]|0,!d)return m=1,m|0;m=A+32|0;do if((d|0)!=(A|0)){if(f=c[d+32>>2]|0,!f)return m=1,m|0;for(g=f;;){if((g|0)==(A|0)){g=8;break}if(f=c[g+32>>2]|0,f)d=g,g=f;else{f=1,g=10;break}}if((g|0)==8){c[d+32>>2]=c[m>>2];break}else if((g|0)==10)return f|0}else c[f>>2]=c[m>>2];while(0);return Ue(A),m=l+8|0,c[m>>2]=(c[m>>2]|0)+-1,m=0,m|0}function B8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0;m=hi(40)|0,m||je(27872,27842,98,27885),c[m>>2]=c[A>>2],c[m+4>>2]=c[A+4>>2],c[m+8>>2]=c[A+8>>2],c[m+12>>2]=c[A+12>>2],g=m+16|0,c[g>>2]=c[f>>2],c[g+4>>2]=c[f+4>>2],c[g+8>>2]=c[f+8>>2],c[g+12>>2]=c[f+12>>2],c[m+32>>2]=0,g=~~(+tt(+(+fs(10,+ +(15-(c[l+12>>2]|0)|0))*(+N[A>>3]+ +N[A+8>>3])))%+(c[l+4>>2]|0))>>>0,g=(c[l>>2]|0)+(g<<2)|0,d=c[g>>2]|0;do if(!d)c[g>>2]=m;else{for(;!(xa(d,A)|0&&xa(d+16|0,f)|0);)if(g=c[d+32>>2]|0,d=g|0?g:d,!(c[d+32>>2]|0)){y=10;break}if((y|0)==10){c[d+32>>2]=m;break}return Ue(m),y=d,y|0}while(0);return y=l+8|0,c[y>>2]=(c[y>>2]|0)+1,y=m,y|0}function L8(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0;if(g=~~(+tt(+(+fs(10,+ +(15-(c[l+12>>2]|0)|0))*(+N[A>>3]+ +N[A+8>>3])))%+(c[l+4>>2]|0))>>>0,g=c[(c[l>>2]|0)+(g<<2)>>2]|0,!g)return f=0,f|0;if(!f){for(l=g;;){if(xa(l,A)|0){d=10;break}if(l=c[l+32>>2]|0,!l){l=0,d=10;break}}if((d|0)==10)return l|0}for(l=g;;){if(xa(l,A)|0&&xa(l+16|0,f)|0){d=10;break}if(l=c[l+32>>2]|0,!l){l=0,d=10;break}}return(d|0)==10?l|0:0}function F8(l,A){l=l|0,A=A|0;var f=0;if(f=~~(+tt(+(+fs(10,+ +(15-(c[l+12>>2]|0)|0))*(+N[A>>3]+ +N[A+8>>3])))%+(c[l+4>>2]|0))>>>0,l=c[(c[l>>2]|0)+(f<<2)>>2]|0,!l)return f=0,f|0;for(;;){if(xa(l,A)|0){A=5;break}if(l=c[l+32>>2]|0,!l){l=0,A=5;break}}return(A|0)==5?l|0:0}function U8(){return 27904}function ps(l){return l=+l,~~+Hv(+l)|0}function hi(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0,J=0,ne=0,pe=0,Ae=0,ae=0,te=0,xe=0;xe=B,B=B+16|0,j=xe;do if(l>>>0<245){if(T=l>>>0<11?16:l+11&-8,l=T>>>3,F=c[6977]|0,f=F>>>l,f&3|0)return A=(f&1^1)+l|0,l=27948+(A<<1<<2)|0,f=l+8|0,d=c[f>>2]|0,g=d+8|0,m=c[g>>2]|0,(m|0)==(l|0)?c[6977]=F&~(1<<A):(c[m+12>>2]=l,c[f>>2]=m),te=A<<3,c[d+4>>2]=te|3,te=d+te+4|0,c[te>>2]=c[te>>2]|1,te=g,B=xe,te|0;if(C=c[6979]|0,T>>>0>C>>>0){if(f|0)return A=2<<l,A=f<<l&(A|0-A),A=(A&0-A)+-1|0,w=A>>>12&16,A=A>>>w,f=A>>>5&8,A=A>>>f,m=A>>>2&4,A=A>>>m,l=A>>>1&2,A=A>>>l,d=A>>>1&1,d=(f|w|m|l|d)+(A>>>d)|0,A=27948+(d<<1<<2)|0,l=A+8|0,m=c[l>>2]|0,w=m+8|0,f=c[w>>2]|0,(f|0)==(A|0)?(l=F&~(1<<d),c[6977]=l):(c[f+12>>2]=A,c[l>>2]=f,l=F),te=d<<3,y=te-T|0,c[m+4>>2]=T|3,g=m+T|0,c[g+4>>2]=y|1,c[m+te>>2]=y,C|0&&(d=c[6982]|0,A=C>>>3,f=27948+(A<<1<<2)|0,A=1<<A,l&A?(l=f+8|0,A=c[l>>2]|0):(c[6977]=l|A,A=f,l=f+8|0),c[l>>2]=d,c[A+12>>2]=d,c[d+8>>2]=A,c[d+12>>2]=f),c[6979]=y,c[6982]=g,te=w,B=xe,te|0;if(m=c[6978]|0,m){for(f=(m&0-m)+-1|0,g=f>>>12&16,f=f>>>g,d=f>>>5&8,f=f>>>d,y=f>>>2&4,f=f>>>y,w=f>>>1&2,f=f>>>w,x=f>>>1&1,x=c[28212+((d|g|y|w|x)+(f>>>x)<<2)>>2]|0,f=x,w=x,x=(c[x+4>>2]&-8)-T|0;l=c[f+16>>2]|0,!(!l&&(l=c[f+20>>2]|0,!l));)y=(c[l+4>>2]&-8)-T|0,g=y>>>0<x>>>0,f=l,w=g?l:w,x=g?y:x;if(y=w+T|0,y>>>0>w>>>0){g=c[w+24>>2]|0,A=c[w+12>>2]|0;do if((A|0)==(w|0)){if(l=w+20|0,A=c[l>>2]|0,!A&&(l=w+16|0,A=c[l>>2]|0,!A)){f=0;break}for(;;)if(d=A+20|0,f=c[d>>2]|0,f)A=f,l=d;else if(d=A+16|0,f=c[d>>2]|0,f)A=f,l=d;else break;c[l>>2]=0,f=A}else f=c[w+8>>2]|0,c[f+12>>2]=A,c[A+8>>2]=f,f=A;while(0);do if(g|0){if(A=c[w+28>>2]|0,l=28212+(A<<2)|0,(w|0)==(c[l>>2]|0)){if(c[l>>2]=f,!f){c[6978]=m&~(1<<A);break}}else if(te=g+16|0,c[((c[te>>2]|0)==(w|0)?te:g+20|0)>>2]=f,!f)break;c[f+24>>2]=g,A=c[w+16>>2]|0,A|0&&(c[f+16>>2]=A,c[A+24>>2]=f),A=c[w+20>>2]|0,A|0&&(c[f+20>>2]=A,c[A+24>>2]=f)}while(0);return x>>>0<16?(te=x+T|0,c[w+4>>2]=te|3,te=w+te+4|0,c[te>>2]=c[te>>2]|1):(c[w+4>>2]=T|3,c[y+4>>2]=x|1,c[y+x>>2]=x,C|0&&(d=c[6982]|0,A=C>>>3,f=27948+(A<<1<<2)|0,A=1<<A,A&F?(l=f+8|0,A=c[l>>2]|0):(c[6977]=A|F,A=f,l=f+8|0),c[l>>2]=d,c[A+12>>2]=d,c[d+8>>2]=A,c[d+12>>2]=f),c[6979]=x,c[6982]=y),te=w+8|0,B=xe,te|0}else F=T}else F=T}else F=T}else if(l>>>0<=4294967231)if(l=l+11|0,T=l&-8,d=c[6978]|0,d){g=0-T|0,l=l>>>8,l?T>>>0>16777215?x=31:(F=(l+1048320|0)>>>16&8,J=l<<F,w=(J+520192|0)>>>16&4,J=J<<w,x=(J+245760|0)>>>16&2,x=14-(w|F|x)+(J<<x>>>15)|0,x=T>>>(x+7|0)&1|x<<1):x=0,f=c[28212+(x<<2)>>2]|0;e:do if(!f)f=0,l=0,J=61;else for(l=0,w=T<<((x|0)==31?0:25-(x>>>1)|0),m=0;;){if(y=(c[f+4>>2]&-8)-T|0,y>>>0<g>>>0)if(y)l=f,g=y;else{l=f,g=0,J=65;break e}if(J=c[f+20>>2]|0,f=c[f+16+(w>>>31<<2)>>2]|0,m=(J|0)==0|(J|0)==(f|0)?m:J,f)w=w<<1;else{f=m,J=61;break}}while(0);if((J|0)==61){if((f|0)==0&(l|0)==0){if(l=2<<x,l=(l|0-l)&d,!l){F=T;break}F=(l&0-l)+-1|0,y=F>>>12&16,F=F>>>y,m=F>>>5&8,F=F>>>m,w=F>>>2&4,F=F>>>w,x=F>>>1&2,F=F>>>x,f=F>>>1&1,l=0,f=c[28212+((m|y|w|x|f)+(F>>>f)<<2)>>2]|0}f?J=65:(w=l,y=g)}if((J|0)==65)for(m=f;;)if(F=(c[m+4>>2]&-8)-T|0,f=F>>>0<g>>>0,g=f?F:g,l=f?m:l,f=c[m+16>>2]|0,f||(f=c[m+20>>2]|0),f)m=f;else{w=l,y=g;break}if(w|0&&y>>>0<((c[6979]|0)-T|0)>>>0&&(C=w+T|0,C>>>0>w>>>0)){m=c[w+24>>2]|0,A=c[w+12>>2]|0;do if((A|0)==(w|0)){if(l=w+20|0,A=c[l>>2]|0,!A&&(l=w+16|0,A=c[l>>2]|0,!A)){A=0;break}for(;;)if(g=A+20|0,f=c[g>>2]|0,f)A=f,l=g;else if(g=A+16|0,f=c[g>>2]|0,f)A=f,l=g;else break;c[l>>2]=0}else te=c[w+8>>2]|0,c[te+12>>2]=A,c[A+8>>2]=te;while(0);do if(m){if(l=c[w+28>>2]|0,f=28212+(l<<2)|0,(w|0)==(c[f>>2]|0)){if(c[f>>2]=A,!A){d=d&~(1<<l),c[6978]=d;break}}else if(te=m+16|0,c[((c[te>>2]|0)==(w|0)?te:m+20|0)>>2]=A,!A)break;c[A+24>>2]=m,l=c[w+16>>2]|0,l|0&&(c[A+16>>2]=l,c[l+24>>2]=A),l=c[w+20>>2]|0,l&&(c[A+20>>2]=l,c[l+24>>2]=A)}while(0);e:do if(y>>>0<16)te=y+T|0,c[w+4>>2]=te|3,te=w+te+4|0,c[te>>2]=c[te>>2]|1;else{if(c[w+4>>2]=T|3,c[C+4>>2]=y|1,c[C+y>>2]=y,A=y>>>3,y>>>0<256){f=27948+(A<<1<<2)|0,l=c[6977]|0,A=1<<A,l&A?(l=f+8|0,A=c[l>>2]|0):(c[6977]=l|A,A=f,l=f+8|0),c[l>>2]=C,c[A+12>>2]=C,c[C+8>>2]=A,c[C+12>>2]=f;break}if(A=y>>>8,A?y>>>0>16777215?f=31:(ae=(A+1048320|0)>>>16&8,te=A<<ae,Ae=(te+520192|0)>>>16&4,te=te<<Ae,f=(te+245760|0)>>>16&2,f=14-(Ae|ae|f)+(te<<f>>>15)|0,f=y>>>(f+7|0)&1|f<<1):f=0,A=28212+(f<<2)|0,c[C+28>>2]=f,l=C+16|0,c[l+4>>2]=0,c[l>>2]=0,l=1<<f,!(d&l)){c[6978]=d|l,c[A>>2]=C,c[C+24>>2]=A,c[C+12>>2]=C,c[C+8>>2]=C;break}A=c[A>>2]|0;t:do if((c[A+4>>2]&-8|0)!=(y|0)){for(d=y<<((f|0)==31?0:25-(f>>>1)|0);f=A+16+(d>>>31<<2)|0,l=c[f>>2]|0,!!l;)if((c[l+4>>2]&-8|0)==(y|0)){A=l;break t}else d=d<<1,A=l;c[f>>2]=C,c[C+24>>2]=A,c[C+12>>2]=C,c[C+8>>2]=C;break e}while(0);ae=A+8|0,te=c[ae>>2]|0,c[te+12>>2]=C,c[ae>>2]=C,c[C+8>>2]=te,c[C+12>>2]=A,c[C+24>>2]=0}while(0);return te=w+8|0,B=xe,te|0}else F=T}else F=T;else F=-1;while(0);if(f=c[6979]|0,f>>>0>=F>>>0)return A=f-F|0,l=c[6982]|0,A>>>0>15?(te=l+F|0,c[6982]=te,c[6979]=A,c[te+4>>2]=A|1,c[l+f>>2]=A,c[l+4>>2]=F|3):(c[6979]=0,c[6982]=0,c[l+4>>2]=f|3,te=l+f+4|0,c[te>>2]=c[te>>2]|1),te=l+8|0,B=xe,te|0;if(y=c[6980]|0,y>>>0>F>>>0)return Ae=y-F|0,c[6980]=Ae,te=c[6983]|0,ae=te+F|0,c[6983]=ae,c[ae+4>>2]=Ae|1,c[te+4>>2]=F|3,te=te+8|0,B=xe,te|0;if(c[7095]|0?l=c[7097]|0:(c[7097]=4096,c[7096]=4096,c[7098]=-1,c[7099]=-1,c[7100]=0,c[7088]=0,c[7095]=j&-16^1431655768,l=4096),w=F+48|0,x=F+47|0,m=l+x|0,g=0-l|0,T=m&g,T>>>0<=F>>>0||(l=c[7087]|0,l|0&&(C=c[7085]|0,j=C+T|0,j>>>0<=C>>>0|j>>>0>l>>>0)))return te=0,B=xe,te|0;e:do if(c[7088]&4)A=0,J=143;else{f=c[6983]|0;t:do if(f){for(d=28356;j=c[d>>2]|0,!(j>>>0<=f>>>0&&(j+(c[d+4>>2]|0)|0)>>>0>f>>>0);)if(l=c[d+8>>2]|0,l)d=l;else{J=128;break t}if(A=m-y&g,A>>>0<2147483647)if(l=_s(A|0)|0,(l|0)==((c[d>>2]|0)+(c[d+4>>2]|0)|0)){if((l|0)!=-1){y=A,m=l,J=145;break e}}else d=l,J=136;else A=0}else J=128;while(0);do if((J|0)==128)if(f=_s(0)|0,(f|0)!=-1&&(A=f,H=c[7096]|0,X=H+-1|0,A=(X&A|0?(X+A&0-H)-A|0:0)+T|0,H=c[7085]|0,X=A+H|0,A>>>0>F>>>0&A>>>0<2147483647)){if(j=c[7087]|0,j|0&&X>>>0<=H>>>0|X>>>0>j>>>0){A=0;break}if(l=_s(A|0)|0,(l|0)==(f|0)){y=A,m=f,J=145;break e}else d=l,J=136}else A=0;while(0);do if((J|0)==136){if(f=0-A|0,!(w>>>0>A>>>0&(A>>>0<2147483647&(d|0)!=-1)))if((d|0)==-1){A=0;break}else{y=A,m=d,J=145;break e}if(l=c[7097]|0,l=x-A+l&0-l,l>>>0>=2147483647){y=A,m=d,J=145;break e}if((_s(l|0)|0)==-1){_s(f|0)|0,A=0;break}else{y=l+A|0,m=d,J=145;break e}}while(0);c[7088]=c[7088]|4,J=143}while(0);if((J|0)==143&&T>>>0<2147483647&&(Ae=_s(T|0)|0,X=_s(0)|0,ne=X-Ae|0,pe=ne>>>0>(F+40|0)>>>0,!((Ae|0)==-1|pe^1|Ae>>>0<X>>>0&((Ae|0)!=-1&(X|0)!=-1)^1))&&(y=pe?ne:A,m=Ae,J=145),(J|0)==145){A=(c[7085]|0)+y|0,c[7085]=A,A>>>0>(c[7086]|0)>>>0&&(c[7086]=A),x=c[6983]|0;e:do if(x){for(A=28356;;){if(l=c[A>>2]|0,f=c[A+4>>2]|0,(m|0)==(l+f|0)){J=154;break}if(d=c[A+8>>2]|0,d)A=d;else break}if((J|0)==154&&(ae=A+4|0,(c[A+12>>2]&8|0)==0)&&m>>>0>x>>>0&l>>>0<=x>>>0){c[ae>>2]=f+y,te=(c[6980]|0)+y|0,Ae=x+8|0,Ae=Ae&7|0?0-Ae&7:0,ae=x+Ae|0,Ae=te-Ae|0,c[6983]=ae,c[6980]=Ae,c[ae+4>>2]=Ae|1,c[x+te+4>>2]=40,c[6984]=c[7099];break}for(m>>>0<(c[6981]|0)>>>0&&(c[6981]=m),f=m+y|0,A=28356;;){if((c[A>>2]|0)==(f|0)){J=162;break}if(l=c[A+8>>2]|0,l)A=l;else break}if((J|0)==162&&!(c[A+12>>2]&8|0)){c[A>>2]=m,C=A+4|0,c[C>>2]=(c[C>>2]|0)+y,C=m+8|0,C=m+(C&7|0?0-C&7:0)|0,A=f+8|0,A=f+(A&7|0?0-A&7:0)|0,T=C+F|0,w=A-C-F|0,c[C+4>>2]=F|3;t:do if((x|0)==(A|0))te=(c[6980]|0)+w|0,c[6980]=te,c[6983]=T,c[T+4>>2]=te|1;else{if((c[6982]|0)==(A|0)){te=(c[6979]|0)+w|0,c[6979]=te,c[6982]=T,c[T+4>>2]=te|1,c[T+te>>2]=te;break}if(l=c[A+4>>2]|0,(l&3|0)==1){y=l&-8,d=l>>>3;n:do if(l>>>0<256)if(l=c[A+8>>2]|0,f=c[A+12>>2]|0,(f|0)==(l|0)){c[6977]=c[6977]&~(1<<d);break}else{c[l+12>>2]=f,c[f+8>>2]=l;break}else{m=c[A+24>>2]|0,l=c[A+12>>2]|0;do if((l|0)==(A|0)){if(f=A+16|0,d=f+4|0,l=c[d>>2]|0,l)f=d;else if(l=c[f>>2]|0,!l){l=0;break}for(;;)if(g=l+20|0,d=c[g>>2]|0,d)l=d,f=g;else if(g=l+16|0,d=c[g>>2]|0,d)l=d,f=g;else break;c[f>>2]=0}else te=c[A+8>>2]|0,c[te+12>>2]=l,c[l+8>>2]=te;while(0);if(!m)break;f=c[A+28>>2]|0,d=28212+(f<<2)|0;do if((c[d>>2]|0)!=(A|0)){if(te=m+16|0,c[((c[te>>2]|0)==(A|0)?te:m+20|0)>>2]=l,!l)break n}else{if(c[d>>2]=l,l|0)break;c[6978]=c[6978]&~(1<<f);break n}while(0);if(c[l+24>>2]=m,f=A+16|0,d=c[f>>2]|0,d|0&&(c[l+16>>2]=d,c[d+24>>2]=l),f=c[f+4>>2]|0,!f)break;c[l+20>>2]=f,c[f+24>>2]=l}while(0);A=A+y|0,g=y+w|0}else g=w;if(A=A+4|0,c[A>>2]=c[A>>2]&-2,c[T+4>>2]=g|1,c[T+g>>2]=g,A=g>>>3,g>>>0<256){f=27948+(A<<1<<2)|0,l=c[6977]|0,A=1<<A,l&A?(l=f+8|0,A=c[l>>2]|0):(c[6977]=l|A,A=f,l=f+8|0),c[l>>2]=T,c[A+12>>2]=T,c[T+8>>2]=A,c[T+12>>2]=f;break}A=g>>>8;do if(!A)d=0;else{if(g>>>0>16777215){d=31;break}ae=(A+1048320|0)>>>16&8,te=A<<ae,Ae=(te+520192|0)>>>16&4,te=te<<Ae,d=(te+245760|0)>>>16&2,d=14-(Ae|ae|d)+(te<<d>>>15)|0,d=g>>>(d+7|0)&1|d<<1}while(0);if(A=28212+(d<<2)|0,c[T+28>>2]=d,l=T+16|0,c[l+4>>2]=0,c[l>>2]=0,l=c[6978]|0,f=1<<d,!(l&f)){c[6978]=l|f,c[A>>2]=T,c[T+24>>2]=A,c[T+12>>2]=T,c[T+8>>2]=T;break}A=c[A>>2]|0;n:do if((c[A+4>>2]&-8|0)!=(g|0)){for(d=g<<((d|0)==31?0:25-(d>>>1)|0);f=A+16+(d>>>31<<2)|0,l=c[f>>2]|0,!!l;)if((c[l+4>>2]&-8|0)==(g|0)){A=l;break n}else d=d<<1,A=l;c[f>>2]=T,c[T+24>>2]=A,c[T+12>>2]=T,c[T+8>>2]=T;break t}while(0);ae=A+8|0,te=c[ae>>2]|0,c[te+12>>2]=T,c[ae>>2]=T,c[T+8>>2]=te,c[T+12>>2]=A,c[T+24>>2]=0}while(0);return te=C+8|0,B=xe,te|0}for(A=28356;l=c[A>>2]|0,!(l>>>0<=x>>>0&&(te=l+(c[A+4>>2]|0)|0,te>>>0>x>>>0));)A=c[A+8>>2]|0;g=te+-47|0,l=g+8|0,l=g+(l&7|0?0-l&7:0)|0,g=x+16|0,l=l>>>0<g>>>0?x:l,A=l+8|0,f=y+-40|0,Ae=m+8|0,Ae=Ae&7|0?0-Ae&7:0,ae=m+Ae|0,Ae=f-Ae|0,c[6983]=ae,c[6980]=Ae,c[ae+4>>2]=Ae|1,c[m+f+4>>2]=40,c[6984]=c[7099],f=l+4|0,c[f>>2]=27,c[A>>2]=c[7089],c[A+4>>2]=c[7090],c[A+8>>2]=c[7091],c[A+12>>2]=c[7092],c[7089]=m,c[7090]=y,c[7092]=0,c[7091]=A,A=l+24|0;do ae=A,A=A+4|0,c[A>>2]=7;while((ae+8|0)>>>0<te>>>0);if((l|0)!=(x|0)){if(m=l-x|0,c[f>>2]=c[f>>2]&-2,c[x+4>>2]=m|1,c[l>>2]=m,A=m>>>3,m>>>0<256){f=27948+(A<<1<<2)|0,l=c[6977]|0,A=1<<A,l&A?(l=f+8|0,A=c[l>>2]|0):(c[6977]=l|A,A=f,l=f+8|0),c[l>>2]=x,c[A+12>>2]=x,c[x+8>>2]=A,c[x+12>>2]=f;break}if(A=m>>>8,A?m>>>0>16777215?d=31:(ae=(A+1048320|0)>>>16&8,te=A<<ae,Ae=(te+520192|0)>>>16&4,te=te<<Ae,d=(te+245760|0)>>>16&2,d=14-(Ae|ae|d)+(te<<d>>>15)|0,d=m>>>(d+7|0)&1|d<<1):d=0,f=28212+(d<<2)|0,c[x+28>>2]=d,c[x+20>>2]=0,c[g>>2]=0,A=c[6978]|0,l=1<<d,!(A&l)){c[6978]=A|l,c[f>>2]=x,c[x+24>>2]=f,c[x+12>>2]=x,c[x+8>>2]=x;break}A=c[f>>2]|0;t:do if((c[A+4>>2]&-8|0)!=(m|0)){for(d=m<<((d|0)==31?0:25-(d>>>1)|0);f=A+16+(d>>>31<<2)|0,l=c[f>>2]|0,!!l;)if((c[l+4>>2]&-8|0)==(m|0)){A=l;break t}else d=d<<1,A=l;c[f>>2]=x,c[x+24>>2]=A,c[x+12>>2]=x,c[x+8>>2]=x;break e}while(0);ae=A+8|0,te=c[ae>>2]|0,c[te+12>>2]=x,c[ae>>2]=x,c[x+8>>2]=te,c[x+12>>2]=A,c[x+24>>2]=0}}else te=c[6981]|0,(te|0)==0|m>>>0<te>>>0&&(c[6981]=m),c[7089]=m,c[7090]=y,c[7092]=0,c[6986]=c[7095],c[6985]=-1,c[6990]=27948,c[6989]=27948,c[6992]=27956,c[6991]=27956,c[6994]=27964,c[6993]=27964,c[6996]=27972,c[6995]=27972,c[6998]=27980,c[6997]=27980,c[7e3]=27988,c[6999]=27988,c[7002]=27996,c[7001]=27996,c[7004]=28004,c[7003]=28004,c[7006]=28012,c[7005]=28012,c[7008]=28020,c[7007]=28020,c[7010]=28028,c[7009]=28028,c[7012]=28036,c[7011]=28036,c[7014]=28044,c[7013]=28044,c[7016]=28052,c[7015]=28052,c[7018]=28060,c[7017]=28060,c[7020]=28068,c[7019]=28068,c[7022]=28076,c[7021]=28076,c[7024]=28084,c[7023]=28084,c[7026]=28092,c[7025]=28092,c[7028]=28100,c[7027]=28100,c[7030]=28108,c[7029]=28108,c[7032]=28116,c[7031]=28116,c[7034]=28124,c[7033]=28124,c[7036]=28132,c[7035]=28132,c[7038]=28140,c[7037]=28140,c[7040]=28148,c[7039]=28148,c[7042]=28156,c[7041]=28156,c[7044]=28164,c[7043]=28164,c[7046]=28172,c[7045]=28172,c[7048]=28180,c[7047]=28180,c[7050]=28188,c[7049]=28188,c[7052]=28196,c[7051]=28196,te=y+-40|0,Ae=m+8|0,Ae=Ae&7|0?0-Ae&7:0,ae=m+Ae|0,Ae=te-Ae|0,c[6983]=ae,c[6980]=Ae,c[ae+4>>2]=Ae|1,c[m+te+4>>2]=40,c[6984]=c[7099];while(0);if(A=c[6980]|0,A>>>0>F>>>0)return Ae=A-F|0,c[6980]=Ae,te=c[6983]|0,ae=te+F|0,c[6983]=ae,c[ae+4>>2]=Ae|1,c[te+4>>2]=F|3,te=te+8|0,B=xe,te|0}return te=U8()|0,c[te>>2]=12,te=0,B=xe,te|0}function Ue(l){l=l|0;var A=0,f=0,d=0,g=0,m=0,y=0,w=0,x=0;if(l){f=l+-8|0,g=c[6981]|0,l=c[l+-4>>2]|0,A=l&-8,x=f+A|0;do if(l&1)w=f,y=f;else{if(d=c[f>>2]|0,!(l&3)||(y=f+(0-d)|0,m=d+A|0,y>>>0<g>>>0))return;if((c[6982]|0)==(y|0)){if(l=x+4|0,A=c[l>>2]|0,(A&3|0)!=3){w=y,A=m;break}c[6979]=m,c[l>>2]=A&-2,c[y+4>>2]=m|1,c[y+m>>2]=m;return}if(f=d>>>3,d>>>0<256)if(l=c[y+8>>2]|0,A=c[y+12>>2]|0,(A|0)==(l|0)){c[6977]=c[6977]&~(1<<f),w=y,A=m;break}else{c[l+12>>2]=A,c[A+8>>2]=l,w=y,A=m;break}g=c[y+24>>2]|0,l=c[y+12>>2]|0;do if((l|0)==(y|0)){if(A=y+16|0,f=A+4|0,l=c[f>>2]|0,l)A=f;else if(l=c[A>>2]|0,!l){l=0;break}for(;;)if(d=l+20|0,f=c[d>>2]|0,f)l=f,A=d;else if(d=l+16|0,f=c[d>>2]|0,f)l=f,A=d;else break;c[A>>2]=0}else w=c[y+8>>2]|0,c[w+12>>2]=l,c[l+8>>2]=w;while(0);if(g){if(A=c[y+28>>2]|0,f=28212+(A<<2)|0,(c[f>>2]|0)==(y|0)){if(c[f>>2]=l,!l){c[6978]=c[6978]&~(1<<A),w=y,A=m;break}}else if(w=g+16|0,c[((c[w>>2]|0)==(y|0)?w:g+20|0)>>2]=l,!l){w=y,A=m;break}c[l+24>>2]=g,A=y+16|0,f=c[A>>2]|0,f|0&&(c[l+16>>2]=f,c[f+24>>2]=l),A=c[A+4>>2]|0,A?(c[l+20>>2]=A,c[A+24>>2]=l,w=y,A=m):(w=y,A=m)}else w=y,A=m}while(0);if(!(y>>>0>=x>>>0)&&(l=x+4|0,d=c[l>>2]|0,!!(d&1))){if(d&2)c[l>>2]=d&-2,c[w+4>>2]=A|1,c[y+A>>2]=A,g=A;else{if((c[6983]|0)==(x|0)){if(x=(c[6980]|0)+A|0,c[6980]=x,c[6983]=w,c[w+4>>2]=x|1,(w|0)!=(c[6982]|0))return;c[6982]=0,c[6979]=0;return}if((c[6982]|0)==(x|0)){x=(c[6979]|0)+A|0,c[6979]=x,c[6982]=y,c[w+4>>2]=x|1,c[y+x>>2]=x;return}g=(d&-8)+A|0,f=d>>>3;do if(d>>>0<256)if(A=c[x+8>>2]|0,l=c[x+12>>2]|0,(l|0)==(A|0)){c[6977]=c[6977]&~(1<<f);break}else{c[A+12>>2]=l,c[l+8>>2]=A;break}else{m=c[x+24>>2]|0,l=c[x+12>>2]|0;do if((l|0)==(x|0)){if(A=x+16|0,f=A+4|0,l=c[f>>2]|0,l)A=f;else if(l=c[A>>2]|0,!l){f=0;break}for(;;)if(d=l+20|0,f=c[d>>2]|0,f)l=f,A=d;else if(d=l+16|0,f=c[d>>2]|0,f)l=f,A=d;else break;c[A>>2]=0,f=l}else f=c[x+8>>2]|0,c[f+12>>2]=l,c[l+8>>2]=f,f=l;while(0);if(m|0){if(l=c[x+28>>2]|0,A=28212+(l<<2)|0,(c[A>>2]|0)==(x|0)){if(c[A>>2]=f,!f){c[6978]=c[6978]&~(1<<l);break}}else if(d=m+16|0,c[((c[d>>2]|0)==(x|0)?d:m+20|0)>>2]=f,!f)break;c[f+24>>2]=m,l=x+16|0,A=c[l>>2]|0,A|0&&(c[f+16>>2]=A,c[A+24>>2]=f),l=c[l+4>>2]|0,l|0&&(c[f+20>>2]=l,c[l+24>>2]=f)}}while(0);if(c[w+4>>2]=g|1,c[y+g>>2]=g,(w|0)==(c[6982]|0)){c[6979]=g;return}}if(l=g>>>3,g>>>0<256){f=27948+(l<<1<<2)|0,A=c[6977]|0,l=1<<l,A&l?(A=f+8|0,l=c[A>>2]|0):(c[6977]=A|l,l=f,A=f+8|0),c[A>>2]=w,c[l+12>>2]=w,c[w+8>>2]=l,c[w+12>>2]=f;return}l=g>>>8,l?g>>>0>16777215?d=31:(y=(l+1048320|0)>>>16&8,x=l<<y,m=(x+520192|0)>>>16&4,x=x<<m,d=(x+245760|0)>>>16&2,d=14-(m|y|d)+(x<<d>>>15)|0,d=g>>>(d+7|0)&1|d<<1):d=0,l=28212+(d<<2)|0,c[w+28>>2]=d,c[w+20>>2]=0,c[w+16>>2]=0,A=c[6978]|0,f=1<<d;e:do if(!(A&f))c[6978]=A|f,c[l>>2]=w,c[w+24>>2]=l,c[w+12>>2]=w,c[w+8>>2]=w;else{l=c[l>>2]|0;t:do if((c[l+4>>2]&-8|0)!=(g|0)){for(d=g<<((d|0)==31?0:25-(d>>>1)|0);f=l+16+(d>>>31<<2)|0,A=c[f>>2]|0,!!A;)if((c[A+4>>2]&-8|0)==(g|0)){l=A;break t}else d=d<<1,l=A;c[f>>2]=w,c[w+24>>2]=l,c[w+12>>2]=w,c[w+8>>2]=w;break e}while(0);y=l+8|0,x=c[y>>2]|0,c[x+12>>2]=w,c[y>>2]=w,c[w+8>>2]=x,c[w+12>>2]=l,c[w+24>>2]=0}while(0);if(x=(c[6985]|0)+-1|0,c[6985]=x,!(x|0)){for(l=28364;l=c[l>>2]|0,l;)l=l+8|0;c[6985]=-1}}}}function Gn(l,A){l=l|0,A=A|0;var f=0;return l?(f=ui(A,l)|0,(A|l)>>>0>65535&&(f=((f>>>0)/(l>>>0)|0|0)==(A|0)?f:-1)):f=0,l=hi(f)|0,!l||!(c[l+-4>>2]&3)||ms(l|0,0,f|0)|0,l|0}function Fe(l,A,f,d){return l=l|0,A=A|0,f=f|0,d=d|0,f=l+f>>>0,qe(A+d+(f>>>0<l>>>0|0)>>>0|0),f|0|0}function _n(l,A,f,d){return l=l|0,A=A|0,f=f|0,d=d|0,d=A-d-(f>>>0>l>>>0|0)>>>0,qe(d|0),l-f>>>0|0|0}function Vv(l){return l=l|0,(l?31-(Bi(l^l-1)|0)|0:32)|0}function up(l,A,f,d,g){l=l|0,A=A|0,f=f|0,d=d|0,g=g|0;var m=0,y=0,w=0,x=0,T=0,C=0,F=0,j=0,H=0,X=0;if(C=l,x=A,T=x,y=f,j=d,w=j,!T)return m=(g|0)!=0,w?m?(c[g>>2]=l|0,c[g+4>>2]=A&0,j=0,g=0,qe(j|0),g|0):(j=0,g=0,qe(j|0),g|0):(m&&(c[g>>2]=(C>>>0)%(y>>>0),c[g+4>>2]=0),j=0,g=(C>>>0)/(y>>>0)>>>0,qe(j|0),g|0);m=(w|0)==0;do if(y){if(!m){if(m=(Bi(w|0)|0)-(Bi(T|0)|0)|0,m>>>0<=31){F=m+1|0,w=31-m|0,A=m-31>>31,y=F,l=C>>>(F>>>0)&A|T<<w,A=T>>>(F>>>0)&A,m=0,w=C<<w;break}return g?(c[g>>2]=l|0,c[g+4>>2]=x|A&0,j=0,g=0,qe(j|0),g|0):(j=0,g=0,qe(j|0),g|0)}if(m=y-1|0,m&y|0){w=(Bi(y|0)|0)+33-(Bi(T|0)|0)|0,X=64-w|0,F=32-w|0,x=F>>31,H=w-32|0,A=H>>31,y=w,l=F-1>>31&T>>>(H>>>0)|(T<<F|C>>>(w>>>0))&A,A=A&T>>>(w>>>0),m=C<<X&x,w=(T<<X|C>>>(H>>>0))&x|C<<F&w-33>>31;break}return g|0&&(c[g>>2]=m&C,c[g+4>>2]=0),(y|0)==1?(H=x|A&0,X=l|0|0,qe(H|0),X|0):(X=Vv(y|0)|0,H=T>>>(X>>>0)|0,X=T<<32-X|C>>>(X>>>0)|0,qe(H|0),X|0)}else{if(m)return g|0&&(c[g>>2]=(T>>>0)%(y>>>0),c[g+4>>2]=0),H=0,X=(T>>>0)/(y>>>0)>>>0,qe(H|0),X|0;if(!C)return g|0&&(c[g>>2]=0,c[g+4>>2]=(T>>>0)%(w>>>0)),H=0,X=(T>>>0)/(w>>>0)>>>0,qe(H|0),X|0;if(m=w-1|0,!(m&w))return g|0&&(c[g>>2]=l|0,c[g+4>>2]=m&T|A&0),H=0,X=T>>>((Vv(w|0)|0)>>>0),qe(H|0),X|0;if(m=(Bi(w|0)|0)-(Bi(T|0)|0)|0,m>>>0<=30){A=m+1|0,w=31-m|0,y=A,l=T<<w|C>>>(A>>>0),A=T>>>(A>>>0),m=0,w=C<<w;break}return g?(c[g>>2]=l|0,c[g+4>>2]=x|A&0,H=0,X=0,qe(H|0),X|0):(H=0,X=0,qe(H|0),X|0)}while(0);if(!y)T=w,x=0,w=0;else{F=f|0|0,C=j|d&0,T=Fe(F|0,C|0,-1,-1)|0,f=z()|0,x=w,w=0;do d=x,x=m>>>31|x<<1,m=w|m<<1,d=l<<1|d>>>31|0,j=l>>>31|A<<1|0,_n(T|0,f|0,d|0,j|0)|0,X=z()|0,H=X>>31|((X|0)<0?-1:0)<<1,w=H&1,l=_n(d|0,j|0,H&F|0,(((X|0)<0?-1:0)>>31|((X|0)<0?-1:0)<<1)&C|0)|0,A=z()|0,y=y-1|0;while(y|0);T=x,x=0}return y=0,g|0&&(c[g>>2]=l,c[g+4>>2]=A),H=(m|0)>>>31|(T|y)<<1|(y<<1|m>>>31)&0|x,X=(m<<1|0)&-2|w,qe(H|0),X|0}function gs(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0;return T=A>>31|((A|0)<0?-1:0)<<1,x=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,m=d>>31|((d|0)<0?-1:0)<<1,g=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,w=_n(T^l|0,x^A|0,T|0,x|0)|0,y=z()|0,l=m^T,A=g^x,_n((up(w,y,_n(m^f|0,g^d|0,m|0,g|0)|0,z()|0,0)|0)^l|0,(z()|0)^A|0,l|0,A|0)|0}function z8(l,A){l=l|0,A=A|0;var f=0,d=0,g=0,m=0;return m=l&65535,g=A&65535,f=ui(g,m)|0,d=l>>>16,l=(f>>>16)+(ui(g,d)|0)|0,g=A>>>16,A=ui(g,m)|0,qe((l>>>16)+(ui(g,d)|0)+(((l&65535)+A|0)>>>16)|0),l+A<<16|f&65535|0|0}function un(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0;return g=l,m=f,f=z8(g,m)|0,l=z()|0,qe((ui(A,m)|0)+(ui(d,g)|0)+l|l&0|0),f|0|0|0}function Ta(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0,y=0,w=0,x=0,T=0;return g=B,B=B+16|0,w=g|0,y=A>>31|((A|0)<0?-1:0)<<1,m=((A|0)<0?-1:0)>>31|((A|0)<0?-1:0)<<1,T=d>>31|((d|0)<0?-1:0)<<1,x=((d|0)<0?-1:0)>>31|((d|0)<0?-1:0)<<1,l=_n(y^l|0,m^A|0,y|0,m|0)|0,A=z()|0,up(l,A,_n(T^f|0,x^d|0,T|0,x|0)|0,z()|0,w)|0,d=_n(c[w>>2]^y|0,c[w+4>>2]^m|0,y|0,m|0)|0,f=z()|0,B=g,qe(f|0),d|0}function Ea(l,A,f,d){l=l|0,A=A|0,f=f|0,d=d|0;var g=0,m=0;return m=B,B=B+16|0,g=m|0,up(l,A,f,d,g)|0,B=m,qe(c[g+4>>2]|0),c[g>>2]|0|0}function $v(l,A,f){return l=l|0,A=A|0,f=f|0,(f|0)<32?(qe(A>>f|0),l>>>f|(A&(1<<f)-1)<<32-f):(qe(((A|0)<0?-1:0)|0),A>>f-32|0)}function ye(l,A,f){return l=l|0,A=A|0,f=f|0,(f|0)<32?(qe(A>>>f|0),l>>>f|(A&(1<<f)-1)<<32-f):(qe(0),A>>>f-32|0)}function Te(l,A,f){return l=l|0,A=A|0,f=f|0,(f|0)<32?(qe(A<<f|(l&(1<<f)-1<<32-f)>>>32-f|0),l<<f):(qe(l<<f-32|0),0)}function Wv(l,A,f){return l=l|0,A=A|0,A=Bi(A)|0,(A|0)==32&&(A=A+(Bi(l)|0)|0),qe(0),A|0}function jv(l,A){return l=+l,A=+A,l!=l?+A:A!=A?+l:+YM(+l,+A)}function Ou(l,A){return l=+l,A=+A,l!=l?+A:A!=A?+l:+zd(+l,+A)}function Nu(l){return l=+l,l>=0?+cn(l+.5):+ya(l-.5)}function Sa(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0;if((f|0)>=8192)return ZM(l|0,A|0,f|0)|0,l|0;if(m=l|0,g=l+f|0,(l&3)==(A&3)){for(;l&3;){if(!f)return m|0;_e[l>>0]=_e[A>>0]|0,l=l+1|0,A=A+1|0,f=f-1|0}for(f=g&-4|0,d=f-64|0;(l|0)<=(d|0);)c[l>>2]=c[A>>2],c[l+4>>2]=c[A+4>>2],c[l+8>>2]=c[A+8>>2],c[l+12>>2]=c[A+12>>2],c[l+16>>2]=c[A+16>>2],c[l+20>>2]=c[A+20>>2],c[l+24>>2]=c[A+24>>2],c[l+28>>2]=c[A+28>>2],c[l+32>>2]=c[A+32>>2],c[l+36>>2]=c[A+36>>2],c[l+40>>2]=c[A+40>>2],c[l+44>>2]=c[A+44>>2],c[l+48>>2]=c[A+48>>2],c[l+52>>2]=c[A+52>>2],c[l+56>>2]=c[A+56>>2],c[l+60>>2]=c[A+60>>2],l=l+64|0,A=A+64|0;for(;(l|0)<(f|0);)c[l>>2]=c[A>>2],l=l+4|0,A=A+4|0}else for(f=g-4|0;(l|0)<(f|0);)_e[l>>0]=_e[A>>0]|0,_e[l+1>>0]=_e[A+1>>0]|0,_e[l+2>>0]=_e[A+2>>0]|0,_e[l+3>>0]=_e[A+3>>0]|0,l=l+4|0,A=A+4|0;for(;(l|0)<(g|0);)_e[l>>0]=_e[A>>0]|0,l=l+1|0,A=A+1|0;return m|0}function ms(l,A,f){l=l|0,A=A|0,f=f|0;var d=0,g=0,m=0,y=0;if(m=l+f|0,A=A&255,(f|0)>=67){for(;l&3;)_e[l>>0]=A,l=l+1|0;for(d=m&-4|0,y=A|A<<8|A<<16|A<<24,g=d-64|0;(l|0)<=(g|0);)c[l>>2]=y,c[l+4>>2]=y,c[l+8>>2]=y,c[l+12>>2]=y,c[l+16>>2]=y,c[l+20>>2]=y,c[l+24>>2]=y,c[l+28>>2]=y,c[l+32>>2]=y,c[l+36>>2]=y,c[l+40>>2]=y,c[l+44>>2]=y,c[l+48>>2]=y,c[l+52>>2]=y,c[l+56>>2]=y,c[l+60>>2]=y,l=l+64|0;for(;(l|0)<(d|0);)c[l>>2]=y,l=l+4|0}for(;(l|0)<(m|0);)_e[l>>0]=A,l=l+1|0;return m-f|0}function Hv(l){return l=+l,l>=0?+cn(l+.5):+ya(l-.5)}function _s(l){l=l|0;var A=0,f=0,d=0;return d=qM()|0,f=c[yt>>2]|0,A=f+l|0,(l|0)>0&(A|0)<(f|0)|(A|0)<0?(GM(A|0)|0,ev(12),-1):(A|0)>(d|0)&&!(KM(A|0)|0)?(ev(12),-1):(c[yt>>2]=A,f|0)}return{___divdi3:gs,___muldi3:un,___remdi3:Ta,___uremdi3:Ea,_areNeighborCells:R6,_bitshift64Ashr:$v,_bitshift64Lshr:ye,_bitshift64Shl:Te,_calloc:Gn,_cellAreaKm2:o8,_cellAreaM2:a8,_cellAreaRads2:ap,_cellToBoundary:ba,_cellToCenterChild:xv,_cellToChildPos:K6,_cellToChildren:$6,_cellToChildrenSize:sc,_cellToLatLng:bo,_cellToLocalIj:d8,_cellToParent:Jd,_cellToVertex:Sr,_cellToVertexes:O8,_cellsToDirectedEdge:k6,_cellsToLinkedMultiPolygon:A6,_childPosToCell:G6,_compactCells:W6,_destroyLinkedMultiPolygon:Pv,_directedEdgeToBoundary:Ru,_directedEdgeToCells:N6,_edgeLengthKm:c8,_edgeLengthM:A8,_edgeLengthRads:l8,_emscripten_replace_memory:JM,_free:Ue,_getBaseCellNumber:wv,_getDirectedEdgeDestination:M6,_getDirectedEdgeOrigin:I6,_getHexagonAreaAvgKm2:Sv,_getHexagonAreaAvgM2:r8,_getHexagonEdgeLengthAvgKm:i8,_getHexagonEdgeLengthAvgM:s8,_getIcosahedronFaces:Tv,_getNumCells:ku,_getPentagons:ip,_getRes0Cells:p6,_getResolution:V6,_greatCircleDistanceKm:ac,_greatCircleDistanceM:e8,_greatCircleDistanceRads:J6,_gridDisk:tv,_gridDiskDistances:nv,_gridDistance:g8,_gridPathCells:_8,_gridPathCellsSize:m8,_gridRing:s6,_gridRingUnsafe:iv,_i64Add:Fe,_i64Subtract:_n,_isPentagon:Et,_isResClassIII:X6,_isValidCell:Kd,_isValidDirectedEdge:O6,_isValidVertex:D8,_latLngToCell:np,_llvm_ctlz_i64:Wv,_llvm_maxnum_f64:jv,_llvm_minnum_f64:Ou,_llvm_round_f64:Nu,_localIjToCell:p8,_malloc:hi,_maxFaceCount:q6,_maxGridDiskSize:i6,_maxPolygonToCellsSize:a6,_maxPolygonToCellsSizeExperimental:w8,_memcpy:Sa,_memset:ms,_originToDirectedEdges:D6,_pentagonCount:Z6,_polygonToCells:l6,_polygonToCellsExperimental:v8,_readInt64AsDoubleFromPointer:R8,_res0CellCount:d6,_round:Hv,_sbrk:_s,_sizeOfCellBoundary:T8,_sizeOfCoordIJ:P8,_sizeOfGeoLoop:E8,_sizeOfGeoPolygon:S8,_sizeOfH3Index:b8,_sizeOfLatLng:x8,_sizeOfLinkedGeoPolygon:C8,_uncompactCells:j6,_uncompactCellsSize:H6,_vertexToLatLng:N8,establishStackSpace:r6,stackAlloc:e6,stackRestore:n6,stackSave:t6}}($M,WM,$);e.___divdi3=ve.___divdi3,e.___muldi3=ve.___muldi3,e.___remdi3=ve.___remdi3,e.___uremdi3=ve.___uremdi3,e._areNeighborCells=ve._areNeighborCells,e._bitshift64Ashr=ve._bitshift64Ashr,e._bitshift64Lshr=ve._bitshift64Lshr,e._bitshift64Shl=ve._bitshift64Shl,e._calloc=ve._calloc,e._cellAreaKm2=ve._cellAreaKm2,e._cellAreaM2=ve._cellAreaM2,e._cellAreaRads2=ve._cellAreaRads2,e._cellToBoundary=ve._cellToBoundary,e._cellToCenterChild=ve._cellToCenterChild,e._cellToChildPos=ve._cellToChildPos,e._cellToChildren=ve._cellToChildren,e._cellToChildrenSize=ve._cellToChildrenSize,e._cellToLatLng=ve._cellToLatLng,e._cellToLocalIj=ve._cellToLocalIj,e._cellToParent=ve._cellToParent,e._cellToVertex=ve._cellToVertex,e._cellToVertexes=ve._cellToVertexes,e._cellsToDirectedEdge=ve._cellsToDirectedEdge,e._cellsToLinkedMultiPolygon=ve._cellsToLinkedMultiPolygon,e._childPosToCell=ve._childPosToCell,e._compactCells=ve._compactCells,e._destroyLinkedMultiPolygon=ve._destroyLinkedMultiPolygon,e._directedEdgeToBoundary=ve._directedEdgeToBoundary,e._directedEdgeToCells=ve._directedEdgeToCells,e._edgeLengthKm=ve._edgeLengthKm,e._edgeLengthM=ve._edgeLengthM,e._edgeLengthRads=ve._edgeLengthRads;var jM=e._emscripten_replace_memory=ve._emscripten_replace_memory;e._free=ve._free,e._getBaseCellNumber=ve._getBaseCellNumber,e._getDirectedEdgeDestination=ve._getDirectedEdgeDestination,e._getDirectedEdgeOrigin=ve._getDirectedEdgeOrigin,e._getHexagonAreaAvgKm2=ve._getHexagonAreaAvgKm2,e._getHexagonAreaAvgM2=ve._getHexagonAreaAvgM2,e._getHexagonEdgeLengthAvgKm=ve._getHexagonEdgeLengthAvgKm,e._getHexagonEdgeLengthAvgM=ve._getHexagonEdgeLengthAvgM,e._getIcosahedronFaces=ve._getIcosahedronFaces,e._getNumCells=ve._getNumCells,e._getPentagons=ve._getPentagons,e._getRes0Cells=ve._getRes0Cells,e._getResolution=ve._getResolution,e._greatCircleDistanceKm=ve._greatCircleDistanceKm,e._greatCircleDistanceM=ve._greatCircleDistanceM,e._greatCircleDistanceRads=ve._greatCircleDistanceRads,e._gridDisk=ve._gridDisk,e._gridDiskDistances=ve._gridDiskDistances,e._gridDistance=ve._gridDistance,e._gridPathCells=ve._gridPathCells,e._gridPathCellsSize=ve._gridPathCellsSize,e._gridRing=ve._gridRing,e._gridRingUnsafe=ve._gridRingUnsafe,e._i64Add=ve._i64Add,e._i64Subtract=ve._i64Subtract,e._isPentagon=ve._isPentagon,e._isResClassIII=ve._isResClassIII,e._isValidCell=ve._isValidCell,e._isValidDirectedEdge=ve._isValidDirectedEdge,e._isValidVertex=ve._isValidVertex,e._latLngToCell=ve._latLngToCell,e._llvm_ctlz_i64=ve._llvm_ctlz_i64,e._llvm_maxnum_f64=ve._llvm_maxnum_f64,e._llvm_minnum_f64=ve._llvm_minnum_f64,e._llvm_round_f64=ve._llvm_round_f64,e._localIjToCell=ve._localIjToCell,e._malloc=ve._malloc,e._maxFaceCount=ve._maxFaceCount,e._maxGridDiskSize=ve._maxGridDiskSize,e._maxPolygonToCellsSize=ve._maxPolygonToCellsSize,e._maxPolygonToCellsSizeExperimental=ve._maxPolygonToCellsSizeExperimental,e._memcpy=ve._memcpy,e._memset=ve._memset,e._originToDirectedEdges=ve._originToDirectedEdges,e._pentagonCount=ve._pentagonCount,e._polygonToCells=ve._polygonToCells,e._polygonToCellsExperimental=ve._polygonToCellsExperimental,e._readInt64AsDoubleFromPointer=ve._readInt64AsDoubleFromPointer,e._res0CellCount=ve._res0CellCount,e._round=ve._round,e._sbrk=ve._sbrk,e._sizeOfCellBoundary=ve._sizeOfCellBoundary,e._sizeOfCoordIJ=ve._sizeOfCoordIJ,e._sizeOfGeoLoop=ve._sizeOfGeoLoop,e._sizeOfGeoPolygon=ve._sizeOfGeoPolygon,e._sizeOfH3Index=ve._sizeOfH3Index,e._sizeOfLatLng=ve._sizeOfLatLng,e._sizeOfLinkedGeoPolygon=ve._sizeOfLinkedGeoPolygon,e._uncompactCells=ve._uncompactCells,e._uncompactCellsSize=ve._uncompactCellsSize,e._vertexToLatLng=ve._vertexToLatLng,e.establishStackSpace=ve.establishStackSpace;var Zy=e.stackAlloc=ve.stackAlloc,HM=e.stackRestore=ve.stackRestore,XM=e.stackSave=ve.stackSave;if(e.asm=ve,e.cwrap=k,e.setValue=b,e.getValue=E,Di){Hy(Di)||(Di=s(Di));{kM();var Ld=function(he){he.byteLength&&(he=new Uint8Array(he)),Z.set(he,v),e.memoryInitializerRequest&&delete e.memoryInitializerRequest.response,IM()},Ky=function(){o(Di,Ld,function(){throw"could not load memory initializer "+Di})},Gy=Bd(Di);if(Gy)Ld(Gy.buffer);else if(e.memoryInitializerRequest){var Jy=function(){var he=e.memoryInitializerRequest,me=he.response;if(he.status!==200&&he.status!==0){var Pe=Bd(e.memoryInitializerRequestURL);if(Pe)me=Pe.buffer;else{console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+he.status+", retrying "+Di),Ky();return}}Ld(me)};e.memoryInitializerRequest.response?setTimeout(Jy,0):e.memoryInitializerRequest.addEventListener("load",Jy)}else Ky()}}var Tu;rc=function he(){Tu||Fd(),Tu||(rc=he)};function Fd(he){if(go>0||(zt(),go>0))return;function me(){Tu||(Tu=!0,!R&&(ma(),tc(),e.onRuntimeInitialized&&e.onRuntimeInitialized(),nc()))}e.setStatus?(e.setStatus("Running..."),setTimeout(function(){setTimeout(function(){e.setStatus("")},1),me()},1)):me()}e.run=Fd;function mo(he){throw e.onAbort&&e.onAbort(he),he+="",a(he),u(he),R=!0,"abort("+he+"). Build with -s ASSERTIONS=1 for more info."}if(e.abort=mo,e.preInit)for(typeof e.preInit=="function"&&(e.preInit=[e.preInit]);e.preInit.length>0;)e.preInit.pop()();return Fd(),t}(typeof Ot=="object"?Ot:{}),Qe="number",Ve=Qe,Tc=Qe,He=Qe,Xe=Qe,hn=Qe,Oe=Qe,yY=[["sizeOfH3Index",Qe],["sizeOfLatLng",Qe],["sizeOfCellBoundary",Qe],["sizeOfGeoLoop",Qe],["sizeOfGeoPolygon",Qe],["sizeOfLinkedGeoPolygon",Qe],["sizeOfCoordIJ",Qe],["readInt64AsDoubleFromPointer",Qe],["isValidCell",Tc,[He,Xe]],["latLngToCell",Ve,[Qe,Qe,hn,Oe]],["cellToLatLng",Ve,[He,Xe,Oe]],["cellToBoundary",Ve,[He,Xe,Oe]],["maxGridDiskSize",Ve,[Qe,Oe]],["gridDisk",Ve,[He,Xe,Qe,Oe]],["gridDiskDistances",Ve,[He,Xe,Qe,Oe,Oe]],["gridRing",Ve,[He,Xe,Qe,Oe]],["gridRingUnsafe",Ve,[He,Xe,Qe,Oe]],["maxPolygonToCellsSize",Ve,[Oe,hn,Qe,Oe]],["polygonToCells",Ve,[Oe,hn,Qe,Oe]],["maxPolygonToCellsSizeExperimental",Ve,[Oe,hn,Qe,Oe]],["polygonToCellsExperimental",Ve,[Oe,hn,Qe,Qe,Qe,Oe]],["cellsToLinkedMultiPolygon",Ve,[Oe,Qe,Oe]],["destroyLinkedMultiPolygon",null,[Oe]],["compactCells",Ve,[Oe,Oe,Qe,Qe]],["uncompactCells",Ve,[Oe,Qe,Qe,Oe,Qe,hn]],["uncompactCellsSize",Ve,[Oe,Qe,Qe,hn,Oe]],["isPentagon",Tc,[He,Xe]],["isResClassIII",Tc,[He,Xe]],["getBaseCellNumber",Qe,[He,Xe]],["getResolution",Qe,[He,Xe]],["maxFaceCount",Ve,[He,Xe,Oe]],["getIcosahedronFaces",Ve,[He,Xe,Oe]],["cellToParent",Ve,[He,Xe,hn,Oe]],["cellToChildren",Ve,[He,Xe,hn,Oe]],["cellToCenterChild",Ve,[He,Xe,hn,Oe]],["cellToChildrenSize",Ve,[He,Xe,hn,Oe]],["cellToChildPos",Ve,[He,Xe,hn,Oe]],["childPosToCell",Ve,[Qe,Qe,He,Xe,hn,Oe]],["areNeighborCells",Ve,[He,Xe,He,Xe,Oe]],["cellsToDirectedEdge",Ve,[He,Xe,He,Xe,Oe]],["getDirectedEdgeOrigin",Ve,[He,Xe,Oe]],["getDirectedEdgeDestination",Ve,[He,Xe,Oe]],["isValidDirectedEdge",Tc,[He,Xe]],["directedEdgeToCells",Ve,[He,Xe,Oe]],["originToDirectedEdges",Ve,[He,Xe,Oe]],["directedEdgeToBoundary",Ve,[He,Xe,Oe]],["gridDistance",Ve,[He,Xe,He,Xe,Oe]],["gridPathCells",Ve,[He,Xe,He,Xe,Oe]],["gridPathCellsSize",Ve,[He,Xe,He,Xe,Oe]],["cellToLocalIj",Ve,[He,Xe,He,Xe,Qe,Oe]],["localIjToCell",Ve,[He,Xe,Oe,Qe,Oe]],["getHexagonAreaAvgM2",Ve,[hn,Oe]],["getHexagonAreaAvgKm2",Ve,[hn,Oe]],["getHexagonEdgeLengthAvgM",Ve,[hn,Oe]],["getHexagonEdgeLengthAvgKm",Ve,[hn,Oe]],["greatCircleDistanceM",Qe,[Oe,Oe]],["greatCircleDistanceKm",Qe,[Oe,Oe]],["greatCircleDistanceRads",Qe,[Oe,Oe]],["cellAreaM2",Ve,[He,Xe,Oe]],["cellAreaKm2",Ve,[He,Xe,Oe]],["cellAreaRads2",Ve,[He,Xe,Oe]],["edgeLengthM",Ve,[He,Xe,Oe]],["edgeLengthKm",Ve,[He,Xe,Oe]],["edgeLengthRads",Ve,[He,Xe,Oe]],["getNumCells",Ve,[hn,Oe]],["getRes0Cells",Ve,[Oe]],["res0CellCount",Qe],["getPentagons",Ve,[Qe,Oe]],["pentagonCount",Qe],["cellToVertex",Ve,[He,Xe,Qe,Oe]],["cellToVertexes",Ve,[He,Xe,Oe]],["vertexToLatLng",Ve,[He,Xe,Oe]],["isValidVertex",Tc,[He,Xe]]],vY=0,wY=1,bY=2,xY=3,pk=4,TY=5,EY=6,SY=7,CY=8,PY=9,RY=10,kY=11,IY=12,MY=13,OY=14,NY=15,Cn={};Cn[vY]="Success";Cn[wY]="The operation failed but a more specific error is not available";Cn[bY]="Argument was outside of acceptable range";Cn[xY]="Latitude or longitude arguments were outside of acceptable range";Cn[pk]="Resolution argument was outside of acceptable range";Cn[TY]="Cell argument was not valid";Cn[EY]="Directed edge argument was not valid";Cn[SY]="Undirected edge argument was not valid";Cn[CY]="Vertex argument was not valid";Cn[PY]="Pentagon distortion was encountered";Cn[RY]="Duplicate input";Cn[kY]="Cell arguments were not neighbors";Cn[IY]="Cell arguments had incompatible resolutions";Cn[MY]="Memory allocation failed";Cn[OY]="Bounds of provided memory were insufficient";Cn[NY]="Mode or flags argument was not valid";var DY=1e3,gk=1001,BY=1002,Ed={};Ed[DY]="Unknown unit";Ed[gk]="Array length out of bounds";Ed[BY]="Got unexpected null value for H3 index";var LY="Unknown error";function mk(t,e,n){var r=n&&"value"in n,i=new Error((t[e]||LY)+" (code: "+e+(r?", value: "+n.value:"")+")");return i.code=e,i}function _k(t,e){var n=arguments.length===2?{value:e}:{};return mk(Cn,t,n)}function FY(t,e){var n=arguments.length===2?{value:e}:{};return mk(Ed,t,n)}function Yx(t){if(t!==0)throw _k(t)}var yr={};yY.forEach(function(e){yr[e[0]]=Ot.cwrap.apply(Ot,e)});var hl=16,XA=4,UY=8,zY=8,B_=yr.sizeOfH3Index(),VY=yr.sizeOfLatLng();yr.sizeOfCellBoundary();var $Y=yr.sizeOfGeoPolygon(),cA=yr.sizeOfGeoLoop();yr.sizeOfLinkedGeoPolygon();yr.sizeOfCoordIJ();function WY(t){if(typeof t!="number"||t<0||t>15||Math.floor(t)!==t)throw _k(pk,t);return t}var jY=Math.pow(2,32)-1;function HY(t){if(t>jY)throw FY(gk,t);return t}var XY=/[^0-9a-fA-F]/;function QY(t){if(Array.isArray(t)&&t.length===2&&Number.isInteger(t[0])&&Number.isInteger(t[1]))return t;if(typeof t!="string"||XY.test(t))return[0,0];var e=parseInt(t.substring(0,t.length-8),hl),n=parseInt(t.substring(t.length-8),hl);return[n,e]}function qx(t){if(t>=0)return t.toString(hl);t=t&2147483647;var e=yk(8,t.toString(hl)),n=(parseInt(e[0],hl)+8).toString(hl);return e=n+e.substring(1),e}function YY(t,e){return qx(e)+yk(8,qx(t))}function yk(t,e){for(var n=t-e.length,r="",i=0;i<n;i++)r+="0";return r=r+e,r}function Zx(t,e,n){for(var r=t.length,i=Ot._calloc(r,VY),s=n?1:0,o=n?0:1,a=0;a<r*2;a+=2)Ot.HEAPF64.set([t[a/2][s],t[a/2][o]].map(tq),i/UY+a);return Ot.HEAPU32.set([r,i],e/XA),e}function qY(t,e){var n=t.length-1,r=Ot._calloc($Y),i=0,s=i+cA,o=s+XA;Zx(t[0],r+i,e);var a;if(n>0){a=Ot._calloc(n,cA);for(var u=0;u<n;u++)Zx(t[u+1],a+cA*u,e)}return Ot.setValue(r+s,n,"i32"),Ot.setValue(r+o,a,"i32"),r}function ZY(t){var e=0,n=e+cA,r=n+XA,i=XA;Ot._free(Ot.getValue(t+e+i,"i8*"));var s=Ot.getValue(t+n,"i32");if(s>0){for(var o=Ot.getValue(t+r,"i32"),a=0;a<s;a++)Ot._free(Ot.getValue(o+cA*a+i,"i8*"));Ot._free(o)}Ot._free(t)}function KY(t,e){e===void 0&&(e=0);var n=Ot.getValue(t+B_*e,"i32"),r=Ot.getValue(t+B_*e+XA,"i32");return r?YY(n,r):null}function GY(t){return yr.readInt64AsDoubleFromPointer(t)}function JY(t,e){for(var n=[],r=0;r<e;r++){var i=KY(t,r);i!==null&&n.push(i)}return n}function eq(t){var e=QY(t),n=e[0],r=e[1];return yr.isValidCell(n,r)?yr.getResolution(n,r):-1}function Kx(t,e,n){if(WY(e),n=!!n,t.length===0||t[0].length===0)return[];var r=typeof t[0][0]=="number"?[t]:t,i=qY(r,n),s=Ot._malloc(zY);try{Yx(yr.maxPolygonToCellsSize(i,e,0,s));var o=HY(GY(s)),a=Ot._calloc(o,B_);try{return Yx(yr.polygonToCells(i,e,0,a)),JY(a,o)}finally{Ot._free(a)}}finally{Ot._free(s),ZY(i)}}function tq(t){return t*Math.PI/180}class nq{constructor(e){this.index=e,this.isVisible=!1,this.isSelected=!1,this.parent=null,this.children=[],this.content=null,this._loader=void 0,this._abortController=null,this._loaderId=0,this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1}get bbox(){return this._bbox}set bbox(e){this._bbox||(this._bbox=e,"west"in e?this.boundingBox=[[e.west,e.south],[e.east,e.north]]:this.boundingBox=[[e.left,e.top],[e.right,e.bottom]])}get data(){return this.isLoading&&this._loader?this._loader.then(()=>this.data):this.content}get isLoaded(){return this._isLoaded&&!this._needsReload}get isLoading(){return!!this._loader&&!this._isCancelled}get needsReload(){return this._needsReload||this._isCancelled}get byteLength(){const e=this.content?this.content.byteLength:0;return Number.isFinite(e)||console.error("byteLength not defined in tile data"),e}async _loadData({getData:e,requestScheduler:n,onLoad:r,onError:i}){const{index:s,id:o,bbox:a,userData:u,zoom:h}=this,p=this._loaderId;this._abortController=new AbortController;const{signal:_}=this._abortController,v=await n.scheduleRequest(this,R=>R.isSelected?1:-1);if(!v){this._isCancelled=!0;return}if(this._isCancelled){v.done();return}let b=null,E;try{b=await e({index:s,id:o,bbox:a,userData:u,zoom:h,signal:_})}catch(R){E=R||!0}finally{v.done()}if(p===this._loaderId){if(this._loader=void 0,this.content=b,this._isCancelled&&!b){this._isLoaded=!1;return}this._isLoaded=!0,this._isCancelled=!1,E?i(E,this):r(this)}}loadData(e){return this._isLoaded=!1,this._isCancelled=!1,this._needsReload=!1,this._loaderId++,this._loader=this._loadData(e),this._loader}setNeedsReload(){this.isLoading&&(this.abort(),this._loader=void 0),this._needsReload=!0}abort(){var e;this.isLoaded||(this._isCancelled=!0,(e=this._abortController)==null||e.abort())}}const Bn={OUTSIDE:-1,INTERSECTING:0,INSIDE:1},Gx=new Ne,rq=new Ne;class ay{constructor(e=[0,0,0],n=[0,0,0],r){r=r||Gx.copy(e).add(n).scale(.5),this.center=new Ne(r),this.halfDiagonal=new Ne(n).subtract(this.center),this.minimum=new Ne(e),this.maximum=new Ne(n)}clone(){return new ay(this.minimum,this.maximum,this.center)}equals(e){return this===e||!!e&&this.minimum.equals(e.minimum)&&this.maximum.equals(e.maximum)}transform(e){return this.center.transformAsPoint(e),this.halfDiagonal.transform(e),this.minimum.transform(e),this.maximum.transform(e),this}intersectPlane(e){const{halfDiagonal:n}=this,r=rq.from(e.normal),i=n.x*Math.abs(r.x)+n.y*Math.abs(r.y)+n.z*Math.abs(r.z),s=this.center.dot(r)+e.distance;return s-i>0?Bn.INSIDE:s+i<0?Bn.OUTSIDE:Bn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=Gx.from(e).subtract(this.center),{halfDiagonal:r}=this;let i=0,s;return s=Math.abs(n.x)-r.x,s>0&&(i+=s*s),s=Math.abs(n.y)-r.y,s>0&&(i+=s*s),s=Math.abs(n.z)-r.z,s>0&&(i+=s*s),i}}const Ec=new Ne,Jx=new Ne;class ly{constructor(e=[0,0,0],n=0){this.radius=-0,this.center=new Ne,this.fromCenterRadius(e,n)}fromCenterRadius(e,n){return this.center.from(e),this.radius=n,this}fromCornerPoints(e,n){return n=Ec.from(n),this.center=new Ne().from(e).add(n).scale(.5),this.radius=this.center.distance(n),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new ly(this.center,this.radius)}union(e){const n=this.center,r=this.radius,i=e.center,s=e.radius,o=Ec.copy(i).subtract(n),a=o.magnitude();if(r>=a+s)return this.clone();if(s>=a+r)return e.clone();const u=(r+a+s)*.5;return Jx.copy(o).scale((-r+u)/a).add(n),this.center.copy(Jx),this.radius=u,this}expand(e){const r=Ec.from(e).subtract(this.center).magnitude();return r>this.radius&&(this.radius=r),this}transform(e){this.center.transform(e);const n=G7(Ec,e);return this.radius=Math.max(n[0],Math.max(n[1],n[2]))*this.radius,this}distanceSquaredTo(e){const n=this.distanceTo(e);return n*n}distanceTo(e){const r=Ec.from(e).subtract(this.center);return Math.max(0,r.len()-this.radius)}intersectPlane(e){const n=this.center,r=this.radius,s=e.normal.dot(n)+e.distance;return s<-r?Bn.OUTSIDE:s<r?Bn.INTERSECTING:Bn.INSIDE}}const iq=new Ne,sq=new Ne,Tf=new Ne,Ef=new Ne,Sf=new Ne,oq=new Ne,aq=new Ne,Fi={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class cy{constructor(e=[0,0,0],n=[0,0,0,0,0,0,0,0,0]){this.center=new Ne().from(e),this.halfAxes=new xn(n)}get halfSize(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new Ne(e).len(),new Ne(n).len(),new Ne(r).len()]}get quaternion(){const e=this.halfAxes.getColumn(0),n=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new Ne(e).normalize(),s=new Ne(n).normalize(),o=new Ne(r).normalize();return new ob().fromMatrix3(new xn([...i,...s,...o]))}fromCenterHalfSizeQuaternion(e,n,r){const i=new ob(r),s=new xn().fromQuaternion(i);return s[0]=s[0]*n[0],s[1]=s[1]*n[0],s[2]=s[2]*n[0],s[3]=s[3]*n[1],s[4]=s[4]*n[1],s[5]=s[5]*n[1],s[6]=s[6]*n[2],s[7]=s[7]*n[2],s[8]=s[8]*n[2],this.center=new Ne().from(e),this.halfAxes=s,this}clone(){return new cy(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new ly){const n=this.halfAxes,r=n.getColumn(0,Tf),i=n.getColumn(1,Ef),s=n.getColumn(2,Sf),o=iq.copy(r).add(i).add(s);return e.center.copy(this.center),e.radius=o.magnitude(),e}intersectPlane(e){const n=this.center,r=e.normal,i=this.halfAxes,s=r.x,o=r.y,a=r.z,u=Math.abs(s*i[Fi.COLUMN0ROW0]+o*i[Fi.COLUMN0ROW1]+a*i[Fi.COLUMN0ROW2])+Math.abs(s*i[Fi.COLUMN1ROW0]+o*i[Fi.COLUMN1ROW1]+a*i[Fi.COLUMN1ROW2])+Math.abs(s*i[Fi.COLUMN2ROW0]+o*i[Fi.COLUMN2ROW1]+a*i[Fi.COLUMN2ROW2]),h=r.dot(n)+e.distance;return h<=-u?Bn.OUTSIDE:h>=u?Bn.INSIDE:Bn.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){const n=sq.from(e).subtract(this.center),r=this.halfAxes,i=r.getColumn(0,Tf),s=r.getColumn(1,Ef),o=r.getColumn(2,Sf),a=i.magnitude(),u=s.magnitude(),h=o.magnitude();i.normalize(),s.normalize(),o.normalize();let p=0,_;return _=Math.abs(n.dot(i))-a,_>0&&(p+=_*_),_=Math.abs(n.dot(s))-u,_>0&&(p+=_*_),_=Math.abs(n.dot(o))-h,_>0&&(p+=_*_),p}computePlaneDistances(e,n,r=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY;const o=this.center,a=this.halfAxes,u=a.getColumn(0,Tf),h=a.getColumn(1,Ef),p=a.getColumn(2,Sf),_=oq.copy(u).add(h).add(p).add(o),v=aq.copy(_).subtract(e);let b=n.dot(v);return i=Math.min(b,i),s=Math.max(b,s),_.copy(o).add(u).add(h).subtract(p),v.copy(_).subtract(e),b=n.dot(v),i=Math.min(b,i),s=Math.max(b,s),_.copy(o).add(u).subtract(h).add(p),v.copy(_).subtract(e),b=n.dot(v),i=Math.min(b,i),s=Math.max(b,s),_.copy(o).add(u).subtract(h).subtract(p),v.copy(_).subtract(e),b=n.dot(v),i=Math.min(b,i),s=Math.max(b,s),o.copy(_).subtract(u).add(h).add(p),v.copy(_).subtract(e),b=n.dot(v),i=Math.min(b,i),s=Math.max(b,s),o.copy(_).subtract(u).add(h).subtract(p),v.copy(_).subtract(e),b=n.dot(v),i=Math.min(b,i),s=Math.max(b,s),o.copy(_).subtract(u).subtract(h).add(p),v.copy(_).subtract(e),b=n.dot(v),i=Math.min(b,i),s=Math.max(b,s),o.copy(_).subtract(u).subtract(h).subtract(p),v.copy(_).subtract(e),b=n.dot(v),i=Math.min(b,i),s=Math.max(b,s),r[0]=i,r[1]=s,r}transform(e){this.center.transformAsPoint(e);const n=this.halfAxes.getColumn(0,Tf);n.transformAsPoint(e);const r=this.halfAxes.getColumn(1,Ef);r.transformAsPoint(e);const i=this.halfAxes.getColumn(2,Sf);return i.transformAsPoint(e),this.halfAxes=new xn([...n,...r,...i]),this}getTransform(){throw new Error("not implemented")}}const eT=new Ne,tT=new Ne;class QA{constructor(e=[0,0,1],n=0){this.normal=new Ne,this.distance=-0,this.fromNormalDistance(e,n)}fromNormalDistance(e,n){return BA(Number.isFinite(n)),this.normal.from(e).normalize(),this.distance=n,this}fromPointNormal(e,n){e=eT.from(e),this.normal.from(n).normalize();const r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,n,r,i){return this.normal.set(e,n,r),BA(Ji(this.normal.len(),1)),this.distance=i,this}clone(){return new QA(this.normal,this.distance)}equals(e){return Ji(this.distance,e.distance)&&Ji(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){const n=tT.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,n)}projectPointOntoPlane(e,n=[0,0,0]){const r=eT.from(e),i=this.getPointDistance(r),s=tT.copy(this.normal).scale(i);return r.subtract(s).to(n)}}const nT=[new Ne([1,0,0]),new Ne([0,1,0]),new Ne([0,0,1])],rT=new Ne,lq=new Ne;class Ki{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*nT.length;const n=e.center,r=e.radius;let i=0;for(const s of nT){let o=this.planes[i],a=this.planes[i+1];o||(o=this.planes[i]=new QA),a||(a=this.planes[i+1]=new QA);const u=rT.copy(s).scale(-r).add(n);o.fromPointNormal(u,s);const h=rT.copy(s).scale(r).add(n),p=lq.copy(s).negate();a.fromPointNormal(h,p),i+=2}return this}computeVisibility(e){let n=Bn.INSIDE;for(const r of this.planes)switch(e.intersectPlane(r)){case Bn.OUTSIDE:return Bn.OUTSIDE;case Bn.INTERSECTING:n=Bn.INTERSECTING;break}return n}computeVisibilityWithPlaneMask(e,n){if(BA(Number.isFinite(n),"parentPlaneMask is required."),n===Ki.MASK_OUTSIDE||n===Ki.MASK_INSIDE)return n;let r=Ki.MASK_INSIDE;const i=this.planes;for(let s=0;s<this.planes.length;++s){const o=s<31?1<<s:0;if(s<31&&!(n&o))continue;const a=i[s],u=e.intersectPlane(a);if(u===Bn.OUTSIDE)return Ki.MASK_OUTSIDE;u===Bn.INTERSECTING&&(r|=o)}return r}}Ki.MASK_OUTSIDE=4294967295;Ki.MASK_INSIDE=0;Ki.MASK_INDETERMINATE=2147483647;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;new Ne;const yi=new xn,cq=new xn,Aq=new xn,Cf=new xn,iT=new xn;function uq(t,e={}){const n=BU,r=10;let i=0,s=0;const o=cq,a=Aq;o.identity(),a.copy(t);const u=n*fq(a);for(;s<r&&hq(a)>u;)dq(a,Cf),iT.copy(Cf).transpose(),a.multiplyRight(Cf),a.multiplyLeft(iT),o.multiplyRight(Cf),++i>2&&(++s,i=0);return e.unitary=o.toTarget(e.unitary),e.diagonal=a.toTarget(e.diagonal),e}function fq(t){let e=0;for(let n=0;n<9;++n){const r=t[n];e+=r*r}return Math.sqrt(e)}const L_=[1,0,0],F_=[2,2,1];function hq(t){let e=0;for(let n=0;n<3;++n){const r=t[yi.getElementIndex(F_[n],L_[n])];e+=2*r*r}return Math.sqrt(e)}function dq(t,e){const n=DU;let r=0,i=1;for(let h=0;h<3;++h){const p=Math.abs(t[yi.getElementIndex(F_[h],L_[h])]);p>r&&(i=h,r=p)}const s=L_[i],o=F_[i];let a=1,u=0;if(Math.abs(t[yi.getElementIndex(o,s)])>n){const h=t[yi.getElementIndex(o,o)],p=t[yi.getElementIndex(s,s)],_=t[yi.getElementIndex(o,s)],v=(h-p)/2/_;let b;v<0?b=-1/(-v+Math.sqrt(1+v*v)):b=1/(v+Math.sqrt(1+v*v)),a=1/Math.sqrt(1+b*b),u=b*a}return xn.IDENTITY.to(e),e[yi.getElementIndex(s,s)]=e[yi.getElementIndex(o,o)]=a,e[yi.getElementIndex(o,s)]=u,e[yi.getElementIndex(s,o)]=-u,e}const Es=new Ne,pq=new Ne,gq=new Ne,mq=new Ne,_q=new Ne,yq=new xn,vq={diagonal:new xn,unitary:new xn};function wq(t,e=new cy){if(!t||t.length===0)return e.halfAxes=new xn([0,0,0,0,0,0,0,0,0]),e.center=new Ne,e;const n=t.length,r=new Ne(0,0,0);for(const O of t)r.add(O);const i=1/n;r.multiplyByScalar(i);let s=0,o=0,a=0,u=0,h=0,p=0;for(const O of t){const U=Es.copy(O).subtract(r);s+=U.x*U.x,o+=U.x*U.y,a+=U.x*U.z,u+=U.y*U.y,h+=U.y*U.z,p+=U.z*U.z}s*=i,o*=i,a*=i,u*=i,h*=i,p*=i;const _=yq;_[0]=s,_[1]=o,_[2]=a,_[3]=o,_[4]=u,_[5]=h,_[6]=a,_[7]=h,_[8]=p;const{unitary:v}=uq(_,vq),b=e.halfAxes.copy(v);let E=b.getColumn(0,gq),R=b.getColumn(1,mq),D=b.getColumn(2,_q),P=-Number.MAX_VALUE,S=-Number.MAX_VALUE,k=-Number.MAX_VALUE,M=Number.MAX_VALUE,V=Number.MAX_VALUE,Y=Number.MAX_VALUE;for(const O of t)Es.copy(O),P=Math.max(Es.dot(E),P),S=Math.max(Es.dot(R),S),k=Math.max(Es.dot(D),k),M=Math.min(Es.dot(E),M),V=Math.min(Es.dot(R),V),Y=Math.min(Es.dot(D),Y);E=E.multiplyByScalar(.5*(M+P)),R=R.multiplyByScalar(.5*(V+S)),D=D.multiplyByScalar(.5*(Y+k)),e.center.copy(E).add(R).add(D);const le=pq.set(P-M,S-V,k-Y).multiplyByScalar(.5),I=new xn([le[0],0,0,0,le[1],0,0,0,le[2]]);return e.halfAxes.multiplyRight(I),e}const dl=512,sT=3,vk=[[.5,.5],[0,0],[0,1],[1,0],[1,1]],wk=vk.concat([[0,.5],[.5,0],[1,.5],[.5,1]]),bq=wk.concat([[.25,.5],[.75,.5]]);class pl{constructor(e,n,r){this.x=e,this.y=n,this.z=r}get children(){if(!this._children){const e=this.x*2,n=this.y*2,r=this.z+1;this._children=[new pl(e,n,r),new pl(e,n+1,r),new pl(e+1,n,r),new pl(e+1,n+1,r)]}return this._children}update(e){const{viewport:n,cullingVolume:r,elevationBounds:i,minZ:s,maxZ:o,bounds:a,offset:u,project:h}=e,p=this.getBoundingVolume(i,u,h);if(a&&!this.insideBounds(a)||r.computeVisibility(p)<0)return!1;if(!this.childVisible){let{z:v}=this;if(v<o&&v>=s){const b=p.distanceTo(n.cameraPosition)*n.scale/n.height;v+=Math.floor(Math.log2(b))}if(v>=o)return this.selected=!0,!0}this.selected=!1,this.childVisible=!0;for(const v of this.children)v.update(e);return!0}getSelected(e=[]){if(this.selected&&e.push(this),this._children)for(const n of this._children)n.getSelected(e);return e}insideBounds([e,n,r,i]){const s=Math.pow(2,this.z),o=dl/s;return this.x*o<r&&this.y*o<i&&(this.x+1)*o>e&&(this.y+1)*o>n}getBoundingVolume(e,n,r){if(r){const u=this.z<1?bq:this.z<2?wk:vk,h=[];for(const p of u){const _=z_(this.x+p[0],this.y+p[1],this.z);_[2]=e[0],h.push(r(_)),e[0]!==e[1]&&(_[2]=e[1],h.push(r(_)))}return wq(h)}const i=Math.pow(2,this.z),s=dl/i,o=this.x*s+n*dl,a=dl-(this.y+1)*s;return new ay([o,a,e[0]],[o+s,a+s,e[1]])}}function xq(t,e,n,r){const i=t instanceof tX&&t.resolution?t.projectPosition:null,s=Object.values(t.getFrustumPlanes()).map(({normal:b,distance:E})=>new QA(b.clone().negate(),E)),o=new Ki(s),a=t.distanceScales.unitsPerMeter[2],u=n&&n[0]*a||0,h=n&&n[1]*a||0,p=t instanceof m0&&t.pitch<=60?e:0;if(r){const[b,E,R,D]=r,P=$l([b,D]),S=$l([R,E]);r=[P[0],dl-P[1],S[0],dl-S[1]]}const _=new pl(0,0,0),v={viewport:t,project:i,cullingVolume:o,elevationBounds:[u,h],minZ:p,maxZ:e,bounds:r,offset:0};if(_.update(v),t instanceof m0&&t.subViewports&&t.subViewports.length>1){for(v.offset=-1;_.update(v)&&!(--v.offset<-sT););for(v.offset=1;_.update(v)&&!(++v.offset>sT););}return _.getSelected()}const as=512,Tq=[-1/0,-1/0,1/0,1/0],Eq={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="string"||Array.isArray(t)&&t.every(n=>typeof n=="string"),equal:(t,e)=>{if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e))return!1;const n=t.length;if(n!==e.length)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}};function bk(t,e){const n=[e.transformAsPoint([t[0],t[1]]),e.transformAsPoint([t[2],t[1]]),e.transformAsPoint([t[0],t[3]]),e.transformAsPoint([t[2],t[3]])];return[Math.min(...n.map(i=>i[0])),Math.min(...n.map(i=>i[1])),Math.max(...n.map(i=>i[0])),Math.max(...n.map(i=>i[1]))]}function Sq(t){return Math.abs(t.split("").reduce((e,n)=>(e<<5)-e+n.charCodeAt(0)|0,0))}function Cq(t,e){if(!t||!t.length)return null;const{index:n,id:r}=e;if(Array.isArray(t)){const s=Sq(r)%t.length;t=t[s]}let i=t;for(const s of Object.keys(n)){const o=new RegExp(`{${s}}`,"g");i=i.replace(o,String(n[s]))}return Number.isInteger(n.y)&&Number.isInteger(n.z)&&(i=i.replace(/\{-y\}/g,String(Math.pow(2,n.z)-n.y-1))),i}function Pq(t,e,n){let r;if(e&&e.length===2){const[i,s]=e,o=t.getBounds({z:i}),a=t.getBounds({z:s});r=[Math.min(o[0],a[0]),Math.min(o[1],a[1]),Math.max(o[2],a[2]),Math.max(o[3],a[3])]}else r=t.getBounds();return t.isGeospatial?[Math.max(r[0],n[0]),Math.max(r[1],n[1]),Math.min(r[2],n[2]),Math.min(r[3],n[3])]:[Math.max(Math.min(r[0],n[2]),n[0]),Math.max(Math.min(r[1],n[3]),n[1]),Math.min(Math.max(r[2],n[0]),n[2]),Math.min(Math.max(r[3],n[1]),n[3])]}function Rq({viewport:t,z:e,cullRect:n}){return(t.subViewports||[t]).map(i=>U_(i,e||0,n))}function U_(t,e,n){if(!Array.isArray(e)){const s=n.x-t.x,o=n.y-t.y,{width:a,height:u}=n,h={targetZ:e},p=t.unproject([s,o],h),_=t.unproject([s+a,o],h),v=t.unproject([s,o+u],h),b=t.unproject([s+a,o+u],h);return[Math.min(p[0],_[0],v[0],b[0]),Math.min(p[1],_[1],v[1],b[1]),Math.max(p[0],_[0],v[0],b[0]),Math.max(p[1],_[1],v[1],b[1])]}const r=U_(t,e[0],n),i=U_(t,e[1],n);return[Math.min(r[0],i[0]),Math.min(r[1],i[1]),Math.max(r[2],i[2]),Math.max(r[3],i[3])]}function kq(t,e,n){return n?bk(t,n).map(i=>i*e/as):t.map(r=>r*e/as)}function Ay(t,e){return Math.pow(2,t)*as/e}function z_(t,e,n){const r=Ay(n,as),i=t/r*360-180,s=Math.PI-2*Math.PI*e/r,o=180/Math.PI*Math.atan(.5*(Math.exp(s)-Math.exp(-s)));return[i,o]}function oT(t,e,n,r){const i=Ay(n,r);return[t/i*as,e/i*as]}function Iq(t,e,n,r,i=as){if(t.isGeospatial){const[h,p]=z_(e,n,r),[_,v]=z_(e+1,n+1,r);return{west:h,north:p,east:_,south:v}}const[s,o]=oT(e,n,r,i),[a,u]=oT(e+1,n+1,r,i);return{left:s,top:o,right:a,bottom:u}}function Mq(t,e,n,r,i){const s=Pq(t,null,r),o=Ay(e,n),[a,u,h,p]=kq(s,o,i),_=[];for(let v=Math.floor(a);v<h;v++)for(let b=Math.floor(u);b<p;b++)_.push({x:v,y:b,z:e});return _}function Oq({viewport:t,maxZoom:e,minZoom:n,zRange:r,extent:i,tileSize:s=as,modelMatrix:o,modelMatrixInverse:a,zoomOffset:u=0}){let h=t.isGeospatial?Math.round(t.zoom+Math.log2(as/s))+u:Math.ceil(t.zoom)+u;if(typeof n=="number"&&Number.isFinite(n)&&h<n){if(!i)return[];h=n}typeof e=="number"&&Number.isFinite(e)&&h>e&&(h=e);let p=i;return o&&a&&i&&!t.isGeospatial&&(p=bk(i,o)),t.isGeospatial?xq(t,h,r,i):Mq(t,h,s,p||Tq,a)}function Nq(t){let e={},n;return r=>{for(const i in r)if(!Dq(r[i],e[i])){n=t(r),e=r;break}return n}}function Dq(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}const aT=1,Sd=2,Bq="never",Lq="no-overlap",uy="best-available",Fq=5,Uq={[uy]:Vq,[Lq]:$q,[Bq]:()=>{}},zq={extent:null,tileSize:512,maxZoom:null,minZoom:null,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:"best-available",zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{}};class xk{constructor(e){this._getCullBounds=Nq(Rq),this.opts={...zq,...e},this.setOptions(this.opts),this.onTileLoad=n=>{var r,i;(i=(r=this.opts).onTileLoad)==null||i.call(r,n),this.opts.maxCacheByteSize!==null&&(this._cacheByteSize+=n.byteLength,this._resizeCache())},this._requestScheduler=new bB({throttleRequests:this.opts.maxRequests>0||this.opts.debounceTime>0,maxRequests:this.opts.maxRequests,debounceTime:this.opts.debounceTime}),this._cache=new Map,this._tiles=[],this._dirty=!1,this._cacheByteSize=0,this._viewport=null,this._zRange=null,this._selectedTiles=null,this._frameNumber=0,this._modelMatrix=new Xn,this._modelMatrixInverse=new Xn}get tiles(){return this._tiles}get selectedTiles(){return this._selectedTiles}get isLoaded(){return this._selectedTiles!==null&&this._selectedTiles.every(e=>e.isLoaded)}get needsReload(){return this._selectedTiles!==null&&this._selectedTiles.some(e=>e.needsReload)}setOptions(e){Object.assign(this.opts,e),Number.isFinite(e.maxZoom)&&(this._maxZoom=Math.floor(e.maxZoom)),Number.isFinite(e.minZoom)&&(this._minZoom=Math.ceil(e.minZoom))}finalize(){for(const e of this._cache.values())e.isLoading&&e.abort();this._cache.clear(),this._tiles=[],this._selectedTiles=null}reloadAll(){for(const e of this._cache.keys()){const n=this._cache.get(e);!this._selectedTiles||!this._selectedTiles.includes(n)?this._cache.delete(e):n.setNeedsReload()}}update(e,{zRange:n,modelMatrix:r}={zRange:null,modelMatrix:null}){const i=r?new Xn(r):new Xn,s=!i.equals(this._modelMatrix);if(!this._viewport||!e.equals(this._viewport)||!Ji(this._zRange,n)||s){s&&(this._modelMatrixInverse=i.clone().invert(),this._modelMatrix=i),this._viewport=e,this._zRange=n;const a=this.getTileIndices({viewport:e,maxZoom:this._maxZoom,minZoom:this._minZoom,zRange:n,modelMatrix:this._modelMatrix,modelMatrixInverse:this._modelMatrixInverse});this._selectedTiles=a.map(u=>this._getTile(u,!0)),this._dirty&&this._rebuildTree()}else this.needsReload&&(this._selectedTiles=this._selectedTiles.map(a=>this._getTile(a.index,!0)));const o=this.updateTileStates();return this._pruneRequests(),this._dirty&&this._resizeCache(),o&&this._frameNumber++,this._frameNumber}isTileVisible(e,n){if(!e.isVisible)return!1;if(n&&this._viewport){const r=this._getCullBounds({viewport:this._viewport,z:this._zRange,cullRect:n}),{bbox:i}=e;for(const[s,o,a,u]of r){let h;if("west"in i)h=i.west<a&&i.east>s&&i.south<u&&i.north>o;else{const p=Math.min(i.top,i.bottom),_=Math.max(i.top,i.bottom);h=i.left<a&&i.right>s&&p<u&&_>o}if(h)return!0}return!1}return!0}getTileIndices({viewport:e,maxZoom:n,minZoom:r,zRange:i,modelMatrix:s,modelMatrixInverse:o}){const{tileSize:a,extent:u,zoomOffset:h}=this.opts;return Oq({viewport:e,maxZoom:n,minZoom:r,zRange:i,tileSize:a,extent:u,modelMatrix:s,modelMatrixInverse:o,zoomOffset:h})}getTileId(e){return`${e.x}-${e.y}-${e.z}`}getTileZoom(e){return e.z}getTileMetadata(e){const{tileSize:n}=this.opts;return{bbox:Iq(this._viewport,e.x,e.y,e.z,n)}}getParentIndex(e){const n=Math.floor(e.x/2),r=Math.floor(e.y/2),i=e.z-1;return{x:n,y:r,z:i}}updateTileStates(){const e=this.opts.refinementStrategy||uy,n=new Array(this._cache.size);let r=0;for(const i of this._cache.values())n[r++]=i.isVisible,i.isSelected=!1,i.isVisible=!1;for(const i of this._selectedTiles)i.isSelected=!0,i.isVisible=!0;(typeof e=="function"?e:Uq[e])(Array.from(this._cache.values())),r=0;for(const i of this._cache.values())if(n[r++]!==i.isVisible)return!0;return!1}_pruneRequests(){const{maxRequests:e=0}=this.opts,n=[];let r=0;for(const i of this._cache.values())i.isLoading&&(r++,!i.isSelected&&!i.isVisible&&n.push(i));for(;e>0&&r>e&&n.length>0;)n.shift().abort(),r--}_rebuildTree(){const{_cache:e}=this;for(const n of e.values())n.parent=null,n.children&&(n.children.length=0);for(const n of e.values()){const r=this._getNearestAncestor(n);n.parent=r,r!=null&&r.children&&r.children.push(n)}}_resizeCache(){var o,a;const{_cache:e,opts:n}=this,r=n.maxCacheSize??(n.maxCacheByteSize!==null?1/0:Fq*this.selectedTiles.length),i=n.maxCacheByteSize??1/0;if(e.size>r||this._cacheByteSize>i){for(const[u,h]of e)if(!h.isVisible&&!h.isSelected&&(this._cacheByteSize-=n.maxCacheByteSize!==null?h.byteLength:0,e.delete(u),(a=(o=this.opts).onTileUnload)==null||a.call(o,h)),e.size<=r&&this._cacheByteSize<=i)break;this._rebuildTree(),this._dirty=!0}this._dirty&&(this._tiles=Array.from(this._cache.values()).sort((u,h)=>u.zoom-h.zoom),this._dirty=!1)}_getTile(e,n){const r=this.getTileId(e);let i=this._cache.get(r),s=!1;return!i&&n?(i=new nq(e),Object.assign(i,this.getTileMetadata(i.index)),Object.assign(i,{id:r,zoom:this.getTileZoom(i.index)}),s=!0,this._cache.set(r,i),this._dirty=!0):i&&i.needsReload&&(s=!0),i&&s&&i.loadData({getData:this.opts.getTileData,requestScheduler:this._requestScheduler,onLoad:this.onTileLoad,onError:this.opts.onTileError}),i}_getNearestAncestor(e){const{_minZoom:n=0}=this;let r=e.index;for(;this.getTileZoom(r)>n;){r=this.getParentIndex(r);const i=this._getTile(r);if(i)return i}return null}}function Vq(t){for(const e of t)e.state=0;for(const e of t)e.isSelected&&!Tk(e)&&fy(e);for(const e of t)e.isVisible=!!(e.state&Sd)}function $q(t){for(const n of t)n.state=0;for(const n of t)n.isSelected&&Tk(n);const e=Array.from(t).sort((n,r)=>n.zoom-r.zoom);for(const n of e)if(n.isVisible=!!(n.state&Sd),n.children&&(n.isVisible||n.state&aT))for(const r of n.children)r.state=aT;else n.isSelected&&fy(n)}function Tk(t){let e=t;for(;e;){if(e.isLoaded||e.content)return e.state|=Sd,!0;e=e.parent}return!1}function fy(t){for(const e of t.children)e.isLoaded||e.content?e.state|=Sd:fy(e)}const Wq={TilesetClass:xk,data:{type:"data",value:[]},dataComparator:Eq.equal,renderSubLayers:{type:"function",value:t=>new gY(t)},getTileData:{type:"function",optional:!0,value:null},onViewportLoad:{type:"function",optional:!0,value:null},onTileLoad:{type:"function",value:t=>{}},onTileUnload:{type:"function",value:t=>{}},onTileError:{type:"function",value:t=>console.error(t)},extent:{type:"array",optional:!0,value:null,compare:!0},tileSize:512,maxZoom:null,minZoom:0,maxCacheSize:null,maxCacheByteSize:null,refinementStrategy:uy,zRange:null,maxRequests:6,debounceTime:0,zoomOffset:0};class hy extends da{initializeState(){this.state={tileset:null,isLoaded:!1}}finalizeState(){var e,n;(n=(e=this.state)==null?void 0:e.tileset)==null||n.finalize()}get isLoaded(){var e,n,r;return!!((r=(n=(e=this.state)==null?void 0:e.tileset)==null?void 0:n.selectedTiles)!=null&&r.every(i=>i.isLoaded&&i.layers&&i.layers.every(s=>s.isLoaded)))}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({changeFlags:e}){let{tileset:n}=this.state;const r=e.propsOrDataChanged||e.updateTriggersChanged,i=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getTileData);n?r&&(n.setOptions(this._getTilesetOptions()),i?n.reloadAll():n.tiles.forEach(s=>{s.layers=null})):(n=new this.props.TilesetClass(this._getTilesetOptions()),this.setState({tileset:n})),this._updateTileset()}_getTilesetOptions(){const{tileSize:e,maxCacheSize:n,maxCacheByteSize:r,refinementStrategy:i,extent:s,maxZoom:o,minZoom:a,maxRequests:u,debounceTime:h,zoomOffset:p}=this.props;return{maxCacheSize:n,maxCacheByteSize:r,maxZoom:o,minZoom:a,tileSize:e,refinementStrategy:i,extent:s,maxRequests:u,debounceTime:h,zoomOffset:p,getTileData:this.getTileData.bind(this),onTileLoad:this._onTileLoad.bind(this),onTileError:this._onTileError.bind(this),onTileUnload:this._onTileUnload.bind(this)}}_updateTileset(){const e=this.state.tileset,{zRange:n,modelMatrix:r}=this.props,i=e.update(this.context.viewport,{zRange:n,modelMatrix:r}),{isLoaded:s}=e,o=this.state.isLoaded!==s,a=this.state.frameNumber!==i;s&&(o||a)&&this._onViewportLoad(),a&&this.setState({frameNumber:i}),this.state.isLoaded=s}_onViewportLoad(){const{tileset:e}=this.state,{onViewportLoad:n}=this.props;n&&n(e.selectedTiles)}_onTileLoad(e){this.props.onTileLoad(e),e.layers=null,this.setNeedsUpdate()}_onTileError(e,n){this.props.onTileError(e),n.layers=null,this.setNeedsUpdate()}_onTileUnload(e){this.props.onTileUnload(e)}getTileData(e){const{data:n,getTileData:r,fetch:i}=this.props,{signal:s}=e;return e.url=typeof n=="string"||Array.isArray(n)?Cq(n,e):null,r?r(e):i&&e.url?i(e.url,{propName:"data",layer:this,signal:s}):null}renderSubLayers(e){return this.props.renderSubLayers(e)}getSubLayerPropsByTile(e){return null}getPickingInfo(e){const n=e.sourceLayer,r=n.props.tile,i=e.info;return i.picked&&(i.tile=r),i.sourceTile=r,i.sourceTileSubLayer=n,i}_updateAutoHighlight(e){e.sourceTileSubLayer.updateAutoHighlight(e)}renderLayers(){return this.state.tileset.tiles.map(e=>{const n=this.getSubLayerPropsByTile(e);if(!(!e.isLoaded&&!e.content))if(e.layers)n&&e.layers[0]&&Object.keys(n).some(r=>e.layers[0].props[r]!==n[r])&&(e.layers=e.layers.map(r=>r.clone(n)));else{const r=this.renderSubLayers({...this.props,...this.getSubLayerProps({id:e.id,updateTriggers:this.props.updateTriggers}),data:e.content,_offset:0,tile:e});e.layers=yd(r,Boolean).map(i=>i.clone({tile:e,...n}))}return e.layers})}filterSubLayer({layer:e,cullRect:n}){const{tile:r}=e.props;return this.state.tileset.isTileVisible(r,n)}}hy.defaultProps=Wq;hy.layerName="TileLayer";const jq=hy;class Hq{constructor(e){this.compressBatches=this.compressBatches.bind(this),this.decompressBatches=this.decompressBatches.bind(this)}async preload(e={}){KD(e)}async compress(e){return await this.preload(),this.compressSync(e)}async decompress(e,n){return await this.preload(),this.decompressSync(e,n)}compressSync(e){throw new Error(`${this.name}: sync compression not supported`)}decompressSync(e,n){throw new Error(`${this.name}: sync decompression not supported`)}async*compressBatches(e){const n=await this.concatenate(e);yield this.compress(n)}async*decompressBatches(e){const n=await this.concatenate(e);yield this.decompress(n)}concatenate(e){return hC(e)}improveError(e){return e.message.includes(this.name)||(e.message=`${this.name} ${e.message}`),e}}var us={};(function(t){var e=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";function n(s,o){return Object.prototype.hasOwnProperty.call(s,o)}t.assign=function(s){for(var o=Array.prototype.slice.call(arguments,1);o.length;){var a=o.shift();if(a){if(typeof a!="object")throw new TypeError(a+"must be non-object");for(var u in a)n(a,u)&&(s[u]=a[u])}}return s},t.shrinkBuf=function(s,o){return s.length===o?s:s.subarray?s.subarray(0,o):(s.length=o,s)};var r={arraySet:function(s,o,a,u,h){if(o.subarray&&s.subarray){s.set(o.subarray(a,a+u),h);return}for(var p=0;p<u;p++)s[h+p]=o[a+p]},flattenChunks:function(s){var o,a,u,h,p,_;for(u=0,o=0,a=s.length;o<a;o++)u+=s[o].length;for(_=new Uint8Array(u),h=0,o=0,a=s.length;o<a;o++)p=s[o],_.set(p,h),h+=p.length;return _}},i={arraySet:function(s,o,a,u,h){for(var p=0;p<u;p++)s[h+p]=o[a+p]},flattenChunks:function(s){return[].concat.apply([],s)}};t.setTyped=function(s){s?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,r)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,i))},t.setTyped(e)})(us);var mu={},Ni={},Kl={},Xq=us,Qq=4,lT=0,cT=1,Yq=2;function Gl(t){for(var e=t.length;--e>=0;)t[e]=0}var qq=0,Ek=1,Zq=2,Kq=3,Gq=258,dy=29,_u=256,YA=_u+1+dy,Cl=30,py=19,Sk=2*YA+1,Do=15,Eg=16,Jq=7,gy=256,Ck=16,Pk=17,Rk=18,V_=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],mh=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],eZ=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],kk=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],tZ=512,Xi=new Array((YA+2)*2);Gl(Xi);var AA=new Array(Cl*2);Gl(AA);var qA=new Array(tZ);Gl(qA);var ZA=new Array(Gq-Kq+1);Gl(ZA);var my=new Array(dy);Gl(my);var T0=new Array(Cl);Gl(T0);function Sg(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}var Ik,Mk,Ok;function Cg(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function Nk(t){return t<256?qA[t]:qA[256+(t>>>7)]}function KA(t,e){t.pending_buf[t.pending++]=e&255,t.pending_buf[t.pending++]=e>>>8&255}function rr(t,e,n){t.bi_valid>Eg-n?(t.bi_buf|=e<<t.bi_valid&65535,KA(t,t.bi_buf),t.bi_buf=e>>Eg-t.bi_valid,t.bi_valid+=n-Eg):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function Si(t,e,n){rr(t,n[e*2],n[e*2+1])}function Dk(t,e){var n=0;do n|=t&1,t>>>=1,n<<=1;while(--e>0);return n>>>1}function nZ(t){t.bi_valid===16?(KA(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=t.bi_buf&255,t.bi_buf>>=8,t.bi_valid-=8)}function rZ(t,e){var n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,u=e.stat_desc.max_length,h,p,_,v,b,E,R=0;for(v=0;v<=Do;v++)t.bl_count[v]=0;for(n[t.heap[t.heap_max]*2+1]=0,h=t.heap_max+1;h<Sk;h++)p=t.heap[h],v=n[n[p*2+1]*2+1]+1,v>u&&(v=u,R++),n[p*2+1]=v,!(p>r)&&(t.bl_count[v]++,b=0,p>=a&&(b=o[p-a]),E=n[p*2],t.opt_len+=E*(v+b),s&&(t.static_len+=E*(i[p*2+1]+b)));if(R!==0){do{for(v=u-1;t.bl_count[v]===0;)v--;t.bl_count[v]--,t.bl_count[v+1]+=2,t.bl_count[u]--,R-=2}while(R>0);for(v=u;v!==0;v--)for(p=t.bl_count[v];p!==0;)_=t.heap[--h],!(_>r)&&(n[_*2+1]!==v&&(t.opt_len+=(v-n[_*2+1])*n[_*2],n[_*2+1]=v),p--)}}function Bk(t,e,n){var r=new Array(Do+1),i=0,s,o;for(s=1;s<=Do;s++)r[s]=i=i+n[s-1]<<1;for(o=0;o<=e;o++){var a=t[o*2+1];a!==0&&(t[o*2]=Dk(r[a]++,a))}}function iZ(){var t,e,n,r,i,s=new Array(Do+1);for(n=0,r=0;r<dy-1;r++)for(my[r]=n,t=0;t<1<<V_[r];t++)ZA[n++]=r;for(ZA[n-1]=r,i=0,r=0;r<16;r++)for(T0[r]=i,t=0;t<1<<mh[r];t++)qA[i++]=r;for(i>>=7;r<Cl;r++)for(T0[r]=i<<7,t=0;t<1<<mh[r]-7;t++)qA[256+i++]=r;for(e=0;e<=Do;e++)s[e]=0;for(t=0;t<=143;)Xi[t*2+1]=8,t++,s[8]++;for(;t<=255;)Xi[t*2+1]=9,t++,s[9]++;for(;t<=279;)Xi[t*2+1]=7,t++,s[7]++;for(;t<=287;)Xi[t*2+1]=8,t++,s[8]++;for(Bk(Xi,YA+1,s),t=0;t<Cl;t++)AA[t*2+1]=5,AA[t*2]=Dk(t,5);Ik=new Sg(Xi,V_,_u+1,YA,Do),Mk=new Sg(AA,mh,0,Cl,Do),Ok=new Sg(new Array(0),eZ,0,py,Jq)}function Lk(t){var e;for(e=0;e<YA;e++)t.dyn_ltree[e*2]=0;for(e=0;e<Cl;e++)t.dyn_dtree[e*2]=0;for(e=0;e<py;e++)t.bl_tree[e*2]=0;t.dyn_ltree[gy*2]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function Fk(t){t.bi_valid>8?KA(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function sZ(t,e,n,r){Fk(t),r&&(KA(t,n),KA(t,~n)),Xq.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}function AT(t,e,n,r){var i=e*2,s=n*2;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]}function Pg(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&AT(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!AT(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function uT(t,e,n){var r,i,s=0,o,a;if(t.last_lit!==0)do r=t.pending_buf[t.d_buf+s*2]<<8|t.pending_buf[t.d_buf+s*2+1],i=t.pending_buf[t.l_buf+s],s++,r===0?Si(t,i,e):(o=ZA[i],Si(t,o+_u+1,e),a=V_[o],a!==0&&(i-=my[o],rr(t,i,a)),r--,o=Nk(r),Si(t,o,n),a=mh[o],a!==0&&(r-=T0[o],rr(t,r,a)));while(s<t.last_lit);Si(t,gy,e)}function $_(t,e){var n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems,o,a,u=-1,h;for(t.heap_len=0,t.heap_max=Sk,o=0;o<s;o++)n[o*2]!==0?(t.heap[++t.heap_len]=u=o,t.depth[o]=0):n[o*2+1]=0;for(;t.heap_len<2;)h=t.heap[++t.heap_len]=u<2?++u:0,n[h*2]=1,t.depth[h]=0,t.opt_len--,i&&(t.static_len-=r[h*2+1]);for(e.max_code=u,o=t.heap_len>>1;o>=1;o--)Pg(t,n,o);h=s;do o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],Pg(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[h*2]=n[o*2]+n[a*2],t.depth[h]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[o*2+1]=n[a*2+1]=h,t.heap[1]=h++,Pg(t,n,1);while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],rZ(t,e),Bk(n,u,t.bl_count)}function fT(t,e,n){var r,i=-1,s,o=e[0*2+1],a=0,u=7,h=4;for(o===0&&(u=138,h=3),e[(n+1)*2+1]=65535,r=0;r<=n;r++)s=o,o=e[(r+1)*2+1],!(++a<u&&s===o)&&(a<h?t.bl_tree[s*2]+=a:s!==0?(s!==i&&t.bl_tree[s*2]++,t.bl_tree[Ck*2]++):a<=10?t.bl_tree[Pk*2]++:t.bl_tree[Rk*2]++,a=0,i=s,o===0?(u=138,h=3):s===o?(u=6,h=3):(u=7,h=4))}function hT(t,e,n){var r,i=-1,s,o=e[0*2+1],a=0,u=7,h=4;for(o===0&&(u=138,h=3),r=0;r<=n;r++)if(s=o,o=e[(r+1)*2+1],!(++a<u&&s===o)){if(a<h)do Si(t,s,t.bl_tree);while(--a!==0);else s!==0?(s!==i&&(Si(t,s,t.bl_tree),a--),Si(t,Ck,t.bl_tree),rr(t,a-3,2)):a<=10?(Si(t,Pk,t.bl_tree),rr(t,a-3,3)):(Si(t,Rk,t.bl_tree),rr(t,a-11,7));a=0,i=s,o===0?(u=138,h=3):s===o?(u=6,h=3):(u=7,h=4)}}function oZ(t){var e;for(fT(t,t.dyn_ltree,t.l_desc.max_code),fT(t,t.dyn_dtree,t.d_desc.max_code),$_(t,t.bl_desc),e=py-1;e>=3&&t.bl_tree[kk[e]*2+1]===0;e--);return t.opt_len+=3*(e+1)+5+5+4,e}function aZ(t,e,n,r){var i;for(rr(t,e-257,5),rr(t,n-1,5),rr(t,r-4,4),i=0;i<r;i++)rr(t,t.bl_tree[kk[i]*2+1],3);hT(t,t.dyn_ltree,e-1),hT(t,t.dyn_dtree,n-1)}function lZ(t){var e=4093624447,n;for(n=0;n<=31;n++,e>>>=1)if(e&1&&t.dyn_ltree[n*2]!==0)return lT;if(t.dyn_ltree[9*2]!==0||t.dyn_ltree[10*2]!==0||t.dyn_ltree[13*2]!==0)return cT;for(n=32;n<_u;n++)if(t.dyn_ltree[n*2]!==0)return cT;return lT}var dT=!1;function cZ(t){dT||(iZ(),dT=!0),t.l_desc=new Cg(t.dyn_ltree,Ik),t.d_desc=new Cg(t.dyn_dtree,Mk),t.bl_desc=new Cg(t.bl_tree,Ok),t.bi_buf=0,t.bi_valid=0,Lk(t)}function Uk(t,e,n,r){rr(t,(qq<<1)+(r?1:0),3),sZ(t,e,n,!0)}function AZ(t){rr(t,Ek<<1,3),Si(t,gy,Xi),nZ(t)}function uZ(t,e,n,r){var i,s,o=0;t.level>0?(t.strm.data_type===Yq&&(t.strm.data_type=lZ(t)),$_(t,t.l_desc),$_(t,t.d_desc),o=oZ(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&e!==-1?Uk(t,e,n,r):t.strategy===Qq||s===i?(rr(t,(Ek<<1)+(r?1:0),3),uT(t,Xi,AA)):(rr(t,(Zq<<1)+(r?1:0),3),aZ(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),uT(t,t.dyn_ltree,t.dyn_dtree)),Lk(t),r&&Fk(t)}function fZ(t,e,n){return t.pending_buf[t.d_buf+t.last_lit*2]=e>>>8&255,t.pending_buf[t.d_buf+t.last_lit*2+1]=e&255,t.pending_buf[t.l_buf+t.last_lit]=n&255,t.last_lit++,e===0?t.dyn_ltree[n*2]++:(t.matches++,e--,t.dyn_ltree[(ZA[n]+_u+1)*2]++,t.dyn_dtree[Nk(e)*2]++),t.last_lit===t.lit_bufsize-1}Kl._tr_init=cZ;Kl._tr_stored_block=Uk;Kl._tr_flush_block=uZ;Kl._tr_tally=fZ;Kl._tr_align=AZ;function hZ(t,e,n,r){for(var i=t&65535|0,s=t>>>16&65535|0,o=0;n!==0;){o=n>2e3?2e3:n,n-=o;do i=i+e[r++]|0,s=s+i|0;while(--o);i%=65521,s%=65521}return i|s<<16|0}var zk=hZ;function dZ(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=t&1?3988292384^t>>>1:t>>>1;e[n]=t}return e}var pZ=dZ();function gZ(t,e,n,r){var i=pZ,s=r+n;t^=-1;for(var o=r;o<s;o++)t=t>>>8^i[(t^e[o])&255];return t^-1}var Vk=gZ,_y={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},jn=us,Lr=Kl,$k=zk,Rs=Vk,mZ=_y,pa=0,_Z=1,yZ=3,so=4,pT=5,Ci=0,gT=1,Fr=-2,vZ=-3,Rg=-5,wZ=-1,bZ=1,Pf=2,xZ=3,TZ=4,EZ=0,SZ=2,Cd=8,CZ=9,PZ=15,RZ=8,kZ=29,IZ=256,W_=IZ+1+kZ,MZ=30,OZ=19,NZ=2*W_+1,DZ=15,lt=3,Xs=258,oi=Xs+lt+1,BZ=32,Pd=42,j_=69,_h=73,yh=91,vh=103,Bo=113,Uc=666,an=1,yu=2,ra=3,Jl=4,LZ=3;function Qs(t,e){return t.msg=mZ[e],e}function mT(t){return(t<<1)-(t>4?9:0)}function Us(t){for(var e=t.length;--e>=0;)t[e]=0}function ks(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),n!==0&&(jn.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,e.pending===0&&(e.pending_out=0))}function Tn(t,e){Lr._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,ks(t.strm)}function dt(t,e){t.pending_buf[t.pending++]=e}function Sc(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=e&255}function FZ(t,e,n,r){var i=t.avail_in;return i>r&&(i=r),i===0?0:(t.avail_in-=i,jn.arraySet(e,t.input,t.next_in,i,n),t.state.wrap===1?t.adler=$k(t.adler,e,i,n):t.state.wrap===2&&(t.adler=Rs(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)}function Wk(t,e){var n=t.max_chain_length,r=t.strstart,i,s,o=t.prev_length,a=t.nice_match,u=t.strstart>t.w_size-oi?t.strstart-(t.w_size-oi):0,h=t.window,p=t.w_mask,_=t.prev,v=t.strstart+Xs,b=h[r+o-1],E=h[r+o];t.prev_length>=t.good_match&&(n>>=2),a>t.lookahead&&(a=t.lookahead);do if(i=e,!(h[i+o]!==E||h[i+o-1]!==b||h[i]!==h[r]||h[++i]!==h[r+1])){r+=2,i++;do;while(h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&r<v);if(s=Xs-(v-r),r=v-Xs,s>o){if(t.match_start=e,o=s,s>=a)break;b=h[r+o-1],E=h[r+o]}}while((e=_[e&p])>u&&--n!==0);return o<=t.lookahead?o:t.lookahead}function ia(t){var e=t.w_size,n,r,i,s,o;do{if(s=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-oi)){jn.arraySet(t.window,t.window,e,e,0),t.match_start-=e,t.strstart-=e,t.block_start-=e,r=t.hash_size,n=r;do i=t.head[--n],t.head[n]=i>=e?i-e:0;while(--r);r=e,n=r;do i=t.prev[--n],t.prev[n]=i>=e?i-e:0;while(--r);s+=e}if(t.strm.avail_in===0)break;if(r=FZ(t.strm,t.window,t.strstart+t.lookahead,s),t.lookahead+=r,t.lookahead+t.insert>=lt)for(o=t.strstart-t.insert,t.ins_h=t.window[o],t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[o+lt-1])&t.hash_mask,t.prev[o&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=o,o++,t.insert--,!(t.lookahead+t.insert<lt)););}while(t.lookahead<oi&&t.strm.avail_in!==0)}function UZ(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(ia(t),t.lookahead===0&&e===pa)return an;if(t.lookahead===0)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((t.strstart===0||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,Tn(t,!1),t.strm.avail_out===0)||t.strstart-t.block_start>=t.w_size-oi&&(Tn(t,!1),t.strm.avail_out===0))return an}return t.insert=0,e===so?(Tn(t,!0),t.strm.avail_out===0?ra:Jl):(t.strstart>t.block_start&&(Tn(t,!1),t.strm.avail_out===0),an)}function kg(t,e){for(var n,r;;){if(t.lookahead<oi){if(ia(t),t.lookahead<oi&&e===pa)return an;if(t.lookahead===0)break}if(n=0,t.lookahead>=lt&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+lt-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),n!==0&&t.strstart-n<=t.w_size-oi&&(t.match_length=Wk(t,n)),t.match_length>=lt)if(r=Lr._tr_tally(t,t.strstart-t.match_start,t.match_length-lt),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=lt){t.match_length--;do t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+lt-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart;while(--t.match_length!==0);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=Lr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(Tn(t,!1),t.strm.avail_out===0))return an}return t.insert=t.strstart<lt-1?t.strstart:lt-1,e===so?(Tn(t,!0),t.strm.avail_out===0?ra:Jl):t.last_lit&&(Tn(t,!1),t.strm.avail_out===0)?an:yu}function Da(t,e){for(var n,r,i;;){if(t.lookahead<oi){if(ia(t),t.lookahead<oi&&e===pa)return an;if(t.lookahead===0)break}if(n=0,t.lookahead>=lt&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+lt-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=lt-1,n!==0&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-oi&&(t.match_length=Wk(t,n),t.match_length<=5&&(t.strategy===bZ||t.match_length===lt&&t.strstart-t.match_start>4096)&&(t.match_length=lt-1)),t.prev_length>=lt&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-lt,r=Lr._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-lt),t.lookahead-=t.prev_length-1,t.prev_length-=2;do++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+lt-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart);while(--t.prev_length!==0);if(t.match_available=0,t.match_length=lt-1,t.strstart++,r&&(Tn(t,!1),t.strm.avail_out===0))return an}else if(t.match_available){if(r=Lr._tr_tally(t,0,t.window[t.strstart-1]),r&&Tn(t,!1),t.strstart++,t.lookahead--,t.strm.avail_out===0)return an}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=Lr._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<lt-1?t.strstart:lt-1,e===so?(Tn(t,!0),t.strm.avail_out===0?ra:Jl):t.last_lit&&(Tn(t,!1),t.strm.avail_out===0)?an:yu}function zZ(t,e){for(var n,r,i,s,o=t.window;;){if(t.lookahead<=Xs){if(ia(t),t.lookahead<=Xs&&e===pa)return an;if(t.lookahead===0)break}if(t.match_length=0,t.lookahead>=lt&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+Xs;do;while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=Xs-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=lt?(n=Lr._tr_tally(t,1,t.match_length-lt),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=Lr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(Tn(t,!1),t.strm.avail_out===0))return an}return t.insert=0,e===so?(Tn(t,!0),t.strm.avail_out===0?ra:Jl):t.last_lit&&(Tn(t,!1),t.strm.avail_out===0)?an:yu}function VZ(t,e){for(var n;;){if(t.lookahead===0&&(ia(t),t.lookahead===0)){if(e===pa)return an;break}if(t.match_length=0,n=Lr._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(Tn(t,!1),t.strm.avail_out===0))return an}return t.insert=0,e===so?(Tn(t,!0),t.strm.avail_out===0?ra:Jl):t.last_lit&&(Tn(t,!1),t.strm.avail_out===0)?an:yu}function mi(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}var gl;gl=[new mi(0,0,0,0,UZ),new mi(4,4,8,4,kg),new mi(4,5,16,8,kg),new mi(4,6,32,32,kg),new mi(4,4,16,16,Da),new mi(8,16,32,32,Da),new mi(8,16,128,128,Da),new mi(8,32,128,256,Da),new mi(32,128,258,1024,Da),new mi(32,258,258,4096,Da)];function $Z(t){t.window_size=2*t.w_size,Us(t.head),t.max_lazy_match=gl[t.level].max_lazy,t.good_match=gl[t.level].good_length,t.nice_match=gl[t.level].nice_length,t.max_chain_length=gl[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=lt-1,t.match_available=0,t.ins_h=0}function WZ(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Cd,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new jn.Buf16(NZ*2),this.dyn_dtree=new jn.Buf16((2*MZ+1)*2),this.bl_tree=new jn.Buf16((2*OZ+1)*2),Us(this.dyn_ltree),Us(this.dyn_dtree),Us(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new jn.Buf16(DZ+1),this.heap=new jn.Buf16(2*W_+1),Us(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new jn.Buf16(2*W_+1),Us(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function jk(t){var e;return!t||!t.state?Qs(t,Fr):(t.total_in=t.total_out=0,t.data_type=SZ,e=t.state,e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?Pd:Bo,t.adler=e.wrap===2?0:1,e.last_flush=pa,Lr._tr_init(e),Ci)}function Hk(t){var e=jk(t);return e===Ci&&$Z(t.state),e}function jZ(t,e){return!t||!t.state||t.state.wrap!==2?Fr:(t.state.gzhead=e,Ci)}function Xk(t,e,n,r,i,s){if(!t)return Fr;var o=1;if(e===wZ&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>CZ||n!==Cd||r<8||r>15||e<0||e>9||s<0||s>TZ)return Qs(t,Fr);r===8&&(r=9);var a=new WZ;return t.state=a,a.strm=t,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+lt-1)/lt),a.window=new jn.Buf8(a.w_size*2),a.head=new jn.Buf16(a.hash_size),a.prev=new jn.Buf16(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=a.lit_bufsize*4,a.pending_buf=new jn.Buf8(a.pending_buf_size),a.d_buf=1*a.lit_bufsize,a.l_buf=(1+2)*a.lit_bufsize,a.level=e,a.strategy=s,a.method=n,Hk(t)}function HZ(t,e){return Xk(t,e,Cd,PZ,RZ,EZ)}function XZ(t,e){var n,r,i,s;if(!t||!t.state||e>pT||e<0)return t?Qs(t,Fr):Fr;if(r=t.state,!t.output||!t.input&&t.avail_in!==0||r.status===Uc&&e!==so)return Qs(t,t.avail_out===0?Rg:Fr);if(r.strm=t,n=r.last_flush,r.last_flush=e,r.status===Pd)if(r.wrap===2)t.adler=0,dt(r,31),dt(r,139),dt(r,8),r.gzhead?(dt(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),dt(r,r.gzhead.time&255),dt(r,r.gzhead.time>>8&255),dt(r,r.gzhead.time>>16&255),dt(r,r.gzhead.time>>24&255),dt(r,r.level===9?2:r.strategy>=Pf||r.level<2?4:0),dt(r,r.gzhead.os&255),r.gzhead.extra&&r.gzhead.extra.length&&(dt(r,r.gzhead.extra.length&255),dt(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=Rs(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=j_):(dt(r,0),dt(r,0),dt(r,0),dt(r,0),dt(r,0),dt(r,r.level===9?2:r.strategy>=Pf||r.level<2?4:0),dt(r,LZ),r.status=Bo);else{var o=Cd+(r.w_bits-8<<4)<<8,a=-1;r.strategy>=Pf||r.level<2?a=0:r.level<6?a=1:r.level===6?a=2:a=3,o|=a<<6,r.strstart!==0&&(o|=BZ),o+=31-o%31,r.status=Bo,Sc(r,o),r.strstart!==0&&(Sc(r,t.adler>>>16),Sc(r,t.adler&65535)),t.adler=1}if(r.status===j_)if(r.gzhead.extra){for(i=r.pending;r.gzindex<(r.gzhead.extra.length&65535)&&!(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=Rs(t.adler,r.pending_buf,r.pending-i,i)),ks(t),i=r.pending,r.pending===r.pending_buf_size));)dt(r,r.gzhead.extra[r.gzindex]&255),r.gzindex++;r.gzhead.hcrc&&r.pending>i&&(t.adler=Rs(t.adler,r.pending_buf,r.pending-i,i)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=_h)}else r.status=_h;if(r.status===_h)if(r.gzhead.name){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=Rs(t.adler,r.pending_buf,r.pending-i,i)),ks(t),i=r.pending,r.pending===r.pending_buf_size)){s=1;break}r.gzindex<r.gzhead.name.length?s=r.gzhead.name.charCodeAt(r.gzindex++)&255:s=0,dt(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>i&&(t.adler=Rs(t.adler,r.pending_buf,r.pending-i,i)),s===0&&(r.gzindex=0,r.status=yh)}else r.status=yh;if(r.status===yh)if(r.gzhead.comment){i=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>i&&(t.adler=Rs(t.adler,r.pending_buf,r.pending-i,i)),ks(t),i=r.pending,r.pending===r.pending_buf_size)){s=1;break}r.gzindex<r.gzhead.comment.length?s=r.gzhead.comment.charCodeAt(r.gzindex++)&255:s=0,dt(r,s)}while(s!==0);r.gzhead.hcrc&&r.pending>i&&(t.adler=Rs(t.adler,r.pending_buf,r.pending-i,i)),s===0&&(r.status=vh)}else r.status=vh;if(r.status===vh&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&ks(t),r.pending+2<=r.pending_buf_size&&(dt(r,t.adler&255),dt(r,t.adler>>8&255),t.adler=0,r.status=Bo)):r.status=Bo),r.pending!==0){if(ks(t),t.avail_out===0)return r.last_flush=-1,Ci}else if(t.avail_in===0&&mT(e)<=mT(n)&&e!==so)return Qs(t,Rg);if(r.status===Uc&&t.avail_in!==0)return Qs(t,Rg);if(t.avail_in!==0||r.lookahead!==0||e!==pa&&r.status!==Uc){var u=r.strategy===Pf?VZ(r,e):r.strategy===xZ?zZ(r,e):gl[r.level].func(r,e);if((u===ra||u===Jl)&&(r.status=Uc),u===an||u===ra)return t.avail_out===0&&(r.last_flush=-1),Ci;if(u===yu&&(e===_Z?Lr._tr_align(r):e!==pT&&(Lr._tr_stored_block(r,0,0,!1),e===yZ&&(Us(r.head),r.lookahead===0&&(r.strstart=0,r.block_start=0,r.insert=0))),ks(t),t.avail_out===0))return r.last_flush=-1,Ci}return e!==so?Ci:r.wrap<=0?gT:(r.wrap===2?(dt(r,t.adler&255),dt(r,t.adler>>8&255),dt(r,t.adler>>16&255),dt(r,t.adler>>24&255),dt(r,t.total_in&255),dt(r,t.total_in>>8&255),dt(r,t.total_in>>16&255),dt(r,t.total_in>>24&255)):(Sc(r,t.adler>>>16),Sc(r,t.adler&65535)),ks(t),r.wrap>0&&(r.wrap=-r.wrap),r.pending!==0?Ci:gT)}function QZ(t){var e;return!t||!t.state?Fr:(e=t.state.status,e!==Pd&&e!==j_&&e!==_h&&e!==yh&&e!==vh&&e!==Bo&&e!==Uc?Qs(t,Fr):(t.state=null,e===Bo?Qs(t,vZ):Ci))}function YZ(t,e){var n=e.length,r,i,s,o,a,u,h,p;if(!t||!t.state||(r=t.state,o=r.wrap,o===2||o===1&&r.status!==Pd||r.lookahead))return Fr;for(o===1&&(t.adler=$k(t.adler,e,n,0)),r.wrap=0,n>=r.w_size&&(o===0&&(Us(r.head),r.strstart=0,r.block_start=0,r.insert=0),p=new jn.Buf8(r.w_size),jn.arraySet(p,e,n-r.w_size,r.w_size,0),e=p,n=r.w_size),a=t.avail_in,u=t.next_in,h=t.input,t.avail_in=n,t.next_in=0,t.input=e,ia(r);r.lookahead>=lt;){i=r.strstart,s=r.lookahead-(lt-1);do r.ins_h=(r.ins_h<<r.hash_shift^r.window[i+lt-1])&r.hash_mask,r.prev[i&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=i,i++;while(--s);r.strstart=i,r.lookahead=lt-1,ia(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=lt-1,r.match_available=0,t.next_in=u,t.input=h,t.avail_in=a,r.wrap=o,Ci}Ni.deflateInit=HZ;Ni.deflateInit2=Xk;Ni.deflateReset=Hk;Ni.deflateResetKeep=jk;Ni.deflateSetHeader=jZ;Ni.deflate=XZ;Ni.deflateEnd=QZ;Ni.deflateSetDictionary=YZ;Ni.deflateInfo="pako deflate (from Nodeca project)";var ga={},Rd=us,Qk=!0,Yk=!0;try{String.fromCharCode.apply(null,[0])}catch{Qk=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{Yk=!1}var GA=new Rd.Buf8(256);for(var Ss=0;Ss<256;Ss++)GA[Ss]=Ss>=252?6:Ss>=248?5:Ss>=240?4:Ss>=224?3:Ss>=192?2:1;GA[254]=GA[254]=1;ga.string2buf=function(t){var e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Rd.Buf8(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),(n&64512)===55296&&i+1<o&&(r=t.charCodeAt(i+1),(r&64512)===56320&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|n&63):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|n&63):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|n&63);return e};function qk(t,e){if(e<65534&&(t.subarray&&Yk||!t.subarray&&Qk))return String.fromCharCode.apply(null,Rd.shrinkBuf(t,e));for(var n="",r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n}ga.buf2binstring=function(t){return qk(t,t.length)};ga.binstring2buf=function(t){for(var e=new Rd.Buf8(t.length),n=0,r=e.length;n<r;n++)e[n]=t.charCodeAt(n);return e};ga.buf2string=function(t,e){var n,r,i,s,o=e||t.length,a=new Array(o*2);for(r=0,n=0;n<o;){if(i=t[n++],i<128){a[r++]=i;continue}if(s=GA[i],s>4){a[r++]=65533,n+=s-1;continue}for(i&=s===2?31:s===3?15:7;s>1&&n<o;)i=i<<6|t[n++]&63,s--;if(s>1){a[r++]=65533;continue}i<65536?a[r++]=i:(i-=65536,a[r++]=55296|i>>10&1023,a[r++]=56320|i&1023)}return qk(a,r)};ga.utf8border=function(t,e){var n;for(e=e||t.length,e>t.length&&(e=t.length),n=e-1;n>=0&&(t[n]&192)===128;)n--;return n<0||n===0?e:n+GA[t[n]]>e?n:e};function qZ(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var Zk=qZ,uA=Ni,fA=us,H_=ga,X_=_y,ZZ=Zk,Kk=Object.prototype.toString,KZ=0,Ig=4,Pl=0,_T=1,yT=2,GZ=-1,JZ=0,eK=8;function sa(t){if(!(this instanceof sa))return new sa(t);this.options=fA.assign({level:GZ,method:eK,chunkSize:16384,windowBits:15,memLevel:8,strategy:JZ,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ZZ,this.strm.avail_out=0;var n=uA.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==Pl)throw new Error(X_[n]);if(e.header&&uA.deflateSetHeader(this.strm,e.header),e.dictionary){var r;if(typeof e.dictionary=="string"?r=H_.string2buf(e.dictionary):Kk.call(e.dictionary)==="[object ArrayBuffer]"?r=new Uint8Array(e.dictionary):r=e.dictionary,n=uA.deflateSetDictionary(this.strm,r),n!==Pl)throw new Error(X_[n]);this._dict_set=!0}}sa.prototype.push=function(t,e){var n=this.strm,r=this.options.chunkSize,i,s;if(this.ended)return!1;s=e===~~e?e:e===!0?Ig:KZ,typeof t=="string"?n.input=H_.string2buf(t):Kk.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(n.avail_out===0&&(n.output=new fA.Buf8(r),n.next_out=0,n.avail_out=r),i=uA.deflate(n,s),i!==_T&&i!==Pl)return this.onEnd(i),this.ended=!0,!1;(n.avail_out===0||n.avail_in===0&&(s===Ig||s===yT))&&(this.options.to==="string"?this.onData(H_.buf2binstring(fA.shrinkBuf(n.output,n.next_out))):this.onData(fA.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||n.avail_out===0)&&i!==_T);return s===Ig?(i=uA.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Pl):(s===yT&&(this.onEnd(Pl),n.avail_out=0),!0)};sa.prototype.onData=function(t){this.chunks.push(t)};sa.prototype.onEnd=function(t){t===Pl&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=fA.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function yy(t,e){var n=new sa(e);if(n.push(t,!0),n.err)throw n.msg||X_[n.err];return n.result}function tK(t,e){return e=e||{},e.raw=!0,yy(t,e)}function nK(t,e){return e=e||{},e.gzip=!0,yy(t,e)}mu.Deflate=sa;mu.deflate=yy;mu.deflateRaw=tK;mu.gzip=nK;var vu={},Ai={},Rf=30,rK=12,iK=function(e,n){var r,i,s,o,a,u,h,p,_,v,b,E,R,D,P,S,k,M,V,Y,le,I,O,U,$;r=e.state,i=e.next_in,U=e.input,s=i+(e.avail_in-5),o=e.next_out,$=e.output,a=o-(n-e.avail_out),u=o+(e.avail_out-257),h=r.dmax,p=r.wsize,_=r.whave,v=r.wnext,b=r.window,E=r.hold,R=r.bits,D=r.lencode,P=r.distcode,S=(1<<r.lenbits)-1,k=(1<<r.distbits)-1;e:do{R<15&&(E+=U[i++]<<R,R+=8,E+=U[i++]<<R,R+=8),M=D[E&S];t:for(;;){if(V=M>>>24,E>>>=V,R-=V,V=M>>>16&255,V===0)$[o++]=M&65535;else if(V&16){Y=M&65535,V&=15,V&&(R<V&&(E+=U[i++]<<R,R+=8),Y+=E&(1<<V)-1,E>>>=V,R-=V),R<15&&(E+=U[i++]<<R,R+=8,E+=U[i++]<<R,R+=8),M=P[E&k];n:for(;;){if(V=M>>>24,E>>>=V,R-=V,V=M>>>16&255,V&16){if(le=M&65535,V&=15,R<V&&(E+=U[i++]<<R,R+=8,R<V&&(E+=U[i++]<<R,R+=8)),le+=E&(1<<V)-1,le>h){e.msg="invalid distance too far back",r.mode=Rf;break e}if(E>>>=V,R-=V,V=o-a,le>V){if(V=le-V,V>_&&r.sane){e.msg="invalid distance too far back",r.mode=Rf;break e}if(I=0,O=b,v===0){if(I+=p-V,V<Y){Y-=V;do $[o++]=b[I++];while(--V);I=o-le,O=$}}else if(v<V){if(I+=p+v-V,V-=v,V<Y){Y-=V;do $[o++]=b[I++];while(--V);if(I=0,v<Y){V=v,Y-=V;do $[o++]=b[I++];while(--V);I=o-le,O=$}}}else if(I+=v-V,V<Y){Y-=V;do $[o++]=b[I++];while(--V);I=o-le,O=$}for(;Y>2;)$[o++]=O[I++],$[o++]=O[I++],$[o++]=O[I++],Y-=3;Y&&($[o++]=O[I++],Y>1&&($[o++]=O[I++]))}else{I=o-le;do $[o++]=$[I++],$[o++]=$[I++],$[o++]=$[I++],Y-=3;while(Y>2);Y&&($[o++]=$[I++],Y>1&&($[o++]=$[I++]))}}else if(V&64){e.msg="invalid distance code",r.mode=Rf;break e}else{M=P[(M&65535)+(E&(1<<V)-1)];continue n}break}}else if(V&64)if(V&32){r.mode=rK;break e}else{e.msg="invalid literal/length code",r.mode=Rf;break e}else{M=D[(M&65535)+(E&(1<<V)-1)];continue t}break}}while(i<s&&o<u);Y=R>>3,i-=Y,R-=Y<<3,E&=(1<<R)-1,e.next_in=i,e.next_out=o,e.avail_in=i<s?5+(s-i):5-(i-s),e.avail_out=o<u?257+(u-o):257-(o-u),r.hold=E,r.bits=R},vT=us,Ba=15,wT=852,bT=592,xT=0,Mg=1,TT=2,sK=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],oK=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],aK=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],lK=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64],cK=function(e,n,r,i,s,o,a,u){var h=u.bits,p=0,_=0,v=0,b=0,E=0,R=0,D=0,P=0,S=0,k=0,M,V,Y,le,I,O=null,U=0,$,q=new vT.Buf16(Ba+1),Z=new vT.Buf16(Ba+1),ee=null,G=0,oe,ue,K;for(p=0;p<=Ba;p++)q[p]=0;for(_=0;_<i;_++)q[n[r+_]]++;for(E=h,b=Ba;b>=1&&q[b]===0;b--);if(E>b&&(E=b),b===0)return s[o++]=1<<24|64<<16|0,s[o++]=1<<24|64<<16|0,u.bits=1,0;for(v=1;v<b&&q[v]===0;v++);for(E<v&&(E=v),P=1,p=1;p<=Ba;p++)if(P<<=1,P-=q[p],P<0)return-1;if(P>0&&(e===xT||b!==1))return-1;for(Z[1]=0,p=1;p<Ba;p++)Z[p+1]=Z[p]+q[p];for(_=0;_<i;_++)n[r+_]!==0&&(a[Z[n[r+_]]++]=_);if(e===xT?(O=ee=a,$=19):e===Mg?(O=sK,U-=257,ee=oK,G-=257,$=256):(O=aK,ee=lK,$=-1),k=0,_=0,p=v,I=o,R=E,D=0,Y=-1,S=1<<E,le=S-1,e===Mg&&S>wT||e===TT&&S>bT)return 1;for(;;){oe=p-D,a[_]<$?(ue=0,K=a[_]):a[_]>$?(ue=ee[G+a[_]],K=O[U+a[_]]):(ue=32+64,K=0),M=1<<p-D,V=1<<R,v=V;do V-=M,s[I+(k>>D)+V]=oe<<24|ue<<16|K|0;while(V!==0);for(M=1<<p-1;k&M;)M>>=1;if(M!==0?(k&=M-1,k+=M):k=0,_++,--q[p]===0){if(p===b)break;p=n[r+a[_]]}if(p>E&&(k&le)!==Y){for(D===0&&(D=E),I+=v,R=p-D,P=1<<R;R+D<b&&(P-=q[R+D],!(P<=0));)R++,P<<=1;if(S+=1<<R,e===Mg&&S>wT||e===TT&&S>bT)return 1;Y=k&le,s[Y]=E<<24|R<<16|I-o|0}}return k!==0&&(s[I+k]=p-D<<24|64<<16|0),u.bits=E,0},gr=us,Q_=zk,_i=Vk,AK=iK,hA=cK,uK=0,Gk=1,Jk=2,ET=4,fK=5,kf=6,oa=0,hK=1,dK=2,Wr=-2,eI=-3,tI=-4,pK=-5,ST=8,nI=1,CT=2,PT=3,RT=4,kT=5,IT=6,MT=7,OT=8,NT=9,DT=10,E0=11,Ui=12,Og=13,BT=14,Ng=15,LT=16,FT=17,UT=18,zT=19,If=20,Mf=21,VT=22,$T=23,WT=24,jT=25,HT=26,Dg=27,XT=28,QT=29,Lt=30,rI=31,gK=32,mK=852,_K=592,yK=15,vK=yK;function YT(t){return(t>>>24&255)+(t>>>8&65280)+((t&65280)<<8)+((t&255)<<24)}function wK(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new gr.Buf16(320),this.work=new gr.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function iI(t){var e;return!t||!t.state?Wr:(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=e.wrap&1),e.mode=nI,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new gr.Buf32(mK),e.distcode=e.distdyn=new gr.Buf32(_K),e.sane=1,e.back=-1,oa)}function sI(t){var e;return!t||!t.state?Wr:(e=t.state,e.wsize=0,e.whave=0,e.wnext=0,iI(t))}function oI(t,e){var n,r;return!t||!t.state||(r=t.state,e<0?(n=0,e=-e):(n=(e>>4)+1,e<48&&(e&=15)),e&&(e<8||e>15))?Wr:(r.window!==null&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,sI(t))}function aI(t,e){var n,r;return t?(r=new wK,t.state=r,r.window=null,n=oI(t,e),n!==oa&&(t.state=null),n):Wr}function bK(t){return aI(t,vK)}var qT=!0,Bg,Lg;function xK(t){if(qT){var e;for(Bg=new gr.Buf32(512),Lg=new gr.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(hA(Gk,t.lens,0,288,Bg,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;hA(Jk,t.lens,0,32,Lg,0,t.work,{bits:5}),qT=!1}t.lencode=Bg,t.lenbits=9,t.distcode=Lg,t.distbits=5}function lI(t,e,n,r){var i,s=t.state;return s.window===null&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new gr.Buf8(s.wsize)),r>=s.wsize?(gr.arraySet(s.window,e,n-s.wsize,s.wsize,0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),gr.arraySet(s.window,e,n-r,i,s.wnext),r-=i,r?(gr.arraySet(s.window,e,n-r,r,0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0}function TK(t,e){var n,r,i,s,o,a,u,h,p,_,v,b,E,R,D=0,P,S,k,M,V,Y,le,I,O=new gr.Buf8(4),U,$,q=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return Wr;n=t.state,n.mode===Ui&&(n.mode=Og),o=t.next_out,i=t.output,u=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,h=n.hold,p=n.bits,_=a,v=u,I=oa;e:for(;;)switch(n.mode){case nI:if(n.wrap===0){n.mode=Og;break}for(;p<16;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(n.wrap&2&&h===35615){n.check=0,O[0]=h&255,O[1]=h>>>8&255,n.check=_i(n.check,O,2,0),h=0,p=0,n.mode=CT;break}if(n.flags=0,n.head&&(n.head.done=!1),!(n.wrap&1)||(((h&255)<<8)+(h>>8))%31){t.msg="incorrect header check",n.mode=Lt;break}if((h&15)!==ST){t.msg="unknown compression method",n.mode=Lt;break}if(h>>>=4,p-=4,le=(h&15)+8,n.wbits===0)n.wbits=le;else if(le>n.wbits){t.msg="invalid window size",n.mode=Lt;break}n.dmax=1<<le,t.adler=n.check=1,n.mode=h&512?DT:Ui,h=0,p=0;break;case CT:for(;p<16;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(n.flags=h,(n.flags&255)!==ST){t.msg="unknown compression method",n.mode=Lt;break}if(n.flags&57344){t.msg="unknown header flags set",n.mode=Lt;break}n.head&&(n.head.text=h>>8&1),n.flags&512&&(O[0]=h&255,O[1]=h>>>8&255,n.check=_i(n.check,O,2,0)),h=0,p=0,n.mode=PT;case PT:for(;p<32;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}n.head&&(n.head.time=h),n.flags&512&&(O[0]=h&255,O[1]=h>>>8&255,O[2]=h>>>16&255,O[3]=h>>>24&255,n.check=_i(n.check,O,4,0)),h=0,p=0,n.mode=RT;case RT:for(;p<16;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}n.head&&(n.head.xflags=h&255,n.head.os=h>>8),n.flags&512&&(O[0]=h&255,O[1]=h>>>8&255,n.check=_i(n.check,O,2,0)),h=0,p=0,n.mode=kT;case kT:if(n.flags&1024){for(;p<16;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}n.length=h,n.head&&(n.head.extra_len=h),n.flags&512&&(O[0]=h&255,O[1]=h>>>8&255,n.check=_i(n.check,O,2,0)),h=0,p=0}else n.head&&(n.head.extra=null);n.mode=IT;case IT:if(n.flags&1024&&(b=n.length,b>a&&(b=a),b&&(n.head&&(le=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),gr.arraySet(n.head.extra,r,s,b,le)),n.flags&512&&(n.check=_i(n.check,r,b,s)),a-=b,s+=b,n.length-=b),n.length))break e;n.length=0,n.mode=MT;case MT:if(n.flags&2048){if(a===0)break e;b=0;do le=r[s+b++],n.head&&le&&n.length<65536&&(n.head.name+=String.fromCharCode(le));while(le&&b<a);if(n.flags&512&&(n.check=_i(n.check,r,b,s)),a-=b,s+=b,le)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=OT;case OT:if(n.flags&4096){if(a===0)break e;b=0;do le=r[s+b++],n.head&&le&&n.length<65536&&(n.head.comment+=String.fromCharCode(le));while(le&&b<a);if(n.flags&512&&(n.check=_i(n.check,r,b,s)),a-=b,s+=b,le)break e}else n.head&&(n.head.comment=null);n.mode=NT;case NT:if(n.flags&512){for(;p<16;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(h!==(n.check&65535)){t.msg="header crc mismatch",n.mode=Lt;break}h=0,p=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=Ui;break;case DT:for(;p<32;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}t.adler=n.check=YT(h),h=0,p=0,n.mode=E0;case E0:if(n.havedict===0)return t.next_out=o,t.avail_out=u,t.next_in=s,t.avail_in=a,n.hold=h,n.bits=p,dK;t.adler=n.check=1,n.mode=Ui;case Ui:if(e===fK||e===kf)break e;case Og:if(n.last){h>>>=p&7,p-=p&7,n.mode=Dg;break}for(;p<3;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}switch(n.last=h&1,h>>>=1,p-=1,h&3){case 0:n.mode=BT;break;case 1:if(xK(n),n.mode=If,e===kf){h>>>=2,p-=2;break e}break;case 2:n.mode=FT;break;case 3:t.msg="invalid block type",n.mode=Lt}h>>>=2,p-=2;break;case BT:for(h>>>=p&7,p-=p&7;p<32;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if((h&65535)!==(h>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Lt;break}if(n.length=h&65535,h=0,p=0,n.mode=Ng,e===kf)break e;case Ng:n.mode=LT;case LT:if(b=n.length,b){if(b>a&&(b=a),b>u&&(b=u),b===0)break e;gr.arraySet(i,r,s,b,o),a-=b,s+=b,u-=b,o+=b,n.length-=b;break}n.mode=Ui;break;case FT:for(;p<14;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(n.nlen=(h&31)+257,h>>>=5,p-=5,n.ndist=(h&31)+1,h>>>=5,p-=5,n.ncode=(h&15)+4,h>>>=4,p-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Lt;break}n.have=0,n.mode=UT;case UT:for(;n.have<n.ncode;){for(;p<3;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}n.lens[q[n.have++]]=h&7,h>>>=3,p-=3}for(;n.have<19;)n.lens[q[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,U={bits:n.lenbits},I=hA(uK,n.lens,0,19,n.lencode,0,n.work,U),n.lenbits=U.bits,I){t.msg="invalid code lengths set",n.mode=Lt;break}n.have=0,n.mode=zT;case zT:for(;n.have<n.nlen+n.ndist;){for(;D=n.lencode[h&(1<<n.lenbits)-1],P=D>>>24,S=D>>>16&255,k=D&65535,!(P<=p);){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(k<16)h>>>=P,p-=P,n.lens[n.have++]=k;else{if(k===16){for($=P+2;p<$;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(h>>>=P,p-=P,n.have===0){t.msg="invalid bit length repeat",n.mode=Lt;break}le=n.lens[n.have-1],b=3+(h&3),h>>>=2,p-=2}else if(k===17){for($=P+3;p<$;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}h>>>=P,p-=P,le=0,b=3+(h&7),h>>>=3,p-=3}else{for($=P+7;p<$;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}h>>>=P,p-=P,le=0,b=11+(h&127),h>>>=7,p-=7}if(n.have+b>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Lt;break}for(;b--;)n.lens[n.have++]=le}}if(n.mode===Lt)break;if(n.lens[256]===0){t.msg="invalid code -- missing end-of-block",n.mode=Lt;break}if(n.lenbits=9,U={bits:n.lenbits},I=hA(Gk,n.lens,0,n.nlen,n.lencode,0,n.work,U),n.lenbits=U.bits,I){t.msg="invalid literal/lengths set",n.mode=Lt;break}if(n.distbits=6,n.distcode=n.distdyn,U={bits:n.distbits},I=hA(Jk,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,U),n.distbits=U.bits,I){t.msg="invalid distances set",n.mode=Lt;break}if(n.mode=If,e===kf)break e;case If:n.mode=Mf;case Mf:if(a>=6&&u>=258){t.next_out=o,t.avail_out=u,t.next_in=s,t.avail_in=a,n.hold=h,n.bits=p,AK(t,v),o=t.next_out,i=t.output,u=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,h=n.hold,p=n.bits,n.mode===Ui&&(n.back=-1);break}for(n.back=0;D=n.lencode[h&(1<<n.lenbits)-1],P=D>>>24,S=D>>>16&255,k=D&65535,!(P<=p);){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(S&&!(S&240)){for(M=P,V=S,Y=k;D=n.lencode[Y+((h&(1<<M+V)-1)>>M)],P=D>>>24,S=D>>>16&255,k=D&65535,!(M+P<=p);){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}h>>>=M,p-=M,n.back+=M}if(h>>>=P,p-=P,n.back+=P,n.length=k,S===0){n.mode=HT;break}if(S&32){n.back=-1,n.mode=Ui;break}if(S&64){t.msg="invalid literal/length code",n.mode=Lt;break}n.extra=S&15,n.mode=VT;case VT:if(n.extra){for($=n.extra;p<$;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}n.length+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=$T;case $T:for(;D=n.distcode[h&(1<<n.distbits)-1],P=D>>>24,S=D>>>16&255,k=D&65535,!(P<=p);){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(!(S&240)){for(M=P,V=S,Y=k;D=n.distcode[Y+((h&(1<<M+V)-1)>>M)],P=D>>>24,S=D>>>16&255,k=D&65535,!(M+P<=p);){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}h>>>=M,p-=M,n.back+=M}if(h>>>=P,p-=P,n.back+=P,S&64){t.msg="invalid distance code",n.mode=Lt;break}n.offset=k,n.extra=S&15,n.mode=WT;case WT:if(n.extra){for($=n.extra;p<$;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}n.offset+=h&(1<<n.extra)-1,h>>>=n.extra,p-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Lt;break}n.mode=jT;case jT:if(u===0)break e;if(b=v-u,n.offset>b){if(b=n.offset-b,b>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Lt;break}b>n.wnext?(b-=n.wnext,E=n.wsize-b):E=n.wnext-b,b>n.length&&(b=n.length),R=n.window}else R=i,E=o-n.offset,b=n.length;b>u&&(b=u),u-=b,n.length-=b;do i[o++]=R[E++];while(--b);n.length===0&&(n.mode=Mf);break;case HT:if(u===0)break e;i[o++]=n.length,u--,n.mode=Mf;break;case Dg:if(n.wrap){for(;p<32;){if(a===0)break e;a--,h|=r[s++]<<p,p+=8}if(v-=u,t.total_out+=v,n.total+=v,v&&(t.adler=n.check=n.flags?_i(n.check,i,v,o-v):Q_(n.check,i,v,o-v)),v=u,(n.flags?h:YT(h))!==n.check){t.msg="incorrect data check",n.mode=Lt;break}h=0,p=0}n.mode=XT;case XT:if(n.wrap&&n.flags){for(;p<32;){if(a===0)break e;a--,h+=r[s++]<<p,p+=8}if(h!==(n.total&4294967295)){t.msg="incorrect length check",n.mode=Lt;break}h=0,p=0}n.mode=QT;case QT:I=hK;break e;case Lt:I=eI;break e;case rI:return tI;case gK:default:return Wr}return t.next_out=o,t.avail_out=u,t.next_in=s,t.avail_in=a,n.hold=h,n.bits=p,(n.wsize||v!==t.avail_out&&n.mode<Lt&&(n.mode<Dg||e!==ET))&&lI(t,t.output,t.next_out,v-t.avail_out),_-=t.avail_in,v-=t.avail_out,t.total_in+=_,t.total_out+=v,n.total+=v,n.wrap&&v&&(t.adler=n.check=n.flags?_i(n.check,i,v,t.next_out-v):Q_(n.check,i,v,t.next_out-v)),t.data_type=n.bits+(n.last?64:0)+(n.mode===Ui?128:0)+(n.mode===If||n.mode===Ng?256:0),(_===0&&v===0||e===ET)&&I===oa&&(I=pK),I}function EK(t){if(!t||!t.state)return Wr;var e=t.state;return e.window&&(e.window=null),t.state=null,oa}function SK(t,e){var n;return!t||!t.state||(n=t.state,!(n.wrap&2))?Wr:(n.head=e,e.done=!1,oa)}function CK(t,e){var n=e.length,r,i,s;return!t||!t.state||(r=t.state,r.wrap!==0&&r.mode!==E0)?Wr:r.mode===E0&&(i=1,i=Q_(i,e,n,0),i!==r.check)?eI:(s=lI(t,e,n,n),s?(r.mode=rI,tI):(r.havedict=1,oa))}Ai.inflateReset=sI;Ai.inflateReset2=oI;Ai.inflateResetKeep=iI;Ai.inflateInit=bK;Ai.inflateInit2=aI;Ai.inflate=TK;Ai.inflateEnd=EK;Ai.inflateGetHeader=SK;Ai.inflateSetDictionary=CK;Ai.inflateInfo="pako inflate (from Nodeca project)";var cI={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};function PK(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var RK=PK,Rl=Ai,dA=us,wh=ga,Zt=cI,Y_=_y,kK=Zk,IK=RK,AI=Object.prototype.toString;function aa(t){if(!(this instanceof aa))return new aa(t);this.options=dA.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,e.windowBits===0&&(e.windowBits=-15)),e.windowBits>=0&&e.windowBits<16&&!(t&&t.windowBits)&&(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&(e.windowBits&15||(e.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kK,this.strm.avail_out=0;var n=Rl.inflateInit2(this.strm,e.windowBits);if(n!==Zt.Z_OK)throw new Error(Y_[n]);if(this.header=new IK,Rl.inflateGetHeader(this.strm,this.header),e.dictionary&&(typeof e.dictionary=="string"?e.dictionary=wh.string2buf(e.dictionary):AI.call(e.dictionary)==="[object ArrayBuffer]"&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=Rl.inflateSetDictionary(this.strm,e.dictionary),n!==Zt.Z_OK)))throw new Error(Y_[n])}aa.prototype.push=function(t,e){var n=this.strm,r=this.options.chunkSize,i=this.options.dictionary,s,o,a,u,h,p=!1;if(this.ended)return!1;o=e===~~e?e:e===!0?Zt.Z_FINISH:Zt.Z_NO_FLUSH,typeof t=="string"?n.input=wh.binstring2buf(t):AI.call(t)==="[object ArrayBuffer]"?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;do{if(n.avail_out===0&&(n.output=new dA.Buf8(r),n.next_out=0,n.avail_out=r),s=Rl.inflate(n,Zt.Z_NO_FLUSH),s===Zt.Z_NEED_DICT&&i&&(s=Rl.inflateSetDictionary(this.strm,i)),s===Zt.Z_BUF_ERROR&&p===!0&&(s=Zt.Z_OK,p=!1),s!==Zt.Z_STREAM_END&&s!==Zt.Z_OK)return this.onEnd(s),this.ended=!0,!1;n.next_out&&(n.avail_out===0||s===Zt.Z_STREAM_END||n.avail_in===0&&(o===Zt.Z_FINISH||o===Zt.Z_SYNC_FLUSH))&&(this.options.to==="string"?(a=wh.utf8border(n.output,n.next_out),u=n.next_out-a,h=wh.buf2string(n.output,a),n.next_out=u,n.avail_out=r-u,u&&dA.arraySet(n.output,n.output,a,u,0),this.onData(h)):this.onData(dA.shrinkBuf(n.output,n.next_out))),n.avail_in===0&&n.avail_out===0&&(p=!0)}while((n.avail_in>0||n.avail_out===0)&&s!==Zt.Z_STREAM_END);return s===Zt.Z_STREAM_END&&(o=Zt.Z_FINISH),o===Zt.Z_FINISH?(s=Rl.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Zt.Z_OK):(o===Zt.Z_SYNC_FLUSH&&(this.onEnd(Zt.Z_OK),n.avail_out=0),!0)};aa.prototype.onData=function(t){this.chunks.push(t)};aa.prototype.onEnd=function(t){t===Zt.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=dA.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};function vy(t,e){var n=new aa(e);if(n.push(t,!0),n.err)throw n.msg||Y_[n.err];return n.result}function MK(t,e){return e=e||{},e.raw=!0,vy(t,e)}vu.Inflate=aa;vu.inflate=vy;vu.inflateRaw=MK;vu.ungzip=vy;var OK=us.assign,NK=mu,DK=vu,BK=cI,uI={};OK(uI,NK,DK,BK);var LK=uI;const La=G0(LK);class FK extends Hq{constructor(n={}){super(n);L(this,"name","deflate");L(this,"extensions",[]);L(this,"contentEncodings",["deflate"]);L(this,"isSupported",!0);L(this,"options");L(this,"_chunks",[]);this.options=n}async compress(n){var r,i;if(!Oo&&((r=this.options.deflate)!=null&&r.useZlib)){const s=(i=this.options.deflate)!=null&&i.gzip?await Ju(vs.gzip)(n):await Ju(vs.deflate)(n);return rl(s)}return this.compressSync(n)}async decompress(n){var r,i;if(!Oo&&((r=this.options.deflate)!=null&&r.useZlib)){const s=(i=this.options.deflate)!=null&&i.gzip?await Ju(vs.gunzip)(n):await Ju(vs.inflate)(n);return rl(s)}return this.decompressSync(n)}compressSync(n){var o,a,u,h;if(!Oo&&((o=this.options.deflate)!=null&&o.useZlib)){const p=(a=this.options.deflate)!=null&&a.gzip?vs.gzipSync(n):vs.deflateSync(n);return rl(p)}const r=((u=this.options)==null?void 0:u.deflate)||{},i=new Uint8Array(n);return((h=this.options)!=null&&h.raw?La.deflateRaw:La.deflate)(i,r).buffer}decompressSync(n){var o,a,u,h;if(!Oo&&((o=this.options.deflate)!=null&&o.useZlib)){const p=(a=this.options.deflate)!=null&&a.gzip?vs.gunzipSync(n):vs.inflateSync(n);return rl(p)}const r=((u=this.options)==null?void 0:u.deflate)||{},i=new Uint8Array(n);return((h=this.options)!=null&&h.raw?La.inflateRaw:La.inflate)(i,r).buffer}async*compressBatches(n){var s;const r=((s=this.options)==null?void 0:s.deflate)||{},i=new La.Deflate(r);yield*this.transformBatches(i,n)}async*decompressBatches(n){var s;const r=((s=this.options)==null?void 0:s.deflate)||{},i=new La.Inflate(r);yield*this.transformBatches(i,n)}async*transformBatches(n,r){n.onData=this._onData.bind(this),n.onEnd=this._onEnd.bind(this);for await(const o of r){const a=new Uint8Array(o);if(!n.push(a,!1))throw new Error(`${this._getError()}write`);yield*this._getChunks()}const i=new Uint8Array(0);n.push(i,!0),yield*this._getChunks()}_onData(n){this._chunks.push(n)}_onEnd(n){if(n!==0)throw new Error(this._getError(n)+this._chunks.length)}_getChunks(){const n=this._chunks;return this._chunks=[],n}_getError(n=0){const r={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};return`${this.name}: ${r[n]}`}}class UK extends FK{constructor(n){super({...n,deflate:{...n==null?void 0:n.gzip,gzip:!0}});L(this,"name","gzip");L(this,"extensions",["gz","gzip"]);L(this,"contentEncodings",["gzip","x-gzip"]);L(this,"isSupported",!0)}}var wy={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */wy.read=function(t,e,n,r,i){var s,o,a=i*8-r-1,u=(1<<a)-1,h=u>>1,p=-7,_=n?i-1:0,v=n?-1:1,b=t[e+_];for(_+=v,s=b&(1<<-p)-1,b>>=-p,p+=a;p>0;s=s*256+t[e+_],_+=v,p-=8);for(o=s&(1<<-p)-1,s>>=-p,p+=r;p>0;o=o*256+t[e+_],_+=v,p-=8);if(s===0)s=1-h;else{if(s===u)return o?NaN:(b?-1:1)*(1/0);o=o+Math.pow(2,r),s=s-h}return(b?-1:1)*o*Math.pow(2,s-r)};wy.write=function(t,e,n,r,i,s){var o,a,u,h=s*8-i-1,p=(1<<h)-1,_=p>>1,v=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=r?0:s-1,E=r?1:-1,R=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=p):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),o+_>=1?e+=v/u:e+=v*Math.pow(2,1-_),e*u>=2&&(o++,u/=2),o+_>=p?(a=0,o=p):o+_>=1?(a=(e*u-1)*Math.pow(2,i),o=o+_):(a=e*Math.pow(2,_-1)*Math.pow(2,i),o=0));i>=8;t[n+b]=a&255,b+=E,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;t[n+b]=o&255,b+=E,o/=256,h-=8);t[n+b-E]|=R*128};var zK=mt,Of=wy;function mt(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}mt.Varint=0;mt.Fixed64=1;mt.Bytes=2;mt.Fixed32=5;var q_=65536*65536,ZT=1/q_,VK=12,fI=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");mt.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,s=this.pos;this.type=r&7,t(i,e,this),this.pos===s&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Nf(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=GT(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Nf(this.buf,this.pos)+Nf(this.buf,this.pos+4)*q_;return this.pos+=8,t},readSFixed64:function(){var t=Nf(this.buf,this.pos)+GT(this.buf,this.pos+4)*q_;return this.pos+=8,t},readFloat:function(){var t=Of.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Of.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e=this.buf,n,r;return r=e[this.pos++],n=r&127,r<128||(r=e[this.pos++],n|=(r&127)<<7,r<128)||(r=e[this.pos++],n|=(r&127)<<14,r<128)||(r=e[this.pos++],n|=(r&127)<<21,r<128)?n:(r=e[this.pos],n|=(r&15)<<28,$K(n,t,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=VK&&fI?nG(this.buf,e,t):tG(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==mt.Bytes)return t.push(this.readVarint(e));var n=zi(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==mt.Bytes)return t.push(this.readSVarint());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==mt.Bytes)return t.push(this.readBoolean());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==mt.Bytes)return t.push(this.readFloat());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==mt.Bytes)return t.push(this.readDouble());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==mt.Bytes)return t.push(this.readFixed32());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==mt.Bytes)return t.push(this.readSFixed32());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==mt.Bytes)return t.push(this.readFixed64());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==mt.Bytes)return t.push(this.readSFixed64());var e=zi(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=t&7;if(e===mt.Varint)for(;this.buf[this.pos++]>127;);else if(e===mt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===mt.Fixed32)this.pos+=4;else if(e===mt.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+e)},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ua(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ua(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ua(this.buf,t&-1,this.pos),Ua(this.buf,Math.floor(t*ZT),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ua(this.buf,t&-1,this.pos),Ua(this.buf,Math.floor(t*ZT),this.pos+4),this.pos+=8},writeVarint:function(t){if(t=+t||0,t>268435455||t<0){WK(t,this);return}this.realloc(4),this.buf[this.pos++]=t&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=(t>>>=7)&127|(t>127?128:0),!(t<=127)&&(this.buf[this.pos++]=t>>>7&127)))},writeSVarint:function(t){this.writeVarint(t<0?-t*2-1:t*2)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(t.length*4),this.pos++;var e=this.pos;this.pos=rG(this.buf,t,this.pos);var n=this.pos-e;n>=128&&KT(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Of.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Of.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&KT(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,mt.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,XK,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,QK,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ZK,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,YK,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,qK,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,KK,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,GK,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,JK,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,eG,e)},writeBytesField:function(t,e){this.writeTag(t,mt.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,mt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,mt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,mt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,mt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,mt.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,mt.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,mt.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,mt.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,mt.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};function $K(t,e,n){var r=n.buf,i,s;if(s=r[n.pos++],i=(s&112)>>4,s<128||(s=r[n.pos++],i|=(s&127)<<3,s<128)||(s=r[n.pos++],i|=(s&127)<<10,s<128)||(s=r[n.pos++],i|=(s&127)<<17,s<128)||(s=r[n.pos++],i|=(s&127)<<24,s<128)||(s=r[n.pos++],i|=(s&1)<<31,s<128))return Fa(t,i,e);throw new Error("Expected varint not more than 10 bytes")}function zi(t){return t.type===mt.Bytes?t.readVarint()+t.pos:t.pos+1}function Fa(t,e,n){return n?e*4294967296+(t>>>0):(e>>>0)*4294967296+(t>>>0)}function WK(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(n=~(-t%4294967296),r=~(-t/4294967296),n^4294967295?n=n+1|0:(n=0,r=r+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),jK(n,r,e),HK(r,e)}function jK(t,e,n){n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos++]=t&127|128,t>>>=7,n.buf[n.pos]=t&127}function HK(t,e){var n=(t&7)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=t&127)))))}function KT(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(Math.LN2*7));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function XK(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function QK(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function YK(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function qK(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function ZK(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function KK(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function GK(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function JK(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function eG(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Nf(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+t[e+3]*16777216}function Ua(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function GT(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function tG(t,e,n){for(var r="",i=e;i<n;){var s=t[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a>n)break;var u,h,p;a===1?s<128&&(o=s):a===2?(u=t[i+1],(u&192)===128&&(o=(s&31)<<6|u&63,o<=127&&(o=null))):a===3?(u=t[i+1],h=t[i+2],(u&192)===128&&(h&192)===128&&(o=(s&15)<<12|(u&63)<<6|h&63,(o<=2047||o>=55296&&o<=57343)&&(o=null))):a===4&&(u=t[i+1],h=t[i+2],p=t[i+3],(u&192)===128&&(h&192)===128&&(p&192)===128&&(o=(s&15)<<18|(u&63)<<12|(h&63)<<6|p&63,(o<=65535||o>=1114112)&&(o=null))),o===null?(o=65533,a=1):o>65535&&(o-=65536,r+=String.fromCharCode(o>>>10&1023|55296),o=56320|o&1023),r+=String.fromCharCode(o),i+=a}return r}function nG(t,e,n){return fI.decode(t.subarray(e,n))}function rG(t,e,n){for(var r=0,i,s;r<e.length;r++){if(i=e.charCodeAt(r),i>55295&&i<57344)if(s)if(i<56320){t[n++]=239,t[n++]=191,t[n++]=189,s=i;continue}else i=s-55296<<10|i-56320|65536,s=null;else{i>56319||r+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):s=i;continue}else s&&(t[n++]=239,t[n++]=191,t[n++]=189,s=null);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=i&63|128)}return n}const iG=G0(zK);var sG=Math.PI/180,oG=180/Math.PI;function hI(t){var e=JT(t[0]+1,t[2]),n=JT(t[0],t[2]),r=eE(t[1]+1,t[2]),i=eE(t[1],t[2]);return[n,r,e,i]}function aG(t){var e=hI(t),n={type:"Polygon",coordinates:[[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]]};return n}function JT(t,e){return t/Math.pow(2,e)*360-180}function eE(t,e){var n=Math.PI-2*Math.PI*t/Math.pow(2,e);return oG*Math.atan(.5*(Math.exp(n)-Math.exp(-n)))}function Z_(t,e,n){var r=yI(t,e,n);return r[0]=Math.floor(r[0]),r[1]=Math.floor(r[1]),r}function dI(t){return[[t[0]*2,t[1]*2,t[2]+1],[t[0]*2+1,t[1]*2,t[2]+1],[t[0]*2+1,t[1]*2+1,t[2]+1],[t[0]*2,t[1]*2+1,t[2]+1]]}function pI(t){return t[0]%2===0&&t[1]%2===0?[t[0]/2,t[1]/2,t[2]-1]:t[0]%2===0&&!t[1]%2===0?[t[0]/2,(t[1]-1)/2,t[2]-1]:!t[0]%2===0&&t[1]%2===0?[(t[0]-1)/2,t[1]/2,t[2]-1]:[(t[0]-1)/2,(t[1]-1)/2,t[2]-1]}function gI(t){return dI(pI(t))}function lG(t,e){for(var n=gI(t),r=0;r<n.length;r++)if(!mI(e,n[r]))return!1;return!0}function mI(t,e){for(var n=0;n<t.length;n++)if(_I(t[n],e))return!0;return!1}function _I(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function cG(t){for(var e="",n=t[2];n>0;n--){var r=0,i=1<<n-1;t[0]&i&&r++,t[1]&i&&(r+=2),e+=r.toString()}return e}function AG(t){for(var e=0,n=0,r=t.length,i=r;i>0;i--){var s=1<<i-1;switch(t[r-i]){case"0":break;case"1":e|=s;break;case"2":n|=s;break;case"3":e|=s,n|=s;break}}return[e,n,r]}function uG(t){var e=Z_(t[0],t[1],32),n=Z_(t[2],t[3],32),r=[e[0],e[1],n[0],n[1]],i=fG(r);if(i===0)return[0,0,0];var s=r[0]>>>32-i,o=r[1]>>>32-i;return[s,o,i]}function fG(t){for(var e=28,n=0;n<e;n++){var r=1<<32-(n+1);if((t[0]&r)!=(t[2]&r)||(t[1]&r)!=(t[3]&r))return n}return e}function yI(t,e,n){var r=Math.sin(e*sG),i=Math.pow(2,n),s=i*(t/360+.5),o=i*(.5-.25*Math.log((1+r)/(1-r))/Math.PI);return[s,o,n]}var S0={tileToGeoJSON:aG,tileToBBOX:hI,getChildren:dI,getParent:pI,getSiblings:gI,hasTile:mI,hasSiblings:lG,tilesEqual:_I,tileToQuadkey:cG,quadkeyToTile:AG,pointToTile:Z_,bboxToTile:uG,pointToTileFraction:yI},hG=dG;function dG(t,e){var n,r,i=t.coordinates,s=e.max_zoom,o={},a=[];if(t.type==="Point")return[S0.pointToTile(i[0],i[1],s)];if(t.type==="MultiPoint")for(n=0;n<i.length;n++)r=S0.pointToTile(i[n][0],i[n][1],s),o[Jr(r[0],r[1],r[2])]=!0;else if(t.type==="LineString")K_(o,i,s);else if(t.type==="MultiLineString")for(n=0;n<i.length;n++)K_(o,i[n],s);else if(t.type==="Polygon")tE(o,a,i,s);else if(t.type==="MultiPolygon")for(n=0;n<i.length;n++)tE(o,a,i[n],s);else throw new Error("Geometry type not implemented");if(e.min_zoom!==s){var u=a.length;for(nE(o,a),n=0;n<u;n++){var h=a[n];o[Jr(h[0],h[1],h[2])]=!0}return pG(o,a,e)}return nE(o,a),a}function pG(t,e,n){for(var r=[],i=n.max_zoom;i>n.min_zoom;i--){for(var s={},o=[],a=0;a<e.length;a++){var u=e[a];if(u[0]%2===0&&u[1]%2===0){var h=Jr(u[0]+1,u[1],i),p=Jr(u[0],u[1]+1,i),_=Jr(u[0]+1,u[1]+1,i);if(t[h]&&t[p]&&t[_]){t[Jr(u[0],u[1],u[2])]=!1,t[h]=!1,t[p]=!1,t[_]=!1;var v=[u[0]/2,u[1]/2,i-1];i-1===n.min_zoom?r.push(v):(s[Jr(u[0]/2,u[1]/2,i-1)]=!0,o.push(v))}}}for(a=0;a<e.length;a++)u=e[a],t[Jr(u[0],u[1],u[2])]&&r.push(u);t=s,e=o}return r}function tE(t,e,n,r){for(var i=[],s=0;s<n.length;s++){var o=[];K_(t,n[s],r,o);for(var a=0,u=o.length,h=u-1;a<u;h=a++){var p=(a+1)%u,_=o[a][1];(_>o[h][1]||_>o[p][1])&&(_<o[h][1]||_<o[p][1])&&_!==o[p][1]&&i.push(o[a])}}for(i.sort(gG),s=0;s<i.length;s+=2){_=i[s][1];for(var v=i[s][0]+1;v<i[s+1][0];v++){var b=Jr(v,_,r);t[b]||e.push([v,_,r])}}}function gG(t,e){return t[1]-e[1]||t[0]-e[0]}function K_(t,e,n,r){for(var i,s,o=0;o<e.length-1;o++){var a=S0.pointToTileFraction(e[o][0],e[o][1],n),u=S0.pointToTileFraction(e[o+1][0],e[o+1][1],n),h=a[0],p=a[1],_=u[0],v=u[1],b=_-h,E=v-p;if(!(E===0&&b===0)){var R=b>0?1:-1,D=E>0?1:-1,P=Math.floor(h),S=Math.floor(p),k=b===0?1/0:Math.abs(((b>0?1:0)+P-h)/b),M=E===0?1/0:Math.abs(((E>0?1:0)+S-p)/E),V=Math.abs(R/b),Y=Math.abs(D/E);for((P!==i||S!==s)&&(t[Jr(P,S,n)]=!0,r&&S!==s&&r.push([P,S]),i=P,s=S);k<1||M<1;)k<M?(k+=V,P+=R):(M+=Y,S+=D),t[Jr(P,S,n)]=!0,r&&S!==s&&r.push([P,S]),i=P,s=S}}r&&S===r[0][1]&&r.pop()}function nE(t,e){for(var n=Object.keys(t),r=0;r<n.length;r++)e.push(mG(+n[r]))}function Jr(t,e,n){var r=2*(1<<n);return(r*e+t)*32+n}function mG(t){var e=t%32,n=2*(1<<e),r=(t-e)/32,i=r%n,s=(r-i)/n%n;return[i,s,e]}const vI=[0x5555555555555555n,0x3333333333333333n,0x0f0f0f0f0f0f0f0fn,0x00ff00ff00ff00ffn,0x0000ffff0000ffffn,0x00000000ffffffffn],wI=[0n,1n,2n,4n,8n,16n],rE=512;function _G(t){const{x:e,y:n,z:r}=kd(t),i=rE/(1<<r);return[e*i,rE-n*i,i]}function yG(t,e){const[n,r,i]=_G(t);return[[n,r],[n+e*i,r-e*i]]}function vG(t,e=1){const[n,r]=yG(t,e),[i,s]=Oi(n),[o,a]=Oi(r);return[o,s,o,a,i,a,i,s,o,s]}function wG(t){return BigInt(`0x${t}`)}function G_(t){return t.toString(16)}function by(t){if(t.z<0||t.z>26)throw new Error("Wrong zoom");const e=BigInt(t.z);let n=BigInt(t.x)<<32n-e,r=BigInt(t.y)<<32n-e;for(let s=0;s<5;s++){const o=wI[5-s],a=vI[4-s];n=(n|n<<o)&a,r=(r|r<<o)&a}return 0x4000000000000000n|1n<<59n|e<<52n|(n|r<<1n)>>12n|0xfffffffffffffn>>e*2n}function kd(t){const e=t>>59n&7n,n=t>>57n&3n,r=t>>52n&0x1fn,i=(t&0xfffffffffffffn)<<12n;if(e!==1n&&n!==0n)throw new Error("Wrong mode");let s=i,o=i>>1n;for(let a=0;a<6;a++){const u=wI[a],h=vI[a];s=(s|s>>u)&h,o=(o|o>>u)&h}return s=s>>32n-r,o=o>>32n-r,{z:Number(r),x:Number(s),y:Number(o)}}function wu(t){return t>>52n&0x1fn}function bG(t){const e=wu(t)-1n;return t&~(0x1fn<<52n)|e<<52n|0xfffffffffffffn>>e*2n}function xG(t,e){const n=Number(e);return hG(t,{min_zoom:n,max_zoom:n}).map(([r,i,s])=>by({x:r,y:i,z:s}))}function TG(t){const e=vG(t);return{type:"Polygon",coordinates:[[[e[0],e[1]],[e[2],e[3]],[e[4],e[5]],[e[6],e[7]],[e[0],e[1]]]]}}function EG(t,e){return`https://unpkg.com/@deck.gl/carto@${e}/dist/${t}-worker.js`}const bI=512;class SG extends xk{getTileIndices(e){return super.getTileIndices(e).map(by).map(n=>({q:n,i:G_(n)}))}getTileId({q:e,i:n}){return n||G_(e)}getTileMetadata({q:e}){return super.getTileMetadata(kd(e))}getTileZoom({q:e}){return Number(wu(e))}getParentIndex({q:e}){return{q:bG(e)}}}const iE=512;function CG(t){const{x:e,y:n,z:r}=kd(t),i=iE/(1<<r);return[e*i,iE-n*i,i]}function PG(t,e){const[n,r,i]=CG(t);return[[n,r],[n+e*i,r-e*i]]}function RG(t,e=1){const[n,r]=PG(t,e),[i,s]=Oi(n),[o,a]=Oi(r);return[o,s,o,a,i,a,i,s,o,s]}function xI(t,e,n,r){const i=e.type===2?e.readVarint()+e.pos:e.pos+1,s=e.buf.buffer.slice(e.pos,i);if((r==null?void 0:r.compression)==="gzip"){const a=new UK().decompressSync(s);n.value=new t(a)}else n.value=new t(s);return e.pos=i,n.value}class xy{static read(e,n){return e.readFields(xy._readField,{key:"",value:null},n)}static _readField(e,n,r){e===1?n.key=r.readString():e===2&&(n.value=r.readString())}}class Ty{static read(e,n){return e.readFields(Ty._readField,{},n)}static _readField(e,n,r){if(e===1){const{key:i,value:s}=xy.read(r,r.readVarint()+r.pos);n[i]=s}}}class Ey{static read(e,n){return e.readFields(Ey._readField,{value:[]},n)}static _readField(e,n,r){e===1&&xI(Float64Array,r,n)}}class Sy{static read(e,n){return e.readFields(Sy._readField,{key:"",value:null},n)}static _readField(e,n,r){e===1?n.key=r.readString():e===2&&(n.value=Ey.read(r,r.readVarint()+r.pos))}}class Cy{static read(e,n){return e.readFields(Cy._readField,{value:[]},n)}static _readField(e,n,r){e===1&&xI(BigUint64Array,r,n)}}class Py{static read(e,n){return e.readFields(Py._readField,{indices:null,properties:[],numericProps:{}},n)}static _readField(e,n,r){if(e===1)n.indices=Cy.read(r,r.readVarint()+r.pos);else if(e===2)n.properties.push(Ty.read(r,r.readVarint()+r.pos));else if(e===3){const i=Sy.read(r,r.readVarint()+r.pos);n.numericProps[i.key]=i.value}}}class Ry{static read(e,n){return e.readFields(Ry._readField,{scheme:0,cells:null},n)}static _readField(e,n,r){e===1?n.scheme=r.readVarint():e===2&&(n.cells=Py.read(r,r.readVarint()+r.pos))}}function kG(t,e){const n=new iG(t);return e.read(n)}function IG(t){const{cells:e,scheme:n}=t,r=e.indices.value.length,i=[];for(let s=0;s<r;s++){const o=n==="h3"?G_(e.indices.value[s]):e.indices.value[s],a={...e.properties[s]};for(const u of Object.keys(e.numericProps))a[u]=e.numericProps[u].value[s];i.push({id:o,properties:a})}return i}const TI="9.2.0-alpha.2",EI="cartoSpatialTile",MG={cartoSpatialTile:{scheme:"quadbin",workerUrl:EG(EI,TI)}},OG={name:"CARTO Spatial Tile",version:TI,id:EI,module:"carto",extensions:["pbf"],mimeTypes:["application/vnd.carto-spatial-tile"],category:"geometry",parse:async(t,e)=>sE(t,e),parseSync:sE,worker:!0,options:MG};function sE(t,e){var o;if(!t)return null;const n=kG(t,Ry),{cells:r}=n,i=(o=e==null?void 0:e.cartoSpatialTile)==null?void 0:o.scheme;return IG({cells:r,scheme:i})}const NG=OG;function SI(t,e,n=0){if(!t)return e;if(!e)return t;if(n>10)return e;const r={...t};for(const i in e){const s=e[i];s===t||s===e||(typeof s=="object"&&s!==null?r[i]=SI(t[i],s,n+1):r[i]=s)}return r}const CI={type:"object",value:null,validate:(t,e)=>e.optional&&t===null||typeof t=="object"&&Array.isArray(t.tiles)&&t.tiles.every(n=>typeof n=="string"),equal:(t,e)=>pr(t,e,2),async:!0};bC([NG]);function DG(t){return t!=null&&t!==""}const BG={tileSize:bI};class ky extends jq{_updateAutoHighlight(e){const{hoveredFeatureId:n}=this.state,r=e.object;let i=null;if(r&&(i=r.id),n!==i){let{highlightColor:s}=this.props;typeof s=="function"&&(s=s(e)),this.setState({highlightColor:s,hoveredFeatureId:i})}}getSubLayerPropsByTile(e){return{highlightedObjectIndex:this.getHighlightedObjectIndex(e),highlightColor:this.state.highlightColor}}getHighlightedObjectIndex(e){const{hoveredFeatureId:n}=this.state,r=e.content;return!DG(n)||!Array.isArray(r)||!this._featureInTile(e,n)?-1:r.findIndex(s=>s.id===n)}_featureInTile(e,n){const r=this.state.tileset,i=r.getTileZoom(e.index),s=e.index.q?"q":"i";let o={[s]:n},a=r.getTileZoom(o);for(;!(a<=i);)o=r.getParentIndex(o),a=r.getTileZoom(o);return o[s]===e.index[s]}}ky.layerName="SpatialIndexTileLayer";ky.defaultProps=BG;const LG=ky,FG=`uniform heatmapUniforms {
  vec2 colorDomain;
  vec2 delta;
  float intensity;
  float opacity;
  float radiusPixels;
} heatmap;

uniform sampler2D colorTexture;

vec3 colorGradient(float value) {
  return texture(colorTexture, vec2(value, 0.5)).rgb;
}

const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
const float MAX_VAL = SHIFT.z * 255.0;
const float SCALE = MAX_VAL / 8.0;
vec4 pack(float value) {
  return vec4(mod(vec3(value, floor(value / SHIFT.yz)), 256.0), 255.0) / 255.0;
}
float unpack(vec3 color) {
  return 255.0 * dot(color, SHIFT);
}

vec4 heatmap_sampleColor(sampler2D source, vec2 texSize, vec2 texCoord) {
  bool firstPass = (heatmap.delta.y < 0.5);
  float accumulator = 0.0;

  // Controls quality of heatmap, larger values increase quality at expense of performance
  float SUPPORT = clamp(heatmap.radiusPixels / 2.0, 8.0, 32.0);

  // Gaussian normalization parameters
  float sigma = SUPPORT / 3.0;
  float a = -0.5 / (sigma * sigma);
  float w0 = 0.3989422804014327 / sigma; // 1D normalization
  for (float t = -SUPPORT; t <= SUPPORT; t++) {
    vec2 percent = (t * heatmap.delta - 0.5) / SUPPORT;
    vec2 delta = percent * heatmap.radiusPixels / texSize;
    vec4 offsetColor = texture(source, texCoord + delta);

    // Unpack float
    float value = unpack(offsetColor.rgb);

    // Gaussian
    float weight = w0 * exp(a * t * t);
    
    accumulator += value * weight;
  }

  if (firstPass) {
    return pack(accumulator);
  }

  // Undo scaling to obtain normalized density
  float density = 10.0 * heatmap.intensity * accumulator / SCALE;
 
  // Domain also in normalized density units
  vec2 domain = heatmap.colorDomain;

  // Apply domain
  float f = (density - domain[0]) / (domain[1] - domain[0]);

  // sqrt/log scaling??
  // float f = (log(density) - log(domain[0] + 1.0)) / (log(domain[1] + 1.0) - log(domain[0] + 1.0));
  // f = sqrt(f);

  // Color map
  vec4 color = vec4(0.0);
  color.rgb = colorGradient(f);

  color.a = smoothstep(0.0, 0.1, f);
  color.a = pow(color.a, 1.0 / 2.2);
  color.a *= heatmap.opacity;

  return color;
}
`,UG={name:"heatmap",uniformPropTypes:{colorDomain:{value:[0,1]},delta:{value:[0,1]},intensity:{value:1,min:.1,max:10},opacity:{value:1,min:0,max:1},radiusPixels:{value:20,min:0,softMax:100}},uniformTypes:{colorDomain:"vec2<f32>",delta:"vec2<f32>",intensity:"f32",opacity:"f32",radiusPixels:"f32"},getUniforms:t=>{if(!t)return{};const{colorDomain:e=[0,1],colorTexture:n,delta:r=[1,0],intensity:i=1,opacity:s=1,radiusPixels:o=20}=t;return{colorDomain:e,colorTexture:n,delta:r,intensity:i,opacity:s,radiusPixels:o}},fs:FG,passes:[{sampler:!0,uniforms:{delta:[1,0]}},{sampler:!0,uniforms:{delta:[0,1]}}]},zG={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function J_(t){for(;t.parent&&!t.applyPostProcess;)t=t.parent;return t}class PI extends ho{initializeState(){this.id=`draw-callback-${J_(this).props.id}`}_drawLayer(){J_(this).applyPostProcess()}}PI.layerName="DrawCallbackLayer";function VG(t){var e;return e=class extends t{draw(r){const{shaderModuleProps:i}=r,{picking:s}=i,o=J_(this);s.isActive||o.enableRTT(r),super.draw(r),s.isActive||o.disableRTT()}},e.layerName=`RTT-${t.layerName}`,e}function $G(t,e){var n;return n=class extends t{initializeState(i){super.initializeState(i),this._createTextures(),this.internalState.postProcess=new WV(e,this.props),this.internalState.postProcess.setup(i)}updateState(i){super.updateState(i),this.internalState.postProcess.setProps(this.props)}renderLayers(){let i=super.renderLayers();return i?(i=Array.isArray(i)?i:[i],[...i,new PI]):null}_createTextures(){const{device:i}=this.context;this.internalState.renderBuffers=[0,1].map(s=>i.createFramebuffer({id:`layer-fbo-${s}`,colorAttachments:[i.createTexture(zG)],depthStencilAttachment:"depth16unorm"}))}_resizeBuffers(i){const{shaderModuleProps:s}=i,{viewport:o}=this.context,{devicePixelRatio:a}=s.project,u=a*o.width,h=a*o.height;this.internalState.renderBuffers.forEach(p=>p.resize({width:u,height:h}))}enableRTT(i){this._resizeBuffers(i),this.internalState.originalRenderPass=this.context.renderPass;const[s]=this.internalState.renderBuffers;this.internalState.internalRenderPass=this.context.device.beginRenderPass({framebuffer:s,parameters:{viewport:[0,0,s.width,s.height]},clearColor:this.internalState.renderInProgress?!1:[0,0,0,0]}),this.internalState.renderInProgress=!0,this.context.renderPass=this.internalState.internalRenderPass}disableRTT(){this.internalState.internalRenderPass.end(),this.context.renderPass=this.internalState.originalRenderPass}applyPostProcess(){if(!this.internalState.renderInProgress)return;const[i,s]=this.internalState.renderBuffers,{framebuffer:o}=this.context.renderPass.props;this.internalState.postProcess.postRender({inputBuffer:i,swapBuffer:s,target:o}),this.internalState.renderInProgress=!1}_finalize(){this.internalState.renderBuffers.forEach(i=>{i.destroy()}),this.internalState.renderBuffers=null,this.internalState.postProcess.cleanup()}},n.layerName=`PostProcess${t.layerName}`,n}const WG={getQuadbin:{type:"accessor",value:t=>t.quadbin}};class Iy extends _Y{indexToBounds(){const{data:e,extruded:n,getQuadbin:r}=this.props,i=n?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>RG(r(s,o),i),updateTriggers:{getPolygon:i}}}}Iy.layerName="QuadbinLayer";Iy.defaultProps=WG;const jG=Iy,HG=t=>{const{data:e}=t;if(!e||!e.length)return null;const n=typeof e[0].id=="bigint";return new jG(t,{getQuadbin:n?r=>r.id:r=>wG(r.id)})},XG={data:CI,tileSize:bI};class My extends da{getLoadOptions(){const e=this.props.data;return SI(super.getLoadOptions(),{fetch:{headers:{Authorization:`Bearer ${e.accessToken}`}},cartoSpatialTile:{scheme:"quadbin"}})}renderLayers(){const e=this.props.data;if(!e)return null;const{tiles:n,maxresolution:r}=e,i=this.getSubLayerClass("spatial-index-tile",LG);return new i(this.props,{id:`quadbin-tile-layer-${this.props.id}`,data:n,TilesetClass:SG,renderSubLayers:HG,maxZoom:r,loadOptions:this.getLoadOptions()})}}My.layerName="QuadbinTileLayer";My.defaultProps=XG;const QG=My,YG=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],qG={format:"rgba8unorm",mipmaps:!1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};function RI(t){const e=Number(wu(t));return Math.pow(4,e)}function ZG(t){const e=new Uint8Array(t.length*4);let n=0;for(let r=0;r<t.length;r++){const i=t[r];e[n++]=i[0],e[n++]=i[1],e[n++]=i[2],e[n++]=Number.isFinite(i[3])?i[3]:255}return e}const KG=`uniform densityUniforms {
  float factor;
} density;
`,GG={name:"density",vs:KG,uniformTypes:{factor:"f32"}};class kI extends VG(ey){getShaders(e){const n=super.getShaders(e);return n.inject={"vs:#main-end":`
      // Value from getWeight accessor
  float weight = elevations;

  // Keep "power" delivered to screen constant when tiles update
  // by outputting normalized density
  weight *= density.factor;

  // Pack float into 3 channels to pass to heatmap shader
  // SCALE value important, as we don't want to saturate
  // but also want enough definition to avoid banding
  const vec3 SHIFT = vec3(1.0, 256.0, 256.0 * 256.0);
  const float MAX_VAL = SHIFT.z * 255.0;
  const float SCALE = MAX_VAL / 8.0;
  weight *= SCALE;
  weight = clamp(weight, 0.0, MAX_VAL);
  vColor = vec4(mod(vec3(weight, floor(weight / SHIFT.yz)), 256.0), 255.0) / 255.0;
`},n.modules=[...n.modules,GG],n}draw(e){const n=this.props.data[0],r=this.props.elevationScale,i={factor:RI(n.id)/r};for(const s of this.state.models)s.shaderInputs.setProps({density:i});super.draw(e)}}kI.layerName="RTTSolidPolygonLayer";const JG=$G(QG,UG),eJ={data:CI,getWeight:{type:"accessor",value:1},onMaxDensityChange:{type:"function",optional:!0,value:null},colorDomain:{type:"array",value:[0,1]},colorRange:YG,intensity:{type:"number",value:1},radiusPixels:{type:"number",min:0,max:100,value:20}};class Oy extends da{initializeState(){this.state={isLoaded:!1,tiles:new Set,viewportChanged:!1}}shouldUpdateState({changeFlags:e}){const{viewportChanged:n}=e;return this.setState({viewportChanged:n}),e.somethingChanged}updateState(e){const{props:n,oldProps:r}=e;super.updateState(e),n.colorRange!==r.colorRange&&this._updateColorTexture(e)}renderLayers(){var V,Y,le;const{data:e,getWeight:n,colorDomain:r,intensity:i,radiusPixels:s,_subLayerProps:o,updateTriggers:a,onMaxDensityChange:u,onViewportLoad:h,onTileLoad:p,onTileUnload:_,...v}=this.props,b={...o,cell:{...o==null?void 0:o.cell,_subLayerProps:{...(V=o==null?void 0:o.cell)==null?void 0:V._subLayerProps,fill:{...(le=(Y=o==null?void 0:o.cell)==null?void 0:Y._subLayerProps)==null?void 0:le.fill,type:kI}}}};let E=0,R=0;const D=[...this.state.tiles].filter(I=>I.content),P=D.filter(I=>I.isVisible),S=P.length?P:D;for(const I of S){const O=I.content[0],U=RI(O.id);R=Math.max(I.userData.maxWeight*U,R),E=Math.max(I.zoom,E)}const k=this.context.viewport.zoom-E;return R=R*Math.pow(2,k),typeof u=="function"&&u(R),new JG(v,this.getSubLayerProps({id:"heatmap",data:e,getFillColor:0,getElevation:n,elevationScale:R,colorDomain:r,radiusPixels:s,intensity:i,_subLayerProps:b,refinementStrategy:"no-overlap",colorTexture:this.state.colorTexture,extruded:!1,stroked:!1,updateTriggers:{getElevation:a.getWeight},onViewportLoad:I=>{this.setState({isLoaded:!0}),typeof h=="function"&&h(I)},onTileLoad:I=>{let O=-1/0;if(typeof n!="function")O=n;else if(I.content)for(const U of I.content)O=Math.max(n(U,{}),O);I.userData={maxWeight:O},this.state.tiles.add(I),typeof p=="function"&&p(I)},onTileUnload:I=>{this.state.tiles.delete(I),typeof _=="function"&&_(I)},transitions:{elevationScale:{type:"spring",stiffness:.3,damping:.5}}}))}_updateColorTexture(e){const{colorRange:n}=e.props;let{colorTexture:r}=this.state;const i=ZG(n);r&&(r==null?void 0:r.width)===n.length?r.setTexture2DData({data:i}):(r==null||r.destroy(),r=this.context.device.createTexture({...qG,data:i,width:n.length,height:1})),this.setState({colorTexture:r})}}Oy.layerName="HeatmapTileLayer";Oy.defaultProps=eJ;const tJ=Oy;function nJ(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function C0(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function rJ(t){return t=C0(Math.abs(t)),t?t[1]:NaN}function iJ(t,e){return function(n,r){for(var i=n.length,s=[],o=0,a=t[0],u=0;i>0&&a>0&&(u+a+1>r&&(a=Math.max(1,r-u)),s.push(n.substring(i-=a,i+a)),!((u+=a+1)>r));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function sJ(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var oJ=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function e2(t){if(!(e=oJ.exec(t)))throw new Error("invalid format: "+t);var e;return new Ny({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}e2.prototype=Ny.prototype;function Ny(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Ny.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function aJ(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var II;function lJ(t,e){var n=C0(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(II=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+C0(t,Math.max(0,e+s-1))[0]}function oE(t,e){var n=C0(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const aE={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:nJ,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>oE(t*100,e),r:oE,s:lJ,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function lE(t){return t}var cE=Array.prototype.map,AE=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function cJ(t){var e=t.grouping===void 0||t.thousands===void 0?lE:iJ(cE.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?lE:sJ(cE.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"−":t.minus+"",u=t.nan===void 0?"NaN":t.nan+"";function h(_){_=e2(_);var v=_.fill,b=_.align,E=_.sign,R=_.symbol,D=_.zero,P=_.width,S=_.comma,k=_.precision,M=_.trim,V=_.type;V==="n"?(S=!0,V="g"):aE[V]||(k===void 0&&(k=12),M=!0,V="g"),(D||v==="0"&&b==="=")&&(D=!0,v="0",b="=");var Y=R==="$"?n:R==="#"&&/[boxX]/.test(V)?"0"+V.toLowerCase():"",le=R==="$"?r:/[%p]/.test(V)?o:"",I=aE[V],O=/[defgprs%]/.test(V);k=k===void 0?6:/[gprs]/.test(V)?Math.max(1,Math.min(21,k)):Math.max(0,Math.min(20,k));function U($){var q=Y,Z=le,ee,G,oe;if(V==="c")Z=I($)+Z,$="";else{$=+$;var ue=$<0||1/$<0;if($=isNaN($)?u:I(Math.abs($),k),M&&($=aJ($)),ue&&+$==0&&E!=="+"&&(ue=!1),q=(ue?E==="("?E:a:E==="-"||E==="("?"":E)+q,Z=(V==="s"?AE[8+II/3]:"")+Z+(ue&&E==="("?")":""),O){for(ee=-1,G=$.length;++ee<G;)if(oe=$.charCodeAt(ee),48>oe||oe>57){Z=(oe===46?i+$.slice(ee+1):$.slice(ee))+Z,$=$.slice(0,ee);break}}}S&&!D&&($=e($,1/0));var K=q.length+$.length+Z.length,de=K<P?new Array(P-K+1).join(v):"";switch(S&&D&&($=e(de+$,de.length?P-Z.length:1/0),de=""),b){case"<":$=q+$+Z+de;break;case"=":$=q+de+$+Z;break;case"^":$=de.slice(0,K=de.length>>1)+q+$+Z+de.slice(K);break;default:$=de+q+$+Z;break}return s($)}return U.toString=function(){return _+""},U}function p(_,v){var b=h((_=e2(_),_.type="f",_)),E=Math.max(-8,Math.min(8,Math.floor(rJ(v)/3)))*3,R=Math.pow(10,-E),D=AE[8+E/3];return function(P){return b(R*P)+D}}return{format:h,formatPrefix:p}}var Df,t2;AJ({thousands:",",grouping:[3],currency:["$",""]});function AJ(t){return Df=cJ(t),t2=Df.format,Df.formatPrefix,Df}var uJ=Object.create,Dy=Object.defineProperty,fJ=Object.getOwnPropertyDescriptor,MI=Object.getOwnPropertyNames,hJ=Object.getPrototypeOf,dJ=Object.prototype.hasOwnProperty,pJ=(t,e,n)=>e in t?Dy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,gJ=(t,e)=>function(){return e||(0,t[MI(t)[0]])((e={exports:{}}).exports,e),e.exports},mJ=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of MI(e))!dJ.call(t,i)&&i!==n&&Dy(t,i,{get:()=>e[i],enumerable:!(r=fJ(e,i))||r.enumerable});return t},_J=(t,e,n)=>(n=t!=null?uJ(hJ(t)):{},mJ(e||!t||!t.__esModule?Dy(n,"default",{value:t,enumerable:!0}):n,t)),Me=(t,e,n)=>pJ(t,typeof e!="symbol"?e+"":e,n),yJ=gJ({"node_modules/thenby/thenBy.module.js"(t,e){e.exports=function(){function n(o){return o}function r(o){return typeof o=="string"?o.toLowerCase():o}function i(o,a){if(a=typeof a=="object"?a:{direction:a},typeof o!="function"){var u=o;o=function(b){return b[u]?b[u]:""}}if(o.length===1){var h=o,p=a.ignoreCase?r:n,_=a.cmp||function(b,E){return b<E?-1:b>E?1:0};o=function(b,E){return _(p(h(b)),p(h(E)))}}const v={"-1":"",desc:""};return a.direction in v?function(b,E){return-o(b,E)}:o}function s(o,a){var u=typeof this=="function"&&!this.firstBy?this:!1,h=i(o,a),p=u?function(_,v){return u(_,v)||h(_,v)}:h;return p.thenBy=s,p}return s.firstBy=s,s}()}}),vJ="deck-gl-carto";function Id(){return vJ}var By=(t=>(t.IN="in",t.BETWEEN="between",t.CLOSED_OPEN="closed_open",t.TIME="time",t.STRING_SEARCH="stringSearch",t))(By||{}),OI=(t=>(t.V1="v1",t.V2="v2",t.V3="v3",t))(OI||{}),NI="https://gcp-us-east1.api.carto.com",xi={Count:"count",Avg:"avg",Min:"min",Max:"max",Sum:"sum",Custom:"custom"};function DI(t){return t.map(e=>e[0]===void 0||e[0]===null?[Number.MIN_SAFE_INTEGER,e[1]]:e[1]===void 0||e[1]===null?[e[0],Number.MAX_SAFE_INTEGER]:e)}var wJ={in:bJ,between:BI,time:xJ,closed_open:TJ,stringSearch:EJ};function bJ(t,e){return t.includes(e)}function BI(t,e){const n=r=>{const[i,s]=r;return e>=i&&e<=s};return DI(t).some(n)}function xJ(t,e){const n=new Date(e).getTime();if(isFinite(n))return BI(t,n);throw new Error("Column used to filter by time isn't well formatted.")}function TJ(t,e){const n=r=>{const[i,s]=r;return e>=i&&e<s};return DI(t).some(n)}function EJ(t,e,n={}){const r=uE(e,n),i=n.useRegExp?t:t.map(o=>{let a=PJ(uE(o,n));return n.mustStart&&(a=`^${a}`),n.mustEnd&&(a=`${a}$`),a}),s=new RegExp(i.join("|"),n.caseSensitive?"g":"gi");return!!r.match(s)}var SJ=/[.*+?^${}()|[\]\\]/g,CJ=/\p{Diacritic}/gu;function PJ(t){return t.replace(SJ,"\\$&")}function uE(t,e){let n=String(t);return e.keepSpecialCharacters||(n=n.normalize("NFD").replace(CJ,"")),n}var RJ={and:"every",or:"some"};function kJ(t,e,n,r){const i=RJ[r];return t[i](s=>{const o=e[s],a=Object.keys(o);return!n||n[s]===null||n[s]===void 0?!1:a.every(u=>{const h=wJ[u];if(!h)throw new Error(`"${u}" filter is not implemented.`);return h(o[u].values,n[s],o[u].params)})})}function IJ({filters:t={},type:e="boolean",filtersLogicalOperator:n="and"}){const r=Object.keys(t);return r.length?i=>{const s=i.properties||i,o=kJ(r,t,s,n);return e==="number"?Number(o):o}:()=>e==="number"?1:!0}function MJ(t,e,n){return Object.keys(e).length?t.filter(IJ({filters:e,filtersLogicalOperator:n})):t}var es=11102230246251565e-32,On=134217729,OJ=(3+8*es)*es;function Fg(t,e,n,r,i){let s,o,a,u,h=e[0],p=r[0],_=0,v=0;p>h==p>-h?(s=h,h=e[++_]):(s=p,p=r[++v]);let b=0;if(_<t&&v<n)for(p>h==p>-h?(o=h+s,a=s-(o-h),h=e[++_]):(o=p+s,a=s-(o-p),p=r[++v]),s=o,a!==0&&(i[b++]=a);_<t&&v<n;)p>h==p>-h?(o=s+h,u=o-s,a=s-(o-u)+(h-u),h=e[++_]):(o=s+p,u=o-s,a=s-(o-u)+(p-u),p=r[++v]),s=o,a!==0&&(i[b++]=a);for(;_<t;)o=s+h,u=o-s,a=s-(o-u)+(h-u),h=e[++_],s=o,a!==0&&(i[b++]=a);for(;v<n;)o=s+p,u=o-s,a=s-(o-u)+(p-u),p=r[++v],s=o,a!==0&&(i[b++]=a);return(s!==0||b===0)&&(i[b++]=s),b}function NJ(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}function bu(t){return new Float64Array(t)}var DJ=(3+16*es)*es,BJ=(2+12*es)*es,LJ=(9+64*es)*es*es,za=bu(4),fE=bu(8),hE=bu(12),dE=bu(16),$n=bu(4);function FJ(t,e,n,r,i,s,o){let a,u,h,p,_,v,b,E,R,D,P,S,k,M,V,Y,le,I;const O=t-i,U=n-i,$=e-s,q=r-s;M=O*q,v=On*O,b=v-(v-O),E=O-b,v=On*q,R=v-(v-q),D=q-R,V=E*D-(M-b*R-E*R-b*D),Y=$*U,v=On*$,b=v-(v-$),E=$-b,v=On*U,R=v-(v-U),D=U-R,le=E*D-(Y-b*R-E*R-b*D),P=V-le,_=V-P,za[0]=V-(P+_)+(_-le),S=M+P,_=S-M,k=M-(S-_)+(P-_),P=k-Y,_=k-P,za[1]=k-(P+_)+(_-Y),I=S+P,_=I-S,za[2]=S-(I-_)+(P-_),za[3]=I;let Z=NJ(4,za),ee=BJ*o;if(Z>=ee||-Z>=ee||(_=t-O,a=t-(O+_)+(_-i),_=n-U,h=n-(U+_)+(_-i),_=e-$,u=e-($+_)+(_-s),_=r-q,p=r-(q+_)+(_-s),a===0&&u===0&&h===0&&p===0)||(ee=LJ*o+OJ*Math.abs(Z),Z+=O*p+q*a-($*h+U*u),Z>=ee||-Z>=ee))return Z;M=a*q,v=On*a,b=v-(v-a),E=a-b,v=On*q,R=v-(v-q),D=q-R,V=E*D-(M-b*R-E*R-b*D),Y=u*U,v=On*u,b=v-(v-u),E=u-b,v=On*U,R=v-(v-U),D=U-R,le=E*D-(Y-b*R-E*R-b*D),P=V-le,_=V-P,$n[0]=V-(P+_)+(_-le),S=M+P,_=S-M,k=M-(S-_)+(P-_),P=k-Y,_=k-P,$n[1]=k-(P+_)+(_-Y),I=S+P,_=I-S,$n[2]=S-(I-_)+(P-_),$n[3]=I;const G=Fg(4,za,4,$n,fE);M=O*p,v=On*O,b=v-(v-O),E=O-b,v=On*p,R=v-(v-p),D=p-R,V=E*D-(M-b*R-E*R-b*D),Y=$*h,v=On*$,b=v-(v-$),E=$-b,v=On*h,R=v-(v-h),D=h-R,le=E*D-(Y-b*R-E*R-b*D),P=V-le,_=V-P,$n[0]=V-(P+_)+(_-le),S=M+P,_=S-M,k=M-(S-_)+(P-_),P=k-Y,_=k-P,$n[1]=k-(P+_)+(_-Y),I=S+P,_=I-S,$n[2]=S-(I-_)+(P-_),$n[3]=I;const oe=Fg(G,fE,4,$n,hE);M=a*p,v=On*a,b=v-(v-a),E=a-b,v=On*p,R=v-(v-p),D=p-R,V=E*D-(M-b*R-E*R-b*D),Y=u*h,v=On*u,b=v-(v-u),E=u-b,v=On*h,R=v-(v-h),D=h-R,le=E*D-(Y-b*R-E*R-b*D),P=V-le,_=V-P,$n[0]=V-(P+_)+(_-le),S=M+P,_=S-M,k=M-(S-_)+(P-_),P=k-Y,_=k-P,$n[1]=k-(P+_)+(_-Y),I=S+P,_=I-S,$n[2]=S-(I-_)+(P-_),$n[3]=I;const ue=Fg(oe,hE,4,$n,dE);return dE[ue-1]}function UJ(t,e,n,r,i,s){const o=(e-s)*(n-i),a=(t-i)*(r-s),u=o-a,h=Math.abs(o+a);return Math.abs(u)>=DJ*h?u:-FJ(t,e,n,r,i,s,h)}function zJ(t,e){var n,r,i=0,s,o,a,u,h,p,_,v=t[0],b=t[1],E=e.length;for(n=0;n<E;n++){r=0;var R=e[n],D=R.length-1;if(p=R[0],p[0]!==R[D][0]&&p[1]!==R[D][1])throw new Error("First and last coordinates in a ring must be the same");for(o=p[0]-v,a=p[1]-b,r;r<D;r++){if(_=R[r+1],u=_[0]-v,h=_[1]-b,a===0&&h===0){if(u<=0&&o>=0||o<=0&&u>=0)return 0}else if(h>=0&&a<=0||h<=0&&a>=0){if(s=UJ(o,u,a,h,0,0),s===0)return 0;(s>0&&h>0&&a<=0||s<0&&h<=0&&a>0)&&i++}p=_,a=h,o=u}}return i%2!==0}function lr(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function VJ(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!pE(t[0])||!pE(t[1]))throw new Error("coordinates must contain numbers");return lr({type:"Point",coordinates:t},e,n)}function Ly(t,e,n={}){for(const i of t){if(i.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(i[i.length-1].length!==i[0].length)throw new Error("First and last Position are not equivalent.");for(let s=0;s<i[i.length-1].length;s++)if(i[i.length-1][s]!==i[0][s])throw new Error("First and last Position are not equivalent.")}return lr({type:"Polygon",coordinates:t},e,n)}function LI(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return lr({type:"LineString",coordinates:t},e,n)}function JA(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function FI(t,e,n={}){return lr({type:"MultiLineString",coordinates:t},e,n)}function UI(t,e,n={}){return lr({type:"MultiPolygon",coordinates:t},e,n)}function pE(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function zI(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}function pA(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function ls(t){return t.type==="Feature"?t.geometry:t}function $J(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}function Ur(t,e,n={}){if(!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");const r=zI(t),i=ls(e),s=i.type,o=e.bbox;let a=i.coordinates;if(o&&WJ(r,o)===!1)return!1;s==="Polygon"&&(a=[a]);let u=!1;for(var h=0;h<a.length;++h){const p=zJ(r,a[h]);if(p===0)return!n.ignoreBoundary;p&&(u=!0)}return u}function WJ(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}var VI=class{constructor(t=[],e=jJ){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const i=t-1>>1,s=e[i];if(n(r,s)>=0)break;e[t]=s,t=i}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,i=e[t];for(;t<r;){let s=(t<<1)+1,o=e[s];const a=s+1;if(a<this.length&&n(e[a],o)<0&&(s=a,o=e[a]),n(o,i)>=0)break;e[t]=o,t=s}e[t]=i}};function jJ(t,e){return t<e?-1:t>e?1:0}function $I(t,e){return t.p.x>e.p.x?1:t.p.x<e.p.x?-1:t.p.y!==e.p.y?t.p.y>e.p.y?1:-1:1}function HJ(t,e){return t.rightSweepEvent.p.x>e.rightSweepEvent.p.x?1:t.rightSweepEvent.p.x<e.rightSweepEvent.p.x?-1:t.rightSweepEvent.p.y!==e.rightSweepEvent.p.y?t.rightSweepEvent.p.y<e.rightSweepEvent.p.y?1:-1:1}var gE=class{constructor(e,n,r,i){this.p={x:e[0],y:e[1]},this.featureId=n,this.ringId=r,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}};function XJ(t,e){if(t.type==="FeatureCollection"){const n=t.features;for(let r=0;r<n.length;r++)mE(n[r],e)}else mE(t,e)}var Bf=0,Lf=0,Ff=0;function mE(t,e){const n=t.type==="Feature"?t.geometry:t;let r=n.coordinates;(n.type==="Polygon"||n.type==="MultiLineString")&&(r=[r]),n.type==="LineString"&&(r=[[r]]);for(let i=0;i<r.length;i++)for(let s=0;s<r[i].length;s++){let o=r[i][s][0],a=null;Lf=Lf+1;for(let u=0;u<r[i][s].length-1;u++){a=r[i][s][u+1];const h=new gE(o,Bf,Lf,Ff),p=new gE(a,Bf,Lf,Ff+1);h.otherEvent=p,p.otherEvent=h,$I(h,p)>0?(p.isLeftEndpoint=!0,h.isLeftEndpoint=!1):(h.isLeftEndpoint=!0,p.isLeftEndpoint=!1),e.push(h),e.push(p),o=a,Ff=Ff+1}}Bf=Bf+1}var QJ=class{constructor(t){this.leftSweepEvent=t,this.rightSweepEvent=t.otherEvent}};function YJ(t,e){if(t===null||e===null||t.leftSweepEvent.ringId===e.leftSweepEvent.ringId&&(t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.leftSweepEvent)||t.rightSweepEvent.isSamePoint(e.rightSweepEvent)||t.leftSweepEvent.isSamePoint(e.leftSweepEvent)||t.leftSweepEvent.isSamePoint(e.rightSweepEvent)))return!1;const n=t.leftSweepEvent.p.x,r=t.leftSweepEvent.p.y,i=t.rightSweepEvent.p.x,s=t.rightSweepEvent.p.y,o=e.leftSweepEvent.p.x,a=e.leftSweepEvent.p.y,u=e.rightSweepEvent.p.x,h=e.rightSweepEvent.p.y,p=(h-a)*(i-n)-(u-o)*(s-r),_=(u-o)*(r-a)-(h-a)*(n-o),v=(i-n)*(r-a)-(s-r)*(n-o);if(p===0)return!1;const b=_/p,E=v/p;if(b>=0&&b<=1&&E>=0&&E<=1){const R=n+b*(i-n),D=r+b*(s-r);return[R,D]}return!1}function qJ(t,e){e=e||!1;const n=[],r=new VI([],HJ);for(;t.length;){const i=t.pop();if(i.isLeftEndpoint){const s=new QJ(i);for(let o=0;o<r.data.length;o++){const a=r.data[o];if(e&&a.leftSweepEvent.featureId===i.featureId)continue;const u=YJ(s,a);u!==!1&&n.push(u)}r.push(s)}else i.isLeftEndpoint===!1&&r.pop()}return n}function ZJ(t,e){const n=new VI([],$I);return XJ(t,n),qJ(n,e)}var KJ=ZJ,GJ=KJ;function Fy(t,e,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:i=!0}=n;let s=[];t.type==="FeatureCollection"?s=s.concat(t.features):t.type==="Feature"?s.push(t):(t.type==="LineString"||t.type==="Polygon"||t.type==="MultiLineString"||t.type==="MultiPolygon")&&s.push(lr(t)),e.type==="FeatureCollection"?s=s.concat(e.features):e.type==="Feature"?s.push(e):(e.type==="LineString"||e.type==="Polygon"||e.type==="MultiLineString"||e.type==="MultiPolygon")&&s.push(lr(e));const o=GJ(JA(s),i);let a=[];if(r){const u={};o.forEach(h=>{const p=h.join(",");u[p]||(u[p]=!0,a.push(h))})}else a=o;return JA(a.map(u=>VJ(u)))}function WI(t,e,n){if(t!==null)for(var r,i,s,o,a,u,h,p=0,_=0,v,b=t.type,E=b==="FeatureCollection",R=b==="Feature",D=E?t.features.length:1,P=0;P<D;P++){h=E?t.features[P].geometry:R?t.geometry:t,v=h?h.type==="GeometryCollection":!1,a=v?h.geometries.length:1;for(var S=0;S<a;S++){var k=0,M=0;if(o=v?h.geometries[S]:h,o!==null){u=o.coordinates;var V=o.type;switch(p=n&&(V==="Polygon"||V==="MultiPolygon")?1:0,V){case null:break;case"Point":if(e(u,_,P,k,M)===!1)return!1;_++,k++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(e(u[r],_,P,k,M)===!1)return!1;_++,V==="MultiPoint"&&k++}V==="LineString"&&k++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-p;i++){if(e(u[r][i],_,P,k,M)===!1)return!1;_++}V==="MultiLineString"&&k++,V==="Polygon"&&M++}V==="Polygon"&&k++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(M=0,i=0;i<u[r].length;i++){for(s=0;s<u[r][i].length-p;s++){if(e(u[r][i][s],_,P,k,M)===!1)return!1;_++}M++}k++}break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(WI(o.geometries[r],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function jI(t,e){var n,r,i,s,o,a,u,h,p,_,v=0,b=t.type==="FeatureCollection",E=t.type==="Feature",R=b?t.features.length:1;for(n=0;n<R;n++){for(a=b?t.features[n].geometry:E?t.geometry:t,h=b?t.features[n].properties:E?t.properties:{},p=b?t.features[n].bbox:E?t.bbox:void 0,_=b?t.features[n].id:E?t.id:void 0,u=a?a.type==="GeometryCollection":!1,o=u?a.geometries.length:1,i=0;i<o;i++){if(s=u?a.geometries[i]:a,s===null){if(e(null,v,h,p,_)===!1)return!1;continue}switch(s.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(s,v,h,p,_)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<s.geometries.length;r++)if(e(s.geometries[r],v,h,p,_)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}v++}}function P0(t,e){jI(t,function(n,r,i,s,o){var a=n===null?null:n.type;switch(a){case null:case"Point":case"LineString":case"Polygon":return e(lr(n,i,{bbox:s,id:o}),r,0)===!1?!1:void 0}var u;switch(a){case"MultiPoint":u="Point";break;case"MultiLineString":u="LineString";break;case"MultiPolygon":u="Polygon";break}for(var h=0;h<n.coordinates.length;h++){var p=n.coordinates[h],_={type:u,coordinates:p};if(e(lr(_,i),r,h)===!1)return!1}})}function n2(t,e={}){const n=ls(t);switch(!e.properties&&t.type==="Feature"&&(e.properties=t.properties),n.type){case"Polygon":return JJ(n,e);case"MultiPolygon":return eee(n,e);default:throw new Error("invalid poly")}}function JJ(t,e={}){const r=ls(t).coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{};return HI(r,i)}function eee(t,e={}){const r=ls(t).coordinates,i=e.properties?e.properties:t.type==="Feature"?t.properties:{},s=[];return r.forEach(o=>{s.push(HI(o,i))}),JA(s)}function HI(t,e){return t.length>1?FI(t,e):LI(t[0],e)}function tee(t,e,{ignoreSelfIntersections:n=!0}={ignoreSelfIntersections:!0}){let r=!0;return P0(t,i=>{P0(e,s=>{if(r===!1)return!1;r=nee(i.geometry,s.geometry,n)})}),r}function nee(t,e,n){switch(t.type){case"Point":switch(e.type){case"Point":return!oee(t.coordinates,e.coordinates);case"LineString":return!_E(e,t);case"Polygon":return!Ur(t,e)}break;case"LineString":switch(e.type){case"Point":return!_E(t,e);case"LineString":return!ree(t,e,n);case"Polygon":return!yE(e,t,n)}break;case"Polygon":switch(e.type){case"Point":return!Ur(e,t);case"LineString":return!yE(t,e,n);case"Polygon":return!iee(e,t,n)}}return!1}function _E(t,e){for(let n=0;n<t.coordinates.length-1;n++)if(see(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function ree(t,e,n){return Fy(t,e,{ignoreSelfIntersections:n}).features.length>0}function yE(t,e,n){for(const i of e.coordinates)if(Ur(i,t))return!0;return Fy(e,n2(t),{ignoreSelfIntersections:n}).features.length>0}function iee(t,e,n){for(const i of t.coordinates[0])if(Ur(i,e))return!0;for(const i of e.coordinates[0])if(Ur(i,t))return!0;return Fy(n2(t),n2(e),{ignoreSelfIntersections:n}).features.length>0}function see(t,e,n){const r=n[0]-t[0],i=n[1]-t[1],s=e[0]-t[0],o=e[1]-t[1];return r*o-i*s!==0?!1:Math.abs(s)>=Math.abs(o)?s>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:o>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1]}function oee(t,e){return t[0]===e[0]&&t[1]===e[1]}function aee(t,e,{ignoreSelfIntersections:n=!0}={}){let r=!1;return P0(t,i=>{P0(e,s=>{if(r===!0)return!0;r=!tee(i.geometry,s.geometry,{ignoreSelfIntersections:n})})}),r}var XI=aee;function lee({geojson:t,spatialFilter:e,uniqueIdProperty:n}){let r=0;const i=new Map;if(!e)return[];for(const s of t.features){const o=n?s.properties[n]:++r;!i.has(o)&&XI(e,s)&&i.set(o,s.properties)}return Array.from(i.values())}var cee={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...cee}};globalThis.mathgl.config;function Aee(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function r2(t,e,n){return Aee(t)?t.map((r,i)=>r2(r,e[i],n)):n*e+(1-n)*t}function vE(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}var ri=Math.PI,QI=ri/4,wE=ri/180,bE=180/ri,R0=512;function i2(t){const[e,n]=t;vE(Number.isFinite(e)),vE(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*wE,i=n*wE,s=R0*(r+ri)/(2*ri),o=R0*(ri+Math.log(Math.tan(QI+i*.5)))/(2*ri);return[s,o]}function uee(t){const[e,n]=t,r=e/R0*(2*ri)-ri,i=2*(Math.atan(Math.exp(n/R0*(2*ri)-ri))-QI);return[r*bE,i*bE]}var fee={Point:YI,MultiPoint:dee,LineString:qI,MultiLineString:pee,Polygon:ZI,MultiPolygon:gee};function hee(t,e){const[n,r,i,s]=e,o=i2([n,s]),a=i2([i,r]),u=[o,a];if(t.type==="GeometryCollection")throw new Error("Unsupported geometry type GeometryCollection");const h=fee[t.type],p=h(t.coordinates,u);return{...t,coordinates:p}}function YI([t,e],[n,r]){const i=r2(n[0],r[0],t),s=r2(n[1],r[1],e);return uee([i,s])}function Uy(t,e){return t.map(n=>YI(n,e))}function dee(t,e){return Uy(t,e)}function qI(t,e){return Uy(t,e)}function pee(t,e){return t.map(n=>qI(n,e))}function ZI(t,e){return t.map(n=>Uy(n,e))}function gee(t,e){return t.map(n=>ZI(n,e))}function mee(t,e={}){const n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),s=Number(t[3]);if(t.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");const o=[n,r];return Ly([[o,[i,r],[i,s],[n,s],o]],e.properties,{bbox:t,id:e.id})}var _ee=mee;function k0(t,e={}){if(t.bbox!=null&&e.recompute!==!0)return t.bbox;const n=[1/0,1/0,-1/0,-1/0];return WI(t,r=>{n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}function I0(t,e,n={}){const r=zI(t),i=pA(e);for(let s=0;s<i.length-1;s++){let o=!1;if(n.ignoreEndVertices&&(s===0&&(o="start"),s===i.length-2&&(o="end"),s===0&&s+1===i.length-1&&(o="both")),yee(i[s],i[s+1],r,o,typeof n.epsilon>"u"?null:n.epsilon))return!0}return!1}function yee(t,e,n,r,i){const s=n[0],o=n[1],a=t[0],u=t[1],h=e[0],p=e[1],_=n[0]-a,v=n[1]-u,b=h-a,E=p-u,R=_*E-v*b;if(i!==null){if(Math.abs(R)>i)return!1}else if(R!==0)return!1;if(Math.abs(b)===Math.abs(E)&&Math.abs(b)===0)return r?!1:n[0]===t[0]&&n[1]===t[1];if(r){if(r==="start")return Math.abs(b)>=Math.abs(E)?b>0?a<s&&s<=h:h<=s&&s<a:E>0?u<o&&o<=p:p<=o&&o<u;if(r==="end")return Math.abs(b)>=Math.abs(E)?b>0?a<=s&&s<h:h<s&&s<=a:E>0?u<=o&&o<p:p<o&&o<=u;if(r==="both")return Math.abs(b)>=Math.abs(E)?b>0?a<s&&s<h:h<s&&s<a:E>0?u<o&&o<p:p<o&&o<u}else return Math.abs(b)>=Math.abs(E)?b>0?a<=s&&s<=h:h<=s&&s<=a:E>0?u<=o&&o<=p:p<=o&&o<=u;return!1}function vee(t,e){var n=ls(t),r=ls(e),i=n.type,s=r.type;switch(i){case"Point":switch(s){case"MultiPoint":return wee(n,r);case"LineString":return I0(n,r,{ignoreEndVertices:!0});case"Polygon":case"MultiPolygon":return Ur(n,r,{ignoreBoundary:!0});default:throw new Error("feature2 "+s+" geometry not supported")}case"MultiPoint":switch(s){case"MultiPoint":return bee(n,r);case"LineString":return xee(n,r);case"Polygon":case"MultiPolygon":return Tee(n,r);default:throw new Error("feature2 "+s+" geometry not supported")}case"LineString":switch(s){case"LineString":return Eee(n,r);case"Polygon":case"MultiPolygon":return See(n,r);default:throw new Error("feature2 "+s+" geometry not supported")}case"Polygon":switch(s){case"Polygon":case"MultiPolygon":return Cee(n,r);default:throw new Error("feature2 "+s+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function wee(t,e){var n,r=!1;for(n=0;n<e.coordinates.length;n++)if(GI(e.coordinates[n],t.coordinates)){r=!0;break}return r}function bee(t,e){for(var n=0;n<t.coordinates.length;n++){for(var r=!1,i=0;i<e.coordinates.length;i++)GI(t.coordinates[n],e.coordinates[i])&&(r=!0);if(!r)return!1}return!0}function xee(t,e){for(var n=!1,r=0;r<t.coordinates.length;r++){if(!I0(t.coordinates[r],e))return!1;n||(n=I0(t.coordinates[r],e,{ignoreEndVertices:!0}))}return n}function Tee(t,e){for(var n=!0,r=!1,i=0;i<t.coordinates.length;i++){if(r=Ur(t.coordinates[i],e),!r){n=!1;break}r=Ur(t.coordinates[i],e,{ignoreBoundary:!0})}return n&&r}function Eee(t,e){for(var n=0;n<t.coordinates.length;n++)if(!I0(t.coordinates[n],e))return!1;return!0}function See(t,e){var n=k0(e),r=k0(t);if(!KI(n,r))return!1;for(var i=!1,s=0;s<t.coordinates.length;s++){if(!Ur(t.coordinates[s],e))return!1;if(i||(i=Ur(t.coordinates[s],e,{ignoreBoundary:!0})),!i&&s<t.coordinates.length-1){var o=Pee(t.coordinates[s],t.coordinates[s+1]);i=Ur(o,e,{ignoreBoundary:!0})}}return i}function Cee(t,e){var n=k0(t),r=k0(e);if(!KI(r,n))return!1;for(var i=0;i<t.coordinates[0].length;i++)if(!Ur(t.coordinates[0][i],e))return!1;return!0}function KI(t,e){return!(t[0]>e[0]||t[2]<e[2]||t[1]>e[1]||t[3]<e[3])}function GI(t,e){return t[0]===e[0]&&t[1]===e[1]}function Pee(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}var JI=vee,Ree=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,Ug=Math.ceil,Pr=Math.floor,Jn="[BigNumber Error] ",xE=Jn+"Number primitive has more than 15 significant digits: ",Qr=1e14,Je=14,zg=9007199254740991,Vg=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],Cs=1e7,dn=1e9;function eM(t){var e,n,r,i=S.prototype={constructor:S,toString:null,valueOf:null},s=new S(1),o=20,a=4,u=-7,h=21,p=-1e7,_=1e7,v=!1,b=1,E=0,R={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},D="0123456789abcdefghijklmnopqrstuvwxyz",P=!0;function S(I,O){var U,$,q,Z,ee,G,oe,ue,K=this;if(!(K instanceof S))return new S(I,O);if(O==null){if(I&&I._isBigNumber===!0){K.s=I.s,!I.c||I.e>_?K.c=K.e=null:I.e<p?K.c=[K.e=0]:(K.e=I.e,K.c=I.c.slice());return}if((G=typeof I=="number")&&I*0==0){if(K.s=1/I<0?(I=-I,-1):1,I===~~I){for(Z=0,ee=I;ee>=10;ee/=10,Z++);Z>_?K.c=K.e=null:(K.e=Z,K.c=[I]);return}ue=String(I)}else{if(!Ree.test(ue=String(I)))return r(K,ue,G);K.s=ue.charCodeAt(0)==45?(ue=ue.slice(1),-1):1}(Z=ue.indexOf("."))>-1&&(ue=ue.replace(".","")),(ee=ue.search(/e/i))>0?(Z<0&&(Z=ee),Z+=+ue.slice(ee+1),ue=ue.substring(0,ee)):Z<0&&(Z=ue.length)}else{if(Vt(O,2,D.length,"Base"),O==10&&P)return K=new S(I),Y(K,o+K.e+1,a);if(ue=String(I),G=typeof I=="number"){if(I*0!=0)return r(K,ue,G,O);if(K.s=1/I<0?(ue=ue.slice(1),-1):1,S.DEBUG&&ue.replace(/^0\.0*|\./,"").length>15)throw Error(xE+I)}else K.s=ue.charCodeAt(0)===45?(ue=ue.slice(1),-1):1;for(U=D.slice(0,O),Z=ee=0,oe=ue.length;ee<oe;ee++)if(U.indexOf($=ue.charAt(ee))<0){if($=="."){if(ee>Z){Z=oe;continue}}else if(!q&&(ue==ue.toUpperCase()&&(ue=ue.toLowerCase())||ue==ue.toLowerCase()&&(ue=ue.toUpperCase()))){q=!0,ee=-1,Z=0;continue}return r(K,String(I),G,O)}G=!1,ue=n(ue,O,10,K.s),(Z=ue.indexOf("."))>-1?ue=ue.replace(".",""):Z=ue.length}for(ee=0;ue.charCodeAt(ee)===48;ee++);for(oe=ue.length;ue.charCodeAt(--oe)===48;);if(ue=ue.slice(ee,++oe)){if(oe-=ee,G&&S.DEBUG&&oe>15&&(I>zg||I!==Pr(I)))throw Error(xE+K.s*I);if((Z=Z-ee-1)>_)K.c=K.e=null;else if(Z<p)K.c=[K.e=0];else{if(K.e=Z,K.c=[],ee=(Z+1)%Je,Z<0&&(ee+=Je),ee<oe){for(ee&&K.c.push(+ue.slice(0,ee)),oe-=Je;ee<oe;)K.c.push(+ue.slice(ee,ee+=Je));ee=Je-(ue=ue.slice(ee)).length}else ee-=oe;for(;ee--;ue+="0");K.c.push(+ue)}}else K.c=[K.e=0]}S.clone=eM,S.ROUND_UP=0,S.ROUND_DOWN=1,S.ROUND_CEIL=2,S.ROUND_FLOOR=3,S.ROUND_HALF_UP=4,S.ROUND_HALF_DOWN=5,S.ROUND_HALF_EVEN=6,S.ROUND_HALF_CEIL=7,S.ROUND_HALF_FLOOR=8,S.EUCLID=9,S.config=S.set=function(I){var O,U;if(I!=null)if(typeof I=="object"){if(I.hasOwnProperty(O="DECIMAL_PLACES")&&(U=I[O],Vt(U,0,dn,O),o=U),I.hasOwnProperty(O="ROUNDING_MODE")&&(U=I[O],Vt(U,0,8,O),a=U),I.hasOwnProperty(O="EXPONENTIAL_AT")&&(U=I[O],U&&U.pop?(Vt(U[0],-dn,0,O),Vt(U[1],0,dn,O),u=U[0],h=U[1]):(Vt(U,-dn,dn,O),u=-(h=U<0?-U:U))),I.hasOwnProperty(O="RANGE"))if(U=I[O],U&&U.pop)Vt(U[0],-dn,-1,O),Vt(U[1],1,dn,O),p=U[0],_=U[1];else if(Vt(U,-dn,dn,O),U)p=-(_=U<0?-U:U);else throw Error(Jn+O+" cannot be zero: "+U);if(I.hasOwnProperty(O="CRYPTO"))if(U=I[O],U===!!U)if(U)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))v=U;else throw v=!U,Error(Jn+"crypto unavailable");else v=U;else throw Error(Jn+O+" not true or false: "+U);if(I.hasOwnProperty(O="MODULO_MODE")&&(U=I[O],Vt(U,0,9,O),b=U),I.hasOwnProperty(O="POW_PRECISION")&&(U=I[O],Vt(U,0,dn,O),E=U),I.hasOwnProperty(O="FORMAT"))if(U=I[O],typeof U=="object")R=U;else throw Error(Jn+O+" not an object: "+U);if(I.hasOwnProperty(O="ALPHABET"))if(U=I[O],typeof U=="string"&&!/^.?$|[+\-.\s]|(.).*\1/.test(U))P=U.slice(0,10)=="0123456789",D=U;else throw Error(Jn+O+" invalid: "+U)}else throw Error(Jn+"Object expected: "+I);return{DECIMAL_PLACES:o,ROUNDING_MODE:a,EXPONENTIAL_AT:[u,h],RANGE:[p,_],CRYPTO:v,MODULO_MODE:b,POW_PRECISION:E,FORMAT:R,ALPHABET:D}},S.isBigNumber=function(I){if(!I||I._isBigNumber!==!0)return!1;if(!S.DEBUG)return!0;var O,U,$=I.c,q=I.e,Z=I.s;e:if({}.toString.call($)=="[object Array]"){if((Z===1||Z===-1)&&q>=-dn&&q<=dn&&q===Pr(q)){if($[0]===0){if(q===0&&$.length===1)return!0;break e}if(O=(q+1)%Je,O<1&&(O+=Je),String($[0]).length==O){for(O=0;O<$.length;O++)if(U=$[O],U<0||U>=Qr||U!==Pr(U))break e;if(U!==0)return!0}}}else if($===null&&q===null&&(Z===null||Z===1||Z===-1))return!0;throw Error(Jn+"Invalid BigNumber: "+I)},S.maximum=S.max=function(){return M(arguments,-1)},S.minimum=S.min=function(){return M(arguments,1)},S.random=function(){var I=9007199254740992,O=Math.random()*I&2097151?function(){return Pr(Math.random()*I)}:function(){return(Math.random()*1073741824|0)*8388608+(Math.random()*8388608|0)};return function(U){var $,q,Z,ee,G,oe=0,ue=[],K=new S(s);if(U==null?U=o:Vt(U,0,dn),ee=Ug(U/Je),v)if(crypto.getRandomValues){for($=crypto.getRandomValues(new Uint32Array(ee*=2));oe<ee;)G=$[oe]*131072+($[oe+1]>>>11),G>=9e15?(q=crypto.getRandomValues(new Uint32Array(2)),$[oe]=q[0],$[oe+1]=q[1]):(ue.push(G%1e14),oe+=2);oe=ee/2}else if(crypto.randomBytes){for($=crypto.randomBytes(ee*=7);oe<ee;)G=($[oe]&31)*281474976710656+$[oe+1]*1099511627776+$[oe+2]*4294967296+$[oe+3]*16777216+($[oe+4]<<16)+($[oe+5]<<8)+$[oe+6],G>=9e15?crypto.randomBytes(7).copy($,oe):(ue.push(G%1e14),oe+=7);oe=ee/7}else throw v=!1,Error(Jn+"crypto unavailable");if(!v)for(;oe<ee;)G=O(),G<9e15&&(ue[oe++]=G%1e14);for(ee=ue[--oe],U%=Je,ee&&U&&(G=Vg[Je-U],ue[oe]=Pr(ee/G)*G);ue[oe]===0;ue.pop(),oe--);if(oe<0)ue=[Z=0];else{for(Z=-1;ue[0]===0;ue.splice(0,1),Z-=Je);for(oe=1,G=ue[0];G>=10;G/=10,oe++);oe<Je&&(Z-=Je-oe)}return K.e=Z,K.c=ue,K}}(),S.sum=function(){for(var I=1,O=arguments,U=new S(O[0]);I<O.length;)U=U.plus(O[I++]);return U},n=function(){var I="0123456789";function O(U,$,q,Z){for(var ee,G=[0],oe,ue=0,K=U.length;ue<K;){for(oe=G.length;oe--;G[oe]*=$);for(G[0]+=Z.indexOf(U.charAt(ue++)),ee=0;ee<G.length;ee++)G[ee]>q-1&&(G[ee+1]==null&&(G[ee+1]=0),G[ee+1]+=G[ee]/q|0,G[ee]%=q)}return G.reverse()}return function(U,$,q,Z,ee){var G,oe,ue,K,de,be,Re,ze,_t=U.indexOf("."),wt=o,it=a;for(_t>=0&&(K=E,E=0,U=U.replace(".",""),ze=new S($),be=ze.pow(U.length-_t),E=K,ze.c=O(Vi(Cr(be.c),be.e,"0"),10,q,I),ze.e=ze.c.length),Re=O(U,$,q,ee?(G=D,I):(G=I,D)),ue=K=Re.length;Re[--K]==0;Re.pop());if(!Re[0])return G.charAt(0);if(_t<0?--ue:(be.c=Re,be.e=ue,be.s=Z,be=e(be,ze,wt,it,q),Re=be.c,de=be.r,ue=be.e),oe=ue+wt+1,_t=Re[oe],K=q/2,de=de||oe<0||Re[oe+1]!=null,de=it<4?(_t!=null||de)&&(it==0||it==(be.s<0?3:2)):_t>K||_t==K&&(it==4||de||it==6&&Re[oe-1]&1||it==(be.s<0?8:7)),oe<1||!Re[0])U=de?Vi(G.charAt(1),-wt,G.charAt(0)):G.charAt(0);else{if(Re.length=oe,de)for(--q;++Re[--oe]>q;)Re[oe]=0,oe||(++ue,Re=[1].concat(Re));for(K=Re.length;!Re[--K];);for(_t=0,U="";_t<=K;U+=G.charAt(Re[_t++]));U=Vi(U,ue,G.charAt(0))}return U}}(),e=function(){function I($,q,Z){var ee,G,oe,ue,K=0,de=$.length,be=q%Cs,Re=q/Cs|0;for($=$.slice();de--;)oe=$[de]%Cs,ue=$[de]/Cs|0,ee=Re*oe+ue*be,G=be*oe+ee%Cs*Cs+K,K=(G/Z|0)+(ee/Cs|0)+Re*ue,$[de]=G%Z;return K&&($=[K].concat($)),$}function O($,q,Z,ee){var G,oe;if(Z!=ee)oe=Z>ee?1:-1;else for(G=oe=0;G<Z;G++)if($[G]!=q[G]){oe=$[G]>q[G]?1:-1;break}return oe}function U($,q,Z,ee){for(var G=0;Z--;)$[Z]-=G,G=$[Z]<q[Z]?1:0,$[Z]=G*ee+$[Z]-q[Z];for(;!$[0]&&$.length>1;$.splice(0,1));}return function($,q,Z,ee,G){var oe,ue,K,de,be,Re,ze,_t,wt,it,st,zt,ma,tc,nc,br,po,Zn=$.s==q.s?1:-1,mn=$.c,Bt=q.c;if(!mn||!mn[0]||!Bt||!Bt[0])return new S(!$.s||!q.s||(mn?Bt&&mn[0]==Bt[0]:!Bt)?NaN:mn&&mn[0]==0||!Bt?Zn*0:Zn/0);for(_t=new S(Zn),wt=_t.c=[],ue=$.e-q.e,Zn=Z+ue+1,G||(G=Qr,ue=Rr($.e/Je)-Rr(q.e/Je),Zn=Zn/Je|0),K=0;Bt[K]==(mn[K]||0);K++);if(Bt[K]>(mn[K]||0)&&ue--,Zn<0)wt.push(1),de=!0;else{for(tc=mn.length,br=Bt.length,K=0,Zn+=2,be=Pr(G/(Bt[0]+1)),be>1&&(Bt=I(Bt,be,G),mn=I(mn,be,G),br=Bt.length,tc=mn.length),ma=br,it=mn.slice(0,br),st=it.length;st<br;it[st++]=0);po=Bt.slice(),po=[0].concat(po),nc=Bt[0],Bt[1]>=G/2&&nc++;do{if(be=0,oe=O(Bt,it,br,st),oe<0){if(zt=it[0],br!=st&&(zt=zt*G+(it[1]||0)),be=Pr(zt/nc),be>1)for(be>=G&&(be=G-1),Re=I(Bt,be,G),ze=Re.length,st=it.length;O(Re,it,ze,st)==1;)be--,U(Re,br<ze?po:Bt,ze,G),ze=Re.length,oe=1;else be==0&&(oe=be=1),Re=Bt.slice(),ze=Re.length;if(ze<st&&(Re=[0].concat(Re)),U(it,Re,st,G),st=it.length,oe==-1)for(;O(Bt,it,br,st)<1;)be++,U(it,br<st?po:Bt,st,G),st=it.length}else oe===0&&(be++,it=[0]);wt[K++]=be,it[0]?it[st++]=mn[ma]||0:(it=[mn[ma]],st=1)}while((ma++<tc||it[0]!=null)&&Zn--);de=it[0]!=null,wt[0]||wt.splice(0,1)}if(G==Qr){for(K=1,Zn=wt[0];Zn>=10;Zn/=10,K++);Y(_t,Z+(_t.e=K+ue*Je-1)+1,ee,de)}else _t.e=ue,_t.r=+de;return _t}}();function k(I,O,U,$){var q,Z,ee,G,oe;if(U==null?U=a:Vt(U,0,8),!I.c)return I.toString();if(q=I.c[0],ee=I.e,O==null)oe=Cr(I.c),oe=$==1||$==2&&(ee<=u||ee>=h)?zf(oe,ee):Vi(oe,ee,"0");else if(I=Y(new S(I),O,U),Z=I.e,oe=Cr(I.c),G=oe.length,$==1||$==2&&(O<=Z||Z<=u)){for(;G<O;oe+="0",G++);oe=zf(oe,Z)}else if(O-=ee,oe=Vi(oe,Z,"0"),Z+1>G){if(--O>0)for(oe+=".";O--;oe+="0");}else if(O+=Z-G,O>0)for(Z+1==G&&(oe+=".");O--;oe+="0");return I.s<0&&q?"-"+oe:oe}function M(I,O){for(var U,$,q=1,Z=new S(I[0]);q<I.length;q++)$=new S(I[q]),(!$.s||(U=So(Z,$))===O||U===0&&Z.s===O)&&(Z=$);return Z}function V(I,O,U){for(var $=1,q=O.length;!O[--q];O.pop());for(q=O[0];q>=10;q/=10,$++);return(U=$+U*Je-1)>_?I.c=I.e=null:U<p?I.c=[I.e=0]:(I.e=U,I.c=O),I}r=function(){var I=/^(-?)0([xbo])(?=\w[\w.]*$)/i,O=/^([^.]+)\.$/,U=/^\.([^.]+)$/,$=/^-?(Infinity|NaN)$/,q=/^\s*\+(?=[\w.])|^\s+|\s+$/g;return function(Z,ee,G,oe){var ue,K=G?ee:ee.replace(q,"");if($.test(K))Z.s=isNaN(K)?null:K<0?-1:1;else{if(!G&&(K=K.replace(I,function(de,be,Re){return ue=(Re=Re.toLowerCase())=="x"?16:Re=="b"?2:8,!oe||oe==ue?be:de}),oe&&(ue=oe,K=K.replace(O,"$1").replace(U,"0.$1")),ee!=K))return new S(K,ue);if(S.DEBUG)throw Error(Jn+"Not a"+(oe?" base "+oe:"")+" number: "+ee);Z.s=null}Z.c=Z.e=null}}();function Y(I,O,U,$){var q,Z,ee,G,oe,ue,K,de=I.c,be=Vg;if(de){e:{for(q=1,G=de[0];G>=10;G/=10,q++);if(Z=O-q,Z<0)Z+=Je,ee=O,oe=de[ue=0],K=Pr(oe/be[q-ee-1]%10);else if(ue=Ug((Z+1)/Je),ue>=de.length)if($){for(;de.length<=ue;de.push(0));oe=K=0,q=1,Z%=Je,ee=Z-Je+1}else break e;else{for(oe=G=de[ue],q=1;G>=10;G/=10,q++);Z%=Je,ee=Z-Je+q,K=ee<0?0:Pr(oe/be[q-ee-1]%10)}if($=$||O<0||de[ue+1]!=null||(ee<0?oe:oe%be[q-ee-1]),$=U<4?(K||$)&&(U==0||U==(I.s<0?3:2)):K>5||K==5&&(U==4||$||U==6&&(Z>0?ee>0?oe/be[q-ee]:0:de[ue-1])%10&1||U==(I.s<0?8:7)),O<1||!de[0])return de.length=0,$?(O-=I.e+1,de[0]=be[(Je-O%Je)%Je],I.e=-O||0):de[0]=I.e=0,I;if(Z==0?(de.length=ue,G=1,ue--):(de.length=ue+1,G=be[Je-Z],de[ue]=ee>0?Pr(oe/be[q-ee]%be[ee])*G:0),$)for(;;)if(ue==0){for(Z=1,ee=de[0];ee>=10;ee/=10,Z++);for(ee=de[0]+=G,G=1;ee>=10;ee/=10,G++);Z!=G&&(I.e++,de[0]==Qr&&(de[0]=1));break}else{if(de[ue]+=G,de[ue]!=Qr)break;de[ue--]=0,G=1}for(Z=de.length;de[--Z]===0;de.pop());}I.e>_?I.c=I.e=null:I.e<p&&(I.c=[I.e=0])}return I}function le(I){var O,U=I.e;return U===null?I.toString():(O=Cr(I.c),O=U<=u||U>=h?zf(O,U):Vi(O,U,"0"),I.s<0?"-"+O:O)}return i.absoluteValue=i.abs=function(){var I=new S(this);return I.s<0&&(I.s=1),I},i.comparedTo=function(I,O){return So(this,new S(I,O))},i.decimalPlaces=i.dp=function(I,O){var U,$,q,Z=this;if(I!=null)return Vt(I,0,dn),O==null?O=a:Vt(O,0,8),Y(new S(Z),I+Z.e+1,O);if(!(U=Z.c))return null;if($=((q=U.length-1)-Rr(this.e/Je))*Je,q=U[q])for(;q%10==0;q/=10,$--);return $<0&&($=0),$},i.dividedBy=i.div=function(I,O){return e(this,new S(I,O),o,a)},i.dividedToIntegerBy=i.idiv=function(I,O){return e(this,new S(I,O),0,1)},i.exponentiatedBy=i.pow=function(I,O){var U,$,q,Z,ee,G,oe,ue,K,de=this;if(I=new S(I),I.c&&!I.isInteger())throw Error(Jn+"Exponent not an integer: "+le(I));if(O!=null&&(O=new S(O)),G=I.e>14,!de.c||!de.c[0]||de.c[0]==1&&!de.e&&de.c.length==1||!I.c||!I.c[0])return K=new S(Math.pow(+le(de),G?I.s*(2-Uf(I)):+le(I))),O?K.mod(O):K;if(oe=I.s<0,O){if(O.c?!O.c[0]:!O.s)return new S(NaN);$=!oe&&de.isInteger()&&O.isInteger(),$&&(de=de.mod(O))}else{if(I.e>9&&(de.e>0||de.e<-1||(de.e==0?de.c[0]>1||G&&de.c[1]>=24e7:de.c[0]<8e13||G&&de.c[0]<=9999975e7)))return Z=de.s<0&&Uf(I)?-0:0,de.e>-1&&(Z=1/Z),new S(oe?1/Z:Z);E&&(Z=Ug(E/Je+2))}for(G?(U=new S(.5),oe&&(I.s=1),ue=Uf(I)):(q=Math.abs(+le(I)),ue=q%2),K=new S(s);;){if(ue){if(K=K.times(de),!K.c)break;Z?K.c.length>Z&&(K.c.length=Z):$&&(K=K.mod(O))}if(q){if(q=Pr(q/2),q===0)break;ue=q%2}else if(I=I.times(U),Y(I,I.e+1,1),I.e>14)ue=Uf(I);else{if(q=+le(I),q===0)break;ue=q%2}de=de.times(de),Z?de.c&&de.c.length>Z&&(de.c.length=Z):$&&(de=de.mod(O))}return $?K:(oe&&(K=s.div(K)),O?K.mod(O):Z?Y(K,E,a,ee):K)},i.integerValue=function(I){var O=new S(this);return I==null?I=a:Vt(I,0,8),Y(O,O.e+1,I)},i.isEqualTo=i.eq=function(I,O){return So(this,new S(I,O))===0},i.isFinite=function(){return!!this.c},i.isGreaterThan=i.gt=function(I,O){return So(this,new S(I,O))>0},i.isGreaterThanOrEqualTo=i.gte=function(I,O){return(O=So(this,new S(I,O)))===1||O===0},i.isInteger=function(){return!!this.c&&Rr(this.e/Je)>this.c.length-2},i.isLessThan=i.lt=function(I,O){return So(this,new S(I,O))<0},i.isLessThanOrEqualTo=i.lte=function(I,O){return(O=So(this,new S(I,O)))===-1||O===0},i.isNaN=function(){return!this.s},i.isNegative=function(){return this.s<0},i.isPositive=function(){return this.s>0},i.isZero=function(){return!!this.c&&this.c[0]==0},i.minus=function(I,O){var U,$,q,Z,ee=this,G=ee.s;if(I=new S(I,O),O=I.s,!G||!O)return new S(NaN);if(G!=O)return I.s=-O,ee.plus(I);var oe=ee.e/Je,ue=I.e/Je,K=ee.c,de=I.c;if(!oe||!ue){if(!K||!de)return K?(I.s=-O,I):new S(de?ee:NaN);if(!K[0]||!de[0])return de[0]?(I.s=-O,I):new S(K[0]?ee:a==3?-0:0)}if(oe=Rr(oe),ue=Rr(ue),K=K.slice(),G=oe-ue){for((Z=G<0)?(G=-G,q=K):(ue=oe,q=de),q.reverse(),O=G;O--;q.push(0));q.reverse()}else for($=(Z=(G=K.length)<(O=de.length))?G:O,G=O=0;O<$;O++)if(K[O]!=de[O]){Z=K[O]<de[O];break}if(Z&&(q=K,K=de,de=q,I.s=-I.s),O=($=de.length)-(U=K.length),O>0)for(;O--;K[U++]=0);for(O=Qr-1;$>G;){if(K[--$]<de[$]){for(U=$;U&&!K[--U];K[U]=O);--K[U],K[$]+=Qr}K[$]-=de[$]}for(;K[0]==0;K.splice(0,1),--ue);return K[0]?V(I,K,ue):(I.s=a==3?-1:1,I.c=[I.e=0],I)},i.modulo=i.mod=function(I,O){var U,$,q=this;return I=new S(I,O),!q.c||!I.s||I.c&&!I.c[0]?new S(NaN):!I.c||q.c&&!q.c[0]?new S(q):(b==9?($=I.s,I.s=1,U=e(q,I,0,3),I.s=$,U.s*=$):U=e(q,I,0,b),I=q.minus(U.times(I)),!I.c[0]&&b==1&&(I.s=q.s),I)},i.multipliedBy=i.times=function(I,O){var U,$,q,Z,ee,G,oe,ue,K,de,be,Re,ze,_t,wt,it=this,st=it.c,zt=(I=new S(I,O)).c;if(!st||!zt||!st[0]||!zt[0])return!it.s||!I.s||st&&!st[0]&&!zt||zt&&!zt[0]&&!st?I.c=I.e=I.s=null:(I.s*=it.s,!st||!zt?I.c=I.e=null:(I.c=[0],I.e=0)),I;for($=Rr(it.e/Je)+Rr(I.e/Je),I.s*=it.s,oe=st.length,de=zt.length,oe<de&&(ze=st,st=zt,zt=ze,q=oe,oe=de,de=q),q=oe+de,ze=[];q--;ze.push(0));for(_t=Qr,wt=Cs,q=de;--q>=0;){for(U=0,be=zt[q]%wt,Re=zt[q]/wt|0,ee=oe,Z=q+ee;Z>q;)ue=st[--ee]%wt,K=st[ee]/wt|0,G=Re*ue+K*be,ue=be*ue+G%wt*wt+ze[Z]+U,U=(ue/_t|0)+(G/wt|0)+Re*K,ze[Z--]=ue%_t;ze[Z]=U}return U?++$:ze.splice(0,1),V(I,ze,$)},i.negated=function(){var I=new S(this);return I.s=-I.s||null,I},i.plus=function(I,O){var U,$=this,q=$.s;if(I=new S(I,O),O=I.s,!q||!O)return new S(NaN);if(q!=O)return I.s=-O,$.minus(I);var Z=$.e/Je,ee=I.e/Je,G=$.c,oe=I.c;if(!Z||!ee){if(!G||!oe)return new S(q/0);if(!G[0]||!oe[0])return oe[0]?I:new S(G[0]?$:q*0)}if(Z=Rr(Z),ee=Rr(ee),G=G.slice(),q=Z-ee){for(q>0?(ee=Z,U=oe):(q=-q,U=G),U.reverse();q--;U.push(0));U.reverse()}for(q=G.length,O=oe.length,q-O<0&&(U=oe,oe=G,G=U,O=q),q=0;O;)q=(G[--O]=G[O]+oe[O]+q)/Qr|0,G[O]=Qr===G[O]?0:G[O]%Qr;return q&&(G=[q].concat(G),++ee),V(I,G,ee)},i.precision=i.sd=function(I,O){var U,$,q,Z=this;if(I!=null&&I!==!!I)return Vt(I,1,dn),O==null?O=a:Vt(O,0,8),Y(new S(Z),I,O);if(!(U=Z.c))return null;if(q=U.length-1,$=q*Je+1,q=U[q]){for(;q%10==0;q/=10,$--);for(q=U[0];q>=10;q/=10,$++);}return I&&Z.e+1>$&&($=Z.e+1),$},i.shiftedBy=function(I){return Vt(I,-zg,zg),this.times("1e"+I)},i.squareRoot=i.sqrt=function(){var I,O,U,$,q,Z=this,ee=Z.c,G=Z.s,oe=Z.e,ue=o+4,K=new S("0.5");if(G!==1||!ee||!ee[0])return new S(!G||G<0&&(!ee||ee[0])?NaN:ee?Z:1/0);if(G=Math.sqrt(+le(Z)),G==0||G==1/0?(O=Cr(ee),(O.length+oe)%2==0&&(O+="0"),G=Math.sqrt(+O),oe=Rr((oe+1)/2)-(oe<0||oe%2),G==1/0?O="5e"+oe:(O=G.toExponential(),O=O.slice(0,O.indexOf("e")+1)+oe),U=new S(O)):U=new S(G+""),U.c[0]){for(oe=U.e,G=oe+ue,G<3&&(G=0);;)if(q=U,U=K.times(q.plus(e(Z,q,ue,1))),Cr(q.c).slice(0,G)===(O=Cr(U.c)).slice(0,G))if(U.e<oe&&--G,O=O.slice(G-3,G+1),O=="9999"||!$&&O=="4999"){if(!$&&(Y(q,q.e+o+2,0),q.times(q).eq(Z))){U=q;break}ue+=4,G+=4,$=1}else{(!+O||!+O.slice(1)&&O.charAt(0)=="5")&&(Y(U,U.e+o+2,1),I=!U.times(U).eq(Z));break}}return Y(U,U.e+o+1,a,I)},i.toExponential=function(I,O){return I!=null&&(Vt(I,0,dn),I++),k(this,I,O,1)},i.toFixed=function(I,O){return I!=null&&(Vt(I,0,dn),I=I+this.e+1),k(this,I,O)},i.toFormat=function(I,O,U){var $,q=this;if(U==null)I!=null&&O&&typeof O=="object"?(U=O,O=null):I&&typeof I=="object"?(U=I,I=O=null):U=R;else if(typeof U!="object")throw Error(Jn+"Argument not an object: "+U);if($=q.toFixed(I,O),q.c){var Z,ee=$.split("."),G=+U.groupSize,oe=+U.secondaryGroupSize,ue=U.groupSeparator||"",K=ee[0],de=ee[1],be=q.s<0,Re=be?K.slice(1):K,ze=Re.length;if(oe&&(Z=G,G=oe,oe=Z,ze-=Z),G>0&&ze>0){for(Z=ze%G||G,K=Re.substr(0,Z);Z<ze;Z+=G)K+=ue+Re.substr(Z,G);oe>0&&(K+=ue+Re.slice(Z)),be&&(K="-"+K)}$=de?K+(U.decimalSeparator||"")+((oe=+U.fractionGroupSize)?de.replace(new RegExp("\\d{"+oe+"}\\B","g"),"$&"+(U.fractionGroupSeparator||"")):de):K}return(U.prefix||"")+$+(U.suffix||"")},i.toFraction=function(I){var O,U,$,q,Z,ee,G,oe,ue,K,de,be,Re=this,ze=Re.c;if(I!=null&&(G=new S(I),!G.isInteger()&&(G.c||G.s!==1)||G.lt(s)))throw Error(Jn+"Argument "+(G.isInteger()?"out of range: ":"not an integer: ")+le(G));if(!ze)return new S(Re);for(O=new S(s),ue=U=new S(s),$=oe=new S(s),be=Cr(ze),Z=O.e=be.length-Re.e-1,O.c[0]=Vg[(ee=Z%Je)<0?Je+ee:ee],I=!I||G.comparedTo(O)>0?Z>0?O:ue:G,ee=_,_=1/0,G=new S(be),oe.c[0]=0;K=e(G,O,0,1),q=U.plus(K.times($)),q.comparedTo(I)!=1;)U=$,$=q,ue=oe.plus(K.times(q=ue)),oe=q,O=G.minus(K.times(q=O)),G=q;return q=e(I.minus(U),$,0,1),oe=oe.plus(q.times(ue)),U=U.plus(q.times($)),oe.s=ue.s=Re.s,Z=Z*2,de=e(ue,$,Z,a).minus(Re).abs().comparedTo(e(oe,U,Z,a).minus(Re).abs())<1?[ue,$]:[oe,U],_=ee,de},i.toNumber=function(){return+le(this)},i.toPrecision=function(I,O){return I!=null&&Vt(I,1,dn),k(this,I,O,2)},i.toString=function(I){var O,U=this,$=U.s,q=U.e;return q===null?$?(O="Infinity",$<0&&(O="-"+O)):O="NaN":(I==null?O=q<=u||q>=h?zf(Cr(U.c),q):Vi(Cr(U.c),q,"0"):I===10&&P?(U=Y(new S(U),o+q+1,a),O=Vi(Cr(U.c),U.e,"0")):(Vt(I,2,D.length,"Base"),O=n(Vi(Cr(U.c),q,"0"),10,I,$,!0)),$<0&&U.c[0]&&(O="-"+O)),O},i.valueOf=i.toJSON=function(){return le(this)},i._isBigNumber=!0,i[Symbol.toStringTag]="BigNumber",i[Symbol.for("nodejs.util.inspect.custom")]=i.valueOf,t!=null&&S.set(t),S}function Rr(t){var e=t|0;return t>0||t===e?e:e-1}function Cr(t){for(var e,n,r=1,i=t.length,s=t[0]+"";r<i;){for(e=t[r++]+"",n=Je-e.length;n--;e="0"+e);s+=e}for(i=s.length;s.charCodeAt(--i)===48;);return s.slice(0,i+1||1)}function So(t,e){var n,r,i=t.c,s=e.c,o=t.s,a=e.s,u=t.e,h=e.e;if(!o||!a)return null;if(n=i&&!i[0],r=s&&!s[0],n||r)return n?r?0:-a:o;if(o!=a)return o;if(n=o<0,r=u==h,!i||!s)return r?0:!i^n?1:-1;if(!r)return u>h^n?1:-1;for(a=(u=i.length)<(h=s.length)?u:h,o=0;o<a;o++)if(i[o]!=s[o])return i[o]>s[o]^n?1:-1;return u==h?0:u>h^n?1:-1}function Vt(t,e,n,r){if(t<e||t>n||t!==Pr(t))throw Error(Jn+(r||"Argument")+(typeof t=="number"?t<e||t>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function Uf(t){var e=t.c.length-1;return Rr(t.e/Je)==e&&t.c[e]%2!=0}function zf(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function Vi(t,e,n){var r,i;if(e<0){for(i=n+".";++e;i+=n);t=i+t}else if(r=t.length,++e>r){for(i=n,e-=r;--e;i+=n);t+=i}else e<r&&(t=t.slice(0,e)+"."+t.slice(e));return t}var kee=eM(),Ri=kee,Iee=class{constructor(t){Me(this,"key"),Me(this,"left",null),Me(this,"right",null),this.key=t}},Cc=class extends Iee{constructor(t){super(t)}},Mee=class{constructor(){Me(this,"size",0),Me(this,"modificationCount",0),Me(this,"splayCount",0)}splay(t){const e=this.root;if(e==null)return this.compare(t,t),-1;let n=null,r=null,i=null,s=null,o=e;const a=this.compare;let u;for(;;)if(u=a(o.key,t),u>0){let h=o.left;if(h==null||(u=a(h.key,t),u>0&&(o.left=h.right,h.right=o,o=h,h=o.left,h==null)))break;n==null?r=o:n.left=o,n=o,o=h}else if(u<0){let h=o.right;if(h==null||(u=a(h.key,t),u<0&&(o.right=h.left,h.left=o,o=h,h=o.right,h==null)))break;i==null?s=o:i.right=o,i=o,o=h}else break;return i!=null&&(i.right=o.left,o.left=s),n!=null&&(n.left=o.right,o.right=r),this.root!==o&&(this.root=o,this.splayCount++),u}splayMin(t){let e=t,n=e.left;for(;n!=null;){const r=n;e.left=r.right,r.right=e,e=r,n=e.left}return e}splayMax(t){let e=t,n=e.right;for(;n!=null;){const r=n;e.right=r.left,r.left=e,e=r,n=e.right}return e}_delete(t){if(this.root==null||this.splay(t)!=0)return null;let n=this.root;const r=n,i=n.left;if(this.size--,i==null)this.root=n.right;else{const s=n.right;n=this.splayMax(i),n.right=s,this.root=n}return this.modificationCount++,r}addNewRoot(t,e){this.size++,this.modificationCount++;const n=this.root;if(n==null){this.root=t;return}e<0?(t.left=n,t.right=n.right,n.right=null):(t.right=n,t.left=n.left,n.left=null),this.root=t}_first(){const t=this.root;return t==null?null:(this.root=this.splayMin(t),this.root)}_last(){const t=this.root;return t==null?null:(this.root=this.splayMax(t),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(t){return this.validKey(t)&&this.splay(t)==0}defaultCompare(){return(t,e)=>t<e?-1:t>e?1:0}wrap(){return{getRoot:()=>this.root,setRoot:t=>{this.root=t},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:t=>{this.splayCount=t},splay:t=>this.splay(t),has:t=>this.has(t)}}},TE,EE,M0=class zc extends Mee{constructor(e,n){super(),Me(this,"root",null),Me(this,"compare"),Me(this,"validKey"),Me(this,TE,"[object Set]"),this.compare=e??this.defaultCompare(),this.validKey=n??(r=>r!=null&&r!=null)}delete(e){return this.validKey(e)?this._delete(e)!=null:!1}deleteAll(e){for(const n of e)this.delete(n)}forEach(e){const n=this[Symbol.iterator]();let r;for(;r=n.next(),!r.done;)e(r.value,r.value,this)}add(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new Cc(e),n),this}addAndReturn(e){const n=this.splay(e);return n!=0&&this.addNewRoot(new Cc(e),n),this.root.key}addAll(e){for(const n of e)this.add(n)}isEmpty(){return this.root==null}isNotEmpty(){return this.root!=null}single(){if(this.size==0)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(this.size==0)throw"Bad state: No element";return this._first().key}last(){if(this.size==0)throw"Bad state: No element";return this._last().key}lastBefore(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)<0)return this.root.key;let r=this.root.left;if(r==null)return null;let i=r.right;for(;i!=null;)r=i,i=r.right;return r.key}firstAfter(e){if(e==null)throw"Invalid arguments(s)";if(this.root==null)return null;if(this.splay(e)>0)return this.root.key;let r=this.root.right;if(r==null)return null;let i=r.left;for(;i!=null;)r=i,i=r.left;return r.key}retainAll(e){const n=new zc(this.compare,this.validKey),r=this.modificationCount;for(const i of e){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(i)&&this.splay(i)==0&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(e){return!this.validKey(e)||this.splay(e)!=0?null:this.root.key}intersection(e){const n=new zc(this.compare,this.validKey);for(const r of this)e.has(r)&&n.add(r);return n}difference(e){const n=new zc(this.compare,this.validKey);for(const r of this)e.has(r)||n.add(r);return n}union(e){const n=this.clone();return n.addAll(e),n}clone(){const e=new zc(this.compare,this.validKey);return e.size=this.size,e.root=this.copyNode(this.root),e}copyNode(e){if(e==null)return null;function n(i,s){let o,a;do{if(o=i.left,a=i.right,o!=null){const u=new Cc(o.key);s.left=u,n(o,u)}if(a!=null){const u=new Cc(a.key);s.right=u,i=a,s=u}}while(a!=null)}const r=new Cc(e.key);return n(e,r),r}toSet(){return this.clone()}entries(){return new Nee(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[(EE=Symbol.iterator,TE=Symbol.toStringTag,EE)](){return new Oee(this.wrap())}},tM=class{constructor(t){Me(this,"tree"),Me(this,"path",new Array),Me(this,"modificationCount",null),Me(this,"splayCount"),this.tree=t,this.splayCount=t.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const t=this.path[this.path.length-1];return this.getValue(t)}rebuildPath(t){this.path.splice(0,this.path.length),this.tree.splay(t),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(t){for(;t!=null;)this.path.push(t),t=t.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(this.modificationCount==null){this.modificationCount=this.tree.getModificationCount();let n=this.tree.getRoot();for(;n!=null;)this.path.push(n),n=n.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let t=this.path[this.path.length-1],e=t.right;if(e!=null){for(;e!=null;)this.path.push(e),e=e.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===t;)t=this.path.pop();return this.path.length>0}},Oee=class extends tM{getValue(t){return t.key}},Nee=class extends tM{getValue(t){return[t.key,t.key]}},nM=t=>()=>t,s2=t=>{const e=t?(n,r)=>r.minus(n).abs().isLessThanOrEqualTo(t):nM(!1);return(n,r)=>e(n,r)?0:n.comparedTo(r)};function Dee(t){const e=t?(n,r,i,s,o)=>n.exponentiatedBy(2).isLessThanOrEqualTo(s.minus(r).exponentiatedBy(2).plus(o.minus(i).exponentiatedBy(2)).times(t)):nM(!1);return(n,r,i)=>{const s=n.x,o=n.y,a=i.x,u=i.y,h=o.minus(u).times(r.x.minus(a)).minus(s.minus(a).times(r.y.minus(u)));return e(h,s,o,a,u)?0:h.comparedTo(0)}}var Bee=t=>t,Lee=t=>{if(t){const e=new M0(s2(t)),n=new M0(s2(t)),r=(s,o)=>o.addAndReturn(s),i=s=>({x:r(s.x,e),y:r(s.y,n)});return i({x:new Ri(0),y:new Ri(0)}),i}return Bee},o2=t=>({set:e=>{cs=o2(e)},reset:()=>o2(t),compare:s2(t),snap:Lee(t),orient:Dee(t)}),cs=o2(),Pc=(t,e)=>t.ll.x.isLessThanOrEqualTo(e.x)&&e.x.isLessThanOrEqualTo(t.ur.x)&&t.ll.y.isLessThanOrEqualTo(e.y)&&e.y.isLessThanOrEqualTo(t.ur.y),a2=(t,e)=>{if(e.ur.x.isLessThan(t.ll.x)||t.ur.x.isLessThan(e.ll.x)||e.ur.y.isLessThan(t.ll.y)||t.ur.y.isLessThan(e.ll.y))return null;const n=t.ll.x.isLessThan(e.ll.x)?e.ll.x:t.ll.x,r=t.ur.x.isLessThan(e.ur.x)?t.ur.x:e.ur.x,i=t.ll.y.isLessThan(e.ll.y)?e.ll.y:t.ll.y,s=t.ur.y.isLessThan(e.ur.y)?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:s}}},bh=(t,e)=>t.x.times(e.y).minus(t.y.times(e.x)),rM=(t,e)=>t.x.times(e.x).plus(t.y.times(e.y)),O0=t=>rM(t,t).sqrt(),Fee=(t,e,n)=>{const r={x:e.x.minus(t.x),y:e.y.minus(t.y)},i={x:n.x.minus(t.x),y:n.y.minus(t.y)};return bh(i,r).div(O0(i)).div(O0(r))},Uee=(t,e,n)=>{const r={x:e.x.minus(t.x),y:e.y.minus(t.y)},i={x:n.x.minus(t.x),y:n.y.minus(t.y)};return rM(i,r).div(O0(i)).div(O0(r))},SE=(t,e,n)=>e.y.isZero()?null:{x:t.x.plus(e.x.div(e.y).times(n.minus(t.y))),y:n},CE=(t,e,n)=>e.x.isZero()?null:{x:n,y:t.y.plus(e.y.div(e.x).times(n.minus(t.x)))},zee=(t,e,n,r)=>{if(e.x.isZero())return CE(n,r,t.x);if(r.x.isZero())return CE(t,e,n.x);if(e.y.isZero())return SE(n,r,t.y);if(r.y.isZero())return SE(t,e,n.y);const i=bh(e,r);if(i.isZero())return null;const s={x:n.x.minus(t.x),y:n.y.minus(t.y)},o=bh(s,e).div(i),a=bh(s,r).div(i),u=t.x.plus(a.times(e.x)),h=n.x.plus(o.times(r.x)),p=t.y.plus(a.times(e.y)),_=n.y.plus(o.times(r.y)),v=u.plus(h).div(2),b=p.plus(_).div(2);return{x:v,y:b}},bi=class iM{constructor(e,n){Me(this,"point"),Me(this,"isLeft"),Me(this,"segment"),Me(this,"otherSE"),Me(this,"consumedBy"),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}static compare(e,n){const r=iM.comparePoints(e.point,n.point);return r!==0?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:N0.compare(e.segment,n.segment))}static comparePoints(e,n){return e.x.isLessThan(n.x)?-1:e.x.isGreaterThan(n.x)?1:e.y.isLessThan(n.y)?-1:e.y.isGreaterThan(n.y)?1:0}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const n=e.point.events;for(let r=0,i=n.length;r<i;r++){const s=n[r];this.point.events.push(s),s.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let n=0;n<e;n++){const r=this.point.events[n];if(r.segment.consumedBy===void 0)for(let i=n+1;i<e;i++){const s=this.point.events[i];s.consumedBy===void 0&&r.otherSE.point.events===s.otherSE.point.events&&r.segment.consume(s.segment)}}}getAvailableLinkedEvents(){const e=[];for(let n=0,r=this.point.events.length;n<r;n++){const i=this.point.events[n];i!==this&&!i.segment.ringOut&&i.segment.isInResult()&&e.push(i)}return e}getLeftmostComparator(e){const n=new Map,r=i=>{const s=i.otherSE;n.set(i,{sine:Fee(this.point,e.point,s.point),cosine:Uee(this.point,e.point,s.point)})};return(i,s)=>{n.has(i)||r(i),n.has(s)||r(s);const{sine:o,cosine:a}=n.get(i),{sine:u,cosine:h}=n.get(s);return o.isGreaterThanOrEqualTo(0)&&u.isGreaterThanOrEqualTo(0)?a.isLessThan(h)?1:a.isGreaterThan(h)?-1:0:o.isLessThan(0)&&u.isLessThan(0)?a.isLessThan(h)?-1:a.isGreaterThan(h)?1:0:u.isLessThan(o)?-1:u.isGreaterThan(o)?1:0}}},Vee=class l2{constructor(e){Me(this,"events"),Me(this,"poly"),Me(this,"_isExteriorRing"),Me(this,"_enclosingRing"),this.events=e;for(let n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}static factory(e){const n=[];for(let r=0,i=e.length;r<i;r++){const s=e[r];if(!s.isInResult()||s.ringOut)continue;let o=null,a=s.leftSE,u=s.rightSE;const h=[a],p=a.point,_=[];for(;o=a,a=u,h.push(a),a.point!==p;)for(;;){const v=a.getAvailableLinkedEvents();if(v.length===0){const R=h[0].point,D=h[h.length-1].point;throw new Error(`Unable to complete output ring starting at [${R.x}, ${R.y}]. Last matching segment found ends at [${D.x}, ${D.y}].`)}if(v.length===1){u=v[0].otherSE;break}let b=null;for(let R=0,D=_.length;R<D;R++)if(_[R].point===a.point){b=R;break}if(b!==null){const R=_.splice(b)[0],D=h.splice(R.index);D.unshift(D[0].otherSE),n.push(new l2(D.reverse()));continue}_.push({index:h.length,point:a.point});const E=a.getLeftmostComparator(o);u=v.sort(E)[0].otherSE;break}n.push(new l2(h))}return n}getGeom(){let e=this.events[0].point;const n=[e];for(let h=1,p=this.events.length-1;h<p;h++){const _=this.events[h].point,v=this.events[h+1].point;cs.orient(_,e,v)!==0&&(n.push(_),e=_)}if(n.length===1)return null;const r=n[0],i=n[1];cs.orient(r,e,i)===0&&n.shift(),n.push(n[0]);const s=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:n.length-1,a=this.isExteriorRing()?n.length:-1,u=[];for(let h=o;h!=a;h+=s)u.push([n[h].x.toNumber(),n[h].y.toNumber()]);return u}isExteriorRing(){if(this._isExteriorRing===void 0){const e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){var i,s;let e=this.events[0];for(let o=1,a=this.events.length;o<a;o++){const u=this.events[o];bi.compare(e,u)>0&&(e=u)}let n=e.segment.prevInResult(),r=n?n.prevInResult():null;for(;;){if(!n)return null;if(!r)return n.ringOut;if(r.ringOut!==n.ringOut)return((i=r.ringOut)==null?void 0:i.enclosingRing())!==n.ringOut?n.ringOut:(s=n.ringOut)==null?void 0:s.enclosingRing();n=r.prevInResult(),r=n?n.prevInResult():null}}},PE=class{constructor(t){Me(this,"exteriorRing"),Me(this,"interiorRings"),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}addInterior(t){this.interiorRings.push(t),t.poly=this}getGeom(){const t=this.exteriorRing.getGeom();if(t===null)return null;const e=[t];for(let n=0,r=this.interiorRings.length;n<r;n++){const i=this.interiorRings[n].getGeom();i!==null&&e.push(i)}return e}},$ee=class{constructor(t){Me(this,"rings"),Me(this,"polys"),this.rings=t,this.polys=this._composePolys(t)}getGeom(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const r=this.polys[e].getGeom();r!==null&&t.push(r)}return t}_composePolys(t){var n;const e=[];for(let r=0,i=t.length;r<i;r++){const s=t[r];if(!s.poly)if(s.isExteriorRing())e.push(new PE(s));else{const o=s.enclosingRing();o!=null&&o.poly||e.push(new PE(o)),(n=o==null?void 0:o.poly)==null||n.addInterior(s)}}return e}},Wee=class{constructor(t,e=N0.compare){Me(this,"queue"),Me(this,"tree"),Me(this,"segments"),this.queue=t,this.tree=new M0(e),this.segments=[]}process(t){const e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.delete(t.otherSE):this.tree.delete(e),n;t.isLeft&&this.tree.add(e);let r=e,i=e;do r=this.tree.lastBefore(r);while(r!=null&&r.consumedBy!=null);do i=this.tree.firstAfter(i);while(i!=null&&i.consumedBy!=null);if(t.isLeft){let s=null;if(r){const a=r.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(s=a),!r.isAnEndpoint(a))){const u=this._splitSafely(r,a);for(let h=0,p=u.length;h<p;h++)n.push(u[h])}}let o=null;if(i){const a=i.getIntersection(e);if(a!==null&&(e.isAnEndpoint(a)||(o=a),!i.isAnEndpoint(a))){const u=this._splitSafely(i,a);for(let h=0,p=u.length;h<p;h++)n.push(u[h])}}if(s!==null||o!==null){let a=null;s===null?a=o:o===null?a=s:a=bi.comparePoints(s,o)<=0?s:o,this.queue.delete(e.rightSE),n.push(e.rightSE);const u=e.split(a);for(let h=0,p=u.length;h<p;h++)n.push(u[h])}n.length>0?(this.tree.delete(e),n.push(t)):(this.segments.push(e),e.prev=r)}else{if(r&&i){const s=r.getIntersection(i);if(s!==null){if(!r.isAnEndpoint(s)){const o=this._splitSafely(r,s);for(let a=0,u=o.length;a<u;a++)n.push(o[a])}if(!i.isAnEndpoint(s)){const o=this._splitSafely(i,s);for(let a=0,u=o.length;a<u;a++)n.push(o[a])}}}this.tree.delete(e)}return n}_splitSafely(t,e){this.tree.delete(t);const n=t.rightSE;this.queue.delete(n);const r=t.split(e);return r.push(n),t.consumedBy===void 0&&this.tree.add(t),r}},jee=class{constructor(){Me(this,"type"),Me(this,"numMultiPolys")}run(t,e,n){Vc.type=t;const r=[new kE(e,!0)];for(let h=0,p=n.length;h<p;h++)r.push(new kE(n[h],!1));if(Vc.numMultiPolys=r.length,Vc.type==="difference"){const h=r[0];let p=1;for(;p<r.length;)a2(r[p].bbox,h.bbox)!==null?p++:r.splice(p,1)}if(Vc.type==="intersection")for(let h=0,p=r.length;h<p;h++){const _=r[h];for(let v=h+1,b=r.length;v<b;v++)if(a2(_.bbox,r[v].bbox)===null)return[]}const i=new M0(bi.compare);for(let h=0,p=r.length;h<p;h++){const _=r[h].getSweepEvents();for(let v=0,b=_.length;v<b;v++)i.add(_[v])}const s=new Wee(i);let o=null;for(i.size!=0&&(o=i.first(),i.delete(o));o;){const h=s.process(o);for(let p=0,_=h.length;p<_;p++){const v=h[p];v.consumedBy===void 0&&i.add(v)}i.size!=0?(o=i.first(),i.delete(o)):o=null}cs.reset();const a=Vee.factory(s.segments);return new $ee(a).getGeom()}},Vc=new jee,c2=Vc,Hee=0,N0=class xh{constructor(e,n,r,i){Me(this,"id"),Me(this,"leftSE"),Me(this,"rightSE"),Me(this,"rings"),Me(this,"windings"),Me(this,"ringOut"),Me(this,"consumedBy"),Me(this,"prev"),Me(this,"_prevInResult"),Me(this,"_beforeState"),Me(this,"_afterState"),Me(this,"_isInResult"),this.id=++Hee,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}static compare(e,n){const r=e.leftSE.point.x,i=n.leftSE.point.x,s=e.rightSE.point.x,o=n.rightSE.point.x;if(o.isLessThan(r))return 1;if(s.isLessThan(i))return-1;const a=e.leftSE.point.y,u=n.leftSE.point.y,h=e.rightSE.point.y,p=n.rightSE.point.y;if(r.isLessThan(i)){if(u.isLessThan(a)&&u.isLessThan(h))return 1;if(u.isGreaterThan(a)&&u.isGreaterThan(h))return-1;const _=e.comparePoint(n.leftSE.point);if(_<0)return 1;if(_>0)return-1;const v=n.comparePoint(e.rightSE.point);return v!==0?v:-1}if(r.isGreaterThan(i)){if(a.isLessThan(u)&&a.isLessThan(p))return-1;if(a.isGreaterThan(u)&&a.isGreaterThan(p))return 1;const _=n.comparePoint(e.leftSE.point);if(_!==0)return _;const v=e.comparePoint(n.rightSE.point);return v<0?1:v>0?-1:1}if(a.isLessThan(u))return-1;if(a.isGreaterThan(u))return 1;if(s.isLessThan(o)){const _=n.comparePoint(e.rightSE.point);if(_!==0)return _}if(s.isGreaterThan(o)){const _=e.comparePoint(n.rightSE.point);if(_<0)return 1;if(_>0)return-1}if(!s.eq(o)){const _=h.minus(a),v=s.minus(r),b=p.minus(u),E=o.minus(i);if(_.isGreaterThan(v)&&b.isLessThan(E))return 1;if(_.isLessThan(v)&&b.isGreaterThan(E))return-1}return s.isGreaterThan(o)?1:s.isLessThan(o)||h.isLessThan(p)?-1:h.isGreaterThan(p)?1:e.id<n.id?-1:e.id>n.id?1:0}static fromRing(e,n,r){let i,s,o;const a=bi.comparePoints(e,n);if(a<0)i=e,s=n,o=1;else if(a>0)i=n,s=e,o=-1;else throw new Error(`Tried to create degenerate segment at [${e.x}, ${e.y}]`);const u=new bi(i,!0),h=new bi(s,!1);return new xh(u,h,[r],[o])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(n)?e:n},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(n)?e:n}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return cs.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const n=this.bbox(),r=e.bbox(),i=a2(n,r);if(i===null)return null;const s=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,u=e.rightSE.point,h=Pc(n,a)&&this.comparePoint(a)===0,p=Pc(r,s)&&e.comparePoint(s)===0,_=Pc(n,u)&&this.comparePoint(u)===0,v=Pc(r,o)&&e.comparePoint(o)===0;if(p&&h)return v&&!_?o:!v&&_?u:null;if(p)return _&&s.x.eq(u.x)&&s.y.eq(u.y)?null:s;if(h)return v&&o.x.eq(a.x)&&o.y.eq(a.y)?null:a;if(v&&_)return null;if(v)return o;if(_)return u;const b=zee(s,this.vector(),a,e.vector());return b===null||!Pc(i,b)?null:cs.snap(b)}split(e){const n=[],r=e.events!==void 0,i=new bi(e,!0),s=new bi(e,!1),o=this.rightSE;this.replaceRightSE(s),n.push(s),n.push(i);const a=new xh(i,o,this.rings.slice(),this.windings.slice());return bi.comparePoints(a.leftSE.point,a.rightSE.point)>0&&a.swapEvents(),bi.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),s.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}consume(e){let n=this,r=e;for(;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const i=xh.compare(n,r);if(i!==0){if(i>0){const s=n;n=r,r=s}if(n.prev===r){const s=n;n=r,r=s}for(let s=0,o=r.rings.length;s<o;s++){const a=r.rings[s],u=r.windings[s],h=n.rings.indexOf(a);h===-1?(n.rings.push(a),n.windings.push(u)):n.windings[h]+=u}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const n=this._afterState.rings,r=this._afterState.windings,i=this._afterState.multiPolys;for(let a=0,u=this.rings.length;a<u;a++){const h=this.rings[a],p=this.windings[a],_=n.indexOf(h);_===-1?(n.push(h),r.push(p)):r[_]+=p}const s=[],o=[];for(let a=0,u=n.length;a<u;a++){if(r[a]===0)continue;const h=n[a],p=h.poly;if(o.indexOf(p)===-1)if(h.isExterior)s.push(p);else{o.indexOf(p)===-1&&o.push(p);const _=s.indexOf(h.poly);_!==-1&&s.splice(_,1)}}for(let a=0,u=s.length;a<u;a++){const h=s[a].multiPoly;i.indexOf(h)===-1&&i.push(h)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(c2.type){case"union":{const r=e.length===0,i=n.length===0;this._isInResult=r!==i;break}case"intersection":{let r,i;e.length<n.length?(r=e.length,i=n.length):(r=n.length,i=e.length),this._isInResult=i===c2.numMultiPolys&&r<i;break}case"xor":{const r=Math.abs(e.length-n.length);this._isInResult=r%2===1;break}case"difference":{const r=i=>i.length===1&&i[0].isSubject;this._isInResult=r(e)!==r(n);break}}return this._isInResult}},RE=class{constructor(t,e,n){if(Me(this,"poly"),Me(this,"isExterior"),Me(this,"segments"),Me(this,"bbox"),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=e,this.isExterior=n,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=cs.snap({x:new Ri(t[0][0]),y:new Ri(t[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let s=1,o=t.length;s<o;s++){if(typeof t[s][0]!="number"||typeof t[s][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const a=cs.snap({x:new Ri(t[s][0]),y:new Ri(t[s][1])});a.x.eq(i.x)&&a.y.eq(i.y)||(this.segments.push(N0.fromRing(i,a,this)),a.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=a.x),a.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=a.y),a.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=a.x),a.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=a.y),i=a)}(!r.x.eq(i.x)||!r.y.eq(i.y))&&this.segments.push(N0.fromRing(i,r,this))}getSweepEvents(){const t=[];for(let e=0,n=this.segments.length;e<n;e++){const r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}},Xee=class{constructor(t,e){if(Me(this,"multiPoly"),Me(this,"exteriorRing"),Me(this,"interiorRings"),Me(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new RE(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let n=1,r=t.length;n<r;n++){const i=new RE(t[n],this,!1);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.interiorRings.push(i)}this.multiPoly=e}getSweepEvents(){const t=this.exteriorRing.getSweepEvents();for(let e=0,n=this.interiorRings.length;e<n;e++){const r=this.interiorRings[e].getSweepEvents();for(let i=0,s=r.length;i<s;i++)t.push(r[i])}return t}},kE=class{constructor(t,e){if(Me(this,"isSubject"),Me(this,"polys"),Me(this,"bbox"),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:new Ri(Number.POSITIVE_INFINITY),y:new Ri(Number.POSITIVE_INFINITY)},ur:{x:new Ri(Number.NEGATIVE_INFINITY),y:new Ri(Number.NEGATIVE_INFINITY)}};for(let n=0,r=t.length;n<r;n++){const i=new Xee(t[n],this);i.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=i.bbox.ll.x),i.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=i.bbox.ll.y),i.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=i.bbox.ur.x),i.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=i.bbox.ur.y),this.polys.push(i)}this.isSubject=e}getSweepEvents(){const t=[];for(let e=0,n=this.polys.length;e<n;e++){const r=this.polys[e].getSweepEvents();for(let i=0,s=r.length;i<s;i++)t.push(r[i])}return t}},Qee=(t,...e)=>c2.run("intersection",t,e);cs.set;function Yee(t,e={}){const n=[];if(jI(t,i=>{n.push(i.coordinates)}),n.length<2)throw new Error("Must specify at least 2 geometries");const r=Qee(n[0],...n.slice(1));return r.length===0?null:r.length===1?Ly(r[0],e.properties):UI(r,e.properties)}var sM=Yee,qee={Point:oM,MultiPoint:Kee,LineString:aM,MultiLineString:Gee,Polygon:lM,MultiPolygon:Jee};function Zee(t,e){const[n,r,i,s]=e,o=A2([n,s]),a=A2([i,r]),u=[o,a];if(t.type==="GeometryCollection")throw new Error("Unsupported geometry type GeometryCollection");const h=qee[t.type],p=h(t.coordinates,u);return{...t,coordinates:p}}function oM([t,e],[n,r]){const i=IE(n[0],r[0],t),s=IE(n[1],r[1],e);return[i,s]}function zy(t,e){return t.map(n=>oM(A2(n),e))}function Kee(t,e){return zy(t,e)}function aM(t,e){return zy(t,e)}function Gee(t,e){return t.map(n=>aM(n,e))}function lM(t,e){return t.map(n=>zy(n,e))}function Jee(t,e){return t.map(n=>lM(n,e))}function A2(t){return i2(t)}function IE(t,e,n){return(n-t)/(e-t)}function ete(t,e,n){var r=t.length,i=ml(t[0],e),s=[],o,a,u;let h,p;for(n||(n=[]),o=1;o<r;o++){for(h=t[o-1],p=t[o],a=u=ml(p,e);;)if(i|a){if(i&a)break;i?(h=u2(h,p,i,e),i=ml(h,e)):(p=u2(h,p,a,e),a=ml(p,e))}else{s.push(h),a!==u?(s.push(p),o<r-1&&(n.push(s),s=[])):o===r-1&&s.push(p);break}i=u}return s.length&&n.push(s),n}function tte(t,e){var n,r,i,s,o,a,u;for(r=1;r<=8;r*=2){for(n=[],i=t[t.length-1],s=!(ml(i,e)&r),o=0;o<t.length;o++)a=t[o],u=!(ml(a,e)&r),u!==s&&n.push(u2(i,a,r,e)),u&&n.push(a),i=a,s=u;if(t=n,!t.length)break}return n}function u2(t,e,n,r){return n&8?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:n&4?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:n&2?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:n&1?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function ml(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function nte(t,e){const n=ls(t),r=n.type,i=t.type==="Feature"?t.properties:{};let s=n.coordinates;switch(r){case"LineString":case"MultiLineString":{const o=[];return r==="LineString"&&(s=[s]),s.forEach(a=>{ete(a,e,o)}),o.length===1?LI(o[0],i):FI(o,i)}case"Polygon":return Ly(ME(s,e),i);case"MultiPolygon":return UI(s.map(o=>ME(o,e)),i);default:throw new Error("geometry "+r+" not supported")}}function ME(t,e){const n=[];for(const r of t){const i=tte(r,e);i.length>0&&((i[0][0]!==i[i.length-1][0]||i[0][1]!==i[i.length-1][1])&&i.push(i[0]),i.length>=4&&n.push(i))}return n}var OE=nte;function rte(t,e,n){const r=_ee(t);if(!n||JI(r,n))return!0;const i=sM(JA([r,lr(n)]));return i?e==="mvt"?Zee(i.geometry,t):i.geometry:!1}function ite(t,e,n){return cM(t,e,n)}function cM(t,e,n){const r=TG(t);if(!n||JI(r,n))return!0;const i=sM(JA([lr(r),lr(n)]));if(!i)return!1;const s=xG(i.geometry,e);return new Set(s)}var ste=[-180,-90,0,90],ote=[0,-90,180,90];function ate(t,e){if(!e)return!0;const n=lr(e),r=Kx(OE(n,ste).geometry.coordinates,t,!0),i=Kx(OE(n,ote).geometry.coordinates,t,!0);return new Set(r.concat(i))}var lte="__geomValue";function cte({tiles:t,tileFormat:e,spatialFilter:n,uniqueIdProperty:r,options:i}){const s=new Map;for(const o of t){if(o.isVisible===!1||!o.data)continue;const a=[o.bbox.west,o.bbox.south,o.bbox.east,o.bbox.north],u=rte(a,e,n);if(u===!1)continue;const h=u===!0?void 0:u;Wg({map:s,spatialFilter:h,data:o.data.points,type:"Point",bbox:a,tileFormat:e,uniqueIdProperty:r,options:i}),Wg({map:s,spatialFilter:h,data:o.data.lines,type:"LineString",bbox:a,tileFormat:e,uniqueIdProperty:r,options:i}),Wg({map:s,spatialFilter:h,data:o.data.polygons,type:"Polygon",bbox:a,tileFormat:e,uniqueIdProperty:r,options:i})}return Array.from(s.values())}function AM({map:t,data:e,startIndex:n,endIndex:r,type:i,bbox:s,tileFormat:o,uniqueIdProperty:a,storeGeometry:u,spatialFilter:h}){const p=fte(e,n),_=dte(p,a,t);if(!_||t.has(_))return;let v=null;if(u||h){const{positions:E}=e,R=gte(n,r,E);v=pte(R,i)}if(v&&h&&!XI(v,h))return;const b=hte(p);u&&v&&(b[lte]=o==="mvt"?hee(v,s):v),t.set(_,b)}function Ate({map:t,data:e,spatialFilter:n,type:r,bbox:i,tileFormat:s,uniqueIdProperty:o,options:a}){const u=uM(e,r),h=(a==null?void 0:a.storeGeometry)||!1;for(let p=0;p<u.length-1;p++){const _=u[p],v=u[p+1];AM({map:t,data:e,startIndex:_,endIndex:v,type:r,bbox:i,tileFormat:s,uniqueIdProperty:o,storeGeometry:h,spatialFilter:n})}}function uM(t,e){let n;switch(e){case"Polygon":n=t.primitivePolygonIndices;break;case"LineString":n=t.pathIndices;break;case"Point":n=_te(t);break;default:throw new Error(`Unsupported geometry type: ${e}`)}return n.value}function ute(t,e){return t.featureIds.value[e]}function fte(t,e){var a;const n=ute(t,e),{properties:r,numericProps:i,fields:s}=t,o={uniqueId:(a=s==null?void 0:s[n])==null?void 0:a.id,properties:r[n],numericProps:{}};for(const u in i)o.numericProps[u]=i[u].value[e];return o}function hte(t){const{properties:e,numericProps:n}=t;return Object.assign({},e,n)}function dte(t,e,n){if(e)return $g(t,e);if(t.uniqueId)return t.uniqueId;const r=n.size+1;return $g(t,"cartodb_id")||$g(t,"geoid")||r}function $g(t,e){const{properties:n,numericProps:r}=t;return r[e]||n[e]}function pte(t,e){switch(e){case"Polygon":return{type:"Polygon",coordinates:[t]};case"LineString":return{type:"LineString",coordinates:t};case"Point":return{type:"Point",coordinates:t[0]};default:throw new Error("Invalid geometry type")}}function gte(t,e,n){const r=[];for(let i=t;i<e;i++)r.push(Array.from(n.value.subarray(i*n.size,(i+1)*n.size)));return r}function Wg({map:t,spatialFilter:e,data:n,type:r,bbox:i,tileFormat:s,uniqueIdProperty:o,options:a}){n!=null&&n.properties.length&&(e?Ate({map:t,data:n,spatialFilter:e,type:r,bbox:i,tileFormat:s,uniqueIdProperty:o,options:a}):mte({map:t,data:n,type:r,bbox:i,tileFormat:s,uniqueIdProperty:o,options:a}))}function mte({map:t,data:e,type:n,bbox:r,tileFormat:i,uniqueIdProperty:s,options:o}){const a=uM(e,n),u=(o==null?void 0:o.storeGeometry)||!1;for(let h=0;h<a.length-1;h++){const p=a[h],_=a[h+1];AM({map:t,data:e,startIndex:p,endIndex:_,type:n,bbox:r,tileFormat:i,uniqueIdProperty:s,storeGeometry:u})}}function _te(t){const e=t.featureIds.value,n=e[e.length-1],r=e.constructor,i={value:new r(e.length+1),size:1};return i.value.set(e),i.value.set([n+1],e.length),i}function yte({tiles:t,spatialFilter:e,spatialDataColumn:n,spatialDataType:r}){const i=new Map,s=bte(r),o=wte(t,s),a=n||s;if(!o)return[];let u;s==="h3"&&(u=ate(o,e));for(const h of t)if(!(h.isVisible===!1||!h.data)){if(s==="quadbin"){const p=vte(h,s);u=cM(p,o,e)}u&&h.data.forEach(p=>{(u===!0||u.has(p.id))&&i.set(p.id,{...p.properties,[a]:p.id})})}return Array.from(i.values())}function vte(t,e){return e==="quadbin"?t.index.q:t.id}function wte(t,e){var r;const n=(r=t.find(i=>{var s;return(s=i.data)==null?void 0:s.length}))==null?void 0:r.data;if(n){if(e==="quadbin")return Number(wu(n[0].id));if(e==="h3")return eq(n[0].id)}}function bte(t){switch(t){case"h3":return"h3";case"quadbin":return"quadbin";default:throw new Error("Unexpected spatial data type")}}var xte="3.4",fM="geom",hM=7e3,Tte=.5,Ete=4,Ste=6;function Cte({tiles:t,...e}){const n={};for(const a of e.rasterMetadata.bands)n[a.name]={...a,nodata:Number(a.nodata)};if(t=t.filter(Rte),t.length===0)return[];const r=wu(t[0].index.q),i=t[0].data.blockSize,s=r+BigInt(Math.log2(i)),o=new Map;for(const a of t){const u=a.index.q,h=ite(u,s,e.spatialFilter);if(h===!1)continue;const p=kte(u,s);for(let _=0;_<p.length;_++){if(h!==!0&&!h.has(p[_]))continue;const v={};let b=!1;for(const E in a.data.cells.numericProps){const R=a.data.cells.numericProps[E].value[_],D=n[E];Ite(R,D.nodata)&&(v[E]=a.data.cells.numericProps[E].value[_],b=!0)}b&&o.set(p[_],v)}}return Array.from(o.values())}function Pte(t){var e;return!!((e=t.data)!=null&&e.cells)}function Rte(t){var e,n;return!!(t.isVisible&&((n=(e=t.data)==null?void 0:e.cells)!=null&&n.numericProps))}function kte(t,e){const n=kd(t),r=Number(e),i=2**(r-n.z),s=n.x*i,o=n.y*i,a=[];for(let u=0,h=i**2;u<h;u++){const p=s+u%i,_=o+Math.floor(u/i);a.push(by({x:p,y:_,z:r}))}return a}function Ite(t,e){return Number.isNaN(t)?!1:e!==t}new Set(Object.values(By));function Ns(t){return Array.isArray(t)?t.map(e=>Ns(e)):typeof t!="object"?t:Object.entries(t).reduce((e,[n,r])=>(e[n.toLowerCase()]=typeof r=="object"&&r?Ns(r):r,e),{})}function er(t,e){if(!t)throw new Error(e)}var dM=class $c extends Error{constructor(e){super(`${$c.NAME}: ${e}`),this.name=$c.NAME}static is(e){var n;return e instanceof $c||((n=e.message)==null?void 0:n.includes($c.NAME))}};Me(dM,"NAME","InvalidColumnError");var f2=dM,Mte=t=>t!==null&&typeof t=="object",pM=t=>Mte(t)&&t.constructor==={}.constructor;function Ote(t,...e){for(const n of e)for(const r in n)n[r]!==void 0&&(t[r]=n[r]);return t}function gM(t,e,n){const r=n.find(i=>i.name===e);return r&&r.type==="geometry"?"geo":t}function Nte({tiles:t,spatialFilter:e,uniqueIdProperty:n,tileFormat:r,spatialDataColumn:i=fM,spatialDataType:s,rasterMetadata:o,storeGeometry:a=!1}){return s==="geo"?cte({tiles:t,tileFormat:r,spatialFilter:e,uniqueIdProperty:n,options:{storeGeometry:a}}):t.some(Pte)?(er(o,"Missing raster metadata"),Cte({tiles:t,spatialFilter:e,spatialDataColumn:i,spatialDataType:s,rasterMetadata:o})):yte({tiles:t,spatialFilter:e,spatialDataColumn:i,spatialDataType:s})}var Dte=class extends Error{constructor(t,e,n,r){let i="Failed to connect";n&&(i="Server returned: ",n.status===400?i+="Bad request":n.status===401||n.status===403?i+="Unauthorized access":n.status===404?i+="Not found":i+="Error",i+=` (${n.status}):`),i+=` ${t.message||t}`;let s=`${e.requestType} API request failed`;s+=`
${i}`;for(const o of Object.keys(e))o!=="requestType"&&(s+=`
${Bte(o)}: ${e[o]}`);s+=`
`,super(s),Me(this,"error"),Me(this,"errorContext"),Me(this,"response"),Me(this,"responseJson"),this.name="CartoAPIError",this.response=n,this.responseJson=r,this.error=t,this.errorContext=e}};function Bte(t){return t.replace(/([A-Z])/g," $1").replace(/^./,e=>e.toUpperCase())}function Lte(...t){return t.map(e=>e.endsWith("/")?e.slice(0,-1):e).join("/")}function Fte(t,e,n,...r){return Lte(t,e,n,...r)}function Ute({apiBaseUrl:t,connectionName:e,endpoint:n}){return Fte(t,"v3","maps",e,n)}var zte={Accept:"application/json","Content-Type":"application/json"},Vte=new Map;async function h2({baseUrl:t,parameters:e={},headers:n={},errorContext:r,maxLengthURL:i=hM,localCache:s,signal:o}){e={v:xte,client:Id(),...typeof deck<"u"&&deck.VERSION&&{deckglVersion:deck.VERSION},...e},t=Hte(t,Object.keys(e));const a=Wte(t,e,n),{cache:u,canReadCache:h,canStoreInCache:p}=$te(s);if(h&&u.has(a))return u.get(a);const _=jte(t,e),v={...zte,...n},b=_.length>i?fetch(t,{method:"POST",body:JSON.stringify(e),headers:v,signal:o}):fetch(_,{headers:v,signal:o});let E,R;const D=b.then(P=>(E=P,E.json())).then(P=>{if(R=P,!E||!E.ok)throw new Error(P.error);return P}).catch(P=>{throw p&&u.delete(a),new Dte(P,r,E,R)});return p&&u.set(a,D),D}function $te(t){var i,s;const e=!((i=t==null?void 0:t.cacheControl)!=null&&i.includes("no-cache")),n=!((s=t==null?void 0:t.cacheControl)!=null&&s.includes("no-store"));return{cache:(t==null?void 0:t.cache)||Vte,canReadCache:e,canStoreInCache:n}}function Wte(t,e,n){const r=Object.entries(e).sort(([s],[o])=>s>o?1:-1),i=Object.entries(n).sort(([s],[o])=>s>o?1:-1);return JSON.stringify({baseUrl:t,parameters:r,headers:i})}function jte(t,e){const n=new URL(t);for(const[r,i]of Object.entries(e))pM(i)||Array.isArray(i)?n.searchParams.set(r,JSON.stringify(i)):i!=null&&n.searchParams.set(r,i.toString());return n.toString()}function Hte(t,e){const n=new URL(t);for(const r of e)n.searchParams.has(r)&&n.searchParams.delete(r);return n.toString()}var Xte={apiBaseUrl:NI,headers:{},maxLengthURL:hM};async function Md(t,e,n){const{accessToken:r,connectionName:i,cache:s,...o}=e,a={...Xte,clientId:Id(),accessToken:r,connectionName:i,endpoint:t};for(const k in o)o[k]&&(a[k]=o[k]);const u=Ute(a),{clientId:h,maxLengthURL:p,localCache:_}=a,v={Authorization:`Bearer ${e.accessToken}`,...e.headers},b={client:h,...e.tags,...n},E={requestType:"Map instantiation",connection:e.connectionName,type:t,source:JSON.stringify(b,void 0,2)},{tilejson:R,schema:D}=await h2({baseUrl:u,parameters:b,headers:v,errorContext:E,maxLengthURL:p,localCache:_}),P=R.url[0];s&&(s.value=parseInt(new URL(P).searchParams.get("cache")||"",10)),E.requestType="Map data";const S=await h2({baseUrl:P,parameters:{client:h},headers:v,errorContext:E,maxLengthURL:p,localCache:_});return r&&(S.accessToken=r),D&&(S.schema=D),S}var mM=class _M{constructor(e){Me(this,"props"),this.props={..._M.defaultProps,clientId:Id(),...e}}destroy(){}};Me(mM,"defaultProps",{apiVersion:"v3",apiBaseUrl:NI,clientId:Id(),filters:{},filtersLogicalOperator:"and"});var Vy=mM;function Qte({response:t,data:e}){var n,r;if(e.error==="Column not found")throw new f2(`${e.error} ${e.column_name}`);if(typeof e.error=="string"&&((n=e.error)!=null&&n.includes("Missing columns")))throw new f2(e.error);switch(t.status){case 401:throw new Error("Unauthorized access. Invalid credentials");case 403:throw new Error("Forbidden access to the requested data");default:throw new Error(e&&e.error&&typeof e.error=="string"?e.error:JSON.stringify((e==null?void 0:e.hint)||((r=e.error)==null?void 0:r[0])))}}async function Yte({url:t,accessToken:e,opts:n}){let r,i;const s=(n==null?void 0:n.method)==="POST";try{r=await fetch(t.toString(),{headers:{Authorization:`Bearer ${e}`,...s&&{"Content-Type":"application/json"},...n.headers},...s&&{method:n==null?void 0:n.method,body:n==null?void 0:n.body},signal:n==null?void 0:n.signal,...n==null?void 0:n.otherOptions}),i=await r.json()}catch(o){throw o.name==="AbortError"?o:new Error(`Failed request: ${o}`)}return r.ok||Qte({response:r,data:i}),i}var NE=["category","histogram","formula","pick","timeseries","range","scatterplot","table"],{V3:qte}=OI,Zte=2048;function Ps(t){er(t.source,"executeModel: missing source"),er(t.model,"executeModel: missing model"),er(t.params,"executeModel: missing params"),er(NE.includes(t.model),`executeModel: model provided isn't valid. Available models: ${NE.join(", ")}`);const{model:e,source:n,params:r,opts:i}=t,{type:s,apiVersion:o,apiBaseUrl:a,accessToken:u,connectionName:h,clientId:p}=n;er(a,"executeModel: missing apiBaseUrl"),er(u,"executeModel: missing accessToken"),er(o===qte,"executeModel: SQL Model API requires CARTO 3+"),er(s!=="tileset","executeModel: Tilesets not supported");let _=`${a}/v3/sql/${h}/model/${e}`;const{data:v,filters:b,filtersLogicalOperator:E="and",spatialDataType:R="geo",spatialDataColumn:D=fM,spatialFiltersMode:P="intersects",tags:S}=n,k={type:s,client:p,source:v,params:r,queryParameters:n.queryParameters||"",filters:b,filtersLogicalOperator:E,...S??{}};k.spatialDataType=R,k.spatialDataColumn=D,n.spatialFilter&&(k.spatialFilters={[D]:n.spatialFilter},R!=="geo"&&(k.spatialFiltersMode=P));const M=_+"?"+Kte(k).toString(),V=M.length<=Zte;return V&&(_=M),Yte({url:_,accessToken:n.accessToken,opts:{...i,method:V?"GET":"POST",...!V&&{body:JSON.stringify(k)}}})}function Kte(t){const e=new URLSearchParams;for(const n in t)pM(t[n])||Array.isArray(t[n])?e.append(n,JSON.stringify(t[n])):t[n]===null?e.append(n,"null"):t[n]!==void 0&&e.append(n,String(t[n]));return e}var Gte=new Set(Object.values(By)),Jte=t=>Gte.has(t);function yM(t,e){if(!e)return{};const n={};for(const r in e)for(const i in e[r]){if(!Jte(i))continue;const s=e[r][i],o=!t||!(s!=null&&s.owner)||(s==null?void 0:s.owner)!==t;s&&o&&(n[r]||(n[r]={}),n[r][i]=s)}return n}var vM="_carto_others",ene=class extends Vy{_getModelSource(t,e){const n=this.props;return{apiVersion:n.apiVersion,apiBaseUrl:n.apiBaseUrl,clientId:n.clientId,accessToken:n.accessToken,connectionName:n.connectionName,filters:yM(e,t||n.filters),filtersLogicalOperator:n.filtersLogicalOperator,spatialDataType:n.spatialDataType,spatialDataColumn:n.spatialDataColumn,tags:n.tags}}async getCategories(t){var D;const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,rawResult:o,...a}=t,{column:u,operation:h,operationColumn:p,operationExp:_,othersThreshold:v,orderBy:b}=a;h===xi.Custom&&er(_,"operationExp is required for custom operation");const E=await Ps({model:"category",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{column:u,operation:h,operationExp:_,operationColumn:p||u,othersThreshold:v,orderBy:b},opts:{signal:e,headers:this.props.headers}}),R=Ns(E.rows||[]);return o?E:v?[...R,{name:vM,value:(D=E==null?void 0:E.metadata)==null?void 0:D.others}]:R}async getFeatures(t){const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,...o}=t,{columns:a,dataType:u,featureIds:h,z:p,limit:_,tileResolution:v}=o;return Ps({model:"pick",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{columns:a,dataType:u,featureIds:h,z:p,limit:_||1e3,tileResolution:v||Tte},opts:{signal:e,headers:this.props.headers}}).then(({rows:b})=>({rows:b}))}async getFormula(t){const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,operationExp:o,...a}=t,{column:u,operation:h}=a;return h===xi.Custom&&er(o,"operationExp is required for custom operation"),Ps({model:"formula",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{column:u??"*",operation:h??xi.Count,operationExp:o},opts:{signal:e,headers:this.props.headers}}).then(p=>Ns(p.rows[0]))}async getHistogram(t){const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,...o}=t,{column:a,operation:u,ticks:h}=o,p=await Ps({model:"histogram",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{column:a,operation:u,ticks:h},opts:{signal:e,headers:this.props.headers}}).then(_=>Ns(_.rows));if(p.length){const _=Array(h.length+1).fill(0);return p.forEach(({tick:v,value:b})=>_[v]=b),_}return[]}async getRange(t){const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,...o}=t,{column:a}=o;return Ps({model:"range",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{column:a},opts:{signal:e,headers:this.props.headers}}).then(u=>Ns(u.rows[0]))}async getScatter(t){const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,...o}=t,{xAxisColumn:a,xAxisJoinOperation:u,yAxisColumn:h,yAxisJoinOperation:p}=o,_=500;return Ps({model:"scatterplot",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{xAxisColumn:a,xAxisJoinOperation:u,yAxisColumn:h,yAxisJoinOperation:p,limit:_},opts:{signal:e,headers:this.props.headers}}).then(v=>Ns(v.rows)).then(v=>v.map(({x:b,y:E})=>[b,E]))}async getTable(t){const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,...o}=t,{columns:a,sortBy:u,sortDirection:h,offset:p=0,limit:_=10}=o;return Ps({model:"table",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{column:a,sortBy:u,sortDirection:h,limit:_,offset:p},opts:{signal:e,headers:this.props.headers}}).then(v=>{var b,E;return{rows:v.rows??v.ROWS,totalCount:((b=v.metadata)==null?void 0:b.total)??((E=v.METADATA)==null?void 0:E.TOTAL)}})}async getTimeSeries(t){const{signal:e,filters:n=this.props.filters,filterOwner:r,spatialFilter:i,spatialFiltersMode:s,...o}=t,{column:a,operationColumn:u,joinOperation:h,operation:p,operationExp:_,stepSize:v,stepMultiplier:b,splitByCategory:E,splitByCategoryLimit:R,splitByCategoryValues:D}=o;return p===xi.Custom&&er(_,"operationExp is required for custom operation"),Ps({model:"timeseries",source:{...this.getModelSource(n,r),spatialFiltersMode:s,spatialFilter:i},params:{column:a,stepSize:v,stepMultiplier:b,operationColumn:u||a,joinOperation:h,operation:p,operationExp:_,splitByCategory:E,splitByCategoryLimit:R,splitByCategoryValues:D},opts:{signal:e,headers:this.props.headers}}).then(P=>{var S;return{rows:Ns(P.rows),categories:(S=P.metadata)==null?void 0:S.categories}})}async getExtent(t={}){const{signal:e,filters:n=this.props.filters,filterOwner:r}=t,{type:i,data:s,apiBaseUrl:o,apiVersion:a,connectionName:u,spatialDataColumn:h,spatialDataType:p,queryParameters:_}=this.getModelSource(n,r);er(a==="v3","Stats API requires CARTO 3+");let v;const b={filters:n,spatialDataType:p};i==="query"?(v=`${o}/${a}/stats/${u}/${h}`,b.q=s,b.queryParameters=_):v=`${o}/${a}/stats/${u}/${s}/${h}`;const E={Authorization:`Bearer ${this.props.accessToken}`,...this.props.headers};return h2({baseUrl:v,headers:E,signal:e,errorContext:{requestType:"Tile stats",connection:u,type:i},parameters:b}).then(({extent:{xmin:D,ymin:P,xmax:S,ymax:k}})=>({bbox:[D,P,S,k]}))}},jo={count:t=>t.length,min:(...t)=>Vf(rne,...t),max:(...t)=>Vf(ine,...t),sum:(...t)=>Vf(wM,...t),avg:(...t)=>Vf(nne,...t)};function co(t,e,n){if(e!=null&&e.length){if(e.length===1){const i=t[e[0]];return DE(i)?Number(i):i}}else throw new Error("Cannot aggregate a feature without having keys");const r=jo[n];if(!r)throw new Error(`${n} isn't a valid aggregation function`);return r(e.map(i=>{const s=t[i];return DE(s)?Number(s):s}))}function DE(t){return typeof t=="string"&&t.trim().length>0}var Vf=(t,e,n,r)=>{const i=Od(n),s=((i==null?void 0:i.length)||0)<=1?tne(e,i||[]):e;return t(s,n,r)};function tne(t,e){const n=r=>r!=null;return e!=null&&e.length?t.filter(r=>n(r[e[0]])):t.filter(n)}function nne(t,e,n){return wM(t,e,n)/(t.length||1)}function wM(t,e,n){const r=Od(e);return r?t.reduce((i,s)=>i+co(s,r,n),0):t.reduce((i,s)=>i+s,0)}function rne(t,e,n){const r=Od(e);if(r)return t.reduce((s,o)=>Math.min(s,co(o,r,n)),1/0);let i=Number.POSITIVE_INFINITY;for(const s of t)i=Math.min(i,s);return i}function ine(t,e,n){const r=Od(e);if(r)return t.reduce((s,o)=>Math.max(s,co(o,r,n)),-1/0);let i=Number.NEGATIVE_INFINITY;for(const s of t)i=Math.max(i,s);return i}function Od(t){return Array.isArray(t)?t:typeof t=="string"?[t]:void 0}var sne=_J(yJ(),1);function one(t,{sortBy:e,sortByDirection:n="asc",sortByColumnType:r="string"}={}){if(e===void 0)return t;if(!(Array.isArray(e)&&e.length||typeof e=="string"))throw new Error("Sorting options are bad formatted");const s=ane({sortBy:e,sortByDirection:n,sortByColumnType:r||"string"});return t.sort(s)}function ane({sortBy:t,sortByDirection:e,sortByColumnType:n}){const[r,...i]=lne({sortBy:t,sortByDirection:e,sortByColumnType:n});let s=(0,sne.firstBy)(...r);for(const o of i)s=s.thenBy(...o);return s}function lne({sortBy:t,sortByDirection:e,sortByColumnType:n}){const r=n==="number"&&{cmp:(i,s)=>i-s};return Array.isArray(t)||(t=[t]),t.map(i=>{if(typeof i=="string")return[i,{direction:e,...r}];if(Array.isArray(i)){if(i[1]===void 0)return[i,{direction:e,...r}];if(typeof i[1]=="object"){const s=r?{...r,...i[1]}:i[1];return[i[0],{direction:e,...s}]}}return i})}function cne({data:t,valuesColumns:e,joinOperation:n,keysColumn:r,operation:i,othersThreshold:s,orderBy:o="frequency_desc"}){if(Array.isArray(t)&&t.length===0)return{rows:null};const a=t.reduce((p,_)=>{const v=_[r],b=p.get(v)||[];p.set(v,b);const E=co(_,e,n);return(i==="count"?!0:E!==null)&&E!==void 0&&(b.push(E),p.set(v,b)),p},new Map),u=jo[i];if(!u)return{rows:[]};const h=Array.from(a).map(([p,_])=>({name:p,value:u(_)})).sort(Ane(o));if(s&&h.length>s){const p=h.slice(s).flatMap(({name:_})=>a.get(_));return{rows:h,metadata:{others:u(p)}}}return{rows:h}}function Ane(t){switch(t){case"frequency_asc":return(e,n)=>e.value-n.value||$f(e.name,n.name);case"frequency_desc":return(e,n)=>n.value-e.value||$f(e.name,n.name);case"alphabetical_asc":return(e,n)=>$f(e.name,n.name)||n.value-e.value;case"alphabetical_desc":return(e,n)=>$f(n.name,e.name)||n.value-e.value}}function $f(t,e){return typeof t=="number"&&typeof e=="number"?t-e:String(t??"null").localeCompare(String(e??"null"))}function une(t){const e=new Date(t),n=e.getUTCDay(),r=e.getUTCDate()-n+(n?1:-6);return e.setUTCDate(r),Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate())}var fne={year:t=>Date.UTC(t.getUTCFullYear()),month:t=>Date.UTC(t.getUTCFullYear(),t.getUTCMonth()),week:t=>une(t),day:t=>Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()),hour:t=>Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours()),minute:t=>Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes()),second:t=>Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())};function hne({data:t,valuesColumns:e,joinOperation:n,keysColumn:r,groupType:i,operation:s}){if(Array.isArray(t)&&t.length===0)return null;const o=fne[i];if(!o)return null;const a=t.reduce((h,p)=>{const _=p[r],v=new Date(_),b=o(v);if(!isNaN(b)){let E=h.get(b);E||(E=[],h.set(b,E));const R=co(p,e,n);R!=null&&(E.push(R),h.set(b,E))}return h},new Map),u=jo[s];return[...a.entries()].map(([h,p])=>({name:h,value:u(p)})).sort((h,p)=>h.name-p.name)}function dne({data:t,valuesColumns:e,joinOperation:n,ticks:r,operation:i}){if(Array.isArray(t)&&t.length===0)return[];const s=[Number.MIN_SAFE_INTEGER,...r].map((u,h,p)=>({bin:h,start:u,end:h===p.length-1?Number.MAX_SAFE_INTEGER:p[h+1],values:[]}));t.forEach(u=>{const h=co(u,e,n);if(!(h!=null))return;const _=s.find(v=>v.start<=h&&v.end>h);_&&_.values.push(h)});const o=jo[i];return s.map(u=>u.values).map(u=>u.length?o(u):0)}function pne({data:t,xAxisColumns:e,xAxisJoinOperation:n,yAxisColumns:r,yAxisJoinOperation:i}){return t.reduce((s,o)=>{const a=co(o,e,n),u=a!=null,h=co(o,r,i),p=h!=null;return u&&p&&s.push([a,h]),s},[])}var gne=Object.defineProperty,ec=(t,e)=>gne(t,"name",{value:e,configurable:!0}),bM=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,i;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(i=e==null?void 0:e.compareProperties)!=null?i:!0}compare(e,n){if(e.type!==n.type||!Wc(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=d2(e),i=d2(n);return r.every(s=>i.some(o=>this.compare(s,o)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,i)=>Math.abs(r-n[i])<this.precision)}compareLine(e,n,r=0,i=!1){if(!Wc(e,n))return!1;const s=e;let o=n;if(i&&!this.compareCoord(s[0],o[0])){const u=this.fixStartIndex(o,s);if(u)o=u;else return!1}const a=this.compareCoord(s[r],o[r]);return this.direction||a?this.comparePath(s,o):this.compareCoord(s[r],o[o.length-(1+r)])?this.comparePath(s.slice().reverse(),o):!1}fixStartIndex(e,n){let r,i=-1;for(let s=0;s<e.length;s++)if(this.compareCoord(e[s],n[0])){i=s;break}return i>=0&&(r=[].concat(e.slice(i,e.length),e.slice(1,i+1))),r}comparePath(e,n){return e.every((r,i)=>this.compareCoord(r,n[i]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),i=n.coordinates.slice(1,n.coordinates.length);return r.every(s=>i.some(o=>this.compareLine(s,o,1,!0)))}return!1}compareGeometryCollection(e,n){return Wc(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,i)=>this.compare(r,n.geometries[i]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?$y(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Wc(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,i)=>this.compare(r,n.features[i]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};ec(bM,"GeojsonEquality");var mne=bM;function Wc(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}ec(Wc,"sameLength");function d2(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}ec(d2,"explode");function xM(t,e,n){return new mne(n).compare(t,e)}ec(xM,"geojsonEquality");function $y(t,e){if(t===null&&e===null)return!0;if(t===null||e===null)return!1;const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(var i of n){const s=t[i],o=e[i],a=BE(s)&&BE(o);if(a&&!$y(s,o)||!a&&s!==o)return!1}return!0}ec($y,"equal");var BE=ec(t=>t!=null&&typeof t=="object","isObject");function LE(t,e={}){var n=typeof e=="object"?e.mutate:e;if(!t)throw new Error("geojson is required");var r=$J(t),i=[];switch(r){case"LineString":i=jg(t,r);break;case"MultiLineString":case"Polygon":pA(t).forEach(function(o){i.push(jg(o,r))});break;case"MultiPolygon":pA(t).forEach(function(o){var a=[];o.forEach(function(u){a.push(jg(u,r))}),i.push(a)});break;case"Point":return t;case"MultiPoint":var s={};pA(t).forEach(function(o){var a=o.join("-");Object.prototype.hasOwnProperty.call(s,a)||(i.push(o),s[a]=!0)});break;default:throw new Error(r+" geometry not supported")}return t.coordinates?n===!0?(t.coordinates=i,t):{type:r,coordinates:i}:n===!0?(t.geometry.coordinates=i,t):lr({type:r,coordinates:i},t.properties,{bbox:t.bbox,id:t.id})}function jg(t,e){var n=pA(t);if(n.length===2&&!FE(n[0],n[1]))return n;var r=[],i=n.length-1,s=r.length;r.push(n[0]);for(var o=1;o<i;o++){var a=r[r.length-1];n[o][0]===a[0]&&n[o][1]===a[1]||(r.push(n[o]),s=r.length,s>2&&UE(r[s-3],r[s-1],r[s-2])&&r.splice(r.length-2,1))}if(r.push(n[n.length-1]),s=r.length,(e==="Polygon"||e==="MultiPolygon")&&FE(n[0],n[n.length-1])&&s<4)throw new Error("invalid polygon");return e==="LineString"&&s<3||UE(r[s-3],r[s-1],r[s-2])&&r.splice(r.length-2,1),r}function FE(t,e){return t[0]===e[0]&&t[1]===e[1]}function UE(t,e,n){var r=n[0],i=n[1],s=t[0],o=t[1],a=e[0],u=e[1],h=r-s,p=i-o,_=a-s,v=u-o,b=h*v-p*_;return b!==0?!1:Math.abs(_)>=Math.abs(v)?_>0?s<=r&&r<=a:a<=r&&r<=s:v>0?o<=i&&i<=u:u<=i&&i<=o}function _ne(t,e,n={}){let r=n.precision;if(r=r==null||isNaN(r)?6:r,typeof r!="number"||!(r>=0))throw new Error("precision must be a positive number");const i=ls(t).type,s=ls(e).type;return i!==s?!1:xM(LE(t),LE(e),{precision:r})}var yne=class extends Vy{constructor(){super(...arguments),Me(this,"_tiles",[]),Me(this,"_features",[]),Me(this,"_tileFeatureExtractOptions",{}),Me(this,"_tileFeatureExtractPreviousInputs",{})}loadTiles(t){this._tiles=t,this._features.length=0}setTileFeatureExtractOptions(t){this._tileFeatureExtractOptions=t,this._features.length=0}_extractTileFeatures(t){const e=this._tileFeatureExtractPreviousInputs;this._features.length&&vne(e.spatialFilter,t)||(this._features=Nte({...Ote({},this.props,this._tileFeatureExtractOptions),tiles:this._tiles,spatialFilter:t}),e.spatialFilter=t)}loadGeoJSON({geojson:t,spatialFilter:e}){this._features=lee({geojson:t,spatialFilter:e,...this._tileFeatureExtractOptions}),this._tileFeatureExtractPreviousInputs.spatialFilter=e}async getFeatures(){throw new Error("getFeatures not supported for tilesets")}async getFormula({column:t="*",operation:e=xi.Count,joinOperation:n,filters:r,filterOwner:i,spatialFilter:s}){const o=this._getFilteredFeatures(s,r,i);if(o.length===0&&e!==xi.Count)return{value:null};if(e===xi.Custom)throw new Error("Custom aggregation not supported for tilesets");(t&&t!=="*"||e!==xi.Count)&&Va(this._features,t);const a=jo[e];return{value:a(o,t,n)}}async getHistogram({operation:t=xi.Count,ticks:e,column:n,joinOperation:r,filters:i,filterOwner:s,spatialFilter:o}){const a=this._getFilteredFeatures(o,i,s);return this._features.length?(Va(this._features,n),dne({data:a,valuesColumns:ja(n),joinOperation:r,ticks:e,operation:t})):[]}async getCategories({column:t,operation:e=xi.Count,operationColumn:n,joinOperation:r,filters:i,filterOwner:s,spatialFilter:o,othersThreshold:a,orderBy:u="frequency_desc",rawResult:h}){var v;const p=this._getFilteredFeatures(o,i,s);if(!p.length)return[];Va(this._features,t,n);const _=cne({data:p,valuesColumns:ja(n||t),joinOperation:r,keysColumn:t,operation:e,othersThreshold:a,orderBy:u});return h?_:a?[...(_==null?void 0:_.rows)||[],{name:vM,value:(v=_==null?void 0:_.metadata)==null?void 0:v.others}]:(_==null?void 0:_.rows)||[]}async getScatter({xAxisColumn:t,yAxisColumn:e,xAxisJoinOperation:n,yAxisJoinOperation:r,filters:i,filterOwner:s,spatialFilter:o}){const a=this._getFilteredFeatures(o,i,s);return a.length?(Va(this._features,t,e),pne({data:a,xAxisColumns:ja(t),xAxisJoinOperation:n,yAxisColumns:ja(e),yAxisJoinOperation:r})):[]}async getTable({columns:t,searchFilterColumn:e,searchFilterText:n,sortBy:r,sortDirection:i,sortByColumnType:s,offset:o=0,limit:a=10,filters:u,filterOwner:h,spatialFilter:p}){let _=this._getFilteredFeatures(p,u,h);if(!_.length)return{rows:[],totalCount:0};e&&n&&(console.warn('WidgetTilesetSource: "searchFilterText" is deprecated, use "filters" and FilterType.STRING_SEARCH instead.'),_=_.filter(E=>E[e]&&String(E[e]).toLowerCase().includes(String(n).toLowerCase())));let v=one(_,{sortBy:r,sortByDirection:i,sortByColumnType:s});const b=v.length;return v=v.slice(Math.min(o,b),Math.min(o+a,b)),v=v.map(E=>{const R={};for(const D of t)R[D]=E[D];return R}),{rows:v,totalCount:b}}async getTimeSeries({column:t,stepSize:e,operation:n,operationColumn:r,joinOperation:i,filters:s,filterOwner:o,spatialFilter:a}){const u=this._getFilteredFeatures(a,s,o);return u.length?(Va(this._features,t,r),er(n!=="custom","Custom operation not supported for tilesets"),{rows:hne({data:u,valuesColumns:ja(r||t),keysColumn:t,groupType:e,operation:n,joinOperation:i})||[]}):{rows:[]}}async getRange({column:t,filters:e,filterOwner:n,spatialFilter:r}){const i=this._getFilteredFeatures(r,e,n);return this._features.length?(Va(this._features,t),{min:jo.min(i,t),max:jo.max(i,t)}):null}async getExtent(){return Promise.reject(new Error("not implemented"))}_getFilteredFeatures(t,e,n){return this._extractTileFeatures(t),MJ(this._features,yM(n,e||this.props.filters),this.props.filtersLogicalOperator||"and")}};function Va(t,...e){const n=Array.from(new Set(e.map(ja).flat())),r=Object.keys(t[0]),i=n.filter(s=>s&&!r.includes(s));if(i.length)throw new f2(`Missing column(s): ${i.join(", ")}`)}function ja(t){return Array.isArray(t)?t:typeof t=="string"?[t]:[]}function vne(t,e){return t===e?!0:!t||!e?!1:_ne(t,e)}var TM=class extends Vy{constructor(t){super(t),Me(this,"_localImpl",null),Me(this,"_workerImpl",null),Me(this,"_workerEnabled"),Me(this,"_workerNextRequestId",1),this._workerEnabled=(t.widgetWorker??!0)&&!0&&typeof Worker<"u",this._workerEnabled||(this._localImpl=new yne(this.props))}destroy(){var t,e;(t=this._localImpl)==null||t.destroy(),this._localImpl=null,(e=this._workerImpl)==null||e.terminate(),this._workerImpl=null,super.destroy()}_getWorker(){return this._workerImpl?this._workerImpl:(this.props.widgetWorkerUrl?this._workerImpl=new Worker(this.props.widgetWorkerUrl,{name:"cartowidgettileset"}):this._workerImpl=new Worker(new URL("/assets/worker-51abeed8.js",self.location),{type:"module",name:"cartowidgettileset"}),this._workerImpl.addEventListener("error",t=>{console.error("widget-tileset-source worker error",t)}),this._workerImpl.postMessage({method:"init",params:[this.props]}),this._workerImpl)}_executeWorkerMethod(t,e,n){if(!this._workerEnabled)return this._localImpl[t](...e);const r=this._getWorker(),i=this._workerNextRequestId++;let s=null,o=null;function a(p){const _=p.data;_.requestId===i&&(n!=null&&n.aborted||(_.ok?s(_.result):o(new Error(_.error))))}function u(){o(new Error(n.reason))}r.addEventListener("message",a),n==null||n.addEventListener("abort",u);const h=new Promise((p,_)=>{s=p,o=_,r.postMessage({requestId:i,method:t,params:e})});return h.finally(()=>{r.removeEventListener("message",a),n==null||n.removeEventListener("abort",u)}),h}loadTiles(t){if(!this._workerEnabled)return this._localImpl.loadTiles(t);const e=this._getWorker();t=t.map(({id:n,index:r,bbox:i,isVisible:s,data:o})=>({id:n,index:r,isVisible:s,data:o,bbox:i})),e.postMessage({method:"loadTiles",params:[t]})}setTileFeatureExtractOptions(t){var n;if(!this._workerEnabled)return(n=this._localImpl)==null?void 0:n.setTileFeatureExtractOptions(t);this._getWorker().postMessage({method:"setTileFeatureExtractOptions",params:[t]})}loadGeoJSON({geojson:t,spatialFilter:e}){if(!this._workerEnabled)return this._localImpl.loadGeoJSON({geojson:t,spatialFilter:e});this._getWorker().postMessage({method:"loadGeoJSON",params:[{geojson:t,spatialFilter:e}]})}async getFeatures(){throw new Error("getFeatures not supported for tilesets")}async getFormula({signal:t,...e}){return this._executeWorkerMethod("getFormula",[e],t)}async getHistogram({signal:t,...e}){return this._executeWorkerMethod("getHistogram",[e],t)}async getCategories({signal:t,...e}){return this._executeWorkerMethod("getCategories",[e],t)}async getScatter({signal:t,...e}){return this._executeWorkerMethod("getScatter",[e],t)}async getTable({signal:t,...e}){return this._executeWorkerMethod("getTable",[e],t)}async getTimeSeries({signal:t,...e}){return this._executeWorkerMethod("getTimeSeries",[e],t)}async getRange({signal:t,...e}){return this._executeWorkerMethod("getRange",[e],t)}async getExtent(){return Promise.resolve({bbox:this.props.spatialDataBounds})}},EM=class extends ene{getModelSource(t,e){return{...super._getModelSource(t,e),type:"table",data:this.props.tableName}}},wne=async function(t){const{aggregationExp:e,aggregationResLevel:n=Ete,spatialDataColumn:r="h3",tableName:i,filters:s}=t,o="h3",a={aggregationExp:e,name:i,spatialDataColumn:r,spatialDataType:o};return n&&(a.aggregationResLevel=String(n)),s&&(a.filters=s),Md("table",t,a).then(u=>({...u,widgetSource:new EM({...t,spatialDataColumn:r,spatialDataType:gM(o,r,u.schema)})}))};function SM(t){return new URL(t.tiles[0]).searchParams.get("formatTiles")==="mvt"?"mvt":"binary"}var bne=async function(t){const{tableName:e,spatialDataColumn:n="h3"}=t;return Md("tileset",t,{name:e}).then(i=>({...i,widgetSource:new TM({...t,tileFormat:SM(i),spatialDataColumn:n,spatialDataType:"h3",spatialDataBounds:i.bounds})}))},xne=async function(t){const{aggregationExp:e,aggregationResLevel:n=Ste,spatialDataColumn:r="quadbin",tableName:i,filters:s}=t,o="quadbin",a={aggregationExp:e,name:i,spatialDataColumn:r,spatialDataType:o};return n&&(a.aggregationResLevel=String(n)),s&&(a.filters=s),Md("table",t,a).then(u=>({...u,widgetSource:new EM({...t,spatialDataColumn:r,spatialDataType:gM(o,r,u.schema)})}))},Tne=async function(t){const{tableName:e,spatialDataColumn:n="quadbin"}=t;return Md("tileset",t,{name:e}).then(i=>({...i,widgetSource:new TM({...t,tileFormat:SM(i),spatialDataColumn:n,spatialDataType:"quadbin",spatialDataBounds:i.bounds})}))},Ene="https://basemaps.cartocdn.com/gl/{basemap}-gl-style/style.json";function $a(t){return Ene.replace("{basemap}",t)}$a("voyager"),$a("positron"),$a("dark-matter"),$a("voyager-nolabels"),$a("positron-nolabels"),$a("dark-matter-nolabels");function Wy(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function CM(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function xu(){}var eu=.7,D0=1/eu,kl="\\s*([+-]?\\d+)\\s*",tu="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Mi="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Sne=/^#([0-9a-f]{3,8})$/,Cne=new RegExp(`^rgb\\(${kl},${kl},${kl}\\)$`),Pne=new RegExp(`^rgb\\(${Mi},${Mi},${Mi}\\)$`),Rne=new RegExp(`^rgba\\(${kl},${kl},${kl},${tu}\\)$`),kne=new RegExp(`^rgba\\(${Mi},${Mi},${Mi},${tu}\\)$`),Ine=new RegExp(`^hsl\\(${tu},${Mi},${Mi}\\)$`),Mne=new RegExp(`^hsla\\(${tu},${Mi},${Mi},${tu}\\)$`),zE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Wy(xu,jy,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:VE,formatHex:VE,formatHex8:One,formatHsl:Nne,formatRgb:$E,toString:$E});function VE(){return this.rgb().formatHex()}function One(){return this.rgb().formatHex8()}function Nne(){return PM(this).formatHsl()}function $E(){return this.rgb().formatRgb()}function jy(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Sne.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?WE(e):n===3?new ir(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Wf(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Wf(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=Cne.exec(t))?new ir(e[1],e[2],e[3],1):(e=Pne.exec(t))?new ir(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=Rne.exec(t))?Wf(e[1],e[2],e[3],e[4]):(e=kne.exec(t))?Wf(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=Ine.exec(t))?XE(e[1],e[2]/100,e[3]/100,1):(e=Mne.exec(t))?XE(e[1],e[2]/100,e[3]/100,e[4]):zE.hasOwnProperty(t)?WE(zE[t]):t==="transparent"?new ir(NaN,NaN,NaN,0):null}function WE(t){return new ir(t>>16&255,t>>8&255,t&255,1)}function Wf(t,e,n,r){return r<=0&&(t=e=n=NaN),new ir(t,e,n,r)}function Dne(t){return t instanceof xu||(t=jy(t)),t?(t=t.rgb(),new ir(t.r,t.g,t.b,t.opacity)):new ir}function Bne(t,e,n,r){return arguments.length===1?Dne(t):new ir(t,e,n,r??1)}function ir(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Wy(ir,Bne,CM(xu,{brighter(t){return t=t==null?D0:Math.pow(D0,t),new ir(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?eu:Math.pow(eu,t),new ir(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new ir(Ho(this.r),Ho(this.g),Ho(this.b),B0(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:jE,formatHex:jE,formatHex8:Lne,formatRgb:HE,toString:HE}));function jE(){return`#${Lo(this.r)}${Lo(this.g)}${Lo(this.b)}`}function Lne(){return`#${Lo(this.r)}${Lo(this.g)}${Lo(this.b)}${Lo((isNaN(this.opacity)?1:this.opacity)*255)}`}function HE(){const t=B0(this.opacity);return`${t===1?"rgb(":"rgba("}${Ho(this.r)}, ${Ho(this.g)}, ${Ho(this.b)}${t===1?")":`, ${t})`}`}function B0(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ho(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Lo(t){return t=Ho(t),(t<16?"0":"")+t.toString(16)}function XE(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new ei(t,e,n,r)}function PM(t){if(t instanceof ei)return new ei(t.h,t.s,t.l,t.opacity);if(t instanceof xu||(t=jy(t)),!t)return new ei;if(t instanceof ei)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,u=(s+i)/2;return a?(e===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-e)/a+2:o=(e-n)/a+4,a/=u<.5?s+i:2-s-i,o*=60):a=u>0&&u<1?0:o,new ei(o,a,u,t.opacity)}function Fne(t,e,n,r){return arguments.length===1?PM(t):new ei(t,e,n,r??1)}function ei(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Wy(ei,Fne,CM(xu,{brighter(t){return t=t==null?D0:Math.pow(D0,t),new ei(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?eu:Math.pow(eu,t),new ei(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new ir(Hg(t>=240?t-240:t+120,i,r),Hg(t,i,r),Hg(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new ei(QE(this.h),jf(this.s),jf(this.l),B0(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=B0(this.opacity);return`${t===1?"hsl(":"hsla("}${QE(this.h)}, ${jf(this.s)*100}%, ${jf(this.l)*100}%${t===1?")":`, ${t})`}`}}));function QE(t){return t=(t||0)%360,t<0?t+360:t}function jf(t){return Math.max(0,Math.min(1,t||0))}function Hg(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}var Une=new Intl.DateTimeFormat("en-US",{year:"2-digit",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZone:"UTC"});function zne(t){return Une.format(new Date(t))}function Vne(t){return String(Math.floor(new Date(t).getTime()/1e3))}t2("i"),t2(".5f");const Xg={"YlOrRd (Default)":[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]],Viridis:[[68,1,84],[59,82,139],[33,145,140],[94,201,98],[253,231,37]],Plasma:[[13,8,135],[75,3,161],[125,3,168],[168,34,150],[208,73,119],[221,122,76],[245,190,39],[253,231,37]],Blues:[[247,251,255],[222,235,247],[198,219,239],[158,202,225],[107,174,214],[66,146,198],[33,113,181],[8,81,156],[8,48,107]],Reds:[[255,245,240],[254,224,210],[252,187,161],[252,146,114],[251,106,74],[239,59,44],[203,24,29],[165,15,21],[103,0,13]],RdYlBu:[[165,0,38],[215,48,39],[244,109,67],[253,174,97],[254,224,144],[255,255,191],[224,243,248],[171,217,233],[116,173,209],[69,117,180],[49,54,149]],Turbo:[[48,18,59],[61,82,161],[33,145,140],[94,201,98],[253,231,37],[240,249,33]]},YE={"H3 Table (Population)":{type:"h3",source:wne,tableName:"carto-demo-data.demo_tables.derived_spatialfeatures_usa_h3res8_v1_yearly_v2",aggregationExp:"sum(population) as population_sum",getWeight:t=>t.properties.population_sum||1,description:"H3 cells with population data from table source"},"H3 Tileset (Retail)":{type:"h3",source:bne,tableName:"carto-demo-data.demo_tilesets.derived_spatialfeatures_usa_h3res8_v1_yearly_v2_tileset",getWeight:t=>t.properties.retail||1,description:"H3 cells with retail data from tileset source"},"Quadbin Table (Population)":{type:"quadbin",source:xne,tableName:"carto-demo-data.demo_tables.derived_spatialfeatures_usa_quadbin15_v1_yearly_v2",aggregationExp:"sum(population) as population_sum",getWeight:t=>t.properties.population_sum||1,description:"Quadbin cells with population data from table source"},"Quadbin Tileset (Retail)":{type:"quadbin",source:Tne,tableName:"carto-demo-data.demo_tilesets.derived_spatialfeatures_usa_quadbin15_v1_yearly_v2_tileset",getWeight:t=>t.properties.avg_retail||1,description:"Quadbin cells with retail data from tileset source"}},$ne="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",Wne={longitude:-73.75,latitude:40.73,zoom:9,maxZoom:16,pitch:0,bearing:0},jne="https://gcp-us-east1.api.carto.com",Hne="bigquery",Xne="eyJhbGciOiJIUzI1NiJ9.eyJhIjoiYWNfN3hoZnd5bWwiLCJqdGkiOiI3ZDljNmQ2OSJ9.4BRC6J5PNxZXNLeULerfRFaBi87-st2wY0zUvxJ36oY",Qne={accessToken:Xne,apiBaseUrl:jne,connectionName:Hne};function Yne(){const[t,e]=Ce.useState("H3 Table (Population)"),[n,r]=Ce.useState("YlOrRd (Default)"),[i,s]=Ce.useState(30),[o,a]=Ce.useState(2),[u,h]=Ce.useState([0,1]),p=YE[t],_=p.source({...Qne,tableName:p.tableName,...p.aggregationExp&&{aggregationExp:p.aggregationExp}}),v=new tJ({id:"heatmap",data:_,getWeight:p.getWeight,radiusPixels:i,intensity:o,colorDomain:u,colorRange:Xg[n]}),b=Ce.useCallback(k=>e(k.target.value),[]),E=Ce.useCallback(k=>s(Number(k.target.value)),[]),R=Ce.useCallback(k=>a(Number(k.target.value)),[]),D=Ce.useCallback(k=>h([Number(k.target.value),u[1]]),[u]),P=Ce.useCallback(k=>h([u[0],Number(k.target.value)]),[u]),S=Ce.useCallback(k=>r(k.target.value),[]);return pt.createElement(pt.Fragment,null,pt.createElement(mX,{initialViewState:Wne,controller:!0,layers:[v],getTooltip:({object:k})=>{if(!k||!k.properties)return null;const M=k.properties;return Object.entries(M).map(([V,Y])=>`${V}: ${Y}`).join(`
`)}},pt.createElement(ND,{mapStyle:$ne})),pt.createElement("div",{id:"control-panel"},pt.createElement("h3",null,"CARTO Heatmap Test"),pt.createElement("label",null,"Dataset:"),pt.createElement("select",{value:t,onChange:b},Object.keys(YE).map(k=>pt.createElement("option",{key:k,value:k},k))),pt.createElement("div",{className:"description"},p.description),pt.createElement("label",null,"Color Palette:"),pt.createElement("select",{value:n,onChange:S},Object.keys(Xg).map(k=>pt.createElement("option",{key:k,value:k},k))),pt.createElement("div",{className:"color-preview"},Xg[n].map((k,M)=>pt.createElement("div",{key:M,className:"color-swatch",style:{backgroundColor:`rgb(${k[0]}, ${k[1]}, ${k[2]})`,width:"20px",height:"20px",display:"inline-block",marginRight:"2px",border:"1px solid #ccc"}}))),pt.createElement("label",null,"Radius (pixels):"),pt.createElement("input",{type:"range",min:"0",max:"100",value:i,onChange:E}),pt.createElement("div",{className:"range-label"},pt.createElement("span",null,"0"),pt.createElement("span",null,i),pt.createElement("span",null,"100")),pt.createElement("label",null,"Intensity:"),pt.createElement("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:o,onChange:R}),pt.createElement("div",{className:"range-label"},pt.createElement("span",null,"0.1"),pt.createElement("span",null,o),pt.createElement("span",null,"5.0")),pt.createElement("label",null,"Color Domain Min:"),pt.createElement("input",{type:"number",min:"0",max:"10",step:"0.1",value:u[0],onChange:D}),pt.createElement("label",null,"Color Domain Max:"),pt.createElement("input",{type:"number",min:"0.1",max:"10",step:"0.1",value:u[1],onChange:P})))}const qne=document.getElementById("app"),Zne=oC(qne);Zne.render(pt.createElement(Yne,null));export{Gne as c,G0 as g};
