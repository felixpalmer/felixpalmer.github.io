/*! For license information please see e6b5eef9.24f74d21.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite_docusaurus=self.webpackChunkwebsite_docusaurus||[]).push([[5452],{2192:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>h});var i=n(4848),r=n(8453),s=n(357),o=n(3101);const a={},l="Shader Hooks",c={id:"tutorials/shader-hooks",title:"Shader Hooks",description:"The tutorial pages have not yet been updated for luma.gl v9.",source:"@site/../docs/tutorials/shader-hooks.mdx",sourceDirName:"tutorials",slug:"/tutorials/shader-hooks",permalink:"/luma.gl/docs/tutorials/shader-hooks",draft:!1,unlisted:!1,editUrl:"https://github.com/visgl/luma.gl/tree/main/docs/../docs/tutorials/shader-hooks.mdx",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Shader Modules",permalink:"/luma.gl/docs/tutorials/shader-modules"},next:{title:"Transform",permalink:"/luma.gl/docs/tutorials/transform"}},u={},h=[];function _(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.h1,{id:"shader-hooks",children:"Shader Hooks"}),"\n",(0,i.jsx)(t.admonition,{type:"caution",children:(0,i.jsx)(t.p,{children:"The tutorial pages have not yet been updated for luma.gl v9."})}),"\n",(0,i.jsxs)(t.p,{children:["In this tutorial, we'll focus on a key feature of the shader module system:\nthe ability to modify the behavior of the shaders that use the shader modules via ",(0,i.jsx)(t.strong,{children:"shader hooks"}),"."]}),"\n",(0,i.jsx)(s.xN,{}),"\n",(0,i.jsx)(o.YE,{}),"\n",(0,i.jsxs)(t.p,{children:["In the ",(0,i.jsx)(t.a,{href:"/docs/tutorials/shader-modules",children:"previous tutorial"}),", we used shader modules\nto insert re-usable functions into the shaders that use them."]}),"\n",(0,i.jsx)(t.p,{children:"A shader hook is simply a function inserted into a vertex or fragment shader.\nBy default, these functions will be no-ops, but they define entry points\ninto which shader modules can inject code."}),"\n",(0,i.jsxs)(t.p,{children:["For high-level API usage, shader hooks are defined on a\n",(0,i.jsx)(t.a,{href:"/docs/api-reference/engine/pipeline-factory",children:"PipelineFactory"}),"\n(we'll look at low-level shader hooks later):"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"const pipelineFactory = new PipelineFactory(device);\npipelineFactory.addShaderHook('vs:MY_SHADER_HOOK(inout vec4 position)');\n\nconst vs = `\n  attribute vec4 pos;\n\n  void main() {\n    gl_Position = pos;\n    MY_SHADER_HOOK(gl_Position);\n  }\n`;\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Shader modules can then inject code into the hook via their ",(0,i.jsx)(t.code,{children:"inject"})," property:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"const myShaderModule = {\n  name: 'my-shader-module',\n  inject: 'position.x -= 0.1;'\n};\n"})}),"\n",(0,i.jsx)(t.p,{children:"We'll use these features to create a modified version of the previous tutorial, using shader hooks and modules to modify the behavior of a single set of vertex and fragment shaders."}),"\n",(0,i.jsx)(t.p,{children:"We'll start by setting up our imports and defining our base vertex and fragment shaders:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import {AnimationLoop, Model, PipelineFactory} from '@luma.gl/engine';\n\nconst vs = `\n  attribute vec2 position;\n\n  void main() {\n    gl_Position = vec4(position, 0.0, 1.0);\n    OFFSET_POSITION(gl_Position);\n  }\n`;\n\nconst fs = `\n  uniform vec3 color;\n\n  void main() {\n    gl_FragColor = vec4(color, 1.0);\n  }\n`;\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Here we have a shader hook function, ",(0,i.jsx)(t.code,{children:"OFFSET_POSITION"}),", called in our vertex shader. Next we'll create two shader modules that insert code into the shader hook:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"const offsetLeftModule = {\n  name: 'offsetLeft',\n  inject: {\n    'vs:OFFSET_POSITION': 'position.x -= 0.5;'\n  }\n};\n\nconst offsetRightModule = {\n  name: 'offsetRight',\n  inject: {\n    'vs:OFFSET_POSITION': 'position.x += 0.5;'\n  }\n};\n"})}),"\n",(0,i.jsxs)(t.p,{children:["These shader modules inject code into the shader hook that will modify the x-coordinate of the position passed in. The ",(0,i.jsx)(t.code,{children:"inject"})," property maps shader hook names to the code to be injected into them. The ",(0,i.jsx)(t.code,{children:"vs"})," prefix indicates that this is a vertex shader hook."]}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"onInitialize"})," method of our ",(0,i.jsx)(t.code,{children:"AnimationLoop"})," will be somewhat different from the previous example. To create a shader hook, we need access to a ",(0,i.jsx)(t.code,{children:"PipelineFactory"})," instance:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"  override onInitialize({device}) {\n    const pipelineFactory = new PipelineFactory(device);\n    pipelineFactory.addShaderHook('vs:OFFSET_POSITION(inout vec4 position)');\n\n    // ...\n  }\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The shader hook definition is the function signature with a prefix indicating whether it is intended for the vertex shader (",(0,i.jsx)(t.code,{children:"vs"}),") or fragment shader (",(0,i.jsx)(t.code,{children:"fs"}),"). Shader hooks are always ",(0,i.jsx)(t.code,{children:"void"})," funtions so they must return values to the caller via ",(0,i.jsx)(t.code,{children:"out"})," or ",(0,i.jsx)(t.code,{children:"inout"})," argurments. The rest of ",(0,i.jsx)(t.code,{children:"onInitialize"})," is similar to what we've seen before with the exception of using the new shader modules and the ",(0,i.jsx)(t.code,{children:"PipelineFactory"})," to create our ",(0,i.jsx)(t.code,{children:"Model"}),"s:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"  override onInitialize({gl}) {\n    const pipelineFactory = new PipelineFactory(device);\n    pipelineFactory.addShaderHook('vs:OFFSET_POSITION(inout vec4 position)');\n\n    const positionBuffer = device.createBuffer(new Float32Array([\n      -0.3, -0.5,\n      0.3, -0.5,\n      0.0, 0.5\n    ]));\n\n    const model1 = new Model(device, {\n      vs,\n      fs,\n      pipelineFactory,\n      modules: [offsetLeftModule],\n      attributes: {\n        position: positionBuffer\n      },\n      uniforms: {\n        color: [1.0, 0.0, 0.0]\n      },\n      vertexCount: 3\n    });\n\n    const model2 = new Model(device, {\n      vs,\n      fs,\n      pipelineFactory,\n      modules: [offsetRightModule],\n      attributes: {\n        position: positionBuffer\n      },\n      uniforms: {\n        color: [0.0, 0.0, 1.0]\n      },\n      vertexCount: 3\n    });\n\n    return {model1, model2};\n  }\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"onRender"})," method is the same as before. If all went well, a blue trangle and a red triangle should be drawn side-by-side on the canvas. The code injected by the modules into the shader hook is what offsets each triangle to the left or right."]}),"\n",(0,i.jsx)(t.p,{children:"Shader hooks allowed us to define our vertex and fragment shaders once and modify their behavior based on the shader module included."}),"\n",(0,i.jsx)(t.p,{children:"The entire application should look like the following:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-typescript",children:"import {AnimationLoop, Model, PipelineFactory} from '@luma.gl/engine';\nimport {clear} from '@luma.gl/webgl';\n\nconst vs = `\n  attribute vec2 position;\n\n  void main() {\n    gl_Position = vec4(position, 0.0, 1.0);\n    OFFSET_POSITION(gl_Position);\n  }\n`;\n\nconst fs = `\n  uniform vec3 color;\n\n  void main() {\n    gl_FragColor = vec4(color, 1.0);\n  }\n`;\n\nconst offsetLeftModule = {\n  name: 'offsetLeft',\n  inject: {\n    'vs:OFFSET_POSITION': 'position.x -= 0.5;'\n  }\n};\n\nconst offsetRightModule = {\n  name: 'offsetRight',\n  inject: {\n    'vs:OFFSET_POSITION': 'position.x += 0.5;'\n  }\n};\n\nconst loop = new AnimationLoop({\n  override onInitialize({device}) {\n    const pipelineFactory = new PipelineFactory(device);\n    pipelineFactory.addShaderHook('vs:OFFSET_POSITION(inout vec4 position)');\n\n    const positionBuffer = device.createBuffer(new Float32Array([-0.3, -0.5, 0.3, -0.5, 0.0, 0.5]));\n\n    const model1 = new Model(device, {\n      vs,\n      fs,\n      pipelineFactory,\n      modules: [offsetLeftModule],\n      attributes: {\n        position: positionBuffer\n      },\n      uniforms: {\n        color: [1.0, 0.0, 0.0]\n      },\n      vertexCount: 3\n    });\n\n    const model2 = new Model(device, {\n      vs,\n      fs,\n      pipelineFactory,\n      modules: [offsetRightModule],\n      attributes: {\n        position: positionBuffer\n      },\n      uniforms: {\n        color: [0.0, 0.0, 1.0]\n      },\n      vertexCount: 3\n    });\n\n    return {model1, model2};\n  },\n\n  override onRender({device, model}) {\n    clear(gl, {color: [0, 0, 0, 1]});\n    model1.draw();\n    model2.draw();\n  }\n});\n\nloop.start();\n"})})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(_,{...e})}):_(e)}},3369:(e,t,n)=>{n.d(t,{GL:()=>i});var i=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS=37297]="COMPLETION_STATUS",e}(i||{})},9282:(e,t,n)=>{n.d(t,{Mr:()=>l,PV:()=>a,GE:()=>h});var i=n(3522);const r={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},s={f32:4,f16:2,i32:4,u32:4};var o=n(1970);function a(e,t){const n={};for(const i of e.attributes)n[i.name]=c(e,t,i.name);return n}function l(e,t,n){void 0===n&&(n=16);const i=a(e,t),r=new Array(n).fill(null);for(const s of Object.values(i))r[s.location]=s;return r}function c(e,t,n){const a=function(e,t){const n=e.attributes.find((e=>e.name===t));n||i.R.warn('shader layout attribute "'+t+'" not present in shader');return n||null}(e,n),l=function(e,t){u(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);if(n)return n;if(n=function(e,t){for(const i of e){var n;let e=i.byteStride;if("number"!=typeof i.byteStride)for(const t of i.attributes||[]){e+=(0,o.w)(t.format).byteLength}const r=null==(n=i.attributes)?void 0:n.find((e=>e.attribute===t));if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),n)return n;return i.R.warn('layout for attribute "'+t+'" not present in buffer layout'),null}(t,n);if(!a)return null;const c=function(e){const[t,n]=r[e],i="i32"===t||"u32"===t,o="u32"!==t,a=s[t]*n,l=function(e,t){let n;switch(e){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?n:n+"x"+t}(t,n);return{dataType:t,components:n,defaultVertexFormat:l,byteLength:a,integer:i,signed:o}}(a.type),h=(null==l?void 0:l.vertexFormat)||c.defaultVertexFormat,_=(0,o.w)(h);return{attributeName:(null==l?void 0:l.attributeName)||a.name,bufferName:(null==l?void 0:l.bufferName)||a.name,location:a.location,shaderType:a.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:h,bufferDataType:_.type,bufferComponents:_.components,normalized:_.normalized,integer:c.integer,stepMode:(null==l?void 0:l.stepMode)||a.stepMode,byteOffset:(null==l?void 0:l.byteOffset)||0,byteStride:(null==l?void 0:l.byteStride)||0}}function u(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&i.R.warn("BufferLayout "+name+" must have either 'attributes' or 'format' field")}function h(e,t){const n={...e,attributes:e.attributes.map((e=>({...e})))};for(const r of(null==t?void 0:t.attributes)||[]){const e=n.attributes.find((e=>e.name===r.name));e?(e.type=r.type||e.type,e.stepMode=r.stepMode||e.stepMode):i.R.warn("shader layout attribute "+r.name+" not present in shader")}return n}},5056:(e,t,n)=>{n.d(t,{h:()=>s});var i=n(7862);let r;r=Symbol.toStringTag;class s extends i.F{get[r](){return"Buffer"}constructor(e,t){const n={...t};(t.usage||0)&s.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),super(e,n,s.defaultProps),this.debugData=new ArrayBuffer(0),this.usage=t.usage||0,this.indexType=n.indexType}readSyncWebGL(e,t){throw new Error("not implemented")}_setDebugData(e,t,n){const i=ArrayBuffer.isView(e)?e.buffer:e,r=Math.min(e?e.byteLength:n,s.DEBUG_DATA_MAX_LENGTH);null===e?this.debugData=new ArrayBuffer(r):0===t&&n===e.byteLength?this.debugData=i.slice(0,r):this.debugData=i.slice(t,t+r)}}s.defaultProps={...i.F.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1},s.MAP_READ=1,s.MAP_WRITE=2,s.COPY_SRC=4,s.COPY_DST=8,s.INDEX=16,s.VERTEX=32,s.UNIFORM=64,s.STORAGE=128,s.INDIRECT=256,s.QUERY_RESOLVE=512,s.DEBUG_DATA_MAX_LENGTH=32},3145:(e,t,n)=>{n.d(t,{r:()=>s});var i=n(7862);let r;r=Symbol.toStringTag;class s extends i.F{get[r](){return"RenderPipeline"}constructor(e,t){super(e,t,s.defaultProps),this.hash="",this.linkStatus="pending",this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}}s.defaultProps={...i.F.defaultProps,vs:null,vsEntryPoint:"",vsConstants:{},fs:null,fsEntryPoint:"",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}}},7862:(e,t,n)=>{n.d(t,{F:()=>r});var i=n(469);class r{constructor(e,t,n){if(this.userData={},this.destroyed=!1,this.allocatedBytes=0,this._attachedResources=new Set,!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const i in e)void 0!==e[i]&&(n[i]=e[i]);return n}(t,n);const r="undefined"!==this.props.id?this.props.id:(0,i.L)(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return(this[Symbol.toStringTag]||this.constructor.name)+"("+this.id+")"}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(t+"s Active").decrementCount()}trackAllocatedMemory(e,t){void 0===t&&(t=this[Symbol.toStringTag]);const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(t+" Memory").addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e){void 0===e&&(e=this[Symbol.toStringTag]);const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(e+" Memory").subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(t+"s Created").incrementCount(),e.get(t+"s Active").incrementCount()}}r.defaultProps={id:"undefined",handle:void 0,userData:void 0}},5787:(e,t,n)=>{function i(e){const t=function(e){const t=s[e];return t}(r[e]),n=e.includes("norm"),i=!n&&!e.startsWith("float"),o=e.startsWith("s");return{dataType:r[e],byteLength:t,integer:i,signed:o,normalized:n}}n.d(t,{l:()=>i});const r={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},s={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4}},1970:(e,t,n)=>{n.d(t,{w:()=>r});var i=n(5787);function r(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,r]=e.split("x"),s=n,o=r?parseInt(r):1,a=(0,i.l)(s),l={type:s,components:o,byteLength:a.byteLength*o,integer:a.integer,signed:a.signed,normalized:a.normalized};return t&&(l.webglOnly=!0),l}},7590:(e,t,n)=>{n.d(t,{l:()=>r});var i=n(4390);function r(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach((n=>{const r=e[n];var s;s=r,null!==(0,i.p)(s)||"number"==typeof s||"boolean"==typeof s?t.uniforms[n]=r:t.bindings[n]=r})),t}},1649:(e,t,n)=>{let i;function r(e){return(!i||i.byteLength<e)&&(i=new ArrayBuffer(e)),i}function s(e,t){return new e(r(e.BYTES_PER_ELEMENT*t),0,t)}function o(e){const{target:t,source:n,start:i=0,count:r=1}=e,s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)t[l++]=n[a];for(;a<o;)a<o-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+o-a),a=o);return e.target}n.d(t,{R2:()=>o,oF:()=>s,oK:()=>r})},4468:(e,t,n)=>{function i(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}n.d(t,{v:()=>i})},4390:(e,t,n)=>{function i(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]?e:null:function(e){return!ArrayBuffer.isView(e)||e instanceof DataView?null:e}(e)}n.d(t,{p:()=>i})},4789:(e,t,n)=>{n.d(t,{Dt:()=>s,Qj:()=>r,k0:()=>a,yt:()=>o});let i="";function r(e){i=e}async function s(e,t){const n=new Image;return n.crossOrigin=(null==t?void 0:t.crossOrigin)||"anonymous",n.src=e.startsWith("http")?e:i+e,await n.decode(),await createImageBitmap(n)}async function o(e,t){return new Promise(((n,r)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>r(new Error("Could not load image "+e+".")),s.crossOrigin=(null==t?void 0:t.crossOrigin)||"anonymous",s.src=e.startsWith("http")?e:i+e}catch(s){r(s)}}))}async function a(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),t&&(i.id=t),new Promise(((t,r)=>{i.onload=t,i.onerror=t=>r(new Error("Unable to load script '"+e+"': "+t)),n.appendChild(i)}))}},3522:(e,t,n)=>{n.d(t,{R:()=>i});const i=new(n(1369).t)({id:"luma.gl"})},469:(e,t,n)=>{n.d(t,{L:()=>r,Z:()=>s});const i={};function r(e){void 0===e&&(e="id"),i[e]=i[e]||1;return e+"-"+i[e]++}function s(e){let t=!0;for(const n in e){t=!1;break}return t}},3101:(e,t,n)=>{n.d(t,{BA:()=>i.BA,Gk:()=>i.Gk,HH:()=>i.HH,Jh:()=>i.Jh,LL:()=>i.LL,MV:()=>i.MV,PZ:()=>i.PZ,QQ:()=>i.QQ,Xb:()=>i.Xb,YE:()=>i.YE,Z5:()=>i.Z5,ZM:()=>i.ZM,_j:()=>i._j,gl:()=>i.gl,rq:()=>i.rq,y3:()=>i.y3,yt:()=>i.yt,zW:()=>i.zW,zk:()=>i.zk});var i=n(66)},66:(e,t,n)=>{n.d(t,{PZ:()=>ts,gl:()=>ns,MV:()=>os,zW:()=>as,Jh:()=>ls,zk:()=>ps,y3:()=>Es,Gk:()=>cs,LL:()=>rs,BA:()=>us,_j:()=>ss,QQ:()=>gs,YE:()=>hs,ZM:()=>_s,Z5:()=>is,Xb:()=>ms,rq:()=>fs,yt:()=>ds,HH:()=>As});var i=n(6540),r=n(357);const s=e=>""+e;var o=n(5056),a=n(4390);class l{constructor(e){if(this.uniforms={},this.modifiedUniforms={},this.modified=!0,this.bindingLayout={},this.needsRedraw="initialized",this.name=null==e?void 0:e.name,null!=e&&e.name&&null!=e&&e.shaderLayout){var t;const n=null==e||null==(t=e.shaderLayout.bindings)?void 0:t.find((t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name)));if(!n)throw new Error(null==e?void 0:e.name);const i=n;for(const e of i.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(this.name+"."+t+"="+n)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t,n){if(void 0===n&&(n=16),e!==t)return!1;const i=(0,a.p)(e);if(!i)return!1;const r=(0,a.p)(t);if(r&&i.length===r.length)for(let s=0;s<i.length;++s)if(r[s]!==i[s])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){const t=(0,a.p)(e);return t?t.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}var c=n(4468);const u={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function h(e){const t=u[e];return(0,c.v)(e),t}function _(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}var d=n(1649),f=n(3522);class p{constructor(e){this.layout={};let t=0;for(const[i,r]of Object.entries(e)){const e=h(r),{type:n,components:s}=e;t=_(t,s);const o=t;t+=s,this.layout[i]={type:n,size:s,offset:o}}t+=(4-t%4)%4;const n=4*t;this.byteLength=Math.max(n,1024)}getData(e){const t=Math.max(this.byteLength,1024),n=(0,d.oK)(t),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[r,s]of Object.entries(e)){const e=this.layout[r];if(!e){f.R.warn("Supplied uniform value "+r+" not present in uniform block layout")();continue}const{type:t,size:n,offset:o}=e,l=i[t];if(1===n){if("number"!=typeof s&&"boolean"!=typeof s){f.R.warn("Supplied value for single component uniform "+r+" is not a number: "+s)();continue}l[o]=Number(s)}else{const e=(0,a.p)(s);if(!e){f.R.warn("Supplied value for multi component / array uniform "+r+" is not a numeric array: "+s)();continue}l.set(e,o)}}return new Uint8Array(n)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class E{constructor(e){this.uniformBlocks=new Map,this.uniformBufferLayouts=new Map,this.uniformBuffers=new Map;for(const[t,n]of Object.entries(e)){const e=t,i=new p(n.uniformTypes||{});this.uniformBufferLayouts.set(e,i);const r=new l({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of Object.values(this.uniformBuffers))e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return r.write(s),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&f.R.log(3,"UniformStore.updateUniformBuffers(): "+e)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=!1;if(this.uniformBuffers.get(e)&&t.needsRedraw){n||(n=t.needsRedraw);const i=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(i);const r=this.uniformBlocks.get(e).getAllUniforms();f.R.log(4,"Writing to uniform buffer "+String(e),i,r)()}return n}}class g{constructor(e){}async onInitialize(e){return null}}let m=1,A=1;class R{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,s=m++,o={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:e,channel:t}=i;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=A++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}class T{constructor(e){this.startIndex=-1,this.endIndex=-1,this.factor=0,this.times=[],this.values=[],this._lastTime=-1,this.setKeyFrames(e),this.setTime(0)}setKeyFrames(e){const t=e.length;this.times.length=t,this.values.length=t;for(let n=0;n<t;++n)this.times[n]=e[n][0],this.values[n]=e[n][1];this._calculateKeys(this._lastTime)}setTime(e){(e=Math.max(0,e))!==this._lastTime&&(this._calculateKeys(e),this._lastTime=e)}getStartTime(){return this.times[this.startIndex]}getEndTime(){return this.times[this.endIndex]}getStartData(){return this.values[this.startIndex]}getEndData(){return this.values[this.endIndex]}_calculateKeys(e){let t=0;const n=this.times.length;for(t=0;t<n-2&&!(this.times[t+1]>e);++t);this.startIndex=t,this.endIndex=t+1;const i=this.times[this.startIndex],r=this.times[this.endIndex];this.factor=Math.min(Math.max(0,(e-i)/(r-i)),1)}}function L(e,t,n){if(!t||t>4)throw new Error("size "+t);const i=t;let r=function(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}(e);if("uint8"===r||"sint8"===r){if(1===i||3===i)throw new Error("size: "+t);return n&&(r=r.replace("int","norm")),r+"x"+i}if("uint16"===r||"sint16"===r){if(1===i||3===i)throw new Error("size: "+t);return n&&(r=r.replace("int","norm")),r+"x"+i}return 1===i?r:r+"x"+i}var v=n(3145),S=n(469);function C(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!C(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i){if(!t.hasOwnProperty(s))return!1;if(!C(e[s],t[s],n-1))return!1}return!0}return!1}var b,N,G,I,y,w=n(7590),F=n(9282);class M{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class P{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}}class O extends P{constructor(){super()}}class x extends O{constructor(e,t,n,i){super(),this.name=e,this.args=t,this.returnType=n,this.body=i}get astNodeType(){return"function"}}class B extends O{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class D extends O{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}}class U extends O{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class k extends O{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}}class H extends O{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"var"}}class V extends O{constructor(e,t,n){super(),this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}}class X extends O{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"let"}}class W extends O{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}!function(e){e.increment="++",e.decrement="--"}(b||(b={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}}(b||(b={}));class K extends O{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}}!function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="}(N||(N={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for AssignOperator");return e[n]}}(N||(N={}));class z extends O{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}}class Y extends O{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}}class j extends O{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class Z extends O{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}}class q extends O{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}}class Q extends O{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class J extends O{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class $ extends O{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class ee extends O{constructor(){super()}get astNodeType(){return"discard"}}class te extends O{constructor(){super()}get astNodeType(){return"break"}}class ne extends O{constructor(){super()}get astNodeType(){return"continue"}}class ie extends O{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class re extends ie{constructor(e,t){super(e),this.members=t}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class se extends ie{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}}class oe extends ie{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class ae extends ie{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class le extends ie{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class ce extends P{constructor(){super()}}class ue extends ce{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class he extends ce{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}}class _e extends ce{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return 180*this.args[0].evaluate(e)/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class de extends ce{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class fe extends ce{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,n;if(this.initializer instanceof he){const i=null===(t=this.postfix)||void 0===t?void 0:t.evaluateString(e),r=null===(n=this.initializer.type)||void 0===n?void 0:n.name,s=e.structs.get(r),o=null==s?void 0:s.getMemberIndex(i);if(-1!=o){return this.initializer.args[o].evaluate(e)}console.log(o)}return this.initializer.evaluate(e)}}class pe extends ce{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Ee extends ce{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}}class ge extends ce{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class me extends ce{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class Ae extends ce{constructor(){super()}}class Re extends Ae{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class Te extends Ae{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error("Unknown operator "+this.operator)}}}class Le extends P{constructor(){super()}}class ve extends Le{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}}class Se extends Le{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class Ce extends P{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class be extends P{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}}class Ne extends P{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Ge extends P{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}!function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"}(I||(I={}));class Ie{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class ye{}G=ye,ye.none=new Ie("",I.reserved,""),ye.eof=new Ie("EOF",I.token,""),ye.reserved={asm:new Ie("asm",I.reserved,"asm"),bf16:new Ie("bf16",I.reserved,"bf16"),do:new Ie("do",I.reserved,"do"),enum:new Ie("enum",I.reserved,"enum"),f16:new Ie("f16",I.reserved,"f16"),f64:new Ie("f64",I.reserved,"f64"),handle:new Ie("handle",I.reserved,"handle"),i8:new Ie("i8",I.reserved,"i8"),i16:new Ie("i16",I.reserved,"i16"),i64:new Ie("i64",I.reserved,"i64"),mat:new Ie("mat",I.reserved,"mat"),premerge:new Ie("premerge",I.reserved,"premerge"),regardless:new Ie("regardless",I.reserved,"regardless"),typedef:new Ie("typedef",I.reserved,"typedef"),u8:new Ie("u8",I.reserved,"u8"),u16:new Ie("u16",I.reserved,"u16"),u64:new Ie("u64",I.reserved,"u64"),unless:new Ie("unless",I.reserved,"unless"),using:new Ie("using",I.reserved,"using"),vec:new Ie("vec",I.reserved,"vec"),void:new Ie("void",I.reserved,"void")},ye.keywords={array:new Ie("array",I.keyword,"array"),atomic:new Ie("atomic",I.keyword,"atomic"),bool:new Ie("bool",I.keyword,"bool"),f32:new Ie("f32",I.keyword,"f32"),i32:new Ie("i32",I.keyword,"i32"),mat2x2:new Ie("mat2x2",I.keyword,"mat2x2"),mat2x3:new Ie("mat2x3",I.keyword,"mat2x3"),mat2x4:new Ie("mat2x4",I.keyword,"mat2x4"),mat3x2:new Ie("mat3x2",I.keyword,"mat3x2"),mat3x3:new Ie("mat3x3",I.keyword,"mat3x3"),mat3x4:new Ie("mat3x4",I.keyword,"mat3x4"),mat4x2:new Ie("mat4x2",I.keyword,"mat4x2"),mat4x3:new Ie("mat4x3",I.keyword,"mat4x3"),mat4x4:new Ie("mat4x4",I.keyword,"mat4x4"),ptr:new Ie("ptr",I.keyword,"ptr"),sampler:new Ie("sampler",I.keyword,"sampler"),sampler_comparison:new Ie("sampler_comparison",I.keyword,"sampler_comparison"),struct:new Ie("struct",I.keyword,"struct"),texture_1d:new Ie("texture_1d",I.keyword,"texture_1d"),texture_2d:new Ie("texture_2d",I.keyword,"texture_2d"),texture_2d_array:new Ie("texture_2d_array",I.keyword,"texture_2d_array"),texture_3d:new Ie("texture_3d",I.keyword,"texture_3d"),texture_cube:new Ie("texture_cube",I.keyword,"texture_cube"),texture_cube_array:new Ie("texture_cube_array",I.keyword,"texture_cube_array"),texture_multisampled_2d:new Ie("texture_multisampled_2d",I.keyword,"texture_multisampled_2d"),texture_storage_1d:new Ie("texture_storage_1d",I.keyword,"texture_storage_1d"),texture_storage_2d:new Ie("texture_storage_2d",I.keyword,"texture_storage_2d"),texture_storage_2d_array:new Ie("texture_storage_2d_array",I.keyword,"texture_storage_2d_array"),texture_storage_3d:new Ie("texture_storage_3d",I.keyword,"texture_storage_3d"),texture_depth_2d:new Ie("texture_depth_2d",I.keyword,"texture_depth_2d"),texture_depth_2d_array:new Ie("texture_depth_2d_array",I.keyword,"texture_depth_2d_array"),texture_depth_cube:new Ie("texture_depth_cube",I.keyword,"texture_depth_cube"),texture_depth_cube_array:new Ie("texture_depth_cube_array",I.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Ie("texture_depth_multisampled_2d",I.keyword,"texture_depth_multisampled_2d"),texture_external:new Ie("texture_external",I.keyword,"texture_external"),u32:new Ie("u32",I.keyword,"u32"),vec2:new Ie("vec2",I.keyword,"vec2"),vec3:new Ie("vec3",I.keyword,"vec3"),vec4:new Ie("vec4",I.keyword,"vec4"),bitcast:new Ie("bitcast",I.keyword,"bitcast"),block:new Ie("block",I.keyword,"block"),break:new Ie("break",I.keyword,"break"),case:new Ie("case",I.keyword,"case"),continue:new Ie("continue",I.keyword,"continue"),continuing:new Ie("continuing",I.keyword,"continuing"),default:new Ie("default",I.keyword,"default"),discard:new Ie("discard",I.keyword,"discard"),else:new Ie("else",I.keyword,"else"),enable:new Ie("enable",I.keyword,"enable"),fallthrough:new Ie("fallthrough",I.keyword,"fallthrough"),false:new Ie("false",I.keyword,"false"),fn:new Ie("fn",I.keyword,"fn"),for:new Ie("for",I.keyword,"for"),function:new Ie("function",I.keyword,"function"),if:new Ie("if",I.keyword,"if"),let:new Ie("let",I.keyword,"let"),const:new Ie("const",I.keyword,"const"),loop:new Ie("loop",I.keyword,"loop"),while:new Ie("while",I.keyword,"while"),private:new Ie("private",I.keyword,"private"),read:new Ie("read",I.keyword,"read"),read_write:new Ie("read_write",I.keyword,"read_write"),return:new Ie("return",I.keyword,"return"),storage:new Ie("storage",I.keyword,"storage"),switch:new Ie("switch",I.keyword,"switch"),true:new Ie("true",I.keyword,"true"),alias:new Ie("alias",I.keyword,"alias"),type:new Ie("type",I.keyword,"type"),uniform:new Ie("uniform",I.keyword,"uniform"),var:new Ie("var",I.keyword,"var"),override:new Ie("override",I.keyword,"override"),workgroup:new Ie("workgroup",I.keyword,"workgroup"),write:new Ie("write",I.keyword,"write"),r8unorm:new Ie("r8unorm",I.keyword,"r8unorm"),r8snorm:new Ie("r8snorm",I.keyword,"r8snorm"),r8uint:new Ie("r8uint",I.keyword,"r8uint"),r8sint:new Ie("r8sint",I.keyword,"r8sint"),r16uint:new Ie("r16uint",I.keyword,"r16uint"),r16sint:new Ie("r16sint",I.keyword,"r16sint"),r16float:new Ie("r16float",I.keyword,"r16float"),rg8unorm:new Ie("rg8unorm",I.keyword,"rg8unorm"),rg8snorm:new Ie("rg8snorm",I.keyword,"rg8snorm"),rg8uint:new Ie("rg8uint",I.keyword,"rg8uint"),rg8sint:new Ie("rg8sint",I.keyword,"rg8sint"),r32uint:new Ie("r32uint",I.keyword,"r32uint"),r32sint:new Ie("r32sint",I.keyword,"r32sint"),r32float:new Ie("r32float",I.keyword,"r32float"),rg16uint:new Ie("rg16uint",I.keyword,"rg16uint"),rg16sint:new Ie("rg16sint",I.keyword,"rg16sint"),rg16float:new Ie("rg16float",I.keyword,"rg16float"),rgba8unorm:new Ie("rgba8unorm",I.keyword,"rgba8unorm"),rgba8unorm_srgb:new Ie("rgba8unorm_srgb",I.keyword,"rgba8unorm_srgb"),rgba8snorm:new Ie("rgba8snorm",I.keyword,"rgba8snorm"),rgba8uint:new Ie("rgba8uint",I.keyword,"rgba8uint"),rgba8sint:new Ie("rgba8sint",I.keyword,"rgba8sint"),bgra8unorm:new Ie("bgra8unorm",I.keyword,"bgra8unorm"),bgra8unorm_srgb:new Ie("bgra8unorm_srgb",I.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Ie("rgb10a2unorm",I.keyword,"rgb10a2unorm"),rg11b10float:new Ie("rg11b10float",I.keyword,"rg11b10float"),rg32uint:new Ie("rg32uint",I.keyword,"rg32uint"),rg32sint:new Ie("rg32sint",I.keyword,"rg32sint"),rg32float:new Ie("rg32float",I.keyword,"rg32float"),rgba16uint:new Ie("rgba16uint",I.keyword,"rgba16uint"),rgba16sint:new Ie("rgba16sint",I.keyword,"rgba16sint"),rgba16float:new Ie("rgba16float",I.keyword,"rgba16float"),rgba32uint:new Ie("rgba32uint",I.keyword,"rgba32uint"),rgba32sint:new Ie("rgba32sint",I.keyword,"rgba32sint"),rgba32float:new Ie("rgba32float",I.keyword,"rgba32float"),static_assert:new Ie("static_assert",I.keyword,"static_assert")},ye.tokens={decimal_float_literal:new Ie("decimal_float_literal",I.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Ie("hex_float_literal",I.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Ie("int_literal",I.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Ie("uint_literal",I.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Ie("ident",I.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new Ie("and",I.token,"&"),and_and:new Ie("and_and",I.token,"&&"),arrow:new Ie("arrow ",I.token,"->"),attr:new Ie("attr",I.token,"@"),attr_left:new Ie("attr_left",I.token,"[["),attr_right:new Ie("attr_right",I.token,"]]"),forward_slash:new Ie("forward_slash",I.token,"/"),bang:new Ie("bang",I.token,"!"),bracket_left:new Ie("bracket_left",I.token,"["),bracket_right:new Ie("bracket_right",I.token,"]"),brace_left:new Ie("brace_left",I.token,"{"),brace_right:new Ie("brace_right",I.token,"}"),colon:new Ie("colon",I.token,":"),comma:new Ie("comma",I.token,","),equal:new Ie("equal",I.token,"="),equal_equal:new Ie("equal_equal",I.token,"=="),not_equal:new Ie("not_equal",I.token,"!="),greater_than:new Ie("greater_than",I.token,">"),greater_than_equal:new Ie("greater_than_equal",I.token,">="),shift_right:new Ie("shift_right",I.token,">>"),less_than:new Ie("less_than",I.token,"<"),less_than_equal:new Ie("less_than_equal",I.token,"<="),shift_left:new Ie("shift_left",I.token,"<<"),modulo:new Ie("modulo",I.token,"%"),minus:new Ie("minus",I.token,"-"),minus_minus:new Ie("minus_minus",I.token,"--"),period:new Ie("period",I.token,"."),plus:new Ie("plus",I.token,"+"),plus_plus:new Ie("plus_plus",I.token,"++"),or:new Ie("or",I.token,"|"),or_or:new Ie("or_or",I.token,"||"),paren_left:new Ie("paren_left",I.token,"("),paren_right:new Ie("paren_right",I.token,")"),semicolon:new Ie("semicolon",I.token,";"),star:new Ie("star",I.token,"*"),tilde:new Ie("tilde",I.token,"~"),underscore:new Ie("underscore",I.token,"_"),xor:new Ie("xor",I.token,"^"),plus_equal:new Ie("plus_equal",I.token,"+="),minus_equal:new Ie("minus_equal",I.token,"-="),times_equal:new Ie("times_equal",I.token,"*="),division_equal:new Ie("division_equal",I.token,"/="),modulo_equal:new Ie("modulo_equal",I.token,"%="),and_equal:new Ie("and_equal",I.token,"&="),or_equal:new Ie("or_equal",I.token,"|="),xor_equal:new Ie("xor_equal",I.token,"^="),shift_right_equal:new Ie("shift_right_equal",I.token,">>="),shift_left_equal:new Ie("shift_left_equal",I.token,"<<=")},ye.storage_class=[G.keywords.function,G.keywords.private,G.keywords.workgroup,G.keywords.uniform,G.keywords.storage],ye.access_mode=[G.keywords.read,G.keywords.write,G.keywords.read_write],ye.sampler_type=[G.keywords.sampler,G.keywords.sampler_comparison],ye.sampled_texture_type=[G.keywords.texture_1d,G.keywords.texture_2d,G.keywords.texture_2d_array,G.keywords.texture_3d,G.keywords.texture_cube,G.keywords.texture_cube_array],ye.multisampled_texture_type=[G.keywords.texture_multisampled_2d],ye.storage_texture_type=[G.keywords.texture_storage_1d,G.keywords.texture_storage_2d,G.keywords.texture_storage_2d_array,G.keywords.texture_storage_3d],ye.depth_texture_type=[G.keywords.texture_depth_2d,G.keywords.texture_depth_2d_array,G.keywords.texture_depth_cube,G.keywords.texture_depth_cube_array,G.keywords.texture_depth_multisampled_2d],ye.texture_external_type=[G.keywords.texture_external],ye.any_texture_type=[...G.sampled_texture_type,...G.multisampled_texture_type,...G.storage_texture_type,...G.depth_texture_type,...G.texture_external_type],ye.texel_format=[G.keywords.r8unorm,G.keywords.r8snorm,G.keywords.r8uint,G.keywords.r8sint,G.keywords.r16uint,G.keywords.r16sint,G.keywords.r16float,G.keywords.rg8unorm,G.keywords.rg8snorm,G.keywords.rg8uint,G.keywords.rg8sint,G.keywords.r32uint,G.keywords.r32sint,G.keywords.r32float,G.keywords.rg16uint,G.keywords.rg16sint,G.keywords.rg16float,G.keywords.rgba8unorm,G.keywords.rgba8unorm_srgb,G.keywords.rgba8snorm,G.keywords.rgba8uint,G.keywords.rgba8sint,G.keywords.bgra8unorm,G.keywords.bgra8unorm_srgb,G.keywords.rgb10a2unorm,G.keywords.rg11b10float,G.keywords.rg32uint,G.keywords.rg32sint,G.keywords.rg32float,G.keywords.rgba16uint,G.keywords.rgba16sint,G.keywords.rgba16float,G.keywords.rgba32uint,G.keywords.rgba32sint,G.keywords.rgba32float],ye.const_literal=[G.tokens.int_literal,G.tokens.uint_literal,G.tokens.decimal_float_literal,G.tokens.hex_float_literal,G.keywords.true,G.keywords.false],ye.literal_or_ident=[G.tokens.ident,G.tokens.int_literal,G.tokens.uint_literal,G.tokens.decimal_float_literal,G.tokens.hex_float_literal],ye.element_count_expression=[G.tokens.int_literal,G.tokens.uint_literal,G.tokens.ident],ye.template_types=[G.keywords.vec2,G.keywords.vec3,G.keywords.vec4,G.keywords.mat2x2,G.keywords.mat2x3,G.keywords.mat2x4,G.keywords.mat3x2,G.keywords.mat3x3,G.keywords.mat3x4,G.keywords.mat4x2,G.keywords.mat4x3,G.keywords.mat4x4,G.keywords.atomic,G.keywords.bitcast,...G.any_texture_type],ye.attribute_name=[G.tokens.ident,G.keywords.block],ye.assignment_operators=[G.tokens.equal,G.tokens.plus_equal,G.tokens.minus_equal,G.tokens.times_equal,G.tokens.division_equal,G.tokens.modulo_equal,G.tokens.and_equal,G.tokens.or_equal,G.tokens.xor_equal,G.tokens.shift_right_equal,G.tokens.shift_left_equal],ye.increment_operators=[G.tokens.plus_plus,G.tokens.minus_minus];class we{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return-1!=ye.template_types.indexOf(this.type)}isArrayType(){return this.type==ye.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Fe{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw"Invalid syntax at line "+this._line;return this._tokens.push(new we(ye.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}let t=ye.none;for(;;){let n=this._findType(e);const i=this._peekAhead();if(">"==e&&(">"==i||"="==i)){let e=!1,t=this._tokens.length-1;for(let n=0;n<5&&t>=0;++n,--t)if(this._tokens[t].type===ye.tokens.less_than){t>0&&this._tokens[t-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(n),!0}if(n===ye.none){let i=e,r=0;const s=2;for(let e=0;e<s;++e)if(i+=this._peekAhead(e),n=this._findType(i),n!==ye.none){r=e;break}if(n===ye.none)return t!==ye.none&&(this._current--,this._addToken(t),!0);e=i,this._current+=r+1}if(t=n,this._isAtEnd())break;e+=this._advance()}return t!==ye.none&&(this._addToken(t),!0)}_findType(e){for(const t in ye.keywords){const n=ye.keywords[t];if(this._match(e,n.rule))return n}for(const t in ye.tokens){const n=ye.tokens[t];if(this._match(e,n.rule))return n}return ye.none}_match(e,t){if("string"==typeof t){if(t==e)return!0}else{const n=t.exec(e);if(n&&0==n.index&&n[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e){void 0===e&&(e=0);let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e){return void 0===e&&(e=0),e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new we(e,t,this._line))}}class Me{constructor(){this._tokens=[],this._current=0,this._context=new M}parse(e){this._initialize(e);let t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}return t}_initialize(e){if(e)if("string"==typeof e){const t=new Fe(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return console.error(e,t),{token:e,message:t,toString:function(){return""+t}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==ye.eof}_match(e){if(e instanceof Ie)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){let n=t.type;return-1!=e.indexOf(n)}return t.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._match(ye.keywords.alias)){const e=this._type_alias();return this._consume(ye.tokens.semicolon,"Expected ';'"),e}if(this._match(ye.keywords.enable)){const e=this._enable_directive();return this._consume(ye.tokens.semicolon,"Expected ';'"),e}const e=this._attribute();if(this._check(ye.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),t}if(this._check(ye.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),t}if(this._check(ye.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),t}if(this._check(ye.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(ye.tokens.semicolon,"Expected ';'."),t}if(this._check(ye.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),t}if(this._check(ye.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(ye.keywords.fn))return null;const e=this._consume(ye.tokens.ident,"Expected function name.").toString();this._consume(ye.tokens.paren_left,"Expected '(' for function arguments.");const t=[];if(!this._check(ye.tokens.paren_right))do{if(this._check(ye.tokens.paren_right))break;const e=this._attribute(),n=this._consume(ye.tokens.ident,"Expected argument name.").toString();this._consume(ye.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i,t.push(new Ce(n,r,e)))}while(this._match(ye.tokens.comma));this._consume(ye.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(ye.tokens.arrow)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}const i=this._compound_statement();return new x(e,t,n,i)}_compound_statement(){const e=[];for(this._consume(ye.tokens.brace_left,"Expected '{' for block.");!this._check(ye.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(ye.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(ye.tokens.semicolon)&&!this._isAtEnd(););if(this._check(ye.keywords.if))return this._if_statement();if(this._check(ye.keywords.switch))return this._switch_statement();if(this._check(ye.keywords.loop))return this._loop_statement();if(this._check(ye.keywords.for))return this._for_statement();if(this._check(ye.keywords.while))return this._while_statement();if(this._check(ye.keywords.continuing))return this._continuing_statement();if(this._check(ye.keywords.static_assert))return this._static_assert_statement();if(this._check(ye.tokens.brace_left))return this._compound_statement();let e=null;return e=this._check(ye.keywords.return)?this._return_statement():this._check([ye.keywords.var,ye.keywords.let,ye.keywords.const])?this._variable_statement():this._match(ye.keywords.discard)?new ee:this._match(ye.keywords.break)?new te:this._match(ye.keywords.continue)?new ne:this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),null!=e&&this._consume(ye.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(ye.keywords.static_assert))return null;let e=this._optional_paren_expression();return new B(e)}_while_statement(){if(!this._match(ye.keywords.while))return null;let e=this._optional_paren_expression();const t=this._compound_statement();return new D(e,t)}_continuing_statement(){if(!this._match(ye.keywords.continuing))return null;const e=this._compound_statement();return new U(e)}_for_statement(){if(!this._match(ye.keywords.for))return null;this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._check(ye.tokens.semicolon)?null:this._for_init();this._consume(ye.tokens.semicolon,"Expected ';'.");const t=this._check(ye.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(ye.tokens.semicolon,"Expected ';'.");const n=this._check(ye.tokens.paren_right)?null:this._for_increment();this._consume(ye.tokens.paren_right,"Expected ')'.");const i=this._compound_statement();return new k(e,t,n,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(ye.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(ye.tokens.equal)&&(t=this._short_circuit_or_expression()),new H(e.name,e.type,e.storage,e.access,t)}if(this._match(ye.keywords.let)){const e=this._consume(ye.tokens.ident,"Expected name for let.").toString();let t=null;if(this._match(ye.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(ye.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new X(e,t,null,null,n)}if(this._match(ye.keywords.const)){const e=this._consume(ye.tokens.ident,"Expected name for const.").toString();let t=null;if(this._match(ye.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(ye.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new W(e,t,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(ye.increment_operators))return this._current=e,null;const n=this._consume(ye.increment_operators,"Expected increment operator");return new K(n.type===ye.tokens.plus_plus?b.increment:b.decrement,t)}_assignment_statement(){let e=null;if(this._check(ye.tokens.brace_right))return null;let t=this._match(ye.tokens.underscore);if(t||(e=this._unary_expression()),!t&&null==e)return null;const n=this._consume(ye.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new z(N.parse(n.lexeme),e,i)}_func_call_statement(){if(!this._check(ye.tokens.ident))return null;const e=this._current,t=this._consume(ye.tokens.ident,"Expected function name."),n=this._argument_expression_list();return null===n?(this._current=e,null):new Y(t.lexeme,n)}_loop_statement(){if(!this._match(ye.keywords.loop))return null;this._consume(ye.tokens.brace_left,"Expected '{' for loop.");const e=[];let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.push(n);else e.push(t);t=this._statement()}let n=null;return this._match(ye.keywords.continuing)&&(n=this._compound_statement()),this._consume(ye.tokens.brace_right,"Expected '}' for loop."),new j(e,n)}_switch_statement(){if(!this._match(ye.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(ye.tokens.brace_left,"Expected '{' for switch.");const t=this._switch_body();if(null==t||0==t.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(ye.tokens.brace_right,"Expected '}' for switch."),new Z(e,t)}_switch_body(){const e=[];if(this._match(ye.keywords.case)){const t=this._case_selectors();this._match(ye.tokens.colon),this._consume(ye.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch case."),e.push(new ve(t,n))}if(this._match(ye.keywords.default)){this._match(ye.tokens.colon),this._consume(ye.tokens.brace_left,"Exected '{' for switch default.");const t=this._case_body();this._consume(ye.tokens.brace_right,"Exected '}' for switch default."),e.push(new Se(t))}if(this._check([ye.keywords.default,ye.keywords.case])){const t=this._switch_body();e.push(t[0])}return e}_case_selectors(){var e,t,n,i;const r=[null!==(t=null===(e=this._shift_expression())||void 0===e?void 0:e.evaluate(this._context).toString())&&void 0!==t?t:""];for(;this._match(ye.tokens.comma);)r.push(null!==(i=null===(n=this._shift_expression())||void 0===n?void 0:n.evaluate(this._context).toString())&&void 0!==i?i:"");return r}_case_body(){if(this._match(ye.keywords.fallthrough))return this._consume(ye.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(ye.keywords.if))return null;const e=this._optional_paren_expression(),t=this._compound_statement();let n=[];this._match_elseif()&&(n=this._elseif_statement(n));let i=null;return this._match(ye.keywords.else)&&(i=this._compound_statement()),new q(e,t,n,i)}_match_elseif(){return this._tokens[this._current].type===ye.keywords.else&&this._tokens[this._current+1].type===ye.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e){void 0===e&&(e=[]);const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(new be(t,n)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(ye.keywords.return))return null;const e=this._short_circuit_or_expression();return new Q(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(ye.tokens.or_or);)e=new Te(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(ye.tokens.and_and);)e=new Te(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(ye.tokens.or);)e=new Te(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(ye.tokens.xor);)e=new Te(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(ye.tokens.and);)e=new Te(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([ye.tokens.equal_equal,ye.tokens.not_equal])?new Te(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([ye.tokens.less_than,ye.tokens.greater_than,ye.tokens.less_than_equal,ye.tokens.greater_than_equal]);)e=new Te(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([ye.tokens.shift_left,ye.tokens.shift_right]);)e=new Te(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([ye.tokens.plus,ye.tokens.minus]);)e=new Te(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([ye.tokens.star,ye.tokens.forward_slash,ye.tokens.modulo]);)e=new Te(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([ye.tokens.minus,ye.tokens.bang,ye.tokens.tilde,ye.tokens.star,ye.tokens.and])?new Re(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(ye.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(ye.tokens.bracket_right,"Expected ']'.");const t=this._postfix_expression();return t&&(e.postfix=t),e}if(this._match(ye.tokens.period)){const e=this._consume(ye.tokens.ident,"Expected member name."),t=this._postfix_expression(),n=new ue(e.lexeme);return t&&(n.postfix=t),n}return null}_getStruct(e){if(this._context.aliases.has(e)){return this._context.aliases.get(e).type}if(this._context.structs.has(e)){return this._context.structs.get(e)}return null}_primary_expression(){if(this._match(ye.tokens.ident)){const e=this._previous().toString();if(this._check(ye.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getStruct(e);return null!=n?new he(n,t):new _e(e,t)}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return new fe(e,t.value)}return new de(e)}if(this._match(ye.const_literal))return new pe(parseFloat(this._previous().toString()));if(this._check(ye.tokens.paren_left))return this._paren_expression();if(this._match(ye.keywords.bitcast)){this._consume(ye.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(ye.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return new Ee(e,t)}const e=this._type_decl(),t=this._argument_expression_list();return new ge(e,t)}_argument_expression_list(){if(!this._match(ye.tokens.paren_left))return null;const e=[];do{if(this._check(ye.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(ye.tokens.comma));return this._consume(ye.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(ye.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(ye.tokens.paren_right),new me([e])}_paren_expression(){this._consume(ye.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(ye.tokens.paren_right,"Expected ')'."),new me([e])}_struct_decl(){if(!this._match(ye.keywords.struct))return null;const e=this._consume(ye.tokens.ident,"Expected name for struct.").toString();this._consume(ye.tokens.brace_left,"Expected '{' for struct body.");const t=[];for(;!this._check(ye.tokens.brace_right);){const e=this._attribute(),n=this._consume(ye.tokens.ident,"Expected variable name.").toString();this._consume(ye.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i),this._check(ye.tokens.brace_right)?this._match(ye.tokens.comma):this._consume(ye.tokens.comma,"Expected ',' for struct member."),t.push(new Ne(n,r,e))}this._consume(ye.tokens.brace_right,"Expected '}' after struct body.");const n=new re(e,t);return this._context.structs.set(e,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(ye.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(ye.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(ye.keywords.const))return null;const e=this._consume(ye.tokens.ident,"Expected variable name");let t=null;if(this._match(ye.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;if(this._match(ye.tokens.equal)){const e=this._short_circuit_or_expression();if(e instanceof he)n=e;else if(e instanceof fe&&e.initializer instanceof he)n=e.initializer;else try{const t=e.evaluate(this._context);n=new pe(t)}catch(G){n=e}}const i=new W(e.toString(),t,"","",n);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(ye.keywords.let))return null;const e=this._consume(ye.tokens.ident,"Expected variable name");let t=null;if(this._match(ye.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;return this._match(ye.tokens.equal)&&(n=this._const_expression()),new X(e.toString(),t,"","",n)}_const_expression(){if(this._match(ye.const_literal))return new ue(this._previous().toString());const e=this._type_decl();this._consume(ye.tokens.paren_left,"Expected '('.");let t=[];for(;!this._check(ye.tokens.paren_right)&&(t.push(this._const_expression()),this._check(ye.tokens.comma));)this._advance();return this._consume(ye.tokens.paren_right,"Expected ')'."),new he(e,t)}_variable_decl(){if(!this._match(ye.keywords.var))return null;let e="",t="";this._match(ye.tokens.less_than)&&(e=this._consume(ye.storage_class,"Expected storage_class.").toString(),this._match(ye.tokens.comma)&&(t=this._consume(ye.access_mode,"Expected access_mode.").toString()),this._consume(ye.tokens.greater_than,"Expected '>'."));const n=this._consume(ye.tokens.ident,"Expected variable name");let i=null;if(this._match(ye.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}return new H(n.toString(),i,e,t,null)}_override_decl(){if(!this._match(ye.keywords.override))return null;const e=this._consume(ye.tokens.ident,"Expected variable name");let t=null;if(this._match(ye.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return new V(e.toString(),t,null)}_enable_directive(){const e=this._consume(ye.tokens.ident,"identity expected.");return new J(e.toString())}_type_alias(){const e=this._consume(ye.tokens.ident,"identity expected.");this._consume(ye.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=new $(e.toString(),t);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([ye.tokens.ident,...ye.texel_format,ye.keywords.bool,ye.keywords.f32,ye.keywords.i32,ye.keywords.u32])){const e=this._advance(),t=e.toString();return this._context.structs.has(t)?this._context.structs.get(t):this._context.aliases.has(t)?this._context.aliases.get(t).type:new ie(e.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(ye.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(ye.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(ye.tokens.comma)&&(n=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for type.")),new se(e,t,n)}if(this._match(ye.keywords.ptr)){let e=this._previous().toString();this._consume(ye.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(ye.storage_class,"Expected storage_class for pointer");this._consume(ye.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(ye.tokens.comma)&&(i=this._consume(ye.access_mode,"Expected access_mode for pointer").toString()),this._consume(ye.tokens.greater_than,"Expected '>' for pointer."),new oe(e,t.toString(),n,i)}const t=this._attribute();if(this._match(ye.keywords.array)){let e=null,n=-1;const i=this._previous();if(this._match(ye.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(ye.tokens.comma)){t=this._shift_expression().evaluate(this._context).toString()}this._consume(ye.tokens.greater_than,"Expected '>' for array."),n=t?parseInt(t):0}return new ae(i.toString(),t,e,n)}return null}_texture_sampler_types(){if(this._match(ye.sampler_type))return new le(this._previous().toString(),null,null);if(this._match(ye.depth_texture_type))return new le(this._previous().toString(),null,null);if(this._match(ye.sampled_texture_type)||this._match(ye.multisampled_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),new le(e.toString(),t,null)}if(this._match(ye.storage_texture_type)){const e=this._previous();this._consume(ye.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(ye.texel_format,"Invalid texel format.").toString();this._consume(ye.tokens.comma,"Expected ',' after texel format.");const n=this._consume(ye.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(ye.tokens.greater_than,"Expected '>' for sampler type."),new le(e.toString(),t,n)}return null}_attribute(){let e=[];for(;this._match(ye.tokens.attr);){const t=this._consume(ye.attribute_name,"Expected attribute name"),n=new Ge(t.toString(),null);if(this._match(ye.tokens.paren_left)){if(n.value=this._consume(ye.literal_or_ident,"Expected attribute value").toString(),this._check(ye.tokens.comma)){this._advance();do{const e=this._consume(ye.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(ye.tokens.comma))}this._consume(ye.tokens.paren_right,"Expected ')'")}e.push(n)}for(;this._match(ye.tokens.attr_left);){if(!this._check(ye.tokens.attr_right))do{const t=this._consume(ye.attribute_name,"Expected attribute name"),n=new Ge(t.toString(),null);if(this._match(ye.tokens.paren_left)){if(n.value=[this._consume(ye.literal_or_ident,"Expected attribute value").toString()],this._check(ye.tokens.comma)){this._advance();do{const e=this._consume(ye.literal_or_ident,"Expected attribute value").toString();n.value.push(e)}while(this._match(ye.tokens.comma))}this._consume(ye.tokens.paren_right,"Expected ')'")}e.push(n)}while(this._match(ye.tokens.comma));this._consume(ye.tokens.attr_right,"Expected ']]' after attribute declarations")}return 0==e.length?null:e}}class Pe{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Oe{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class xe extends Pe{constructor(e,t){super(e,t),this.members=[],this.align=0}get isStruct(){return!0}}class Be extends Pe{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class De extends Pe{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}}!function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"}(y||(y={}));class Ue{constructor(e,t,n,i,r,s,o){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=r,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ke{constructor(e,t){this.name=e,this.type=t}}class He{constructor(e,t){this.align=e,this.size=t}}class Ve{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class Xe{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class We{constructor(e,t){void 0===t&&(t=null),this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=t}}class Ke{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class ze{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class Ye{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Ke,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}update(e){const t=(new Me).parse(e);for(const n of t)if(n instanceof re){const e=this._getTypeInfo(n,null);e instanceof xe&&this.structs.push(e)}else if(n instanceof $)this.aliases.push(this._getAliasInfo(n));else if(n instanceof V){const e=n,t=this._getAttributeNum(e.attributes,"id",0),i=null!=e.type?this._getTypeInfo(e.type,e.attributes):null;this.overrides.push(new ze(e.name,i,e.attributes,t))}else if(this._isUniformVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=new Ue(e.name,r,t,i,e.attributes,y.Uniform,e.access);this.uniforms.push(s)}else if(this._isStorageVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new Ue(e.name,r,t,i,e.attributes,s?y.StorageTexture:y.Storage,e.access);this.storage.push(o)}else if(this._isTextureVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new Ue(e.name,r,t,i,e.attributes,s?y.StorageTexture:y.Texture,e.access);s?this.storage.push(o):this.textures.push(o)}else if(this._isSamplerVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=new Ue(e.name,r,t,i,e.attributes,y.Sampler,e.access);this.samplers.push(s)}else if(n instanceof x){const e=this._getAttribute(n,"vertex"),t=this._getAttribute(n,"fragment"),i=this._getAttribute(n,"compute"),r=e||t||i;if(r){const e=new We(n.name,r.name);e.inputs=this._getInputs(n.args),e.outputs=this._getOutputs(n.returnType),this.entry[r.name].push(e)}}else;}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.storage){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.textures){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.samplers){t(n.group,n.binding);e[n.group][n.binding]=n}return e}_getOutputs(e,t){if(void 0===t&&(t=void 0),void 0===t&&(t=[]),e instanceof re)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof re)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this._getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),s=new Xe(n.name,i,e.name,r);t.push(s)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Xe("",n,t.name,i)}return null}_getInputs(e,t){void 0===t&&(t=void 0),void 0===t&&(t=[]);for(const n of e)if(n.type instanceof re)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof re)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),s=new Ve(e.name,i,t.name,r);return null!==n&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new ke(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof ae){const n=e,i=this._getTypeInfo(n.format,n.attributes),r=new Be(n.name,t);return r.format=i,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof re){const n=e,i=new xe(n.name,t);for(const e of n.members){const t=this._getTypeInfo(e.type,e.attributes);i.members.push(new Oe(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof le){const n=e,i=n.format instanceof ie,r=n.format?i?this._getTypeInfo(n.format,null):new Pe(n.format,null):null,s=new De(n.name,r,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof se){const n=e,i=n.format?this._getTypeInfo(n.format,null):null,r=new De(n.name,i,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new Pe(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n;const i=this._getTypeSize(e);if(e.size=null!==(t=null==i?void 0:i.size)&&void 0!==t?t:0,e instanceof Be){const t=this._getTypeSize(e.format);e.stride=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,this._updateTypeInfo(e.format)}e instanceof xe&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,r=0,s=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+i),i=u,r=n,s=Math.max(s,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(s,r+i),e.align=s}_getTypeSize(e){var t;if(null==e)return null;const n=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Oe&&(e=e.type),e instanceof Pe){const t=this._getAlias(e.name);null!==t&&(e=t)}{const t=Ye._typeInfo[e.name];if(void 0!==t){const r="f16"===e.format?2:1;return new He(Math.max(i,t.align/r),Math.max(n,t.size/r))}}{const t=Ye._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const r="h"===e.name[e.name.length-1]?2:1;return new He(Math.max(i,t.align/r),Math.max(n,t.size/r))}}if(e instanceof Be){let r=e,s=8,o=8;const a=this._getTypeSize(r.format);null!==a&&(o=a.size,s=a.align);return o=r.count*this._getAttributeNum(null!==(t=null==e?void 0:e.attributes)&&void 0!==t?t:null,"stride",this._roundUp(s,o)),n&&(o=n),new He(Math.max(i,s),Math.max(n,o))}if(e instanceof xe){let t=0,r=0,s=0,o=0,a=0;for(const n of e.members){const e=this._getTypeSize(n.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+o),o=e.size,a=s)}return r=this._roundUp(t,a+o),new He(Math.max(i,t),Math.max(n,r))}return null}_isUniformVar(e){return e instanceof H&&"uniform"==e.storage}_isStorageVar(e){return e instanceof H&&"storage"==e.storage}_isTextureVar(e){return e instanceof H&&null!==e.type&&-1!=Ye._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof H&&null!==e.type&&-1!=Ye._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let r of i)if(r.name==t)return r;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}function je(e){const t={attributes:[],bindings:[]},n=function(e){try{return new Ye(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&null!=t&&t.message&&(e+=": "+t.message+" "),"object"==typeof t&&null!=t&&t.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e);for(const s of n.uniforms){const e=[];for(const t of s.type.members)e.push({name:t.name,type:Ze(t.type)});t.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:e})}const i=n.entry.vertex[0],r=i.inputs.length;for(let s=0;s<r;s++){const e=i.inputs[s];if("location"===e.locationType){const n=Ze(e.type);t.attributes.push({name:e.name,location:e.location,type:n})}}return t}function Ze(e){return e.format?e.name+"<"+e.format.name+">":e.name}function qe(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}Ye._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ye._textureTypes=ye.any_texture_type.map((e=>e.name)),Ye._samplerTypes=ye.sampler_type.map((e=>e.name));const Qe={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Je(e){let t=$e(e);if("object"!==t)return{value:e,...Qe[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Qe[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=$e(e.value),{...e,...Qe[t],type:t}):{type:"object",value:null};throw new Error("props")}function $e(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const et=e=>""+e;var tt,nt;function it(e,t){return t||(t=e.slice(0)),e.raw=t,e}const rt={vertex:et(tt||(tt=it(["#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"],["\\\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"]))),fragment:et(nt||(nt=it(["#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"],["\\\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"])))},st=/void\s+main\s*\([^)]*\)\s*\{\n?/,ot=/}\n?[^{}]*$/,at=[],lt="__LUMA_INJECT_DECLARATIONS__";function ct(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function ut(e,t,n,i){void 0===i&&(i=!1);const r="vertex"===t;for(const s in n){const t=n[s];t.sort(((e,t)=>e.order-t.order)),at.length=t.length;for(let e=0,n=t.length;e<n;++e)at[e]=t[e].injection;const i=at.join("\n")+"\n";switch(s){case"vs:#decl":r&&(e=e.replace(lt,i));break;case"vs:#main-start":r&&(e=e.replace(st,(e=>e+i)));break;case"vs:#main-end":r&&(e=e.replace(ot,(e=>i+e)));break;case"fs:#decl":r||(e=e.replace(lt,i));break;case"fs:#main-start":r||(e=e.replace(st,(e=>e+i)));break;case"fs:#main-end":r||(e=e.replace(ot,(e=>i+e)));break;default:e=e.replace(s,(e=>e+i))}}return e=e.replace(lt,""),i&&(e=e.replace(/\}\s*$/,(e=>e+rt[t]))),e}let ht=1;class _t{static instantiateModules(e){return e.map((e=>{if(e instanceof _t)return e;qe("string"!=typeof e,"Shader module use by name is deprecated. Import shader module '"+JSON.stringify(e)+"' and use it directly."),e.name||(console.warn("shader module has no name"),e.name="shader-module-"+ht++);const t=new _t(e);return t.dependencies=_t.instantiateModules(e.dependencies||[]),t}))}constructor(e){this.uniforms={},this.uniformTypes={};const{name:t,vs:n,fs:i,dependencies:r=[],uniformPropTypes:s={},getUniforms:o,deprecations:a=[],defines:l={},inject:c={}}=e;qe("string"==typeof t),this.name=t,this.vs=n,this.fs=i,this.getModuleUniforms=o,this.dependencies=_t.instantiateModules(r),this.deprecations=this._parseDeprecationDefinitions(a),this.defines=l,this.injections=function(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"==typeof i&&(i={order:0,injection:i}),t[ct(n)][n]=i}return t}(c),s&&(this.uniforms=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=Je(i);return t}(s))}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:qe(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return"// ----- MODULE "+this.name+" ---------------\n\n#define MODULE_"+n+"\n"+t+"\n\n"}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):function(e,t,n){const i={};for(const[r,s]of Object.entries(t))e&&r in e&&!s.private?(s.validate&&qe(s.validate(e[r],s),n+": invalid "+r),i[r]=e[r]):i[r]=s.value;return i}(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach((n=>{var i;null!=(i=n.regex)&&i.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(e){return e.forEach((e=>{if("function"===e.type)e.regex=new RegExp("\\b"+e.old+"\\(");else e.regex=new RegExp(e.type+" "+e.old+";")})),e}_defaultGetUniforms(e){void 0===e&&(e={});const t={},n=this.uniforms;for(const i in n){const r=n[i];i in e&&!r.private?(r.validate&&qe(r.validate(e[i],r),this.name+": invalid "+i),t[i]=e[i]):t[i]=r.value}return t}}function dt(e){return ft(_t.instantiateModules(e))}function ft(e){const t={},n={};return pt({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]))}function pt(e){const{modules:t,level:n,moduleMap:i,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)i[s.name]=s,(void 0===r[s.name]||r[s.name]<n)&&(r[s.name]=n);for(const s of t)s.dependencies&&pt({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}var Et,gt,mt,At,Rt,Tt,Lt,vt,St,Ct;function bt(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Nt=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],Gt=[...Nt,[wt("attribute"),"in $1"],[wt("varying"),"out $1"]],It=[...Nt,[wt("varying"),"in $1"]];function yt(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function wt(e){return new RegExp("\\b"+e+"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)","g")}function Ft(e,t){let n="";for(const i in e){const r=e[i];if(n+="void "+r.signature+" {\n",r.header&&(n+="  "+r.header),t[i]){const e=t[i];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+="  "+t.injection+"\n"}r.footer&&(n+="  "+r.footer),n+="}\n"}return n}function Mt(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!=typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[r,s]=i.split(":"),o=i.replace(/\(.+/,""),a=Object.assign(e,{signature:s});switch(r){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(r)}}return t}function Pt(e,t){void 0===t&&(t="unnamed");const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function Ot(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error("Invalid GLSL version "+t);return t}var xt;const Bt="\n\n"+lt+"\n",Dt=et(xt||(Ut=["precision highp float;\n"],(kt=["\\\nprecision highp float;\n"])||(kt=Ut.slice(0)),Ut.raw=kt,xt=Ut));var Ut,kt;function Ht(e,t){const{source:n,stage:i,modules:r,hookFunctions:s=[],inject:o={},log:a}=t;qe("string"==typeof n,"shader source must be a string");const l=n;let c="";const u=Mt(s),h={},_={},d={};for(const p in o){const e="string"==typeof o[p]?{injection:o[p],order:0}:o[p],t=/^(v|f)s:(#)?([\w-]+)$/.exec(p);if(t){const n=t[2],i=t[3];n?"decl"===i?_[p]=[e]:d[p]=[e]:h[p]=[e]}else d[p]=[e]}const f="webgpu"!==e.type?r:[];for(const p of f){a&&p.checkDeprecations(l,a);c+=p.getModuleSource(i,"wgsl");const e=p.injections[i];for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?_:d;i[t]=i[t]||[],i[t].push(e[t])}else h[t]=h[t]||[],h[t].push(e[t])}}return c+=Bt,c=ut(c,i,_),c+=Ft(u[i],h),c+=l,c=ut(c,i,d),c}function Vt(e,t){const{id:n,source:i,stage:r,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;qe("string"==typeof i,"shader source must be a string");const _="glsl"===s?function(e,t){return{name:Pt(e,t),language:"glsl",version:Ot(e)}}(i).version:-1,d=e.shaderLanguageVersion,f=100===_?"#version 100":"#version 300 es",p=i.split("\n").slice(1).join("\n"),E={};o.forEach((e=>{Object.assign(E,e.getDefines())})),Object.assign(E,a);let g="";switch(s){case"wgsl":break;case"glsl":g=u?f+"\n\n// ----- PROLOGUE -------------------------\n"+function(e){const{id:t,source:n,stage:i}=e,r=t&&-1===n.indexOf("SHADER_NAME");return r?"\n#define SHADER_NAME "+t+"_"+i+"\n\n":""}({id:n,source:i,stage:r})+"\n#define SHADER_TYPE_"+r.toUpperCase()+"\n"+function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return et(Et||(Et=bt(["#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])));case"nvidia":return et(gt||(gt=bt(["#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n"],["\\\n#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n"])));case"intel":return et(mt||(mt=bt(["#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])));case"amd":return et(At||(At=bt(["#define AMD_GPU\n"],["\\\n#define AMD_GPU\n"])));default:return et(Rt||(Rt=bt(["#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])))}}(e)+"\n"+function(e){let t="";return e.features.has("webgl2")&&(t+=et(Tt||(Tt=bt(["# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n"],["\\\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n"])))),e.features.has("webgl2")||(e.features.has("glsl-frag-depth")&&(t+=et(Lt||(Lt=bt(["\n// FEATURE_GLSL_FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n# extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"],["\\\n\n// FEATURE_GLSL_FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n# extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"])))),null!=e&&e.features.has("glsl-derivatives")&&(t+=et(vt||(vt=bt(["\n// FEATURE_GLSL_DERIVATIVES => dxdF, dxdY and fwidth are available\n#if defined(GL_OES_standard_derivatives) || defined(FEATURE_GLSL_DERIVATIVES)\n# extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n#endif\n"],["\\\n\n// FEATURE_GLSL_DERIVATIVES => dxdF, dxdY and fwidth are available\n#if defined(GL_OES_standard_derivatives) || defined(FEATURE_GLSL_DERIVATIVES)\n# extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n#endif\n"])))),null!=e&&e.features.has("glsl-frag-data")&&(t+=et(St||(St=bt(["\n// FEATURE_GLSL_DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n# extension GL_EXT_draw_buffers : require\n# define FEATURE_GLSL_DRAW_BUFFERS\n#endif\n"],["\\\n\n// FEATURE_GLSL_DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n# extension GL_EXT_draw_buffers : require\n# define FEATURE_GLSL_DRAW_BUFFERS\n#endif\n"])))),null!=e&&e.features.has("glsl-texture-lod")&&(t+=et(Ct||(Ct=bt(["// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n# extension GL_EXT_shader_texture_lod : enable\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n#endif\n"],["\\\n// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n# extension GL_EXT_shader_texture_lod : enable\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n#endif\n"]))))),t}(e)+"\n"+("fragment"===r?Dt:"")+"\n\n// ----- APPLICATION DEFINES -------------------------\n\n"+function(e){void 0===e&&(e={});let t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+="#define "+n.toUpperCase()+" "+e[n]+"\n")}return t}(E)+"\n\n":f+"\n"}const m=Mt(l),A={},R={},T={};for(const L in c){const e="string"==typeof c[L]?{injection:c[L],order:0}:c[L],t=/^(v|f)s:(#)?([\w-]+)$/.exec(L);if(t){const n=t[2],i=t[3];n?"decl"===i?R[L]=[e]:T[L]=[e]:A[L]=[e]}else T[L]=[e]}for(const L of o){h&&L.checkDeprecations(p,h);g+=L.getModuleSource(r);const e=L.injections[r];for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?R:T;i[t]=i[t]||[],i[t].push(e[t])}else A[t]=A[t]||[],A[t].push(e[t])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=Bt,g=ut(g,r,R),g+=Ft(m[r],A),g+=p,g=ut(g,r,T),"glsl"===s&&_!==d&&(g=function(e,t){var n;if(300!==Number((null==(n=e.match(/^#version[ \t]+(\d+)/m))?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return yt(e,Gt);case"fragment":return yt(e,It);default:throw new Error(t)}}(g,r)),g.trim()}function Xt(e){return function(t){const n={};for(const i of e){const e=i.getUniforms(t,n);Object.assign(n,e)}return n}}function Wt(e,t){if("string"==typeof t)return t;if("webgpu"===e.type){if(null!=t&&t.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders")}if(null!=t&&t.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}class Kt{constructor(){this._hookFunctions=[],this._defaultModules=[]}static getDefaultShaderAssembler(){return Kt.defaultShaderAssembler=Kt.defaultShaderAssembler||new Kt,Kt.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find((t=>t.name===("string"==typeof e?e:e.name)))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t))}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShaders(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=function(e){if(!e.vs)throw new Error("no vertex shader");const t=Wt(e.platformInfo,e.vs);let n;return e.fs&&(n=Wt(e.platformInfo,e.fs)),{...e,vs:t,fs:n}}(e),r=function(e){const{vs:t,fs:n}=e,i=dt(e.modules||[]);switch(e.platformInfo.shaderLanguage){case"glsl":return{vs:Vt(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:Vt(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:Xt(i)};case"wgsl":return{vs:Ht(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:Ht(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:Xt(i)}}}({platformInfo:e.platformInfo,...i,modules:t,hookFunctions:n});return{...r,modules:t}}_getModuleList(e){void 0===e&&(e=[]);const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let r=0,s=this._defaultModules.length;r<s;++r){const e=this._defaultModules[r],s=e.name;t[i++]=e,n[s]=!0}for(let r=0,s=e.length;r<s;++r){const s=e[r],o=s.name;n[o]||(t[i++]=s,n[o]=!0)}return t.length=i,_t.instantiateModules(t)}}class zt{constructor(e){const t=dt(Object.values(e));f.R.log(1,"Creating ShaderInputs with modules",t.map((e=>e.name)))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,i]of Object.entries(e)){const e=n;this.moduleUniforms[e]=i.defaultUniforms||{},this.moduleBindings[e]={}}}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,i=e[n],r=this.modules[n];if(!r){f.R.warn("Module "+t+" not found")();continue}const s=this.moduleUniforms[n],o=(null==r.getUniforms?void 0:r.getUniforms(i,this.moduleUniforms[n]))||i;this.moduleUniforms[n]={...s,...o}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[r,s]of Object.entries(i)){var t;e[n+"."+r]={type:null==(t=this.modules[n].uniformTypes)?void 0:t[r],value:String(s)}}return e}}class Yt{constructor(e){this.userData={},this.bufferLayout=[],this.id=e.id||(0,S.L)("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&(0,c.v)(this.indices.usage===o.h.INDEX)}destroy(){var e;this.indices.destroy(),this.attributes.positions.destroy(),this.attributes.normals.destroy(),this.attributes.texCoords.destroy(),null==(e=this.attributes.colors)||e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function jt(e,t){if(t instanceof Yt)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:o.h.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:r}=function(e,t){const n=[],i={};for(const[s,o]of Object.entries(t.attributes)){let t=s;switch(s){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}i[t]=e.createBuffer({data:o.value,id:s+"-buffer"});const{value:r,size:a,normalized:l}=o;n.push({name:t,format:L(r,a,l)})}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}(e,t);return new Yt({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:i})}class Zt{static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new Zt(e),e._lumaData.defaultPipelineFactory}constructor(e){this._hashCounter=0,this._hashes={},this._useCounts={},this._pipelineCache={},this.device=e}createRenderPipeline(e){const t={...Zt.defaultProps,...e},n=this._hashRenderPipeline({...t});if(!this._pipelineCache[n]){const e=this.device.createRenderPipeline({...t});e.hash=n,this._pipelineCache[n]=e,this._useCounts[n]=0}return this._useCounts[n]++,this._pipelineCache[n]}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._pipelineCache[t].destroy(),delete this._pipelineCache[t],delete this._useCounts[t])}_hashRenderPipeline(e){const t=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout));if("webgpu"===this.device.info.type){const r=this._getHash(JSON.stringify(e.parameters));return t+"/"+n+"V-T"+e.topology+"P"+r+"BL"+i}return t+"/"+n+"V-BL"+i}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}Zt.defaultProps={...v.r.defaultProps};let qt=null,Qt=null;class Jt{constructor(e,t){var n,i,r;this.userData={},this.instanceCount=0,this.indexBuffer=null,this.bufferAttributes={},this.constantAttributes={},this.bindings={},this.uniforms={},this.transformFeedback=null,this._pipelineNeedsUpdate="newly created",this._attributeInfos={},this._gpuGeometry=null,this._lastLogTime=0,this._logOpen=!1,this._drawCount=0,this.props={...Jt.defaultProps,...t},t=this.props,this.id=t.id||(0,S.L)("model"),this.device=e,Object.assign(this.userData,t.userData);const s=Object.fromEntries((null==(n=this.props.modules)?void 0:n.map((e=>[e.name,e])))||[]);this.setShaderInputs(t.shaderInputs||new zt(s));const o="webgpu"===this.device.info.type;if(this.props.source){var a;if(o)(a=this.props).shaderLayout||(a.shaderLayout=je(this.props.source));this.props.fs=this.props.source,this.props.vs=this.props.source}var l;o&&"string"!=typeof this.props.vs&&((l=this.props).shaderLayout||(l.shaderLayout=je(this.props.vs.wgsl)));const c=function(e){return{type:e.info.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),u=((null==(i=this.props.modules)?void 0:i.length)>0?this.props.modules:null==(r=this.shaderInputs)?void 0:r.getModules())||[],{vs:h,fs:_,getUniforms:d}=this.props.shaderAssembler.assembleShaders({platformInfo:c,...this.props,modules:u});if(this.vs=h,this.fs=_,this._getModuleUniforms=d,this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&(this._gpuGeometry=this.setGeometry(t.geometry)),this.pipelineFactory=t.pipelineFactory||Zt.getDefaultPipelineFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),t.vertexCount&&this.setVertexCount(t.vertexCount),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.indices)throw new Error("Model.props.indices removed. Use props.indexBuffer");t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&(f.R.warn("Model.props.moduleSettings is deprecated. Use Model.shaderInputs.setProps()")(),this.updateModuleSettings(t.moduleSettings)),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this.pipelineFactory.release(this.pipeline),this._uniformStore.destroy()}predraw(){this.updateShaderInputs()}draw(e){this.predraw();try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings),this.pipeline.setUniforms(this.uniforms);const{indexBuffer:t}=this.vertexArray,n=t?t.byteLength/("uint32"===t.indexType?4:2):void 0;this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback})}finally{this._logDrawCallEnd()}this._logFramebuffer(e)}setGeometry(e){const t=e&&jt(this.device,e);return this.setTopology(t.topology||"triangle-list"),this.bufferLayout=$t(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t),t}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find((e=>e.name===n))||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices),this.setAttributes(e.attributes,"ignore-unknown"),this.setAttributes(t)}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?$t(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){C(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(e){this.vertexCount=e}setInstanceCount(e){this.instanceCount=e}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new E(this.shaderInputs.modules);for(const t of Object.keys(this.shaderInputs.modules)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[t+"Uniforms"]=e}}setShaderModuleProps(e){const t=this._getModuleUniforms(e),n=Object.keys(t).filter((e=>{const n=t[e];return!(0,a.p)(n)&&"number"!=typeof n&&"boolean"!=typeof n})),i={};for(const r of n)i[r]=t[r],delete t[r]}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues())}updateModuleSettings(e){f.R.warn("Model.updateModuleSettings is deprecated. Use Model.shaderInputs.setProps()")();const{bindings:t,uniforms:n}=(0,w.l)(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n)}setBindings(e){Object.assign(this.bindings,e)}setUniforms(e){this.pipeline.setUniforms(e),Object.assign(this.uniforms,e)}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e)}setTransformFeedback(e){this.transformFeedback=e}setAttributes(e,t){e.indices&&f.R.warn("Model:"+this.id+" setAttributes() - indexBuffer should be set using setIndexBuffer()")();for(const[n,i]of Object.entries(e)){const e=this.bufferLayout.find((e=>en(e).includes(n)));if(!e){f.R.warn("Model("+this.id+'): Missing layout for buffer "'+n+'".')();continue}const r=en(e);let s=!1;for(const t of r){const e=this._attributeInfos[t];e&&(this.vertexArray.setBuffer(e.location,i),s=!0)}s||"ignore-unknown"===t||f.R.warn("Model("+this.id+'): Ignoring buffer "'+i.id+'" for unknown attribute "'+n+'"')()}}setConstantAttributes(e){for(const[t,n]of Object.entries(e)){const e=this._attributeInfos[t];e?this.vertexArray.setConstant(e.location,n):f.R.warn('Model "'+this.id+': Ignoring constant supplied for unknown attribute "'+t+'"')()}}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate=this._pipelineNeedsUpdate||e}_updatePipeline(){if(this._pipelineNeedsUpdate){this.pipeline&&f.R.log(1,"Model "+this.id+': Recreating pipeline because "'+this._pipelineNeedsUpdate+'".')(),this._pipelineNeedsUpdate=!1;const e=this.device.createShader({id:this.id+"-vertex",stage:"vertex",source:this.vs}),t=this.fs?this.device.createShader({id:this.id+"-fragment",stage:"fragment",source:this.fs}):null;this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:e,fs:t}),this._attributeInfos=(0,F.PV)(this.pipeline.shaderLayout,this.bufferLayout)}return this.pipeline}_logDrawCallStart(){const e=f.R.level>3?0:1e4;f.R.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,f.R.group(2,">>> DRAWING MODEL "+this.id,{collapsed:f.R.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e,t){var n;const i={},r="Values";if(0===e.attributes.length&&(null==(n=e.varyings)||!n.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of e.attributes)s&&(i["in "+s.location+" "+s.name+": "+s.type]={[r]:s.stepMode||"vertex"});for(const s of e.varyings||[])i["out "+s.location+" "+s.name]={[r]:JSON.stringify(s.accessor)};return i}(this.pipeline.shaderLayout,this.id);f.R.table(2,e)();const t=this.shaderInputs.getDebugTable();for(const[i,r]of Object.entries(this.uniforms))t[i]={value:r};f.R.table(2,t)();const n=this._getAttributeDebugTable();f.R.table(2,this._attributeInfos)(),f.R.table(2,n)(),f.R.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=f.R.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&function(e,t){let{id:n,minimap:i,opaque:r,top:s="0",left:o="0",rgbaScale:a=1}=t;qt||(qt=document.createElement("canvas"),qt.id=n,qt.title=n,qt.style.zIndex="100",qt.style.position="absolute",qt.style.top=s,qt.style.left=o,qt.style.border="blue 1px solid",qt.style.transform="scaleY(-1)",document.body.appendChild(qt),Qt=qt.getContext("2d")),qt.width===e.width&&qt.height===e.height||(qt.width=e.width/2,qt.height=e.height/2,qt.style.width="400px",qt.style.height="400px");const l=e.device.readPixelsToArrayWebGL(e),c=Qt.createImageData(e.width,e.height);for(let u=0;u<l.length;u+=4)c.data[0+u+0]=l[u+0]*a,c.data[0+u+1]=l[u+1]*a,c.data[0+u+2]=l[u+2]*a,c.data[0+u+3]=r?255:l[u+3]*a;Qt.putImageData(c,0,0)}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos))e[n.location]={name:t,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=function(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}(t);return(e instanceof o.h?new n(e.debugData):e).toString()}}function $t(e,t){const n=[...e];for(const i of t){const e=n.findIndex((e=>e.name===i.name));e<0?n.push(i):n[e]=i}return n}function en(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map((e=>e.attribute)):[e.name]}Jt.defaultProps={...v.r.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,transformFeedback:void 0,shaderAssembler:Kt.getDefaultShaderAssembler()};class tn{constructor(e){this.userData={};const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||(0,S.L)("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[r,s]of Object.entries(t)){const e=ArrayBuffer.isView(s)?{value:s}:s;(0,c.v)(ArrayBuffer.isView(e.value),this._print(r)+": must be typed array or object with value as typed array"),"POSITION"!==r&&"positions"!==r||e.size||(e.size=3),"indices"===r?((0,c.v)(!this.indices),this.indices=e):this.attributes[r]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry "+this.id+" attribute "+e}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:e,size:t,constant:r}=i;!r&&e&&t>=1&&(n=Math.min(n,e.length/t))}return(0,c.v)(Number.isFinite(n)),n}}class nn extends tn{constructor(e){void 0===e&&(e={});const{id:t=(0,S.L)("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:t,topology:"triangle-list",indices:{size:1,value:rn},attributes:{...hn,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{..._n,...e.attributes}})}}const rn=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),sn=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),on=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),an=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),ln=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),cn=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),un=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),hn={POSITION:{size:3,value:sn},NORMAL:{size:3,value:on},TEXCOORD_0:{size:2,value:an}},_n={POSITION:{size:3,value:ln},TEXCOORD_0:{size:2,value:cn},COLOR_0:{size:3,value:un}};var dn,fn;function pn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const En={name:"dirlight",dependencies:[],vs:et(dn||(dn=pn(["out vec3 dirlight_vNormal;\n\nvoid dirlight_setNormal(vec3 normal) {\n  dirlight_vNormal = normalize(normal);\n}\n"],["\\\nout vec3 dirlight_vNormal;\n\nvoid dirlight_setNormal(vec3 normal) {\n  dirlight_vNormal = normalize(normal);\n}\n"]))),fs:et(fn||(fn=pn(["uniform dirlightUniforms {\n  vec3 lightDirection;\n} dirlight;\n\nin vec3 dirlight_vNormal;\n\n// Returns color attenuated by angle from light source\nvec4 dirlight_filterColor(vec4 color) {\n  float d = abs(dot(dirlight_vNormal, normalize(dirlight.lightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n"],["\\\nuniform dirlightUniforms {\n  vec3 lightDirection;\n} dirlight;\n\nin vec3 dirlight_vNormal;\n\n// Returns color attenuated by angle from light source\nvec4 dirlight_filterColor(vec4 color) {\n  float d = abs(dot(dirlight_vNormal, normalize(dirlight.lightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n"]))),uniformTypes:{lightDirection:"vec3<f32>"},defaultUniforms:{lightDirection:new Float32Array([1,1,2])},getUniforms:function(e){void 0===e&&(e=En.defaultUniforms);const t={};e.lightDirection&&(t.dirlight_uLightDirection=e.lightDirection);return t}};var gn=n(6213),mn=n(4901);function An(){let e=1,t=1;return()=>{return e=Math.sin(17.23*t),t=Math.cos(27.92*e),(n=1432.71*Math.abs(e*t))-Math.floor(n);var n}}An();var Rn,Tn;function Ln(e,t){return t||(t=e.slice(0)),e.raw=t,e}const vn=An(),Sn={uniformTypes:{uColor:"vec3<f32>",uModel:"mat4x4<f32>",uView:"mat4x4<f32>",uProjection:"mat4x4<f32>"}},Cn=s(Rn||(Rn=Ln(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform appUniforms {\n  vec3 uColor;\n  mat4 uModel;\n  mat4 uView;\n  mat4 uProjection;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(app.uModel * vec4(normals, 0.0));\n\n  // Set up data for modules\n  color = app.uColor;\n  dirlight_setNormal(normal);\n  gl_Position = app.uProjection * app.uView * app.uModel * vec4(positions, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform appUniforms {\n  vec3 uColor;\n  mat4 uModel;\n  mat4 uView;\n  mat4 uProjection;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(app.uModel * vec4(normals, 0.0));\n\n  // Set up data for modules\n  color = app.uColor;\n  dirlight_setNormal(normal);\n  gl_Position = app.uProjection * app.uView * app.uModel * vec4(positions, 1.0);\n}\n"]))),bn=s(Tn||(Tn=Ln(["#version 300 es\n\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n}\n"])));class Nn extends g{constructor(e){let{device:t,aspect:n,animationLoop:i}=e;super(),this.translations=[[2,-2,0],[2,2,0],[-2,2,0],[-2,-2,0]],this.rotations=[[vn(),vn(),vn()],[vn(),vn(),vn()],[vn(),vn(),vn()],[vn(),vn(),vn()]],this.colors=[[1,0,0],[0,1,0],[0,0,1],[1,1,0]],this.keyFrameData=[[0,0],[1e3,2*Math.PI],[2e3,Math.PI],[3e3,2*Math.PI],[4e3,0]],this.globalUniformStore=new E({dirlight:En});const r=document.getElementById("play"),s=document.getElementById("pause");this.timeSlider=document.getElementById("time"),r&&s&&(r.addEventListener("click",(()=>this.timeline.play())),s.addEventListener("click",(()=>this.timeline.pause())),this.timeSlider.addEventListener("input",(e=>this.timeline.setTime(parseFloat(e.target.value))))),this.timeline=new R,i.attachTimeline(this.timeline),this.timeline.play();const o=[this.timeline.addChannel({delay:2e3,rate:.5,duration:8e3,repeat:2}),this.timeline.addChannel({delay:1e4,rate:.2,duration:2e4,repeat:1}),this.timeline.addChannel({delay:7e3,rate:1,duration:4e3,repeat:8}),this.timeline.addChannel({delay:0,rate:.8,duration:5e3,repeat:Number.POSITIVE_INFINITY})];this.cubes=new Array(4);const a=[new T(this.keyFrameData),new T(this.keyFrameData),new T(this.keyFrameData),new T(this.keyFrameData)];for(let l=0;l<4;++l){this.timeline.attachAnimation(a[l],o[l]);const e=new E({app:Sn});e.setUniforms({app:{uProjection:(new gn.k).perspective({fovy:(0,mn.F2)(60),aspect:n,near:1,far:20}),uView:(new gn.k).lookAt({center:[0,0,0],eye:[0,0,-8]}),uColor:this.colors[l]}}),this.cubes[l]={uniformStore:e,translation:this.translations[l],rotation:this.rotations[l],keyFrames:a[l],model:new Jt(t,{id:"cube-"+l,vs:Cn,fs:bn,modules:[En],geometry:new nn,parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"},bindings:{app:e.getManagedUniformBuffer(t,"app"),dirlight:this.globalUniformStore.getManagedUniformBuffer(t,"dirlight")}})}}}onFinalize(){for(const e of this.cubes)e.model.destroy()}onRender(e){let{device:t}=e;this.timeSlider&&(this.timeSlider.value=this.timeline.getTime());const n=new gn.k;for(const r of this.cubes){const e=r.keyFrames.getStartData(),t=r.keyFrames.getEndData(),i=e+r.keyFrames.factor*(t-e),s=r.rotation[0]+i,o=r.rotation[1]+i,a=r.rotation[2];n.identity().translate(r.translation).rotateXYZ([s,o,a]),r.model.setUniforms({}),r.uniformStore.setUniforms({app:{uModel:n}}),r.uniformStore.updateUniformBuffers()}const i=t.beginRenderPass({clearColor:[0,0,0,1]});for(const r of this.cubes)r.model.draw(i);i.end()}}Nn.info='Key frame animation based on multiple hierarchical timelines.\n<button id="play">Play</button>\n<button id="pause">Pause</button><BR>\nTime: <input type="range" id="time" min="0" max="30000" step="1"><BR>\n';var Gn,In,yn,wn,Fn=n(4789),Mn=n(3369);function Pn(e,t){return t||(t=e.slice(0)),e.raw=t,e}class On extends Jt{constructor(e,t){const n=s(Gn||(Gn=Pn(["in vec3 positions;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = positions;\n}\n"],["\\\nin vec3 positions;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = positions;\n}\n"]))),i=s(In||(In=Pn(["precision highp float;\n\nuniform samplerCube uTextureCube;\nin vec3 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  // The outer cube just samples the texture cube directly\n  fragColor = textureCube(uTextureCube, normalize(vPosition));\n}\n"],["\\\nprecision highp float;\n\nuniform samplerCube uTextureCube;\nin vec3 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  // The outer cube just samples the texture cube directly\n  fragColor = textureCube(uTextureCube, normalize(vPosition));\n}\n"])));super(e,{...t,geometry:new nn,fs:i,vs:n})}}class xn extends Jt{constructor(e,t){const n=s(yn||(yn=Pn(["in vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = vec3(uModel * vec4(positions,1));\n  vNormal = vec3(uModel * vec4(normals, 0));\n  vUV = texCoords;\n}\n"],["\\\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = vec3(uModel * vec4(positions,1));\n  vNormal = vec3(uModel * vec4(normals, 0));\n  vUV = texCoords;\n}\n"]))),i=s(wn||(wn=Pn(["precision highp float;\n\nuniform sampler2D uTexture;\nuniform samplerCube uTextureCube;\nuniform vec3 uEyePosition;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nvoid main(void) {\n  vec4 color = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y));\n  vec3 reflectedDir = reflect(normalize(vPosition - uEyePosition), vNormal);\n  vec4 reflectedColor = textureCube(uTextureCube, reflectedDir);\n\n  gl_FragColor = color * reflectedColor;\n}\n"],["\\\nprecision highp float;\n\nuniform sampler2D uTexture;\nuniform samplerCube uTextureCube;\nuniform vec3 uEyePosition;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nvoid main(void) {\n  vec4 color = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y));\n  vec3 reflectedDir = reflect(normalize(vPosition - uEyePosition), vNormal);\n  vec4 reflectedColor = textureCube(uTextureCube, reflectedDir);\n\n  gl_FragColor = color * reflectedColor;\n}\n"])));super(e,{...t,geometry:new nn,vs:n,fs:i})}}class Bn extends g{constructor(e){let{device:t}=e;super();const n=t.createTexture({dimension:"cube",mipmaps:!0,data:{[Mn.GL.TEXTURE_CUBE_MAP_POSITIVE_X]:(0,Fn.yt)("sky-posx.png"),[Mn.GL.TEXTURE_CUBE_MAP_NEGATIVE_X]:(0,Fn.yt)("sky-negx.png"),[Mn.GL.TEXTURE_CUBE_MAP_POSITIVE_Y]:(0,Fn.yt)("sky-posy.png"),[Mn.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y]:(0,Fn.yt)("sky-negy.png"),[Mn.GL.TEXTURE_CUBE_MAP_POSITIVE_Z]:(0,Fn.yt)("sky-posz.png"),[Mn.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z]:(0,Fn.yt)("sky-negz.png")}}),i=t.createTexture({data:"vis-logo.png",mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}});this.cube=new On(t,{bindings:{uTextureCube:n},uniforms:{uModel:(new gn.k).scale([20,20,20])},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}}),this.prism=new xn(t,{bindings:{uTexture:i,uTextureCube:n},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.prism.destroy(),this.cube.destroy()}onRender(e){let{device:t,aspect:n,tick:i}=e;const r=[5,-3,5],s=(new gn.k).lookAt({eye:r}),o=(new gn.k).perspective({fovy:(0,mn.F2)(75),aspect:n}),a=t.beginRenderPass({clearColor:[0,0,0,1]});this.cube.setUniforms({uView:s,uProjection:o}),this.cube.draw(a),this.prism.setUniforms({uEyePosition:r,uView:s,uProjection:o,uModel:(new gn.k).rotateX(.01*i).rotateY(.013*i)}),this.prism.draw(a),a.end()}}function Dn(e,t,n){return e+n*(t-e)}function Un(e,t){for(var n=[],i=e;i<=t;i++)n.push(i);return n}function kn(e,t){for(var n,i=e.length,r=0;i;)n=Math.floor(t()*i),r=e[i-=1],e[i]=e[n],e[n]=r;return e}Bn.info="\n<p>\nUses a luma.gl <code>TextureCube</code> to simulate a reflective\nsurface\n</p>\n";var Hn,Vn,Xn=function(e){return e*e*e*(e*(6*e-15)+10)},Wn=function(e,t,n,i){var r=15&e,s=r<8?t:n,o=r<4?n:12==r||14==r?t:i;return(1&r?-s:s)+(2&r?-o:o)};function Kn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const zn=An(),Yn=s(Hn||(Hn=Kn(["#version 300 es\nin vec3 position;\n\nuniform mat4 uMVP;\n\nout vec3 vUV;\nvoid main() {\n  vUV = position.xyz + 0.5;\n  gl_Position = uMVP * vec4(position, 1.0);\n  gl_PointSize = 2.0;\n}"],["\\\n#version 300 es\nin vec3 position;\n\nuniform mat4 uMVP;\n\nout vec3 vUV;\nvoid main() {\n  vUV = position.xyz + 0.5;\n  gl_Position = uMVP * vec4(position, 1.0);\n  gl_PointSize = 2.0;\n}"]))),jn=s(Vn||(Vn=Kn(["#version 300 es\nprecision highp float;\nprecision lowp sampler3D;\nin vec3 vUV;\nuniform sampler3D uTexture;\nuniform float uTime;\nout vec4 fragColor;\nvoid main() {\n  float alpha = texture(uTexture, vUV + vec3(0.0, 0.0, uTime)).r * 0.1;\n  fragColor = vec4(fract(vUV) * alpha, alpha);\n}"],["\\\n#version 300 es\nprecision highp float;\nprecision lowp sampler3D;\nin vec3 vUV;\nuniform sampler3D uTexture;\nuniform float uTime;\nout vec4 fragColor;\nvoid main() {\n  float alpha = texture(uTexture, vUV + vec3(0.0, 0.0, uTime)).r * 0.1;\n  fragColor = vec4(fract(vUV) * alpha, alpha);\n}"])));class Zn extends g{constructor(e){let{device:t}=e;super(),this.mvpMat=new gn.k,this.viewMat=(new gn.k).lookAt({eye:[1,1,1]});const n=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("function"!=typeof e.interpolation)throw new TypeError("params.interpolation is not a function");if(!Array.isArray(e.permutation))throw new TypeError("params.permutation is not an array");if(256!=e.permutation.length)throw new Error("params.permutation must have 256 items");for(var t=e.interpolation,n=e.permutation.slice(0),i=0;i<256;i++)n[256+i]=n[i];return function(e,i,r){var s=Math.floor(e),o=Math.floor(i),a=Math.floor(r),l=255&s,c=255&o,u=255&a;i-=o,r-=a;var h=Xn(e-=s),_=Xn(i),d=Xn(r),f=n[l]+c,p=n[f]+u,E=n[f+1]+u,g=n[l+1]+c,m=n[g]+u,A=n[g+1]+u;return t(t(t(Wn(n[p],e,i,r),Wn(n[m],e-1,i,r),h),t(Wn(n[E],e,i-1,r),Wn(n[A],e-1,i-1,r),h),_),t(t(Wn(n[p+1],e,i,r-1),Wn(n[m+1],e-1,i,r-1),h),t(Wn(n[E+1],e,i-1,r-1),Wn(n[A+1],e-1,i-1,r-1),h),_),d)}}({interpolation:Dn,permutation:kn(Un(0,255),zn)}),i=128,r=.0078125,s=new Float32Array(6291456);let o=0,a=-.5;for(let f=0;f<i;++f){let e=-.5;for(let t=0;t<i;++t){let t=-.5;for(let n=0;n<i;++n)s[o++]=a,s[o++]=e,s[o++]=t,t+=r;e+=r}a+=r}const l=t.createBuffer(s),c=16,u=1.12,h=new Uint8Array(4096);let _=0;for(let f=0;f<c;++f)for(let e=0;e<c;++e)for(let t=0;t<c;++t)h[_++]=255*(.5+.5*n(f/u,e/u,t/u));const d=t.createTexture({dimension:"3d",width:c,height:c,depth:c,data:h,format:"r8unorm",mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}});this.cloud=new Jt(t,{vs:Yn,fs:jn,topology:"point-list",vertexCount:s.length/3,attributes:{position:l},bindings:{uTexture:d},uniforms:{uView:this.viewMat},parameters:{blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one-minus-src-alpha"}})}onFinalize(){this.cloud.destroy()}onRender(e){let{device:t,tick:n,aspect:i}=e;this.mvpMat.perspective({fovy:(0,mn.F2)(75),aspect:i,near:.1,far:10}).multiplyRight(this.viewMat);const r=t.beginRenderPass({clearColor:[0,0,0,1]});this.cloud.setUniforms({uTime:n/100,uMVP:this.mvpMat}),this.cloud.draw(r),r.end()}}var qn,Qn;function Jn(e,t){return t||(t=e.slice(0)),e.raw=t,e}Zn.info="\n<p>\nVolumetric 3D noise visualized using a <b>3D texture</b>.\n<p>\nUses the luma.gl <code>Texture3D</code> class.\n",Zn.props={useDevicePixels:!0};const $n=new Float32Array([0,1,1,1]),ei={name:"picking",vs:et(qn||(qn=Jn(["uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    // if (!bool(picking.isAttribute)) {\n    // Stores the picking color so that the fragment shader can render it during picking\n    picking_vRGBcolor_Avalid.rgb = pickingColor;\n    // }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n"],["\\\nuniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    // if (!bool(picking.isAttribute)) {\n    // Stores the picking color so that the fragment shader can render it during picking\n    picking_vRGBcolor_Avalid.rgb = pickingColor;\n    // }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n"]))),fs:et(Qn||(Qn=Jn(["uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n"],["\\\nuniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n"]))),uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:$n},getUniforms:function(e,t){void 0===e&&(e={});const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,(e=>e/255));Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute));void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors));return n}};var ti,ni;function ii(e,t){return t||(t=e.slice(0)),e.raw=t,e}const ri=An(),si=s(ti||(ti=ii(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nin vec2 instanceOffsets;\nin vec3 instanceColors;\nin vec2 instancePickingColors;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 viewMatrix;\n  mat4 projectionMatrix;\n  float time;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  color = instanceColors;\n\n  vec3 normal = vec3(app.modelMatrix * vec4(normals, 1.0));\n  dirlight_setNormal(normal);\n\n  vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  float delta = length(instanceOffsets);\n  vec4 offset = vec4(instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  gl_Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * vec4(positions * 1., 1.0) + offset);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nin vec2 instanceOffsets;\nin vec3 instanceColors;\nin vec2 instancePickingColors;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 viewMatrix;\n  mat4 projectionMatrix;\n  float time;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  color = instanceColors;\n\n  vec3 normal = vec3(app.modelMatrix * vec4(normals, 1.0));\n  dirlight_setNormal(normal);\n\n  vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  float delta = length(instanceOffsets);\n  vec4 offset = vec4(instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  gl_Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * vec4(positions * 1., 1.0) + offset);\n}\n"]))),oi=s(ni||(ni=ii(["#version 300 es\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n  fragColor = picking_filterColor(fragColor);\n}\n"],["\\\n#version 300 es\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n  fragColor = picking_filterColor(fragColor);\n}\n"]))),ai=256;class li extends Jt{constructor(e,t){const n=[];for(let c=0;c<ai;c++){const e=3*c-382.5;for(let t=0;t<ai;t++){const i=3*t-382.5;n.push(e,i)}}const i=new Float32Array(n),r=new Uint8Array(262144).map(((e,t)=>255*(.75*ri()+.25)));for(let c=0;c<r.length;c+=4)r[c+3]=255;const s=new Uint8Array(262144);for(let c=0;c<ai;c++)for(let e=0;e<ai;e++)s[2*(c*ai+e)+0]=c,s[2*(c*ai+e)+1]=e,s[2*(c*ai+e)+2]=0,s[2*(c*ai+e)+3]=0;const o=e.createBuffer(i),a=e.createBuffer(r),l=e.createBuffer(s);super(e,{...t,vs:{wgsl:"struct AppUniforms {\n  modelMatrix: mat4x4<f32>,\n  viewMatrix: mat4x4<f32>,\n  projectionMatrix: mat4x4<f32>,\n  time: f32,\n};\n\n@binding(0) @group(0) var<uniform> app : AppUniforms;\n\nstruct VertexInputs {\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) normals : vec3<f32>,\n  // INSTANCED ATTRIBUTES\n  @location(2) instanceOffsets : vec2<f32>,\n  @location(3) instanceColors : vec4<f32>,\n  @location(4) instancePickingColors : vec2<f32>,\n}\n\nstruct FragmentInputs {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) normal: vec3<f32>,\n  @location(1) color : vec4<f32>,\n}\n\n@vertex\nfn main(inputs: VertexInputs) -> FragmentInputs {\n  var outputs: FragmentInputs;\n\n  outputs.normal = (app.modelMatrix * vec4<f32>(inputs.normals, 0.0)).xyz;\n  outputs.color = inputs.instanceColors;\n\n  // vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  // picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  let delta = length(inputs.instanceOffsets);\n  let offset = vec4<f32>(inputs.instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  outputs.Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * inputs.positions + offset);\n  return outputs;\n}\n",glsl:si},fs:{wgsl:"\nstruct DirlightUniforms {\n  lightDirection: vec3<f32>,\n}\n\n// @binding(1) @group(0) var<uniform> dirlight : DirlightUniforms;\n\nfn dirlight_filterColor(color: vec4<f32>, normal: vec3<f32>) -> vec4<f32> {\n  const dirlight_lightDirection = vec3<f32>(1, 1, 2);\n  let d: f32 = abs(dot(normal, normalize(dirlight_lightDirection)));\n  return vec4<f32>(color.rgb * d, color.a);\n}\n\nstruct FragmentInputs {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) normal: vec3<f32>,\n  @location(1) color : vec4<f32>,\n}\n\n@fragment\nfn main(inputs: FragmentInputs) -> @location(0) vec4<f32> { \n  return dirlight_filterColor(inputs.color, inputs.normal); \n}\n",glsl:oi},modules:"webgpu"!==e.info.type?[En,ei]:[],instanceCount:65536,geometry:new nn({indices:!0}),bufferLayout:[{name:"instanceOffsets",format:"float32x2"},{name:"instanceColors",format:"unorm8x4"},{name:"instancePickingColors",format:"unorm8x4"}],attributes:{instanceOffsets:o,instanceColors:a,instancePickingColors:l},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}}const ci={uniformTypes:{modelMatrix:"mat4x4<f32>",viewMatrix:"mat4x4<f32>",projectionMatrix:"mat4x4<f32>",time:"f32"}};class ui extends g{constructor(e){let{device:t,animationLoop:n}=e;super(),this.shaderInputs=new zt({app:ci,dirlight:En,picking:ei}),this.timeline=new R,n.attachTimeline(this.timeline),this.timeline.play(),this.timelineChannels={timeChannel:this.timeline.addChannel({rate:.01}),eyeXChannel:this.timeline.addChannel({rate:3e-4}),eyeYChannel:this.timeline.addChannel({rate:4e-4}),eyeZChannel:this.timeline.addChannel({rate:2e-4})},"webgpu"!==t.info.type&&(this.pickingFramebuffer=t.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"})),this.cube=new li(t,{shaderInputs:this.shaderInputs})}onRender(e){const{device:t,aspect:n,tick:i}=e,{_mousePosition:r}=e,{timeChannel:s,eyeXChannel:o,eyeYChannel:a,eyeZChannel:l}=this.timelineChannels;this.shaderInputs.setProps({app:{time:this.timeline.getTime(s),projectionMatrix:(new gn.k).perspective({fovy:(0,mn.F2)(60),aspect:n,near:1,far:2048}),viewMatrix:(new gn.k).lookAt({center:[0,0,0],eye:[Math.cos(this.timeline.getTime(o))*ai/2,Math.sin(this.timeline.getTime(a))*ai/2,(Math.sin(this.timeline.getTime(l))+1)*ai/4+32]}),modelMatrix:(new gn.k).rotateX(.01*i).rotateY(.013*i)}}),"webgpu"!==t.info.type&&this.pickInstance(t,r,this.cube,this.pickingFramebuffer);const c=t.beginRenderPass({clearColor:[0,0,0,1],clearDepth:1,clearStencil:0});this.cube.draw(c),c.end()}onFinalize(e){this.cube.destroy()}pickInstance(e,t,n,i){if(!t)return void this.shaderInputs.setProps({picking:{highlightedObjectColor:null}});const r=e.canvasContext.cssToDevicePixels(t),s=r.x+Math.floor(r.width/2),o=r.y+Math.floor(r.height/2);i.resize(e.canvasContext.getPixelSize()),this.shaderInputs.setProps({picking:{isActive:!0}});const a=e.beginRenderPass({framebuffer:i,clearColor:[0,0,0,0],clearDepth:1});n.draw(a),a.end();const l=i.device.readPixelsToArrayWebGL(i,{sourceX:s,sourceY:o,sourceWidth:1,sourceHeight:1});let c=new Float32Array(l).map((e=>e/255));c[0]+c[1]+c[2]>0||(c=null),this.shaderInputs.setProps({picking:{isActive:!1,highlightedObjectColor:c}})}}ui.info="\n<p>\nCube drawn with <b>instanced rendering</b>.\n<p>\nA luma.gl <code>Cube</code>, rendering 65,536 instances in a\nsingle GPU draw call using instanced vertex attributes.\n",ui.props={createFramebuffer:!0,debug:!0};class hi extends tn{constructor(e){void 0===e&&(e={});const{id:t=(0,S.L)("sphere-geometry")}=e,{indices:n,attributes:i}=function(e){const{nlat:t=10,nlong:n=10}=e,i=0,r=Math.PI-i,s=0,o=2*Math.PI-s,a=(t+1)*(n+1),l=(t,n,i,r,s)=>e.radius||1,c=new Float32Array(3*a),u=new Float32Array(3*a),h=new Float32Array(2*a),_=new(a>65535?Uint32Array:Uint16Array)(t*n*6);for(let f=0;f<=t;f++)for(let e=0;e<=n;e++){const i=e/n,s=f/t,a=e+f*(n+1),_=2*a,d=3*a,p=o*i,E=r*s,g=Math.sin(p),m=Math.cos(p),A=Math.sin(E),R=m*A,T=Math.cos(E),L=g*A,v=l(R,T,L,i,s);c[d+0]=v*R,c[d+1]=v*T,c[d+2]=v*L,u[d+0]=R,u[d+1]=T,u[d+2]=L,h[_+0]=i,h[_+1]=1-s}const d=n+1;for(let f=0;f<n;f++)for(let e=0;e<t;e++){const n=6*(f*t+e);_[n+0]=e*d+f,_[n+1]=e*d+f+1,_[n+2]=(e+1)*d+f,_[n+3]=(e+1)*d+f,_[n+4]=e*d+f+1,_[n+5]=(e+1)*d+f+1}return{indices:{size:1,value:_},attributes:{POSITION:{size:3,value:c},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:h}}}}(e);super({...e,id:t,topology:"triangle-list",indices:n,attributes:{...i,...e.attributes}})}}var _i,di,fi,pi,Ei,gi=n(7909);function mi(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Ai={uniformTypes:{color:"vec3<f32>",lighting:"f32",modelViewMatrix:"mat4x4<f32>",projectionMatrix:"mat4x3<f32>"}},Ri=s(_i||(_i=mi(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform sphereUniforms {\n  // fragment shader\n  vec3 color;\n  bool lighting;\n  // vertex shader\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nout vec3 normal;\n\nvoid main(void) {\n  gl_Position = sphere.projectionMatrix * sphere.modelViewMatrix * vec4(positions, 1.0);\n  normal = vec3((sphere.modelViewMatrix * vec4(normals, 0.0)));\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform sphereUniforms {\n  // fragment shader\n  vec3 color;\n  bool lighting;\n  // vertex shader\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nout vec3 normal;\n\nvoid main(void) {\n  gl_Position = sphere.projectionMatrix * sphere.modelViewMatrix * vec4(positions, 1.0);\n  normal = vec3((sphere.modelViewMatrix * vec4(normals, 0.0)));\n}\n"]))),Ti=s(di||(di=mi(["#version 300 es\n\nprecision highp float;\n\nuniform sphereUniforms {\n  // fragment\n  vec3 color;\n  bool lighting;\n  // vertex\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nin vec3 normal;\nout vec4 fragColor;\n\nvoid main(void) {\n  float attenuation = 1.0;\n  if (sphere.lighting) {\n    vec3 light = normalize(vec3(1,1,2));\n    attenuation = dot(normal, light);\n  }\n  fragColor = vec4(sphere.color * attenuation, 1);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sphereUniforms {\n  // fragment\n  vec3 color;\n  bool lighting;\n  // vertex\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nin vec3 normal;\nout vec4 fragColor;\n\nvoid main(void) {\n  float attenuation = 1.0;\n  if (sphere.lighting) {\n    vec3 light = normalize(vec3(1,1,2));\n    attenuation = dot(normal, light);\n  }\n  fragColor = vec4(sphere.color * attenuation, 1);\n}\n"]))),Li={uniformTypes:{resolution:"vec2<f32>"}},vi=s(fi||(fi=mi(["#version 300 es\n\nin vec2 aPosition;\n\nvoid main(void) {\n  gl_Position = vec4(aPosition, 0, 1);\n}\n"],["\\\n#version 300 es\n\nin vec2 aPosition;\n\nvoid main(void) {\n  gl_Position = vec4(aPosition, 0, 1);\n}\n"]))),Si=s(pi||(pi=mi(["#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nuniform screenQuadUniforms {\n  vec2 resolution;\n} screenQuad;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy/screenQuad.resolution.xy;\n  fragColor = texture(uTexture, p);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nuniform screenQuadUniforms {\n  vec2 resolution;\n} screenQuad;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy/screenQuad.resolution.xy;\n  fragColor = texture(uTexture, p);\n}\n"]))),Ci={uniformTypes:{resolution:"vec2<f32>"}},bi=s(Ei||(Ei=mi(["#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uScene;\nuniform sampler2D uPersistence;\n\nuniform persistenceQuadUniforms {\n  vec2 resolution;\n} persistence;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy / persistence.resolution.xy;\n  vec4 cS = texture(uScene, p);\n  vec4 cP = texture(uPersistence, p);\n  fragColor = mix(cS*4.0, cP, 0.9);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uScene;\nuniform sampler2D uPersistence;\n\nuniform persistenceQuadUniforms {\n  vec2 resolution;\n} persistence;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy / persistence.resolution.xy;\n  vec4 cS = texture(uScene, p);\n  vec4 cP = texture(uPersistence, p);\n  fragColor = mix(cS*4.0, cP, 0.9);\n}\n"]))),Ni=An(),Gi=[],Ii=[],yi=[];class wi extends g{constructor(e){let{device:t,width:n,height:i}=e;super(),this.uniformStore=new E({sphere:Ai,screenQuad:Li,persistenceQuad:Ci}),this.electron=new Jt(t,{id:"electron",vs:Ri,fs:Ti,geometry:new hi({nlat:20,nlong:30}),bindings:{sphere:this.uniformStore.getManagedUniformBuffer(t,"sphere")},parameters:{depthWriteEnabled:!0,depthCompare:"less",cullMode:"back"}}),this.nucleon=new Jt(t,{id:"nucleon",vs:Ri,fs:Ti,geometry:new hi({nlat:20,nlong:30}),parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"},bindings:{sphere:this.uniformStore.getManagedUniformBuffer(t,"sphere")}}),this.mainFramebuffer=t.createFramebuffer({width:n,height:i,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"}),this.pingpongFramebuffers=[t.createFramebuffer({width:n,height:i,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"}),t.createFramebuffer({width:n,height:i,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"})];const r=new tn({topology:"triangle-list",attributes:{aPosition:{value:new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),size:2}},vertexCount:6});this.screenQuad=new Jt(t,{id:"quad",vs:vi,fs:Si,geometry:r,bindings:{screenQuad:this.uniformStore.getManagedUniformBuffer(t,"screenQuad")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"}}),this.persistenceQuad=new Jt(t,{id:"persistence-quad",vs:vi,fs:bi,geometry:r,bindings:{persistenceQuad:this.uniformStore.getManagedUniformBuffer(t,"persistenceQuad")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"}});for(let s=0;s<64;s++){const e=new gi.P(Ni()-.5,Ni()-.5,Ni()-.5),t=Ni()+1;e.normalize().scale(t);const n=1.25;e.scale(n),Gi.push(e);const i=new gi.P(Ni()-.5,Ni()-.5,Ni()-.5),r=e.clone().cross(i).normalize(),s=4/t*.0125,o=(new gn.k).rotateAxis(s,r);Ii.push(o)}for(let s=0;s<64;s++){let e=new gi.P(Ni()-.5,Ni()-.5,Ni()-.5);e=e.normalize().scale(.5),yi.push(e)}}onFinalize(e){this.electron.destroy(),this.nucleon.destroy(),this.mainFramebuffer.destroy(),this.pingpongFramebuffers[0].destroy(),this.pingpongFramebuffers[1].destroy(),this.screenQuad.destroy(),this.persistenceQuad.destroy()}onRender(e){let{device:t,tick:n,width:i,height:r,aspect:s}=e;this.mainFramebuffer.resize({width:i,height:r}),this.pingpongFramebuffers[0].resize({width:i,height:r}),this.pingpongFramebuffers[1].resize({width:i,height:r});const o=(new gn.k).perspective({fovy:(0,mn.F2)(75),aspect:s}),a=(new gn.k).lookAt({eye:[0,0,4]}),l=t.beginRenderPass({framebuffer:this.mainFramebuffer,clearColor:[0,0,0,1],clearDepth:1});this.uniformStore.setUniforms({sphere:{color:[0,.5,1],lighting:!1}});for(let f=0;f<64;f++){Gi[f]=Ii[f].transformVector(Gi[f]);const e=(new gn.k).translate(Gi[f]).scale([.06125,.06125,.06125]);this.uniformStore.setUniforms({sphere:{modelViewMatrix:a.clone().multiplyRight(e),projectionMatrix:o}}),this.uniformStore.updateUniformBuffers(),this.electron.draw(l)}this.uniformStore.setUniforms({sphere:{color:[1,.25,.25],lighting:!0}});for(let f=0;f<64;f++){const e=(new gn.k).rotateXYZ([.013*n,0,0]).rotateXYZ([0,.021*n,0]).translate(yi[f]),t=[e[12],e[13],e[14]];e.identity().translate(t).scale([.25,.25,.25]),this.uniformStore.setUniforms({sphere:{modelViewMatrix:a.clone().multiplyRight(e),projectionMatrix:o}}),this.uniformStore.updateUniformBuffers(),this.nucleon.draw(l)}l.end();const c=n%2,u=this.pingpongFramebuffers[c],h=this.pingpongFramebuffers[1-c],_=t.beginRenderPass({framebuffer:u,clearColor:[0,0,0,1]});this.persistenceQuad.setBindings({uScene:this.mainFramebuffer.colorAttachments[0],uPersistence:h.colorAttachments[0]}),this.uniformStore.setUniforms({persistenceQuad:{resolution:[i,r]}}),this.uniformStore.updateUniformBuffers(),this.persistenceQuad.draw(_),_.end();const d=t.beginRenderPass({clearColor:[1,0,0,1]});this.screenQuad.setBindings({uTexture:u.colorAttachments[0]}),this.uniformStore.setUniforms({screenQuad:{resolution:[i,r]}}),this.uniformStore.updateUniformBuffers(),this.screenQuad.draw(d),d.end()}}var Fi,Mi;function Pi(e,t){return t||(t=e.slice(0)),e.raw=t,e}wi.info="\n<p>\n  Electron trails renderings persist across multiple frames.\n<p>\n  Uses multiple luma.gl <code>Framebuffer</code>s to hold previously rendered data between frames.\n</p>\n";const Oi={uniformTypes:{mvpMatrix:"mat4x4<f32>"}},xi=s(Fi||(Fi=Pi(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 uMVP;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\n\nvoid main(void) {\n  gl_Position = app.uMVP * vec4(positions, 1.0);\n  fragUV = texCoords;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 uMVP;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\n\nvoid main(void) {\n  gl_Position = app.uMVP * vec4(positions, 1.0);\n  fragUV = texCoords;\n}\n"]))),Bi=s(Mi||(Mi=Pi(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main(void) {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main(void) {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));\n}\n"]))),Di=[0,0,5];class Ui extends g{constructor(e){let{device:t}=e;super(),this.mvpMatrix=new gn.k,this.viewMatrix=(new gn.k).lookAt({eye:Di}),this.uniformStore=new E({app:Oi});const n=t.createTexture({data:"vis-logo.png",mipmaps:!0,sampler:t.createSampler({minFilter:"linear",magFilter:"linear",mipmapFilter:"linear"})});this.model=new Jt(t,{vs:xi,fs:Bi,geometry:new nn({indices:!1}),bindings:{uTexture:n,app:this.uniformStore.getManagedUniformBuffer(t,"app")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.model.destroy(),this.uniformStore.destroy()}onRender(e){let{device:t,aspect:n,tick:i}=e;this.mvpMatrix.perspective({fovy:Math.PI/3,aspect:n}).multiplyRight(this.viewMatrix).rotateX(.01*i).rotateY(.013*i),this.uniformStore.setUniforms({app:{mvpMatrix:this.mvpMatrix}});const r=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(r),r.end()}}var ki,Hi,Vi,Xi;function Wi(e,t){return t||(t=e.slice(0)),e.raw=t,e}Ui.info="<p>\nDrawing a textured cube\n</p>\n";const Ki={name:"color",vs:s(ki||(ki=Wi(["out vec3 color_vColor;\n\nvoid color_setColor(vec3 color) {\n  color_vColor = color;\n}\n  "],["\\\nout vec3 color_vColor;\n\nvoid color_setColor(vec3 color) {\n  color_vColor = color;\n}\n  "]))),fs:s(Hi||(Hi=Wi(["in vec3 color_vColor;\n\nvec3 color_getColor() {\n  return color_vColor;\n}\n  "],["\\\nin vec3 color_vColor;\n\nvec3 color_getColor() {\n  return color_vColor;\n}\n  "])))};class zi extends g{constructor(e){let{device:t}=e;super(),this.positionBuffer=t.createBuffer(new Float32Array([-.2,-.2,.2,-.2,0,.2])),this.colorBuffer=t.createBuffer(new Float32Array([1,0,0,0,1,0,0,0,1,1,1,0])),this.offsetBuffer=t.createBuffer(new Float32Array([.5,.5,-.5,.5,.5,-.5,-.5,-.5])),this.model=new Jt(t,{vs:s(Vi||(Vi=Wi(["#version 300 es\nin vec2 position;\nin vec3 instanceColor;\nin vec2 instanceOffset;\n\nvoid main() {\n  color_setColor(instanceColor);\n  gl_Position = vec4(position + instanceOffset, 0.0, 1.0);\n}\n      "],["\\\n#version 300 es\nin vec2 position;\nin vec3 instanceColor;\nin vec2 instanceOffset;\n\nvoid main() {\n  color_setColor(instanceColor);\n  gl_Position = vec4(position + instanceOffset, 0.0, 1.0);\n}\n      "]))),fs:s(Xi||(Xi=Wi(["#version 300 es\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(color_getColor(), 1.0);\n}\n      "],["\\\n#version 300 es\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(color_getColor(), 1.0);\n}\n      "]))),modules:[Ki],bufferLayout:[{name:"position",format:"float32x2"},{name:"instanceColor",format:"float32x3",stepMode:"instance"},{name:"instanceOffset",format:"float32x2",stepMode:"instance"}],attributes:{position:this.positionBuffer,instanceColor:this.colorBuffer,instanceOffset:this.offsetBuffer},vertexCount:3,instanceCount:4})}onFinalize(){this.model.destroy(),this.positionBuffer.destroy(),this.colorBuffer.destroy(),this.offsetBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(n),n.end()}}var Yi;zi.info="\nInstanced triangles using luma.gl's high-level API\n";const ji=s(Yi||(Yi=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["#version 300 es\n\nin vec3 vColor;\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(vColor, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 vColor;\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(vColor, 1.0);\n}\n"])));class Zi extends g{constructor(e){let{device:t}=e;super();const n=new Float32Array([0,0,-.5,-.5,1,0,0,.5,-.5,0,1,0,0,.5,0,0,1]);this.interleavedBuffer=t.createBuffer(n),this.model=new Jt(t,{id:"triangle",vs:"#version 300 es\n\nin vec2 position;\nin vec3 color;\n\nout vec3 vColor;\n\nvoid main() {\n  vColor = color;\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n",fs:ji,bufferLayout:[{name:"vertexData",byteStride:20,attributes:[{attribute:"position",format:"float32x2",byteOffset:8},{attribute:"color",format:"float32x3",byteOffset:16}]}],attributes:{vertexData:this.interleavedBuffer},vertexCount:3})}onFinalize(){this.model.destroy(),this.interleavedBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(n),n.end()}}var qi;Zi.info="\nHave to start somewhere...\n";const Qi=et(qi||(qi=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int pointLightCount;\n  int directionalLightCount;\n\n  vec3 ambientColor;\n\n  int lightType;\n  vec3 lightColor;\n  vec3 lightDirection;\n  vec3 lightPosition;\n  vec3 lightAttenuation;\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n"],["\\\nprecision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int pointLightCount;\n  int directionalLightCount;\n\n  vec3 ambientColor;\n\n  int lightType;\n  vec3 lightColor;\n  vec3 lightDirection;\n  vec3 lightPosition;\n  vec3 lightAttenuation;\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n"]))),Ji=255;var $i=function(e){return e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL",e}($i||{});const er={name:"lighting",vs:Qi,fs:Qi,getUniforms:(e,t)=>function(e,t){void 0===t&&(t={});if(e=e?{...e}:e,!e)return{...er.defaultUniforms};e.lights&&(e={...e,...nr(e.lights),lights:void 0});const{ambientLight:n,pointLights:i,directionalLights:r}=e||{};if(!(n||i&&i.length>0||r&&r.length>0))return{...er.defaultUniforms,enabled:0};const s={...er.defaultUniforms,...t,...tr({ambientLight:n,pointLights:i,directionalLights:r})};void 0!==e.enabled&&(s.enabled=e.enabled?1:0);return s}(e),defines:{MAX_LIGHTS:5},uniformTypes:{enabled:"i32",ambientLightColor:"vec3<f32>",numberOfLights:"i32",lightType:"i32",lightColor:"vec3<f32>",lightPosition:"vec3<f32>",lightDirection:"vec3<f32>",lightAttenuation:"vec3<f32>"},defaultUniforms:{enabled:1,ambientLightColor:[.1,.1,.1],numberOfLights:0,lightType:$i.POINT,lightColor:[1,1,1],lightPosition:[1,1,2],lightDirection:[1,1,1],lightAttenuation:[1,1,1]}};function tr(e){let{ambientLight:t,pointLights:n=[],directionalLights:i=[]}=e;const r={};r.ambientLightColor=ir(t);let s=0;for(const o of n)r.lightType=$i.POINT,r.lightColor=ir(o),r.lightPosition=o.position,r.lightAttenuation=[o.attenuation||1,0,0],s++;for(const o of i)r.lightType=$i.DIRECTIONAL,r.lightColor=ir(o),r.lightPosition=o.position,r.lightDirection=o.direction,s++;return r.numberOfLights=s,r}function nr(e){var t,n;const i={pointLights:[],directionalLights:[]};for(const r of e||[])switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":null==(t=i.directionalLights)||t.push(r);break;case"point":null==(n=i.pointLights)||n.push(r)}return i}function ir(e){void 0===e&&(e={});const{color:t=[0,0,0],intensity:n=1}=e;return t.map((e=>e*n/Ji))}var rr,sr;function or(e,t){return t||(t=e.slice(0)),e.raw=t,e}const ar={name:"phong-lighting",vs:et(rr||(rr=or(["uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n"],["\\\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n"]))),fs:et(sr||(sr=or(["uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    PointLight pointLight = lighting_getPointLight(0);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0:\n        PointLight pointLight = lighting_getPointLight(0);\n        vec3 light_position_worldspace = pointLight.position;\n        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n        break;\n\n      case 1:\n        DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n        break;\n    }\n  }\n  return lightColor;\n}\n"],["\\\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    PointLight pointLight = lighting_getPointLight(0);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0:\n        PointLight pointLight = lighting_getPointLight(0);\n        vec3 light_position_worldspace = pointLight.position;\n        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n        break;\n\n      case 1:\n        DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n        break;\n    }\n  }\n  return lightColor;\n}\n"]))),defines:{LIGHTING_FRAGMENT:1},dependencies:[er],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms:e=>({...ar.defaultUniforms,...e})};var lr,cr;function ur(e,t){return t||(t=e.slice(0)),e.raw=t,e}const hr=s(lr||(lr=ur(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} app;\n\nvoid main(void) {\n  vPosition = (app.modelMatrix * vec4(positions, 1.0)).xyz;\n  vNormal = mat3(app.modelMatrix) * normals;\n  vUV = texCoords;\n  gl_Position = app.mvpMatrix * vec4(positions, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} app;\n\nvoid main(void) {\n  vPosition = (app.modelMatrix * vec4(positions, 1.0)).xyz;\n  vNormal = mat3(app.modelMatrix) * normals;\n  vUV = texCoords;\n  gl_Position = app.mvpMatrix * vec4(positions, 1.0);\n}\n"]))),_r=s(cr||(cr=ur(["#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nuniform sampler2D uTexture;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} uApp;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec3 surfaceColor = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n  surfaceColor = lighting_getLightColor(surfaceColor, uApp.eyePosition, vPosition, normalize(vNormal));\n\n  fragColor = vec4(surfaceColor, 1.0);\n}\n"],["\\\n#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nuniform sampler2D uTexture;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} uApp;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec3 surfaceColor = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n  surfaceColor = lighting_getLightColor(surfaceColor, uApp.eyePosition, vPosition, normalize(vNormal));\n\n  fragColor = vec4(surfaceColor, 1.0);\n}\n"]))),dr={name:"app",uniformTypes:{modelMatrix:"mat4x4<f32>",mvpMatrix:"mat4x4<f32>",eyePosition:"vec3<f32>"}},fr=[0,0,5];class pr extends g{constructor(e){let{device:t}=e;super(),this.shaderInputs=new zt({app:dr,lighting:er,phongMaterial:ar}),this.modelMatrix=new gn.k,this.viewMatrix=(new gn.k).lookAt({eye:fr}),this.mvpMatrix=new gn.k,this.shaderInputs.setProps({lighting:{lights:[{type:"ambient",color:[255,255,255]},{type:"point",color:[255,255,255],position:[1,2,1]}]},phongMaterial:{specularColor:[255,255,255]}});const n=t.createTexture({data:"vis-logo.png"});this.model=new Jt(t,{vs:hr,fs:_r,shaderInputs:this.shaderInputs,geometry:new nn,bindings:{uTexture:n},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.model.destroy()}onRender(e){let{device:t,aspect:n,tick:i}=e;this.modelMatrix.identity().rotateX(.01*i).rotateY(.013*i),this.mvpMatrix.perspective({fovy:Math.PI/3,aspect:n}).multiplyRight(this.viewMatrix).multiplyRight(this.modelMatrix),this.shaderInputs.setProps({app:{mvpMatrix:this.mvpMatrix,modelMatrix:this.modelMatrix}});const r=t.beginRenderPass({clearColor:[0,0,0,1],clearDepth:!0});this.model.draw(r),r.end()}}pr.info="\n<p>\nDrawing a phong-shaded cube\n</p>\n";const Er="#version 300 es\n\nin vec2 position;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  OFFSET_POSITION(gl_Position);\n}\n",gr="#version 300 es\n\nuniform appUniforms {  \n  vec3 color;\n} app;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(app.color, 1.0);\n}\n",mr={name:"offsetLeft",inject:{"vs:OFFSET_POSITION":"position.x -= 0.5;"}},Ar={name:"offsetRight",inject:{"vs:OFFSET_POSITION":"position.x += 0.5;"}};class Rr extends g{constructor(e){let{device:t}=e;super(),this.uniformStore=new E({app:{uniformTypes:{color:"vec3<f32>"}}});const n=Kt.getDefaultShaderAssembler();n.addShaderHook("vs:OFFSET_POSITION(inout vec4 position)"),this.positionBuffer=t.createBuffer(new Float32Array([-.3,-.5,.3,-.5,0,.5])),this.uniformBuffer1=this.uniformStore.createUniformBuffer(t,"app",{app:{color:[1,0,0]}});const i=this.uniformStore.getUniformBufferData("app");this.uniformBuffer1.write(i),this.uniformBuffer2=this.uniformStore.createUniformBuffer(t,"app",{app:{color:[0,0,1]}}),this.model1=new Jt(t,{vs:Er,fs:gr,shaderAssembler:n,modules:[mr],bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3,bindings:{app:this.uniformBuffer1}}),this.model2=new Jt(t,{vs:Er,fs:gr,shaderAssembler:n,modules:[Ar],bufferLayout:[{name:"position",format:"float32x2"}],vertexCount:3,attributes:{position:this.positionBuffer},bindings:{app:this.uniformBuffer2}})}onFinalize(){this.model1.destroy(),this.model2.destroy(),this.positionBuffer.destroy(),this.uniformStore.destroy(),this.uniformBuffer1.destroy(),this.uniformBuffer2.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model1.draw(n),this.model2.draw(n),n.end()}}Rr.info="\nModifying shader behavior with shader hooks\n";const Tr={name:"color",fs:"\nvec3 color_hsv2rgb(vec3 hsv) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(hsv.xxx + K.xyz) * 6.0 - K.www);\n  vec3 rgb = hsv.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), hsv.y);\n  return rgb;\n}\n  ",uniformTypes:{hsv:"vec3<f32>"}};class Lr extends g{constructor(e){let{device:t}=e;super(),this.shaderInputs1=new zt({color:Tr}),this.shaderInputs2=new zt({color:Tr}),this.positionBuffer=t.createBuffer(new Float32Array([-.3,-.5,.3,-.5,0,.5])),this.shaderInputs1.setProps({color:{hsv:[.7,1,1]}}),this.shaderInputs2.setProps({color:{hsv:[1,1,1]}}),this.model1=new Jt(t,{vs:"#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position - vec2(0.5, 0.0), 0.0, 1.0);\n}\n",fs:"#version 300 es\nprecision highp float;\n\nuniform colorUniforms {\n  vec3 hsv;\n} color;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(color_hsv2rgb(color.hsv), 1.0);\n}\n",shaderInputs:this.shaderInputs1,bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3}),this.model2=new Jt(t,{vs:"#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position + vec2(0.5, 0.0), 0.0, 1.0);\n}\n",fs:"#version 300 es\n\nprecision highp float;\n\nuniform colorUniforms {\n  vec3 hsv;\n} color;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(color_hsv2rgb(color.hsv) - 0.3, 1.0);\n}\n",shaderInputs:this.shaderInputs2,bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3})}onFinalize(){this.model1.destroy(),this.model2.destroy(),this.positionBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model1.draw(n),this.model2.draw(n),n.end()}}var vr,Sr;function Cr(e,t){return t||(t=e.slice(0)),e.raw=t,e}Lr.info="\nRe-using shader code with shader modules\n";const br={vs:{glsl:s(vr||(vr=Cr(["#version 300 es\nconst vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\nvoid main() {\n  gl_Position = vec4(pos[gl_VertexID], 0.0, 1.0);\n}\n"],["\\\n#version 300 es\nconst vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\nvoid main() {\n  gl_Position = vec4(pos[gl_VertexID], 0.0, 1.0);\n}\n"]))),wgsl:"@vertex\nfn main(@builtin(vertex_index) VertexIndex : u32) -> @builtin(position) vec4<f32> {\n  var pos = array<vec2<f32>, 3>(\n    vec2(0.0, 0.5),\n    vec2(-0.5, -0.5),\n    vec2(0.5, -0.5)\n  );\n\n  return vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n}\n"},fs:{glsl:s(Sr||(Sr=Cr(["#version 300 es\nprecision highp float;\nlayout(location = 0) out vec4 outColor;\nvoid main() {\n    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n"],["\\\n#version 300 es\nprecision highp float;\nlayout(location = 0) out vec4 outColor;\nvoid main() {\n    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n"]))),wgsl:"@fragment\nfn main() -> @location(0) vec4<f32> {\n  return vec4<f32>(1.0, 0.0, 0.0, 1.0);\n}\n"}};class Nr extends g{constructor(e){let{device:t}=e;super(),this.model=new Jt(t,{vs:br.vs,fs:br.fs,topology:"triangle-list",vertexCount:3,shaderLayout:{attributes:[],bindings:[]},parameters:{depthFormat:"depth24plus"}})}onFinalize(){this.model.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[1,1,1,1]});this.model.draw(n),n.end()}}var Gr,Ir;function yr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const wr=s(Gr||(Gr=yr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix[16];\n} app;\n\n// CUBE GEOMETRY\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix[gl_InstanceID] * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix[16];\n} app;\n\n// CUBE GEOMETRY\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix[gl_InstanceID] * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"]))),Fr=s(Ir||(Ir=yr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class Mr extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer=t.createBuffer({id:"uniforms",usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:1024}),this.cubeModel=new Jt(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : array<mat4x4<f32>, 16>,\n};\n\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  @builtin(instance_index) instanceIdx : u32,\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix[instanceIdx] * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4<f32>(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:wr},fs:{wgsl:"@fragment\nfn main(\n  @location(0) fragUV: vec2<f32>,\n  @location(1) fragPosition: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:Fr},geometry:new nn({indices:!1}),instanceCount:16,parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer}})}onFinalize(e){this.uniformBuffer.destroy(),this.cubeModel.destroy()}onRender(e){var t;let{device:n}=e;const i=new gn.k,r=null==(t=n.canvasContext)?void 0:t.getAspect(),s=Date.now()/1e3;i.perspective({fovy:2*Math.PI/5,aspect:r,near:1,far:100});const o=function(e,t){const n=(new gn.k).translate([0,0,-12]),i=new gn.k;let r=0,s=0;for(let o=0;o<4;o++)for(let a=0;a<4;a++)i.copy(Pr[r]).rotateAxis(1,[Math.sin((o+.5)*t),Math.cos((a+.5)*t),0]).multiplyLeft(n).multiplyLeft(e),Or.set(i,s),r++,s+=16;return Or}(i,s);this.uniformBuffer.write(o);const a=n.beginRenderPass();this.cubeModel.draw(a),a.end()}}const Pr=[];for(let Rs=0;Rs<4;Rs++)for(let e=0;e<4;e++)Pr.push((new gn.k).translate([4*(Rs-2+.5),4*(e-2+.5),0]));const Or=new Float32Array(256);var xr,Br;function Dr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Ur=s(xr||(xr=Dr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = 0.5 * (vec4(positions, 1.) + vec4(1., 1., 1., 1.));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = 0.5 * (vec4(positions, 1.) + vec4(1., 1., 1., 1.));\n}\n"]))),kr=s(Br||(Br=Dr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class Hr extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer=t.createBuffer({id:"uniforms",byteLength:64,usage:o.h.UNIFORM|o.h.COPY_DST}),this.model=new Jt(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:Ur},fs:{wgsl:"@fragment\nfn main(\n  @location(0) fragUV: vec2<f32>,\n  @location(1) fragPosition: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:kr},geometry:new nn({indices:!1}),parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer}})}onFinalize(){this.model.destroy(),this.uniformBuffer.destroy()}onRender(e){var t;let{device:n}=e;const i=new gn.k,r=new gn.k,s=new gn.k,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;r.identity().translate([0,0,-4]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),i.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),s.copy(r).multiplyLeft(i),this.uniformBuffer.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.model.setBindings({app:this.uniformBuffer}),this.model.draw(l),l.end()}}var Vr,Xr;function Wr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Kr=s(Vr||(Vr=Wr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n  // fragPosition = 0.5 * (vec4(position, 1.) + vec4(1., 1., 1., 1.));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n  // fragPosition = 0.5 * (vec4(position, 1.) + vec4(1., 1., 1., 1.));\n}\n"]))),zr=s(Xr||(Xr=Wr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));;\n}\n"])));class Yr extends g{constructor(e){let{device:t}=e;super();const n=t.createTexture({data:(0,Fn.Dt)("https://raw.githubusercontent.com/uber/luma.gl/8.5-release/examples/getting-started/hello-cube/vis-logo.png"),mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}});this.uniformBuffer=t.createBuffer({id:"uniforms",byteLength:64,usage:o.h.UNIFORM|o.h.COPY_DST}),this.model=new Jt(t,{id:"cube",vs:{wgsl:"\nstruct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @ group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n};\n\n@vertex\nfn main(\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>) -> VertexOutput \n{\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4<f32>(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:Kr},fs:{wgsl:"\n@group(0) @binding(1) var uSampler: sampler;\n@group(0) @binding(2) var uTexture: texture_2d<f32>;\n\n@fragment\nfn main(@location(0) fragUV: vec2<f32>,\n        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {\n  let flippedUV = vec2<f32>(1.0 - fragUV.x, fragUV.y);\n  return textureSample(uTexture, uSampler, flippedUV) * fragPosition;\n}\n",glsl:zr},geometry:new nn({indices:!1}),bindings:{app:this.uniformBuffer,uSampler:n.sampler,uTexture:n},parameters:{depthWriteEnabled:!0,depthCompare:"less"}})}onFinalize(){this.model.destroy(),this.uniformBuffer.destroy()}onRender(e){var t;let{device:n}=e;const i=new gn.k,r=new gn.k,s=new gn.k,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;r.identity().translate([0,0,-4]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),i.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),s.copy(r).multiplyLeft(i),this.uniformBuffer.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(l),l.end()}}var jr,Zr;function qr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Qr=s(jr||(jr=qr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"]))),Jr=s(Zr||(Zr=qr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class $r extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer1=t.createBuffer({id:"uniforms-1",usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:64}),this.uniformBuffer2=t.createBuffer({id:"uniforms-2",usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:64}),this.cubeModel=new Jt(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:Qr},fs:{wgsl:"\n@fragment\nfn main(@location(0) fragUV: vec2<f32>,\n        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:Jr},geometry:new nn({indices:!1}),parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer1}})}onFinalize(){this.cubeModel.destroy(),this.uniformBuffer1.destroy(),this.uniformBuffer2.destroy()}onRender(e){var t;let{device:n}=e;const i=new gn.k,r=new gn.k,s=new gn.k,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;i.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),r.identity().translate([-2,0,-7]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),s.copy(r).multiplyLeft(i),this.uniformBuffer1.write(new Float32Array(s)),r.identity().translate([2,0,-7]).rotateAxis(1,[Math.cos(a),Math.sin(a),0]),s.copy(r).multiplyLeft(i),this.uniformBuffer2.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.cubeModel.setBindings({app:this.uniformBuffer1}),this.cubeModel.draw(l),this.cubeModel.setBindings({app:this.uniformBuffer2}),this.cubeModel.draw(l),l.end()}}const es={},ts=()=>i.createElement(r.fo,{id:"animation",directory:"api",template:Nn,config:es}),ns=()=>i.createElement(r.fo,{id:"cubemap",directory:"api",template:Bn,config:es}),is=()=>i.createElement(r.fo,{id:"texture-3d",directory:"api-3d",template:Zn,config:es}),rs=()=>i.createElement(r.fo,{id:"instancing",directory:"showcase",template:ui,config:es}),ss=()=>i.createElement(r.fo,{id:"persistence",directory:"showcase/persistence",template:wi,config:es}),os=()=>i.createElement(r.fo,{id:"hello-cube",directory:"tutorials",template:Ui,config:es}),as=()=>i.createElement(r.fo,{id:"hello-instancing",directory:"tutorials",template:zi,config:es}),ls=()=>i.createElement(r.fo,{id:"hello-triangle",directory:"tutorials",template:Zi,config:es}),cs=()=>i.createElement("h2",null,i.createElement("i",null,"Note: Transform examples temporarily disabled")),us=()=>i.createElement(r.fo,{id:"lighting",directory:"tutorials",template:pr,config:es}),hs=()=>i.createElement(r.fo,{id:"shader-hooks",directory:"tutorials",template:Rr,config:es}),_s=()=>i.createElement(r.fo,{id:"shader-modules",directory:"tutorials",template:Lr,config:es}),ds=()=>i.createElement("h2",null,i.createElement("i",null,"Note: Transform examples temporarily disabled")),fs=()=>i.createElement("h2",null,i.createElement("i",null,"Note: Transform examples temporarily disabled")),ps=()=>i.createElement(r.fo,{id:"hello-triangle-webgpu",directory:"webgpu",template:Nr,config:es}),Es=()=>i.createElement(r.fo,{id:"instanced-cubes-webgpu",directory:"webgpu",template:Mr,config:es}),gs=()=>i.createElement(r.fo,{id:"rotating-cube-webgpu",directory:"webgpu",template:Hr,config:es}),ms=()=>i.createElement(r.fo,{id:"textured-cube-webgpu",directory:"webgpu",template:Yr,config:es}),As=()=>i.createElement(r.fo,{id:"two-cubes-webgpu",directory:"webgpu",template:$r,config:es})},357:(e,t,n)=>{n.d(t,{xN:()=>fi,Xj:()=>gi,dJ:()=>Ai,yL:()=>mi,R2:()=>pi,I$:()=>Ei,fo:()=>bi,dw:()=>Ri,CQ:()=>Li,VQ:()=>Ti});var i=n(6540),r=n(5556),s=n.n(r);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}class a extends i.Component{render(){const{height:e,width:t,viewBox:n,style:r={},children:s,predefinedClassName:a,className:l,colors:c,totalColor:u,...h}=this.props,_=e,d=t||_;r.fill="currentColor";const f=Array.isArray(c)&&u&&((e,t)=>new Array(e).fill(1).reduce(((e,n,i)=>e+".cr"+(i+1)+" {fill:"+t[i%t.length]+";}"),""))(u,c);return i.createElement("svg",o({viewBox:n,width:d,height:_,style:r,className:a+" "+l},h),f?i.createElement("style",{type:"text/css"},f):null,s)}}a.displayName="Base Icon",a.propTypes={height:s().string,width:s().string,viewBox:s().string,children:s().node,predefinedClassName:s().string,className:s().string},a.defaultProps={height:null,width:null,viewBox:"0 0 64 64",predefinedClassName:"",className:""};const l=e=>i.createElement(a,e,i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.02167 13.7625C4.69623 13.4459 4.69623 12.9325 5.02167 12.6159L9.76574 8.00002L5.02167 3.38416C4.69623 3.06752 4.69623 2.55415 5.02167 2.2375C5.3471 1.92086 5.87474 1.92086 6.20018 2.2375L11.5335 7.42669C11.6898 7.57875 11.7776 7.78498 11.7776 8.00002C11.7776 8.21506 11.6898 8.4213 11.5335 8.57335L6.20018 13.7625C5.87474 14.0792 5.3471 14.0792 5.02167 13.7625Z"}));l.propTypes={height:s().string},l.defaultProps={height:"16px",viewBox:"0 0 17 16",predefinedClassName:"unfolded-icons-arrowbigright"};var c=n(4745),u=n(6769),h=n(3522),_=n(6237);const d=new class{constructor(){this.stats=new Map}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new _.A({id:e})),this.stats.get(e)}};const f=function(){const e="undefined"!=typeof __VERSION__?__VERSION__:"running from source";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error("luma.gl - multiple VERSIONs detected: "+globalThis.luma.VERSION+" vs "+e);return globalThis.luma||((0,u.A)()&&h.R.log(1,e+" - set luma.log.level=1 (or higher) to trace rendering")(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:h.R,stats:d}),e}();var p=n(469),E=n(5056);let g;g=Symbol.toStringTag;class m{get[g](){return"Device"}constructor(e){this.statsManager=d,this.userData={},this._lumaData={},this.props={...m.defaultProps,...e},this.id=this.props.id||(0,p.L)(this[Symbol.toStringTag].toLowerCase())}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||"string"==typeof e)&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e){throw void 0===e&&(e={}),new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&E.h.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":h.R.warn("indices buffer content must be of integer type")()),t}}m.defaultProps={id:null,type:"best-available",canvas:null,container:null,manageState:!0,width:800,height:600,debug:Boolean(h.R.get("debug")),break:[],gl:null},m.VERSION=f;var A=n(4468);const R=new Map;class T{static registerDevices(e){for(const t of e)(0,A.v)(t.type&&t.isSupported&&t.create),R.set(t.type,t)}static getAvailableDevices(){return Array.from(R).map((e=>e.type))}static getSupportedDevices(){return Array.from(R).filter((e=>e.isSupported())).map((e=>e.type))}static setDefaultDeviceProps(e){Object.assign(m.defaultProps,e)}static async createDevice(e){let t;switch(void 0===e&&(e={}),(e={...m.defaultProps,...e}).gl&&(e.type="webgl"),e.type){case"webgpu":if(t=R.get("webgpu"),t)return await t.create(e);break;case"webgl":if(t=R.get("webgl"),t)return await t.create(e);break;case"best-available":if(t=R.get("webgpu"),t&&t.isSupported())return await t.create(e);if(t=R.get("webgl"),t&&t.isSupported())return await t.create(e)}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}}T.stats=d,T.log=h.R;const L=(0,u.A)()&&"undefined"!=typeof document,v=()=>L&&"complete"===document.readyState,S={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class C{static get isPageLoaded(){return v()}constructor(e){if(this.width=1,this.height=1,this._canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1},this.props={...S,...e},e=this.props,!(0,u.A)())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"==typeof e.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!t&&!v())throw new Error("Accessing '"+e+"' before page was loaded");if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{var t,n;const i=function(e){const{width:t,height:n}=e,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=t||1,i.height=n||1,i.style.width=Number.isFinite(t)?t+"px":"100%",i.style.height=Number.isFinite(n)?n+"px":"100%",i}(e),r=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t&&!v())throw new Error("Accessing '"+e+"' before page was loaded");if(!t)throw new Error(e+" is not an HTML element");return t}if(e)return e;return document.body}((null==(t=e)?void 0:t.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,null!=(n=e)&&n.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver((e=>{for(const t of e)t.target===this.canvas&&this.update()})),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){if("undefined"!=typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas)return 1;if(!(e=void 0===e?this.props.useDevicePixels:e)||e<=0)return 1;if(!0===e){return"undefined"!=typeof window&&window.devicePixelRatio||1}return e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:t}=this._canvasSizeInfo;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t){void 0===t&&(t=!0);const n=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return function(e,t,n,i,r){const s=e,o=b(s[0],t,n);let a=N(s[1],t,i,r),l=b(s[0]+1,t,n);const c=l===n-1?l:l-1;let u;l=N(s[1]+1,t,i,r),r?(l=0===l?l:l+1,u=a,a=l):u=l===i-1?l:l-1;return{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}(e,n,i,r,t)}setDevicePixelRatio(e,t){if(void 0===t&&(t={}),!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;n&&i||(h.R.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==n||r.clientHeight!==i||r.devicePixelRatio!==e){let t=e;const r=Math.floor(n*t),s=Math.floor(i*t);this.htmlCanvas.width=r,this.htmlCanvas.height=s;const[o,a]=this.getDrawingBufferSize();o===r&&a===s||(t=Math.min(o/n,a/i),this.htmlCanvas.width=Math.floor(n*t),this.htmlCanvas.height=Math.floor(i*t),h.R.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)}}function b(e,t,n){return Math.min(Math.round(e*t),n-1)}function N(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}C.pageLoaded=function(){if(v()||"undefined"==typeof window)return Promise.resolve();return new Promise((e=>{window.addEventListener("load",(()=>e()))}))}();var G=n(3369);const I={[G.GL.BLEND]:!1,[G.GL.BLEND_COLOR]:new Float32Array([0,0,0,0]),[G.GL.BLEND_EQUATION_RGB]:G.GL.FUNC_ADD,[G.GL.BLEND_EQUATION_ALPHA]:G.GL.FUNC_ADD,[G.GL.BLEND_SRC_RGB]:G.GL.ONE,[G.GL.BLEND_DST_RGB]:G.GL.ZERO,[G.GL.BLEND_SRC_ALPHA]:G.GL.ONE,[G.GL.BLEND_DST_ALPHA]:G.GL.ZERO,[G.GL.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[G.GL.COLOR_WRITEMASK]:[!0,!0,!0,!0],[G.GL.CULL_FACE]:!1,[G.GL.CULL_FACE_MODE]:G.GL.BACK,[G.GL.DEPTH_TEST]:!1,[G.GL.DEPTH_CLEAR_VALUE]:1,[G.GL.DEPTH_FUNC]:G.GL.LESS,[G.GL.DEPTH_RANGE]:new Float32Array([0,1]),[G.GL.DEPTH_WRITEMASK]:!0,[G.GL.DITHER]:!0,[G.GL.CURRENT_PROGRAM]:null,[G.GL.FRAMEBUFFER_BINDING]:null,[G.GL.RENDERBUFFER_BINDING]:null,[G.GL.VERTEX_ARRAY_BINDING]:null,[G.GL.ARRAY_BUFFER_BINDING]:null,[G.GL.FRONT_FACE]:G.GL.CCW,[G.GL.GENERATE_MIPMAP_HINT]:G.GL.DONT_CARE,[G.GL.LINE_WIDTH]:1,[G.GL.POLYGON_OFFSET_FILL]:!1,[G.GL.POLYGON_OFFSET_FACTOR]:0,[G.GL.POLYGON_OFFSET_UNITS]:0,[G.GL.SAMPLE_ALPHA_TO_COVERAGE]:!1,[G.GL.SAMPLE_COVERAGE]:!1,[G.GL.SAMPLE_COVERAGE_VALUE]:1,[G.GL.SAMPLE_COVERAGE_INVERT]:!1,[G.GL.SCISSOR_TEST]:!1,[G.GL.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[G.GL.STENCIL_TEST]:!1,[G.GL.STENCIL_CLEAR_VALUE]:0,[G.GL.STENCIL_WRITEMASK]:4294967295,[G.GL.STENCIL_BACK_WRITEMASK]:4294967295,[G.GL.STENCIL_FUNC]:G.GL.ALWAYS,[G.GL.STENCIL_REF]:0,[G.GL.STENCIL_VALUE_MASK]:4294967295,[G.GL.STENCIL_BACK_FUNC]:G.GL.ALWAYS,[G.GL.STENCIL_BACK_REF]:0,[G.GL.STENCIL_BACK_VALUE_MASK]:4294967295,[G.GL.STENCIL_FAIL]:G.GL.KEEP,[G.GL.STENCIL_PASS_DEPTH_FAIL]:G.GL.KEEP,[G.GL.STENCIL_PASS_DEPTH_PASS]:G.GL.KEEP,[G.GL.STENCIL_BACK_FAIL]:G.GL.KEEP,[G.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:G.GL.KEEP,[G.GL.STENCIL_BACK_PASS_DEPTH_PASS]:G.GL.KEEP,[G.GL.VIEWPORT]:[0,0,1024,1024],[G.GL.PACK_ALIGNMENT]:4,[G.GL.UNPACK_ALIGNMENT]:4,[G.GL.UNPACK_FLIP_Y_WEBGL]:!1,[G.GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[G.GL.UNPACK_COLORSPACE_CONVERSION_WEBGL]:G.GL.BROWSER_DEFAULT_WEBGL,[G.GL.TRANSFORM_FEEDBACK_BINDING]:null,[G.GL.COPY_READ_BUFFER_BINDING]:null,[G.GL.COPY_WRITE_BUFFER_BINDING]:null,[G.GL.PIXEL_PACK_BUFFER_BINDING]:null,[G.GL.PIXEL_UNPACK_BUFFER_BINDING]:null,[G.GL.FRAGMENT_SHADER_DERIVATIVE_HINT]:G.GL.DONT_CARE,[G.GL.READ_FRAMEBUFFER_BINDING]:null,[G.GL.RASTERIZER_DISCARD]:!1,[G.GL.PACK_ROW_LENGTH]:0,[G.GL.PACK_SKIP_PIXELS]:0,[G.GL.PACK_SKIP_ROWS]:0,[G.GL.UNPACK_ROW_LENGTH]:0,[G.GL.UNPACK_IMAGE_HEIGHT]:0,[G.GL.UNPACK_SKIP_PIXELS]:0,[G.GL.UNPACK_SKIP_ROWS]:0,[G.GL.UNPACK_SKIP_IMAGES]:0},y=(e,t,n)=>t?e.enable(n):e.disable(n),w=(e,t,n)=>e.hint(n,t),F=(e,t,n)=>e.pixelStorei(n,t),M=(e,t,n)=>{const i=n===G.GL.FRAMEBUFFER_BINDING?G.GL.DRAW_FRAMEBUFFER:G.GL.READ_FRAMEBUFFER;return e.bindFramebuffer(i,t)},P=(e,t,n)=>{const i={[G.GL.ARRAY_BUFFER_BINDING]:G.GL.ARRAY_BUFFER,[G.GL.COPY_READ_BUFFER_BINDING]:G.GL.COPY_READ_BUFFER,[G.GL.COPY_WRITE_BUFFER_BINDING]:G.GL.COPY_WRITE_BUFFER,[G.GL.PIXEL_PACK_BUFFER_BINDING]:G.GL.PIXEL_PACK_BUFFER,[G.GL.PIXEL_UNPACK_BUFFER_BINDING]:G.GL.PIXEL_UNPACK_BUFFER}[n];e.bindBuffer(i,t)};function O(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const x={[G.GL.BLEND]:y,[G.GL.BLEND_COLOR]:(e,t)=>e.blendColor(...t),[G.GL.BLEND_EQUATION_RGB]:"blendEquation",[G.GL.BLEND_EQUATION_ALPHA]:"blendEquation",[G.GL.BLEND_SRC_RGB]:"blendFunc",[G.GL.BLEND_DST_RGB]:"blendFunc",[G.GL.BLEND_SRC_ALPHA]:"blendFunc",[G.GL.BLEND_DST_ALPHA]:"blendFunc",[G.GL.COLOR_CLEAR_VALUE]:(e,t)=>e.clearColor(...t),[G.GL.COLOR_WRITEMASK]:(e,t)=>e.colorMask(...t),[G.GL.CULL_FACE]:y,[G.GL.CULL_FACE_MODE]:(e,t)=>e.cullFace(t),[G.GL.DEPTH_TEST]:y,[G.GL.DEPTH_CLEAR_VALUE]:(e,t)=>e.clearDepth(t),[G.GL.DEPTH_FUNC]:(e,t)=>e.depthFunc(t),[G.GL.DEPTH_RANGE]:(e,t)=>e.depthRange(...t),[G.GL.DEPTH_WRITEMASK]:(e,t)=>e.depthMask(t),[G.GL.DITHER]:y,[G.GL.FRAGMENT_SHADER_DERIVATIVE_HINT]:w,[G.GL.CURRENT_PROGRAM]:(e,t)=>e.useProgram(t),[G.GL.RENDERBUFFER_BINDING]:(e,t)=>e.bindRenderbuffer(G.GL.RENDERBUFFER,t),[G.GL.TRANSFORM_FEEDBACK_BINDING]:(e,t)=>null==e.bindTransformFeedback?void 0:e.bindTransformFeedback(G.GL.TRANSFORM_FEEDBACK,t),[G.GL.VERTEX_ARRAY_BINDING]:(e,t)=>e.bindVertexArray(t),[G.GL.FRAMEBUFFER_BINDING]:M,[G.GL.READ_FRAMEBUFFER_BINDING]:M,[G.GL.ARRAY_BUFFER_BINDING]:P,[G.GL.COPY_READ_BUFFER_BINDING]:P,[G.GL.COPY_WRITE_BUFFER_BINDING]:P,[G.GL.PIXEL_PACK_BUFFER_BINDING]:P,[G.GL.PIXEL_UNPACK_BUFFER_BINDING]:P,[G.GL.FRONT_FACE]:(e,t)=>e.frontFace(t),[G.GL.GENERATE_MIPMAP_HINT]:w,[G.GL.LINE_WIDTH]:(e,t)=>e.lineWidth(t),[G.GL.POLYGON_OFFSET_FILL]:y,[G.GL.POLYGON_OFFSET_FACTOR]:"polygonOffset",[G.GL.POLYGON_OFFSET_UNITS]:"polygonOffset",[G.GL.RASTERIZER_DISCARD]:y,[G.GL.SAMPLE_ALPHA_TO_COVERAGE]:y,[G.GL.SAMPLE_COVERAGE]:y,[G.GL.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[G.GL.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[G.GL.SCISSOR_TEST]:y,[G.GL.SCISSOR_BOX]:(e,t)=>e.scissor(...t),[G.GL.STENCIL_TEST]:y,[G.GL.STENCIL_CLEAR_VALUE]:(e,t)=>e.clearStencil(t),[G.GL.STENCIL_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(G.GL.FRONT,t),[G.GL.STENCIL_BACK_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(G.GL.BACK,t),[G.GL.STENCIL_FUNC]:"stencilFuncFront",[G.GL.STENCIL_REF]:"stencilFuncFront",[G.GL.STENCIL_VALUE_MASK]:"stencilFuncFront",[G.GL.STENCIL_BACK_FUNC]:"stencilFuncBack",[G.GL.STENCIL_BACK_REF]:"stencilFuncBack",[G.GL.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[G.GL.STENCIL_FAIL]:"stencilOpFront",[G.GL.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[G.GL.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[G.GL.STENCIL_BACK_FAIL]:"stencilOpBack",[G.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[G.GL.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[G.GL.VIEWPORT]:(e,t)=>e.viewport(...t),[G.GL.PACK_ALIGNMENT]:F,[G.GL.UNPACK_ALIGNMENT]:F,[G.GL.UNPACK_FLIP_Y_WEBGL]:F,[G.GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:F,[G.GL.UNPACK_COLORSPACE_CONVERSION_WEBGL]:F,[G.GL.PACK_ROW_LENGTH]:F,[G.GL.PACK_SKIP_PIXELS]:F,[G.GL.PACK_SKIP_ROWS]:F,[G.GL.UNPACK_ROW_LENGTH]:F,[G.GL.UNPACK_IMAGE_HEIGHT]:F,[G.GL.UNPACK_SKIP_PIXELS]:F,[G.GL.UNPACK_SKIP_ROWS]:F,[G.GL.UNPACK_SKIP_IMAGES]:F,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(G.GL.FRAMEBUFFER,n)},blend:(e,t)=>t?e.enable(G.GL.BLEND):e.disable(G.GL.BLEND),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null==t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(G.GL.CULL_FACE):e.disable(G.GL.CULL_FACE),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(G.GL.DEPTH_TEST):e.disable(G.GL.DEPTH_TEST),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(G.GL.DITHER):e.disable(G.GL.DITHER),derivativeHint:(e,t)=>{e.hint(G.GL.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(G.GL.GENERATE_MIPMAP_HINT,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(G.GL.POLYGON_OFFSET_FILL):e.disable(G.GL.POLYGON_OFFSET_FILL),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(G.GL.SCISSOR_TEST):e.disable(G.GL.SCISSOR_TEST),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(G.GL.STENCIL_TEST):e.disable(G.GL.STENCIL_TEST),stencilMask:(e,t)=>{t=O(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(G.GL.FRONT,n),e.stencilMaskSeparate(G.GL.BACK,i)},stencilFunc:(e,t)=>{t=O(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilFuncSeparate(G.GL.FRONT,n,i,r),e.stencilFuncSeparate(G.GL.BACK,s,o,a)},stencilOp:(e,t)=>{t=O(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilOpSeparate(G.GL.FRONT,n,i,r),e.stencilOpSeparate(G.GL.BACK,s,o,a)},viewport:(e,t)=>e.viewport(...t)};function B(e,t,n){return void 0!==t[e]?t[e]:n[e]}const D={blendEquation:(e,t,n)=>e.blendEquationSeparate(B(G.GL.BLEND_EQUATION_RGB,t,n),B(G.GL.BLEND_EQUATION_ALPHA,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(B(G.GL.BLEND_SRC_RGB,t,n),B(G.GL.BLEND_DST_RGB,t,n),B(G.GL.BLEND_SRC_ALPHA,t,n),B(G.GL.BLEND_DST_ALPHA,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(B(G.GL.POLYGON_OFFSET_FACTOR,t,n),B(G.GL.POLYGON_OFFSET_UNITS,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(B(G.GL.SAMPLE_COVERAGE_VALUE,t,n),B(G.GL.SAMPLE_COVERAGE_INVERT,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(G.GL.FRONT,B(G.GL.STENCIL_FUNC,t,n),B(G.GL.STENCIL_REF,t,n),B(G.GL.STENCIL_VALUE_MASK,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(G.GL.BACK,B(G.GL.STENCIL_BACK_FUNC,t,n),B(G.GL.STENCIL_BACK_REF,t,n),B(G.GL.STENCIL_BACK_VALUE_MASK,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(G.GL.FRONT,B(G.GL.STENCIL_FAIL,t,n),B(G.GL.STENCIL_PASS_DEPTH_FAIL,t,n),B(G.GL.STENCIL_PASS_DEPTH_PASS,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(G.GL.BACK,B(G.GL.STENCIL_BACK_FAIL,t,n),B(G.GL.STENCIL_BACK_PASS_DEPTH_FAIL,t,n),B(G.GL.STENCIL_BACK_PASS_DEPTH_PASS,t,n))},U={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({[G.GL.CURRENT_PROGRAM]:t}),bindRenderbuffer:(e,t,n)=>e({[G.GL.RENDERBUFFER_BINDING]:n}),bindTransformFeedback:(e,t,n)=>e({[G.GL.TRANSFORM_FEEDBACK_BINDING]:n}),bindVertexArray:(e,t)=>e({[G.GL.VERTEX_ARRAY_BINDING]:t}),bindFramebuffer:(e,t,n)=>{switch(t){case G.GL.FRAMEBUFFER:return e({[G.GL.DRAW_FRAMEBUFFER_BINDING]:n,[G.GL.READ_FRAMEBUFFER_BINDING]:n});case G.GL.DRAW_FRAMEBUFFER:return e({[G.GL.DRAW_FRAMEBUFFER_BINDING]:n});case G.GL.READ_FRAMEBUFFER:return e({[G.GL.READ_FRAMEBUFFER_BINDING]:n});default:return null}},bindBuffer:(e,t,n)=>{const i={[G.GL.ARRAY_BUFFER]:[G.GL.ARRAY_BUFFER_BINDING],[G.GL.COPY_READ_BUFFER]:[G.GL.COPY_READ_BUFFER_BINDING],[G.GL.COPY_WRITE_BUFFER]:[G.GL.COPY_WRITE_BUFFER_BINDING],[G.GL.PIXEL_PACK_BUFFER]:[G.GL.PIXEL_PACK_BUFFER_BINDING],[G.GL.PIXEL_UNPACK_BUFFER]:[G.GL.PIXEL_UNPACK_BUFFER_BINDING]}[t];return i?e({[i]:n}):{valueChanged:!0}},blendColor:(e,t,n,i,r)=>e({[G.GL.BLEND_COLOR]:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({[G.GL.BLEND_EQUATION_RGB]:t,[G.GL.BLEND_EQUATION_ALPHA]:t}),blendEquationSeparate:(e,t,n)=>e({[G.GL.BLEND_EQUATION_RGB]:t,[G.GL.BLEND_EQUATION_ALPHA]:n}),blendFunc:(e,t,n)=>e({[G.GL.BLEND_SRC_RGB]:t,[G.GL.BLEND_DST_RGB]:n,[G.GL.BLEND_SRC_ALPHA]:t,[G.GL.BLEND_DST_ALPHA]:n}),blendFuncSeparate:(e,t,n,i,r)=>e({[G.GL.BLEND_SRC_RGB]:t,[G.GL.BLEND_DST_RGB]:n,[G.GL.BLEND_SRC_ALPHA]:i,[G.GL.BLEND_DST_ALPHA]:r}),clearColor:(e,t,n,i,r)=>e({[G.GL.COLOR_CLEAR_VALUE]:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({[G.GL.DEPTH_CLEAR_VALUE]:t}),clearStencil:(e,t)=>e({[G.GL.STENCIL_CLEAR_VALUE]:t}),colorMask:(e,t,n,i,r)=>e({[G.GL.COLOR_WRITEMASK]:[t,n,i,r]}),cullFace:(e,t)=>e({[G.GL.CULL_FACE_MODE]:t}),depthFunc:(e,t)=>e({[G.GL.DEPTH_FUNC]:t}),depthRange:(e,t,n)=>e({[G.GL.DEPTH_RANGE]:new Float32Array([t,n])}),depthMask:(e,t)=>e({[G.GL.DEPTH_WRITEMASK]:t}),frontFace:(e,t)=>e({[G.GL.FRONT_FACE]:t}),lineWidth:(e,t)=>e({[G.GL.LINE_WIDTH]:t}),polygonOffset:(e,t,n)=>e({[G.GL.POLYGON_OFFSET_FACTOR]:t,[G.GL.POLYGON_OFFSET_UNITS]:n}),sampleCoverage:(e,t,n)=>e({[G.GL.SAMPLE_COVERAGE_VALUE]:t,[G.GL.SAMPLE_COVERAGE_INVERT]:n}),scissor:(e,t,n,i,r)=>e({[G.GL.SCISSOR_BOX]:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({[G.GL.STENCIL_WRITEMASK]:t,[G.GL.STENCIL_BACK_WRITEMASK]:t}),stencilMaskSeparate:(e,t,n)=>e({[t===G.GL.FRONT?G.GL.STENCIL_WRITEMASK:G.GL.STENCIL_BACK_WRITEMASK]:n}),stencilFunc:(e,t,n,i)=>e({[G.GL.STENCIL_FUNC]:t,[G.GL.STENCIL_REF]:n,[G.GL.STENCIL_VALUE_MASK]:i,[G.GL.STENCIL_BACK_FUNC]:t,[G.GL.STENCIL_BACK_REF]:n,[G.GL.STENCIL_BACK_VALUE_MASK]:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[t===G.GL.FRONT?G.GL.STENCIL_FUNC:G.GL.STENCIL_BACK_FUNC]:n,[t===G.GL.FRONT?G.GL.STENCIL_REF:G.GL.STENCIL_BACK_REF]:i,[t===G.GL.FRONT?G.GL.STENCIL_VALUE_MASK:G.GL.STENCIL_BACK_VALUE_MASK]:r}),stencilOp:(e,t,n,i)=>e({[G.GL.STENCIL_FAIL]:t,[G.GL.STENCIL_PASS_DEPTH_FAIL]:n,[G.GL.STENCIL_PASS_DEPTH_PASS]:i,[G.GL.STENCIL_BACK_FAIL]:t,[G.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:n,[G.GL.STENCIL_BACK_PASS_DEPTH_PASS]:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[t===G.GL.FRONT?G.GL.STENCIL_FAIL:G.GL.STENCIL_BACK_FAIL]:n,[t===G.GL.FRONT?G.GL.STENCIL_PASS_DEPTH_FAIL:G.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:i,[t===G.GL.FRONT?G.GL.STENCIL_PASS_DEPTH_PASS:G.GL.STENCIL_BACK_PASS_DEPTH_PASS]:r}),viewport:(e,t,n,i,r)=>e({[G.GL.VIEWPORT]:[t,n,i,r]})},k=(e,t)=>e.isEnabled(t),H={[G.GL.BLEND]:k,[G.GL.CULL_FACE]:k,[G.GL.DEPTH_TEST]:k,[G.GL.DITHER]:k,[G.GL.POLYGON_OFFSET_FILL]:k,[G.GL.SAMPLE_ALPHA_TO_COVERAGE]:k,[G.GL.SAMPLE_COVERAGE]:k,[G.GL.SCISSOR_TEST]:k,[G.GL.STENCIL_TEST]:k,[G.GL.RASTERIZER_DISCARD]:k},V=new Set([G.GL.ACTIVE_TEXTURE,G.GL.TRANSFORM_FEEDBACK_ACTIVE,G.GL.TRANSFORM_FEEDBACK_PAUSED,G.GL.TRANSFORM_FEEDBACK_BUFFER_BINDING,G.GL.UNIFORM_BUFFER_BINDING,G.GL.ELEMENT_ARRAY_BUFFER_BINDING,G.GL.IMPLEMENTATION_COLOR_READ_FORMAT,G.GL.IMPLEMENTATION_COLOR_READ_TYPE,G.GL.READ_BUFFER,G.GL.DRAW_BUFFER0,G.GL.DRAW_BUFFER1,G.GL.DRAW_BUFFER2,G.GL.DRAW_BUFFER3,G.GL.DRAW_BUFFER4,G.GL.DRAW_BUFFER5,G.GL.DRAW_BUFFER6,G.GL.DRAW_BUFFER7,G.GL.DRAW_BUFFER8,G.GL.DRAW_BUFFER9,G.GL.DRAW_BUFFER10,G.GL.DRAW_BUFFER11,G.GL.DRAW_BUFFER12,G.GL.DRAW_BUFFER13,G.GL.DRAW_BUFFER14,G.GL.DRAW_BUFFER15,G.GL.SAMPLER_BINDING,G.GL.TEXTURE_BINDING_2D,G.GL.TEXTURE_BINDING_2D_ARRAY,G.GL.TEXTURE_BINDING_3D,G.GL.TEXTURE_BINDING_CUBE_MAP]);function X(e,t){const n=Rn.attach(e).gl;if(function(e){for(const t in e)return!1;return!0}(t))return;const i={};for(const s in t){const e=Number(s),r=x[s];r&&("string"==typeof r?i[r]=!0:r(n,t[s],e))}const r=n.state&&n.state.cache;if(r)for(const s in i){(0,D[s])(n,t,r)}}function W(e,t){void 0===t&&(t=I);const n=Rn.attach(e).gl;if("number"==typeof t){const e=t,i=H[e];return i?i(n,e):n.getParameter(e)}const i=Array.isArray(t)?t:Object.keys(t),r={};for(const s of i){const e=H[s];r[s]=e?e(n,Number(s)):n.getParameter(Number(s))}return r}function K(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class z{constructor(e,t){let{copyState:n=!1,log:i=(()=>{})}=void 0===t?{}:t;this.program=null,this.stateStack=[],this.enable=!0,this.gl=e,this.cache=n?W(e):Object.assign({},I),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e){void 0===e&&(e={}),this.stateStack.push({})}pop(){(0,A.v)(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];X(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){(0,A.v)(void 0!==r);const s=e[r],o=this.cache[r];K(s,o)||(n=!0,t=o,i&&!(r in i)&&(i[r]=o),this.cache[r]=s)}return{valueChanged:n,oldValue:t}}}function Y(e){return e.state}function j(e,t){const{enable:n=!0,copyState:i}=t;if((0,A.v)(void 0!==i),!e.state){e.state=new z(e,{copyState:i}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const i=Y(e);i.program!==n&&(t(n),i.program=n)}}(e);for(const t in U){J(e,t,U[t])}Q(e,"getParameter"),Q(e,"isEnabled")}return Y(e).enable=n,e}function Z(e){let t=Y(e);t||(j(e,{copyState:!1}),t=Y(e)),t.push()}function q(e){const t=Y(e);(0,A.v)(t),t.pop()}function Q(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||V.has(t))return n(t);const i=Y(e);return t in i.cache||(i.cache[t]=n(t)),i.enable?i.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:t+"-from-cache",configurable:!1})}function J(e,t,n){if(!e[t])return;const i=e[t].bind(e);e[t]=function(){const t=Y(e);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];const{valueChanged:a,oldValue:l}=n(t._updateCache,...s);return a&&i(...s),l},Object.defineProperty(e[t],"name",{value:t+"-to-cache",configurable:!1})}const $={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function ee(e){const t=e.getParameter(G.GL.VENDOR),n=e.getParameter(G.GL.RENDERER),i=e.getExtension("WEBGL_debug_renderer_info"),r=e.getParameter(i?i.UNMASKED_VENDOR_WEBGL:G.GL.VENDOR)||t,s=e.getParameter(i?i.UNMASKED_RENDERER_WEBGL:G.GL.RENDERER)||n,o=e.getParameter(G.GL.VERSION),a=te(r,s),l=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(r,s),c=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(te(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(r,s);return{type:"webgl",gpu:a,gpuType:c,gpuBackend:l,vendor:r,renderer:s,version:o,shadingLanguage:"glsl",shadingLanguageVersion:300}}function te(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}var ne=n(5787);const ie=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function re(e){const t=ie.exec(e);if(t){const[,e,n,i,r,s]=t;if(e){const t=""+i+n,o=(0,ne.l)(t);return{format:e,components:e.length,srgb:"-srgb"===r,unsized:"-unsized"===s,webgl:"-webgl"===s,...o}}}return function(e){var t;const n=se[e];if(!n)throw new Error("Unknown format "+e);return{format:n.format||"",components:n.components||(null==(t=n.format)?void 0:t.length)||1,byteLength:n.bpp||1,srgb:!1,unsized:!1}}(e)}const se={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2unorm-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function oe(e){switch(e){case"uint8":case"unorm8":return G.GL.UNSIGNED_BYTE;case"sint8":case"snorm8":return G.GL.BYTE;case"uint16":case"unorm16":return G.GL.UNSIGNED_SHORT;case"sint16":case"snorm16":return G.GL.SHORT;case"uint32":return G.GL.UNSIGNED_INT;case"sint32":return G.GL.INT;case"float16":return G.GL.HALF_FLOAT;case"float32":return G.GL.FLOAT}throw new Error(String(e))}const ae="texture-compression-bc",le="texture-compression-astc",ce="texture-compression-etc2",ue="texture-compression-pvrtc-webgl",he="texture-compression-atc-webgl",_e="WEBGL_compressed_texture_s3tc",de="WEBGL_compressed_texture_s3tc_srgb",fe="EXT_texture_compression_rgtc",pe="EXT_texture_compression_bptc",Ee="EXT_texture_norm16",ge={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"norm16-renderable-webgl":[Ee],"float32-filterable-linear-webgl":["OES_texture_float_linear"],"float16-filterable-linear-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[_e,de,fe,pe],"texture-compression-bc5-webgl":[fe],"texture-compression-bc7-webgl":[pe],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};function me(e,t){return(ge[t]||[]).every((t=>e.getExtension(t)))}const Ae={"rgb8unorm-unsized":{gl:G.GL.RGB,b:4,c:2,bpp:4,dataFormat:G.GL.RGB,types:[G.GL.UNSIGNED_BYTE,G.GL.UNSIGNED_SHORT_5_6_5]},"rgba8unorm-unsized":{gl:G.GL.RGBA,b:4,c:2,bpp:4,dataFormat:G.GL.RGBA,types:[G.GL.UNSIGNED_BYTE,G.GL.UNSIGNED_SHORT_4_4_4_4,G.GL.UNSIGNED_SHORT_5_5_5_1]},r8unorm:{gl:G.GL.R8,b:1,c:1,renderbuffer:!0},r8snorm:{gl:G.GL.R8_SNORM,b:1,c:1},r8uint:{gl:G.GL.R8UI,b:1,c:1,renderbuffer:!0},r8sint:{gl:G.GL.R8I,b:1,c:1,renderbuffer:!0},rg8unorm:{gl:G.GL.RG8,b:2,c:2,renderbuffer:!0},rg8snorm:{gl:G.GL.RG8_SNORM,b:2,c:2},rg8uint:{gl:G.GL.RG8UI,b:2,c:2,renderbuffer:!0},rg8sint:{gl:G.GL.RG8I,b:2,c:2,renderbuffer:!0},r16uint:{gl:G.GL.R16UI,b:2,c:1,renderbuffer:!0},r16sint:{gl:G.GL.R16I,b:2,c:1,renderbuffer:!0},r16float:{gl:G.GL.R16F,b:2,c:1,render:"float16-renderable-webgl",filter:"float16-filterable-linear-webgl",renderbuffer:!0},"r16unorm-webgl":{gl:G.GL.R16_EXT,b:2,c:1,f:"norm16-renderable-webgl",renderbuffer:!0,x:Ee},"r16snorm-webgl":{gl:G.GL.R16_SNORM_EXT,b:2,c:1,f:"norm16-renderable-webgl",x:Ee},"rgba4unorm-webgl":{gl:G.GL.RGBA4,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb565unorm-webgl":{gl:G.GL.RGB565,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb5a1unorm-webgl":{gl:G.GL.RGB5_A1,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb8unorm-webgl":{gl:G.GL.RGB8,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:G.GL.RGB8_SNORM,b:3,c:3,wgpu:!1},rgba8unorm:{gl:G.GL.RGBA8,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:G.GL.SRGB8_ALPHA8,b:4,c:4,bpp:4},rgba8snorm:{gl:G.GL.RGBA8_SNORM,b:4,c:4},rgba8uint:{gl:G.GL.RGBA8UI,b:4,c:4,bpp:4},rgba8sint:{gl:G.GL.RGBA8I,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:G.GL.RG16UI,b:4,c:1,bpp:4},rg16sint:{gl:G.GL.RG16I,b:4,c:2,bpp:4},rg16float:{gl:G.GL.RG16F,bpp:4,b:4,c:2,render:"float16-renderable-webgl",filter:"float16-filterable-linear-webgl",renderbuffer:!0},"rg16unorm-webgl":{gl:G.GL.RG16_EXT,b:2,c:2,f:"norm16-renderable-webgl",x:Ee},"rg16snorm-webgl":{gl:G.GL.RG16_SNORM_EXT,b:2,c:2,f:"norm16-renderable-webgl",x:Ee},r32uint:{gl:G.GL.R32UI,b:4,c:1,bpp:4,renderbuffer:!0},r32sint:{gl:G.GL.R32I,b:4,c:1,bpp:4,renderbuffer:!0},r32float:{gl:G.GL.R32F,bpp:4,b:4,c:1,render:"float32-renderable-webgl",filter:"float32-filterable-linear-webgl"},rgb9e5ufloat:{gl:G.GL.RGB9_E5,b:4,c:3,p:1,render:"float16-renderable-webgl",filter:"float16-filterable-linear-webgl"},rg11b10ufloat:{gl:G.GL.R11F_G11F_B10F,b:4,c:3,p:1,render:"float32-renderable-webgl",renderbuffer:!0},rgb10a2unorm:{gl:G.GL.RGB10_A2,b:4,c:4,p:1,renderbuffer:!0},"rgb10a2unorm-webgl":{b:4,c:4,gl:G.GL.RGB10_A2UI,p:1,wgpu:!1,bpp:4,renderbuffer:!0},"rgb16unorm-webgl":{gl:G.GL.RGB16_EXT,b:2,c:3,f:"norm16-renderable-webgl",x:Ee},"rgb16snorm-webgl":{gl:G.GL.RGB16_SNORM_EXT,b:2,c:3,f:"norm16-renderable-webgl",x:Ee},rg32uint:{gl:G.GL.RG32UI,b:8,c:2,renderbuffer:!0},rg32sint:{gl:G.GL.RG32I,b:8,c:2,renderbuffer:!0},rg32float:{gl:G.GL.RG32F,b:8,c:2,render:"float32-renderable-webgl",filter:"float32-filterable-linear-webgl",renderbuffer:!0},rgba16uint:{gl:G.GL.RGBA16UI,b:8,c:4,renderbuffer:!0},rgba16sint:{gl:G.GL.RGBA16I,b:8,c:4,renderbuffer:!0},rgba16float:{gl:G.GL.RGBA16F,b:8,c:4,render:"float16-renderable-webgl",filter:"float16-filterable-linear-webgl"},"rgba16unorm-webgl":{gl:G.GL.RGBA16_EXT,b:2,c:4,f:"norm16-renderable-webgl",renderbuffer:!0,x:Ee},"rgba16snorm-webgl":{gl:G.GL.RGBA16_SNORM_EXT,b:2,c:4,f:"norm16-renderable-webgl",x:Ee},"rgb32float-webgl":{gl:G.GL.RGB32F,render:"float32-renderable-webgl",filter:"float32-filterable-linear-webgl",gl2ext:"EXT_color_buffer_float",dataFormat:G.GL.RGB,types:[G.GL.FLOAT]},rgba32uint:{gl:G.GL.RGBA32UI,b:16,c:4,renderbuffer:!0},rgba32sint:{gl:G.GL.RGBA32I,b:16,c:4,renderbuffer:!0},rgba32float:{gl:G.GL.RGBA32F,b:16,c:4,render:"float32-renderable-webgl",filter:"float32-filterable-linear-webgl",renderbuffer:!0},stencil8:{gl:G.GL.STENCIL_INDEX8,b:1,c:1,attachment:G.GL.STENCIL_ATTACHMENT,renderbuffer:!0},depth16unorm:{gl:G.GL.DEPTH_COMPONENT16,b:2,c:1,attachment:G.GL.DEPTH_ATTACHMENT,renderbuffer:!0},depth24plus:{gl:G.GL.DEPTH_COMPONENT24,b:3,c:1,attachment:G.GL.DEPTH_ATTACHMENT},depth32float:{gl:G.GL.DEPTH_COMPONENT32F,b:4,c:1,attachment:G.GL.DEPTH_ATTACHMENT,renderbuffer:!0},"depth24plus-stencil8":{gl:G.GL.DEPTH_STENCIL,b:4,c:2,p:1,attachment:G.GL.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0,depthTexture:!0},"depth24unorm-stencil8":{gl:G.GL.DEPTH24_STENCIL8,b:4,c:2,p:1,attachment:G.GL.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0},"depth32float-stencil8":{gl:G.GL.DEPTH32F_STENCIL8,b:5,c:2,p:1,attachment:G.GL.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0},"bc1-rgb-unorm-webgl":{gl:G.GL.COMPRESSED_RGB_S3TC_DXT1_EXT,x:_e,f:ae},"bc1-rgb-unorm-srgb-webgl":{gl:G.GL.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:de,f:ae},"bc1-rgba-unorm":{gl:G.GL.COMPRESSED_RGBA_S3TC_DXT1_EXT,x:_e,f:ae},"bc1-rgba-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:de,f:ae},"bc2-rgba-unorm":{gl:G.GL.COMPRESSED_RGBA_S3TC_DXT3_EXT,x:_e,f:ae},"bc2-rgba-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,x:de,f:ae},"bc3-rgba-unorm":{gl:G.GL.COMPRESSED_RGBA_S3TC_DXT5_EXT,x:_e,f:ae},"bc3-rgba-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,x:de,f:ae},"bc4-r-unorm":{gl:G.GL.COMPRESSED_RED_RGTC1_EXT,x:fe,f:ae},"bc4-r-snorm":{gl:G.GL.COMPRESSED_SIGNED_RED_RGTC1_EXT,x:fe,f:ae},"bc5-rg-unorm":{gl:G.GL.COMPRESSED_RED_GREEN_RGTC2_EXT,x:fe,f:ae},"bc5-rg-snorm":{gl:G.GL.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,x:fe,f:ae},"bc6h-rgb-ufloat":{gl:G.GL.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,x:pe,f:ae},"bc6h-rgb-float":{gl:G.GL.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,x:pe,f:ae},"bc7-rgba-unorm":{gl:G.GL.COMPRESSED_RGBA_BPTC_UNORM_EXT,x:pe,f:ae},"bc7-rgba-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT,x:pe,f:ae},"etc2-rgb8unorm":{gl:G.GL.COMPRESSED_RGB8_ETC2,f:ce},"etc2-rgb8unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ETC2,f:ce},"etc2-rgb8a1unorm":{gl:G.GL.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,f:ce},"etc2-rgb8a1unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,f:ce},"etc2-rgba8unorm":{gl:G.GL.COMPRESSED_RGBA8_ETC2_EAC,f:ce},"etc2-rgba8unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,f:ce},"eac-r11unorm":{gl:G.GL.COMPRESSED_R11_EAC,f:ce},"eac-r11snorm":{gl:G.GL.COMPRESSED_SIGNED_R11_EAC,f:ce},"eac-rg11unorm":{gl:G.GL.COMPRESSED_RG11_EAC,f:ce},"eac-rg11snorm":{gl:G.GL.COMPRESSED_SIGNED_RG11_EAC,f:ce},"astc-4x4-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_4x4_KHR,f:le},"astc-4x4-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,f:le},"astc-5x4-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_5x4_KHR,f:le},"astc-5x4-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,f:le},"astc-5x5-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_5x5_KHR,f:le},"astc-5x5-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,f:le},"astc-6x5-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_6x5_KHR,f:le},"astc-6x5-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,f:le},"astc-6x6-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_6x6_KHR,f:le},"astc-6x6-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,f:le},"astc-8x5-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_8x5_KHR,f:le},"astc-8x5-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,f:le},"astc-8x6-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_8x6_KHR,f:le},"astc-8x6-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,f:le},"astc-8x8-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_8x8_KHR,f:le},"astc-8x8-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,f:le},"astc-10x5-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_10x10_KHR,f:le},"astc-10x5-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,f:le},"astc-10x6-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_10x6_KHR,f:le},"astc-10x6-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,f:le},"astc-10x8-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_10x8_KHR,f:le},"astc-10x8-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,f:le},"astc-10x10-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_10x10_KHR,f:le},"astc-10x10-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,f:le},"astc-12x10-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_12x10_KHR,f:le},"astc-12x10-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,f:le},"astc-12x12-unorm":{gl:G.GL.COMPRESSED_RGBA_ASTC_12x12_KHR,f:le},"astc-12x12-unorm-srgb":{gl:G.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,f:le},"pvrtc-rgb4unorm-webgl":{gl:G.GL.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,f:ue},"pvrtc-rgba4unorm-webgl":{gl:G.GL.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,f:ue},"pvrtc-rbg2unorm-webgl":{gl:G.GL.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,f:ue},"pvrtc-rgba2unorm-webgl":{gl:G.GL.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,f:ue},"etc1-rbg-unorm-webgl":{gl:G.GL.COMPRESSED_RGB_ETC1_WEBGL,f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{gl:G.GL.COMPRESSED_RGB_ATC_WEBGL,f:he},"atc-rgba-unorm-webgl":{gl:G.GL.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,f:he},"atc-rgbai-unorm-webgl":{gl:G.GL.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL,f:he}},Re={[G.GL.RED]:1,[G.GL.RED_INTEGER]:1,[G.GL.RG]:2,[G.GL.RG_INTEGER]:2,[G.GL.RGB]:3,[G.GL.RGB_INTEGER]:3,[G.GL.RGBA]:4,[G.GL.RGBA_INTEGER]:4,[G.GL.DEPTH_COMPONENT]:1,[G.GL.DEPTH_STENCIL]:1,[G.GL.ALPHA]:1,[G.GL.LUMINANCE]:1,[G.GL.LUMINANCE_ALPHA]:2},Te={[G.GL.FLOAT]:4,[G.GL.UNSIGNED_INT]:4,[G.GL.INT]:4,[G.GL.UNSIGNED_SHORT]:2,[G.GL.SHORT]:2,[G.GL.HALF_FLOAT]:2,[G.GL.BYTE]:1,[G.GL.UNSIGNED_BYTE]:1};function Le(e,t){const n=ve(t),i=Ae[n];if(!i)return!1;if(void 0===i.gl)return!1;const r=i.x||i.gl2ext;return!r||Boolean(e.getExtension(r))}function ve(e){if("string"==typeof e)return e;const t=Object.entries(Ae).find((t=>{let[,n]=t;return n.gl===e}));if(!t)throw new Error("Unknown texture format "+e);return t[0]}function Se(e){const t=Ae[e],n=null==t?void 0:t.gl;if(void 0===n)throw new Error("Unsupported texture format "+e);return n}function Ce(e){const t=ve(e),n=Se(t),i=re(t);return{format:n,dataFormat:Ne(i.format,i.integer,i.normalized,n),type:i.dataType?oe(i.dataType):G.GL.UNSIGNED_BYTE,compressed:i.compressed}}function be(e){const t=Ce(ve(e));return(Re[t.dataFormat]||4)*(Te[t.type]||1)}function Ne(e,t,n,i){if(i===G.GL.RGBA||i===G.GL.RGB)return i;switch(e){case"r":return t&&!n?G.GL.RED_INTEGER:G.GL.RED;case"rg":return t&&!n?G.GL.RG_INTEGER:G.GL.RG;case"rgb":return t&&!n?G.GL.RGB_INTEGER:G.GL.RGB;case"rgba":return t&&!n?G.GL.RGBA_INTEGER:G.GL.RGBA;default:return G.GL.RGBA}}function Ge(e){const t=function(e){e.getExtension("EXT_color_buffer_float");const t=new Set;for(const n of Object.keys(ye))Ie(e,n)&&t.add(n);return t}(e);for(const n of function(e){return Object.keys(ge).filter((t=>me(e,t)))}(e))t.add(n);return t}function Ie(e,t){const n=ye[t];return"string"==typeof n?Boolean(e.getExtension(n)):Boolean(n)}const ye={webgl:!0,glsl:!0,"uniforms-webgl":!0,"transform-feedback-webgl":!0,"constant-attributes-webgl":!0,"timer-query-webgl":"EXT_disjoint_timer_query_webgl2","shader-status-async-webgl":"KHR_parallel_shader_compile"};var we=n(7862);let Fe,Me;Fe=Symbol.toStringTag;class Pe extends we.F{get[Fe](){return"Texture"}constructor(e,t,n){void 0===n&&(n=Pe.defaultProps),super(e,t,n),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth}}Pe.defaultProps={...we.F.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,sampler:{},compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0},Pe.COPY_SRC=1,Pe.COPY_DST=2,Pe.TEXTURE_BINDING=4,Pe.STORAGE_BINDING=8,Pe.RENDER_ATTACHMENT=16,Me=Symbol.toStringTag;class Oe extends we.F{get[Me](){return"Framebuffer"}constructor(e,t){void 0===t&&(t={}),super(e,t,Oe.defaultProps),this.colorAttachments=[],this.depthStencilAttachment=null,this.width=this.props.width,this.height=this.props.height}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(h.R.log(2,"Resizing framebuffer "+this.id+" to "+this.width+"x"+this.height)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.colorAttachments=this.props.colorAttachments.map((e=>{if("string"==typeof e){const t=this.createColorTexture(e);return this.attachResource(t),t}return e})),this.props.depthStencilAttachment)if("string"==typeof this.props.depthStencilAttachment){const e=this.createDepthStencilTexture(this.props.depthStencilAttachment);this.attachResource(e),this.depthStencilAttachment=e}else this.depthStencilAttachment=this.props.depthStencilAttachment}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:Pe.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:Pe.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.device._createTexture({...this.colorAttachments[n].props,width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i,this.attachResource(i)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n,this.attachResource(n)}}}Oe.defaultProps={...we.F.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};var xe=n(4789);function Be(e,t,n){const i=Rn.attach(e).gl;if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:r=!0}=t;let s;if(Z(i),X(i,t),r)s=n(i),q(i);else try{s=n(i)}finally{q(i)}return s}function De(e,t){const n=Rn.attach(e),{gl:i}=n;if(t.cullMode)switch(t.cullMode){case"none":i.disable(G.GL.CULL_FACE);break;case"front":i.enable(G.GL.CULL_FACE),i.cullFace(G.GL.FRONT);break;case"back":i.enable(G.GL.CULL_FACE),i.cullFace(G.GL.BACK)}if(t.frontFace&&i.frontFace(Xe("frontFace",t.frontFace,{ccw:G.GL.CCW,cw:G.GL.CW})),void 0!==t.depthBias&&i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0),void 0!==t.depthWriteEnabled&&i.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?i.enable(G.GL.DEPTH_TEST):i.disable(G.GL.DEPTH_TEST),i.depthFunc(Ue("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;i.stencilMaskSeparate(G.GL.FRONT,e),i.stencilMaskSeparate(G.GL.BACK,e)}if(t.stencilReadMask&&h.R.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=Ue("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(G.GL.STENCIL_TEST):i.disable(G.GL.STENCIL_TEST),i.stencilFuncSeparate(G.GL.FRONT,n,0,e),i.stencilFuncSeparate(G.GL.BACK,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=ke("stencilPassOperation",t.stencilPassOperation),n=ke("stencilFailOperation",t.stencilFailOperation),r=ke("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(G.GL.FRONT,n,r,e),i.stencilOpSeparate(G.GL.BACK,n,r,e)}if(t.blendColorOperation||t.blendAlphaOperation){i.enable(G.GL.BLEND);const e=He("blendColorOperation",t.blendColorOperation||"add"),n=He("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,n);const r=Ve("blendColorSrcFactor",t.blendColorSrcFactor||"one"),s=Ve("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=Ve("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=Ve("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(r,s,o,a)}}function Ue(e,t){return Xe(e,t,{never:G.GL.NEVER,less:G.GL.LESS,equal:G.GL.EQUAL,"less-equal":G.GL.LEQUAL,greater:G.GL.GREATER,"not-equal":G.GL.NOTEQUAL,"greater-equal":G.GL.GEQUAL,always:G.GL.ALWAYS})}function ke(e,t){return Xe(e,t,{keep:G.GL.KEEP,zero:G.GL.ZERO,replace:G.GL.REPLACE,invert:G.GL.INVERT,"increment-clamp":G.GL.INCR,"decrement-clamp":G.GL.DECR,"increment-wrap":G.GL.INCR_WRAP,"decrement-wrap":G.GL.DECR_WRAP})}function He(e,t){return Xe(e,t,{add:G.GL.FUNC_ADD,subtract:G.GL.FUNC_SUBTRACT,"reverse-subtract":G.GL.FUNC_REVERSE_SUBTRACT,min:G.GL.MIN,max:G.GL.MAX})}function Ve(e,t){return Xe(e,t,{one:G.GL.ONE,zero:G.GL.ZERO,"src-color":G.GL.SRC_COLOR,"one-minus-src-color":G.GL.ONE_MINUS_SRC_COLOR,"dst-color":G.GL.DST_COLOR,"one-minus-dst-color":G.GL.ONE_MINUS_DST_COLOR,"src-alpha":G.GL.SRC_ALPHA,"one-minus-src-alpha":G.GL.ONE_MINUS_SRC_ALPHA,"dst-alpha":G.GL.DST_ALPHA,"one-minus-dst-alpha":G.GL.ONE_MINUS_DST_ALPHA})}function Xe(e,t,n){if(!(t in n))throw new Error(function(e,t){return"Illegal parameter "+t+" for "+e}(e,t));return n[t]}function We(e){const t={};return e.addressModeU&&(t[G.GL.TEXTURE_WRAP_S]=Ke(e.addressModeU)),e.addressModeV&&(t[G.GL.TEXTURE_WRAP_T]=Ke(e.addressModeV)),e.addressModeW&&(t[G.GL.TEXTURE_WRAP_R]=Ke(e.addressModeW)),e.magFilter&&(t[G.GL.TEXTURE_MAG_FILTER]=ze(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[G.GL.TEXTURE_MIN_FILTER]=function(e,t){if(!t)return ze(e);switch(e){case"nearest":return"nearest"===t?G.GL.NEAREST_MIPMAP_NEAREST:G.GL.NEAREST_MIPMAP_LINEAR;case"linear":return"nearest"===t?G.GL.LINEAR_MIPMAP_NEAREST:G.GL.LINEAR_MIPMAP_LINEAR}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[G.GL.TEXTURE_MIN_LOD]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[G.GL.TEXTURE_MAX_LOD]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[G.GL.TEXTURE_COMPARE_MODE]=G.GL.COMPARE_REF_TO_TEXTURE),e.compare&&(t[G.GL.TEXTURE_COMPARE_FUNC]=Ue("compare",e.compare)),e.maxAnisotropy&&(t[G.GL.TEXTURE_MAX_ANISOTROPY_EXT]=e.maxAnisotropy),t}function Ke(e){switch(e){case"clamp-to-edge":return G.GL.CLAMP_TO_EDGE;case"repeat":return G.GL.REPEAT;case"mirror-repeat":return G.GL.MIRRORED_REPEAT}}function ze(e){switch(e){case"nearest":return G.GL.NEAREST;case"linear":return G.GL.LINEAR}}class Ye extends E.h{constructor(e,t){void 0===t&&(t={}),super(e,t),this.glIndexType=G.GL.UNSIGNED_SHORT,this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=function(e){if(e&E.h.INDEX)return G.GL.ELEMENT_ARRAY_BUFFER;if(e&E.h.VERTEX)return G.GL.ARRAY_BUFFER;if(e&E.h.UNIFORM)return G.GL.UNIFORM_BUFFER;return G.GL.ARRAY_BUFFER}(this.props.usage),this.glUsage=function(e){if(e&E.h.INDEX)return G.GL.STATIC_DRAW;if(e&E.h.VERTEX)return G.GL.STATIC_DRAW;if(e&E.h.UNIFORM)return G.GL.DYNAMIC_DRAW;return G.GL.STATIC_DRAW}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?G.GL.UNSIGNED_INT:G.GL.UNSIGNED_SHORT,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.byteLength+t);const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){(0,A.v)(e>=0);let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t){void 0===t&&(t=0);const n=G.GL.COPY_WRITE_BUFFER;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e,t){return void 0===e&&(e=0),this.readSyncWebGL(e,t)}readSyncWebGL(e,t){var n;void 0===e&&(e=0),t=null!=(n=t)?n:this.byteLength-e;const i=new Uint8Array(t);return this.gl.bindBuffer(G.GL.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(G.GL.COPY_READ_BUFFER,e,i,0,t),this.gl.bindBuffer(G.GL.COPY_READ_BUFFER,null),this._setDebugData(i,e,t),i}}let je;je=Symbol.toStringTag;class Ze extends we.F{get[je](){return"Sampler"}constructor(e,t){super(e,t,Ze.defaultProps)}}Ze.defaultProps={...we.F.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};class qe extends Ze{constructor(e,t){super(e,t),this.device=e,this.parameters=We(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return"Sampler("+this.id+","+JSON.stringify(this.props)+")"}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case G.GL.TEXTURE_MIN_LOD:case G.GL.TEXTURE_MAX_LOD:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}const Qe={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0};class Je extends Pe{constructor(e,t){var n;super(e,{...Qe,format:"rgba8unorm",...t}),this.sampler=void 0,this.glFormat=void 0,this.type=void 0,this.dataFormat=void 0,this.mipmaps=void 0,this.textureUnit=void 0,this.loaded=!1,this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=G.GL.RGBA,this.target=function(e){switch(e.dimension){case"2d":return G.GL.TEXTURE_2D;case"cube":return G.GL.TEXTURE_CUBE_MAP;case"2d-array":return G.GL.TEXTURE_2D_ARRAY;case"3d":return G.GL.TEXTURE_3D;default:throw new Error(e.dimension)}}(this.props),this.loaded=!1,"string"==typeof(null==(n=this.props)?void 0:n.data)&&Object.assign(this.props,{data:(0,xe.yt)(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return"Texture("+this.id+","+this.width+"x"+this.height+")"}initialize(e){if(void 0===e&&(e={}),"cube"===this.props.dimension)return this.initializeCube(e);let t=e.data;if(t instanceof Promise)return t.then((t=>this.initialize(Object.assign({},e,{pixels:t,data:t})))),this;const n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(n&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",(()=>this.initialize(e))),this;const{parameters:i={}}=e,{pixels:r=null,pixelStore:s={},textureUnit:o,mipmaps:a=!0}=e;t||(t=r);let{width:l,height:c,dataFormat:u,type:h,compressed:_=!1}=e;const{depth:d=0}=e,f=Se(e.format);return({width:l,height:c,compressed:_,dataFormat:u,type:h}=this._deduceParameters({format:e.format,type:h,dataFormat:u,compressed:_,data:t,width:l,height:c})),this.width=l,this.height=c,this.glFormat=f,this.type=h,this.dataFormat=u,this.textureUnit=o,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(G.GL.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=a,this.setImageData({data:t,width:l,height:c,depth:d,format:f,type:h,dataFormat:u,parameters:s,compressed:_}),this.setSampler(e.sampler),this._setSamplerParameters(i),a&&this.generateMipmap(),n&&(this._video={video:t,parameters:i,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}initializeCube(e){const{mipmaps:t=!0,parameters:n={}}=e;return this.setCubeMapImageData(e).then((()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(n)})),this}setSampler(e){let t;void 0===e&&(e={}),e instanceof qe?(this.sampler=e,t=e.props):(this.sampler=new qe(this.device,e),t=e);const n=We(t);return this._setSamplerParameters(n),this}resize(e){const{height:t,width:n,mipmaps:i=!1}=e;return n!==this.width||t!==this.height?this.initialize({width:n,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:i}):this}update(){if(this._video){const{video:e,parameters:t,lastTime:n}=this._video;if(n===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e){return void 0===e&&(e={}),this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Be(this.gl,e,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this}setImageData(e){if("3d"===this.props.dimension||"2d-array"===this.props.dimension)return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:n=null,level:i=0,glFormat:r=this.glFormat,offset:s=0,parameters:o={}}=e;let{data:a=null,type:l=this.type,width:c=this.width,height:u=this.height,dataFormat:h=this.dataFormat,compressed:_=!1}=e;a||(a=n),({type:l,dataFormat:h,compressed:_,width:c,height:u}=this._deduceParameters({format:this.props.format,type:l,dataFormat:h,compressed:_,data:a,width:c,height:u}));const{gl:d}=this;d.bindTexture(this.target,this.handle);let f=null;if(({data:a,dataType:f}=this._getDataType({data:a,compressed:_})),Be(this.gl,o,(()=>{switch(f){case"null":case"browser-object":d.texImage2D(t,i,r,c,u,0,h,l,a);break;case"typed-array":d.texImage2D(t,i,r,c,u,0,h,l,a,s);break;case"buffer":this.device.gl.bindBuffer(G.GL.PIXEL_UNPACK_BUFFER,a.handle||a),this.device.gl.texImage2D(t,i,r,c,u,0,h,l,s),this.device.gl.bindBuffer(G.GL.PIXEL_UNPACK_BUFFER,null);break;case"compressed":for(const[e,n]of a.entries())d.compressedTexImage2D(t,e,n.format,n.width,n.height,0,n.data);break;default:(0,A.v)(!1,"Unknown image data type")}})),a&&a.byteLength)this.trackAllocatedMemory(a.byteLength,"Texture");else{const e=be(this.props.format);this.trackAllocatedMemory(this.width*this.height*e,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:n=null,data:i=null,x:r=0,y:s=0,width:o=this.width,height:a=this.height,level:l=0,glFormat:c=this.glFormat,type:u=this.type,dataFormat:h=this.dataFormat,compressed:_=!1,offset:d=0,parameters:f={}}=e;if(({type:u,dataFormat:h,compressed:_,width:o,height:a}=this._deduceParameters({format:this.props.format,type:u,dataFormat:h,compressed:_,data:i,width:o,height:a})),(0,A.v)(1===this.depth,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const e=i;i=e.data,o=e.shape[0],a=e.shape[1]}i instanceof Ye&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Be(this.gl,f,(()=>{_?this.gl.compressedTexSubImage2D(t,l,r,s,o,a,c,i):null===i?this.gl.texSubImage2D(t,l,r,s,o,a,h,u,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(t,l,r,s,o,a,h,u,i,d):"undefined"!=typeof WebGLBuffer&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(G.GL.PIXEL_UNPACK_BUFFER,i),this.device.gl.texSubImage2D(t,l,r,s,o,a,h,u,d),this.device.gl.bindBuffer(G.GL.PIXEL_UNPACK_BUFFER,null)):this.device.gl.texSubImage2D(t,l,r,s,o,a,h,u,i)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(e){return void 0===e&&(e={}),h.R.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(G.GL.ACTIVE_TEXTURE)-G.GL.TEXTURE0}bind(e){void 0===e&&(e=this.textureUnit);const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,this.handle),e}unbind(e){void 0===e&&(e=this.textureUnit);const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:n=!1}=e;return n?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof Ye?{data:t.handle,dataType:"buffer"}:"undefined"!=typeof WebGLBuffer&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:n}=e;let{width:i,height:r,dataFormat:s,type:o,compressed:a}=e;const l=Ce(t);return s=s||l.dataFormat,o=o||l.type,a=a||l.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:s,type:o,compressed:a,width:i,height:r,format:t,data:n}}_deduceImageSize(e,t,n){let i;return i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},(0,A.v)(i,"Could not deduced texture size"),(0,A.v)(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),(0,A.v)(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}async setCubeMapImageData(e){const{gl:t}=this,{width:n,height:i,pixels:r,data:s,format:o=G.GL.RGBA,type:a=G.GL.UNSIGNED_BYTE}=e,l=r||s,c=await Promise.all(Je.FACES.map((e=>{const t=l[e];return Promise.all(Array.isArray(t)?t:[t])})));this.bind(),Je.FACES.forEach(((e,r)=>{c[r].length>1&&!1!==this.props.mipmaps&&h.R.warn(this.id+" has mipmap and multiple LODs.")(),c[r].forEach(((r,s)=>{n&&i?t.texImage2D(e,s,o,n,i,0,o,a,r):t.texImage2D(e,s,o,o,a,r)}))})),this.unbind()}setImageDataForFace(e){const{face:t,width:n,height:i,pixels:r,data:s,format:o=G.GL.RGBA,type:a=G.GL.UNSIGNED_BYTE}=e,{gl:l}=this,c=r||s;return this.bind(),c instanceof Promise?c.then((n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n})))):this.width||this.height?l.texImage2D(t,0,o,n,i,0,o,a,c):l.texImage2D(t,0,o,o,a,c),this}setImageData3D(e){const{level:t=0,dataFormat:n,format:i,type:r,width:s,height:o,depth:a=1,offset:l=0,data:c,parameters:u={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const h=Ce(i);if(Be(this.gl,u,(()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,t,h.format,s,o,a,0,h.dataFormat,h.type,c),c instanceof Ye&&(this.gl.bindBuffer(G.GL.PIXEL_UNPACK_BUFFER,c.handle),this.gl.texImage3D(this.target,t,n,s,o,a,0,i,r,l))})),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const e=be(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*e,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!(0,p.Z)(e)){!function(e){h.R.log(1,"texture sampler parameters",e)()}(e),this.gl.bindTexture(this.target,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),i=n;switch(e){case G.GL.TEXTURE_MIN_LOD:case G.GL.TEXTURE_MAX_LOD:this.gl.texParameterf(this.target,e,i);break;default:this.gl.texParameteri(this.target,e,i)}}this.gl.bindTexture(this.target,null)}}}function $e(e,t){if("string"!=typeof t)return t;const n=Number(t);if(!isNaN(n))return n;const i=e[t=t.replace(/^.*\./,"")];return(0,A.v)(void 0!==i,"Accessing undefined constant GL."+t),i}Je.FACES=[G.GL.TEXTURE_CUBE_MAP_POSITIVE_X,G.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,G.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,G.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,G.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,G.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z];const et="Resource subclass must define virtual methods";class tt extends we.F{constructor(e,t,n){super(e,t,n),this._bound=!1,this.byteLength=0,this.device=Rn.attach(e);const i=this.device.gl,{id:r}=t||{};this.gl=i,this.gl2=i,this.id=r||(0,p.L)(this.constructor.name),this._handle=null==t?void 0:t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0}toString(){return this.constructor.name+"("+this.id+")"}get handle(){return this._handle}delete(e){let{deleteChildren:t=!1}=void 0===e?{}:e;const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this.removeStats(),this._handle=null,n&&t&&n.filter(Boolean).forEach((e=>e.destroy())),this}bind(e){if(void 0===e&&(e=this.handle),"function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t){void 0===t&&(t={}),e=$e(this.gl,e),(0,A.v)(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){if(!(!("extension"in n)||this.gl.getExtension(n.extension)))return n.webgl2}return this._getParameter(e,t)}getParameters(e){void 0===e&&(e={});const{parameters:t,keys:n}=e,i=this.constructor.PARAMETERS||{},r={},s=t||Object.keys(i);for(const o of s){const t=i[o];if(t&&(!("extension"in t)||this.gl.getExtension(t.extension))){const i=n?this.device.getGLKey(o):o;r[i]=this.getParameter(o,e),n&&"GLenum"===t.type&&(r[i]=this.device.getGLKey(r[i]))}}return r}setParameter(e,t){e=$e(this.gl,e),(0,A.v)(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){if(!(!("extension"in n)||this.gl.getExtension(n.extension)))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(t=$e(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,n){return function(e,t,n,i){const r="See luma.gl "+n+" Upgrade Guide at https://luma.gl/docs/upgrade-guide",s=Object.getPrototypeOf(e);i.forEach((e=>{s.methodName||(s[e]=()=>{throw h.R.removed("Calling removed method "+t+"."+e+": ",r)(),new Error(e)})}))}(this,e,t,n)}initialize(e){}_createHandle(){throw new Error(et)}_deleteHandle(){throw new Error(et)}_bindHandle(e){throw new Error(et)}_getOptsFromHandle(){throw new Error(et)}_getParameter(e,t){throw new Error(et)}_setParameter(e,t){throw new Error(et)}}let nt;nt=Symbol.toStringTag;class it extends tt{get[nt](){return"Renderbuffer"}get width(){return this.props.width}get height(){return this.props.height}get format(){return this.props.format}get samples(){return this.props.samples}get attachment(){}static isTextureFormatSupported(e,t){return function(e,t){var n;return Le(e,t)&&(null==(n=Ae[t])?void 0:n.renderbuffer)}(e.gl,t)}constructor(e,t){if("number"==typeof t.format)throw new Error("Renderbuffer");super(e,t,it.defaultProps),this.glFormat=Se(this.props.format),this._initialize(this.props)}resize(e){e.width===this.width&&e.height===this.height||(Object.assign(this.props,{...e,format:this.format,samples:this.samples}),this._initialize(this.props))}_initialize(e){const{format:t,width:n,height:i,samples:r}=e;(0,A.v)(t,"Needs format"),this.trackDeallocatedMemory(),this.gl.bindRenderbuffer(G.GL.RENDERBUFFER,this.handle),0!==r?this.gl.renderbufferStorageMultisample(G.GL.RENDERBUFFER,r,this.glFormat,n,i):this.gl.renderbufferStorage(G.GL.RENDERBUFFER,this.glFormat,n,i),this.gl.bindRenderbuffer(G.GL.RENDERBUFFER,null),this.trackAllocatedMemory(n*i*(r||1)*be(this.glFormat))}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this.trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(G.GL.RENDERBUFFER,e)}}it.defaultProps={id:void 0,handle:void 0,userData:void 0,format:void 0,width:1,height:1,samples:0};class rt extends Oe{get texture(){return this.colorAttachments[0]}constructor(e,t){super(e,t);const n=null===t.handle;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.gl.bindFramebuffer(G.GL.FRAMEBUFFER,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const t=this.colorAttachments[e],n=G.GL.COLOR_ATTACHMENT0+e;t&&this._attachOne(n,t)}this.depthStencilAttachment&&this._attachOne(function(e){const t=Ae[e];if(null==t||!t.attachment)throw new Error(e+" is not a depth stencil format");return t.attachment}(this.depthStencilAttachment.format),this.depthStencilAttachment),this.gl.bindFramebuffer(G.GL.FRAMEBUFFER,null)}!1!==t.check&&this._checkStatus()}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}_checkStatus(){const{gl:e}=this,t=e.bindFramebuffer(G.GL.FRAMEBUFFER,this.handle),n=e.checkFramebufferStatus(G.GL.FRAMEBUFFER);if(e.bindFramebuffer(G.GL.FRAMEBUFFER,t||null),n!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer "+function(e){switch(e){case G.GL.FRAMEBUFFER_COMPLETE:return"success";case G.GL.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Mismatched attachments";case G.GL.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"No attachments";case G.GL.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Height/width mismatch";case G.GL.FRAMEBUFFER_UNSUPPORTED:return"Unsupported or split attachments";case G.GL.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Samples mismatch";default:return""+e}}(n))}createDepthStencilTexture(e){return new it(this.device,{id:this.id+"-depth-stencil",format:e,width:this.width,height:this.height})}resizeAttachments(e,t){if(null===this.handle)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.resize({width:e,height:t});return this.depthStencilAttachment&&this.depthStencilAttachment.resize({width:e,height:t}),this}_attachOne(e,t){if(t instanceof it)return this._attachWEBGLRenderbuffer(e,t),t;if(Array.isArray(t)){const[n,i=0,r=0]=t;return this._attachTexture(e,n,i,r),n}if(t instanceof Je)return this._attachTexture(e,t,0,0),t;throw new Error("attach")}_attachWEBGLRenderbuffer(e,t){this.gl.framebufferRenderbuffer(G.GL.FRAMEBUFFER,e,G.GL.RENDERBUFFER,t.handle)}_attachTexture(e,t,n,i){const{gl:r}=this.device;switch(r.bindTexture(t.target,t.handle),t.target){case G.GL.TEXTURE_2D_ARRAY:case G.GL.TEXTURE_3D:r.framebufferTextureLayer(G.GL.FRAMEBUFFER,e,t.target,i,n);break;case G.GL.TEXTURE_CUBE_MAP:const s=function(e){return e<G.GL.TEXTURE_CUBE_MAP_POSITIVE_X?e+G.GL.TEXTURE_CUBE_MAP_POSITIVE_X:e}(n);r.framebufferTexture2D(G.GL.FRAMEBUFFER,e,s,t.handle,i);break;case G.GL.TEXTURE_2D:r.framebufferTexture2D(G.GL.FRAMEBUFFER,e,G.GL.TEXTURE_2D,t.handle,i);break;default:(0,A.v)(!1,"Illegal texture type")}r.bindTexture(t.target,null)}}class st extends C{constructor(e,t){super(t),this._framebuffer=null,this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(this.device.id+"-canvas"),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new rt(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl)if(this.canvas){const t=this.getDevicePixelRatio(null==e?void 0:e.useDevicePixels);this.setDevicePixelRatio(t,e)}else;}commit(){}}const ot={spector:h.R.get("spector")||h.R.get("inspect")};let at=null,lt=!1;function ct(e){return e.luma=e.luma||{},e.luma}function ut(e,t){return void 0===t&&(t={}),e?t.debug?function(e,t){if(!globalThis.WebGLDebugUtils)return h.R.warn("webgl-debug not loaded")(),e;const n=ct(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...G.GL,...e});const i=globalThis.WebGLDebugUtils.makeDebugContext(e,_t.bind(null,t),dt.bind(null,t));for(const o in G.GL)o in i||"number"!=typeof G.GL[o]||(i[o]=G.GL[o]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,i);const s=Object.create(r);return n.realContext=e,n.debugContext=s,s.debug=!0,s}(e,t):function(e){const t=ct(e);return t.realContext?t.realContext:e}(e):null}function ht(e,t){t=Array.from(t).map((e=>void 0===e?"undefined":e));let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=n.slice(0,100)+(n.length>100?"...":""),"gl."+e+"("+n+")"}function _t(e,t,n,i){i=Array.from(i).map((e=>void 0===e?"undefined":e));const r=globalThis.WebGLDebugUtils.glEnumToString(t)+" in gl."+n+"("+globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i)+")";if(h.R.error(r)(),e.throwOnError)throw new Error(r)}function dt(e,t,n){let i="";if(h.R.level>=1&&(i=ht(t,n),h.R.log(1,i)()),e.break&&e.break.length>0){i=i||ht(t,n);e.break.every((e=>-1!==i.indexOf(e)))}for(const r of n)if(void 0===r){if(i=i||ht(t,n),e.throwOnError)throw new Error("Undefined argument: "+i);h.R.error("Undefined argument: "+i)()}}function ft(e,t,n,i){if(null!=i&&i.inlineSource){const i=function(e,t,n){let i="";for(let r=t-2;r<=t;r++){const s=e[r-1];void 0!==s&&(i+=pt(s,t,n))}return i}(t,n);return"\n"+i+(e.linePos>0?" ".repeat(e.linePos+5)+"^^^\n":"")+e.type.toUpperCase()+": "+e.message+"\n\n"}return null!=i&&i.html?"<div class='luma-compiler-log-error' style=\"color:red;\"><b> "+e.type.toUpperCase()+": "+e.message+"</b></div>":e.type.toUpperCase()+": "+e.message}function pt(e,t,n){const i=null!=n&&n.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return function(e,t){let n="";for(let i=e.length;i<t;++i)n+=" ";return n+e}(String(t),4)+": "+i+(null!=n&&n.html?"<br/>":"\n")}function Et(e,t){return{name:gt(e,t),language:"glsl",version:mt(e)}}function gt(e,t){void 0===t&&(t="unnamed");const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function mt(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}return t}let At,Rt;At=Symbol.toStringTag;class Tt extends we.F{get[At](){return"Shader"}constructor(e,t){super(e,{id:Lt(t),...t},Tt.defaultProps),this.compilationStatus="pending",this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}async debugShader(){switch(this.props.debug){case"never":return;case"errors":if("success"===this.compilationStatus)return}const e=await this.getCompilationInfo();"warnings"===this.props.debug&&0===(null==e?void 0:e.length)||this._displayShaderLog(e)}_displayShaderLog(e){var t,n;if("undefined"==typeof document||null==(t=document)||!t.createElement)return;const i=Et(this.source).name,r=this.stage+" "+i,s=function(e,t,n){let i="";const r=t.split(/\r?\n/),s=e.slice().sort(((e,t)=>e.lineNum-t.lineNum));switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(i+=pt(r[e-1],e,n);s.length>t&&s[t].lineNum===e;){const e=s[t++];i+=ft(e,r,e.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const s of e)i+=ft(s,r,s.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return i}}(e,this.source,{showSourceCode:"all",html:!0}),o=document.createElement("Button");o.innerHTML="\n<h1>Shader Compilation Error in "+r+'</h1><br /><br />\n<code style="user-select:text;"><pre>\n'+s+"\n</pre></code>",o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o);const a=document.getElementsByClassName("luma-compiler-log-error");null!=(n=a[0])&&n.scrollIntoView&&a[0].scrollIntoView(),o.onclick=()=>{const e="data:text/plain,"+encodeURIComponent(this.source);navigator.clipboard.writeText(e)}}}function Lt(e){return Et(e.source).name||e.id||(0,p.L)("unnamed "+e.stage+"-shader")}function vt(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}Tt.defaultProps={...we.F.defaultProps,language:"auto",stage:"vertex",source:"",sourceMap:null,entryPoint:"main",debug:"errors"};class St extends Tt{constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(G.GL.VERTEX_SHADER);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(G.GL.FRAGMENT_SHADER);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){return function(e){const t=e.split(/\r?\n/),n=[];for(const i of t){if(i.length<=1)continue;const e=i.split(":");if(2===e.length){const[t,i]=e;n.push({message:i.trim(),type:vt(t),lineNum:0,linePos:0});continue}const[t,r,s,...o]=e;let a=parseInt(s,10);isNaN(a)&&(a=0);let l=parseInt(r,10);isNaN(l)&&(l=0),n.push({message:o.join(":").trim(),type:vt(t),lineNum:a,linePos:l})}return n}(this.device.gl.getShaderInfoLog(this.handle))}async _compile(e){e=(e=>e.startsWith("#version ")?e:"#version 100\n"+e)(e);const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),0!==h.R.level)if(this.device.features.has("shader-status-async-webgl"))h.R.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),h.R.info(2,"Shader "+this.id+" - async compilation complete: "+this.compilationStatus)(),this._getCompilationStatus(),this.debugShader();else{if(this._getCompilationStatus(),"error"===this.compilationStatus)throw new Error("GLSL compilation errors in "+this.props.stage+" shader "+this.props.id);this.debugShader()}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("shader-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,G.GL.COMPLETION_STATUS))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,G.GL.COMPILE_STATUS)?"success":"error"}}Rt=Symbol.toStringTag;class Ct extends we.F{get[Rt](){return"RenderPass"}constructor(e,t){super(e,t,Ct.defaultProps)}}Ct.defaultProps={...we.F.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1};const bt=6144;class Nt extends Ct{constructor(e,t){super(e,t),this.device=e,Z(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){q(this.device.gl),this.props.framebuffer&&X(this.device,{framebuffer:null})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e){void 0===e&&(e={});const t={};this.props.framebuffer&&(t.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[G.GL.RASTERIZER_DISCARD]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),t.scissorTest=Boolean(e.scissorRect),e.scissorRect&&(t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[G.GL.STENCIL_REF]=e.stencilReference),this.glParameters=t,X(this.device,t)}clear(){const e={...this.glParameters};let t=0;!1!==this.props.clearColor&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&Be(this.device,e,(()=>{this.device.gl.clear(t)}))}clearColorBuffer(e,t){void 0===e&&(e=0),void 0===t&&(t=[0,0,0,0]),Be(this.device.gl,{framebuffer:this.props.framebuffer},(()=>{switch(t.constructor){case Int32Array:this.device.gl.clearBufferiv(bt,e,t);break;case Uint32Array:this.device.gl.clearBufferuiv(bt,e,t);break;case Float32Array:default:this.device.gl.clearBufferfv(bt,e,t)}}))}}var Gt=n(3145);var It=n(7590),yt=n(9282);const wt="Failed to deduce GL constant from typed array";function Ft(e,t){const{clamped:n=!0}=t||{};switch(e){case G.GL.FLOAT:return Float32Array;case G.GL.UNSIGNED_SHORT:case G.GL.UNSIGNED_SHORT_5_6_5:case G.GL.UNSIGNED_SHORT_4_4_4_4:case G.GL.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case G.GL.UNSIGNED_INT:return Uint32Array;case G.GL.UNSIGNED_BYTE:return n?Uint8ClampedArray:Uint8Array;case G.GL.BYTE:return Int8Array;case G.GL.SHORT:return Int16Array;case G.GL.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const Mt={offset:0,stride:0,type:G.GL.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},Pt={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Ot{static getBytesPerElement(e){return Ft(e.type||G.GL.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(e){(0,A.v)(e.size);return Ft(e.type||G.GL.FLOAT).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Ot(...[Mt,...t])}constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>this._assign(e))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Ot.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Ot.getBytesPerVertex(this)}_assign(e){return void 0===e&&(e={}),void 0!==(e=function(e,t,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in t){const t=i[a]?e+"."+i[a]:"N/A";h.R.removed(e+"."+a,t)()}for(const a in r)if(a in t){const t=r[a];h.R.deprecated(e+"."+a,e+"."+t)()}let o=null;for(const[a,l]of Object.entries(s))a in t&&(h.R.deprecated(e+"."+a,e+"."+l)(),o=o||Object.assign({},t),o[l]=t[a],delete o[a]);return o||t}("Accessor",e,Pt)).type&&(this.type=e.type,e.type!==G.GL.INT&&e.type!==G.GL.UNSIGNED_INT||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalize&&(this.normalized=e.normalize),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),void 0===this.offset&&delete this.offset,void 0===this.stride&&delete this.stride,void 0===this.type&&delete this.type,void 0===this.size&&delete this.size,void 0===this.divisor&&delete this.divisor,void 0===this.normalized&&delete this.normalized,void 0===this.integer&&delete this.integer,void 0===this.buffer&&delete this.buffer,void 0===this.index&&delete this.index,this}}const xt=[G.GL.SAMPLER_2D,G.GL.SAMPLER_CUBE,G.GL.SAMPLER_3D,G.GL.SAMPLER_2D_SHADOW,G.GL.SAMPLER_2D_ARRAY,G.GL.SAMPLER_2D_ARRAY_SHADOW,G.GL.SAMPLER_CUBE_SHADOW,G.GL.INT_SAMPLER_2D,G.GL.INT_SAMPLER_3D,G.GL.INT_SAMPLER_CUBE,G.GL.INT_SAMPLER_2D_ARRAY,G.GL.UNSIGNED_INT_SAMPLER_2D,G.GL.UNSIGNED_INT_SAMPLER_3D,G.GL.UNSIGNED_INT_SAMPLER_CUBE,G.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY],Bt={[G.GL.FLOAT]:[G.GL.FLOAT,1,"float","f32","float32"],[G.GL.FLOAT_VEC2]:[G.GL.FLOAT,2,"vec2","vec2<f32>","float32x2"],[G.GL.FLOAT_VEC3]:[G.GL.FLOAT,3,"vec3","vec3<f32>","float32x3"],[G.GL.FLOAT_VEC4]:[G.GL.FLOAT,4,"vec4","vec4<f32>","float32x4"],[G.GL.INT]:[G.GL.INT,1,"int","i32","sint32"],[G.GL.INT_VEC2]:[G.GL.INT,2,"ivec2","vec2<i32>","sint32x2"],[G.GL.INT_VEC3]:[G.GL.INT,3,"ivec3","vec3<i32>","sint32x3"],[G.GL.INT_VEC4]:[G.GL.INT,4,"ivec4","vec4<i32>","sint32x4"],[G.GL.UNSIGNED_INT]:[G.GL.UNSIGNED_INT,1,"uint","u32","uint32"],[G.GL.UNSIGNED_INT_VEC2]:[G.GL.UNSIGNED_INT,2,"uvec2","vec2<u32>","uint32x2"],[G.GL.UNSIGNED_INT_VEC3]:[G.GL.UNSIGNED_INT,3,"uvec3","vec3<u32>","uint32x3"],[G.GL.UNSIGNED_INT_VEC4]:[G.GL.UNSIGNED_INT,4,"uvec4","vec4<u32>","uint32x4"],[G.GL.BOOL]:[G.GL.FLOAT,1,"bool","f32","float32"],[G.GL.BOOL_VEC2]:[G.GL.FLOAT,2,"bvec2","vec2<f32>","float32x2"],[G.GL.BOOL_VEC3]:[G.GL.FLOAT,3,"bvec3","vec3<f32>","float32x3"],[G.GL.BOOL_VEC4]:[G.GL.FLOAT,4,"bvec4","vec4<f32>","float32x4"],[G.GL.FLOAT_MAT2]:[G.GL.FLOAT,8,"mat2","mat2x2<f32>"],[G.GL.FLOAT_MAT2x3]:[G.GL.FLOAT,8,"mat2x3","mat2x3<f32>"],[G.GL.FLOAT_MAT2x4]:[G.GL.FLOAT,8,"mat2x4","mat2x4<f32>"],[G.GL.FLOAT_MAT3x2]:[G.GL.FLOAT,12,"mat3x2","mat3x2<f32>"],[G.GL.FLOAT_MAT3]:[G.GL.FLOAT,12,"mat3","mat3x3<f32>"],[G.GL.FLOAT_MAT3x4]:[G.GL.FLOAT,12,"mat3x4","mat3x4<f32>"],[G.GL.FLOAT_MAT4x2]:[G.GL.FLOAT,16,"mat4x2","mat4x2<f32>"],[G.GL.FLOAT_MAT4x3]:[G.GL.FLOAT,16,"mat4x3","mat4x3<f32>"],[G.GL.FLOAT_MAT4]:[G.GL.FLOAT,16,"mat4","mat4x4<f32>"]};function Dt(e){const t=Bt[e];if(!t)throw new Error("uniform");const[n,i,,r]=t;return{format:r,components:i,glType:n}}function Ut(e){const t=Bt[e];if(!t)throw new Error("attribute");const[,n,,i,r]=t;return{attributeType:i,vertexFormat:r,components:n}}function kt(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o}=i,a=e.getAttribLocation(t,s);if(a>=0){const{attributeType:e}=Ut(o),t=/instance/i.test(s)?"instance":"vertex";n.push({name:s,location:a,stepMode:t,type:e})}}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);const i=function(e,t){const n=(n,i)=>e.getActiveUniformBlockParameter(t,n,i),i=[],r=e.getProgramParameter(t,G.GL.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<r;s++){const r={name:e.getActiveUniformBlockName(t,s)||"",location:n(s,G.GL.UNIFORM_BLOCK_BINDING),byteLength:n(s,G.GL.UNIFORM_BLOCK_DATA_SIZE),vertex:n(s,G.GL.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),fragment:n(s,G.GL.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),uniformCount:n(s,G.GL.UNIFORM_BLOCK_ACTIVE_UNIFORMS),uniforms:[]},o=n(s,G.GL.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)||[],a=e.getActiveUniforms(t,o,G.GL.UNIFORM_TYPE),l=e.getActiveUniforms(t,o,G.GL.UNIFORM_SIZE),c=e.getActiveUniforms(t,o,G.GL.UNIFORM_OFFSET),u=e.getActiveUniforms(t,o,G.GL.UNIFORM_ARRAY_STRIDE);for(let n=0;n<r.uniformCount;++n){const i=e.getActiveUniform(t,o[n]);if(!i)throw new Error("activeInfo");r.uniforms.push({name:i.name,format:Dt(a[n]).format,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}i.push(r)}return i.sort(((e,t)=>e.location-t.location)),i}(e,t);for(const l of i){const e=l.uniforms.map((e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength})));n.bindings.push({type:"uniform",name:l.name,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:e})}const r=function(e,t){const n=[],i=e.getProgramParameter(t,G.GL.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r);if(!i)throw new Error("activeInfo");const{name:s,size:o,type:a}=i,{name:l,isArray:c}=Xt(s);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:o,type:a,isArray:c};if(n.push(h),h.size>1)for(let r=0;r<h.size;r++){const i=l+"["+r+"]";u=e.getUniformLocation(t,i);const s={...h,name:i,location:u};n.push(s)}}return n}(e,t);let s=0;for(const l of r)if(o=l.type,xt.includes(o)){const{viewDimension:e,sampleType:t}=Vt(l.type);n.bindings.push({type:"texture",name:l.name,location:s,viewDimension:e,sampleType:t}),l.textureUnit=s,s+=1}var o;r.length&&(n.uniforms=r);const a=function(e,t){const n=[],i=e.getProgramParameter(t,G.GL.TRANSFORM_FEEDBACK_VARYINGS);for(let r=0;r<i;r++){const i=e.getTransformFeedbackVarying(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o,size:a}=i,{glType:l,components:c}=Dt(o),u={location:r,name:s,accessor:new Ot({type:l,size:a*c})};n.push(u)}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);return null!=a&&a.length&&(n.varyings=a),n}const Ht={[G.GL.SAMPLER_2D]:["2d","float"],[G.GL.SAMPLER_CUBE]:["cube","float"],[G.GL.SAMPLER_3D]:["3d","float"],[G.GL.SAMPLER_2D_SHADOW]:["3d","depth"],[G.GL.SAMPLER_2D_ARRAY]:["2d-array","float"],[G.GL.SAMPLER_2D_ARRAY_SHADOW]:["2d-array","depth"],[G.GL.SAMPLER_CUBE_SHADOW]:["cube","float"],[G.GL.INT_SAMPLER_2D]:["2d","sint"],[G.GL.INT_SAMPLER_3D]:["3d","sint"],[G.GL.INT_SAMPLER_CUBE]:["cube","sint"],[G.GL.INT_SAMPLER_2D_ARRAY]:["2d-array","uint"],[G.GL.UNSIGNED_INT_SAMPLER_2D]:["2d","uint"],[G.GL.UNSIGNED_INT_SAMPLER_3D]:["3d","uint"],[G.GL.UNSIGNED_INT_SAMPLER_CUBE]:["cube","uint"],[G.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY]:["2d-array","uint"]};function Vt(e){const t=Ht[e];if(!t)throw new Error("sampler");const[n,i]=t;return{viewDimension:n,sampleType:i}}function Xt(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name "+e);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function Wt(e,t,n,i){const r=e;let s=i;!0===s&&(s=1),!1===s&&(s=0);const o="number"==typeof s?[s]:s;switch(n){case G.GL.SAMPLER_2D:case G.GL.SAMPLER_CUBE:case G.GL.SAMPLER_3D:case G.GL.SAMPLER_2D_SHADOW:case G.GL.SAMPLER_2D_ARRAY:case G.GL.SAMPLER_2D_ARRAY_SHADOW:case G.GL.SAMPLER_CUBE_SHADOW:case G.GL.INT_SAMPLER_2D:case G.GL.INT_SAMPLER_3D:case G.GL.INT_SAMPLER_CUBE:case G.GL.INT_SAMPLER_2D_ARRAY:case G.GL.UNSIGNED_INT_SAMPLER_2D:case G.GL.UNSIGNED_INT_SAMPLER_3D:case G.GL.UNSIGNED_INT_SAMPLER_CUBE:case G.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY:if("number"!=typeof i)throw new Error("samplers must be set to integers");return e.uniform1i(t,i);case G.GL.FLOAT:return e.uniform1fv(t,o);case G.GL.FLOAT_VEC2:return e.uniform2fv(t,o);case G.GL.FLOAT_VEC3:return e.uniform3fv(t,o);case G.GL.FLOAT_VEC4:return e.uniform4fv(t,o);case G.GL.INT:return e.uniform1iv(t,o);case G.GL.INT_VEC2:return e.uniform2iv(t,o);case G.GL.INT_VEC3:return e.uniform3iv(t,o);case G.GL.INT_VEC4:return e.uniform4iv(t,o);case G.GL.BOOL:return e.uniform1iv(t,o);case G.GL.BOOL_VEC2:return e.uniform2iv(t,o);case G.GL.BOOL_VEC3:return e.uniform3iv(t,o);case G.GL.BOOL_VEC4:return e.uniform4iv(t,o);case G.GL.UNSIGNED_INT:return r.uniform1uiv(t,o,1);case G.GL.UNSIGNED_INT_VEC2:return r.uniform2uiv(t,o,2);case G.GL.UNSIGNED_INT_VEC3:return r.uniform3uiv(t,o,3);case G.GL.UNSIGNED_INT_VEC4:return r.uniform4uiv(t,o,4);case G.GL.FLOAT_MAT2:return e.uniformMatrix2fv(t,!1,o);case G.GL.FLOAT_MAT3:return e.uniformMatrix3fv(t,!1,o);case G.GL.FLOAT_MAT4:return e.uniformMatrix4fv(t,!1,o);case G.GL.FLOAT_MAT2x3:return r.uniformMatrix2x3fv(t,!1,o);case G.GL.FLOAT_MAT2x4:return r.uniformMatrix2x4fv(t,!1,o);case G.GL.FLOAT_MAT3x2:return r.uniformMatrix3x2fv(t,!1,o);case G.GL.FLOAT_MAT3x4:return r.uniformMatrix3x4fv(t,!1,o);case G.GL.FLOAT_MAT4x2:return r.uniformMatrix4x2fv(t,!1,o);case G.GL.FLOAT_MAT4x3:return r.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}class Kt extends Gt.r{constructor(e,t){super(e,t),this.uniforms={},this.bindings={},this.varyings=null,this._uniformCount=0,this._uniformSetters={},this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:i=G.GL.SEPARATE_ATTRIBS}=t;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),this.introspectedLayout=kt(this.device.gl,this.handle),this.shaderLayout=(0,yt.GE)(this.introspectedLayout,t.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":h.R.warn("Primitive topology "+this.props.topology+" is deprecated and will be removed in v9.1")}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e){for(const[t,n]of Object.entries(e)){const e=this.shaderLayout.bindings.find((e=>e.name===t))||this.shaderLayout.bindings.find((e=>e.name===t+"Uniforms"));if(e){switch(n||h.R.warn('Unsetting binding "'+t+'" in render pipeline "'+this.id+'"')(),e.type){case"uniform":if(!(n instanceof Ye||n.buffer instanceof Ye))throw new Error("buffer value");break;case"texture":if(!(n instanceof Je||n instanceof rt))throw new Error("texture value");break;case"sampler":h.R.warn("Ignoring sampler "+t)();break;default:throw new Error(e.type)}this.bindings[t]=n}else{const e=this.shaderLayout.bindings.map((e=>'"'+e.name+'"')).join(", ");h.R.warn('Unknown binding "'+t+'" in render pipeline "'+this.id+'", expected one of '+e)()}}}setUniforms(e){const{bindings:t}=(0,It.l)(e);Object.keys(t).forEach((e=>{h.R.warn('Unsupported value "'+JSON.stringify(t[e])+'" used in setUniforms() for key '+e+". Use setBindings() instead?")()})),Object.assign(this.uniforms,e)}draw(e){var t;if("success"!==this.linkStatus)return!1;const{renderPass:n,vertexArray:i,vertexCount:r,instanceCount:s,firstVertex:o=0,transformFeedback:a}=e,l=function(e){switch(e){case"point-list":return G.GL.POINTS;case"line-list":return G.GL.LINES;case"line-strip":return G.GL.LINE_STRIP;case"line-loop-webgl":return G.GL.LINE_LOOP;case"triangle-list":return G.GL.TRIANGLES;case"triangle-strip":return G.GL.TRIANGLE_STRIP;case"triangle-fan-webgl":return G.GL.TRIANGLE_FAN;default:throw new Error(e)}}(this.props.topology),c=Boolean(i.indexBuffer),u=null==(t=i.indexBuffer)?void 0:t.glIndexType,h=Number(s)>0;if(!this._areTexturesRenderable()||0===r)return!1;this.device.gl.useProgram(this.handle),i.bindBeforeRender(n),a&&a.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const _=n;return function(e,t,n,i){if((0,p.Z)(t))return i(e);Z(e.gl);try{return De(e,t),X(e,n),i(e)}finally{q(e.gl)}}(this.device,this.props.parameters,_.glParameters,(()=>{c&&h?this.device.gl.drawElementsInstanced(l,r||0,u,o,s||0):c?this.device.gl.drawElements(l,r||0,u,o):h?this.device.gl.drawArraysInstanced(l,o,r||0,s||0):this.device.gl.drawArrays(l,o,r||0),a&&a.end()})),i.unbindAfterRender(n),!0}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),h.R.time(4,"linkProgram for "+this.id)(),e.linkProgram(this.handle),h.R.timeEnd(4,"linkProgram for "+this.id)(),h.R.level,!this.device.features.has("shader-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}h.R.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),h.R.info(2,"RenderPipeline "+this.id+" - async linking complete: "+this.linkStatus)();const t=this._getLinkStatus();this._reportLinkStatus(t)}_reportLinkStatus(e){var t;if("success"!==e){if("error"===this.vs.compilationStatus)throw this.vs.debugShader(),new Error("Error during compilation of shader "+this.vs.id);if("error"===(null==(t=this.fs)?void 0:t.compilationStatus))throw this.vs.debugShader(),new Error("Error during compilation of shader "+this.fs.id);throw new Error("Error during "+e+": "+this.device.gl.getProgramInfoLog(this.handle))}}_getLinkStatus(){const{gl:e}=this.device;if(!e.getProgramParameter(this.handle,e.LINK_STATUS))return this.linkStatus="error","linking";e.validateProgram(this.handle);return e.getProgramParameter(this.handle,e.VALIDATE_STATUS)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")}async _waitForLinkComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("shader-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,G.GL.COMPLETION_STATUS))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const[,t]of Object.entries(this.bindings))t instanceof Je&&(t.update(),e=e&&t.loaded);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const r=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!r)throw new Error("No value for binding "+i.name+" in "+this.id);switch(i.type){case"uniform":const{name:s}=i,o=e.getUniformBlockIndex(this.handle,s);if(o===G.GL.INVALID_INDEX)throw new Error("Invalid uniform block name "+s);e.uniformBlockBinding(this.handle,n,o),r instanceof Ye?e.bindBufferBase(G.GL.UNIFORM_BUFFER,n,r.handle):e.bindBufferRange(G.GL.UNIFORM_BUFFER,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof Je||r instanceof rt))throw new Error("texture");let a;if(r instanceof Je)a=r;else{if(!(r instanceof rt&&r.colorAttachments[0]instanceof Je))throw new Error("No texture");h.R.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0]}e.activeTexture(G.GL.TEXTURE0+t),e.bindTexture(a.target,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error("binding type '"+i.type+"' not supported in WebGL")}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){var e;const{name:n,location:i,type:r,textureUnit:s}=t,o=null!=(e=this.uniforms[n])?e:s;void 0!==o&&Wt(this.device.gl,i,r,o)}}}let zt,Yt,jt;zt=Symbol.toStringTag;class Zt extends we.F{get[zt](){return"CommandEncoder"}constructor(e,t){super(e,t,Zt.defaultProps)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}}Zt.defaultProps={...we.F.defaultProps,measureExecutionTime:void 0},Yt=Symbol.toStringTag;class qt extends we.F{get[Yt](){return"CommandBuffer"}constructor(e,t){super(e,t,qt.defaultProps)}}qt.defaultProps={...we.F.defaultProps};class Qt extends qt{constructor(e){super(e,{}),this.commands=[],this.device=e}submitCommands(e){void 0===e&&(e=this.commands);for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Jt(this.device,t.options);break;case"copy-buffer-to-texture":$t(this.device,t.options);break;case"copy-texture-to-buffer":en(this.device,t.options);break;case"copy-texture-to-texture":tn(this.device,t.options)}}}function Jt(e,t){var n,i;const r=t.source,s=t.destination;e.gl.bindBuffer(G.GL.COPY_READ_BUFFER,r.handle),e.gl.bindBuffer(G.GL.COPY_WRITE_BUFFER,s.handle),e.gl.copyBufferSubData(G.GL.COPY_READ_BUFFER,G.GL.COPY_WRITE_BUFFER,null!=(n=t.sourceOffset)?n:0,null!=(i=t.destinationOffset)?i:0,t.size),e.gl.bindBuffer(G.GL.COPY_READ_BUFFER,null),e.gl.bindBuffer(G.GL.COPY_WRITE_BUFFER,null)}function $t(e,t){throw new Error("Not implemented")}function en(e,t){const{source:n,mipLevel:i=0,aspect:r="all",width:s=t.source.width,height:o=t.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:_}=t;if("all"!==r)throw new Error("not supported");if(0!==i||0!==a||h||_)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:f}=nn(n);try{const t=c,n=s||d.width,i=o||d.height,r=Ce(d.texture.format),a=r.dataFormat,h=r.type;e.gl.bindBuffer(G.GL.PIXEL_PACK_BUFFER,t.handle),e.gl.bindFramebuffer(G.GL.FRAMEBUFFER,d.handle),e.gl.readPixels(l[0],l[1],n,i,a,h,u)}finally{e.gl.bindBuffer(G.GL.PIXEL_PACK_BUFFER,null),e.gl.bindFramebuffer(G.GL.FRAMEBUFFER,null),f&&d.destroy()}}function tn(e,t){const{source:n,origin:i=[0,0],destination:r}=t;let{width:s=t.destination.width,height:o=t.destination.width}=t;const a=G.GL.RGBA,{framebuffer:l,destroyFramebuffer:c}=nn(n),[u,h]=i;e.gl.bindFramebuffer(G.GL.FRAMEBUFFER,l.handle);let _,d=null;if(!(r instanceof Je))throw new Error("whoops");return d=r,s=Number.isFinite(s)?s:d.width,o=Number.isFinite(o)?o:d.height,d.bind(0),_=d.destination,e.gl.copyTexImage2D(_,0,a,u,h,s,o,0),d&&d.unbind(),c&&l.destroy(),d}function nn(e){if(e instanceof Pe){const{width:t,height:n,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:"framebuffer-for-"+i,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class rn extends Zt{constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Qt(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}}jt=Symbol.toStringTag;class sn extends we.F{get[jt](){return"VertexArray"}constructor(e,t){super(e,t,sn.defaultProps),this.indexBuffer=null,this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=(0,yt.Mr)(t.renderPipeline.shaderLayout,t.renderPipeline.bufferLayout,this.maxVertexAttributes)}}sn.defaultProps={...we.F.defaultProps,renderPipeline:null};var on=n(1649),an=n(7651);let ln,cn;ln=Symbol.toStringTag;class un extends sn{get[ln](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"===(0,an.A)()}constructor(e,t){super(e,t),this.buffer=null,this.bufferValue=null,this.init=!1,this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){var e;(super.destroy(),this.buffer)&&(null==(e=this.buffer)||e.destroy());this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==G.GL.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(G.GL.ELEMENT_ARRAY_BUFFER,t?t.handle:null),this.indexBuffer=t}setBuffer(e,t){const n=t;if(n.glTarget===G.GL.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setIndexBuffer()");const{size:i,type:r,stride:s,offset:o,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(G.GL.ARRAY_BUFFER,n.handle),l?this.device.gl.vertexAttribIPointer(e,i,r,s,o):this.device.gl.vertexAttribPointer(e,i,r,a,s,o),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n}setConstant(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){if(this.device.gl.bindVertexArray(this.handle),!this.init){const e=this.indexBuffer;this.device.gl.bindBuffer(G.GL.ELEMENT_ARRAY_BUFFER,(null==e?void 0:e.handle)||null),this.init=!0}this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttribute(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error("Unknown attribute location "+e);const n=oe(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t){void 0===t&&(t=!0);const n=un.isConstantAttributeZeroSupported(this.device);(t||(n||0!==e))&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),i=n.byteLength*e,r=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error("Buffer size is immutable, byte length "+i+" !== "+this.buffer.byteLength+".");let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue),s){const e=(0,on.oF)(t.constructor,r);(0,on.R2)({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}cn=Symbol.toStringTag;class hn extends we.F{get[cn](){return"TransformFeedback"}constructor(e,t){super(e,t,hn.defaultProps)}}hn.defaultProps={...we.F.defaultProps,layout:void 0,buffers:{}};class _n extends hn{constructor(e,t){super(e,t),this.buffers={},this.unusedBuffers={},this.bindOnUse=!0,this._bound=!1,this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e){void 0===e&&(e="point-list"),this.gl.bindTransformFeedback(G.GL.TRANSFORM_FEEDBACK,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return G.GL.POINTS;case"line-list":case"line-strip":case"line-loop-webgl":return G.GL.LINES;case"triangle-list":case"triangle-strip":case"triangle-fan-webgl":return G.GL.TRIANGLES;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(G.GL.TRANSFORM_FEEDBACK,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind((()=>{for(const t in e)this.setBuffer(t,e[t])}))}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:r,byteOffset:s}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=i,void h.R.warn(this.id+" unusedBuffers varying buffer "+e)();this.buffers[n]={buffer:i,byteLength:r,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,r)}getBuffer(e){if(dn(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e){if(void 0===e&&(e=this.handle),"function"!=typeof e)return this.gl.bindTransformFeedback(G.GL.TRANSFORM_FEEDBACK,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(G.GL.TRANSFORM_FEEDBACK,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(G.GL.TRANSFORM_FEEDBACK,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Ye)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(dn(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(G.GL.TRANSFORM_FEEDBACK_BUFFER,Number(e),null)}_bindBuffer(e,t,n,i){void 0===n&&(n=0);const r=t&&t.handle;r&&void 0!==i?this.gl.bindBufferRange(G.GL.TRANSFORM_FEEDBACK_BUFFER,e,r,n,i):this.gl.bindBufferBase(G.GL.TRANSFORM_FEEDBACK_BUFFER,e,r)}}function dn(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}function fn(e){switch(e){case G.GL.ALPHA:case G.GL.R32F:case G.GL.RED:return 1;case G.GL.RG32F:case G.GL.RG:return 2;case G.GL.RGB:case G.GL.RGB32F:return 3;case G.GL.RGBA:case G.GL.RGBA32F:return 4;default:return(0,A.v)(!1),0}}function pn(e,t){var n;const{sourceX:i=0,sourceY:r=0,sourceFormat:s=G.GL.RGBA,sourceAttachment:o=G.GL.COLOR_ATTACHMENT0}=t||{};let{target:a=null,sourceWidth:l,sourceHeight:c,sourceType:u}=t||{};const{framebuffer:h,deleteFramebuffer:_}=gn(e);(0,A.v)(h);const{gl:d,handle:f}=h;l=l||h.width,c=c||h.height;const p=o-G.GL.COLOR_ATTACHMENT0;u=u||(null==(n=h.colorAttachments[p])?void 0:n.type)||G.GL.UNSIGNED_BYTE,a=function(e,t,n,i,r){if(e)return e;const s=Ft(t=t||G.GL.UNSIGNED_BYTE,{clamped:!1}),o=fn(n);return new s(i*r*o)}(a,u,s,l,c),u=u||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return G.GL.FLOAT;case Uint16Array:return G.GL.UNSIGNED_SHORT;case Uint32Array:return G.GL.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return G.GL.UNSIGNED_BYTE;case Int8Array:return G.GL.BYTE;case Int16Array:return G.GL.SHORT;case Int32Array:return G.GL.INT;default:throw new Error(wt)}}(a);const E=d.bindFramebuffer(G.GL.FRAMEBUFFER,f);return d.readPixels(i,r,l,c,s,u,a),d.bindFramebuffer(G.GL.FRAMEBUFFER,E||null),_&&h.destroy(),a}function En(e,t){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:s=G.GL.RGBA,targetByteOffset:o=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=gn(e);(0,A.v)(u),a=a||u.width,l=l||u.height;const _=u;c=c||G.GL.UNSIGNED_BYTE;let d=n;if(!d){const e=o+a*l*fn(s)*function(e){switch(e){case G.GL.UNSIGNED_BYTE:return 1;case G.GL.UNSIGNED_SHORT_5_6_5:case G.GL.UNSIGNED_SHORT_4_4_4_4:case G.GL.UNSIGNED_SHORT_5_5_5_1:return 2;case G.GL.FLOAT:return 4;default:return(0,A.v)(!1),0}}(c);d=_.device.createBuffer({byteLength:e})}const f=e.device.createCommandEncoder();return f.copyTextureToBuffer({source:e,width:a,height:l,origin:[i,r],destination:d,byteOffset:o}),f.destroy(),h&&u.destroy(),d}function gn(e){return e instanceof Oe?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:mn(e),deleteFramebuffer:!0}}function mn(e,t){const{device:n,width:i,height:r,id:s}=e;return n.createFramebuffer({...t,id:"framebuffer-for-"+s,width:i,height:r,colorAttachments:[e]})}const An="clear: bad arguments";class Rn extends m{static isSupported(){return"undefined"!=typeof WebGL2RenderingContext}get features(){return this._features=this._features||Ge(this.gl),this._features}get limits(){var e;return this._limits=this._limits||{maxTextureDimension1D:0,maxTextureDimension2D:(e=this.gl).getParameter(G.GL.MAX_TEXTURE_SIZE),maxTextureDimension3D:e.getParameter(G.GL.MAX_3D_TEXTURE_SIZE),maxTextureArrayLayers:e.getParameter(G.GL.MAX_ARRAY_TEXTURE_LAYERS),maxBindGroups:1,maxDynamicUniformBuffersPerPipelineLayout:0,maxDynamicStorageBuffersPerPipelineLayout:0,maxSampledTexturesPerShaderStage:e.getParameter(G.GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxSamplersPerShaderStage:e.getParameter(G.GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxStorageBuffersPerShaderStage:0,maxStorageTexturesPerShaderStage:0,maxUniformBuffersPerShaderStage:e.getParameter(G.GL.MAX_UNIFORM_BUFFER_BINDINGS),maxUniformBufferBindingSize:e.getParameter(G.GL.MAX_UNIFORM_BLOCK_SIZE),maxStorageBufferBindingSize:0,minUniformBufferOffsetAlignment:e.getParameter(G.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT),minStorageBufferOffsetAlignment:0,maxVertexBuffers:0,maxVertexAttributes:e.getParameter(G.GL.MAX_VERTEX_ATTRIBS),maxVertexBufferArrayStride:2048,maxInterStageShaderComponents:e.getParameter(G.GL.MAX_VARYING_COMPONENTS),maxComputeWorkgroupStorageSize:0,maxComputeInvocationsPerWorkgroup:0,maxComputeWorkgroupSizeX:0,maxComputeWorkgroupSizeY:0,maxComputeWorkgroupSizeZ:0,maxComputeWorkgroupsPerDimension:0},this._limits}static attach(e){if(e instanceof Rn)return e;if((null==e?void 0:e.device)instanceof m)return e.device;if(!function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");return new Rn({gl:e})}static async create(e){void 0===e&&(e={}),h.R.groupCollapsed(1,"WebGLDevice created")(),"string"==typeof e.canvas&&await C.pageLoaded,(h.R.get("debug")||e.debug)&&await async function(){(0,u.A)()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await(0,xe.k0)("https://unpkg.com/webgl-debug@2.0.1/index.js"))}();const{spector:t}=e;if((h.R.get("spector")||t)&&await async function(e){if(!globalThis.SPECTOR)try{await(0,xe.k0)("https://spectorcdn.babylonjs.com/spector.bundle.js")}catch(t){h.R.warn(String(t))}}(),h.R.probe(2,"DOM is loaded")(),e.gl&&e.gl.device)return Rn.attach(e.gl);const n=new Rn(e),i="Created "+n.info.type+(n.debug?" debug":"")+" context: "+n.info.vendor+", "+n.info.renderer+" for canvas: "+n.canvasContext.id;return h.R.probe(1,i)(),h.R.table(1,n.info)(),h.R.groupEnd(1)(),n}constructor(e){var t,n;super({...e,id:e.id||(0,p.L)("webgl-device")}),this.renderPass=null,this.debug=!1,this._canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1},this._extensions={},this._polyfilled=!1;const i=null==(t=e.gl)?void 0:t.device;if(i)throw new Error("WebGL context already attached to device "+i.id);const r=e.canvas||(null==(n=e.gl)?void 0:n.canvas);this.canvasContext=new st(this,{...e,canvas:r}),this.lost=new Promise((e=>{this._resolveContextLost=e}));let s=e.gl||null;if(s=s||((0,u.A)()?function(e,t){t={...$,...t};let n=null;const i=e=>n=e.statusMessage||n;e.addEventListener("webglcontextcreationerror",i,!1);let r=null;if(r||(r=e.getContext("webgl2",t)),e.removeEventListener("webglcontextcreationerror",i,!1),!r)throw new Error("Failed to create WebGL context: "+(n||"Unknown error"));if(t.onContextLost){const{onContextLost:n}=t;e.addEventListener("webglcontextlost",(e=>n(e)),!1)}if(t.onContextRestored){const{onContextRestored:n}=t;e.addEventListener("webglcontextrestored",(e=>n(e)),!1)}return r}(this.canvasContext.canvas,{...e,onContextLost:e=>{var t;return null==(t=this._resolveContextLost)?void 0:t.call(this,{reason:"destroyed",message:"Computer entered sleep mode, or too many apps or browser tabs are using the GPU."})}}):null),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=this.handle,this.canvasContext.resize(),this.info=ee(this.gl),this.gl.device=this,this.gl._version=this.isWebGL2?2:1;const{enable:o=!0,copyState:a=!1}=e;if(j(this.gl,{enable:o,copyState:a,log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.R.log(1,...t)()}}),(0,u.A)()&&e.debug&&(this.gl=ut(this.gl,{...e,throwOnError:!0}),this.debug=!0,h.R.level=Math.max(h.R.level,1),h.R.warn("WebGL debug mode activated. Performance reduced.")()),(0,u.A)()&&e.spector){const t=this.handle.canvas||e.canvas;this.spector=function(e){var t,n,i,r;if(null==(t=e={...ot,...e})||!t.spector)return null;if(!at&&globalThis.SPECTOR&&(h.R.probe(1,"SPECTOR found and initialized")(),at=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=at)),!at)return null;if(lt||(lt=!0,at.spyCanvases(),null==(i=at)||i.onCaptureStarted.add((e=>h.R.info("Spector capture started:",e)())),null==(r=at)||r.onCapture.add((e=>{var t,n,i;h.R.info("Spector capture complete:",e)(),null==(t=at)||t.getResultUI(),null==(n=at)||n.resultView.display(),null==(i=at)||i.resultView.addCapture(e)}))),null!=(n=e)&&n.canvas){var s,o;if("string"==typeof e.spector&&e.spector!==e.canvas.id)return at;null==(s=at)||s.startCapture(null==(o=e)?void 0:o.canvas,500),new Promise((e=>setTimeout(e,2e3))).then((e=>{var t;h.R.info("Spector capture stopped after 2 seconds")(),null==(t=at)||t.stopCapture()}))}return at}({...this.props,canvas:t})}}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return Le(this.gl,e)}isTextureFormatFilterable(e){return function(e,t){const n=ve(t);if(!Le(e,n))return!1;try{if(re(n).signed)return!1}catch{return!1}return n.endsWith("32float")?Boolean(e.getExtension("OES_texture_float_linear")):!n.endsWith("16float")||Boolean(e.getExtension("OES_texture_half_float_linear"))}(this.gl,e)}isTextureFormatRenderable(e){return function(e,t){const n=ve(t);return!!Le(e,n)&&"number"!=typeof n}(this.gl,e)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._getBufferProps(e);return new Ye(this,t)}_createTexture(e){return new Je(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new qe(this,e)}createShader(e){return new St(this,e)}createFramebuffer(e){return new rt(this,e)}createRenderPipeline(e){return new Kt(this,e)}createVertexArray(e){return new un(this,e)}beginRenderPass(e){return new Nt(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}createTransformFeedback(e){return new _n(this,e)}getDefaultRenderPass(){return this.renderPass=this.renderPass||this.beginRenderPass({framebuffer:this.canvasContext.getCurrentFramebuffer()}),this.renderPass}createCommandEncoder(e){return new rn(this,e)}submit(){var e;null==(e=this.renderPass)||e.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return pn(e,t)}readPixelsToBufferWebGL(e,t){return En(e,t)}setParametersWebGL(e){X(this,e)}getParametersWebGL(e){return W(this,e)}withParametersWebGL(e,t){Be(this,e,t)}clearWebGL(e){!function(e,t){const{framebuffer:n=null,color:i=null,depth:r=null,stencil:s=null}=t||{},o={};n&&(o.framebuffer=n);let a=0;i&&(a|=16384,!0!==i&&(o.clearColor=i)),r&&(a|=256,!0!==r&&(o.clearDepth=r)),s&&(a|=1024,!0!==r&&(o.clearStencil=r)),(0,A.v)(0!==a,An),Be(e,o,(()=>{e.gl.clear(a)}))}(this,e)}get webglLimits(){return this._webglLimits=this._webglLimits||function(e){function t(t){return e.getParameter(t)}function n(t,n){return e.getParameter(t)||n}return{[G.GL.ALIASED_LINE_WIDTH_RANGE]:t(G.GL.ALIASED_LINE_WIDTH_RANGE),[G.GL.ALIASED_POINT_SIZE_RANGE]:t(G.GL.ALIASED_POINT_SIZE_RANGE),[G.GL.MAX_TEXTURE_SIZE]:t(G.GL.MAX_TEXTURE_SIZE),[G.GL.MAX_CUBE_MAP_TEXTURE_SIZE]:t(G.GL.MAX_CUBE_MAP_TEXTURE_SIZE),[G.GL.MAX_TEXTURE_IMAGE_UNITS]:t(G.GL.MAX_TEXTURE_IMAGE_UNITS),[G.GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS]:t(G.GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS),[G.GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS]:t(G.GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS),[G.GL.MAX_RENDERBUFFER_SIZE]:t(G.GL.MAX_RENDERBUFFER_SIZE),[G.GL.MAX_VARYING_VECTORS]:t(G.GL.MAX_VARYING_VECTORS),[G.GL.MAX_VERTEX_ATTRIBS]:t(G.GL.MAX_VERTEX_ATTRIBS),[G.GL.MAX_VERTEX_UNIFORM_VECTORS]:t(G.GL.MAX_VERTEX_UNIFORM_VECTORS),[G.GL.MAX_FRAGMENT_UNIFORM_VECTORS]:t(G.GL.MAX_FRAGMENT_UNIFORM_VECTORS),[G.GL.MAX_VIEWPORT_DIMS]:t(G.GL.MAX_VIEWPORT_DIMS),[G.GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]:t(G.GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT),[G.GL.MAX_3D_TEXTURE_SIZE]:n(G.GL.MAX_3D_TEXTURE_SIZE),[G.GL.MAX_ARRAY_TEXTURE_LAYERS]:n(G.GL.MAX_ARRAY_TEXTURE_LAYERS),[G.GL.MAX_COLOR_ATTACHMENTS]:n(G.GL.MAX_COLOR_ATTACHMENTS),[G.GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:n(G.GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS),[G.GL.MAX_COMBINED_UNIFORM_BLOCKS]:n(G.GL.MAX_COMBINED_UNIFORM_BLOCKS),[G.GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:n(G.GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS),[G.GL.MAX_DRAW_BUFFERS]:n(G.GL.MAX_DRAW_BUFFERS),[G.GL.MAX_ELEMENT_INDEX]:n(G.GL.MAX_ELEMENT_INDEX),[G.GL.MAX_ELEMENTS_INDICES]:n(G.GL.MAX_ELEMENTS_INDICES),[G.GL.MAX_ELEMENTS_VERTICES]:n(G.GL.MAX_ELEMENTS_VERTICES),[G.GL.MAX_FRAGMENT_INPUT_COMPONENTS]:n(G.GL.MAX_FRAGMENT_INPUT_COMPONENTS),[G.GL.MAX_FRAGMENT_UNIFORM_BLOCKS]:n(G.GL.MAX_FRAGMENT_UNIFORM_BLOCKS),[G.GL.MAX_FRAGMENT_UNIFORM_COMPONENTS]:n(G.GL.MAX_FRAGMENT_UNIFORM_COMPONENTS),[G.GL.MAX_SAMPLES]:n(G.GL.MAX_SAMPLES),[G.GL.MAX_TEXTURE_LOD_BIAS]:n(G.GL.MAX_TEXTURE_LOD_BIAS),[G.GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:n(G.GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS),[G.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:n(G.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS),[G.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:n(G.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS),[G.GL.MAX_UNIFORM_BLOCK_SIZE]:n(G.GL.MAX_UNIFORM_BLOCK_SIZE),[G.GL.MAX_UNIFORM_BUFFER_BINDINGS]:n(G.GL.MAX_UNIFORM_BUFFER_BINDINGS),[G.GL.MAX_VARYING_COMPONENTS]:n(G.GL.MAX_VARYING_COMPONENTS),[G.GL.MAX_VERTEX_OUTPUT_COMPONENTS]:n(G.GL.MAX_VERTEX_OUTPUT_COMPONENTS),[G.GL.MAX_VERTEX_UNIFORM_BLOCKS]:n(G.GL.MAX_VERTEX_UNIFORM_BLOCKS),[G.GL.MAX_VERTEX_UNIFORM_COMPONENTS]:n(G.GL.MAX_VERTEX_UNIFORM_COMPONENTS),[G.GL.MIN_PROGRAM_TEXEL_OFFSET]:n(G.GL.MIN_PROGRAM_TEXEL_OFFSET),[G.GL.MAX_PROGRAM_TEXEL_OFFSET]:n(G.GL.MAX_PROGRAM_TEXEL_OFFSET),[G.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:n(G.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT)}}(this.gl),this._webglLimits}loseDevice(){var e;let t=!1;const n=this.gl.getExtension("WEBGL_lose_context");return n&&(t=!0,n.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){Z(this.gl)}popState(){q(this.gl)}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){t=t||this.gl2||this.gl;const n=Number(e);for(const i in t)if(t[i]===n)return"GL."+i;return String(e)}setConstantAttribute(e,t){this._constants=this._constants||new Array(this.limits.maxVertexAttributes).fill(null);const n=this._constants[e];switch(n&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,t)&&h.R.info(1,"setConstantAttribute("+e+") could have been skipped, value unchanged")(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n);break;default:(0,A.v)(!1)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:(0,A.v)(!1)}}}Rn.type="webgl";class Tn extends E.h{constructor(e,t){super(e,t),this.device=e,this.byteLength=function(e){var t;return e.byteLength||(null==(t=e.data)?void 0:t.byteLength)||0}(t);const n=Boolean(t.data),i=4*Math.ceil(this.byteLength/4);this.handle=this.props.handle||this.device.handle.createBuffer({size:i,usage:this.props.usage||GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:this.props.mappedAtCreation||n,label:this.props.id}),t.data&&this._writeMapped(t.data),n&&!t.mappedAtCreation&&this.handle.unmap()}destroy(){this.handle.destroy()}write(e,t){void 0===t&&(t=0),this.device.handle.queue.writeBuffer(this.handle,t,e.buffer,e.byteOffset,e.byteLength)}async readAsync(e,t){void 0===e&&(e=0),void 0===t&&(t=this.byteLength);const n=new Tn(this.device,{usage:E.h.MAP_READ|E.h.COPY_DST,byteLength:t}),i=this.device.handle.createCommandEncoder();i.copyBufferToBuffer(this.handle,e,n.handle,0,t),this.device.handle.queue.submit([i.finish()]),await n.handle.mapAsync(GPUMapMode.READ,e,t);const r=n.handle.getMappedRange().slice(0);return n.handle.unmap(),n.destroy(),new Uint8Array(r)}_writeMapped(e){const t=this.handle.getMappedRange();new e.constructor(t).set(e)}mapAsync(e,t,n){return void 0===t&&(t=0),this.handle.mapAsync(e,t,n)}getMappedRange(e,t){return void 0===e&&(e=0),this.handle.getMappedRange(e,t)}unmap(){this.handle.unmap()}}function Ln(e){if(e.includes("webgl"))throw new Error("webgl-only format");return e}class vn extends Ze{constructor(e,t){super(e,t),this.device=e;const n={...this.props};"comparison-sampler"!==n.type&&delete n.compare,this.handle=this.handle||this.device.handle.createSampler(n),this.handle.label=this.props.id}destroy(){}}const Sn={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Cn extends Pe{constructor(e,t){super(e,t),this.height=1,this.width=1,this.device=e,t.data instanceof Promise?t.data.then((e=>{this.props={...t,data:e},this.initialize(this.props)})):this.initialize(t)}initialize(e){var t;this.handle=this.props.handle||this.createHandle(),(t=this.handle).label||(t.label=this.id),this.props.data&&this.setData({data:this.props.data}),this.width=this.handle.width,this.height=this.handle.height,this.sampler=e.sampler instanceof vn?e.sampler:new vn(this.device,e.sampler),this.view=this.createView()}createHandle(){var e,t;const n=this.props.width||(null==(e=this.props.data)?void 0:e.width)||1,i=this.props.height||(null==(t=this.props.data)?void 0:t.height)||1;return this.device.handle.createTexture({label:this.id,size:{width:n,height:i,depthOrArrayLayers:this.props.depth},dimension:Sn[this.props.dimension],format:Ln(this.props.format),usage:this.props.usage,mipLevelCount:this.props.mipLevels,sampleCount:this.props.samples})}destroy(){this.handle.destroy()}setSampler(e){return this.sampler=e instanceof vn?e:new vn(this.device,e),this}setData(e){return this.setImage({source:e.data})}setImage(e){const{source:t,width:n=e.source.width,height:i=e.source.height,depth:r=1,sourceX:s=0,sourceY:o=0,mipLevel:a=0,x:l=0,y:c=0,z:u=0,aspect:h="all",colorSpace:_="srgb",premultipliedAlpha:d=!1}=e;return this.device.handle.queue.copyExternalImageToTexture({source:t,origin:[s,o]},{texture:this.handle,origin:[l,c,u],mipLevel:a,aspect:h,colorSpace:_,premultipliedAlpha:d},[n,i,r]),{width:n,height:i}}createView(){return this.handle.createView({label:this.id})}}let bn;bn=Symbol.toStringTag;class Nn extends we.F{get[bn](){return"ExternalTexture"}constructor(e,t){super(e,t,Nn.defaultProps)}}Nn.defaultProps={...we.F.defaultProps,source:null,colorSpace:"srgb"};class Gn extends Nn{constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.importExternalTexture({source:t.source,colorSpace:t.colorSpace}),this.sampler=null}destroy(){}setSampler(e){return this.sampler=e instanceof vn?e:new vn(this.device,e),this}}class In extends Tt{constructor(e,t){super(e,t),this.device=e,this.device.handle.pushErrorScope("validation"),this.handle=this.props.handle||this.createHandle(),this.handle.label=this.props.id,this._checkCompilationError(this.device.handle.popErrorScope())}async _checkCompilationError(e){const t=await e;if(t){this.debugShader();const e=await this.getCompilationInfo();throw h.R.error("Shader compilation error: "+t.message,e)(),new Error("Shader compilation error: "+t.message)}}destroy(){}async getCompilationInfo(){return(await this.handle.getCompilationInfo()).messages}createHandle(){const{source:e,stage:t}=this.props;let n=this.props.language;switch("auto"===n&&(n=e.includes("->")?"wgsl":"glsl"),n){case"wgsl":return this.device.handle.createShaderModule({code:e});case"glsl":return this.device.handle.createShaderModule({code:e,transform:e=>this.device.glslang.compileGLSL(e,t)});default:throw new Error(n)}}}function yn(e){return e.depthStencil=e.depthStencil||{format:"depth24plus",stencilFront:{},stencilBack:{},depthWriteEnabled:!1,depthCompare:"less-equal"},e.depthStencil}const wn={cullMode:(e,t,n)=>{n.primitive=n.primitive||{},n.primitive.cullMode=t},frontFace:(e,t,n)=>{n.primitive=n.primitive||{},n.primitive.frontFace=t},depthWriteEnabled:(e,t,n)=>{yn(n).depthWriteEnabled=t},depthCompare:(e,t,n)=>{yn(n).depthCompare=t},depthFormat:(e,t,n)=>{yn(n).format=t},depthBias:(e,t,n)=>{yn(n).depthBias=t},depthBiasSlopeScale:(e,t,n)=>{yn(n).depthBiasSlopeScale=t},depthBiasClamp:(e,t,n)=>{yn(n).depthBiasClamp=t},stencilReadMask:(e,t,n)=>{yn(n).stencilReadMask=t},stencilWriteMask:(e,t,n)=>{yn(n).stencilWriteMask=t},stencilCompare:(e,t,n)=>{const i=yn(n);i.stencilFront.compare=t,i.stencilBack.compare=t},stencilPassOperation:(e,t,n)=>{const i=yn(n);i.stencilFront.passOp=t,i.stencilBack.passOp=t},stencilFailOperation:(e,t,n)=>{const i=yn(n);i.stencilFront.failOp=t,i.stencilBack.failOp=t},stencilDepthFailOperation:(e,t,n)=>{const i=yn(n);i.stencilFront.depthFailOp=t,i.stencilBack.depthFailOp=t},sampleCount:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.count=t},sampleMask:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.mask=t},sampleAlphaToCoverageEnabled:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.alphaToCoverageEnabled=t},colorMask:(e,t,n)=>{Pn(n)[0].writeMask=t},blendColorOperation:(e,t,n)=>{Pn(n)}},Fn={primitive:{cullMode:"back",topology:"triangle-list"},vertex:{module:void 0,entryPoint:"main"},fragment:{module:void 0,entryPoint:"main",targets:[]},layout:"auto"};function Mn(e,t){void 0===t&&(t={}),Object.assign(e,{...Fn,...e}),function(e,t){for(const[n,i]of Object.entries(t)){const t=wn[n];if(!t)throw new Error("Illegal parameter "+n);t(n,i,e)}}(e,t)}function Pn(e){var t,n,i,r,s;if(e.fragment.targets=(null==(t=e.fragment)?void 0:t.targets)||[],!Array.isArray(null==(n=e.fragment)?void 0:n.targets))throw new Error("colorstate");0===(null==(i=e.fragment)||null==(i=i.targets)?void 0:i.length)&&(null==(s=e.fragment.targets)||s.push({}));return null==(r=e.fragment)?void 0:r.targets}function On(e,t,n,i){const r=function(e,t){const n=[];for(const[i,r]of Object.entries(e)){const e=xn(t,i);e&&n.push(Bn(r,e.location))}return n}(i,n);return e.createBindGroup({layout:t,entries:r})}function xn(e,t){const n=e.bindings.find((e=>e.name===t||e.name+"uniforms"===t.toLocaleLowerCase()));return n||h.R.warn("Binding "+t+" not set: Not found in shader layout.")(),n}function Bn(e,t){if(e instanceof E.h)return{binding:t,resource:{buffer:e.handle}};if(e instanceof Ze)return{binding:t,resource:e.handle};if(e instanceof Pe)return{binding:t,resource:e.handle.createView({label:"bind-group-auto-created"})};throw new Error("invalid binding")}var Dn=n(1970);function Un(e){if(e.endsWith("-webgl"))throw new Error("WebGPU does not support vertex format "+e);return e}function kn(e,t){const n=[],i=new Set;for(const r of t){const t=[];let s="vertex",o=0;if(r.attributes)for(const n of r.attributes){const a=Hn(e,n.attribute,i);s=a.stepMode||(a.name.startsWith("instance")?"instance":"vertex"),t.push({format:Un(n.format||r.format),offset:n.byteOffset,shaderLocation:a.location}),o+=(0,Dn.w)(r.format).byteLength}else{const n=Hn(e,r.name,i);if(!n)continue;o=(0,Dn.w)(r.format).byteLength,s=n.stepMode||(n.name.startsWith("instance")?"instance":"vertex"),t.push({format:Un(r.format),offset:0,shaderLocation:n.location})}n.push({arrayStride:r.byteStride||o,stepMode:s,attributes:t})}for(const r of e.attributes)i.has(r.name)||n.push({arrayStride:(0,Dn.w)("float32x3").byteLength,stepMode:r.stepMode||(r.name.startsWith("instance")?"instance":"vertex"),attributes:[{format:Un("float32x3"),offset:0,shaderLocation:r.location}]});return n}function Hn(e,t,n){const i=e.attributes.find((e=>e.name===t));if(!i)return h.R.warn("Unknown attribute "+t)(),null;if(n.has(t))throw new Error("Duplicate attribute "+t);return n.add(t),i}class Vn extends Gt.r{constructor(e,t){if(super(e,t),this.fs=null,this._bindGroupLayout=null,this._bindGroup=null,this.device=e,this.handle=this.props.handle,!this.handle){const e=this._getRenderPipelineDescriptor();h.R.groupCollapsed(1,"new WebGPURenderPipeline("+this.id+")")(),h.R.probe(1,JSON.stringify(e,null,2))(),h.R.groupEnd(1)(),this.handle=this.device.handle.createRenderPipeline(e)}this.handle.label=this.props.id,this.vs=t.vs,this.fs=t.fs}destroy(){}setBindings(e){Object.assign(this.props.bindings,e)}setUniforms(e){if(!(0,p.Z)(e))throw new Error("WebGPU does not support uniforms")}draw(e){const t=e.renderPass||this.device.getDefaultRenderPass();t.handle.setPipeline(this.handle);const n=this._getBindGroup();n&&t.handle.setBindGroup(0,n),e.vertexArray.bindBeforeRender(e.renderPass),e.indexCount?t.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):t.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstInstance),e.vertexArray.unbindAfterRender(e.renderPass)}_getBindGroup(){return this._bindGroupLayout=this._bindGroupLayout||this.handle.getBindGroupLayout(0),this._bindGroup=this._bindGroup||On(this.device.handle,this._bindGroupLayout,this.props.shaderLayout,this.props.bindings),this._bindGroup}_getRenderPipelineDescriptor(){const e={module:this.props.vs.handle,entryPoint:this.props.vsEntryPoint||"main",buffers:kn(this.props.shaderLayout,this.props.bufferLayout)};let t;var n;this.props.fs&&(t={module:this.props.fs.handle,entryPoint:this.props.fsEntryPoint||"main",targets:[{format:Ln(null==(n=this.device)||null==(n=n.canvasContext)?void 0:n.format)}]});switch(this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":throw new Error("WebGPU does not support primitive topology "+this.props.topology)}const i={vertex:e,fragment:t,primitive:{topology:this.props.topology},layout:"auto"};return Mn(i,this.props.parameters),i}}let Xn,Wn;Xn=Symbol.toStringTag;class Kn extends we.F{get[Xn](){return"ComputePipeline"}constructor(e,t){super(e,t,Kn.defaultProps),this.hash=""}}Kn.defaultProps={...we.F.defaultProps,cs:void 0,csEntryPoint:void 0,csConstants:{},shaderLayout:[]};class zn extends Kn{constructor(e,t){super(e,t),this.device=e;const n=this.props.cs;this.handle=this.props.handle||this.device.handle.createComputePipeline({label:this.props.id,compute:{module:n.handle,entryPoint:this.props.csEntryPoint},layout:"auto"})}_getBindGroupLayout(){return this.handle.getBindGroupLayout(0)}}class Yn extends Ct{constructor(e,t){void 0===t&&(t={}),super(e,t),this.pipeline=null,this.device=e;const n=t.framebuffer||e.canvasContext.getCurrentFramebuffer(),i=this.getRenderPassDescriptor(n);h.R.groupCollapsed(3,"new WebGPURenderPass("+this.id+")")(),h.R.probe(3,JSON.stringify(i,null,2))(),h.R.groupEnd(3)(),this.handle=this.props.handle||e.commandEncoder.beginRenderPass(i),this.handle.label=this.props.id}destroy(){}end(){this.handle.end()}setPipeline(e){this.pipeline=e,this.handle.setPipeline(this.pipeline.handle)}setBindings(e){var t,n;null==(t=this.pipeline)||t.setBindings(e);const i=null==(n=this.pipeline)?void 0:n._getBindGroup();i&&this.handle.setBindGroup(0,i)}setIndexBuffer(e,t,n,i){void 0===n&&(n=0),this.handle.setIndexBuffer(e.handle,t,n,i)}setVertexBuffer(e,t,n){void 0===n&&(n=0),this.handle.setVertexBuffer(e,t.handle,n)}draw(e){e.indexCount?this.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):this.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstIndex,e.firstInstance)}drawIndirect(){}setParameters(e){const{blendConstant:t,stencilReference:n,scissorRect:i,viewport:r}=e;t&&this.handle.setBlendConstant(t),n&&this.handle.setStencilReference(n),i&&this.handle.setScissorRect(i[0],i[1],i[2],i[3]),r&&this.handle.setViewport(r[0],r[1],r[2],r[3],r[4],r[5])}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}getRenderPassDescriptor(e){const t={colorAttachments:[]};if(t.colorAttachments=e.colorAttachments.map((e=>({loadOp:!1!==this.props.clearColor?"clear":"load",colorClearValue:this.props.clearColor||[0,0,0,0],storeOp:this.props.discard?"discard":"store",view:e.createView()}))),e.depthStencilAttachment){t.depthStencilAttachment={view:e.depthStencilAttachment.createView()};const{depthStencilAttachment:n}=t;this.props.depthReadOnly&&(n.depthReadOnly=!0),n.depthClearValue=this.props.clearDepth||0;!0&&(n.depthLoadOp=!1!==this.props.clearDepth?"clear":"load",n.depthStoreOp="store");!1&&(n.stencilLoadOp=!1!==this.props.clearStencil?"clear":"load",n.stencilStoreOp="store")}return t}}Wn=Symbol.toStringTag;class jn extends we.F{get[Wn](){return"ComputePass"}constructor(e,t){super(e,t,we.F.defaultProps)}}jn.defaultProps={...we.F.defaultProps};class Zn extends jn{constructor(e,t){var n;super(e,t),this._bindGroupLayout=null,this.device=e,this.handle=this.props.handle||(null==(n=e.commandEncoder)?void 0:n.beginComputePass({label:this.props.id}))}destroy(){}end(){this.handle.end()}setPipeline(e){const t=e;this.handle.setPipeline(t.handle),this._bindGroupLayout=t._getBindGroupLayout()}setBindings(e){throw new Error("fix me")}dispatch(e,t,n){this.handle.dispatchWorkgroups(e,t,n)}dispatchIndirect(e,t){void 0===t&&(t=0);const n=e;this.handle.dispatchWorkgroupsIndirect(n.handle,t)}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}}class qn extends sn{get[Symbol.toStringTag](){return"WebGPUVertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"===(0,an.A)()}constructor(e,t){super(e,t),this.device=e}destroy(){}setIndexBuffer(e){this.indexBuffer=e}setBuffer(e,t){this.attributes[e]=t}setConstant(e,t){h.R.warn(this.id+" constant attributes not supported on WebGPU")}bindBeforeRender(e,t,n){const i=e,r=this.indexBuffer;null!=r&&r.handle&&(h.R.warn("setting index buffer",null==r?void 0:r.handle,null==r?void 0:r.indexType)(),i.handle.setIndexBuffer(null==r?void 0:r.handle,null==r?void 0:r.indexType));for(let s=0;s<this.maxVertexAttributes;s++){const e=this.attributes[s];null!=e&&e.handle&&(h.R.warn("setting vertex buffer "+s,null==e?void 0:e.handle)(),i.handle.setVertexBuffer(s,null==e?void 0:e.handle))}}unbindAfterRender(e){}}class Qn extends Oe{constructor(e,t){super(e,t),this.device=e,this.autoCreateAttachmentTextures()}}class Jn extends C{constructor(e,t,n){super(n),this.format=navigator.gpu.getPreferredCanvasFormat(),this.depthStencilFormat="depth24plus",this.depthStencilAttachment=null,this.device=e,this.width=-1,this.height=-1,this._setAutoCreatedCanvasId(this.device.id+"-canvas"),this.gpuCanvasContext=this.canvas.getContext("webgpu"),this.format="bgra8unorm"}destroy(){this.gpuCanvasContext.unconfigure()}getCurrentFramebuffer(){this.update();const e=this.getCurrentTexture();return this.width=e.width,this.height=e.height,this._createDepthStencilAttachment(),new Qn(this.device,{colorAttachments:[e],depthStencilAttachment:this.depthStencilAttachment})}update(){const[e,t]=this.getPixelSize();(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.depthStencilAttachment&&(this.depthStencilAttachment.destroy(),this.depthStencilAttachment=null),this.gpuCanvasContext.configure({device:this.device.handle,format:Ln(this.format),colorSpace:this.props.colorSpace,alphaMode:this.props.alphaMode}),h.R.log(1,"Resized to "+this.width+"x"+this.height+"px")())}resize(e){this.update()}getCurrentTexture(){return this.device._createTexture({id:this.id+"#color-texture",handle:this.gpuCanvasContext.getCurrentTexture()})}_createDepthStencilAttachment(){return this.depthStencilAttachment||(this.depthStencilAttachment=this.device.createTexture({id:this.id+"#depth-stencil-texture",format:this.depthStencilFormat,width:this.width,height:this.height,usage:GPUTextureUsage.RENDER_ATTACHMENT})),this.depthStencilAttachment}}class $n extends m{static isSupported(){return Boolean("undefined"!=typeof navigator&&navigator.gpu)}static async create(e){if(!navigator.gpu)throw new Error("WebGPU not available. Open in Chrome Canary and turn on chrome://flags/#enable-unsafe-webgpu");h.R.groupCollapsed(1,"WebGPUDevice created")();const t=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!t)throw new Error("Failed to request WebGPU adapter");const n=await t.requestAdapterInfo();h.R.probe(2,"Adapter available",n)();const i=await t.requestDevice({requiredFeatures:t.features});h.R.probe(1,"GPUDevice available")(),"string"==typeof e.canvas&&(await C.pageLoaded,h.R.probe(1,"DOM is loaded")());const r=new $n(i,t,n,e);return h.R.probe(1,"Device created. For more info, set chrome://flags/#enable-webgpu-developer-features")(),h.R.table(1,r.info)(),h.R.groupEnd(1)(),r}constructor(e,t,n,i){super({...i,id:i.id||(0,p.L)("webgpu-device")}),this.canvasContext=null,this.commandEncoder=null,this.renderPass=null,this._isLost=!1,this.handle=e,this.adapter=t;const[r,s]=(n.driver||"").split(" Version "),o=n.vendor||this.adapter.__brand||"unknown",a=r||"",l=s||"",c="apple"===o?"apple":"unknown",u=n.architecture||"unknown",h=n.backend||"unknown",_=(n.type||"").split(" ")[0].toLowerCase()||"unknown";this._info={type:"webgpu",vendor:o,renderer:a,version:l,gpu:c,gpuType:_,gpuBackend:h,gpuArchitecture:u,shadingLanguage:"wgsl",shadingLanguageVersion:100},this.lost=new Promise((async e=>{const t=await this.handle.lost;this._isLost=!0,e({reason:"destroyed",message:t.message})})),this.canvasContext=new Jn(this,this.adapter,{canvas:i.canvas,height:i.height,width:i.width,container:i.container}),this.features=this._getFeatures()}destroy(){this.handle.destroy()}get info(){return this._info}get limits(){return this.handle.limits}isTextureFormatSupported(e){return!e.includes("webgl")}isTextureFormatFilterable(e){return this.isTextureFormatSupported(e)}isTextureFormatRenderable(e){return this.isTextureFormatSupported(e)}get isLost(){return this._isLost}createBuffer(e){const t=this._getBufferProps(e);return new Tn(this,t)}_createTexture(e){return new Cn(this,e)}createExternalTexture(e){return new Gn(this,e)}createShader(e){return new In(this,e)}createSampler(e){return new vn(this,e)}createRenderPipeline(e){return new Vn(this,e)}createFramebuffer(e){throw new Error("Not implemented")}createComputePipeline(e){return new zn(this,e)}createVertexArray(e){return new qn(this,e)}beginRenderPass(e){return this.commandEncoder=this.commandEncoder||this.handle.createCommandEncoder(),new Yn(this,e)}beginComputePass(e){return this.commandEncoder=this.commandEncoder||this.handle.createCommandEncoder(),new Zn(this,e)}createTransformFeedback(e){throw new Error("Transform feedback not supported in WebGPU")}createCanvasContext(e){return new Jn(this,this.adapter,e)}getDefaultRenderPass(){throw new Error("a")}submit(){var e;const t=null==(e=this.commandEncoder)?void 0:e.finish();t&&this.handle.queue.submit([t]),this.commandEncoder=null}_getFeatures(){const e=new Set(this.handle.features);e.has("depth-clamping")&&(e.delete("depth-clamping"),e.add("depth-clip-control")),e.has("texture-compression-bc")&&e.add("texture-compression-bc5-webgl");const t=["webgpu","wgsl","timer-query-webgl","float32-filterable-linear-webgl","float16-filterable-linear-webgl","texture-filterable-anisotropic-webgl","float32-renderable-webgl","float16-renderable-webgl"];for(const n of t)e.add(n);return e}copyExternalImageToTexture(e){var t;const{source:n,sourceX:i=0,sourceY:r=0,texture:s,mipLevel:o=0,aspect:a="all",colorSpace:l="display-p3",premultipliedAlpha:c=!1,width:u=s.width,height:h=s.height,depth:_=1}=e,d=s;null==(t=this.handle)||t.queue.copyExternalImageToTexture({source:n,origin:[i,r]},{texture:d.handle,origin:[0,0,0],mipLevel:o,aspect:a,colorSpace:l,premultipliedAlpha:c},[u,h,_])}}$n.type="webgpu",T.registerDevices([Rn,$n]);let ei,ti={};const ni=(0,c.vt)((e=>({deviceType:void 0,deviceError:void 0,device:void 0,setDeviceType:async t=>{let n,i;try{i=await async function(e){return ti[e]=ti[e]||T.createDevice({type:e,height:0,container:(ei||(ei=document.createElement("div"),ei.style.display="none",document.body.appendChild(ei)),ei)}),await ti[e]}(t)}catch(r){n=r.message}return e((e=>({deviceType:t,deviceError:n,device:i})))}})));ni.getState().setDeviceType("webgl");var ii,ri,si=n(6065);function oi(e,t){return t||(t=e.slice(0)),e.raw=t,e}const ai=si.Ay.div(ii||(ii=oi(["\n  display: flex;\n  flex-direction: row;\n\n  & > * + * {\n    margin-left: 2px;\n  }\n"]))),li=si.Ay.div((e=>"\n  cursor: pointer;\n  padding: 10px 20px;\n  font-weight: bold;\n  &:hover {\n    background-color: #eeefef;\n  }\n  "+(e.isSelected?"\n    color: #276EF1;\n    border-bottom: 4px solid #276EF1;\n  ":"")+"\n")),ci=si.Ay.div(ri||(ri=oi(["\n  background-color: rgb(250, 248, 245);\n"]))),ui=e=>{var t,n;const{children:r}=e,s=i.Children.toArray(r),[o,a]=(0,i.useState)((null==(t=s[0])?void 0:t.props.tag)||(null==(n=s[0])?void 0:n.props.title));let l=void 0!==e.selectedItem?e.selectedItem:o;const c=void 0!==e.setSelectedItem?e.setSelectedItem:a;return s.some((e=>(e.props.tag||e.props.title)===l))||(l=o),i.createElement(i.Fragment,null,i.createElement(ai,null,s.map((e=>i.createElement(li,{key:e.props.title,isSelected:(e.props.tag||e.props.title)===l,onClick:()=>c(e.props.tag||e.props.title)},e.props.title)))),i.createElement(ci,null,s.find((e=>(e.props.tag||e.props.title)===l))))},hi=e=>{const{children:t}=e;return i.createElement(i.Fragment,null,t)};var _i=n(9813);const di=e=>{const t=ni((e=>e.deviceType)),n=ni((e=>e.deviceError)),r=ni((e=>e.setDeviceType));return i.createElement(ui,{selectedItem:t,setSelectedItem:r},i.createElement(hi,{key:"WebGL2",title:"WebGL2",tag:"webgl"},n),i.createElement(hi,{key:"WebGPU",title:"WebGPU",tag:"webgpu"},n))},fi=()=>i.createElement(_i.A,null,(()=>i.createElement(di,null)));const pi=e=>{let{f:t}=e;const n=ni((e=>e.device)),r=n?n.info[t]:"N/A";return i.createElement("code",{style:{color:"darkgreen"}},r)},Ei=e=>{let{f:t}=e;const n=ni((e=>e.device));return i.createElement("code",{style:{color:"darkgreen"}},function(e,t){return e?e.limits[t]?String(e.limits[t]):"0 \u274c":"N/A"}(n,t))},gi=e=>{let{f:t}=e;const n=ni((e=>e.device));return i.createElement("span",null,function(e,t){return e?e.features.has(t)?"\u2705":"\u274c":"N/A"}(n,t))},mi=e=>{let{f:t}=e;const n=ni((e=>e.device));return i.createElement("span",{key:t},function(e,t){const n=e&&e.isTextureFormatSupported(t);return e?n?"\u2705":"\u274c":"N/A"}(n,t))},Ai=e=>{let{f:t}=e;const n=ni((e=>e.device));return i.createElement("span",null,function(e,t){const n=e&&e.isTextureFormatSupported(t)&&e.isTextureFormatFilterable(t);return e?n?"\u2705":"\u274c":"N/A"}(n,t))},Ri=e=>{let{f:t}=e;const n=ni((e=>e.device)),i=t,r=n&&n.isTextureFormatSupported(i)&&n.isTextureFormatRenderable(i);return n?r?"\u2705":"\u274c":"N/A"},Ti=e=>{let{f:t}=e;const n=ni((e=>e.device)),r=n instanceof Rn?n:null,s=r?r.webglLimits[G.GL[t]]?String(r.webglLimits[G.GL[t]]):"0 \u274c":"N/A";return i.createElement("code",{style:{color:"darkgreen"}},s)},Li=e=>{let{f:t}=e;const n=ni((e=>e.device)),r=n instanceof Rn?n:null,s=r?r.gl.getSupportedExtensions():[];return i.createElement("ul",null,s.map((e=>i.createElement("li",{key:e,style:{color:"darkgreen"}},i.createElement("a",{href:"https://www.khronos.org/registry/webgl/extensions/"+e,target:"_blank"},e)))))};let vi=0;const Si={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:T.stats.get("animation-loop-"+vi++),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class Ci{constructor(e){if(this.device=null,this.canvas=null,this.animationProps=null,this.timeline=null,this.needsRedraw="initialized",this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.props={...Si,...e},!(e=this.props).device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new _.A({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return null!=(e=this.device)&&e.isLost||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:null==(e=this.device)||null==(e=e.canvasContext)?void 0:e.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=(null==(e=this.device.canvasContext)?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,i]=(null==(e=this.device)||null==(e=e.canvasContext)?void 0:e.getPixelSize())||[1,1];let r=1;const s=null==(t=this.device)||null==(t=t.canvasContext)?void 0:t.canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:n>0&&i>0&&(r=n/i),{width:n,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e;this.props.autoResizeDrawingBuffer&&(null==(e=this.device)||null==(e=e.canvasContext)||e.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}"undefined"!=typeof window&&(window.website=!0);const bi=e=>{let t="ssr";const[n,r]=(0,i.useState)(null),s=(0,i.useRef)(new WeakMap),o=(0,i.useRef)(null),a=ni((e=>e.deviceType));return t=e.container||"luma-example-container-"+a,(0,i.useEffect)((()=>{if(!n||s.current.get(n))return;s.current.set(n,!0);let i=null,r=null;const l=async()=>{var s;n.style.width="100%",n.style.height="100%",r=await T.createDevice({type:a,canvas:n,container:t}),i=function(e,t){let n=null;const i=(null==t?void 0:t.device)||T.createDevice(),r=new Ci({...t,device:i,async onInitialize(t){var i;return n=new e(t),await(null==(i=n)?void 0:i.onInitialize(t))},onRender:e=>{var t;return null==(t=n)?void 0:t.onRender(e)},onFinalize:e=>{var t;return null==(t=n)?void 0:t.onFinalize(e)}});return r.getInfo=()=>this.AnimationLoopTemplateCtor.info,r}(e.template,{device:r,autoResizeViewport:!0,autoResizeDrawingBuffer:!0}),null==(s=i)||s.start();const o="https://raw.githubusercontent.com/visgl/luma.gl/master";e.directory?(0,xe.Qj)(o+"/examples/"+e.directory+"/"+e.id+"/"):(0,xe.Qj)(o+"/website/static/images/")};return o.current=Promise.resolve(o.current).then((()=>{l().catch((e=>{console.error("start "+a+" failed",e)}))})),()=>{o.current=Promise.resolve(o.current).then((()=>{i&&(i.destroy(),i=null),r&&r.destroy()})).catch((e=>{console.error("unmounting "+a+" failed",e)}))}}),[a,n]),i.createElement("canvas",{key:a,ref:r})}},1020:(e,t,n)=>{var i=n(6540),r=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var i,s={},c=null,u=null;for(i in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:r,type:e,key:c,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},4848:(e,t,n)=>{e.exports=n(1020)},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var i=n(6540);const r={},s=i.createContext(r);function o(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);