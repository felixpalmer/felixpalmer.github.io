/*! For license information please see 264e03f9.bf9da653.js.LICENSE.txt */
"use strict";(self.webpackChunkwebsite_docusaurus=self.webpackChunkwebsite_docusaurus||[]).push([[9465],{2344:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>l,default:()=>d,frontMatter:()=>a,metadata:()=>c,toc:()=>_});var r=n(5893),i=n(1151),s=n(9750),o=n(5852);const a={},l="Lighting",c={id:"tutorials/lighting",title:"Lighting",description:"This tutorial will expand on the previous one, but we'll add some lighting to enhance the feeling of 3D in the scene. To accomplish this, we'll use one of luma.gl's built-in shader modules for the first time.",source:"@site/../docs/tutorials/lighting.mdx",sourceDirName:"tutorials",slug:"/tutorials/lighting",permalink:"/luma.gl/docs/tutorials/lighting",draft:!1,unlisted:!1,editUrl:"https://github.com/visgl/luma.gl/tree/main/docs/../docs/tutorials/lighting.mdx",tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Hello Cube",permalink:"/luma.gl/docs/tutorials/hello-cube"},next:{title:"Hello Instancing",permalink:"/luma.gl/docs/tutorials/hello-instancing"}},u={},_=[];function h(e){const t={code:"code",h1:"h1",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"lighting",children:"Lighting"}),"\n",(0,r.jsx)(s.z_,{}),"\n",(0,r.jsx)(o.vm,{}),"\n",(0,r.jsxs)(t.p,{children:["This tutorial will expand on the previous one, but we'll add some lighting to enhance the feeling of 3D in the scene. To accomplish this, we'll use one of ",(0,r.jsx)(t.strong,{children:"luma.gl"}),"'s built-in shader modules for the first time."]}),"\n",(0,r.jsxs)(t.p,{children:["To start, we'll add the ",(0,r.jsx)(t.code,{children:"phongLighting"})," module from ",(0,r.jsx)(t.strong,{children:"@luma.gl/shadertools"})," to our imports:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"import {AnimationLoop, Model, CubeGeometry} from '@luma.gl/engine';\nimport {Texture2D, clear, setParameters} from '@luma.gl/webgl';\nimport {phongLighting} from '@luma.gl/shadertools';\nimport {Matrix4} from '@math.gl/core';\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"phongLighting"})," shader module adds functions to our fragment shader to facilitate lighting calculations."]}),"\n",(0,r.jsx)(t.p,{children:"We'll modify our shaders to perform our lighting calculations in the following ways:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["We'll input the surface ",(0,r.jsx)(t.code,{children:"normals"})," as an attribute."]}),"\n",(0,r.jsxs)(t.li,{children:["We'll pass the world positions and normals to the fragment shader in ",(0,r.jsx)(t.code,{children:"varying"}),"s"]}),"\n",(0,r.jsxs)(t.li,{children:["We'll call ",(0,r.jsx)(t.code,{children:"lighting_getLightColor"}),", which will be added to our fragment shader by the ",(0,r.jsx)(t.code,{children:"phongLighting"})," module, to calculate the final fragment color."]}),"\n"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"const vs = `\\\n  attribute vec3 positions;\n  attribute vec3 normals;\n  attribute vec2 texCoords;\n\n  uniform mat4 uModel;\n  uniform mat4 uMVP;\n\n  varying vec3 vPosition;\n  varying vec3 vNormal;\n  varying vec2 vUV;\n\n  void main(void) {\n    vPosition = (uModel * vec4(positions, 1.0)).xyz;\n    vNormal = mat3(uModel) * normals;\n    vUV = texCoords;\n    gl_Position = uMVP * vec4(positions, 1.0);\n  }\n`;\n\nconst fs = `\\\n  precision highp float;\n\n  uniform sampler2D uTexture;\n  uniform vec3 uEyePosition;\n\n  varying vec3 vPosition;\n  varying vec3 vNormal;\n  varying vec2 vUV;\n\n  void main(void) {\n    vec3 materialColor = texture2D(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n    vec3 surfaceColor = lighting_getLightColor(materialColor, uEyePosition, vPosition, normalize(vNormal));\n\n    gl_FragColor = vec4(surfaceColor, 1.0);\n  }\n`;\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Our ",(0,r.jsx)(t.code,{children:"onInitialize"})," method needs a few significant updates:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"  override onInitialize({device}) {\n    setParameters(device, {\n      depthTest: true,\n      depthFunc: gl.LEQUAL\n    });\n\n    const texture = device.createTexture({data: 'vis-logo.png'});\n\n    const eyePosition = [0, 0, 5];\n    const modelMatrix = new Matrix4();\n    const viewMatrix = new Matrix4().lookAt({eye: eyePosition});\n    const mvpMatrix = new Matrix4();\n\n    const model = new Model(device, {\n      vs,\n      fs,\n      geometry: new CubeGeometry(),\n      uniforms: {\n        uTexture: texture,\n        uEyePosition: eyePosition\n      },\n      modules: [phongLighting],\n      moduleSettings: {\n        material: {\n          specularColor: [255, 255, 255]\n        },\n        lights: [\n          {\n            type: 'ambient',\n            color: [255, 255, 255]\n          },\n          {\n            type: 'point',\n            color: [255, 255, 255],\n            position: [1, 2, 1]\n          }\n        ]\n      }\n    });\n\n    return {\n      model,\n      modelMatrix,\n      viewMatrix,\n      mvpMatrix\n    };\n  }\n"})}),"\n",(0,r.jsxs)(t.p,{children:["We're splitting the model matrix out on its own so we can use it in our shaders to transform the positions and normals for the lighting calculations. The biggest change, however, is the ",(0,r.jsx)(t.code,{children:"moduleSettings"})," parameter we're passing to our ",(0,r.jsx)(t.code,{children:"Model"})," constructor. ",(0,r.jsx)(t.code,{children:"moduleSettings"})," are passed on to shader modules to help them set up uniforms. In this case, we're passing some material and light properties that ",(0,r.jsx)(t.code,{children:"phongLighting"})," uses to perform its lighting calculations in ",(0,r.jsx)(t.code,{children:"lighting_getLightColor"}),"."]}),"\n",(0,r.jsxs)(t.p,{children:["Our ",(0,r.jsx)(t.code,{children:"onRender"})," doesn't change much except to set up the model matrix separately from the MVP matrix and pass it as a uniform:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"  override onRender({device, aspect, tick, model, mvpMatrix, viewMatrix}) {\n    modelMatrix\n      .identity()\n      .rotateX(tick * 0.01)\n      .rotateY(tick * 0.013);\n\n    mvpMatrix\n      .perspective({fovy: Math.PI / 3, aspect})\n      .multiplyRight(viewMatrix)\n      .multiplyRight(modelMatrix);\n\n    clear(device, {color: [0, 0, 0, 1], depth: true});\n\n    model.setUniforms({uMVP: mvpMatrix, uModel: modelMatrix}).draw();\n  }\n"})}),"\n",(0,r.jsx)(t.p,{children:'If all went well, you should see a scene almost identical to the one from the previous "hello cube" tutorial but with some white light reflecting off the cube.'}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"import {AnimationLoop, Model, CubeGeometry} from '@luma.gl/engine';\nimport {Texture2D, clear, setParameters} from '@luma.gl/webgl';\nimport {phongLighting} from '@luma.gl/shadertools';\nimport {Matrix4} from '@math.gl/core';\n\nconst vs = `\\\n  attribute vec3 positions;\n  attribute vec3 normals;\n  attribute vec2 texCoords;\n\n  uniform mat4 uModel;\n  uniform mat4 uMVP;\n\n  varying vec3 vPosition;\n  varying vec3 vNormal;\n  varying vec2 vUV;\n\n  void main(void) {\n    vPosition = (uModel * vec4(positions, 1.0)).xyz;\n    vNormal = mat3(uModel) * normals;\n    vUV = texCoords;\n    gl_Position = uMVP * vec4(positions, 1.0);\n  }\n`;\n\nconst fs = `\\\n  precision highp float;\n\n  uniform sampler2D uTexture;\n  uniform vec3 uEyePosition;\n\n  varying vec3 vPosition;\n  varying vec3 vNormal;\n  varying vec2 vUV;\n\n  void main(void) {\n    vec3 materialColor = texture2D(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n    vec3 surfaceColor = lighting_getLightColor(materialColor, uEyePosition, vPosition, normalize(vNormal));\n\n    gl_FragColor = vec4(surfaceColor, 1.0);\n  }\n`;\n\nconst loop = new AnimationLoop({\n  override onInitialize({device}) {\n    setParameters(device, {\n      depthTest: true,\n      depthFunc: gl.LEQUAL\n    });\n\n    const texture = device.createTexture({data: 'vis-logo.png'});\n\n    const eyePosition = [0, 0, 5];\n    const modelMatrix = new Matrix4();\n    const viewMatrix = new Matrix4().lookAt({eye: eyePosition});\n    const mvpMatrix = new Matrix4();\n\n    const model = new Model(device, {\n      vs,\n      fs,\n      geometry: new CubeGeometry(),\n      uniforms: {\n        uTexture: texture,\n        uEyePosition: eyePosition\n      },\n      modules: [phongLighting],\n      moduleSettings: {\n        material: {\n          specularColor: [255, 255, 255]\n        },\n        lights: [\n          {\n            type: 'ambient',\n            color: [255, 255, 255]\n          },\n          {\n            type: 'point',\n            color: [255, 255, 255],\n            position: [1, 2, 1]\n          }\n        ]\n      }\n    });\n\n    return {\n      model,\n      modelMatrix,\n      viewMatrix,\n      mvpMatrix\n    };\n  },\n\n  override onRender({device, aspect, tick, model, mvpMatrix, viewMatrix}) {\n    modelMatrix\n      .identity()\n      .rotateX(tick * 0.01)\n      .rotateY(tick * 0.013);\n\n    mvpMatrix\n      .perspective({fovy: Math.PI / 3, aspect})\n      .multiplyRight(viewMatrix)\n      .multiplyRight(modelMatrix);\n\n    clear(device, {color: [0, 0, 0, 1], depth: true});\n\n    model.setUniforms({uMVP: mvpMatrix, uModel: modelMatrix}).draw();\n  }\n});\n\nloop.start();\n"})})]})}function d(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},180:(e,t,n)=>{n.d(t,{GL:()=>r});var r=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e}(r||{})},8404:(e,t,n)=>{n.d(t,{TX:()=>l,G5:()=>a,uX:()=>_});var r=n(4575);const i={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},s={f32:4,f16:2,i32:4,u32:4};var o=n(1477);function a(e,t){const n={};for(const r of e.attributes)n[r.name]=c(e,t,r.name);return n}function l(e,t,n){void 0===n&&(n=16);const r=a(e,t),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function c(e,t,n){const a=function(e,t){const n=e.attributes.find((e=>e.name===t));n||r.c.warn('shader layout attribute "'+t+'" not present in shader');return n||null}(e,n),l=function(e,t){u(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);if(n)return n;if(n=function(e,t){for(const r of e){var n;let e=r.byteStride;if("number"!=typeof r.byteStride)for(const t of r.attributes||[]){e+=(0,o.$)(t.format).byteLength}const i=null==(n=r.attributes)?void 0:n.find((e=>e.attribute===t));if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:e}}return null}(e,t),n)return n;return r.c.warn('layout for attribute "'+t+'" not present in buffer layout'),null}(t,n);if(!a)return null;const c=function(e){const[t,n]=i[e],r="i32"===t||"u32"===t,o="u32"!==t,a=s[t]*n,l=function(e,t){let n;switch(e){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?n:n+"x"+t}(t,n);return{dataType:t,components:n,defaultVertexFormat:l,byteLength:a,integer:r,signed:o}}(a.type),_=(null==l?void 0:l.vertexFormat)||c.defaultVertexFormat,h=(0,o.$)(_);return{attributeName:(null==l?void 0:l.attributeName)||a.name,bufferName:(null==l?void 0:l.bufferName)||a.name,location:a.location,shaderType:a.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:_,bufferDataType:h.type,bufferComponents:h.components,normalized:h.normalized,integer:c.integer,stepMode:(null==l?void 0:l.stepMode)||a.stepMode,byteOffset:(null==l?void 0:l.byteOffset)||0,byteStride:(null==l?void 0:l.byteStride)||0}}function u(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&r.c.warn("BufferLayout "+name+" must have either 'attributes' or 'format' field")}function _(e,t){const n={...e,attributes:e.attributes.map((e=>({...e})))};for(const i of(null==t?void 0:t.attributes)||[]){const e=n.attributes.find((e=>e.name===i.name));e?(e.type=i.type||e.type,e.stepMode=i.stepMode||e.stepMode):r.c.warn("shader layout attribute "+i.name+" not present in shader")}return n}},9909:(e,t,n)=>{n.d(t,{l:()=>s});var r=n(9491);let i;i=Symbol.toStringTag;class s extends r._{get[i](){return"Buffer"}constructor(e,t){const n={...t};(t.usage||0)&s.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),super(e,n,s.defaultProps),this.debugData=new ArrayBuffer(0),this.usage=t.usage||0,this.indexType=n.indexType}readSyncWebGL2(e,t){throw new Error("not implemented")}_setDebugData(e,t,n){const r=ArrayBuffer.isView(e)?e.buffer:e,i=Math.min(e?e.byteLength:n,s.DEBUG_DATA_MAX_LENGTH);null===e?this.debugData=new ArrayBuffer(i):0===t&&n===e.byteLength?this.debugData=r.slice(0,i):this.debugData=r.slice(t,t+i)}}s.defaultProps={...r._.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1},s.MAP_READ=1,s.MAP_WRITE=2,s.COPY_SRC=4,s.COPY_DST=8,s.INDEX=16,s.VERTEX=32,s.UNIFORM=64,s.STORAGE=128,s.INDIRECT=256,s.QUERY_RESOLVE=512,s.DEBUG_DATA_MAX_LENGTH=32},8060:(e,t,n)=>{n.d(t,{A:()=>a});var r=n(9491),i=n(8295),s=n(4575);let o;o=Symbol.toStringTag;class a extends r._{get[o](){return"Framebuffer"}constructor(e,t){void 0===t&&(t={}),super(e,t,a.defaultProps),this.colorAttachments=[],this.depthStencilAttachment=null,this.width=this.props.width,this.height=this.props.height}resize(e){let t=!e;if(e){const[n,r]=Array.isArray(e)?e:[e.width,e.height];t=t||r!==this.height||n!==this.width,this.width=n,this.height=r}t&&(s.c.log(2,"Resizing framebuffer "+this.id+" to "+this.width+"x"+this.height)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.colorAttachments=this.props.colorAttachments.map((e=>{if("string"==typeof e){const t=this.createColorTexture(e);return this.attachResource(t),t}return e})),this.props.depthStencilAttachment)if("string"==typeof this.props.depthStencilAttachment){const e=this.createDepthStencilTexture(this.props.depthStencilAttachment);this.attachResource(e),this.depthStencilAttachment=e}else this.depthStencilAttachment=this.props.depthStencilAttachment}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:i.x.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:i.x.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const r=this.device._createTexture({...this.colorAttachments[n].props,width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=r,this.attachResource(r)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n,this.attachResource(n)}}}a.defaultProps={...r._.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null}},918:(e,t,n)=>{n.d(t,{h:()=>s});var r=n(9491);let i;i=Symbol.toStringTag;class s extends r._{get[i](){return"RenderPipeline"}constructor(e,t){super(e,t,s.defaultProps),this.hash="",this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}}s.defaultProps={...r._.defaultProps,vs:null,vsEntryPoint:"",vsConstants:{},fs:null,fsEntryPoint:"",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}}},9491:(e,t,n)=>{n.d(t,{_:()=>i});var r=n(1770);class i{constructor(e,t,n){if(this.userData={},this.destroyed=!1,this.allocatedBytes=0,this._attachedResources=new Set,!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const r in e)void 0!==e[r]&&(n[r]=e[r]);return n}(t,n);const i="undefined"!==this.props.id?this.props.id:(0,r.hQ)(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return(this[Symbol.toStringTag]||this.constructor.name)+"("+this.id+")"}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(t+"s Active").decrementCount()}trackAllocatedMemory(e,t){void 0===t&&(t=this[Symbol.toStringTag]);const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(t+" Memory").addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e){void 0===e&&(e=this[Symbol.toStringTag]);const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(e+" Memory").subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(t+"s Created").incrementCount(),e.get(t+"s Active").incrementCount()}}i.defaultProps={id:"undefined",handle:void 0,userData:void 0}},8295:(e,t,n)=>{n.d(t,{x:()=>s});var r=n(9491);let i;i=Symbol.toStringTag;class s extends r._{get[i](){return"Texture"}constructor(e,t,n){void 0===n&&(n=s.defaultProps),super(e,t,n),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth}}s.defaultProps={...r._.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,sampler:{},compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0},s.COPY_SRC=1,s.COPY_DST=2,s.TEXTURE_BINDING=4,s.STORAGE_BINDING=8,s.RENDER_ATTACHMENT=16},2553:(e,t,n)=>{function r(e){const t=function(e){const t=s[e];return t}(i[e]),n=e.includes("norm"),r=!n&&!e.startsWith("float"),o=e.startsWith("s");return{dataType:i[e],byteLength:t,integer:r,signed:o,normalized:n}}n.d(t,{e:()=>r});const i={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},s={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4}},1477:(e,t,n)=>{n.d(t,{$:()=>i});var r=n(2553);function i(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,i]=e.split("x"),s=n,o=i?parseInt(i):1,a=(0,r.e)(s),l={type:s,components:o,byteLength:a.byteLength*o,integer:a.integer,signed:a.signed,normalized:a.normalized};return t&&(l.webglOnly=!0),l}},6054:(e,t,n)=>{n.d(t,{y:()=>i});var r=n(5051);function i(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach((n=>{const i=e[n];var s;s=i,null!==(0,r.v)(s)||"number"==typeof s||"boolean"==typeof s?t.uniforms[n]=i:t.bindings[n]=i})),t}},1536:(e,t,n)=>{let r;function i(e){return(!r||r.byteLength<e)&&(r=new ArrayBuffer(e)),r}function s(e,t){return new e(i(e.BYTES_PER_ELEMENT*t),0,t)}function o(e){const{target:t,source:n,start:r=0,count:i=1}=e,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)t[l++]=n[a];for(;a<o;)a<o-a?(t.copyWithin(r+a,r,r+a),a*=2):(t.copyWithin(r+a,r,r+o-a),a=o);return e.target}n.d(t,{D4:()=>i,FD:()=>s,kg:()=>o})},3911:(e,t,n)=>{function r(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}n.d(t,{h:()=>r})},5051:(e,t,n)=>{function r(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]?e:null:function(e){return!ArrayBuffer.isView(e)||e instanceof DataView?null:e}(e)}n.d(t,{v:()=>r})},4025:(e,t,n)=>{n.d(t,{VY:()=>i,gy:()=>s,po:()=>o,ve:()=>a});let r="";function i(e){r=e}async function s(e,t){const n=new Image;return n.crossOrigin=(null==t?void 0:t.crossOrigin)||"anonymous",n.src=e.startsWith("http")?e:r+e,await n.decode(),await createImageBitmap(n)}async function o(e,t){return new Promise(((n,i)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>i(new Error("Could not load image "+e+".")),s.crossOrigin=(null==t?void 0:t.crossOrigin)||"anonymous",s.src=e.startsWith("http")?e:r+e}catch(s){i(s)}}))}async function a(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",e),t&&(r.id=t),new Promise(((t,i)=>{r.onload=t,r.onerror=t=>i(new Error("Unable to load script '"+e+"': "+t)),n.appendChild(r)}))}},4575:(e,t,n)=>{n.d(t,{c:()=>r});const r=new(n(3347).Z)({id:"luma.gl"})},1770:(e,t,n)=>{n.d(t,{hQ:()=>i,nK:()=>o,wt:()=>s});const r={};function i(e){void 0===e&&(e="id"),r[e]=r[e]||1;return e+"-"+r[e]++}function s(e){return e>0&&0==(e&e-1)}function o(e){let t=!0;for(const n in e){t=!1;break}return t}},343:(e,t,n)=>{n.d(t,{z6:()=>l,Jb:()=>c});var r=n(3911),i=n(8060),s=n(180),o=n(3040);function a(e){switch(e){case s.GL.ALPHA:case s.GL.R32F:case s.GL.RED:return 1;case s.GL.RG32F:case s.GL.RG:return 2;case s.GL.RGB:case s.GL.RGB32F:return 3;case s.GL.RGBA:case s.GL.RGBA32F:return 4;default:return(0,r.h)(!1),0}}function l(e,t){var n;const{sourceX:i=0,sourceY:l=0,sourceFormat:c=s.GL.RGBA,sourceAttachment:_=s.GL.COLOR_ATTACHMENT0}=t||{};let{target:h=null,sourceWidth:d,sourceHeight:f,sourceType:E}=t||{};const{framebuffer:p,deleteFramebuffer:g}=u(e);(0,r.h)(p);const{gl:m,handle:A}=p;d=d||p.width,f=f||p.height;const R=_-s.GL.COLOR_ATTACHMENT0;E=E||(null==(n=p.colorAttachments[R])?void 0:n.type)||s.GL.UNSIGNED_BYTE,h=function(e,t,n,r,i){if(e)return e;t=t||s.GL.UNSIGNED_BYTE;const l=(0,o.vN)(t,{clamped:!1}),c=a(n);return new l(r*i*c)}(h,E,c,d,f),E=E||(0,o.O)(h);const T=m.bindFramebuffer(s.GL.FRAMEBUFFER,A);return m.readPixels(i,l,d,f,c,E,h),m.bindFramebuffer(s.GL.FRAMEBUFFER,T||null),g&&p.destroy(),h}function c(e,t){const{target:n,sourceX:i=0,sourceY:o=0,sourceFormat:l=s.GL.RGBA,targetByteOffset:c=0}=t||{};let{sourceWidth:_,sourceHeight:h,sourceType:d}=t||{};const{framebuffer:f,deleteFramebuffer:E}=u(e);(0,r.h)(f),_=_||f.width,h=h||f.height;const p=f;d=d||s.GL.UNSIGNED_BYTE;let g=n;if(!g){const e=c+_*h*a(l)*function(e){switch(e){case s.GL.UNSIGNED_BYTE:return 1;case s.GL.UNSIGNED_SHORT_5_6_5:case s.GL.UNSIGNED_SHORT_4_4_4_4:case s.GL.UNSIGNED_SHORT_5_5_5_1:return 2;case s.GL.FLOAT:return 4;default:return(0,r.h)(!1),0}}(d);g=p.device.createBuffer({byteLength:e})}const m=e.device.createCommandEncoder();return m.copyTextureToBuffer({source:e,width:_,height:h,origin:[i,o],destination:g,byteOffset:c}),m.destroy(),E&&f.destroy(),g}function u(e){return e instanceof i.A?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:_(e),deleteFramebuffer:!0}}function _(e,t){const{device:n,width:r,height:i,id:s}=e;return n.createFramebuffer({...t,id:"framebuffer-for-"+s,width:r,height:i,colorAttachments:[e]})}},3040:(e,t,n)=>{n.d(t,{O:()=>s,vN:()=>o});var r=n(180);const i="Failed to deduce GL constant from typed array";function s(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return r.GL.FLOAT;case Uint16Array:return r.GL.UNSIGNED_SHORT;case Uint32Array:return r.GL.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return r.GL.UNSIGNED_BYTE;case Int8Array:return r.GL.BYTE;case Int16Array:return r.GL.SHORT;case Int32Array:return r.GL.INT;default:throw new Error(i)}}function o(e,t){const{clamped:n=!0}=t||{};switch(e){case r.GL.FLOAT:return Float32Array;case r.GL.UNSIGNED_SHORT:case r.GL.UNSIGNED_SHORT_5_6_5:case r.GL.UNSIGNED_SHORT_4_4_4_4:case r.GL.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case r.GL.UNSIGNED_INT:return Uint32Array;case r.GL.UNSIGNED_BYTE:return n?Uint8ClampedArray:Uint8Array;case r.GL.BYTE:return Int8Array;case r.GL.SHORT:return Int16Array;case r.GL.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}},5852:(e,t,n)=>{n.d(t,{$e:()=>r.$e,CK:()=>r.CK,Ey:()=>r.Ey,FX:()=>r.FX,Fk:()=>r.Fk,LE:()=>r.LE,Qg:()=>r.Qg,Tj:()=>r.Tj,Uc:()=>r.Uc,Wg:()=>r.Wg,c7:()=>r.c7,eD:()=>r.eD,j8:()=>r.j8,jc:()=>r.jc,r6:()=>r.r6,rR:()=>r.rR,uY:()=>r.uY,vm:()=>r.vm,yh:()=>r.yh});var r=n(3673)},3673:(e,t,n)=>{n.d(t,{FX:()=>ls,c7:()=>cs,$e:()=>ds,Uc:()=>fs,r6:()=>Es,uY:()=>Ls,Qg:()=>vs,Wg:()=>ps,Fk:()=>_s,vm:()=>gs,yh:()=>hs,rR:()=>Ss,j8:()=>ms,LE:()=>As,Tj:()=>us,eD:()=>bs,jc:()=>Ts,Ey:()=>Rs,CK:()=>Cs});var r=n(7294),i=n(9750);const s=e=>""+e;var o=n(9909),a=n(5051);class l{constructor(e){if(this.uniforms={},this.modifiedUniforms={},this.modified=!0,this.bindingLayout={},this.needsRedraw="initialized",this.name=null==e?void 0:e.name,null!=e&&e.name&&null!=e&&e.shaderLayout){var t;const n=null==e||null==(t=e.shaderLayout.bindings)?void 0:t.find((t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name)));if(!n)throw new Error(null==e?void 0:e.name);const r=n;for(const e of r.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(this.name+"."+t+"="+n)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t,n){if(void 0===n&&(n=16),e!==t)return!1;const r=(0,a.v)(e);if(!r)return!1;const i=(0,a.v)(t);if(i&&r.length===i.length)for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){const t=(0,a.v)(e);return t?t.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}var c=n(3911);const u={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function _(e){const t=u[e];return(0,c.h)(e),t}function h(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}var d=n(1536),f=n(4575);class E{constructor(e){this.layout={};let t=0;for(const[r,i]of Object.entries(e)){const e=_(i),{type:n,components:s}=e;t=h(t,s);const o=t;t+=s,this.layout[r]={type:n,size:s,offset:o}}t+=(4-t%4)%4;const n=4*t;this.byteLength=Math.max(n,1024)}getData(e){const t=Math.max(this.byteLength,1024),n=(0,d.D4)(t),r={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[i,s]of Object.entries(e)){const e=this.layout[i];if(!e){f.c.warn("Supplied uniform value "+i+" not present in uniform block layout")();continue}const{type:t,size:n,offset:o}=e,l=r[t];if(1===n){if("number"!=typeof s&&"boolean"!=typeof s){f.c.warn("Supplied value for single component uniform "+i+" is not a number: "+s)();continue}l[o]=Number(s)}else{const e=(0,a.v)(s);if(!e){f.c.warn("Supplied value for multi component / array uniform "+i+" is not a numeric array: "+s)();continue}l.set(e,o)}}return new Uint8Array(n)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class p{constructor(e){this.uniformBlocks=new Map,this.uniformBufferLayouts=new Map,this.uniformBuffers=new Map;for(const[t,n]of Object.entries(e)){const e=t,r=new E(n.uniformTypes||{});this.uniformBufferLayouts.set(e,r);const i=new l({name:t});i.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,i)}}destroy(){for(const e of Object.values(this.uniformBuffers))e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:o.l.UNIFORM|o.l.COPY_DST,byteLength:r}),s=this.getUniformBufferData(t);return i.write(s),i}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:o.l.UNIFORM|o.l.COPY_DST,byteLength:n});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&f.c.log(3,"UniformStore.updateUniformBuffers(): "+e)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=!1;if(this.uniformBuffers.get(e)&&t.needsRedraw){n||(n=t.needsRedraw);const r=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(r);const i=this.uniformBlocks.get(e).getAllUniforms();f.c.log(4,"Writing to uniform buffer "+String(e),r,i)()}return n}}class g{constructor(e){}async onInitialize(e){return null}}let m=1,A=1;class R{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:r=1,repeat:i=1}=e,s=m++,o={time:0,delay:t,duration:n,rate:r,repeat:i};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const r of t)this._setChannelTime(r,this.time);const n=this.animations.values();for(const r of n){const{animation:e,channel:t}=r;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=A++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}class T{constructor(e){this.startIndex=-1,this.endIndex=-1,this.factor=0,this.times=[],this.values=[],this._lastTime=-1,this.setKeyFrames(e),this.setTime(0)}setKeyFrames(e){const t=e.length;this.times.length=t,this.values.length=t;for(let n=0;n<t;++n)this.times[n]=e[n][0],this.values[n]=e[n][1];this._calculateKeys(this._lastTime)}setTime(e){(e=Math.max(0,e))!==this._lastTime&&(this._calculateKeys(e),this._lastTime=e)}getStartTime(){return this.times[this.startIndex]}getEndTime(){return this.times[this.endIndex]}getStartData(){return this.values[this.startIndex]}getEndData(){return this.values[this.endIndex]}_calculateKeys(e){let t=0;const n=this.times.length;for(t=0;t<n-2&&!(this.times[t+1]>e);++t);this.startIndex=t,this.endIndex=t+1;const r=this.times[this.startIndex],i=this.times[this.endIndex];this.factor=Math.min(Math.max(0,(e-r)/(i-r)),1)}}function L(e,t,n){if(!t||t>4)throw new Error("size "+t);const r=t;let i=function(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}(e);if("uint8"===i||"sint8"===i){if(1===r||3===r)throw new Error("size: "+t);return n&&(i=i.replace("int","norm")),i+"x"+r}if("uint16"===i||"sint16"===i){if(1===r||3===r)throw new Error("size: "+t);return n&&(i=i.replace("int","norm")),i+"x"+r}return 1===r?i:i+"x"+r}var v=n(918),S=n(1770);function b(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!b(e[r],t[r],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const s of r){if(!t.hasOwnProperty(s))return!1;if(!b(e[s],t[s],n-1))return!1}return!0}return!1}var C,G,N,y,I,M=n(6054),w=n(8404);class x{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class O{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}}class F extends O{constructor(){super()}}class P extends F{constructor(e,t,n,r){super(),this.name=e,this.args=t,this.returnType=n,this.body=r}get astNodeType(){return"function"}}class B extends F{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class D extends F{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}}class U extends F{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class k extends F{constructor(e,t,n,r){super(),this.init=e,this.condition=t,this.increment=n,this.body=r}get astNodeType(){return"for"}}class V extends F{constructor(e,t,n,r,i){super(),this.name=e,this.type=t,this.storage=n,this.access=r,this.value=i}get astNodeType(){return"var"}}class X extends F{constructor(e,t,n){super(),this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}}class H extends F{constructor(e,t,n,r,i){super(),this.name=e,this.type=t,this.storage=n,this.access=r,this.value=i}get astNodeType(){return"let"}}class W extends F{constructor(e,t,n,r,i){super(),this.name=e,this.type=t,this.storage=n,this.access=r,this.value=i}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}!function(e){e.increment="++",e.decrement="--"}(C||(C={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}}(C||(C={}));class K extends F{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}}!function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="}(G||(G={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for AssignOperator");return e[n]}}(G||(G={}));class Y extends F{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}}class z extends F{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}}class j extends F{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class Z extends F{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}}class q extends F{constructor(e,t,n,r){super(),this.condition=e,this.body=t,this.elseif=n,this.else=r}get astNodeType(){return"if"}}class Q extends F{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class $ extends F{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class J extends F{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class ee extends F{constructor(){super()}get astNodeType(){return"discard"}}class te extends F{constructor(){super()}get astNodeType(){return"break"}}class ne extends F{constructor(){super()}get astNodeType(){return"continue"}}class re extends F{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class ie extends re{constructor(e,t){super(e),this.members=t}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class se extends re{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}}class oe extends re{constructor(e,t,n,r){super(e),this.storage=t,this.type=n,this.access=r}get astNodeType(){return"pointer"}}class ae extends re{constructor(e,t,n,r){super(e),this.attributes=t,this.format=n,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class le extends re{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class ce extends O{constructor(){super()}}class ue extends ce{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class _e extends ce{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}}class he extends ce{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return 180*this.args[0].evaluate(e)/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class de extends ce{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class fe extends ce{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,n;if(this.initializer instanceof _e){const r=null===(t=this.postfix)||void 0===t?void 0:t.evaluateString(e),i=null===(n=this.initializer.type)||void 0===n?void 0:n.name,s=e.structs.get(i),o=null==s?void 0:s.getMemberIndex(r);if(-1!=o){return this.initializer.args[o].evaluate(e)}console.log(o)}return this.initializer.evaluate(e)}}class Ee extends ce{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class pe extends ce{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}}class ge extends ce{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class me extends ce{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class Ae extends ce{constructor(){super()}}class Re extends Ae{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class Te extends Ae{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error("Unknown operator "+this.operator)}}}class Le extends O{constructor(){super()}}class ve extends Le{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}}class Se extends Le{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class be extends O{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class Ce extends O{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}}class Ge extends O{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Ne extends O{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}!function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"}(y||(y={}));class ye{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class Ie{}N=Ie,Ie.none=new ye("",y.reserved,""),Ie.eof=new ye("EOF",y.token,""),Ie.reserved={asm:new ye("asm",y.reserved,"asm"),bf16:new ye("bf16",y.reserved,"bf16"),do:new ye("do",y.reserved,"do"),enum:new ye("enum",y.reserved,"enum"),f16:new ye("f16",y.reserved,"f16"),f64:new ye("f64",y.reserved,"f64"),handle:new ye("handle",y.reserved,"handle"),i8:new ye("i8",y.reserved,"i8"),i16:new ye("i16",y.reserved,"i16"),i64:new ye("i64",y.reserved,"i64"),mat:new ye("mat",y.reserved,"mat"),premerge:new ye("premerge",y.reserved,"premerge"),regardless:new ye("regardless",y.reserved,"regardless"),typedef:new ye("typedef",y.reserved,"typedef"),u8:new ye("u8",y.reserved,"u8"),u16:new ye("u16",y.reserved,"u16"),u64:new ye("u64",y.reserved,"u64"),unless:new ye("unless",y.reserved,"unless"),using:new ye("using",y.reserved,"using"),vec:new ye("vec",y.reserved,"vec"),void:new ye("void",y.reserved,"void")},Ie.keywords={array:new ye("array",y.keyword,"array"),atomic:new ye("atomic",y.keyword,"atomic"),bool:new ye("bool",y.keyword,"bool"),f32:new ye("f32",y.keyword,"f32"),i32:new ye("i32",y.keyword,"i32"),mat2x2:new ye("mat2x2",y.keyword,"mat2x2"),mat2x3:new ye("mat2x3",y.keyword,"mat2x3"),mat2x4:new ye("mat2x4",y.keyword,"mat2x4"),mat3x2:new ye("mat3x2",y.keyword,"mat3x2"),mat3x3:new ye("mat3x3",y.keyword,"mat3x3"),mat3x4:new ye("mat3x4",y.keyword,"mat3x4"),mat4x2:new ye("mat4x2",y.keyword,"mat4x2"),mat4x3:new ye("mat4x3",y.keyword,"mat4x3"),mat4x4:new ye("mat4x4",y.keyword,"mat4x4"),ptr:new ye("ptr",y.keyword,"ptr"),sampler:new ye("sampler",y.keyword,"sampler"),sampler_comparison:new ye("sampler_comparison",y.keyword,"sampler_comparison"),struct:new ye("struct",y.keyword,"struct"),texture_1d:new ye("texture_1d",y.keyword,"texture_1d"),texture_2d:new ye("texture_2d",y.keyword,"texture_2d"),texture_2d_array:new ye("texture_2d_array",y.keyword,"texture_2d_array"),texture_3d:new ye("texture_3d",y.keyword,"texture_3d"),texture_cube:new ye("texture_cube",y.keyword,"texture_cube"),texture_cube_array:new ye("texture_cube_array",y.keyword,"texture_cube_array"),texture_multisampled_2d:new ye("texture_multisampled_2d",y.keyword,"texture_multisampled_2d"),texture_storage_1d:new ye("texture_storage_1d",y.keyword,"texture_storage_1d"),texture_storage_2d:new ye("texture_storage_2d",y.keyword,"texture_storage_2d"),texture_storage_2d_array:new ye("texture_storage_2d_array",y.keyword,"texture_storage_2d_array"),texture_storage_3d:new ye("texture_storage_3d",y.keyword,"texture_storage_3d"),texture_depth_2d:new ye("texture_depth_2d",y.keyword,"texture_depth_2d"),texture_depth_2d_array:new ye("texture_depth_2d_array",y.keyword,"texture_depth_2d_array"),texture_depth_cube:new ye("texture_depth_cube",y.keyword,"texture_depth_cube"),texture_depth_cube_array:new ye("texture_depth_cube_array",y.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new ye("texture_depth_multisampled_2d",y.keyword,"texture_depth_multisampled_2d"),texture_external:new ye("texture_external",y.keyword,"texture_external"),u32:new ye("u32",y.keyword,"u32"),vec2:new ye("vec2",y.keyword,"vec2"),vec3:new ye("vec3",y.keyword,"vec3"),vec4:new ye("vec4",y.keyword,"vec4"),bitcast:new ye("bitcast",y.keyword,"bitcast"),block:new ye("block",y.keyword,"block"),break:new ye("break",y.keyword,"break"),case:new ye("case",y.keyword,"case"),continue:new ye("continue",y.keyword,"continue"),continuing:new ye("continuing",y.keyword,"continuing"),default:new ye("default",y.keyword,"default"),discard:new ye("discard",y.keyword,"discard"),else:new ye("else",y.keyword,"else"),enable:new ye("enable",y.keyword,"enable"),fallthrough:new ye("fallthrough",y.keyword,"fallthrough"),false:new ye("false",y.keyword,"false"),fn:new ye("fn",y.keyword,"fn"),for:new ye("for",y.keyword,"for"),function:new ye("function",y.keyword,"function"),if:new ye("if",y.keyword,"if"),let:new ye("let",y.keyword,"let"),const:new ye("const",y.keyword,"const"),loop:new ye("loop",y.keyword,"loop"),while:new ye("while",y.keyword,"while"),private:new ye("private",y.keyword,"private"),read:new ye("read",y.keyword,"read"),read_write:new ye("read_write",y.keyword,"read_write"),return:new ye("return",y.keyword,"return"),storage:new ye("storage",y.keyword,"storage"),switch:new ye("switch",y.keyword,"switch"),true:new ye("true",y.keyword,"true"),alias:new ye("alias",y.keyword,"alias"),type:new ye("type",y.keyword,"type"),uniform:new ye("uniform",y.keyword,"uniform"),var:new ye("var",y.keyword,"var"),override:new ye("override",y.keyword,"override"),workgroup:new ye("workgroup",y.keyword,"workgroup"),write:new ye("write",y.keyword,"write"),r8unorm:new ye("r8unorm",y.keyword,"r8unorm"),r8snorm:new ye("r8snorm",y.keyword,"r8snorm"),r8uint:new ye("r8uint",y.keyword,"r8uint"),r8sint:new ye("r8sint",y.keyword,"r8sint"),r16uint:new ye("r16uint",y.keyword,"r16uint"),r16sint:new ye("r16sint",y.keyword,"r16sint"),r16float:new ye("r16float",y.keyword,"r16float"),rg8unorm:new ye("rg8unorm",y.keyword,"rg8unorm"),rg8snorm:new ye("rg8snorm",y.keyword,"rg8snorm"),rg8uint:new ye("rg8uint",y.keyword,"rg8uint"),rg8sint:new ye("rg8sint",y.keyword,"rg8sint"),r32uint:new ye("r32uint",y.keyword,"r32uint"),r32sint:new ye("r32sint",y.keyword,"r32sint"),r32float:new ye("r32float",y.keyword,"r32float"),rg16uint:new ye("rg16uint",y.keyword,"rg16uint"),rg16sint:new ye("rg16sint",y.keyword,"rg16sint"),rg16float:new ye("rg16float",y.keyword,"rg16float"),rgba8unorm:new ye("rgba8unorm",y.keyword,"rgba8unorm"),rgba8unorm_srgb:new ye("rgba8unorm_srgb",y.keyword,"rgba8unorm_srgb"),rgba8snorm:new ye("rgba8snorm",y.keyword,"rgba8snorm"),rgba8uint:new ye("rgba8uint",y.keyword,"rgba8uint"),rgba8sint:new ye("rgba8sint",y.keyword,"rgba8sint"),bgra8unorm:new ye("bgra8unorm",y.keyword,"bgra8unorm"),bgra8unorm_srgb:new ye("bgra8unorm_srgb",y.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new ye("rgb10a2unorm",y.keyword,"rgb10a2unorm"),rg11b10float:new ye("rg11b10float",y.keyword,"rg11b10float"),rg32uint:new ye("rg32uint",y.keyword,"rg32uint"),rg32sint:new ye("rg32sint",y.keyword,"rg32sint"),rg32float:new ye("rg32float",y.keyword,"rg32float"),rgba16uint:new ye("rgba16uint",y.keyword,"rgba16uint"),rgba16sint:new ye("rgba16sint",y.keyword,"rgba16sint"),rgba16float:new ye("rgba16float",y.keyword,"rgba16float"),rgba32uint:new ye("rgba32uint",y.keyword,"rgba32uint"),rgba32sint:new ye("rgba32sint",y.keyword,"rgba32sint"),rgba32float:new ye("rgba32float",y.keyword,"rgba32float"),static_assert:new ye("static_assert",y.keyword,"static_assert")},Ie.tokens={decimal_float_literal:new ye("decimal_float_literal",y.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new ye("hex_float_literal",y.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new ye("int_literal",y.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new ye("uint_literal",y.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new ye("ident",y.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new ye("and",y.token,"&"),and_and:new ye("and_and",y.token,"&&"),arrow:new ye("arrow ",y.token,"->"),attr:new ye("attr",y.token,"@"),attr_left:new ye("attr_left",y.token,"[["),attr_right:new ye("attr_right",y.token,"]]"),forward_slash:new ye("forward_slash",y.token,"/"),bang:new ye("bang",y.token,"!"),bracket_left:new ye("bracket_left",y.token,"["),bracket_right:new ye("bracket_right",y.token,"]"),brace_left:new ye("brace_left",y.token,"{"),brace_right:new ye("brace_right",y.token,"}"),colon:new ye("colon",y.token,":"),comma:new ye("comma",y.token,","),equal:new ye("equal",y.token,"="),equal_equal:new ye("equal_equal",y.token,"=="),not_equal:new ye("not_equal",y.token,"!="),greater_than:new ye("greater_than",y.token,">"),greater_than_equal:new ye("greater_than_equal",y.token,">="),shift_right:new ye("shift_right",y.token,">>"),less_than:new ye("less_than",y.token,"<"),less_than_equal:new ye("less_than_equal",y.token,"<="),shift_left:new ye("shift_left",y.token,"<<"),modulo:new ye("modulo",y.token,"%"),minus:new ye("minus",y.token,"-"),minus_minus:new ye("minus_minus",y.token,"--"),period:new ye("period",y.token,"."),plus:new ye("plus",y.token,"+"),plus_plus:new ye("plus_plus",y.token,"++"),or:new ye("or",y.token,"|"),or_or:new ye("or_or",y.token,"||"),paren_left:new ye("paren_left",y.token,"("),paren_right:new ye("paren_right",y.token,")"),semicolon:new ye("semicolon",y.token,";"),star:new ye("star",y.token,"*"),tilde:new ye("tilde",y.token,"~"),underscore:new ye("underscore",y.token,"_"),xor:new ye("xor",y.token,"^"),plus_equal:new ye("plus_equal",y.token,"+="),minus_equal:new ye("minus_equal",y.token,"-="),times_equal:new ye("times_equal",y.token,"*="),division_equal:new ye("division_equal",y.token,"/="),modulo_equal:new ye("modulo_equal",y.token,"%="),and_equal:new ye("and_equal",y.token,"&="),or_equal:new ye("or_equal",y.token,"|="),xor_equal:new ye("xor_equal",y.token,"^="),shift_right_equal:new ye("shift_right_equal",y.token,">>="),shift_left_equal:new ye("shift_left_equal",y.token,"<<=")},Ie.storage_class=[N.keywords.function,N.keywords.private,N.keywords.workgroup,N.keywords.uniform,N.keywords.storage],Ie.access_mode=[N.keywords.read,N.keywords.write,N.keywords.read_write],Ie.sampler_type=[N.keywords.sampler,N.keywords.sampler_comparison],Ie.sampled_texture_type=[N.keywords.texture_1d,N.keywords.texture_2d,N.keywords.texture_2d_array,N.keywords.texture_3d,N.keywords.texture_cube,N.keywords.texture_cube_array],Ie.multisampled_texture_type=[N.keywords.texture_multisampled_2d],Ie.storage_texture_type=[N.keywords.texture_storage_1d,N.keywords.texture_storage_2d,N.keywords.texture_storage_2d_array,N.keywords.texture_storage_3d],Ie.depth_texture_type=[N.keywords.texture_depth_2d,N.keywords.texture_depth_2d_array,N.keywords.texture_depth_cube,N.keywords.texture_depth_cube_array,N.keywords.texture_depth_multisampled_2d],Ie.texture_external_type=[N.keywords.texture_external],Ie.any_texture_type=[...N.sampled_texture_type,...N.multisampled_texture_type,...N.storage_texture_type,...N.depth_texture_type,...N.texture_external_type],Ie.texel_format=[N.keywords.r8unorm,N.keywords.r8snorm,N.keywords.r8uint,N.keywords.r8sint,N.keywords.r16uint,N.keywords.r16sint,N.keywords.r16float,N.keywords.rg8unorm,N.keywords.rg8snorm,N.keywords.rg8uint,N.keywords.rg8sint,N.keywords.r32uint,N.keywords.r32sint,N.keywords.r32float,N.keywords.rg16uint,N.keywords.rg16sint,N.keywords.rg16float,N.keywords.rgba8unorm,N.keywords.rgba8unorm_srgb,N.keywords.rgba8snorm,N.keywords.rgba8uint,N.keywords.rgba8sint,N.keywords.bgra8unorm,N.keywords.bgra8unorm_srgb,N.keywords.rgb10a2unorm,N.keywords.rg11b10float,N.keywords.rg32uint,N.keywords.rg32sint,N.keywords.rg32float,N.keywords.rgba16uint,N.keywords.rgba16sint,N.keywords.rgba16float,N.keywords.rgba32uint,N.keywords.rgba32sint,N.keywords.rgba32float],Ie.const_literal=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal,N.keywords.true,N.keywords.false],Ie.literal_or_ident=[N.tokens.ident,N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal],Ie.element_count_expression=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.ident],Ie.template_types=[N.keywords.vec2,N.keywords.vec3,N.keywords.vec4,N.keywords.mat2x2,N.keywords.mat2x3,N.keywords.mat2x4,N.keywords.mat3x2,N.keywords.mat3x3,N.keywords.mat3x4,N.keywords.mat4x2,N.keywords.mat4x3,N.keywords.mat4x4,N.keywords.atomic,N.keywords.bitcast,...N.any_texture_type],Ie.attribute_name=[N.tokens.ident,N.keywords.block],Ie.assignment_operators=[N.tokens.equal,N.tokens.plus_equal,N.tokens.minus_equal,N.tokens.times_equal,N.tokens.division_equal,N.tokens.modulo_equal,N.tokens.and_equal,N.tokens.or_equal,N.tokens.xor_equal,N.tokens.shift_right_equal,N.tokens.shift_left_equal],Ie.increment_operators=[N.tokens.plus_plus,N.tokens.minus_minus];class Me{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return-1!=Ie.template_types.indexOf(this.type)}isArrayType(){return this.type==Ie.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class we{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw"Invalid syntax at line "+this._line;return this._tokens.push(new Me(Ie.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}let t=Ie.none;for(;;){let n=this._findType(e);const r=this._peekAhead();if(">"==e&&(">"==r||"="==r)){let e=!1,t=this._tokens.length-1;for(let n=0;n<5&&t>=0;++n,--t)if(this._tokens[t].type===Ie.tokens.less_than){t>0&&this._tokens[t-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(n),!0}if(n===Ie.none){let r=e,i=0;const s=2;for(let e=0;e<s;++e)if(r+=this._peekAhead(e),n=this._findType(r),n!==Ie.none){i=e;break}if(n===Ie.none)return t!==Ie.none&&(this._current--,this._addToken(t),!0);e=r,this._current+=i+1}if(t=n,this._isAtEnd())break;e+=this._advance()}return t!==Ie.none&&(this._addToken(t),!0)}_findType(e){for(const t in Ie.keywords){const n=Ie.keywords[t];if(this._match(e,n.rule))return n}for(const t in Ie.tokens){const n=Ie.tokens[t];if(this._match(e,n.rule))return n}return Ie.none}_match(e,t){if("string"==typeof t){if(t==e)return!0}else{const n=t.exec(e);if(n&&0==n.index&&n[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e){void 0===e&&(e=0);let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e){return void 0===e&&(e=0),e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Me(e,t,this._line))}}class xe{constructor(){this._tokens=[],this._current=0,this._context=new x}parse(e){this._initialize(e);let t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}return t}_initialize(e){if(e)if("string"==typeof e){const t=new we(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return console.error(e,t),{token:e,message:t,toString:function(){return""+t}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==Ie.eof}_match(e){if(e instanceof ye)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){let n=t.type;return-1!=e.indexOf(n)}return t.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(Ie.tokens.semicolon)&&!this._isAtEnd(););if(this._match(Ie.keywords.alias)){const e=this._type_alias();return this._consume(Ie.tokens.semicolon,"Expected ';'"),e}if(this._match(Ie.keywords.enable)){const e=this._enable_directive();return this._consume(Ie.tokens.semicolon,"Expected ';'"),e}const e=this._attribute();if(this._check(Ie.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),t}if(this._check(Ie.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),t}if(this._check(Ie.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),t}if(this._check(Ie.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(Ie.tokens.semicolon,"Expected ';'."),t}if(this._check(Ie.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),t}if(this._check(Ie.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(Ie.keywords.fn))return null;const e=this._consume(Ie.tokens.ident,"Expected function name.").toString();this._consume(Ie.tokens.paren_left,"Expected '(' for function arguments.");const t=[];if(!this._check(Ie.tokens.paren_right))do{if(this._check(Ie.tokens.paren_right))break;const e=this._attribute(),n=this._consume(Ie.tokens.ident,"Expected argument name.").toString();this._consume(Ie.tokens.colon,"Expected ':' for argument type.");const r=this._attribute(),i=this._type_decl();null!=i&&(i.attributes=r,t.push(new be(n,i,e)))}while(this._match(Ie.tokens.comma));this._consume(Ie.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(Ie.tokens.arrow)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}const r=this._compound_statement();return new P(e,t,n,r)}_compound_statement(){const e=[];for(this._consume(Ie.tokens.brace_left,"Expected '{' for block.");!this._check(Ie.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(Ie.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(Ie.tokens.semicolon)&&!this._isAtEnd(););if(this._check(Ie.keywords.if))return this._if_statement();if(this._check(Ie.keywords.switch))return this._switch_statement();if(this._check(Ie.keywords.loop))return this._loop_statement();if(this._check(Ie.keywords.for))return this._for_statement();if(this._check(Ie.keywords.while))return this._while_statement();if(this._check(Ie.keywords.continuing))return this._continuing_statement();if(this._check(Ie.keywords.static_assert))return this._static_assert_statement();if(this._check(Ie.tokens.brace_left))return this._compound_statement();let e=null;return e=this._check(Ie.keywords.return)?this._return_statement():this._check([Ie.keywords.var,Ie.keywords.let,Ie.keywords.const])?this._variable_statement():this._match(Ie.keywords.discard)?new ee:this._match(Ie.keywords.break)?new te:this._match(Ie.keywords.continue)?new ne:this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),null!=e&&this._consume(Ie.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(Ie.keywords.static_assert))return null;let e=this._optional_paren_expression();return new B(e)}_while_statement(){if(!this._match(Ie.keywords.while))return null;let e=this._optional_paren_expression();const t=this._compound_statement();return new D(e,t)}_continuing_statement(){if(!this._match(Ie.keywords.continuing))return null;const e=this._compound_statement();return new U(e)}_for_statement(){if(!this._match(Ie.keywords.for))return null;this._consume(Ie.tokens.paren_left,"Expected '('.");const e=this._check(Ie.tokens.semicolon)?null:this._for_init();this._consume(Ie.tokens.semicolon,"Expected ';'.");const t=this._check(Ie.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(Ie.tokens.semicolon,"Expected ';'.");const n=this._check(Ie.tokens.paren_right)?null:this._for_increment();this._consume(Ie.tokens.paren_right,"Expected ')'.");const r=this._compound_statement();return new k(e,t,n,r)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(Ie.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(Ie.tokens.equal)&&(t=this._short_circuit_or_expression()),new V(e.name,e.type,e.storage,e.access,t)}if(this._match(Ie.keywords.let)){const e=this._consume(Ie.tokens.ident,"Expected name for let.").toString();let t=null;if(this._match(Ie.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(Ie.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new H(e,t,null,null,n)}if(this._match(Ie.keywords.const)){const e=this._consume(Ie.tokens.ident,"Expected name for const.").toString();let t=null;if(this._match(Ie.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(Ie.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new W(e,t,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(Ie.increment_operators))return this._current=e,null;const n=this._consume(Ie.increment_operators,"Expected increment operator");return new K(n.type===Ie.tokens.plus_plus?C.increment:C.decrement,t)}_assignment_statement(){let e=null;if(this._check(Ie.tokens.brace_right))return null;let t=this._match(Ie.tokens.underscore);if(t||(e=this._unary_expression()),!t&&null==e)return null;const n=this._consume(Ie.assignment_operators,"Expected assignment operator."),r=this._short_circuit_or_expression();return new Y(G.parse(n.lexeme),e,r)}_func_call_statement(){if(!this._check(Ie.tokens.ident))return null;const e=this._current,t=this._consume(Ie.tokens.ident,"Expected function name."),n=this._argument_expression_list();return null===n?(this._current=e,null):new z(t.lexeme,n)}_loop_statement(){if(!this._match(Ie.keywords.loop))return null;this._consume(Ie.tokens.brace_left,"Expected '{' for loop.");const e=[];let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.push(n);else e.push(t);t=this._statement()}let n=null;return this._match(Ie.keywords.continuing)&&(n=this._compound_statement()),this._consume(Ie.tokens.brace_right,"Expected '}' for loop."),new j(e,n)}_switch_statement(){if(!this._match(Ie.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(Ie.tokens.brace_left,"Expected '{' for switch.");const t=this._switch_body();if(null==t||0==t.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(Ie.tokens.brace_right,"Expected '}' for switch."),new Z(e,t)}_switch_body(){const e=[];if(this._match(Ie.keywords.case)){const t=this._case_selectors();this._match(Ie.tokens.colon),this._consume(Ie.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(Ie.tokens.brace_right,"Exected '}' for switch case."),e.push(new ve(t,n))}if(this._match(Ie.keywords.default)){this._match(Ie.tokens.colon),this._consume(Ie.tokens.brace_left,"Exected '{' for switch default.");const t=this._case_body();this._consume(Ie.tokens.brace_right,"Exected '}' for switch default."),e.push(new Se(t))}if(this._check([Ie.keywords.default,Ie.keywords.case])){const t=this._switch_body();e.push(t[0])}return e}_case_selectors(){var e,t,n,r;const i=[null!==(t=null===(e=this._shift_expression())||void 0===e?void 0:e.evaluate(this._context).toString())&&void 0!==t?t:""];for(;this._match(Ie.tokens.comma);)i.push(null!==(r=null===(n=this._shift_expression())||void 0===n?void 0:n.evaluate(this._context).toString())&&void 0!==r?r:"");return i}_case_body(){if(this._match(Ie.keywords.fallthrough))return this._consume(Ie.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(Ie.keywords.if))return null;const e=this._optional_paren_expression(),t=this._compound_statement();let n=[];this._match_elseif()&&(n=this._elseif_statement(n));let r=null;return this._match(Ie.keywords.else)&&(r=this._compound_statement()),new q(e,t,n,r)}_match_elseif(){return this._tokens[this._current].type===Ie.keywords.else&&this._tokens[this._current+1].type===Ie.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e){void 0===e&&(e=[]);const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(new Ce(t,n)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(Ie.keywords.return))return null;const e=this._short_circuit_or_expression();return new Q(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(Ie.tokens.or_or);)e=new Te(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(Ie.tokens.and_and);)e=new Te(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(Ie.tokens.or);)e=new Te(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(Ie.tokens.xor);)e=new Te(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(Ie.tokens.and);)e=new Te(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([Ie.tokens.equal_equal,Ie.tokens.not_equal])?new Te(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([Ie.tokens.less_than,Ie.tokens.greater_than,Ie.tokens.less_than_equal,Ie.tokens.greater_than_equal]);)e=new Te(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([Ie.tokens.shift_left,Ie.tokens.shift_right]);)e=new Te(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([Ie.tokens.plus,Ie.tokens.minus]);)e=new Te(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([Ie.tokens.star,Ie.tokens.forward_slash,Ie.tokens.modulo]);)e=new Te(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([Ie.tokens.minus,Ie.tokens.bang,Ie.tokens.tilde,Ie.tokens.star,Ie.tokens.and])?new Re(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(Ie.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(Ie.tokens.bracket_right,"Expected ']'.");const t=this._postfix_expression();return t&&(e.postfix=t),e}if(this._match(Ie.tokens.period)){const e=this._consume(Ie.tokens.ident,"Expected member name."),t=this._postfix_expression(),n=new ue(e.lexeme);return t&&(n.postfix=t),n}return null}_getStruct(e){if(this._context.aliases.has(e)){return this._context.aliases.get(e).type}if(this._context.structs.has(e)){return this._context.structs.get(e)}return null}_primary_expression(){if(this._match(Ie.tokens.ident)){const e=this._previous().toString();if(this._check(Ie.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getStruct(e);return null!=n?new _e(n,t):new he(e,t)}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return new fe(e,t.value)}return new de(e)}if(this._match(Ie.const_literal))return new Ee(parseFloat(this._previous().toString()));if(this._check(Ie.tokens.paren_left))return this._paren_expression();if(this._match(Ie.keywords.bitcast)){this._consume(Ie.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(Ie.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return new pe(e,t)}const e=this._type_decl(),t=this._argument_expression_list();return new ge(e,t)}_argument_expression_list(){if(!this._match(Ie.tokens.paren_left))return null;const e=[];do{if(this._check(Ie.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(Ie.tokens.comma));return this._consume(Ie.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(Ie.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(Ie.tokens.paren_right),new me([e])}_paren_expression(){this._consume(Ie.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(Ie.tokens.paren_right,"Expected ')'."),new me([e])}_struct_decl(){if(!this._match(Ie.keywords.struct))return null;const e=this._consume(Ie.tokens.ident,"Expected name for struct.").toString();this._consume(Ie.tokens.brace_left,"Expected '{' for struct body.");const t=[];for(;!this._check(Ie.tokens.brace_right);){const e=this._attribute(),n=this._consume(Ie.tokens.ident,"Expected variable name.").toString();this._consume(Ie.tokens.colon,"Expected ':' for struct member type.");const r=this._attribute(),i=this._type_decl();null!=i&&(i.attributes=r),this._check(Ie.tokens.brace_right)?this._match(Ie.tokens.comma):this._consume(Ie.tokens.comma,"Expected ',' for struct member."),t.push(new Ge(n,i,e))}this._consume(Ie.tokens.brace_right,"Expected '}' after struct body.");const n=new ie(e,t);return this._context.structs.set(e,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(Ie.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(Ie.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(Ie.keywords.const))return null;const e=this._consume(Ie.tokens.ident,"Expected variable name");let t=null;if(this._match(Ie.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;if(this._match(Ie.tokens.equal)){const e=this._short_circuit_or_expression();if(e instanceof _e)n=e;else if(e instanceof fe&&e.initializer instanceof _e)n=e.initializer;else try{const t=e.evaluate(this._context);n=new Ee(t)}catch(N){n=e}}const r=new W(e.toString(),t,"","",n);return this._context.constants.set(r.name,r),r}_global_let_decl(){if(!this._match(Ie.keywords.let))return null;const e=this._consume(Ie.tokens.ident,"Expected variable name");let t=null;if(this._match(Ie.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;return this._match(Ie.tokens.equal)&&(n=this._const_expression()),new H(e.toString(),t,"","",n)}_const_expression(){if(this._match(Ie.const_literal))return new ue(this._previous().toString());const e=this._type_decl();this._consume(Ie.tokens.paren_left,"Expected '('.");let t=[];for(;!this._check(Ie.tokens.paren_right)&&(t.push(this._const_expression()),this._check(Ie.tokens.comma));)this._advance();return this._consume(Ie.tokens.paren_right,"Expected ')'."),new _e(e,t)}_variable_decl(){if(!this._match(Ie.keywords.var))return null;let e="",t="";this._match(Ie.tokens.less_than)&&(e=this._consume(Ie.storage_class,"Expected storage_class.").toString(),this._match(Ie.tokens.comma)&&(t=this._consume(Ie.access_mode,"Expected access_mode.").toString()),this._consume(Ie.tokens.greater_than,"Expected '>'."));const n=this._consume(Ie.tokens.ident,"Expected variable name");let r=null;if(this._match(Ie.tokens.colon)){const e=this._attribute();r=this._type_decl(),null!=r&&(r.attributes=e)}return new V(n.toString(),r,e,t,null)}_override_decl(){if(!this._match(Ie.keywords.override))return null;const e=this._consume(Ie.tokens.ident,"Expected variable name");let t=null;if(this._match(Ie.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return new X(e.toString(),t,null)}_enable_directive(){const e=this._consume(Ie.tokens.ident,"identity expected.");return new $(e.toString())}_type_alias(){const e=this._consume(Ie.tokens.ident,"identity expected.");this._consume(Ie.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=new J(e.toString(),t);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([Ie.tokens.ident,...Ie.texel_format,Ie.keywords.bool,Ie.keywords.f32,Ie.keywords.i32,Ie.keywords.u32])){const e=this._advance(),t=e.toString();return this._context.structs.has(t)?this._context.structs.get(t):this._context.aliases.has(t)?this._context.aliases.get(t).type:new re(e.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(Ie.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(Ie.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(Ie.tokens.comma)&&(n=this._consume(Ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ie.tokens.greater_than,"Expected '>' for type.")),new se(e,t,n)}if(this._match(Ie.keywords.ptr)){let e=this._previous().toString();this._consume(Ie.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(Ie.storage_class,"Expected storage_class for pointer");this._consume(Ie.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let r=null;return this._match(Ie.tokens.comma)&&(r=this._consume(Ie.access_mode,"Expected access_mode for pointer").toString()),this._consume(Ie.tokens.greater_than,"Expected '>' for pointer."),new oe(e,t.toString(),n,r)}const t=this._attribute();if(this._match(Ie.keywords.array)){let e=null,n=-1;const r=this._previous();if(this._match(Ie.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(Ie.tokens.comma)){t=this._shift_expression().evaluate(this._context).toString()}this._consume(Ie.tokens.greater_than,"Expected '>' for array."),n=t?parseInt(t):0}return new ae(r.toString(),t,e,n)}return null}_texture_sampler_types(){if(this._match(Ie.sampler_type))return new le(this._previous().toString(),null,null);if(this._match(Ie.depth_texture_type))return new le(this._previous().toString(),null,null);if(this._match(Ie.sampled_texture_type)||this._match(Ie.multisampled_texture_type)){const e=this._previous();this._consume(Ie.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(Ie.tokens.greater_than,"Expected '>' for sampler type."),new le(e.toString(),t,null)}if(this._match(Ie.storage_texture_type)){const e=this._previous();this._consume(Ie.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(Ie.texel_format,"Invalid texel format.").toString();this._consume(Ie.tokens.comma,"Expected ',' after texel format.");const n=this._consume(Ie.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(Ie.tokens.greater_than,"Expected '>' for sampler type."),new le(e.toString(),t,n)}return null}_attribute(){let e=[];for(;this._match(Ie.tokens.attr);){const t=this._consume(Ie.attribute_name,"Expected attribute name"),n=new Ne(t.toString(),null);if(this._match(Ie.tokens.paren_left)){if(n.value=this._consume(Ie.literal_or_ident,"Expected attribute value").toString(),this._check(Ie.tokens.comma)){this._advance();do{const e=this._consume(Ie.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(Ie.tokens.comma))}this._consume(Ie.tokens.paren_right,"Expected ')'")}e.push(n)}for(;this._match(Ie.tokens.attr_left);){if(!this._check(Ie.tokens.attr_right))do{const t=this._consume(Ie.attribute_name,"Expected attribute name"),n=new Ne(t.toString(),null);if(this._match(Ie.tokens.paren_left)){if(n.value=[this._consume(Ie.literal_or_ident,"Expected attribute value").toString()],this._check(Ie.tokens.comma)){this._advance();do{const e=this._consume(Ie.literal_or_ident,"Expected attribute value").toString();n.value.push(e)}while(this._match(Ie.tokens.comma))}this._consume(Ie.tokens.paren_right,"Expected ')'")}e.push(n)}while(this._match(Ie.tokens.comma));this._consume(Ie.tokens.attr_right,"Expected ']]' after attribute declarations")}return 0==e.length?null:e}}class Oe{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Fe{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class Pe extends Oe{constructor(e,t){super(e,t),this.members=[],this.align=0}get isStruct(){return!0}}class Be extends Oe{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class De extends Oe{constructor(e,t,n,r){super(e,n),this.format=t,this.access=r}get isTemplate(){return!0}}!function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"}(I||(I={}));class Ue{constructor(e,t,n,r,i,s,o){this.name=e,this.type=t,this.group=n,this.binding=r,this.attributes=i,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ke{constructor(e,t){this.name=e,this.type=t}}class Ve{constructor(e,t){this.align=e,this.size=t}}class Xe{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r,this.interpolation=null}}class He{constructor(e,t,n,r){this.name=e,this.type=t,this.locationType=n,this.location=r}}class We{constructor(e,t){void 0===t&&(t=null),this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=t}}class Ke{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class Ye{constructor(e,t,n,r){this.name=e,this.type=t,this.attributes=n,this.id=r}}class ze{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Ke,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}update(e){const t=(new xe).parse(e);for(const n of t)if(n instanceof ie){const e=this._getTypeInfo(n,null);e instanceof Pe&&this.structs.push(e)}else if(n instanceof J)this.aliases.push(this._getAliasInfo(n));else if(n instanceof X){const e=n,t=this._getAttributeNum(e.attributes,"id",0),r=null!=e.type?this._getTypeInfo(e.type,e.attributes):null;this.overrides.push(new Ye(e.name,r,e.attributes,t))}else if(this._isUniformVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this._getTypeInfo(e.type,e.attributes),s=new Ue(e.name,i,t,r,e.attributes,I.Uniform,e.access);this.uniforms.push(s)}else if(this._isStorageVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this._getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(i),o=new Ue(e.name,i,t,r,e.attributes,s?I.StorageTexture:I.Storage,e.access);this.storage.push(o)}else if(this._isTextureVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this._getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(i),o=new Ue(e.name,i,t,r,e.attributes,s?I.StorageTexture:I.Texture,e.access);s?this.storage.push(o):this.textures.push(o)}else if(this._isSamplerVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),r=this._getAttributeNum(e.attributes,"binding",0),i=this._getTypeInfo(e.type,e.attributes),s=new Ue(e.name,i,t,r,e.attributes,I.Sampler,e.access);this.samplers.push(s)}else if(n instanceof P){const e=this._getAttribute(n,"vertex"),t=this._getAttribute(n,"fragment"),r=this._getAttribute(n,"compute"),i=e||t||r;if(i){const e=new We(n.name,i.name);e.inputs=this._getInputs(n.args),e.outputs=this._getOutputs(n.returnType),this.entry[i.name].push(e)}}else;}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.storage){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.textures){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.samplers){t(n.group,n.binding);e[n.group][n.binding]=n}return e}_getOutputs(e,t){if(void 0===t&&(t=void 0),void 0===t&&(t=[]),e instanceof ie)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof ie)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const r=this._getTypeInfo(n.type,n.type.attributes),i=this._parseInt(e.value),s=new He(n.name,r,e.name,i);t.push(s)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new He("",n,t.name,r)}return null}_getInputs(e,t){void 0===t&&(t=void 0),void 0===t&&(t=[]);for(const n of e)if(n.type instanceof ie)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof ie)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),r=this._getTypeInfo(e.type,e.attributes),i=this._parseInt(t.value),s=new Xe(e.name,r,t.name,i);return null!==n&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new ke(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof ae){const n=e,r=this._getTypeInfo(n.format,n.attributes),i=new Be(n.name,t);return i.format=r,i.count=n.count,this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof ie){const n=e,r=new Pe(n.name,t);for(const e of n.members){const t=this._getTypeInfo(e.type,e.attributes);r.members.push(new Fe(e.name,t,e.attributes))}return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof le){const n=e,r=n.format instanceof re,i=n.format?r?this._getTypeInfo(n.format,null):new Oe(n.format,null):null,s=new De(n.name,i,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof se){const n=e,r=n.format?this._getTypeInfo(n.format,null):null,i=new De(n.name,r,t,n.access);return this._types.set(e,i),this._updateTypeInfo(i),i}const n=new Oe(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n;const r=this._getTypeSize(e);if(e.size=null!==(t=null==r?void 0:r.size)&&void 0!==t?t:0,e instanceof Be){const t=this._getTypeSize(e.format);e.stride=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,this._updateTypeInfo(e.format)}e instanceof Pe&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,r=0,i=0,s=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+r),r=u,i=n,s=Math.max(s,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(s,i+r),e.align=s}_getTypeSize(e){var t;if(null==e)return null;const n=this._getAttributeNum(e.attributes,"size",0),r=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Fe&&(e=e.type),e instanceof Oe){const t=this._getAlias(e.name);null!==t&&(e=t)}{const t=ze._typeInfo[e.name];if(void 0!==t){const i="f16"===e.format?2:1;return new Ve(Math.max(r,t.align/i),Math.max(n,t.size/i))}}{const t=ze._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const i="h"===e.name[e.name.length-1]?2:1;return new Ve(Math.max(r,t.align/i),Math.max(n,t.size/i))}}if(e instanceof Be){let i=e,s=8,o=8;const a=this._getTypeSize(i.format);null!==a&&(o=a.size,s=a.align);return o=i.count*this._getAttributeNum(null!==(t=null==e?void 0:e.attributes)&&void 0!==t?t:null,"stride",this._roundUp(s,o)),n&&(o=n),new Ve(Math.max(r,s),Math.max(n,o))}if(e instanceof Pe){let t=0,i=0,s=0,o=0,a=0;for(const n of e.members){const e=this._getTypeSize(n.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+o),o=e.size,a=s)}return i=this._roundUp(t,a+o),new Ve(Math.max(r,t),Math.max(n,i))}return null}_isUniformVar(e){return e instanceof V&&"uniform"==e.storage}_isStorageVar(e){return e instanceof V&&"storage"==e.storage}_isTextureVar(e){return e instanceof V&&null!==e.type&&-1!=ze._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof V&&null!==e.type&&-1!=ze._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const r=n.attributes;for(let i of r)if(i.name==t)return i;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let r of e)if(r.name==t){let e=null!==r&&null!==r.value?r.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}function je(e){const t={attributes:[],bindings:[]},n=function(e){try{return new ze(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&null!=t&&t.message&&(e+=": "+t.message+" "),"object"==typeof t&&null!=t&&t.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e);for(const s of n.uniforms){const e=[];for(const t of s.type.members)e.push({name:t.name,type:Ze(t.type)});t.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:e})}const r=n.entry.vertex[0],i=r.inputs.length;for(let s=0;s<i;s++){const e=r.inputs[s];if("location"===e.locationType){const n=Ze(e.type);t.attributes.push({name:e.name,location:e.location,type:n})}}return t}function Ze(e){return e.format?e.name+"<"+e.format.name+">":e.name}function qe(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}ze._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},ze._textureTypes=Ie.any_texture_type.map((e=>e.name)),ze._samplerTypes=Ie.sampler_type.map((e=>e.name));const Qe={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function $e(e){let t=Je(e);if("object"!==t)return{value:e,...Qe[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Qe[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=Je(e.value),{...e,...Qe[t],type:t}):{type:"object",value:null};throw new Error("props")}function Je(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const et=e=>""+e;var tt,nt;function rt(e,t){return t||(t=e.slice(0)),e.raw=t,e}const it={vertex:et(tt||(tt=rt(["#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"],["\\\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"]))),fragment:et(nt||(nt=rt(["#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"],["\\\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"])))},st=/void\s+main\s*\([^)]*\)\s*\{\n?/,ot=/}\n?[^{}]*$/,at=[],lt="__LUMA_INJECT_DECLARATIONS__";function ct(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function ut(e,t,n,r){void 0===r&&(r=!1);const i="vertex"===t;for(const s in n){const t=n[s];t.sort(((e,t)=>e.order-t.order)),at.length=t.length;for(let e=0,n=t.length;e<n;++e)at[e]=t[e].injection;const r=at.join("\n")+"\n";switch(s){case"vs:#decl":i&&(e=e.replace(lt,r));break;case"vs:#main-start":i&&(e=e.replace(st,(e=>e+r)));break;case"vs:#main-end":i&&(e=e.replace(ot,(e=>r+e)));break;case"fs:#decl":i||(e=e.replace(lt,r));break;case"fs:#main-start":i||(e=e.replace(st,(e=>e+r)));break;case"fs:#main-end":i||(e=e.replace(ot,(e=>r+e)));break;default:e=e.replace(s,(e=>e+r))}}return e=e.replace(lt,""),r&&(e=e.replace(/\}\s*$/,(e=>e+it[t]))),e}let _t=1;class ht{static instantiateModules(e){return e.map((e=>{if(e instanceof ht)return e;qe("string"!=typeof e,"Shader module use by name is deprecated. Import shader module '"+JSON.stringify(e)+"' and use it directly."),e.name||(console.warn("shader module has no name"),e.name="shader-module-"+_t++);const t=new ht(e);return t.dependencies=ht.instantiateModules(e.dependencies||[]),t}))}constructor(e){this.uniforms={},this.uniformTypes={};const{name:t,vs:n,fs:r,dependencies:i=[],uniformPropTypes:s={},getUniforms:o,deprecations:a=[],defines:l={},inject:c={}}=e;qe("string"==typeof t),this.name=t,this.vs=n,this.fs=r,this.getModuleUniforms=o,this.dependencies=ht.instantiateModules(i),this.deprecations=this._parseDeprecationDefinitions(a),this.defines=l,this.injections=function(e){const t={vertex:{},fragment:{}};for(const n in e){let r=e[n];"string"==typeof r&&(r={order:0,injection:r}),t[ct(n)][n]=r}return t}(c),s&&(this.uniforms=function(e){const t={};for(const[n,r]of Object.entries(e))t[n]=$e(r);return t}(s))}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:qe(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return"// ----- MODULE "+this.name+" ---------------\n\n#define MODULE_"+n+"\n"+t+"\n\n"}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):function(e,t,n){const r={};for(const[i,s]of Object.entries(t))e&&i in e&&!s.private?(s.validate&&qe(s.validate(e[i],s),n+": invalid "+i),r[i]=e[i]):r[i]=s.value;return r}(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach((n=>{var r;null!=(r=n.regex)&&r.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(e){return e.forEach((e=>{if("function"===e.type)e.regex=new RegExp("\\b"+e.old+"\\(");else e.regex=new RegExp(e.type+" "+e.old+";")})),e}_defaultGetUniforms(e){void 0===e&&(e={});const t={},n=this.uniforms;for(const r in n){const i=n[r];r in e&&!i.private?(i.validate&&qe(i.validate(e[r],i),this.name+": invalid "+r),t[r]=e[r]):t[r]=i.value}return t}}function dt(e){return ft(ht.instantiateModules(e))}function ft(e){const t={},n={};return Et({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]))}function Et(e){const{modules:t,level:n,moduleMap:r,moduleDepth:i}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)r[s.name]=s,(void 0===i[s.name]||i[s.name]<n)&&(i[s.name]=n);for(const s of t)s.dependencies&&Et({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}var pt,gt,mt,At,Rt,Tt,Lt,vt,St,bt;function Ct(e,t){return t||(t=e.slice(0)),e.raw=t,e}function Gt(e,t,n){var r;if(300!==Number((null==(r=e.match(/^#version[ \t]+(\d+)/m))?void 0:r[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case 300:switch(n){case"vertex":return e=Pt(e,yt);case"fragment":return e=Pt(e,It);default:throw new Error(n)}case 100:switch(n){case"vertex":return e=Pt(e,wt);case"fragment":return e=function(e){e=Pt(e,xt);const t=Ft.exec(e);if(t){const n=t[1];e=e.replace(Ft,"").replace(new RegExp("\\b"+n+"\\b","g"),Ot)}return e}(e=Pt(e,xt));default:throw new Error(n)}default:throw new Error(String(t))}}const Nt=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],yt=[...Nt,[Bt("attribute"),"in $1"],[Bt("varying"),"out $1"]],It=[...Nt,[Bt("varying"),"in $1"]],Mt=[[/^#version[ \t]+300[ \t]+es/,"#version 100"],[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]],wt=[...Mt,[Bt("in"),"attribute $1"],[Bt("out"),"varying $1"]],xt=[...Mt,[Bt("in"),"varying $1"]],Ot="gl_FragColor",Ft=/\bout[ \t]+vec4[ \t]+(\w+)[ \t]*;\n?/;function Pt(e,t){for(const[n,r]of t)e=e.replace(n,r);return e}function Bt(e){return new RegExp("\\b"+e+"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)","g")}function Dt(e,t){let n="";for(const r in e){const i=e[r];if(n+="void "+i.signature+" {\n",i.header&&(n+="  "+i.header),t[r]){const e=t[r];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+="  "+t.injection+"\n"}i.footer&&(n+="  "+i.footer),n+="}\n"}return n}function Ut(e){const t={vertex:{},fragment:{}};for(const n of e){let e,r;"string"!=typeof n?(e=n,r=e.hook):(e={},r=n),r=r.trim();const[i,s]=r.split(":"),o=r.replace(/\(.+/,""),a=Object.assign(e,{signature:s});switch(i){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(i)}}return t}function kt(e,t){void 0===t&&(t="unnamed");const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function Vt(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error("Invalid GLSL version "+t);return t}var Xt;const Ht="\n\n"+lt+"\n",Wt=et(Xt||(Kt=["precision highp float;\n"],(Yt=["\\\nprecision highp float;\n"])||(Yt=Kt.slice(0)),Kt.raw=Yt,Xt=Kt));var Kt,Yt;function zt(e,t){const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=t;qe("string"==typeof n,"shader source must be a string");const l=n;let c="";const u=Ut(s),_={},h={},d={};for(const E in o){const e="string"==typeof o[E]?{injection:o[E],order:0}:o[E],t=/^(v|f)s:(#)?([\w-]+)$/.exec(E);if(t){const n=t[2],r=t[3];n?"decl"===r?h[E]=[e]:d[E]=[e]:_[E]=[e]}else d[E]=[e]}const f="webgpu"!==e.type?i:[];for(const E of f){a&&E.checkDeprecations(l,a);c+=E.getModuleSource(r,"wgsl");const e=E.injections[r];for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?h:d;r[t]=r[t]||[],r[t].push(e[t])}else _[t]=_[t]||[],_[t].push(e[t])}}return c+=Ht,c=ut(c,r,h),c+=Dt(u[r],_),c+=l,c=ut(c,r,d),c}function jt(e,t){const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:_}=t;qe("string"==typeof r,"shader source must be a string");const h="glsl"===s?function(e,t){return{name:kt(e,t),language:"glsl",version:Vt(e)}}(r).version:-1,d=e.shaderLanguageVersion,f=100===h?"#version 100":"#version 300 es",E=r.split("\n").slice(1).join("\n"),p={};o.forEach((e=>{Object.assign(p,e.getDefines())})),Object.assign(p,a);let g="";switch(s){case"wgsl":break;case"glsl":g=u?f+"\n\n// ----- PROLOGUE -------------------------\n"+function(e){const{id:t,source:n,stage:r}=e,i=t&&-1===n.indexOf("SHADER_NAME");return i?"\n#define SHADER_NAME "+t+"_"+r+"\n\n":""}({id:n,source:r,stage:i})+"\n#define SHADER_TYPE_"+i.toUpperCase()+"\n"+function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return et(pt||(pt=Ct(["#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])));case"nvidia":return et(gt||(gt=Ct(["#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n"],["\\\n#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n"])));case"intel":return et(mt||(mt=Ct(["#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])));case"amd":return et(At||(At=Ct(["#define AMD_GPU\n"],["\\\n#define AMD_GPU\n"])));default:return et(Rt||(Rt=Ct(["#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])))}}(e)+"\n"+function(e){let t="";return e.features.has("webgl2")&&(t+=et(Tt||(Tt=Ct(["# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n"],["\\\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n"])))),e.features.has("webgl2")||(e.features.has("glsl-frag-depth")&&(t+=et(Lt||(Lt=Ct(["\n// FEATURE_GLSL_FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n# extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"],["\\\n\n// FEATURE_GLSL_FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n# extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"])))),null!=e&&e.features.has("glsl-derivatives")&&(t+=et(vt||(vt=Ct(["\n// FEATURE_GLSL_DERIVATIVES => dxdF, dxdY and fwidth are available\n#if defined(GL_OES_standard_derivatives) || defined(FEATURE_GLSL_DERIVATIVES)\n# extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n#endif\n"],["\\\n\n// FEATURE_GLSL_DERIVATIVES => dxdF, dxdY and fwidth are available\n#if defined(GL_OES_standard_derivatives) || defined(FEATURE_GLSL_DERIVATIVES)\n# extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n#endif\n"])))),null!=e&&e.features.has("glsl-frag-data")&&(t+=et(St||(St=Ct(["\n// FEATURE_GLSL_DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n# extension GL_EXT_draw_buffers : require\n# define FEATURE_GLSL_DRAW_BUFFERS\n#endif\n"],["\\\n\n// FEATURE_GLSL_DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n# extension GL_EXT_draw_buffers : require\n# define FEATURE_GLSL_DRAW_BUFFERS\n#endif\n"])))),null!=e&&e.features.has("glsl-texture-lod")&&(t+=et(bt||(bt=Ct(["// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n# extension GL_EXT_shader_texture_lod : enable\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n#endif\n"],["\\\n// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n# extension GL_EXT_shader_texture_lod : enable\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n#endif\n"]))))),t}(e)+"\n"+("fragment"===i?Wt:"")+"\n\n// ----- APPLICATION DEFINES -------------------------\n\n"+function(e){void 0===e&&(e={});let t="";for(const n in e){const r=e[n];(r||Number.isFinite(r))&&(t+="#define "+n.toUpperCase()+" "+e[n]+"\n")}return t}(p)+"\n\n":f+"\n"}const m=Ut(l),A={},R={},T={};for(const L in c){const e="string"==typeof c[L]?{injection:c[L],order:0}:c[L],t=/^(v|f)s:(#)?([\w-]+)$/.exec(L);if(t){const n=t[2],r=t[3];n?"decl"===r?R[L]=[e]:T[L]=[e]:A[L]=[e]}else T[L]=[e]}for(const L of o){_&&L.checkDeprecations(E,_);g+=L.getModuleSource(i);const e=L.injections[i];for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const r="decl"===n[2]?R:T;r[t]=r[t]||[],r[t].push(e[t])}else A[t]=A[t]||[],A[t].push(e[t])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=Ht,g=ut(g,i,R),g+=Dt(m[i],A),g+=E,g=ut(g,i,T),"glsl"===s&&h!==d&&(g=Gt(g,d,i)),g.trim()}function Zt(e){return function(t){const n={};for(const r of e){const e=r.getUniforms(t,n);Object.assign(n,e)}return n}}function qt(e,t){if("string"==typeof t)return t;if("webgpu"===e.type){if(null!=t&&t.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders")}if(null!=t&&t.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}class Qt{constructor(){this._hookFunctions=[],this._defaultModules=[]}static getDefaultShaderAssembler(){return Qt.defaultShaderAssembler=Qt.defaultShaderAssembler||new Qt,Qt.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find((t=>t.name===("string"==typeof e?e:e.name)))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t))}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShaders(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,r=function(e){if(!e.vs)throw new Error("no vertex shader");const t=qt(e.platformInfo,e.vs);let n;return e.fs&&(n=qt(e.platformInfo,e.fs)),{...e,vs:t,fs:n}}(e),i=function(e){const{vs:t,fs:n}=e,r=dt(e.modules||[]);switch(e.platformInfo.shaderLanguage){case"glsl":return{vs:jt(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:jt(e.platformInfo,{...e,source:n,stage:"fragment",modules:r}),getUniforms:Zt(r)};case"wgsl":return{vs:zt(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:zt(e.platformInfo,{...e,source:n,stage:"fragment",modules:r}),getUniforms:Zt(r)}}}({platformInfo:e.platformInfo,...r,modules:t,hookFunctions:n});return{...i,modules:t}}_getModuleList(e){void 0===e&&(e=[]);const t=new Array(this._defaultModules.length+e.length),n={};let r=0;for(let i=0,s=this._defaultModules.length;i<s;++i){const e=this._defaultModules[i],s=e.name;t[r++]=e,n[s]=!0}for(let i=0,s=e.length;i<s;++i){const s=e[i],o=s.name;n[o]||(t[r++]=s,n[o]=!0)}return t.length=r,ht.instantiateModules(t)}}class $t{constructor(e){const t=dt(Object.values(e));f.c.log(1,"Creating ShaderInputs with modules",t.map((e=>e.name)))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,r]of Object.entries(e)){const e=n;this.moduleUniforms[e]=r.defaultUniforms||{},this.moduleBindings[e]={}}}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,r=e[n],i=this.modules[n];if(!i){f.c.warn("Module "+t+" not found")();continue}const s=this.moduleUniforms[n],o=(null==i.getUniforms?void 0:i.getUniforms(r,this.moduleUniforms[n]))||r;this.moduleUniforms[n]={...s,...o}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[n,r]of Object.entries(this.moduleUniforms))for(const[i,s]of Object.entries(r)){var t;e[n+"."+i]={type:null==(t=this.modules[n].uniformTypes)?void 0:t[i],value:String(s)}}return e}}class Jt{constructor(e){this.userData={},this.bufferLayout=[],this.id=e.id||(0,S.hQ)("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&(0,c.h)(this.indices.usage===o.l.INDEX)}destroy(){var e;this.indices.destroy(),this.attributes.positions.destroy(),this.attributes.normals.destroy(),this.attributes.texCoords.destroy(),null==(e=this.attributes.colors)||e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function en(e,t){if(t instanceof Jt)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:o.l.INDEX,data:n})}(e,t),{attributes:r,bufferLayout:i}=function(e,t){const n=[],r={};for(const[s,o]of Object.entries(t.attributes)){let t=s;switch(s){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}r[t]=e.createBuffer({data:o.value,id:s+"-buffer"});const{value:i,size:a,normalized:l}=o;n.push({name:t,format:L(i,a,l)})}const i=t._calculateVertexCount(t.attributes,t.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}(e,t);return new Jt({topology:t.topology||"triangle-list",bufferLayout:i,vertexCount:t.vertexCount,indices:n,attributes:r})}class tn{static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new tn(e),e._lumaData.defaultPipelineFactory}constructor(e){this._hashCounter=0,this._hashes={},this._useCounts={},this._pipelineCache={},this.device=e}createRenderPipeline(e){const t={...tn.defaultProps,...e},n=this._hashRenderPipeline({...t});if(!this._pipelineCache[n]){const e=this.device.createRenderPipeline({...t,vs:this.device.createShader({stage:"vertex",source:t.vs}),fs:t.fs?this.device.createShader({stage:"fragment",source:t.fs}):null});e.hash=n,this._pipelineCache[n]=e,this._useCounts[n]=0}return this._useCounts[n]++,this._pipelineCache[n]}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._pipelineCache[t].destroy(),delete this._pipelineCache[t],delete this._useCounts[t])}_createRenderPipeline(e){if(!e.fs)throw new Error("fs");return this.device.createRenderPipeline({...e,vs:this.device.createShader({stage:"vertex",source:e.vs}),fs:e.fs?this.device.createShader({stage:"fragment",source:e.fs}):null})}_hashRenderPipeline(e){const t=this._getHash(e.vs),n=e.fs?this._getHash(e.fs):0;if("webgpu"===this.device.info.type){const r=this._getHash(JSON.stringify(e.parameters)),i=this._getHash(JSON.stringify(e.bufferLayout));return t+"/"+n+"V-T"+e.topology+"P"+r+"BL"+i+"}"}return t+"/"+n+"V-"}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}tn.defaultProps={...v.h.defaultProps,vs:void 0,fs:void 0};let nn=null,rn=null;class sn{constructor(e,t){var n,r,i;this.userData={},this.instanceCount=0,this.indexBuffer=null,this.bufferAttributes={},this.constantAttributes={},this.bindings={},this.uniforms={},this.transformFeedback=null,this._pipelineNeedsUpdate="newly created",this._attributeInfos={},this._gpuGeometry=null,this._lastLogTime=0,this._logOpen=!1,this._drawCount=0,this.props={...sn.defaultProps,...t},t=this.props,this.id=t.id||(0,S.hQ)("model"),this.device=e,Object.assign(this.userData,t.userData);const s=Object.fromEntries((null==(n=this.props.modules)?void 0:n.map((e=>[e.name,e])))||[]);this.setShaderInputs(t.shaderInputs||new $t(s));const o="webgpu"===this.device.info.type;if(this.props.source){var a;if(o)(a=this.props).shaderLayout||(a.shaderLayout=je(this.props.source));this.props.fs=this.props.source,this.props.vs=this.props.source}var l;o&&"string"!=typeof this.props.vs&&((l=this.props).shaderLayout||(l.shaderLayout=je(this.props.vs.wgsl)));const c=function(e){return{type:e.info.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),u=((null==(r=this.props.modules)?void 0:r.length)>0?this.props.modules:null==(i=this.shaderInputs)?void 0:i.getModules())||[],{vs:_,fs:h,getUniforms:d}=this.props.shaderAssembler.assembleShaders({platformInfo:c,...this.props,modules:u});if(this.vs=_,this.fs=h,this._getModuleUniforms=d,this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&(this._gpuGeometry=this.setGeometry(t.geometry)),this.pipelineFactory=t.pipelineFactory||tn.getDefaultPipelineFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),t.vertexCount&&this.setVertexCount(t.vertexCount),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.indices)throw new Error("Model.props.indices removed. Use props.indexBuffer");t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&(f.c.warn("Model.props.moduleSettings is deprecated. Use Model.shaderInputs.setProps()")(),this.updateModuleSettings(t.moduleSettings)),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this.pipelineFactory.release(this.pipeline),this._uniformStore.destroy()}predraw(){this.updateShaderInputs()}draw(e){this.predraw();try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings),this.pipeline.setUniforms(this.uniforms);const{indexBuffer:t}=this.vertexArray,n=t?t.byteLength/("uint32"===t.indexType?4:2):void 0;this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback})}finally{this._logDrawCallEnd()}this._logFramebuffer(e)}setGeometry(e){const t=e&&en(this.device,e);return this.setTopology(t.topology||"triangle-list"),this.bufferLayout=on(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t),t}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find((e=>e.name===n))||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices),this.setAttributes(e.attributes,"ignore-unknown"),this.setAttributes(t)}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?on(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){b(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(e){this.vertexCount=e}setInstanceCount(e){this.instanceCount=e}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new p(this.shaderInputs.modules);for(const t of Object.keys(this.shaderInputs.modules)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[t+"Uniforms"]=e}}setShaderModuleProps(e){const t=this._getModuleUniforms(e),n=Object.keys(t).filter((e=>{const n=t[e];return!(0,a.v)(n)&&"number"!=typeof n&&"boolean"!=typeof n})),r={};for(const i of n)r[i]=t[i],delete t[i]}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues())}updateModuleSettings(e){f.c.warn("Model.updateModuleSettings is deprecated. Use Model.shaderInputs.setProps()")();const{bindings:t,uniforms:n}=(0,M.y)(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n)}setBindings(e){Object.assign(this.bindings,e)}setUniforms(e){this.pipeline.setUniforms(e),Object.assign(this.uniforms,e)}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e)}setTransformFeedback(e){this.transformFeedback=e}setAttributes(e,t){e.indices&&f.c.warn("Model:"+this.id+" setAttributes() - indexBuffer should be set using setIndexBuffer()")();for(const[n,r]of Object.entries(e)){const e=this.bufferLayout.find((e=>an(e).includes(n)));if(!e){f.c.warn("Model("+this.id+'): Missing layout for buffer "'+n+'".')();continue}const i=an(e);let s=!1;for(const t of i){const e=this._attributeInfos[t];e&&(this.vertexArray.setBuffer(e.location,r),s=!0)}s||"ignore-unknown"===t||f.c.warn("Model("+this.id+'): Ignoring buffer "'+r.id+'" for unknown attribute "'+n+'"')()}}setConstantAttributes(e){for(const[t,n]of Object.entries(e)){const e=this._attributeInfos[t];e?this.vertexArray.setConstant(e.location,n):f.c.warn('Model "'+this.id+': Ignoring constant supplied for unknown attribute "'+t+'"')()}}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate=this._pipelineNeedsUpdate||e}_updatePipeline(){if(this._pipelineNeedsUpdate){this.pipeline&&f.c.log(1,"Model "+this.id+': Recreating pipeline because "'+this._pipelineNeedsUpdate+'".')(),this._pipelineNeedsUpdate=!1;const e=this.device.createShader({id:this.id+"-vertex",stage:"vertex",source:this.vs}),t=this.fs?this.device.createShader({id:this.id+"-fragment",stage:"fragment",source:this.fs}):null;this.pipeline=this.device.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:e,fs:t}),this._attributeInfos=(0,w.G5)(this.pipeline.shaderLayout,this.bufferLayout)}return this.pipeline}_logDrawCallStart(){const e=f.c.level>3?0:1e4;f.c.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,f.c.group(2,">>> DRAWING MODEL "+this.id,{collapsed:f.c.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e,t){var n;const r={},i="Values";if(0===e.attributes.length&&(null==(n=e.varyings)||!n.length))return{"No attributes or varyings":{[i]:"N/A"}};for(const s of e.attributes)s&&(r["in "+s.location+" "+s.name+": "+s.type]={[i]:s.stepMode||"vertex"});for(const s of e.varyings||[])r["out "+s.location+" "+s.name]={[i]:JSON.stringify(s.accessor)};return r}(this.pipeline.shaderLayout,this.id);f.c.table(2,e)();const t=this.shaderInputs.getDebugTable();for(const[r,i]of Object.entries(this.uniforms))t[r]={value:i};f.c.table(2,t)();const n=this._getAttributeDebugTable();f.c.table(2,this._attributeInfos)(),f.c.table(2,n)(),f.c.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=f.c.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&function(e,t){let{id:n,minimap:r,opaque:i,top:s="0",left:o="0",rgbaScale:a=1}=t;nn||(nn=document.createElement("canvas"),nn.id=n,nn.title=n,nn.style.zIndex="100",nn.style.position="absolute",nn.style.top=s,nn.style.left=o,nn.style.border="blue 1px solid",nn.style.transform="scaleY(-1)",document.body.appendChild(nn),rn=nn.getContext("2d")),nn.width===e.width&&nn.height===e.height||(nn.width=e.width/2,nn.height=e.height/2,nn.style.width="400px",nn.style.height="400px");const l=e.device.readPixelsToArrayWebGL(e),c=rn.createImageData(e.width,e.height);for(let u=0;u<l.length;u+=4)c.data[0+u+0]=l[u+0]*a,c.data[0+u+1]=l[u+1]*a,c.data[0+u+2]=l[u+2]*a,c.data[0+u+3]=i?255:l[u+3]*a;rn.putImageData(c,0,0)}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos))e[n.location]={name:t,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=function(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}(t);return(e instanceof o.l?new n(e.debugData):e).toString()}}function on(e,t){const n=[...e];for(const r of t){const e=n.findIndex((e=>e.name===r.name));e<0?n.push(r):n[e]=r}return n}function an(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map((e=>e.attribute)):[e.name]}sn.defaultProps={...v.h.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,transformFeedback:void 0,shaderAssembler:Qt.getDefaultShaderAssembler()};class ln{constructor(e){this.userData={};const{attributes:t={},indices:n=null,vertexCount:r=null}=e;this.id=e.id||(0,S.hQ)("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[i,s]of Object.entries(t)){const e=ArrayBuffer.isView(s)?{value:s}:s;(0,c.h)(ArrayBuffer.isView(e.value),this._print(i)+": must be typed array or object with value as typed array"),"POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i?((0,c.h)(!this.indices),this.indices=e):this.attributes[i]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry "+this.id+" attribute "+e}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const r of Object.values(e)){const{value:e,size:t,constant:i}=r;!i&&e&&t>=1&&(n=Math.min(n,e.length/t))}return(0,c.h)(Number.isFinite(n)),n}}class cn extends ln{constructor(e){void 0===e&&(e={});const{id:t=(0,S.hQ)("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:t,topology:"triangle-list",indices:{size:1,value:un},attributes:{...gn,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...mn,...e.attributes}})}}const un=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),_n=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),hn=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),dn=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),fn=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),En=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),pn=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),gn={POSITION:{size:3,value:_n},NORMAL:{size:3,value:hn},TEXCOORD_0:{size:2,value:dn}},mn={POSITION:{size:3,value:fn},TEXCOORD_0:{size:2,value:En},COLOR_0:{size:3,value:pn}};var An,Rn;function Tn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Ln={name:"dirlight",dependencies:[],vs:et(An||(An=Tn(["out vec3 dirlight_vNormal;\n\nvoid dirlight_setNormal(vec3 normal) {\n  dirlight_vNormal = normalize(normal);\n}\n"],["\\\nout vec3 dirlight_vNormal;\n\nvoid dirlight_setNormal(vec3 normal) {\n  dirlight_vNormal = normalize(normal);\n}\n"]))),fs:et(Rn||(Rn=Tn(["uniform dirlightUniforms {\n  vec3 lightDirection;\n} dirlight;\n\nin vec3 dirlight_vNormal;\n\n// Returns color attenuated by angle from light source\nvec4 dirlight_filterColor(vec4 color) {\n  float d = abs(dot(dirlight_vNormal, normalize(dirlight.lightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n"],["\\\nuniform dirlightUniforms {\n  vec3 lightDirection;\n} dirlight;\n\nin vec3 dirlight_vNormal;\n\n// Returns color attenuated by angle from light source\nvec4 dirlight_filterColor(vec4 color) {\n  float d = abs(dot(dirlight_vNormal, normalize(dirlight.lightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n"]))),uniformTypes:{lightDirection:"vec3<f32>"},defaultUniforms:{lightDirection:new Float32Array([1,1,2])},getUniforms:function(e){void 0===e&&(e=Ln.defaultUniforms);const t={};e.lightDirection&&(t.dirlight_uLightDirection=e.lightDirection);return t}};var vn=n(3364),Sn=n(5715);function bn(){let e=1,t=1;return()=>{return e=Math.sin(17.23*t),t=Math.cos(27.92*e),(n=1432.71*Math.abs(e*t))-Math.floor(n);var n}}bn();var Cn,Gn;function Nn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const yn=bn(),In={uniformTypes:{uColor:"vec3<f32>",uModel:"mat4x4<f32>",uView:"mat4x4<f32>",uProjection:"mat4x4<f32>"}},Mn=s(Cn||(Cn=Nn(["#version 300 es\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nuniform appUniforms {\n  vec3 uColor;\n  mat4 uModel;\n  mat4 uView;\n  mat4 uProjection;\n} app;\n\nvarying vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(app.uModel * vec4(normals, 0.0));\n\n  // Set up data for modules\n  color = app.uColor;\n  dirlight_setNormal(normal);\n  gl_Position = app.uProjection * app.uView * app.uModel * vec4(positions, 1.0);\n}\n"],["\\\n#version 300 es\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nuniform appUniforms {\n  vec3 uColor;\n  mat4 uModel;\n  mat4 uView;\n  mat4 uProjection;\n} app;\n\nvarying vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(app.uModel * vec4(normals, 0.0));\n\n  // Set up data for modules\n  color = app.uColor;\n  dirlight_setNormal(normal);\n  gl_Position = app.uProjection * app.uView * app.uModel * vec4(positions, 1.0);\n}\n"]))),wn=s(Gn||(Gn=Nn(["#version 300 es\n\nprecision highp float;\n\nvarying vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nvarying vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n}\n"])));class xn extends g{constructor(e){let{device:t,aspect:n,animationLoop:r}=e;super(),this.translations=[[2,-2,0],[2,2,0],[-2,2,0],[-2,-2,0]],this.rotations=[[yn(),yn(),yn()],[yn(),yn(),yn()],[yn(),yn(),yn()],[yn(),yn(),yn()]],this.colors=[[1,0,0],[0,1,0],[0,0,1],[1,1,0]],this.keyFrameData=[[0,0],[1e3,2*Math.PI],[2e3,Math.PI],[3e3,2*Math.PI],[4e3,0]],this.globalUniformStore=new p({dirlight:Ln});const i=document.getElementById("play"),s=document.getElementById("pause");this.timeSlider=document.getElementById("time"),i&&s&&(i.addEventListener("click",(()=>this.timeline.play())),s.addEventListener("click",(()=>this.timeline.pause())),this.timeSlider.addEventListener("input",(e=>this.timeline.setTime(parseFloat(e.target.value))))),this.timeline=new R,r.attachTimeline(this.timeline),this.timeline.play();const o=[this.timeline.addChannel({delay:2e3,rate:.5,duration:8e3,repeat:2}),this.timeline.addChannel({delay:1e4,rate:.2,duration:2e4,repeat:1}),this.timeline.addChannel({delay:7e3,rate:1,duration:4e3,repeat:8}),this.timeline.addChannel({delay:0,rate:.8,duration:5e3,repeat:Number.POSITIVE_INFINITY})];this.cubes=new Array(4);const a=[new T(this.keyFrameData),new T(this.keyFrameData),new T(this.keyFrameData),new T(this.keyFrameData)];for(let l=0;l<4;++l){this.timeline.attachAnimation(a[l],o[l]);const e=new p({app:In});e.setUniforms({app:{uProjection:(new vn.y).perspective({fovy:(0,Sn.uR)(60),aspect:n,near:1,far:20}),uView:(new vn.y).lookAt({center:[0,0,0],eye:[0,0,-8]}),uColor:this.colors[l]}}),this.cubes[l]={uniformStore:e,translation:this.translations[l],rotation:this.rotations[l],keyFrames:a[l],model:new sn(t,{id:"cube-"+l,vs:Mn,fs:wn,modules:[Ln],geometry:new cn,parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"},bindings:{app:e.getManagedUniformBuffer(t,"app"),dirlight:this.globalUniformStore.getManagedUniformBuffer(t,"dirlight")}})}}}onFinalize(){for(const e of this.cubes)e.model.destroy()}onRender(e){let{device:t}=e;this.timeSlider&&(this.timeSlider.value=this.timeline.getTime());const n=new vn.y;for(const i of this.cubes){const e=i.keyFrames.getStartData(),t=i.keyFrames.getEndData(),r=e+i.keyFrames.factor*(t-e),s=i.rotation[0]+r,o=i.rotation[1]+r,a=i.rotation[2];n.identity().translate(i.translation).rotateXYZ([s,o,a]),i.model.setUniforms({}),i.uniformStore.setUniforms({app:{uModel:n}}),i.uniformStore.updateUniformBuffers()}const r=t.beginRenderPass({clearColor:[0,0,0,1]});for(const i of this.cubes)i.model.draw(r);r.end()}}xn.info='Key frame animation based on multiple hierarchical timelines.\n<button id="play">Play</button>\n<button id="pause">Pause</button><BR>\nTime: <input type="range" id="time" min="0" max="30000" step="1"><BR>\n';var On,Fn,Pn,Bn,Dn=n(4025),Un=n(180);function kn(e,t){return t||(t=e.slice(0)),e.raw=t,e}class Vn extends sn{constructor(e,t){const n=s(On||(On=kn(["attribute vec3 positions;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nvarying vec3 vPosition;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = positions;\n}\n"],["\\\nattribute vec3 positions;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nvarying vec3 vPosition;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = positions;\n}\n"]))),r=s(Fn||(Fn=kn(["precision highp float;\n\nuniform samplerCube uTextureCube;\nvarying vec3 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  // The outer cube just samples the texture cube directly\n  fragColor = textureCube(uTextureCube, normalize(vPosition));\n}\n"],["\\\nprecision highp float;\n\nuniform samplerCube uTextureCube;\nvarying vec3 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  // The outer cube just samples the texture cube directly\n  fragColor = textureCube(uTextureCube, normalize(vPosition));\n}\n"])));super(e,{...t,geometry:new cn,fs:r,vs:n})}}class Xn extends sn{constructor(e,t){const n=s(Pn||(Pn=kn(["attribute vec3 positions;\nattribute vec3 normals;\nattribute vec2 texCoords;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = vec3(uModel * vec4(positions,1));\n  vNormal = vec3(uModel * vec4(normals, 0));\n  vUV = texCoords;\n}\n"],["\\\nattribute vec3 positions;\nattribute vec3 normals;\nattribute vec2 texCoords;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = vec3(uModel * vec4(positions,1));\n  vNormal = vec3(uModel * vec4(normals, 0));\n  vUV = texCoords;\n}\n"]))),r=s(Bn||(Bn=kn(["precision highp float;\n\nuniform sampler2D uTexture;\nuniform samplerCube uTextureCube;\nuniform vec3 uEyePosition;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n  vec4 color = texture2D(uTexture, vec2(vUV.x, 1.0 - vUV.y));\n  vec3 reflectedDir = reflect(normalize(vPosition - uEyePosition), vNormal);\n  vec4 reflectedColor = textureCube(uTextureCube, reflectedDir);\n\n  gl_FragColor = color * reflectedColor;\n}\n"],["\\\nprecision highp float;\n\nuniform sampler2D uTexture;\nuniform samplerCube uTextureCube;\nuniform vec3 uEyePosition;\n\nvarying vec3 vPosition;\nvarying vec3 vNormal;\nvarying vec2 vUV;\n\nvoid main(void) {\n  vec4 color = texture2D(uTexture, vec2(vUV.x, 1.0 - vUV.y));\n  vec3 reflectedDir = reflect(normalize(vPosition - uEyePosition), vNormal);\n  vec4 reflectedColor = textureCube(uTextureCube, reflectedDir);\n\n  gl_FragColor = color * reflectedColor;\n}\n"])));super(e,{...t,geometry:new cn,vs:n,fs:r})}}class Hn extends g{constructor(e){let{device:t}=e;super();const n=t.createTexture({dimension:"cube",mipmaps:!0,data:{[Un.GL.TEXTURE_CUBE_MAP_POSITIVE_X]:(0,Dn.po)("sky-posx.png"),[Un.GL.TEXTURE_CUBE_MAP_NEGATIVE_X]:(0,Dn.po)("sky-negx.png"),[Un.GL.TEXTURE_CUBE_MAP_POSITIVE_Y]:(0,Dn.po)("sky-posy.png"),[Un.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y]:(0,Dn.po)("sky-negy.png"),[Un.GL.TEXTURE_CUBE_MAP_POSITIVE_Z]:(0,Dn.po)("sky-posz.png"),[Un.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z]:(0,Dn.po)("sky-negz.png")}}),r=t.createTexture({data:"vis-logo.png",mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}});this.cube=new Vn(t,{bindings:{uTextureCube:n},uniforms:{uModel:(new vn.y).scale([20,20,20])},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}}),this.prism=new Xn(t,{bindings:{uTexture:r,uTextureCube:n},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.prism.destroy(),this.cube.destroy()}onRender(e){let{device:t,aspect:n,tick:r}=e;const i=[5,-3,5],s=(new vn.y).lookAt({eye:i}),o=(new vn.y).perspective({fovy:(0,Sn.uR)(75),aspect:n}),a=t.beginRenderPass({clearColor:[0,0,0,1]});this.cube.setUniforms({uView:s,uProjection:o}),this.cube.draw(a),this.prism.setUniforms({uEyePosition:i,uView:s,uProjection:o,uModel:(new vn.y).rotateX(.01*r).rotateY(.013*r)}),this.prism.draw(a),a.end()}}function Wn(e,t,n){return e+n*(t-e)}function Kn(e,t){for(var n=[],r=e;r<=t;r++)n.push(r);return n}function Yn(e,t){for(var n,r=e.length,i=0;r;)n=Math.floor(t()*r),i=e[r-=1],e[r]=e[n],e[n]=i;return e}Hn.info="\n<p>\nUses a luma.gl <code>TextureCube</code> to simulate a reflective\nsurface\n</p>\n";var zn,jn,Zn=function(e){return e*e*e*(e*(6*e-15)+10)},qn=function(e,t,n,r){var i=15&e,s=i<8?t:n,o=i<4?n:12==i||14==i?t:r;return(1&i?-s:s)+(2&i?-o:o)};function Qn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const $n=bn(),Jn=s(zn||(zn=Qn(["#version 300 es\nin vec3 position;\n\nuniform mat4 uMVP;\n\nout vec3 vUV;\nvoid main() {\n  vUV = position.xyz + 0.5;\n  gl_Position = uMVP * vec4(position, 1.0);\n  gl_PointSize = 2.0;\n}"],["\\\n#version 300 es\nin vec3 position;\n\nuniform mat4 uMVP;\n\nout vec3 vUV;\nvoid main() {\n  vUV = position.xyz + 0.5;\n  gl_Position = uMVP * vec4(position, 1.0);\n  gl_PointSize = 2.0;\n}"]))),er=s(jn||(jn=Qn(["#version 300 es\nprecision highp float;\nprecision lowp sampler3D;\nin vec3 vUV;\nuniform sampler3D uTexture;\nuniform float uTime;\nout vec4 fragColor;\nvoid main() {\n  float alpha = texture(uTexture, vUV + vec3(0.0, 0.0, uTime)).r * 0.1;\n  fragColor = vec4(fract(vUV) * alpha, alpha);\n}"],["\\\n#version 300 es\nprecision highp float;\nprecision lowp sampler3D;\nin vec3 vUV;\nuniform sampler3D uTexture;\nuniform float uTime;\nout vec4 fragColor;\nvoid main() {\n  float alpha = texture(uTexture, vUV + vec3(0.0, 0.0, uTime)).r * 0.1;\n  fragColor = vec4(fract(vUV) * alpha, alpha);\n}"])));class tr extends g{constructor(e){let{device:t}=e;if(super(),this.mvpMat=new vn.y,this.viewMat=(new vn.y).lookAt({eye:[1,1,1]}),"webgl2"!==t.info.type)throw new Error("THIS DEMO REQUIRES WEBGL 2, BUT YOUR BROWSER DOESN'T SUPPORT IT");const n=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("function"!=typeof e.interpolation)throw new TypeError("params.interpolation is not a function");if(!Array.isArray(e.permutation))throw new TypeError("params.permutation is not an array");if(256!=e.permutation.length)throw new Error("params.permutation must have 256 items");for(var t=e.interpolation,n=e.permutation.slice(0),r=0;r<256;r++)n[256+r]=n[r];return function(e,r,i){var s=Math.floor(e),o=Math.floor(r),a=Math.floor(i),l=255&s,c=255&o,u=255&a;r-=o,i-=a;var _=Zn(e-=s),h=Zn(r),d=Zn(i),f=n[l]+c,E=n[f]+u,p=n[f+1]+u,g=n[l+1]+c,m=n[g]+u,A=n[g+1]+u;return t(t(t(qn(n[E],e,r,i),qn(n[m],e-1,r,i),_),t(qn(n[p],e,r-1,i),qn(n[A],e-1,r-1,i),_),h),t(t(qn(n[E+1],e,r,i-1),qn(n[m+1],e-1,r,i-1),_),t(qn(n[p+1],e,r-1,i-1),qn(n[A+1],e-1,r-1,i-1),_),h),d)}}({interpolation:Wn,permutation:Yn(Kn(0,255),$n)}),r=128,i=.0078125,s=new Float32Array(6291456);let o=0,a=-.5;for(let f=0;f<r;++f){let e=-.5;for(let t=0;t<r;++t){let t=-.5;for(let n=0;n<r;++n)s[o++]=a,s[o++]=e,s[o++]=t,t+=i;e+=i}a+=i}const l=t.createBuffer(s),c=16,u=1.12,_=new Uint8Array(4096);let h=0;for(let f=0;f<c;++f)for(let e=0;e<c;++e)for(let t=0;t<c;++t)_[h++]=255*(.5+.5*n(f/u,e/u,t/u));const d=t.createTexture({dimension:"3d",width:c,height:c,depth:c,data:_,format:"r8unorm",mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}});this.cloud=new sn(t,{vs:Jn,fs:er,topology:"point-list",vertexCount:s.length/3,attributes:{position:l},bindings:{uTexture:d},uniforms:{uView:this.viewMat},parameters:{blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one-minus-src-alpha"}})}onFinalize(){this.cloud.destroy()}onRender(e){let{device:t,tick:n,aspect:r}=e;this.mvpMat.perspective({fovy:(0,Sn.uR)(75),aspect:r,near:.1,far:10}).multiplyRight(this.viewMat);const i=t.beginRenderPass({clearColor:[0,0,0,1]});this.cloud.setUniforms({uTime:n/100,uMVP:this.mvpMat}),this.cloud.draw(i),i.end()}}tr.info="\n<p>\nVolumetric 3D noise visualized using a <b>3D texture</b>.\n<p>\nUses the luma.gl <code>Texture3D</code> class.\n",tr.props={useDevicePixels:!0};var nr,rr,ir=n(343);function sr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const or=new Float32Array([0,1,1,1]),ar={name:"picking",vs:et(nr||(nr=sr(["uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    // if (!bool(picking.isAttribute)) {\n    // Stores the picking color so that the fragment shader can render it during picking\n    picking_vRGBcolor_Avalid.rgb = pickingColor;\n    // }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n"],["\\\nuniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    // if (!bool(picking.isAttribute)) {\n    // Stores the picking color so that the fragment shader can render it during picking\n    picking_vRGBcolor_Avalid.rgb = pickingColor;\n    // }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n"]))),fs:et(rr||(rr=sr(["uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n"],["\\\nuniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n"]))),uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:or},getUniforms:function(e,t){void 0===e&&(e={});const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,(e=>e/255));Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute));void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors));return n}};var lr,cr;function ur(e,t){return t||(t=e.slice(0)),e.raw=t,e}const _r=bn(),hr=s(lr||(lr=ur(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nin vec2 instanceOffsets;\nin vec3 instanceColors;\nin vec2 instancePickingColors;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 viewMatrix;\n  mat4 projectionMatrix;\n  float time;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  color = instanceColors;\n\n  vec3 normal = vec3(app.modelMatrix * vec4(normals, 1.0));\n  dirlight_setNormal(normal);\n\n  vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  float delta = length(instanceOffsets);\n  vec4 offset = vec4(instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  gl_Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * vec4(positions * 1., 1.0) + offset);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nin vec2 instanceOffsets;\nin vec3 instanceColors;\nin vec2 instancePickingColors;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 viewMatrix;\n  mat4 projectionMatrix;\n  float time;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  color = instanceColors;\n\n  vec3 normal = vec3(app.modelMatrix * vec4(normals, 1.0));\n  dirlight_setNormal(normal);\n\n  vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  float delta = length(instanceOffsets);\n  vec4 offset = vec4(instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  gl_Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * vec4(positions * 1., 1.0) + offset);\n}\n"]))),dr=s(cr||(cr=ur(["#version 300 es\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n  fragColor = picking_filterColor(fragColor);\n}\n"],["\\\n#version 300 es\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n  fragColor = picking_filterColor(fragColor);\n}\n"]))),fr=256;class Er extends sn{constructor(e,t){const n=[];for(let c=0;c<fr;c++){const e=3*c-382.5;for(let t=0;t<fr;t++){const r=3*t-382.5;n.push(e,r)}}const r=new Float32Array(n),i=new Uint8Array(262144).map(((e,t)=>255*(.75*_r()+.25)));for(let c=0;c<i.length;c+=4)i[c+3]=255;const s=new Uint8Array(262144);for(let c=0;c<fr;c++)for(let e=0;e<fr;e++)s[2*(c*fr+e)+0]=c,s[2*(c*fr+e)+1]=e,s[2*(c*fr+e)+2]=0,s[2*(c*fr+e)+3]=0;const o=e.createBuffer(r),a=e.createBuffer(i),l=e.createBuffer(s);super(e,{...t,vs:{wgsl:"struct AppUniforms {\n  modelMatrix: mat4x4<f32>,\n  viewMatrix: mat4x4<f32>,\n  projectionMatrix: mat4x4<f32>,\n  time: f32,\n};\n\n@binding(0) @group(0) var<uniform> app : AppUniforms;\n\nstruct VertexInputs {\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) normals : vec3<f32>,\n  // INSTANCED ATTRIBUTES\n  @location(2) instanceOffsets : vec2<f32>,\n  @location(3) instanceColors : vec4<f32>,\n  @location(4) instancePickingColors : vec2<f32>,\n}\n\nstruct FragmentInputs {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) normal: vec3<f32>,\n  @location(1) color : vec4<f32>,\n}\n\n@vertex\nfn main(inputs: VertexInputs) -> FragmentInputs {\n  var outputs: FragmentInputs;\n\n  outputs.normal = (app.modelMatrix * vec4<f32>(inputs.normals, 0.0)).xyz;\n  outputs.color = inputs.instanceColors;\n\n  // vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  // picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  let delta = length(inputs.instanceOffsets);\n  let offset = vec4<f32>(inputs.instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  outputs.Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * inputs.positions + offset);\n  return outputs;\n}\n",glsl:hr},fs:{wgsl:"\nstruct DirlightUniforms {\n  lightDirection: vec3<f32>,\n}\n\n// @binding(1) @group(0) var<uniform> dirlight : DirlightUniforms;\n\nfn dirlight_filterColor(color: vec4<f32>, normal: vec3<f32>) -> vec4<f32> {\n  const dirlight_lightDirection = vec3<f32>(1, 1, 2);\n  let d: f32 = abs(dot(normal, normalize(dirlight_lightDirection)));\n  return vec4<f32>(color.rgb * d, color.a);\n}\n\nstruct FragmentInputs {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) normal: vec3<f32>,\n  @location(1) color : vec4<f32>,\n}\n\n@fragment\nfn main(inputs: FragmentInputs) -> @location(0) vec4<f32> { \n  return dirlight_filterColor(inputs.color, inputs.normal); \n}\n",glsl:dr},modules:"webgpu"!==e.info.type?[Ln,ar]:[],instanceCount:65536,geometry:new cn({indices:!0}),bufferLayout:[{name:"instanceOffsets",format:"float32x2"},{name:"instanceColors",format:"unorm8x4"},{name:"instancePickingColors",format:"unorm8x4"}],attributes:{instanceOffsets:o,instanceColors:a,instancePickingColors:l},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}}const pr={uniformTypes:{modelMatrix:"mat4x4<f32>",viewMatrix:"mat4x4<f32>",projectionMatrix:"mat4x4<f32>",time:"f32"}};class gr extends g{constructor(e){let{device:t,animationLoop:n}=e;super(),this.shaderInputs=new $t({app:pr,dirlight:Ln,picking:ar}),this.timeline=new R,n.attachTimeline(this.timeline),this.timeline.play(),this.timelineChannels={timeChannel:this.timeline.addChannel({rate:.01}),eyeXChannel:this.timeline.addChannel({rate:3e-4}),eyeYChannel:this.timeline.addChannel({rate:4e-4}),eyeZChannel:this.timeline.addChannel({rate:2e-4})},"webgpu"!==t.info.type&&(this.pickingFramebuffer=t.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"})),this.cube=new Er(t,{shaderInputs:this.shaderInputs})}onRender(e){const{device:t,aspect:n,tick:r}=e,{_mousePosition:i}=e,{timeChannel:s,eyeXChannel:o,eyeYChannel:a,eyeZChannel:l}=this.timelineChannels;this.shaderInputs.setProps({app:{time:this.timeline.getTime(s),projectionMatrix:(new vn.y).perspective({fovy:(0,Sn.uR)(60),aspect:n,near:1,far:2048}),viewMatrix:(new vn.y).lookAt({center:[0,0,0],eye:[Math.cos(this.timeline.getTime(o))*fr/2,Math.sin(this.timeline.getTime(a))*fr/2,(Math.sin(this.timeline.getTime(l))+1)*fr/4+32]}),modelMatrix:(new vn.y).rotateX(.01*r).rotateY(.013*r)}}),"webgpu"!==t.info.type&&this.pickInstance(t,i,this.cube,this.pickingFramebuffer);const c=t.beginRenderPass({clearColor:[0,0,0,1],clearDepth:1,clearStencil:0});this.cube.draw(c),c.end()}onFinalize(e){this.cube.destroy()}pickInstance(e,t,n,r){if(!t)return void this.shaderInputs.setProps({picking:{highlightedObjectColor:null}});const i=e.canvasContext.cssToDevicePixels(t),s=i.x+Math.floor(i.width/2),o=i.y+Math.floor(i.height/2);r.resize(e.canvasContext.getPixelSize()),this.shaderInputs.setProps({picking:{isActive:!0}});const a=e.beginRenderPass({framebuffer:r,clearColor:[0,0,0,0],clearDepth:1});n.draw(a),a.end();const l=(0,ir.z6)(r,{sourceX:s,sourceY:o,sourceWidth:1,sourceHeight:1});let c=new Float32Array(l).map((e=>e/255));c[0]+c[1]+c[2]>0||(c=null),this.shaderInputs.setProps({picking:{isActive:!1,highlightedObjectColor:c}})}}gr.info="\n<p>\nCube drawn with <b>instanced rendering</b>.\n<p>\nA luma.gl <code>Cube</code>, rendering 65,536 instances in a\nsingle GPU draw call using instanced vertex attributes.\n",gr.props={createFramebuffer:!0,debug:!0};class mr extends ln{constructor(e){void 0===e&&(e={});const{id:t=(0,S.hQ)("sphere-geometry")}=e,{indices:n,attributes:r}=function(e){const{nlat:t=10,nlong:n=10}=e,r=0,i=Math.PI-r,s=0,o=2*Math.PI-s,a=(t+1)*(n+1),l=(t,n,r,i,s)=>e.radius||1,c=new Float32Array(3*a),u=new Float32Array(3*a),_=new Float32Array(2*a),h=new(a>65535?Uint32Array:Uint16Array)(t*n*6);for(let f=0;f<=t;f++)for(let e=0;e<=n;e++){const r=e/n,s=f/t,a=e+f*(n+1),h=2*a,d=3*a,E=o*r,p=i*s,g=Math.sin(E),m=Math.cos(E),A=Math.sin(p),R=m*A,T=Math.cos(p),L=g*A,v=l(R,T,L,r,s);c[d+0]=v*R,c[d+1]=v*T,c[d+2]=v*L,u[d+0]=R,u[d+1]=T,u[d+2]=L,_[h+0]=r,_[h+1]=1-s}const d=n+1;for(let f=0;f<n;f++)for(let e=0;e<t;e++){const n=6*(f*t+e);h[n+0]=e*d+f,h[n+1]=e*d+f+1,h[n+2]=(e+1)*d+f,h[n+3]=(e+1)*d+f,h[n+4]=e*d+f+1,h[n+5]=(e+1)*d+f+1}return{indices:{size:1,value:h},attributes:{POSITION:{size:3,value:c},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:_}}}}(e);super({...e,id:t,topology:"triangle-list",indices:n,attributes:{...r,...e.attributes}})}}var Ar,Rr,Tr,Lr,vr,Sr=n(6280);function br(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Cr={uniformTypes:{color:"vec3<f32>",lighting:"f32",modelViewMatrix:"mat4x4<f32>",projectionMatrix:"mat4x3<f32>"}},Gr=s(Ar||(Ar=br(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform sphereUniforms {\n  // fragment shader\n  vec3 color;\n  bool lighting;\n  // vertex shader\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nout vec3 normal;\n\nvoid main(void) {\n  gl_Position = sphere.projectionMatrix * sphere.modelViewMatrix * vec4(positions, 1.0);\n  normal = vec3((sphere.modelViewMatrix * vec4(normals, 0.0)));\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform sphereUniforms {\n  // fragment shader\n  vec3 color;\n  bool lighting;\n  // vertex shader\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nout vec3 normal;\n\nvoid main(void) {\n  gl_Position = sphere.projectionMatrix * sphere.modelViewMatrix * vec4(positions, 1.0);\n  normal = vec3((sphere.modelViewMatrix * vec4(normals, 0.0)));\n}\n"]))),Nr=s(Rr||(Rr=br(["#version 300 es\n\nprecision highp float;\n\nuniform sphereUniforms {\n  // fragment\n  vec3 color;\n  bool lighting;\n  // vertex\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nin vec3 normal;\nout vec4 fragColor;\n\nvoid main(void) {\n  float attenuation = 1.0;\n  if (sphere.lighting) {\n    vec3 light = normalize(vec3(1,1,2));\n    attenuation = dot(normal, light);\n  }\n  fragColor = vec4(sphere.color * attenuation, 1);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sphereUniforms {\n  // fragment\n  vec3 color;\n  bool lighting;\n  // vertex\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nin vec3 normal;\nout vec4 fragColor;\n\nvoid main(void) {\n  float attenuation = 1.0;\n  if (sphere.lighting) {\n    vec3 light = normalize(vec3(1,1,2));\n    attenuation = dot(normal, light);\n  }\n  fragColor = vec4(sphere.color * attenuation, 1);\n}\n"]))),yr={uniformTypes:{resolution:"vec2<f32>"}},Ir=s(Tr||(Tr=br(["#version 300 es\n\nin vec2 aPosition;\n\nvoid main(void) {\n  gl_Position = vec4(aPosition, 0, 1);\n}\n"],["\\\n#version 300 es\n\nin vec2 aPosition;\n\nvoid main(void) {\n  gl_Position = vec4(aPosition, 0, 1);\n}\n"]))),Mr=s(Lr||(Lr=br(["#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nuniform screenQuadUniforms {\n  vec2 resolution;\n} screenQuad;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy/screenQuad.resolution.xy;\n  fragColor = texture(uTexture, p);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nuniform screenQuadUniforms {\n  vec2 resolution;\n} screenQuad;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy/screenQuad.resolution.xy;\n  fragColor = texture(uTexture, p);\n}\n"]))),wr={uniformTypes:{resolution:"vec2<f32>"}},xr=s(vr||(vr=br(["#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uScene;\nuniform sampler2D uPersistence;\n\nuniform persistenceQuadUniforms {\n  vec2 resolution;\n} persistence;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy / persistence.resolution.xy;\n  vec4 cS = texture(uScene, p);\n  vec4 cP = texture(uPersistence, p);\n  fragColor = mix(cS*4.0, cP, 0.9);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uScene;\nuniform sampler2D uPersistence;\n\nuniform persistenceQuadUniforms {\n  vec2 resolution;\n} persistence;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy / persistence.resolution.xy;\n  vec4 cS = texture(uScene, p);\n  vec4 cP = texture(uPersistence, p);\n  fragColor = mix(cS*4.0, cP, 0.9);\n}\n"]))),Or=bn(),Fr=[],Pr=[],Br=[];class Dr extends g{constructor(e){let{device:t,width:n,height:r}=e;super(),this.uniformStore=new p({sphere:Cr,screenQuad:yr,persistenceQuad:wr}),this.electron=new sn(t,{id:"electron",vs:Gr,fs:Nr,geometry:new mr({nlat:20,nlong:30}),bindings:{sphere:this.uniformStore.getManagedUniformBuffer(t,"sphere")},parameters:{depthWriteEnabled:!0,depthCompare:"less",cullMode:"back"}}),this.nucleon=new sn(t,{id:"nucleon",vs:Gr,fs:Nr,geometry:new mr({nlat:20,nlong:30}),parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"},bindings:{sphere:this.uniformStore.getManagedUniformBuffer(t,"sphere")}}),this.mainFramebuffer=t.createFramebuffer({width:n,height:r,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"}),this.pingpongFramebuffers=[t.createFramebuffer({width:n,height:r,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"}),t.createFramebuffer({width:n,height:r,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"})];const i=new ln({topology:"triangle-list",attributes:{aPosition:{value:new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),size:2}},vertexCount:6});this.screenQuad=new sn(t,{id:"quad",vs:Ir,fs:Mr,geometry:i,bindings:{screenQuad:this.uniformStore.getManagedUniformBuffer(t,"screenQuad")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"}}),this.persistenceQuad=new sn(t,{id:"persistence-quad",vs:Ir,fs:xr,geometry:i,bindings:{persistenceQuad:this.uniformStore.getManagedUniformBuffer(t,"persistenceQuad")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"}});for(let s=0;s<64;s++){const e=new Sr.P(Or()-.5,Or()-.5,Or()-.5),t=Or()+1;e.normalize().scale(t);const n=1.25;e.scale(n),Fr.push(e);const r=new Sr.P(Or()-.5,Or()-.5,Or()-.5),i=e.clone().cross(r).normalize(),s=4/t*.0125,o=(new vn.y).rotateAxis(s,i);Pr.push(o)}for(let s=0;s<64;s++){let e=new Sr.P(Or()-.5,Or()-.5,Or()-.5);e=e.normalize().scale(.5),Br.push(e)}}onFinalize(e){this.electron.destroy(),this.nucleon.destroy(),this.mainFramebuffer.destroy(),this.pingpongFramebuffers[0].destroy(),this.pingpongFramebuffers[1].destroy(),this.screenQuad.destroy(),this.persistenceQuad.destroy()}onRender(e){let{device:t,tick:n,width:r,height:i,aspect:s}=e;this.mainFramebuffer.resize({width:r,height:i}),this.pingpongFramebuffers[0].resize({width:r,height:i}),this.pingpongFramebuffers[1].resize({width:r,height:i});const o=(new vn.y).perspective({fovy:(0,Sn.uR)(75),aspect:s}),a=(new vn.y).lookAt({eye:[0,0,4]}),l=t.beginRenderPass({framebuffer:this.mainFramebuffer,clearColor:[0,0,0,1],clearDepth:1});this.uniformStore.setUniforms({sphere:{color:[0,.5,1],lighting:!1}});for(let f=0;f<64;f++){Fr[f]=Pr[f].transformVector(Fr[f]);const e=(new vn.y).translate(Fr[f]).scale([.06125,.06125,.06125]);this.uniformStore.setUniforms({sphere:{modelViewMatrix:a.clone().multiplyRight(e),projectionMatrix:o}}),this.uniformStore.updateUniformBuffers(),this.electron.draw(l)}this.uniformStore.setUniforms({sphere:{color:[1,.25,.25],lighting:!0}});for(let f=0;f<64;f++){const e=(new vn.y).rotateXYZ([.013*n,0,0]).rotateXYZ([0,.021*n,0]).translate(Br[f]),t=[e[12],e[13],e[14]];e.identity().translate(t).scale([.25,.25,.25]),this.uniformStore.setUniforms({sphere:{modelViewMatrix:a.clone().multiplyRight(e),projectionMatrix:o}}),this.uniformStore.updateUniformBuffers(),this.nucleon.draw(l)}l.end();const c=n%2,u=this.pingpongFramebuffers[c],_=this.pingpongFramebuffers[1-c],h=t.beginRenderPass({framebuffer:u,clearColor:[0,0,0,1]});this.persistenceQuad.setBindings({uScene:this.mainFramebuffer.colorAttachments[0],uPersistence:_.colorAttachments[0]}),this.uniformStore.setUniforms({persistenceQuad:{resolution:[r,i]}}),this.uniformStore.updateUniformBuffers(),this.persistenceQuad.draw(h),h.end();const d=t.beginRenderPass({clearColor:[1,0,0,1]});this.screenQuad.setBindings({uTexture:u.colorAttachments[0]}),this.uniformStore.setUniforms({screenQuad:{resolution:[r,i]}}),this.uniformStore.updateUniformBuffers(),this.screenQuad.draw(d),d.end()}}var Ur,kr;function Vr(e,t){return t||(t=e.slice(0)),e.raw=t,e}Dr.info="\n<p>\n  Electron trails renderings persist across multiple frames.\n<p>\n  Uses multiple luma.gl <code>Framebuffer</code>s to hold previously rendered data between frames.\n</p>\n";const Xr={uniformTypes:{mvpMatrix:"mat4x4<f32>"}},Hr=s(Ur||(Ur=Vr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 uMVP;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\n\nvoid main(void) {\n  gl_Position = app.uMVP * vec4(positions, 1.0);\n  fragUV = texCoords;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 uMVP;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\n\nvoid main(void) {\n  gl_Position = app.uMVP * vec4(positions, 1.0);\n  fragUV = texCoords;\n}\n"]))),Wr=s(kr||(kr=Vr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main(void) {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main(void) {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));\n}\n"]))),Kr=[0,0,5];class Yr extends g{constructor(e){let{device:t}=e;super(),this.mvpMatrix=new vn.y,this.viewMatrix=(new vn.y).lookAt({eye:Kr}),this.uniformStore=new p({app:Xr});const n=t.createTexture({data:"vis-logo.png",mipmaps:!0,sampler:t.createSampler({minFilter:"linear",magFilter:"linear",mipmapFilter:"linear"})});this.model=new sn(t,{vs:Hr,fs:Wr,geometry:new cn({indices:!1}),bindings:{uTexture:n,app:this.uniformStore.getManagedUniformBuffer(t,"app")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.model.destroy(),this.uniformStore.destroy()}onRender(e){let{device:t,aspect:n,tick:r}=e;this.mvpMatrix.perspective({fovy:Math.PI/3,aspect:n}).multiplyRight(this.viewMatrix).rotateX(.01*r).rotateY(.013*r),this.uniformStore.setUniforms({app:{mvpMatrix:this.mvpMatrix}});const i=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(i),i.end()}}var zr,jr,Zr,qr;function Qr(e,t){return t||(t=e.slice(0)),e.raw=t,e}Yr.info="<p>\nDrawing a textured cube\n</p>\n";const $r={name:"color",vs:s(zr||(zr=Qr(["out vec3 color_vColor;\n\nvoid color_setColor(vec3 color) {\n  color_vColor = color;\n}\n  "],["\\\nout vec3 color_vColor;\n\nvoid color_setColor(vec3 color) {\n  color_vColor = color;\n}\n  "]))),fs:s(jr||(jr=Qr(["in vec3 color_vColor;\n\nvec3 color_getColor() {\n  return color_vColor;\n}\n  "],["\\\nin vec3 color_vColor;\n\nvec3 color_getColor() {\n  return color_vColor;\n}\n  "])))};class Jr extends g{constructor(e){let{device:t}=e;super(),this.positionBuffer=t.createBuffer(new Float32Array([-.2,-.2,.2,-.2,0,.2])),this.colorBuffer=t.createBuffer(new Float32Array([1,0,0,0,1,0,0,0,1,1,1,0])),this.offsetBuffer=t.createBuffer(new Float32Array([.5,.5,-.5,.5,.5,-.5,-.5,-.5])),this.model=new sn(t,{vs:s(Zr||(Zr=Qr(["#version 300 es\nin vec2 position;\nin vec3 instanceColor;\nin vec2 instanceOffset;\n\nvoid main() {\n  color_setColor(instanceColor);\n  gl_Position = vec4(position + instanceOffset, 0.0, 1.0);\n}\n      "],["\\\n#version 300 es\nin vec2 position;\nin vec3 instanceColor;\nin vec2 instanceOffset;\n\nvoid main() {\n  color_setColor(instanceColor);\n  gl_Position = vec4(position + instanceOffset, 0.0, 1.0);\n}\n      "]))),fs:s(qr||(qr=Qr(["#version 300 es\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(color_getColor(), 1.0);\n}\n      "],["\\\n#version 300 es\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(color_getColor(), 1.0);\n}\n      "]))),modules:[$r],bufferLayout:[{name:"position",format:"float32x2"},{name:"instanceColor",format:"float32x3",stepMode:"instance"},{name:"instanceOffset",format:"float32x2",stepMode:"instance"}],attributes:{position:this.positionBuffer,instanceColor:this.colorBuffer,instanceOffset:this.offsetBuffer},vertexCount:3,instanceCount:4})}onFinalize(){this.model.destroy(),this.positionBuffer.destroy(),this.colorBuffer.destroy(),this.offsetBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(n),n.end()}}var ei;Jr.info="\nInstanced triangles using luma.gl's high-level API\n";const ti=s(ei||(ei=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["#version 300 es\n\nin vec3 vColor;\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(vColor, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 vColor;\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(vColor, 1.0);\n}\n"])));class ni extends g{constructor(e){let{device:t}=e;super();const n=new Float32Array([0,0,-.5,-.5,1,0,0,.5,-.5,0,1,0,0,.5,0,0,1]);this.interleavedBuffer=t.createBuffer(n),this.model=new sn(t,{id:"triangle",vs:"#version 300 es\n\nin vec2 position;\nin vec3 color;\n\nvarying vec3 vColor;\n\nvoid main() {\n  vColor = color;\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n",fs:ti,bufferLayout:[{name:"vertexData",byteStride:20,attributes:[{attribute:"position",format:"float32x2",byteOffset:8},{attribute:"color",format:"float32x3",byteOffset:16}]}],attributes:{vertexData:this.interleavedBuffer},vertexCount:3})}onFinalize(){this.model.destroy(),this.interleavedBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(n),n.end()}}var ri;ni.info="\nHave to start somewhere...\n";const ii=et(ri||(ri=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int pointLightCount;\n  int directionalLightCount;\n\n  vec3 ambientColor;\n\n  int lightType;\n  vec3 lightColor;\n  vec3 lightDirection;\n  vec3 lightPosition;\n  vec3 lightAttenuation;\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n"],["\\\nprecision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int pointLightCount;\n  int directionalLightCount;\n\n  vec3 ambientColor;\n\n  int lightType;\n  vec3 lightColor;\n  vec3 lightDirection;\n  vec3 lightPosition;\n  vec3 lightAttenuation;\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n"]))),si=255;var oi=function(e){return e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL",e}(oi||{});const ai={name:"lighting",vs:ii,fs:ii,getUniforms:(e,t)=>function(e,t){void 0===t&&(t={});if(e=e?{...e}:e,!e)return{...ai.defaultUniforms};e.lights&&(e={...e,...ci(e.lights),lights:void 0});const{ambientLight:n,pointLights:r,directionalLights:i}=e||{};if(!(n||r&&r.length>0||i&&i.length>0))return{...ai.defaultUniforms,enabled:0};const s={...ai.defaultUniforms,...t,...li({ambientLight:n,pointLights:r,directionalLights:i})};void 0!==e.enabled&&(s.enabled=e.enabled?1:0);return s}(e),defines:{MAX_LIGHTS:5},uniformTypes:{enabled:"i32",ambientLightColor:"vec3<f32>",numberOfLights:"i32",lightType:"i32",lightColor:"vec3<f32>",lightPosition:"vec3<f32>",lightDirection:"vec3<f32>",lightAttenuation:"vec3<f32>"},defaultUniforms:{enabled:1,ambientLightColor:[.1,.1,.1],numberOfLights:0,lightType:oi.POINT,lightColor:[1,1,1],lightPosition:[1,1,2],lightDirection:[1,1,1],lightAttenuation:[1,1,1]}};function li(e){let{ambientLight:t,pointLights:n=[],directionalLights:r=[]}=e;const i={};i.ambientLightColor=ui(t);let s=0;for(const o of n)i.lightType=oi.POINT,i.lightColor=ui(o),i.lightPosition=o.position,i.lightAttenuation=[o.attenuation||1,0,0],s++;for(const o of r)i.lightType=oi.DIRECTIONAL,i.lightColor=ui(o),i.lightPosition=o.position,i.lightDirection=o.direction,s++;return i.numberOfLights=s,i}function ci(e){var t,n;const r={pointLights:[],directionalLights:[]};for(const i of e||[])switch(i.type){case"ambient":r.ambientLight=i;break;case"directional":null==(t=r.directionalLights)||t.push(i);break;case"point":null==(n=r.pointLights)||n.push(i)}return r}function ui(e){void 0===e&&(e={});const{color:t=[0,0,0],intensity:n=1}=e;return t.map((e=>e*n/si))}var _i,hi;function di(e,t){return t||(t=e.slice(0)),e.raw=t,e}const fi={name:"phong-lighting",vs:et(_i||(_i=di(["uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n"],["\\\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n"]))),fs:et(hi||(hi=di(["uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    PointLight pointLight = lighting_getPointLight(0);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0:\n        PointLight pointLight = lighting_getPointLight(0);\n        vec3 light_position_worldspace = pointLight.position;\n        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n        break;\n\n      case 1:\n        DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n        break;\n    }\n  }\n  return lightColor;\n}\n"],["\\\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    PointLight pointLight = lighting_getPointLight(0);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0:\n        PointLight pointLight = lighting_getPointLight(0);\n        vec3 light_position_worldspace = pointLight.position;\n        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n        break;\n\n      case 1:\n        DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n        break;\n    }\n  }\n  return lightColor;\n}\n"]))),defines:{LIGHTING_FRAGMENT:1},dependencies:[ai],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms:e=>({...fi.defaultUniforms,...e})};var Ei,pi;function gi(e,t){return t||(t=e.slice(0)),e.raw=t,e}const mi=s(Ei||(Ei=gi(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} app;\n\nvoid main(void) {\n  vPosition = (app.modelMatrix * vec4(positions, 1.0)).xyz;\n  vNormal = mat3(app.modelMatrix) * normals;\n  vUV = texCoords;\n  gl_Position = app.mvpMatrix * vec4(positions, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} app;\n\nvoid main(void) {\n  vPosition = (app.modelMatrix * vec4(positions, 1.0)).xyz;\n  vNormal = mat3(app.modelMatrix) * normals;\n  vUV = texCoords;\n  gl_Position = app.mvpMatrix * vec4(positions, 1.0);\n}\n"]))),Ai=s(pi||(pi=gi(["#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nuniform sampler2D uTexture;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} uApp;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec3 surfaceColor = texture2D(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n  surfaceColor = lighting_getLightColor(surfaceColor, uApp.eyePosition, vPosition, normalize(vNormal));\n\n  fragColor = vec4(surfaceColor, 1.0);\n}\n"],["\\\n#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nuniform sampler2D uTexture;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} uApp;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec3 surfaceColor = texture2D(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n  surfaceColor = lighting_getLightColor(surfaceColor, uApp.eyePosition, vPosition, normalize(vNormal));\n\n  fragColor = vec4(surfaceColor, 1.0);\n}\n"]))),Ri={name:"app",uniformTypes:{modelMatrix:"mat4x4<f32>",mvpMatrix:"mat4x4<f32>",eyePosition:"vec3<f32>"}},Ti=[0,0,5];class Li extends g{constructor(e){let{device:t}=e;super(),this.shaderInputs=new $t({app:Ri,lighting:ai,phongMaterial:fi}),this.modelMatrix=new vn.y,this.viewMatrix=(new vn.y).lookAt({eye:Ti}),this.mvpMatrix=new vn.y,this.shaderInputs.setProps({lighting:{lights:[{type:"ambient",color:[255,255,255]},{type:"point",color:[255,255,255],position:[1,2,1]}]},phongMaterial:{specularColor:[255,255,255]}});const n=t.createTexture({data:"vis-logo.png"});this.model=new sn(t,{vs:mi,fs:Ai,shaderInputs:this.shaderInputs,geometry:new cn,bindings:{uTexture:n},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.model.destroy()}onRender(e){let{device:t,aspect:n,tick:r}=e;this.modelMatrix.identity().rotateX(.01*r).rotateY(.013*r),this.mvpMatrix.perspective({fovy:Math.PI/3,aspect:n}).multiplyRight(this.viewMatrix).multiplyRight(this.modelMatrix),this.shaderInputs.setProps({app:{mvpMatrix:this.mvpMatrix,modelMatrix:this.modelMatrix}});const i=t.beginRenderPass({clearColor:[0,0,0,1],clearDepth:!0});this.model.draw(i),i.end()}}Li.info="\n<p>\nDrawing a phong-shaded cube\n</p>\n";const vi="#version 300 es\n\nin vec2 position;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  OFFSET_POSITION(gl_Position);\n}\n",Si="#version 300 es\n\nuniform appUniforms {  \n  vec3 color;\n} app;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(app.color, 1.0);\n}\n",bi={name:"offsetLeft",inject:{"vs:OFFSET_POSITION":"position.x -= 0.5;"}},Ci={name:"offsetRight",inject:{"vs:OFFSET_POSITION":"position.x += 0.5;"}};class Gi extends g{constructor(e){let{device:t}=e;super(),this.uniformStore=new p({app:{uniformTypes:{color:"vec3<f32>"}}});const n=Qt.getDefaultShaderAssembler();n.addShaderHook("vs:OFFSET_POSITION(inout vec4 position)"),this.positionBuffer=t.createBuffer(new Float32Array([-.3,-.5,.3,-.5,0,.5])),this.uniformBuffer1=this.uniformStore.createUniformBuffer(t,"app",{app:{color:[1,0,0]}});let r=this.uniformStore.getUniformBufferData("app");this.uniformBuffer1.write(r),this.uniformBuffer2=this.uniformStore.createUniformBuffer(t,"app",{app:{color:[0,0,1]}}),this.model1=new sn(t,{vs:vi,fs:Si,shaderAssembler:n,modules:[bi],bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3,bindings:{app:this.uniformBuffer1}}),this.model2=new sn(t,{vs:vi,fs:Si,shaderAssembler:n,modules:[Ci],bufferLayout:[{name:"position",format:"float32x2"}],vertexCount:3,attributes:{position:this.positionBuffer},bindings:{app:this.uniformBuffer2}})}onFinalize(){this.model1.destroy(),this.model2.destroy(),this.positionBuffer.destroy(),this.uniformStore.destroy(),this.uniformBuffer1.destroy(),this.uniformBuffer2.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model1.draw(n),this.model2.draw(n),n.end()}}Gi.info="\nModifying shader behavior with shader hooks\n";const Ni={name:"color",fs:"\nvec3 color_hsv2rgb(vec3 hsv) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(hsv.xxx + K.xyz) * 6.0 - K.www);\n  vec3 rgb = hsv.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), hsv.y);\n  return rgb;\n}\n  ",uniformTypes:{hsv:"vec3<f32>"}};class yi extends g{constructor(e){let{device:t}=e;super(),this.shaderInputs1=new $t({color:Ni}),this.shaderInputs2=new $t({color:Ni}),this.positionBuffer=t.createBuffer(new Float32Array([-.3,-.5,.3,-.5,0,.5])),this.shaderInputs1.setProps({color:{hsv:[.7,1,1]}}),this.shaderInputs2.setProps({color:{hsv:[1,1,1]}}),this.model1=new sn(t,{vs:"#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position - vec2(0.5, 0.0), 0.0, 1.0);\n}\n",fs:"#version 300 es\nprecision highp float;\n\nuniform colorUniforms {\n  vec3 hsv;\n} color;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(color_hsv2rgb(color.hsv), 1.0);\n}\n",shaderInputs:this.shaderInputs1,bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3}),this.model2=new sn(t,{vs:"#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position + vec2(0.5, 0.0), 0.0, 1.0);\n}\n",fs:"#version 300 es\n\nprecision highp float;\n\nuniform colorUniforms {\n  vec3 hsv;\n} color;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(color_hsv2rgb(color.hsv) - 0.3, 1.0);\n}\n",shaderInputs:this.shaderInputs2,bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3})}onFinalize(){this.model1.destroy(),this.model2.destroy(),this.positionBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model1.draw(n),this.model2.draw(n),n.end()}}var Ii,Mi;function wi(e,t){return t||(t=e.slice(0)),e.raw=t,e}yi.info="\nRe-using shader code with shader modules\n";const xi={vs:{glsl:s(Ii||(Ii=wi(["#version 300 es\nconst vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\nvoid main() {\n  gl_Position = vec4(pos[gl_VertexID], 0.0, 1.0);\n}\n"],["\\\n#version 300 es\nconst vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\nvoid main() {\n  gl_Position = vec4(pos[gl_VertexID], 0.0, 1.0);\n}\n"]))),wgsl:"@vertex\nfn main(@builtin(vertex_index) VertexIndex : u32) -> @builtin(position) vec4<f32> {\n  var pos = array<vec2<f32>, 3>(\n    vec2(0.0, 0.5),\n    vec2(-0.5, -0.5),\n    vec2(0.5, -0.5)\n  );\n\n  return vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n}\n"},fs:{glsl:s(Mi||(Mi=wi(["#version 300 es\nprecision highp float;\nlayout(location = 0) out vec4 outColor;\nvoid main() {\n    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n"],["\\\n#version 300 es\nprecision highp float;\nlayout(location = 0) out vec4 outColor;\nvoid main() {\n    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n"]))),wgsl:"@fragment\nfn main() -> @location(0) vec4<f32> {\n  return vec4<f32>(1.0, 0.0, 0.0, 1.0);\n}\n"}};class Oi extends g{constructor(e){let{device:t}=e;super(),this.model=new sn(t,{vs:xi.vs,fs:xi.fs,topology:"triangle-list",vertexCount:3,shaderLayout:{attributes:[],bindings:[]},parameters:{depthFormat:"depth24plus"}})}onFinalize(){this.model.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[1,1,1,1]});this.model.draw(n),n.end()}}var Fi,Pi;function Bi(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Di=s(Fi||(Fi=Bi(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix[16];\n} app;\n\n// CUBE GEOMETRY\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix[gl_InstanceID] * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix[16];\n} app;\n\n// CUBE GEOMETRY\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix[gl_InstanceID] * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"]))),Ui=s(Pi||(Pi=Bi(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class ki extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer=t.createBuffer({id:"uniforms",usage:o.l.UNIFORM|o.l.COPY_DST,byteLength:1024}),this.cubeModel=new sn(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : array<mat4x4<f32>, 16>,\n};\n\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  @builtin(instance_index) instanceIdx : u32,\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix[instanceIdx] * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4<f32>(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:Di},fs:{wgsl:"@fragment\nfn main(\n  @location(0) fragUV: vec2<f32>,\n  @location(1) fragPosition: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:Ui},geometry:new cn({indices:!1}),instanceCount:16,parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer}})}onFinalize(e){this.uniformBuffer.destroy(),this.cubeModel.destroy()}onRender(e){var t;let{device:n}=e;const r=new vn.y,i=null==(t=n.canvasContext)?void 0:t.getAspect(),s=Date.now()/1e3;r.perspective({fovy:2*Math.PI/5,aspect:i,near:1,far:100});const o=function(e,t){const n=(new vn.y).translate([0,0,-12]),r=new vn.y;let i=0,s=0;for(let o=0;o<4;o++)for(let a=0;a<4;a++)r.copy(Vi[i]).rotateAxis(1,[Math.sin((o+.5)*t),Math.cos((a+.5)*t),0]).multiplyLeft(n).multiplyLeft(e),Xi.set(r,s),i++,s+=16;return Xi}(r,s);this.uniformBuffer.write(o);const a=n.beginRenderPass();this.cubeModel.draw(a),a.end()}}const Vi=[];for(let Gs=0;Gs<4;Gs++)for(let e=0;e<4;e++)Vi.push((new vn.y).translate([4*(Gs-2+.5),4*(e-2+.5),0]));const Xi=new Float32Array(256);var Hi,Wi;function Ki(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Yi=s(Hi||(Hi=Ki(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = 0.5 * (vec4(positions, 1.) + vec4(1., 1., 1., 1.));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = 0.5 * (vec4(positions, 1.) + vec4(1., 1., 1., 1.));\n}\n"]))),zi=s(Wi||(Wi=Ki(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class ji extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer=t.createBuffer({id:"uniforms",byteLength:64,usage:o.l.UNIFORM|o.l.COPY_DST}),this.model=new sn(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:Yi},fs:{wgsl:"@fragment\nfn main(\n  @location(0) fragUV: vec2<f32>,\n  @location(1) fragPosition: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:zi},geometry:new cn({indices:!1}),parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer}})}onFinalize(){this.model.destroy(),this.uniformBuffer.destroy()}onRender(e){var t;let{device:n}=e;const r=new vn.y,i=new vn.y,s=new vn.y,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;i.identity().translate([0,0,-4]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),r.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),s.copy(i).multiplyLeft(r),this.uniformBuffer.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.model.setBindings({app:this.uniformBuffer}),this.model.draw(l),l.end()}}var Zi,qi;function Qi(e,t){return t||(t=e.slice(0)),e.raw=t,e}const $i=s(Zi||(Zi=Qi(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n  // fragPosition = 0.5 * (vec4(position, 1.) + vec4(1., 1., 1., 1.));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n  // fragPosition = 0.5 * (vec4(position, 1.) + vec4(1., 1., 1., 1.));\n}\n"]))),Ji=s(qi||(qi=Qi(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));;\n}\n"])));class es extends g{constructor(e){let{device:t}=e;super();const n=t.createTexture({data:(0,Dn.gy)("https://raw.githubusercontent.com/uber/luma.gl/8.5-release/examples/getting-started/hello-cube/vis-logo.png"),mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}});this.uniformBuffer=t.createBuffer({id:"uniforms",byteLength:64,usage:o.l.UNIFORM|o.l.COPY_DST}),this.model=new sn(t,{id:"cube",vs:{wgsl:"\nstruct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @ group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n};\n\n@vertex\nfn main(\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>) -> VertexOutput \n{\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4<f32>(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:$i},fs:{wgsl:"\n@group(0) @binding(1) var uSampler: sampler;\n@group(0) @binding(2) var uTexture: texture_2d<f32>;\n\n@fragment\nfn main(@location(0) fragUV: vec2<f32>,\n        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {\n  let flippedUV = vec2<f32>(1.0 - fragUV.x, fragUV.y);\n  return textureSample(uTexture, uSampler, flippedUV) * fragPosition;\n}\n",glsl:Ji},geometry:new cn({indices:!1}),bindings:{app:this.uniformBuffer,uSampler:n.sampler,uTexture:n},parameters:{depthWriteEnabled:!0,depthCompare:"less"}})}onFinalize(){this.model.destroy(),this.uniformBuffer.destroy()}onRender(e){var t;let{device:n}=e;const r=new vn.y,i=new vn.y,s=new vn.y,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;i.identity().translate([0,0,-4]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),r.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),s.copy(i).multiplyLeft(r),this.uniformBuffer.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(l),l.end()}}var ts,ns;function rs(e,t){return t||(t=e.slice(0)),e.raw=t,e}const is=s(ts||(ts=rs(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"]))),ss=s(ns||(ns=rs(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class os extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer1=t.createBuffer({id:"uniforms-1",usage:o.l.UNIFORM|o.l.COPY_DST,byteLength:64}),this.uniformBuffer2=t.createBuffer({id:"uniforms-2",usage:o.l.UNIFORM|o.l.COPY_DST,byteLength:64}),this.cubeModel=new sn(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:is},fs:{wgsl:"\n@fragment\nfn main(@location(0) fragUV: vec2<f32>,\n        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:ss},geometry:new cn({indices:!1}),parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer1}})}onFinalize(){this.cubeModel.destroy(),this.uniformBuffer1.destroy(),this.uniformBuffer2.destroy()}onRender(e){var t;let{device:n}=e;const r=new vn.y,i=new vn.y,s=new vn.y,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;r.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),i.identity().translate([-2,0,-7]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),s.copy(i).multiplyLeft(r),this.uniformBuffer1.write(new Float32Array(s)),i.identity().translate([2,0,-7]).rotateAxis(1,[Math.cos(a),Math.sin(a),0]),s.copy(i).multiplyLeft(r),this.uniformBuffer2.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.cubeModel.setBindings({app:this.uniformBuffer1}),this.cubeModel.draw(l),this.cubeModel.setBindings({app:this.uniformBuffer2}),this.cubeModel.draw(l),l.end()}}const as={},ls=()=>r.createElement(i.ij,{id:"animation",directory:"api",template:xn,config:as}),cs=()=>r.createElement(i.ij,{id:"cubemap",directory:"api",template:Hn,config:as}),us=()=>r.createElement(i.ij,{id:"texture-3d",directory:"api-3d",template:tr,config:as}),_s=()=>r.createElement(i.ij,{id:"instancing",directory:"showcase",template:gr,config:as}),hs=()=>r.createElement(i.ij,{id:"persistence",directory:"showcase/persistence",template:Dr,config:as}),ds=()=>r.createElement(i.ij,{id:"hello-cube",directory:"tutorials",template:Yr,config:as}),fs=()=>r.createElement(i.ij,{id:"hello-instancing",directory:"tutorials",template:Jr,config:as}),Es=()=>r.createElement(i.ij,{id:"hello-triangle",directory:"tutorials",template:ni,config:as}),ps=()=>r.createElement("h2",null,r.createElement("i",null,"Note: Transform examples temporarily disabled")),gs=()=>r.createElement(i.ij,{id:"lighting",directory:"tutorials",template:Li,config:as}),ms=()=>r.createElement(i.ij,{id:"shader-hooks",directory:"tutorials",template:Gi,config:as}),As=()=>r.createElement(i.ij,{id:"shader-modules",directory:"tutorials",template:yi,config:as}),Rs=()=>r.createElement("h2",null,r.createElement("i",null,"Note: Transform examples temporarily disabled")),Ts=()=>r.createElement("h2",null,r.createElement("i",null,"Note: Transform examples temporarily disabled")),Ls=()=>r.createElement(i.ij,{id:"hello-triangle-webgpu",directory:"webgpu",template:Oi,config:as}),vs=()=>r.createElement(i.ij,{id:"instanced-cubes-webgpu",directory:"webgpu",template:ki,config:as}),Ss=()=>r.createElement(i.ij,{id:"rotating-cube-webgpu",directory:"webgpu",template:ji,config:as}),bs=()=>r.createElement(i.ij,{id:"textured-cube-webgpu",directory:"webgpu",template:es,config:as}),Cs=()=>r.createElement(i.ij,{id:"two-cubes-webgpu",directory:"webgpu",template:os,config:as})},9750:(e,t,n)=>{n.d(t,{z_:()=>wr,L0:()=>Fr,wn:()=>Br,ED:()=>Pr,kI:()=>xr,cd:()=>Or,ij:()=>Wr,Hr:()=>Dr,PQ:()=>kr,MQ:()=>Ur});var r=n(7294),i=n(5697),s=n.n(i);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o.apply(this,arguments)}class a extends r.Component{render(){const{height:e,width:t,viewBox:n,style:i={},children:s,predefinedClassName:a,className:l,colors:c,totalColor:u,..._}=this.props,h=e,d=t||h;i.fill="currentColor";const f=Array.isArray(c)&&u&&((e,t)=>new Array(e).fill(1).reduce(((e,n,r)=>e+".cr"+(r+1)+" {fill:"+t[r%t.length]+";}"),""))(u,c);return r.createElement("svg",o({viewBox:n,width:d,height:h,style:i,className:a+" "+l},_),f?r.createElement("style",{type:"text/css"},f):null,s)}}a.displayName="Base Icon",a.propTypes={height:s().string,width:s().string,viewBox:s().string,children:s().node,predefinedClassName:s().string,className:s().string},a.defaultProps={height:null,width:null,viewBox:"0 0 64 64",predefinedClassName:"",className:""};const l=e=>r.createElement(a,e,r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.02167 13.7625C4.69623 13.4459 4.69623 12.9325 5.02167 12.6159L9.76574 8.00002L5.02167 3.38416C4.69623 3.06752 4.69623 2.55415 5.02167 2.2375C5.3471 1.92086 5.87474 1.92086 6.20018 2.2375L11.5335 7.42669C11.6898 7.57875 11.7776 7.78498 11.7776 8.00002C11.7776 8.21506 11.6898 8.4213 11.5335 8.57335L6.20018 13.7625C5.87474 14.0792 5.3471 14.0792 5.02167 13.7625Z"}));l.propTypes={height:s().string},l.defaultProps={height:"16px",viewBox:"0 0 17 16",predefinedClassName:"unfolded-icons-arrowbigright"};var c=n(4529),u=n(803),_=n(4575),h=n(2311);const d=new class{constructor(){this.stats=new Map}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new h.Z({id:e})),this.stats.get(e)}};const f=function(){const e="undefined"!=typeof __VERSION__?__VERSION__:"running from source";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error("luma.gl - multiple VERSIONs detected: "+globalThis.luma.VERSION+" vs "+e);return globalThis.luma||((0,u.Z)()&&_.c.log(1,e+" - set luma.log.level=1 (or higher) to trace rendering")(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:_.c,stats:d}),e}();var E=n(1770),p=n(9909);let g;g=Symbol.toStringTag;class m{get[g](){return"Device"}constructor(e){this.statsManager=d,this.userData={},this._lumaData={},this.props={...m.defaultProps,...e},this.id=this.props.id||(0,E.hQ)(this[Symbol.toStringTag].toLowerCase())}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||"string"==typeof e)&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e){throw void 0===e&&(e={}),new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL2(e,t){throw new Error("not implemented")}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&p.l.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":_.c.warn("indices buffer content must be of integer type")()),t}}m.defaultProps={id:null,type:"best-available",canvas:null,container:null,webgl2:!0,webgl1:!0,manageState:!0,width:800,height:600,debug:Boolean(_.c.get("debug")),break:[],gl:null},m.VERSION=f;var A=n(3911);const R=new Map;class T{static registerDevices(e){for(const t of e)(0,A.h)(t.type&&t.isSupported&&t.create),R.set(t.type,t)}static getAvailableDevices(){return Array.from(R).map((e=>e.type))}static getSupportedDevices(){return Array.from(R).filter((e=>e.isSupported())).map((e=>e.type))}static setDefaultDeviceProps(e){Object.assign(m.defaultProps,e)}static async createDevice(e){let t;switch(void 0===e&&(e={}),(e={...m.defaultProps,...e}).gl&&(e.type="webgl"),e.type){case"webgpu":if(t=R.get("webgpu"),t)return await t.create(e);break;case"webgl":case"webgl1":case"webgl2":if(t=R.get("webgl"),t)return await t.create(e);break;case"best-available":if(t=R.get("webgpu"),t&&t.isSupported())return await t.create(e);if(t=R.get("webgl"),t&&t.isSupported())return await t.create(e)}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}}T.stats=d,T.log=_.c;const L=(0,u.Z)()&&"undefined"!=typeof document,v=()=>L&&"complete"===document.readyState,S={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class b{static get isPageLoaded(){return v()}constructor(e){if(this.width=1,this.height=1,this._canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1},this.props={...S,...e},e=this.props,!(0,u.Z)())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"==typeof e.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!t&&!v())throw new Error("Accessing '"+e+"' before page was loaded");if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{var t,n;const r=function(e){const{width:t,height:n}=e,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=t||1,r.height=n||1,r.style.width=Number.isFinite(t)?t+"px":"100%",r.style.height=Number.isFinite(n)?n+"px":"100%",r}(e),i=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t&&!v())throw new Error("Accessing '"+e+"' before page was loaded");if(!t)throw new Error(e+" is not an HTML element");return t}if(e)return e;return document.body}((null==(t=e)?void 0:t.container)||null);i.insertBefore(r,i.firstChild),this.canvas=r,null!=(n=e)&&n.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver((e=>{for(const t of e)t.target===this.canvas&&this.update()})),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){if("undefined"!=typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas)return 1;if(!(e=void 0===e?this.props.useDevicePixels:e)||e<=0)return 1;if(!0===e){return"undefined"!=typeof window&&window.devicePixelRatio||1}return e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:t}=this._canvasSizeInfo;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t){void 0===t&&(t=!0);const n=this.cssToDeviceRatio(),[r,i]=this.getDrawingBufferSize();return function(e,t,n,r,i){const s=e,o=C(s[0],t,n);let a=G(s[1],t,r,i),l=C(s[0]+1,t,n);const c=l===n-1?l:l-1;let u;l=G(s[1]+1,t,r,i),i?(l=0===l?l:l+1,u=a,a=l):u=l===r-1?l:l-1;return{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}(e,n,r,i,t)}setDevicePixelRatio(e,t){if(void 0===t&&(t={}),!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,r="height"in t?t.height:this.htmlCanvas.clientHeight;n&&r||(_.c.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,r=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==n||i.clientHeight!==r||i.devicePixelRatio!==e){let t=e;const i=Math.floor(n*t),s=Math.floor(r*t);this.htmlCanvas.width=i,this.htmlCanvas.height=s;const[o,a]=this.getDrawingBufferSize();o===i&&a===s||(t=Math.min(o/n,a/r),this.htmlCanvas.width=Math.floor(n*t),this.htmlCanvas.height=Math.floor(r*t),_.c.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=r,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)}}function C(e,t,n){return Math.min(Math.round(e*t),n-1)}function G(e,t,n,r){return r?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}b.pageLoaded=function(){if(v()||"undefined"==typeof window)return Promise.resolve();return new Promise((e=>{window.addEventListener("load",(()=>e()))}))}();const N={};function y(e,t){var n;N[e]=!0,void 0!==t&&(n=t,globalThis.console&&globalThis.console.error&&globalThis.console.error(n))}const I=function e(t){const n=t.gl;this.ext=t,this.isAlive=!0,this.hasBeenBound=!1,this.elementArrayBuffer=null,this.attribs=new Array(t.maxVertexAttribs);for(let r=0;r<this.attribs.length;r++){const t=new e.VertexAttrib(n);this.attribs[r]=t}this.maxAttrib=0};(I.VertexAttrib=function(e){this.enabled=!1,this.buffer=null,this.size=4,this.type=e.FLOAT,this.normalized=!1,this.stride=16,this.offset=0,this.cached="",this.recache()}).prototype.recache=function(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};const M=function(e){const t=this;this.gl=e,function(e){const t=e.getError;e.getError=function(){let n;do{n=t.apply(e),n!==e.NO_ERROR&&(N[n]=!0)}while(n!==e.NO_ERROR);for(n in N)if(N[n])return delete N[n],parseInt(n,10);return e.NO_ERROR}}(e);const n=this.original={getParameter:e.getParameter,enableVertexAttribArray:e.enableVertexAttribArray,disableVertexAttribArray:e.disableVertexAttribArray,bindBuffer:e.bindBuffer,getVertexAttrib:e.getVertexAttrib,vertexAttribPointer:e.vertexAttribPointer};e.getParameter=function(e){return e===t.VERTEX_ARRAY_BINDING_OES?t.currentVertexArrayObject===t.defaultVertexArrayObject?null:t.currentVertexArrayObject:n.getParameter.apply(this,arguments)},e.enableVertexAttribArray=function(e){const r=t.currentVertexArrayObject;r.maxAttrib=Math.max(r.maxAttrib,e);return r.attribs[e].enabled=!0,n.enableVertexAttribArray.apply(this,arguments)},e.disableVertexAttribArray=function(e){const r=t.currentVertexArrayObject;r.maxAttrib=Math.max(r.maxAttrib,e);return r.attribs[e].enabled=!1,n.disableVertexAttribArray.apply(this,arguments)},e.bindBuffer=function(r,i){switch(r){case e.ARRAY_BUFFER:t.currentArrayBuffer=i;break;case e.ELEMENT_ARRAY_BUFFER:t.currentVertexArrayObject.elementArrayBuffer=i}return n.bindBuffer.apply(this,arguments)},e.getVertexAttrib=function(r,i){const s=t.currentVertexArrayObject.attribs[r];switch(i){case e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return s.buffer;case e.VERTEX_ATTRIB_ARRAY_ENABLED:return s.enabled;case e.VERTEX_ATTRIB_ARRAY_SIZE:return s.size;case e.VERTEX_ATTRIB_ARRAY_STRIDE:return s.stride;case e.VERTEX_ATTRIB_ARRAY_TYPE:return s.type;case e.VERTEX_ATTRIB_ARRAY_NORMALIZED:return s.normalized;default:return n.getVertexAttrib.apply(this,arguments)}},e.vertexAttribPointer=function(e,r,i,s,o,a){const l=t.currentVertexArrayObject;l.maxAttrib=Math.max(l.maxAttrib,e);const c=l.attribs[e];return c.buffer=t.currentArrayBuffer,c.size=r,c.type=i,c.normalized=s,c.stride=o,c.offset=a,c.recache(),n.vertexAttribPointer.apply(this,arguments)},e.instrumentExtension&&e.instrumentExtension(this,"OES_vertex_array_object"),e.canvas&&e.canvas.addEventListener("webglcontextrestored",(()=>{var e;e="OESVertexArrayObject emulation library context restored",globalThis.console&&globalThis.console.log&&globalThis.console.log(e),t.reset_()}),!0),this.reset_()};M.prototype.VERTEX_ARRAY_BINDING_OES=34229,M.prototype.reset_=function(){if(void 0!==this.vertexArrayObjects)for(let t=0;t<this.vertexArrayObjects.length;++t)this.vertexArrayObjects.isAlive=!1;const e=this.gl;this.maxVertexAttribs=e.getParameter(e.MAX_VERTEX_ATTRIBS),this.defaultVertexArrayObject=new I(this),this.currentVertexArrayObject=null,this.currentArrayBuffer=null,this.vertexArrayObjects=[this.defaultVertexArrayObject],this.bindVertexArrayOES(null)},M.prototype.createVertexArrayOES=function(){const e=new I(this);return this.vertexArrayObjects.push(e),e},M.prototype.deleteVertexArrayOES=function(e){e.isAlive=!1,this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1),this.currentVertexArrayObject===e&&this.bindVertexArrayOES(null)},M.prototype.isVertexArrayOES=function(e){return!!(e&&e instanceof I&&e.hasBeenBound&&e.ext===this)},M.prototype.bindVertexArrayOES=function(e){const t=this.gl;if(e&&!e.isAlive)return void y(t.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject");const n=this.original,r=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject,this.currentVertexArrayObject.hasBeenBound=!0;const i=this.currentVertexArrayObject;if(r===i)return;r&&i.elementArrayBuffer===r.elementArrayBuffer||n.bindBuffer.call(t,t.ELEMENT_ARRAY_BUFFER,i.elementArrayBuffer);let s=this.currentArrayBuffer;const o=Math.max(r?r.maxAttrib:0,i.maxAttrib);for(let a=0;a<=o;a++){const e=i.attribs[a],o=r?r.attribs[a]:null;if(r&&e.enabled===o.enabled||(e.enabled?n.enableVertexAttribArray.call(t,a):n.disableVertexAttribArray.call(t,a)),e.enabled){let i=!1;r&&e.buffer===o.buffer||(s!==e.buffer&&(n.bindBuffer.call(t,t.ARRAY_BUFFER,e.buffer),s=e.buffer),i=!0),(i||e.cached!==o.cached)&&n.vertexAttribPointer.call(t,a,e.size,e.type,e.normalized,e.stride,e.offset)}}this.currentArrayBuffer!==s&&n.bindBuffer.call(t,t.ARRAY_BUFFER,this.currentArrayBuffer)};var w=n(180);const x="Invalid WebGLRenderingContext";function O(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}function F(e){return O(e)?e:null}function P(e){return(0,A.h)(function(e){return"undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext||"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&Number.isFinite(e._version))}(e),x),e}const B="OES_element_index",D="WEBGL_draw_buffers",U="WEBGL_debug_renderer_info",k=e=>O(e)?void 0:0,V={[w.GL.READ_BUFFER]:e=>O(e)?void 0:w.GL.COLOR_ATTACHMENT0,35723:e=>O(e)?void 0:4352,[w.GL.RASTERIZER_DISCARD]:k,[w.GL.SAMPLES]:k,36795:(e,t)=>{const n=O(e)?e.getExtension("EXT_disjoint_timer_query_webgl2"):e.getExtension("EXT_disjoint_timer_query");return n&&n.GPU_DISJOINT_EXT?t(n.GPU_DISJOINT_EXT):0},37445:(e,t)=>{const n=e.getExtension(U);return t(n&&n.UNMASKED_VENDOR_WEBGL||w.GL.VENDOR)},37446:(e,t)=>{const n=e.getExtension(U);return t(n&&n.UNMASKED_RENDERER_WEBGL||w.GL.RENDERER)},34047:(e,t)=>{var n;const r=(null==(n=e.luma)||null==(n=n.extensions)?void 0:n.EXT_texture_filter_anisotropic)||e.getExtension("EXT_texture_filter_anisotropic");return r?t(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT):1},[w.GL.MAX_3D_TEXTURE_SIZE]:k,[w.GL.MAX_ARRAY_TEXTURE_LAYERS]:k,[w.GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:k,[w.GL.MAX_COLOR_ATTACHMENTS]:(e,t)=>{if(!O(e)){const n=e.getExtension(D);return n?t(n.MAX_COLOR_ATTACHMENTS_WEBGL):0}},[w.GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:k,[w.GL.MAX_COMBINED_UNIFORM_BLOCKS]:k,[w.GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:k,[w.GL.MAX_DRAW_BUFFERS]:e=>{if(!O(e)){const t=e.getExtension(D);return t?t.MAX_DRAW_BUFFERS_WEBGL:0}},[w.GL.MAX_ELEMENT_INDEX]:e=>e.getExtension(B)?2147483647:65535,[w.GL.MAX_ELEMENTS_INDICES]:e=>e.getExtension(B)?16777216:65535,[w.GL.MAX_ELEMENTS_VERTICES]:e=>16777216,[w.GL.MAX_FRAGMENT_INPUT_COMPONENTS]:k,[w.GL.MAX_FRAGMENT_UNIFORM_BLOCKS]:k,[w.GL.MAX_FRAGMENT_UNIFORM_COMPONENTS]:k,[w.GL.MAX_SAMPLES]:k,[w.GL.MAX_SERVER_WAIT_TIMEOUT]:k,[w.GL.MAX_TEXTURE_LOD_BIAS]:k,[w.GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:k,[w.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:k,[w.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:k,[w.GL.MAX_UNIFORM_BLOCK_SIZE]:k,[w.GL.MAX_UNIFORM_BUFFER_BINDINGS]:k,[w.GL.MAX_VARYING_COMPONENTS]:k,[w.GL.MAX_VERTEX_OUTPUT_COMPONENTS]:k,[w.GL.MAX_VERTEX_UNIFORM_BLOCKS]:k,[w.GL.MAX_VERTEX_UNIFORM_COMPONENTS]:k,[w.GL.MIN_PROGRAM_TEXEL_OFFSET]:k,[w.GL.MAX_PROGRAM_TEXEL_OFFSET]:k,[w.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:k};function X(e){if(!e.luma){const t={_polyfilled:!1,_extensions:{}};e.luma=t}return e.luma}const H="ANGLE_instanced_arrays";const W={OES_vertex_array_object:{meta:{suffix:"OES"},createVertexArray:()=>{(0,A.h)(!1,"VertexArray requires WebGL2 or OES_vertex_array_object extension")},deleteVertexArray:()=>{},bindVertexArray:()=>{},isVertexArray:()=>!1},[H]:{meta:{suffix:"ANGLE"},vertexAttribDivisor(e,t){(0,A.h)(0===t,"WebGL instanced rendering not supported")},drawElementsInstanced:()=>{},drawArraysInstanced:()=>{}},WEBGL_draw_buffers:{meta:{suffix:"WEBGL"},drawBuffers:()=>{(0,A.h)(!1)}},EXT_disjoint_timer_query:{meta:{suffix:"EXT"},createQuery:()=>{(0,A.h)(!1)},deleteQuery:()=>{(0,A.h)(!1)},beginQuery:()=>{(0,A.h)(!1)},endQuery:()=>{},getQuery(e,t){return this.getQueryObject(e,t)},getQueryParameter(e,t){return this.getQueryObject(e,t)},getQueryObject:(e,t)=>{}}},K={readBuffer:(e,t,n)=>{O(e)&&t(n)},getVertexAttrib:(e,t,n,r)=>{const{webgl2:i,ext:s}=function(e,t){return{webgl2:O(e),ext:e.getExtension(t)}}(e,H);let o;switch(r){case w.GL.VERTEX_ATTRIB_ARRAY_INTEGER:o=!!i&&void 0;break;case w.GL.VERTEX_ATTRIB_ARRAY_DIVISOR:o=i||s?void 0:0}return void 0!==o?o:t(n,r)},getProgramParameter:(e,t,n,r)=>{if(!O(e))switch(r){case w.GL.TRANSFORM_FEEDBACK_BUFFER_MODE:return w.GL.SEPARATE_ATTRIBS;case w.GL.TRANSFORM_FEEDBACK_VARYINGS:case w.GL.ACTIVE_UNIFORM_BLOCKS:return 0}return t(n,r)},getInternalformatParameter:(e,t,n,r,i)=>{if(!O(e)&&i===w.GL.SAMPLES)return new Int32Array([0]);return e.getInternalformatParameter(n,r,i)},getTexParameter(e,t,n,r){if(r===w.GL.TEXTURE_MAX_ANISOTROPY_EXT){const t=X(e),{_extensions:n}=t,i=n.EXT_texture_filter_anisotropic;r=i&&i.TEXTURE_MAX_ANISOTROPY_EXT||w.GL.TEXTURE_MAX_ANISOTROPY_EXT}return t(n,r)},getParameter:function(e,t,n){const r=V[n],i="function"==typeof r?r(e,t,n):r;return void 0!==i?i:t(n)},hint:(e,t,n,r)=>t(n,r)};function Y(e){const t=X(e);return t._polyfilled||(!function(e){if("function"==typeof e.createVertexArray)return;const t=e.getSupportedExtensions;e.getSupportedExtensions=function(){const e=t.call(this)||[];return e.indexOf("OES_vertex_array_object")<0&&e.push("OES_vertex_array_object"),e};const n=e.getExtension;e.getExtension=function(t){return n.call(this,t)||("OES_vertex_array_object"!==t?null:(e.__OESVertexArrayObject||(this.__OESVertexArrayObject=new M(this)),this.__OESVertexArrayObject))}}(e),function(e){const t=X(e),n=e.getSupportedExtensions()||[],r=["WEBGL_polygon_mode"];for(const i of n)if(!r.includes(i)){const n=e.getExtension(i);t._extensions[i]=n}}(e),function(e,t){const n=X(e);for(const r of Object.getOwnPropertyNames(t))"overrides"!==r&&z(e,{extension:r,target:n,target2:e})}(e,W),function(e,t){let{target:n,target2:r}=t;Object.keys(K).forEach((t=>{if("function"==typeof K[t]){const i=e[t]?e[t].bind(e):()=>{},s=K[t].bind(null,e,i);n[t]=s,r[t]=s}}))}(e,{target:t,target2:e}),t._polyfilled=!0),e}function z(e,t){let{extension:n,target:r,target2:i}=t;const s=W[n];(0,A.h)(s);const{meta:o={}}=s,{suffix:a=""}=o,l=e.getExtension(n);for(const c of Object.keys(s)){const t=""+c+a;let n=null;"meta"===c||"function"==typeof e[c]||(l&&"function"==typeof l[t]?n=function(){return l[t](...arguments)}:"function"==typeof s[c]&&(n=s[c].bind(r))),n&&(r[c]=n,i[c]=n)}}const j={[w.GL.BLEND]:!1,[w.GL.BLEND_COLOR]:new Float32Array([0,0,0,0]),[w.GL.BLEND_EQUATION_RGB]:w.GL.FUNC_ADD,[w.GL.BLEND_EQUATION_ALPHA]:w.GL.FUNC_ADD,[w.GL.BLEND_SRC_RGB]:w.GL.ONE,[w.GL.BLEND_DST_RGB]:w.GL.ZERO,[w.GL.BLEND_SRC_ALPHA]:w.GL.ONE,[w.GL.BLEND_DST_ALPHA]:w.GL.ZERO,[w.GL.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[w.GL.COLOR_WRITEMASK]:[!0,!0,!0,!0],[w.GL.CULL_FACE]:!1,[w.GL.CULL_FACE_MODE]:w.GL.BACK,[w.GL.DEPTH_TEST]:!1,[w.GL.DEPTH_CLEAR_VALUE]:1,[w.GL.DEPTH_FUNC]:w.GL.LESS,[w.GL.DEPTH_RANGE]:new Float32Array([0,1]),[w.GL.DEPTH_WRITEMASK]:!0,[w.GL.DITHER]:!0,[w.GL.CURRENT_PROGRAM]:null,[w.GL.FRAMEBUFFER_BINDING]:null,[w.GL.RENDERBUFFER_BINDING]:null,[w.GL.VERTEX_ARRAY_BINDING]:null,[w.GL.ARRAY_BUFFER_BINDING]:null,[w.GL.FRONT_FACE]:w.GL.CCW,[w.GL.GENERATE_MIPMAP_HINT]:w.GL.DONT_CARE,[w.GL.LINE_WIDTH]:1,[w.GL.POLYGON_OFFSET_FILL]:!1,[w.GL.POLYGON_OFFSET_FACTOR]:0,[w.GL.POLYGON_OFFSET_UNITS]:0,[w.GL.SAMPLE_ALPHA_TO_COVERAGE]:!1,[w.GL.SAMPLE_COVERAGE]:!1,[w.GL.SAMPLE_COVERAGE_VALUE]:1,[w.GL.SAMPLE_COVERAGE_INVERT]:!1,[w.GL.SCISSOR_TEST]:!1,[w.GL.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[w.GL.STENCIL_TEST]:!1,[w.GL.STENCIL_CLEAR_VALUE]:0,[w.GL.STENCIL_WRITEMASK]:4294967295,[w.GL.STENCIL_BACK_WRITEMASK]:4294967295,[w.GL.STENCIL_FUNC]:w.GL.ALWAYS,[w.GL.STENCIL_REF]:0,[w.GL.STENCIL_VALUE_MASK]:4294967295,[w.GL.STENCIL_BACK_FUNC]:w.GL.ALWAYS,[w.GL.STENCIL_BACK_REF]:0,[w.GL.STENCIL_BACK_VALUE_MASK]:4294967295,[w.GL.STENCIL_FAIL]:w.GL.KEEP,[w.GL.STENCIL_PASS_DEPTH_FAIL]:w.GL.KEEP,[w.GL.STENCIL_PASS_DEPTH_PASS]:w.GL.KEEP,[w.GL.STENCIL_BACK_FAIL]:w.GL.KEEP,[w.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:w.GL.KEEP,[w.GL.STENCIL_BACK_PASS_DEPTH_PASS]:w.GL.KEEP,[w.GL.VIEWPORT]:[0,0,1024,1024],[w.GL.PACK_ALIGNMENT]:4,[w.GL.UNPACK_ALIGNMENT]:4,[w.GL.UNPACK_FLIP_Y_WEBGL]:!1,[w.GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[w.GL.UNPACK_COLORSPACE_CONVERSION_WEBGL]:w.GL.BROWSER_DEFAULT_WEBGL,[w.GL.TRANSFORM_FEEDBACK_BINDING]:null,[w.GL.COPY_READ_BUFFER_BINDING]:null,[w.GL.COPY_WRITE_BUFFER_BINDING]:null,[w.GL.PIXEL_PACK_BUFFER_BINDING]:null,[w.GL.PIXEL_UNPACK_BUFFER_BINDING]:null,[w.GL.FRAGMENT_SHADER_DERIVATIVE_HINT]:w.GL.DONT_CARE,[w.GL.READ_FRAMEBUFFER_BINDING]:null,[w.GL.RASTERIZER_DISCARD]:!1,[w.GL.PACK_ROW_LENGTH]:0,[w.GL.PACK_SKIP_PIXELS]:0,[w.GL.PACK_SKIP_ROWS]:0,[w.GL.UNPACK_ROW_LENGTH]:0,[w.GL.UNPACK_IMAGE_HEIGHT]:0,[w.GL.UNPACK_SKIP_PIXELS]:0,[w.GL.UNPACK_SKIP_ROWS]:0,[w.GL.UNPACK_SKIP_IMAGES]:0},Z=(e,t,n)=>t?e.enable(n):e.disable(n),q=(e,t,n)=>e.hint(n,t),Q=(e,t,n)=>e.pixelStorei(n,t),$=(e,t,n)=>{let r;return r=n===w.GL.FRAMEBUFFER_BINDING?O(e)?w.GL.DRAW_FRAMEBUFFER:w.GL.FRAMEBUFFER:w.GL.READ_FRAMEBUFFER,e.bindFramebuffer(r,t)},J=(e,t,n)=>{const r={[w.GL.ARRAY_BUFFER_BINDING]:w.GL.ARRAY_BUFFER,[w.GL.COPY_READ_BUFFER_BINDING]:w.GL.COPY_READ_BUFFER,[w.GL.COPY_WRITE_BUFFER_BINDING]:w.GL.COPY_WRITE_BUFFER,[w.GL.PIXEL_PACK_BUFFER_BINDING]:w.GL.PIXEL_PACK_BUFFER,[w.GL.PIXEL_UNPACK_BUFFER_BINDING]:w.GL.PIXEL_UNPACK_BUFFER}[n];e.bindBuffer(r,t)};function ee(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const te={[w.GL.BLEND]:Z,[w.GL.BLEND_COLOR]:(e,t)=>e.blendColor(...t),[w.GL.BLEND_EQUATION_RGB]:"blendEquation",[w.GL.BLEND_EQUATION_ALPHA]:"blendEquation",[w.GL.BLEND_SRC_RGB]:"blendFunc",[w.GL.BLEND_DST_RGB]:"blendFunc",[w.GL.BLEND_SRC_ALPHA]:"blendFunc",[w.GL.BLEND_DST_ALPHA]:"blendFunc",[w.GL.COLOR_CLEAR_VALUE]:(e,t)=>e.clearColor(...t),[w.GL.COLOR_WRITEMASK]:(e,t)=>e.colorMask(...t),[w.GL.CULL_FACE]:Z,[w.GL.CULL_FACE_MODE]:(e,t)=>e.cullFace(t),[w.GL.DEPTH_TEST]:Z,[w.GL.DEPTH_CLEAR_VALUE]:(e,t)=>e.clearDepth(t),[w.GL.DEPTH_FUNC]:(e,t)=>e.depthFunc(t),[w.GL.DEPTH_RANGE]:(e,t)=>e.depthRange(...t),[w.GL.DEPTH_WRITEMASK]:(e,t)=>e.depthMask(t),[w.GL.DITHER]:Z,[w.GL.FRAGMENT_SHADER_DERIVATIVE_HINT]:q,[w.GL.CURRENT_PROGRAM]:(e,t)=>e.useProgram(t),[w.GL.RENDERBUFFER_BINDING]:(e,t)=>e.bindRenderbuffer(w.GL.RENDERBUFFER,t),[w.GL.TRANSFORM_FEEDBACK_BINDING]:(e,t)=>null==e.bindTransformFeedback?void 0:e.bindTransformFeedback(w.GL.TRANSFORM_FEEDBACK,t),[w.GL.VERTEX_ARRAY_BINDING]:(e,t)=>e.bindVertexArray(t),[w.GL.FRAMEBUFFER_BINDING]:$,[w.GL.READ_FRAMEBUFFER_BINDING]:$,[w.GL.ARRAY_BUFFER_BINDING]:J,[w.GL.COPY_READ_BUFFER_BINDING]:J,[w.GL.COPY_WRITE_BUFFER_BINDING]:J,[w.GL.PIXEL_PACK_BUFFER_BINDING]:J,[w.GL.PIXEL_UNPACK_BUFFER_BINDING]:J,[w.GL.FRONT_FACE]:(e,t)=>e.frontFace(t),[w.GL.GENERATE_MIPMAP_HINT]:q,[w.GL.LINE_WIDTH]:(e,t)=>e.lineWidth(t),[w.GL.POLYGON_OFFSET_FILL]:Z,[w.GL.POLYGON_OFFSET_FACTOR]:"polygonOffset",[w.GL.POLYGON_OFFSET_UNITS]:"polygonOffset",[w.GL.RASTERIZER_DISCARD]:Z,[w.GL.SAMPLE_ALPHA_TO_COVERAGE]:Z,[w.GL.SAMPLE_COVERAGE]:Z,[w.GL.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[w.GL.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[w.GL.SCISSOR_TEST]:Z,[w.GL.SCISSOR_BOX]:(e,t)=>e.scissor(...t),[w.GL.STENCIL_TEST]:Z,[w.GL.STENCIL_CLEAR_VALUE]:(e,t)=>e.clearStencil(t),[w.GL.STENCIL_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(w.GL.FRONT,t),[w.GL.STENCIL_BACK_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(w.GL.BACK,t),[w.GL.STENCIL_FUNC]:"stencilFuncFront",[w.GL.STENCIL_REF]:"stencilFuncFront",[w.GL.STENCIL_VALUE_MASK]:"stencilFuncFront",[w.GL.STENCIL_BACK_FUNC]:"stencilFuncBack",[w.GL.STENCIL_BACK_REF]:"stencilFuncBack",[w.GL.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[w.GL.STENCIL_FAIL]:"stencilOpFront",[w.GL.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[w.GL.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[w.GL.STENCIL_BACK_FAIL]:"stencilOpBack",[w.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[w.GL.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[w.GL.VIEWPORT]:(e,t)=>e.viewport(...t),[w.GL.PACK_ALIGNMENT]:Q,[w.GL.UNPACK_ALIGNMENT]:Q,[w.GL.UNPACK_FLIP_Y_WEBGL]:Q,[w.GL.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:Q,[w.GL.UNPACK_COLORSPACE_CONVERSION_WEBGL]:Q,[w.GL.PACK_ROW_LENGTH]:Q,[w.GL.PACK_SKIP_PIXELS]:Q,[w.GL.PACK_SKIP_ROWS]:Q,[w.GL.UNPACK_ROW_LENGTH]:Q,[w.GL.UNPACK_IMAGE_HEIGHT]:Q,[w.GL.UNPACK_SKIP_PIXELS]:Q,[w.GL.UNPACK_SKIP_ROWS]:Q,[w.GL.UNPACK_SKIP_IMAGES]:Q,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(w.GL.FRAMEBUFFER,n)},blend:(e,t)=>t?e.enable(w.GL.BLEND):e.disable(w.GL.BLEND),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null==t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(w.GL.CULL_FACE):e.disable(w.GL.CULL_FACE),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(w.GL.DEPTH_TEST):e.disable(w.GL.DEPTH_TEST),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(w.GL.DITHER):e.disable(w.GL.DITHER),derivativeHint:(e,t)=>{e.hint(w.GL.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(w.GL.GENERATE_MIPMAP_HINT,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(w.GL.POLYGON_OFFSET_FILL):e.disable(w.GL.POLYGON_OFFSET_FILL),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(w.GL.SCISSOR_TEST):e.disable(w.GL.SCISSOR_TEST),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(w.GL.STENCIL_TEST):e.disable(w.GL.STENCIL_TEST),stencilMask:(e,t)=>{t=ee(t)?t:[t,t];const[n,r]=t;e.stencilMaskSeparate(w.GL.FRONT,n),e.stencilMaskSeparate(w.GL.BACK,r)},stencilFunc:(e,t)=>{t=ee(t)&&3===t.length?[...t,...t]:t;const[n,r,i,s,o,a]=t;e.stencilFuncSeparate(w.GL.FRONT,n,r,i),e.stencilFuncSeparate(w.GL.BACK,s,o,a)},stencilOp:(e,t)=>{t=ee(t)&&3===t.length?[...t,...t]:t;const[n,r,i,s,o,a]=t;e.stencilOpSeparate(w.GL.FRONT,n,r,i),e.stencilOpSeparate(w.GL.BACK,s,o,a)},viewport:(e,t)=>e.viewport(...t)};function ne(e,t,n){return void 0!==t[e]?t[e]:n[e]}const re={blendEquation:(e,t,n)=>e.blendEquationSeparate(ne(w.GL.BLEND_EQUATION_RGB,t,n),ne(w.GL.BLEND_EQUATION_ALPHA,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(ne(w.GL.BLEND_SRC_RGB,t,n),ne(w.GL.BLEND_DST_RGB,t,n),ne(w.GL.BLEND_SRC_ALPHA,t,n),ne(w.GL.BLEND_DST_ALPHA,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(ne(w.GL.POLYGON_OFFSET_FACTOR,t,n),ne(w.GL.POLYGON_OFFSET_UNITS,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(ne(w.GL.SAMPLE_COVERAGE_VALUE,t,n),ne(w.GL.SAMPLE_COVERAGE_INVERT,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(w.GL.FRONT,ne(w.GL.STENCIL_FUNC,t,n),ne(w.GL.STENCIL_REF,t,n),ne(w.GL.STENCIL_VALUE_MASK,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(w.GL.BACK,ne(w.GL.STENCIL_BACK_FUNC,t,n),ne(w.GL.STENCIL_BACK_REF,t,n),ne(w.GL.STENCIL_BACK_VALUE_MASK,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(w.GL.FRONT,ne(w.GL.STENCIL_FAIL,t,n),ne(w.GL.STENCIL_PASS_DEPTH_FAIL,t,n),ne(w.GL.STENCIL_PASS_DEPTH_PASS,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(w.GL.BACK,ne(w.GL.STENCIL_BACK_FAIL,t,n),ne(w.GL.STENCIL_BACK_PASS_DEPTH_FAIL,t,n),ne(w.GL.STENCIL_BACK_PASS_DEPTH_PASS,t,n))},ie={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({[w.GL.CURRENT_PROGRAM]:t}),bindRenderbuffer:(e,t,n)=>e({[w.GL.RENDERBUFFER_BINDING]:n}),bindTransformFeedback:(e,t,n)=>e({[w.GL.TRANSFORM_FEEDBACK_BINDING]:n}),bindVertexArray:(e,t)=>e({[w.GL.VERTEX_ARRAY_BINDING]:t}),bindFramebuffer:(e,t,n)=>{switch(t){case w.GL.FRAMEBUFFER:return e({[w.GL.DRAW_FRAMEBUFFER_BINDING]:n,[w.GL.READ_FRAMEBUFFER_BINDING]:n});case w.GL.DRAW_FRAMEBUFFER:return e({[w.GL.DRAW_FRAMEBUFFER_BINDING]:n});case w.GL.READ_FRAMEBUFFER:return e({[w.GL.READ_FRAMEBUFFER_BINDING]:n});default:return null}},bindBuffer:(e,t,n)=>{const r={[w.GL.ARRAY_BUFFER]:[w.GL.ARRAY_BUFFER_BINDING],[w.GL.COPY_READ_BUFFER]:[w.GL.COPY_READ_BUFFER_BINDING],[w.GL.COPY_WRITE_BUFFER]:[w.GL.COPY_WRITE_BUFFER_BINDING],[w.GL.PIXEL_PACK_BUFFER]:[w.GL.PIXEL_PACK_BUFFER_BINDING],[w.GL.PIXEL_UNPACK_BUFFER]:[w.GL.PIXEL_UNPACK_BUFFER_BINDING]}[t];return r?e({[r]:n}):{valueChanged:!0}},blendColor:(e,t,n,r,i)=>e({[w.GL.BLEND_COLOR]:new Float32Array([t,n,r,i])}),blendEquation:(e,t)=>e({[w.GL.BLEND_EQUATION_RGB]:t,[w.GL.BLEND_EQUATION_ALPHA]:t}),blendEquationSeparate:(e,t,n)=>e({[w.GL.BLEND_EQUATION_RGB]:t,[w.GL.BLEND_EQUATION_ALPHA]:n}),blendFunc:(e,t,n)=>e({[w.GL.BLEND_SRC_RGB]:t,[w.GL.BLEND_DST_RGB]:n,[w.GL.BLEND_SRC_ALPHA]:t,[w.GL.BLEND_DST_ALPHA]:n}),blendFuncSeparate:(e,t,n,r,i)=>e({[w.GL.BLEND_SRC_RGB]:t,[w.GL.BLEND_DST_RGB]:n,[w.GL.BLEND_SRC_ALPHA]:r,[w.GL.BLEND_DST_ALPHA]:i}),clearColor:(e,t,n,r,i)=>e({[w.GL.COLOR_CLEAR_VALUE]:new Float32Array([t,n,r,i])}),clearDepth:(e,t)=>e({[w.GL.DEPTH_CLEAR_VALUE]:t}),clearStencil:(e,t)=>e({[w.GL.STENCIL_CLEAR_VALUE]:t}),colorMask:(e,t,n,r,i)=>e({[w.GL.COLOR_WRITEMASK]:[t,n,r,i]}),cullFace:(e,t)=>e({[w.GL.CULL_FACE_MODE]:t}),depthFunc:(e,t)=>e({[w.GL.DEPTH_FUNC]:t}),depthRange:(e,t,n)=>e({[w.GL.DEPTH_RANGE]:new Float32Array([t,n])}),depthMask:(e,t)=>e({[w.GL.DEPTH_WRITEMASK]:t}),frontFace:(e,t)=>e({[w.GL.FRONT_FACE]:t}),lineWidth:(e,t)=>e({[w.GL.LINE_WIDTH]:t}),polygonOffset:(e,t,n)=>e({[w.GL.POLYGON_OFFSET_FACTOR]:t,[w.GL.POLYGON_OFFSET_UNITS]:n}),sampleCoverage:(e,t,n)=>e({[w.GL.SAMPLE_COVERAGE_VALUE]:t,[w.GL.SAMPLE_COVERAGE_INVERT]:n}),scissor:(e,t,n,r,i)=>e({[w.GL.SCISSOR_BOX]:new Int32Array([t,n,r,i])}),stencilMask:(e,t)=>e({[w.GL.STENCIL_WRITEMASK]:t,[w.GL.STENCIL_BACK_WRITEMASK]:t}),stencilMaskSeparate:(e,t,n)=>e({[t===w.GL.FRONT?w.GL.STENCIL_WRITEMASK:w.GL.STENCIL_BACK_WRITEMASK]:n}),stencilFunc:(e,t,n,r)=>e({[w.GL.STENCIL_FUNC]:t,[w.GL.STENCIL_REF]:n,[w.GL.STENCIL_VALUE_MASK]:r,[w.GL.STENCIL_BACK_FUNC]:t,[w.GL.STENCIL_BACK_REF]:n,[w.GL.STENCIL_BACK_VALUE_MASK]:r}),stencilFuncSeparate:(e,t,n,r,i)=>e({[t===w.GL.FRONT?w.GL.STENCIL_FUNC:w.GL.STENCIL_BACK_FUNC]:n,[t===w.GL.FRONT?w.GL.STENCIL_REF:w.GL.STENCIL_BACK_REF]:r,[t===w.GL.FRONT?w.GL.STENCIL_VALUE_MASK:w.GL.STENCIL_BACK_VALUE_MASK]:i}),stencilOp:(e,t,n,r)=>e({[w.GL.STENCIL_FAIL]:t,[w.GL.STENCIL_PASS_DEPTH_FAIL]:n,[w.GL.STENCIL_PASS_DEPTH_PASS]:r,[w.GL.STENCIL_BACK_FAIL]:t,[w.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:n,[w.GL.STENCIL_BACK_PASS_DEPTH_PASS]:r}),stencilOpSeparate:(e,t,n,r,i)=>e({[t===w.GL.FRONT?w.GL.STENCIL_FAIL:w.GL.STENCIL_BACK_FAIL]:n,[t===w.GL.FRONT?w.GL.STENCIL_PASS_DEPTH_FAIL:w.GL.STENCIL_BACK_PASS_DEPTH_FAIL]:r,[t===w.GL.FRONT?w.GL.STENCIL_PASS_DEPTH_PASS:w.GL.STENCIL_BACK_PASS_DEPTH_PASS]:i}),viewport:(e,t,n,r,i)=>e({[w.GL.VIEWPORT]:[t,n,r,i]})},se=(e,t)=>e.isEnabled(t),oe={[w.GL.BLEND]:se,[w.GL.CULL_FACE]:se,[w.GL.DEPTH_TEST]:se,[w.GL.DITHER]:se,[w.GL.POLYGON_OFFSET_FILL]:se,[w.GL.SAMPLE_ALPHA_TO_COVERAGE]:se,[w.GL.SAMPLE_COVERAGE]:se,[w.GL.SCISSOR_TEST]:se,[w.GL.STENCIL_TEST]:se,[w.GL.RASTERIZER_DISCARD]:se},ae=new Set([w.GL.ACTIVE_TEXTURE,w.GL.TRANSFORM_FEEDBACK_ACTIVE,w.GL.TRANSFORM_FEEDBACK_PAUSED,w.GL.TRANSFORM_FEEDBACK_BUFFER_BINDING,w.GL.UNIFORM_BUFFER_BINDING,w.GL.ELEMENT_ARRAY_BUFFER_BINDING,w.GL.IMPLEMENTATION_COLOR_READ_FORMAT,w.GL.IMPLEMENTATION_COLOR_READ_TYPE,w.GL.READ_BUFFER,w.GL.DRAW_BUFFER0,w.GL.DRAW_BUFFER1,w.GL.DRAW_BUFFER2,w.GL.DRAW_BUFFER3,w.GL.DRAW_BUFFER4,w.GL.DRAW_BUFFER5,w.GL.DRAW_BUFFER6,w.GL.DRAW_BUFFER7,w.GL.DRAW_BUFFER8,w.GL.DRAW_BUFFER9,w.GL.DRAW_BUFFER10,w.GL.DRAW_BUFFER11,w.GL.DRAW_BUFFER12,w.GL.DRAW_BUFFER13,w.GL.DRAW_BUFFER14,w.GL.DRAW_BUFFER15,w.GL.SAMPLER_BINDING,w.GL.TEXTURE_BINDING_2D,w.GL.TEXTURE_BINDING_2D_ARRAY,w.GL.TEXTURE_BINDING_3D,w.GL.TEXTURE_BINDING_CUBE_MAP]);function le(e,t){const n=Dn.attach(e).gl;if(function(e){for(const t in e)return!1;return!0}(t))return;const r={};for(const s in t){const e=Number(s),i=te[s];i&&("string"==typeof i?r[i]=!0:i(n,t[s],e))}const i=n.state&&n.state.cache;if(i)for(const s in r){(0,re[s])(n,t,i)}}function ce(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),r=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&r&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class ue{constructor(e,t){let{copyState:n=!1,log:r=(()=>{})}=void 0===t?{}:t;this.program=null,this.stateStack=[],this.enable=!0,this.gl=e,this.cache=n?function(e,t){void 0===t&&(t=j);const n=Dn.attach(e).gl;if("number"==typeof t){const e=t,r=oe[e];return r?r(n,e):n.getParameter(e)}const r=Array.isArray(t)?t:Object.keys(t),i={};for(const s of r){const e=oe[s];i[s]=e?e(n,Number(s)):n.getParameter(Number(s))}return i}(e):Object.assign({},j),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e){void 0===e&&(e={}),this.stateStack.push({})}pop(){(0,A.h)(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];le(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,n=!1;const r=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const i in e){(0,A.h)(void 0!==i);const s=e[i],o=this.cache[i];ce(s,o)||(n=!0,t=o,r&&!(i in r)&&(r[i]=o),this.cache[i]=s)}return{valueChanged:n,oldValue:t}}}function _e(e){return e.state}function he(e,t){const{enable:n=!0,copyState:r}=t;if((0,A.h)(void 0!==r),!e.state){e.state=new ue(e,{copyState:r}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const r=_e(e);r.program!==n&&(t(n),r.program=n)}}(e);for(const t in ie){pe(e,t,ie[t])}Ee(e,"getParameter"),Ee(e,"isEnabled")}return _e(e).enable=n,e}function de(e){let t=_e(e);t||(he(e,{copyState:!1}),t=_e(e)),t.push()}function fe(e){const t=_e(e);(0,A.h)(t),t.pop()}function Ee(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||ae.has(t))return n(t);const r=_e(e);return t in r.cache||(r.cache[t]=n(t)),r.enable?r.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:t+"-from-cache",configurable:!1})}function pe(e,t,n){if(!e[t])return;const r=e[t].bind(e);e[t]=function(){const t=_e(e);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];const{valueChanged:a,oldValue:l}=n(t._updateCache,...s);return a&&r(...s),l},Object.defineProperty(e[t],"name",{value:t+"-to-cache",configurable:!1})}const ge={webgl2:!0,webgl1:!0,powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};const me={width:1,height:1,debug:!0,throwOnError:!1};let Ae=null;function Re(e){const t=e.getParameter(w.GL.VENDOR),n=e.getParameter(w.GL.RENDERER),r=e.getExtension("WEBGL_debug_renderer_info"),i=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:w.GL.VENDOR)||t,s=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:w.GL.RENDERER)||n,o=e.getParameter(w.GL.VERSION),a=Te(i,s),l=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(i,s),c=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(Te(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(i,s),u=O(e)?300:100;return{type:O(e)?"webgl2":"webgl",gpu:a,gpuType:c,gpuBackend:l,vendor:i,renderer:s,version:o,shadingLanguage:"glsl",shadingLanguageVersion:u}}function Te(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}var Le=n(2553);const ve=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function Se(e){const t=ve.exec(e);if(t){const[,e,n,r,i,s]=t;if(e){const t=""+r+n,o=(0,Le.e)(t);return{format:e,components:e.length,srgb:"-srgb"===i,unsized:"-unsized"===s,webgl:"-webgl"===s,...o}}}return function(e){var t;const n=be[e];if(!n)throw new Error("Unknown format "+e);return{format:n.format||"",components:n.components||(null==(t=n.format)?void 0:t.length)||1,byteLength:n.bpp||1,srgb:!1,unsized:!1}}(e)}const be={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2unorm-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function Ce(e){switch(e){case"uint8":case"unorm8":return w.GL.UNSIGNED_BYTE;case"sint8":case"snorm8":return w.GL.BYTE;case"uint16":case"unorm16":return w.GL.UNSIGNED_SHORT;case"sint16":case"snorm16":return w.GL.SHORT;case"uint32":return w.GL.UNSIGNED_INT;case"sint32":return w.GL.INT;case"float16":return w.GL.HALF_FLOAT;case"float32":return w.GL.FLOAT}throw new Error(String(e))}const Ge="texture-compression-bc",Ne="texture-compression-astc",ye="texture-compression-etc2",Ie="texture-compression-pvrtc-webgl",Me="texture-compression-atc-webgl",we="WEBGL_compressed_texture_s3tc",xe="WEBGL_compressed_texture_s3tc_srgb",Oe="EXT_texture_compression_rgtc",Fe="EXT_texture_compression_bptc",Pe="EXT_sRGB",Be="EXT_texture_norm16",De=(e,t)=>e.getExtension(t),Ue=(e,t)=>t.every((t=>e.getExtension(t))),ke={"texture-blend-float-webgl1":e=>!!O(e)||De(e,"EXT_float_blend"),"texture-formats-srgb-webgl1":e=>!!O(e)||De(e,Pe),"texture-formats-depth-webgl1":e=>!!O(e)||De(e,"WEBGL_depth_texture"),"texture-formats-float32-webgl1":e=>!!O(e)||De(e,"OES_texture_float"),"texture-formats-float16-webgl1":e=>!!O(e)||De(e,"OES_texture_half_float"),"texture-formats-norm16-webgl":e=>!!O(e)&&De(e,Be),"texture-filter-linear-float32-webgl":e=>De(e,"OES_texture_float_linear"),"texture-filter-linear-float16-webgl":e=>De(e,"OES_texture_half_float_linear"),"texture-filter-anisotropic-webgl":e=>De(e,"EXT_texture_filter_anisotropic"),"texture-renderable-float32-webgl":e=>De(e,"EXT_color_buffer_float"),"texture-renderable-float16-webgl":e=>De(e,"EXT_color_buffer_half_float"),"texture-compression-bc":e=>Ue(e,[we,xe,Oe,Fe]),"texture-compression-bc5-webgl":e=>Ue(e,[Oe]),"texture-compression-etc2":e=>Ue(e,["WEBGL_compressed_texture_etc"]),"texture-compression-astc":e=>Ue(e,["WEBGL_compressed_texture_astc"]),"texture-compression-etc1-webgl":e=>Ue(e,["WEBGL_compressed_texture_etc1"]),"texture-compression-pvrtc-webgl":e=>Ue(e,["WEBGL_compressed_texture_pvrtc"]),"texture-compression-atc-webgl":e=>Ue(e,["WEBGL_compressed_texture_atc"])};function Ve(e,t){var n;return(null==(n=ke[t])?void 0:n.call(ke,e))||!1}const Xe={"rgb8unorm-unsized":{gl:w.GL.RGB,gl1:w.GL.RGB,b:4,c:2,bpp:4,dataFormat:w.GL.RGB,types:[w.GL.UNSIGNED_BYTE,w.GL.UNSIGNED_SHORT_5_6_5]},"rgba8unorm-unsized":{gl:w.GL.RGBA,gl1:w.GL.RGBA,b:4,c:2,bpp:4,dataFormat:w.GL.RGBA,types:[w.GL.UNSIGNED_BYTE,w.GL.UNSIGNED_SHORT_4_4_4_4,w.GL.UNSIGNED_SHORT_5_5_5_1]},r8unorm:{gl:w.GL.R8,b:1,c:1,renderbuffer:!0},r8snorm:{gl:w.GL.R8_SNORM,b:1,c:1},r8uint:{gl:w.GL.R8UI,b:1,c:1,renderbuffer:!0},r8sint:{gl:w.GL.R8I,b:1,c:1,renderbuffer:!0},rg8unorm:{gl:w.GL.RG8,b:2,c:2,renderbuffer:!0},rg8snorm:{gl:w.GL.RG8_SNORM,b:2,c:2},rg8uint:{gl:w.GL.RG8UI,b:2,c:2,renderbuffer:!0},rg8sint:{gl:w.GL.RG8I,b:2,c:2,renderbuffer:!0},r16uint:{gl:w.GL.R16UI,b:2,c:1,renderbuffer:!0},r16sint:{gl:w.GL.R16I,b:2,c:1,renderbuffer:!0},r16float:{gl:w.GL.R16F,b:2,c:1,render:"texture-renderable-float16-webgl",filter:"texture-filter-linear-float16-webgl",renderbuffer:!0},"r16unorm-webgl":{gl:w.GL.R16_EXT,b:2,c:1,f:"texture-formats-norm16-webgl",renderbuffer:!0,x:Be},"r16snorm-webgl":{gl:w.GL.R16_SNORM_EXT,b:2,c:1,f:"texture-formats-norm16-webgl",x:Be},"rgba4unorm-webgl":{gl:w.GL.RGBA4,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb565unorm-webgl":{gl:w.GL.RGB565,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb5a1unorm-webgl":{gl:w.GL.RGB5_A1,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb8unorm-webgl":{gl:w.GL.RGB8,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:w.GL.RGB8_SNORM,b:3,c:3,wgpu:!1},rgba8unorm:{gl:w.GL.RGBA8,gl1:w.GL.RGBA,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:w.GL.SRGB8_ALPHA8,gl1:w.GL.SRGB_ALPHA_EXT,b:4,c:4,gl1ext:Pe,bpp:4},rgba8snorm:{gl:w.GL.RGBA8_SNORM,b:4,c:4},rgba8uint:{gl:w.GL.RGBA8UI,b:4,c:4,bpp:4},rgba8sint:{gl:w.GL.RGBA8I,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:w.GL.RG16UI,b:4,c:1,bpp:4},rg16sint:{gl:w.GL.RG16I,b:4,c:2,bpp:4},rg16float:{gl:w.GL.RG16F,bpp:4,b:4,c:2,render:"texture-renderable-float16-webgl",filter:"texture-filter-linear-float16-webgl",renderbuffer:!0},"rg16unorm-webgl":{gl:w.GL.RG16_EXT,b:2,c:2,f:"texture-formats-norm16-webgl",x:Be},"rg16snorm-webgl":{gl:w.GL.RG16_SNORM_EXT,b:2,c:2,f:"texture-formats-norm16-webgl",x:Be},r32uint:{gl:w.GL.R32UI,b:4,c:1,bpp:4,renderbuffer:!0},r32sint:{gl:w.GL.R32I,b:4,c:1,bpp:4,renderbuffer:!0},r32float:{gl:w.GL.R32F,bpp:4,b:4,c:1,render:"texture-renderable-float32-webgl",filter:"texture-filter-linear-float32-webgl"},rgb9e5ufloat:{gl:w.GL.RGB9_E5,b:4,c:3,p:1,render:"texture-renderable-float16-webgl",filter:"texture-filter-linear-float16-webgl"},rg11b10ufloat:{gl:w.GL.R11F_G11F_B10F,b:4,c:3,p:1,render:"texture-renderable-float32-webgl",renderbuffer:!0},rgb10a2unorm:{gl:w.GL.RGB10_A2,b:4,c:4,p:1,renderbuffer:!0},"rgb10a2unorm-webgl":{b:4,c:4,gl:w.GL.RGB10_A2UI,p:1,wgpu:!1,bpp:4,renderbuffer:!0},"rgb16unorm-webgl":{gl:w.GL.RGB16_EXT,b:2,c:3,f:"texture-formats-norm16-webgl",x:Be},"rgb16snorm-webgl":{gl:w.GL.RGB16_SNORM_EXT,b:2,c:3,f:"texture-formats-norm16-webgl",x:Be},rg32uint:{gl:w.GL.RG32UI,b:8,c:2,renderbuffer:!0},rg32sint:{gl:w.GL.RG32I,b:8,c:2,renderbuffer:!0},rg32float:{gl:w.GL.RG32F,b:8,c:2,render:"texture-renderable-float32-webgl",filter:"texture-filter-linear-float32-webgl",renderbuffer:!0},rgba16uint:{gl:w.GL.RGBA16UI,b:8,c:4,renderbuffer:!0},rgba16sint:{gl:w.GL.RGBA16I,b:8,c:4,renderbuffer:!0},rgba16float:{gl:w.GL.RGBA16F,gl1:w.GL.RGBA,b:8,c:4,render:"texture-renderable-float16-webgl",filter:"texture-filter-linear-float16-webgl"},"rgba16unorm-webgl":{gl:w.GL.RGBA16_EXT,b:2,c:4,f:"texture-formats-norm16-webgl",renderbuffer:!0,x:Be},"rgba16snorm-webgl":{gl:w.GL.RGBA16_SNORM_EXT,b:2,c:4,f:"texture-formats-norm16-webgl",x:Be},"rgb32float-webgl":{gl:w.GL.RGB32F,gl1:w.GL.RGB,render:"texture-renderable-float32-webgl",filter:"texture-filter-linear-float32-webgl",gl2ext:"EXT_color_buffer_float",gl1ext:"WEBGL_color_buffer_float",dataFormat:w.GL.RGB,types:[w.GL.FLOAT]},rgba32uint:{gl:w.GL.RGBA32UI,b:16,c:4,renderbuffer:!0},rgba32sint:{gl:w.GL.RGBA32I,b:16,c:4,renderbuffer:!0},rgba32float:{gl:w.GL.RGBA32F,b:16,c:4,render:"texture-renderable-float32-webgl",filter:"texture-filter-linear-float32-webgl",renderbuffer:!0},stencil8:{gl:w.GL.STENCIL_INDEX8,gl1:w.GL.STENCIL_INDEX8,b:1,c:1,attachment:w.GL.STENCIL_ATTACHMENT,renderbuffer:!0},depth16unorm:{gl:w.GL.DEPTH_COMPONENT16,gl1:w.GL.DEPTH_COMPONENT16,b:2,c:1,attachment:w.GL.DEPTH_ATTACHMENT,renderbuffer:!0},depth24plus:{gl:w.GL.DEPTH_COMPONENT24,b:3,c:1,attachment:w.GL.DEPTH_ATTACHMENT},depth32float:{gl:w.GL.DEPTH_COMPONENT32F,b:4,c:1,attachment:w.GL.DEPTH_ATTACHMENT,renderbuffer:!0},"depth24plus-stencil8":{gl:w.GL.DEPTH_STENCIL,gl1:w.GL.DEPTH_STENCIL,b:4,c:2,p:1,attachment:w.GL.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0,depthTexture:!0},"depth24unorm-stencil8":{gl:w.GL.DEPTH24_STENCIL8,b:4,c:2,p:1,attachment:w.GL.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0},"depth32float-stencil8":{gl:w.GL.DEPTH32F_STENCIL8,b:5,c:2,p:1,attachment:w.GL.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0},"bc1-rgb-unorm-webgl":{gl:w.GL.COMPRESSED_RGB_S3TC_DXT1_EXT,x:we,f:Ge},"bc1-rgb-unorm-srgb-webgl":{gl:w.GL.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:xe,f:Ge},"bc1-rgba-unorm":{gl:w.GL.COMPRESSED_RGBA_S3TC_DXT1_EXT,x:we,f:Ge},"bc1-rgba-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:xe,f:Ge},"bc2-rgba-unorm":{gl:w.GL.COMPRESSED_RGBA_S3TC_DXT3_EXT,x:we,f:Ge},"bc2-rgba-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,x:xe,f:Ge},"bc3-rgba-unorm":{gl:w.GL.COMPRESSED_RGBA_S3TC_DXT5_EXT,x:we,f:Ge},"bc3-rgba-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,x:xe,f:Ge},"bc4-r-unorm":{gl:w.GL.COMPRESSED_RED_RGTC1_EXT,x:Oe,f:Ge},"bc4-r-snorm":{gl:w.GL.COMPRESSED_SIGNED_RED_RGTC1_EXT,x:Oe,f:Ge},"bc5-rg-unorm":{gl:w.GL.COMPRESSED_RED_GREEN_RGTC2_EXT,x:Oe,f:Ge},"bc5-rg-snorm":{gl:w.GL.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,x:Oe,f:Ge},"bc6h-rgb-ufloat":{gl:w.GL.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,x:Fe,f:Ge},"bc6h-rgb-float":{gl:w.GL.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,x:Fe,f:Ge},"bc7-rgba-unorm":{gl:w.GL.COMPRESSED_RGBA_BPTC_UNORM_EXT,x:Fe,f:Ge},"bc7-rgba-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT,x:Fe,f:Ge},"etc2-rgb8unorm":{gl:w.GL.COMPRESSED_RGB8_ETC2,f:ye},"etc2-rgb8unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ETC2,f:ye},"etc2-rgb8a1unorm":{gl:w.GL.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,f:ye},"etc2-rgb8a1unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,f:ye},"etc2-rgba8unorm":{gl:w.GL.COMPRESSED_RGBA8_ETC2_EAC,f:ye},"etc2-rgba8unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,f:ye},"eac-r11unorm":{gl:w.GL.COMPRESSED_R11_EAC,f:ye},"eac-r11snorm":{gl:w.GL.COMPRESSED_SIGNED_R11_EAC,f:ye},"eac-rg11unorm":{gl:w.GL.COMPRESSED_RG11_EAC,f:ye},"eac-rg11snorm":{gl:w.GL.COMPRESSED_SIGNED_RG11_EAC,f:ye},"astc-4x4-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_4x4_KHR,f:Ne},"astc-4x4-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,f:Ne},"astc-5x4-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_5x4_KHR,f:Ne},"astc-5x4-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,f:Ne},"astc-5x5-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_5x5_KHR,f:Ne},"astc-5x5-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,f:Ne},"astc-6x5-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_6x5_KHR,f:Ne},"astc-6x5-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,f:Ne},"astc-6x6-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_6x6_KHR,f:Ne},"astc-6x6-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,f:Ne},"astc-8x5-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_8x5_KHR,f:Ne},"astc-8x5-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,f:Ne},"astc-8x6-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_8x6_KHR,f:Ne},"astc-8x6-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,f:Ne},"astc-8x8-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_8x8_KHR,f:Ne},"astc-8x8-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,f:Ne},"astc-10x5-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_10x10_KHR,f:Ne},"astc-10x5-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,f:Ne},"astc-10x6-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_10x6_KHR,f:Ne},"astc-10x6-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,f:Ne},"astc-10x8-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_10x8_KHR,f:Ne},"astc-10x8-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,f:Ne},"astc-10x10-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_10x10_KHR,f:Ne},"astc-10x10-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,f:Ne},"astc-12x10-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_12x10_KHR,f:Ne},"astc-12x10-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,f:Ne},"astc-12x12-unorm":{gl:w.GL.COMPRESSED_RGBA_ASTC_12x12_KHR,f:Ne},"astc-12x12-unorm-srgb":{gl:w.GL.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,f:Ne},"pvrtc-rgb4unorm-webgl":{gl:w.GL.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,f:Ie},"pvrtc-rgba4unorm-webgl":{gl:w.GL.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,f:Ie},"pvrtc-rbg2unorm-webgl":{gl:w.GL.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,f:Ie},"pvrtc-rgba2unorm-webgl":{gl:w.GL.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,f:Ie},"etc1-rbg-unorm-webgl":{gl:w.GL.COMPRESSED_RGB_ETC1_WEBGL,f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{gl:w.GL.COMPRESSED_RGB_ATC_WEBGL,f:Me},"atc-rgba-unorm-webgl":{gl:w.GL.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,f:Me},"atc-rgbai-unorm-webgl":{gl:w.GL.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL,f:Me}},He={[w.GL.RED]:1,[w.GL.RED_INTEGER]:1,[w.GL.RG]:2,[w.GL.RG_INTEGER]:2,[w.GL.RGB]:3,[w.GL.RGB_INTEGER]:3,[w.GL.RGBA]:4,[w.GL.RGBA_INTEGER]:4,[w.GL.DEPTH_COMPONENT]:1,[w.GL.DEPTH_STENCIL]:1,[w.GL.ALPHA]:1,[w.GL.LUMINANCE]:1,[w.GL.LUMINANCE_ALPHA]:2},We={[w.GL.FLOAT]:4,[w.GL.UNSIGNED_INT]:4,[w.GL.INT]:4,[w.GL.UNSIGNED_SHORT]:2,[w.GL.SHORT]:2,[w.GL.HALF_FLOAT]:2,[w.GL.BYTE]:1,[w.GL.UNSIGNED_BYTE]:1};function Ke(e,t){const n=Ye(t),r=Xe[n];if(!r)return!1;if(O(e)?void 0===r.gl:void 0===r.gl1)return!1;const i=r.x||O(e)&&r.gl2ext||r.gl1ext;return!i||Boolean(e.getExtension(i))}function Ye(e){if("string"==typeof e)return e;const t=Object.entries(Xe).find((t=>{let[,n]=t;return n.gl===e||n.gl1===e}));if(!t)throw new Error("Unknown texture format "+e);return t[0]}function ze(e,t){const n=Xe[e],r=t?null==n?void 0:n.gl:null==n?void 0:n.gl1;if(void 0===r)throw new Error("Unsupported texture format "+e);return r}function je(e,t){const n=Ye(e),r=ze(n,t),i=Se(n);return{format:r,dataFormat:qe(i.format,i.integer,i.normalized,r),type:i.dataType?Ce(i.dataType):w.GL.UNSIGNED_BYTE,compressed:i.compressed}}function Ze(e,t){const n=je(Ye(e),t);return(He[n.dataFormat]||4)*(We[n.type]||1)}function qe(e,t,n,r){if(r===w.GL.RGBA||r===w.GL.RGB)return r;switch(e){case"r":return t&&!n?w.GL.RED_INTEGER:w.GL.RED;case"rg":return t&&!n?w.GL.RG_INTEGER:w.GL.RG;case"rgb":return t&&!n?w.GL.RGB_INTEGER:w.GL.RGB;case"rgba":return t&&!n?w.GL.RGBA_INTEGER:w.GL.RGBA;default:return w.GL.RGBA}}function Qe(e){const t=function(e){e.getExtension("EXT_color_buffer_float"),e.getExtension("WEBGL_color_buffer_float"),e.getExtension("EXT_float_blend");const t=new Set;for(const n of Object.keys(tt))$e(e,n)&&t.add(n);return t}(e);for(const n of function(e){return Object.keys(ke).filter((t=>Ve(e,t)))}(e))t.add(n);return t}function $e(e,t){const n=tt[t];if(!n)return!1;const[r,i]=n||[],s=O(e)?i:r;if("boolean"==typeof s)return s;switch(t){case"texture-renderable-rgba32float-webgl":return O(e)?Boolean(e.getExtension(s)):function(e,t,n,r){void 0===t&&(t=e.RGBA),void 0===n&&(n=w.GL.RGBA),void 0===r&&(r=w.GL.UNSIGNED_BYTE);let i=null,s=null;try{i=e.createTexture(),e.bindTexture(w.GL.TEXTURE_2D,i);const o=0,a=1,l=1,c=0,u=new Uint8Array([0,0,255,255]);e.texImage2D(e.TEXTURE_2D,o,t,a,l,c,n,r,u),s=e.createFramebuffer(),e.bindFramebuffer(w.GL.FRAMEBUFFER,s),e.framebufferTexture2D(w.GL.FRAMEBUFFER,w.GL.COLOR_ATTACHMENT0,w.GL.TEXTURE_2D,i,0);const _=e.checkFramebufferStatus(w.GL.FRAMEBUFFER)===w.GL.FRAMEBUFFER_COMPLETE;return e.bindTexture(w.GL.TEXTURE_2D,null),_}finally{e.deleteTexture(i),e.deleteFramebuffer(s)}}(e);case"glsl-derivatives":case"glsl-frag-depth":return et(e,s);case"glsl-frag-data":return et(e,s,{behavior:"require"});default:return Boolean(e.getExtension(s))}}const Je={};function et(e,t,n){if(void 0===n&&(n={}),!function(e){void 0===e&&(e={});const t="undefined"!=typeof window&&window.navigator||{},n=e.userAgent||t.userAgent||"",r=-1!==n.indexOf("MSIE "),i=-1!==n.indexOf("Trident/");return r||i}(n))return!0;if(t in Je)return Je[t];const r="#extension GL_"+t+" : "+(n.behavior||"enable")+"\nvoid main(void) {}",i=e.createShader(e.VERTEX_SHADER);if(!i)throw new Error("shader");e.shaderSource(i,r),e.compileShader(i);const s=e.getShaderParameter(i,e.COMPILE_STATUS);return e.deleteShader(i),Je[t]=s,s}const tt={webgl:[!0,!0],webgl2:[!1,!0],"timer-query-webgl":["EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2"],"transform-feedback-webgl2":[!1,!0],"vertex-array-object-webgl1":["OES_vertex_array_object",!0],"instanced-rendering-webgl1":["ANGLE_instanced_arrays",!0],"multiple-render-targets-webgl1":["WEBGL_draw_buffers",!0],"index-uint32-webgl1":["OES_element_index_uint",!0],"blend-minmax-webgl1":["EXT_blend_minmax",!0],"texture-blend-float-webgl1":["EXT_float_blend","EXT_float_blend"],"texture-formats-srgb-webgl1":["EXT_sRGB",!0],"texture-formats-depth-webgl1":["WEBGL_depth_texture",!0],"texture-formats-float32-webgl1":["OES_texture_float",!0],"texture-formats-float16-webgl1":["OES_texture_half_float",!0],"texture-filter-linear-float32-webgl":["OES_texture_float_linear","OES_texture_float_linear"],"texture-filter-linear-float16-webgl":["OES_texture_half_float_linear","OES_texture_half_float_linear"],"texture-filter-anisotropic-webgl":["EXT_texture_filter_anisotropic","EXT_texture_filter_anisotropic"],"texture-renderable-rgba32float-webgl":["WEBGL_color_buffer_float","EXT_color_buffer_float"],"texture-renderable-float32-webgl":[!1,"EXT_color_buffer_float"],"texture-renderable-float16-webgl":["EXT_color_buffer_half_float","EXT_color_buffer_half_float"],"glsl-frag-data":["WEBGL_draw_buffers",!0],"glsl-frag-depth":["EXT_frag_depth",!0],"glsl-derivatives":["OES_standard_derivatives",!0],"glsl-texture-lod":["EXT_shader_texture_lod",!0]};var nt=n(8060),rt=n(8295),it=n(4025);function st(e,t,n){const r=Dn.attach(e).gl;if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:i=!0}=t;let s;if(de(r),le(r,t),i)s=n(r),fe(r);else try{s=n(r)}finally{fe(r)}return s}function ot(e,t){const n=Dn.attach(e),{gl:r}=n;if(t.cullMode)switch(t.cullMode){case"none":r.disable(w.GL.CULL_FACE);break;case"front":r.enable(w.GL.CULL_FACE),r.cullFace(w.GL.FRONT);break;case"back":r.enable(w.GL.CULL_FACE),r.cullFace(w.GL.BACK)}if(t.frontFace&&r.frontFace(_t("frontFace",t.frontFace,{ccw:w.GL.CCW,cw:w.GL.CW})),void 0!==t.depthBias&&r.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0),void 0!==t.depthWriteEnabled&&r.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?r.enable(w.GL.DEPTH_TEST):r.disable(w.GL.DEPTH_TEST),r.depthFunc(at("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;r.stencilMaskSeparate(w.GL.FRONT,e),r.stencilMaskSeparate(w.GL.BACK,e)}if(t.stencilReadMask&&_.c.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=at("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?r.enable(w.GL.STENCIL_TEST):r.disable(w.GL.STENCIL_TEST),r.stencilFuncSeparate(w.GL.FRONT,n,0,e),r.stencilFuncSeparate(w.GL.BACK,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=lt("stencilPassOperation",t.stencilPassOperation),n=lt("stencilFailOperation",t.stencilFailOperation),i=lt("stencilDepthFailOperation",t.stencilDepthFailOperation);r.stencilOpSeparate(w.GL.FRONT,n,i,e),r.stencilOpSeparate(w.GL.BACK,n,i,e)}if(t.blendColorOperation||t.blendAlphaOperation){r.enable(w.GL.BLEND);const e=ct("blendColorOperation",t.blendColorOperation||"add"),n=ct("blendAlphaOperation",t.blendAlphaOperation||"add");r.blendEquationSeparate(e,n);const i=ut("blendColorSrcFactor",t.blendColorSrcFactor||"one"),s=ut("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=ut("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=ut("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");r.blendFuncSeparate(i,s,o,a)}}function at(e,t){return _t(e,t,{never:w.GL.NEVER,less:w.GL.LESS,equal:w.GL.EQUAL,"less-equal":w.GL.LEQUAL,greater:w.GL.GREATER,"not-equal":w.GL.NOTEQUAL,"greater-equal":w.GL.GEQUAL,always:w.GL.ALWAYS})}function lt(e,t){return _t(e,t,{keep:w.GL.KEEP,zero:w.GL.ZERO,replace:w.GL.REPLACE,invert:w.GL.INVERT,"increment-clamp":w.GL.INCR,"decrement-clamp":w.GL.DECR,"increment-wrap":w.GL.INCR_WRAP,"decrement-wrap":w.GL.DECR_WRAP})}function ct(e,t){return _t(e,t,{add:w.GL.FUNC_ADD,subtract:w.GL.FUNC_SUBTRACT,"reverse-subtract":w.GL.FUNC_REVERSE_SUBTRACT,min:w.GL.MIN,max:w.GL.MAX})}function ut(e,t){return _t(e,t,{one:w.GL.ONE,zero:w.GL.ZERO,"src-color":w.GL.SRC_COLOR,"one-minus-src-color":w.GL.ONE_MINUS_SRC_COLOR,"dst-color":w.GL.DST_COLOR,"one-minus-dst-color":w.GL.ONE_MINUS_DST_COLOR,"src-alpha":w.GL.SRC_ALPHA,"one-minus-src-alpha":w.GL.ONE_MINUS_SRC_ALPHA,"dst-alpha":w.GL.DST_ALPHA,"one-minus-dst-alpha":w.GL.ONE_MINUS_DST_ALPHA})}function _t(e,t,n){if(!(t in n))throw new Error(function(e,t){return"Illegal parameter "+t+" for "+e}(e,t));return n[t]}function ht(e){const t={};return e.addressModeU&&(t[w.GL.TEXTURE_WRAP_S]=dt(e.addressModeU)),e.addressModeV&&(t[w.GL.TEXTURE_WRAP_T]=dt(e.addressModeV)),e.addressModeW&&(t[w.GL.TEXTURE_WRAP_R]=dt(e.addressModeW)),e.magFilter&&(t[w.GL.TEXTURE_MAG_FILTER]=ft(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[w.GL.TEXTURE_MIN_FILTER]=function(e,t){if(!t)return ft(e);switch(e){case"nearest":return"nearest"===t?w.GL.NEAREST_MIPMAP_NEAREST:w.GL.NEAREST_MIPMAP_LINEAR;case"linear":return"nearest"===t?w.GL.LINEAR_MIPMAP_NEAREST:w.GL.LINEAR_MIPMAP_LINEAR}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[w.GL.TEXTURE_MIN_LOD]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[w.GL.TEXTURE_MAX_LOD]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[w.GL.TEXTURE_COMPARE_MODE]=w.GL.COMPARE_REF_TO_TEXTURE),e.compare&&(t[w.GL.TEXTURE_COMPARE_FUNC]=at("compare",e.compare)),e.maxAnisotropy&&(t[w.GL.TEXTURE_MAX_ANISOTROPY_EXT]=e.maxAnisotropy),t}function dt(e){switch(e){case"clamp-to-edge":return w.GL.CLAMP_TO_EDGE;case"repeat":return w.GL.REPEAT;case"mirror-repeat":return w.GL.MIRRORED_REPEAT}}function ft(e){switch(e){case"nearest":return w.GL.NEAREST;case"linear":return w.GL.LINEAR}}class Et extends p.l{constructor(e,t){void 0===t&&(t={}),super(e,t),this.glIndexType=w.GL.UNSIGNED_SHORT,this.device=e,this.gl=this.device.gl,this.gl2=this.device.gl2;const n="object"==typeof t?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=function(e){if(e&p.l.INDEX)return w.GL.ELEMENT_ARRAY_BUFFER;if(e&p.l.VERTEX)return w.GL.ARRAY_BUFFER;if(e&p.l.UNIFORM)return w.GL.UNIFORM_BUFFER;return w.GL.ARRAY_BUFFER}(this.props.usage),this.glUsage=function(e){if(e&p.l.INDEX)return w.GL.STATIC_DRAW;if(e&p.l.VERTEX)return w.GL.STATIC_DRAW;if(e&p.l.UNIFORM)return w.GL.DYNAMIC_DRAW;return w.GL.STATIC_DRAW}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?w.GL.UNSIGNED_INT:w.GL.UNSIGNED_SHORT,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.byteLength+t);const r=this.glTarget;this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,n,this.glUsage),this.gl.bufferSubData(r,t,e),this.gl.bindBuffer(r,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){(0,A.h)(e>=0);let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t){void 0===t&&(t=0);const n=this.device.isWebGL2?w.GL.COPY_WRITE_BUFFER:this.glTarget;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e,t){return void 0===e&&(e=0),this.readSyncWebGL2(e,t)}readSyncWebGL2(e,t){var n;void 0===e&&(e=0),this.device.assertWebGL2(),t=null!=(n=t)?n:this.byteLength-e;const r=new Uint8Array(t);return this.gl.bindBuffer(w.GL.COPY_READ_BUFFER,this.handle),this.gl2.getBufferSubData(w.GL.COPY_READ_BUFFER,e,r,0,t),this.gl.bindBuffer(w.GL.COPY_READ_BUFFER,null),this._setDebugData(r,e,t),r}}var pt=n(9491);let gt;gt=Symbol.toStringTag;class mt extends pt._{get[gt](){return"Sampler"}constructor(e,t){super(e,t,mt.defaultProps)}}mt.defaultProps={...pt._.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};class At extends mt{constructor(e,t){super(e,t),this.device=e,this.parameters=ht(t),this.device.isWebGL2&&(this.handle=this.handle||this.device.gl2.createSampler(),this._setSamplerParameters(this.parameters))}destroy(){this.handle&&(this.device.gl2.deleteSampler(this.handle),this.handle=void 0)}toString(){return"Sampler("+this.id+","+JSON.stringify(this.props)+")"}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case w.GL.TEXTURE_MIN_LOD:case w.GL.TEXTURE_MAX_LOD:this.device.gl2.samplerParameterf(this.handle,e,n);break;default:this.device.gl2.samplerParameteri(this.handle,e,n)}}}}const Rt={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0};class Tt extends rt.x{constructor(e,t){var n;super(e,{...Rt,format:"rgba8unorm",...t}),this.sampler=void 0,this.glFormat=void 0,this.type=void 0,this.dataFormat=void 0,this.mipmaps=void 0,this.textureUnit=void 0,this.loaded=!1,this.device=e,this.gl=this.device.gl,this.gl2=this.device.gl2,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=w.GL.RGBA,this.target=function(e){switch(e.dimension){case"2d":return w.GL.TEXTURE_2D;case"cube":return w.GL.TEXTURE_CUBE_MAP;case"2d-array":return w.GL.TEXTURE_2D_ARRAY;case"3d":return w.GL.TEXTURE_3D;default:throw new Error(e.dimension)}}(this.props),this.loaded=!1,"string"==typeof(null==(n=this.props)?void 0:n.data)&&Object.assign(this.props,{data:(0,it.po)(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return"Texture("+this.id+","+this.width+"x"+this.height+")"}initialize(e){if(void 0===e&&(e={}),"cube"===this.props.dimension)return this.initializeCube(e);let t=e.data;if(t instanceof Promise)return t.then((t=>this.initialize(Object.assign({},e,{pixels:t,data:t})))),this;const n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(n&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",(()=>this.initialize(e))),this;const{parameters:r={}}=e,{pixels:i=null,pixelStore:s={},textureUnit:o}=e;t||(t=i);let{width:a,height:l,dataFormat:c,type:u,compressed:h=!1,mipmaps:d=!0}=e;const{depth:f=0}=e,E=ze(e.format,this.device.isWebGL2);return({width:a,height:l,compressed:h,dataFormat:c,type:u}=this._deduceParameters({format:e.format,type:u,dataFormat:c,compressed:h,data:t,width:a,height:l})),this.width=a,this.height=l,this.glFormat=E,this.type=u,this.dataFormat=c,this.textureUnit=o,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(w.GL.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),d&&this.device.isWebGL1&&Lt(this.width,this.height)&&(_.c.warn("texture: "+this+" is Non-Power-Of-Two, disabling mipmaps")(),d=!1),this.mipmaps=d,this.setImageData({data:t,width:a,height:l,depth:f,format:E,type:u,dataFormat:c,parameters:s,compressed:h}),this.setSampler(e.sampler),this._setSamplerParameters(r),d&&this.generateMipmap(),n&&(this._video={video:t,parameters:r,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}initializeCube(e){const{mipmaps:t=!0,parameters:n={}}=e;return this.setCubeMapImageData(e).then((()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(n)})),this}setSampler(e){let t;void 0===e&&(e={}),e instanceof At?(this.sampler=e,t=e.props):(this.sampler=new At(this.device,e),t=e);const n=ht(t);return this._setSamplerParameters(n),this}resize(e){const{height:t,width:n,mipmaps:r=!1}=e;return n!==this.width||t!==this.height?this.initialize({width:n,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:r}):this}update(){if(this._video){const{video:e,parameters:t,lastTime:n}=this._video;if(n===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e){return void 0===e&&(e={}),this.device.isWebGL1&&Lt(this.width,this.height)?(_.c.warn("texture: "+this+" is Non-Power-Of-Two, disabling mipmaping")(),this):(this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),st(this.gl,e,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this)}setImageData(e){if("3d"===this.props.dimension||"2d-array"===this.props.dimension)return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:n=null,level:r=0,glFormat:i=this.glFormat,offset:s=0,parameters:o={}}=e;let{data:a=null,type:l=this.type,width:c=this.width,height:u=this.height,dataFormat:_=this.dataFormat,compressed:h=!1}=e;a||(a=n),({type:l,dataFormat:_,compressed:h,width:c,height:u}=this._deduceParameters({format:this.props.format,type:l,dataFormat:_,compressed:h,data:a,width:c,height:u}));const{gl:d}=this;d.bindTexture(this.target,this.handle);let f,E=null;if(({data:a,dataType:E}=this._getDataType({data:a,compressed:h})),st(this.gl,o,(()=>{switch(E){case"null":d.texImage2D(t,r,i,c,u,0,_,l,a);break;case"typed-array":d.texImage2D(t,r,i,c,u,0,_,l,a,s);break;case"buffer":f=this.device.assertWebGL2(),f.bindBuffer(w.GL.PIXEL_UNPACK_BUFFER,a.handle||a),f.texImage2D(t,r,i,c,u,0,_,l,s),f.bindBuffer(w.GL.PIXEL_UNPACK_BUFFER,null);break;case"browser-object":this.device.isWebGL2?d.texImage2D(t,r,i,c,u,0,_,l,a):d.texImage2D(t,r,i,_,l,a);break;case"compressed":for(const[e,n]of a.entries())d.compressedTexImage2D(t,e,n.format,n.width,n.height,0,n.data);break;default:(0,A.h)(!1,"Unknown image data type")}})),a&&a.byteLength)this.trackAllocatedMemory(a.byteLength,"Texture");else{const e=Ze(this.props.format,this.device.isWebGL2);this.trackAllocatedMemory(this.width*this.height*e,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:n=null,data:r=null,x:i=0,y:s=0,width:o=this.width,height:a=this.height,level:l=0,glFormat:c=this.glFormat,type:u=this.type,dataFormat:_=this.dataFormat,compressed:h=!1,offset:d=0,parameters:f={}}=e;if(({type:u,dataFormat:_,compressed:h,width:o,height:a}=this._deduceParameters({format:this.props.format,type:u,dataFormat:_,compressed:h,data:r,width:o,height:a})),(0,A.h)(1===this.depth,"texSubImage not supported for 3D textures"),r||(r=n),r&&r.data){const e=r;r=e.data,o=e.shape[0],a=e.shape[1]}r instanceof Et&&(r=r.handle),this.gl.bindTexture(this.target,this.handle),st(this.gl,f,(()=>{if(h)this.gl.compressedTexSubImage2D(t,l,i,s,o,a,c,r);else if(null===r)this.gl.texSubImage2D(t,l,i,s,o,a,_,u,null);else if(ArrayBuffer.isView(r))this.gl.texSubImage2D(t,l,i,s,o,a,_,u,r,d);else if("undefined"!=typeof WebGLBuffer&&r instanceof WebGLBuffer){const e=this.device.assertWebGL2();e.bindBuffer(w.GL.PIXEL_UNPACK_BUFFER,r),e.texSubImage2D(t,l,i,s,o,a,_,u,d),e.bindBuffer(w.GL.PIXEL_UNPACK_BUFFER,null)}else if(this.device.isWebGL2){this.device.assertWebGL2().texSubImage2D(t,l,i,s,o,a,_,u,r)}else this.gl.texSubImage2D(t,l,i,s,_,u,r)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(e){return void 0===e&&(e={}),_.c.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(w.GL.ACTIVE_TEXTURE)-w.GL.TEXTURE0}bind(e){void 0===e&&(e=this.textureUnit);const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,this.handle),e}unbind(e){void 0===e&&(e=this.textureUnit);const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:n=!1}=e;return n?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof Et?{data:t.handle,dataType:"buffer"}:"undefined"!=typeof WebGLBuffer&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:n}=e;let{width:r,height:i,dataFormat:s,type:o,compressed:a}=e;const l=je(t,this.device.isWebGL2);return s=s||l.dataFormat,o=o||l.type,a=a||l.compressed,({width:r,height:i}=this._deduceImageSize(n,r,i)),{dataFormat:s,type:o,compressed:a,width:r,height:i,format:t,data:n}}_deduceImageSize(e,t,n){let r;return r="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},(0,A.h)(r,"Could not deduced texture size"),(0,A.h)(void 0===t||r.width===t,"Deduced texture width does not match supplied width"),(0,A.h)(void 0===n||r.height===n,"Deduced texture height does not match supplied height"),r}async setCubeMapImageData(e){const{gl:t}=this,{width:n,height:r,pixels:i,data:s,format:o=w.GL.RGBA,type:a=w.GL.UNSIGNED_BYTE}=e,l=i||s,c=await Promise.all(Tt.FACES.map((e=>{const t=l[e];return Promise.all(Array.isArray(t)?t:[t])})));this.bind(),Tt.FACES.forEach(((e,i)=>{c[i].length>1&&!1!==this.props.mipmaps&&_.c.warn(this.id+" has mipmap and multiple LODs.")(),c[i].forEach(((i,s)=>{n&&r?t.texImage2D(e,s,o,n,r,0,o,a,i):t.texImage2D(e,s,o,o,a,i)}))})),this.unbind()}setImageDataForFace(e){const{face:t,width:n,height:r,pixels:i,data:s,format:o=w.GL.RGBA,type:a=w.GL.UNSIGNED_BYTE}=e,{gl:l}=this,c=i||s;return this.bind(),c instanceof Promise?c.then((n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n})))):this.width||this.height?l.texImage2D(t,0,o,n,r,0,o,a,c):l.texImage2D(t,0,o,o,a,c),this}setImageData3D(e){const{level:t=0,dataFormat:n,format:r,type:i,width:s,height:o,depth:a=1,offset:l=0,data:c,parameters:u={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const _=je(r,this.device.isWebGL2);if(st(this.gl,u,(()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,t,_.format,s,o,a,0,_.dataFormat,_.type,c),c instanceof Et&&(this.gl.bindBuffer(w.GL.PIXEL_UNPACK_BUFFER,c.handle),this.gl.texImage3D(this.target,t,n,s,o,a,0,r,i,l))})),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const e=Ze(this.props.format,this.device.isWebGL2);this.trackAllocatedMemory(this.width*this.height*this.depth*e,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(this.device.isWebGL1&&Lt(this.width,this.height)&&(e=function(e){const t={...e};return e[w.GL.TEXTURE_MIN_FILTER]!==w.GL.NEAREST&&(t[w.GL.TEXTURE_MIN_FILTER]=w.GL.LINEAR),t[w.GL.TEXTURE_WRAP_S]=w.GL.CLAMP_TO_EDGE,t[w.GL.TEXTURE_WRAP_T]=w.GL.CLAMP_TO_EDGE,t}(e)),!(0,E.nK)(e)){!function(e){_.c.log(1,"texture sampler parameters",e)()}(e),this.gl.bindTexture(this.target,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),r=n;switch(e){case w.GL.TEXTURE_MIN_LOD:case w.GL.TEXTURE_MAX_LOD:this.gl.texParameterf(this.target,e,r);break;default:this.gl.texParameteri(this.target,e,r)}}this.gl.bindTexture(this.target,null)}}_getWebGL1NPOTParameterOverride(e,t){if(this.device.isWebGL1&&Lt(this.width,this.height))switch(e){case w.GL.TEXTURE_MIN_FILTER:if(t!==w.GL.LINEAR&&t!==w.GL.NEAREST)return w.GL.LINEAR;break;case w.GL.TEXTURE_WRAP_S:case w.GL.TEXTURE_WRAP_T:return w.GL.CLAMP_TO_EDGE}return t}}function Lt(e,t){return!(!e||!t)&&(!(0,E.wt)(e)||!(0,E.wt)(t))}function vt(e,t){if("string"!=typeof t)return t;const n=Number(t);if(!isNaN(n))return n;const r=e[t=t.replace(/^.*\./,"")];return(0,A.h)(void 0!==r,"Accessing undefined constant GL."+t),r}Tt.FACES=[w.GL.TEXTURE_CUBE_MAP_POSITIVE_X,w.GL.TEXTURE_CUBE_MAP_NEGATIVE_X,w.GL.TEXTURE_CUBE_MAP_POSITIVE_Y,w.GL.TEXTURE_CUBE_MAP_NEGATIVE_Y,w.GL.TEXTURE_CUBE_MAP_POSITIVE_Z,w.GL.TEXTURE_CUBE_MAP_NEGATIVE_Z];const St="Resource subclass must define virtual methods";class bt extends pt._{constructor(e,t,n){super(e,t,n),this._bound=!1,this.byteLength=0,this.device=Dn.attach(e);const r=this.device.gl;P(r);const{id:i}=t||{};this.gl=r,this.gl2=r,this.id=i||(0,E.hQ)(this.constructor.name),this._handle=null==t?void 0:t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0}toString(){return this.constructor.name+"("+this.id+")"}get handle(){return this._handle}delete(e){let{deleteChildren:t=!1}=void 0===e?{}:e;const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this.removeStats(),this._handle=null,n&&t&&n.filter(Boolean).forEach((e=>e.destroy())),this}bind(e){if(void 0===e&&(e=this.handle),"function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}getParameter(e,t){void 0===t&&(t={}),e=vt(this.gl,e),(0,A.h)(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=O(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension)))){const t=n.webgl1,r="webgl2"in n?n.webgl2:n.webgl1;return e?r:t}}return this._getParameter(e,t)}getParameters(e){void 0===e&&(e={});const{parameters:t,keys:n}=e,r=this.constructor.PARAMETERS||{},i=O(this.gl),s={},o=t||Object.keys(r);for(const a of o){const t=r[a];if(t&&(!("webgl2"in t)||i)&&(!("extension"in t)||this.gl.getExtension(t.extension))){const r=n?this.device.getGLKey(a):a;s[r]=this.getParameter(a,e),n&&"GLenum"===t.type&&(s[r]=this.device.getGLKey(s[r]))}}return s}setParameter(e,t){e=vt(this.gl,e),(0,A.h)(e);const n=(this.constructor.PARAMETERS||{})[e];if(n){const e=O(this.gl);if(!((!("webgl2"in n)||e)&&(!("extension"in n)||this.gl.getExtension(n.extension))))throw new Error("Parameter not available on this platform");"GLenum"===n.type&&(t=vt(t))}return this._setParameter(e,t),this}setParameters(e){for(const t in e)this.setParameter(t,e[t]);return this}stubRemovedMethods(e,t,n){return function(e,t,n,r){const i="See luma.gl "+n+" Upgrade Guide at https://luma.gl/docs/upgrade-guide",s=Object.getPrototypeOf(e);r.forEach((e=>{s.methodName||(s[e]=()=>{throw _.c.removed("Calling removed method "+t+"."+e+": ",i)(),new Error(e)})}))}(this,e,t,n)}initialize(e){}_createHandle(){throw new Error(St)}_deleteHandle(){throw new Error(St)}_bindHandle(e){throw new Error(St)}_getOptsFromHandle(){throw new Error(St)}_getParameter(e,t){throw new Error(St)}_setParameter(e,t){throw new Error(St)}}let Ct;Ct=Symbol.toStringTag;class Gt extends bt{get[Ct](){return"Renderbuffer"}get width(){return this.props.width}get height(){return this.props.height}get format(){return this.props.format}get samples(){return this.props.samples}get attachment(){}static isTextureFormatSupported(e,t){return function(e,t){var n;return Ke(e,t)&&(null==(n=Xe[t])?void 0:n.renderbuffer)}(e.gl,t)}constructor(e,t){if("number"==typeof t.format)throw new Error("Renderbuffer");super(e,t,Gt.defaultProps),this.glFormat=ze(this.props.format,e.isWebGL2),this._initialize(this.props)}resize(e){e.width===this.width&&e.height===this.height||(Object.assign(this.props,{...e,format:this.format,samples:this.samples}),this._initialize(this.props))}_initialize(e){const{format:t,width:n,height:r,samples:i}=e;(0,A.h)(t,"Needs format"),this.trackDeallocatedMemory(),this.gl.bindRenderbuffer(w.GL.RENDERBUFFER,this.handle),0!==i&&this.device.isWebGL2?this.gl2.renderbufferStorageMultisample(w.GL.RENDERBUFFER,i,this.glFormat,n,r):this.gl.renderbufferStorage(w.GL.RENDERBUFFER,this.glFormat,n,r),this.gl.bindRenderbuffer(w.GL.RENDERBUFFER,null),this.trackAllocatedMemory(n*r*(i||1)*Ze(this.glFormat,this.device.isWebGL2))}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this.trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(w.GL.RENDERBUFFER,e)}}Gt.defaultProps={id:void 0,handle:void 0,userData:void 0,format:void 0,width:1,height:1,samples:0};class Nt extends nt.A{get texture(){return this.colorAttachments[0]}constructor(e,t){super(e,t);const n=null===t.handle;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.gl.bindFramebuffer(w.GL.FRAMEBUFFER,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const t=this.colorAttachments[e],n=w.GL.COLOR_ATTACHMENT0+e;t&&this._attachOne(n,t)}this.depthStencilAttachment&&this._attachOne(function(e){const t=Xe[e];if(null==t||!t.attachment)throw new Error(e+" is not a depth stencil format");return t.attachment}(this.depthStencilAttachment.format),this.depthStencilAttachment),this.gl.bindFramebuffer(w.GL.FRAMEBUFFER,null)}!1!==t.check&&this._checkStatus()}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}_checkStatus(){const{gl:e}=this,t=e.bindFramebuffer(w.GL.FRAMEBUFFER,this.handle),n=e.checkFramebufferStatus(w.GL.FRAMEBUFFER);if(e.bindFramebuffer(w.GL.FRAMEBUFFER,t||null),n!==e.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer "+function(e){switch(e){case w.GL.FRAMEBUFFER_COMPLETE:return"success";case w.GL.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Mismatched attachments";case w.GL.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"No attachments";case w.GL.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Height/width mismatch";case w.GL.FRAMEBUFFER_UNSUPPORTED:return"Unsupported or split attachments";case w.GL.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Samples mismatch";default:return""+e}}(n))}createDepthStencilTexture(e){return new Gt(this.device,{id:this.id+"-depth-stencil",format:e,width:this.width,height:this.height})}resizeAttachments(e,t){if(null===this.handle)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.resize({width:e,height:t});return this.depthStencilAttachment&&this.depthStencilAttachment.resize({width:e,height:t}),this}_attachOne(e,t){if(t instanceof Gt)return this._attachWEBGLRenderbuffer(e,t),t;if(Array.isArray(t)){const[n,r=0,i=0]=t;return this._attachTexture(e,n,r,i),n}if(t instanceof Tt)return this._attachTexture(e,t,0,0),t;throw new Error("attach")}_attachWEBGLRenderbuffer(e,t){this.gl.framebufferRenderbuffer(w.GL.FRAMEBUFFER,e,w.GL.RENDERBUFFER,t.handle)}_attachTexture(e,t,n,r){const{gl:i,gl2:s}=this.device;switch(i.bindTexture(t.target,t.handle),t.target){case w.GL.TEXTURE_2D_ARRAY:case w.GL.TEXTURE_3D:this.device.assertWebGL2(),null==s||s.framebufferTextureLayer(w.GL.FRAMEBUFFER,e,t.target,r,n);break;case w.GL.TEXTURE_CUBE_MAP:const o=function(e){return e<w.GL.TEXTURE_CUBE_MAP_POSITIVE_X?e+w.GL.TEXTURE_CUBE_MAP_POSITIVE_X:e}(n);i.framebufferTexture2D(w.GL.FRAMEBUFFER,e,o,t.handle,r);break;case w.GL.TEXTURE_2D:i.framebufferTexture2D(w.GL.FRAMEBUFFER,e,w.GL.TEXTURE_2D,t.handle,r);break;default:(0,A.h)(!1,"Illegal texture type")}i.bindTexture(t.target,null)}}class yt extends b{constructor(e,t){super(t),this._framebuffer=null,this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(this.device.id+"-canvas"),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Nt(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(!this.device.gl)return;if(this.canvas){const t=this.getDevicePixelRatio(null==e?void 0:e.useDevicePixels);return void this.setDevicePixelRatio(t,e)}const t=this.device.gl.getExtension("STACKGL_resize_drawingbuffer");t&&e&&"width"in e&&"height"in e&&t.resize(e.width,e.height)}commit(){}}const It={spector:_.c.get("spector")||_.c.get("inspect")};let Mt=null,wt=!1;function xt(e){return e.luma=e.luma||{},e.luma}function Ot(e,t){return void 0===t&&(t={}),e?t.debug?function(e,t){if(!globalThis.WebGLDebugUtils)return _.c.warn("webgl-debug not loaded")(),e;const n=xt(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...w.GL,...e});const r=globalThis.WebGLDebugUtils.makeDebugContext(e,Pt.bind(null,t),Bt.bind(null,t));for(const o in w.GL)o in r||"number"!=typeof w.GL[o]||(r[o]=w.GL[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(e)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=e,n.debugContext=s,s.debug=!0,s}(e,t):function(e){const t=xt(e);return t.realContext?t.realContext:e}(e):null}function Ft(e,t){t=Array.from(t).map((e=>void 0===e?"undefined":e));let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=n.slice(0,100)+(n.length>100?"...":""),"gl."+e+"("+n+")"}function Pt(e,t,n,r){r=Array.from(r).map((e=>void 0===e?"undefined":e));const i=globalThis.WebGLDebugUtils.glEnumToString(t),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=i+" in "+(e.webgl2?"gl2":"gl1")+"."+n+"("+s+")";if(_.c.error(o)(),e.throwOnError)throw new Error(o)}function Bt(e,t,n){let r="";if(_.c.level>=1&&(r=Ft(t,n),_.c.log(1,r)()),e.break&&e.break.length>0){r=r||Ft(t,n);e.break.every((e=>-1!==r.indexOf(e)))}for(const i of n)if(void 0===i){if(r=r||Ft(t,n),e.throwOnError)throw new Error("Undefined argument: "+r);_.c.error("Undefined argument: "+r)()}}function Dt(e,t,n,r){if(null!=r&&r.inlineSource){const r=function(e,t,n){let r="";for(let i=t-2;i<=t;i++){const s=e[i-1];void 0!==s&&(r+=Ut(s,t,n))}return r}(t,n);return"\n"+r+(e.linePos>0?" ".repeat(e.linePos+5)+"^^^\n":"")+e.type.toUpperCase()+": "+e.message+"\n\n"}return null!=r&&r.html?"<div class='luma-compiler-log-error' style=\"color:red;\"><b> "+e.type.toUpperCase()+": "+e.message+"</b></div>":e.type.toUpperCase()+": "+e.message}function Ut(e,t,n){const r=null!=n&&n.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return function(e,t){let n="";for(let r=e.length;r<t;++r)n+=" ";return n+e}(String(t),4)+": "+r+(null!=n&&n.html?"<br/>":"\n")}function kt(e,t){return{name:Vt(e,t),language:"glsl",version:Xt(e)}}function Vt(e,t){void 0===t&&(t="unnamed");const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function Xt(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}return t}let Ht,Wt;Ht=Symbol.toStringTag;class Kt extends pt._{get[Ht](){return"Shader"}constructor(e,t){super(e,{id:Yt(t),...t},Kt.defaultProps),this.compilationStatus="pending",this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}async debugShader(){switch(this.props.debug){case"never":return;case"errors":if("success"===this.compilationStatus)return}const e=await this.getCompilationInfo();"warnings"===this.props.debug&&0===(null==e?void 0:e.length)||this._displayShaderLog(e)}_displayShaderLog(e){var t,n;if("undefined"==typeof document||null==(t=document)||!t.createElement)return;const r=kt(this.source).name,i=this.stage+" "+r,s=function(e,t,n){let r="";const i=t.split(/\r?\n/),s=e.slice().sort(((e,t)=>e.lineNum-t.lineNum));switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=i.length;e++)for(r+=Ut(i[e-1],e,n);s.length>t&&s[t].lineNum===e;){const e=s[t++];r+=Dt(e,i,e.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const s of e)r+=Dt(s,i,s.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return r}}(e,this.source,{showSourceCode:"all",html:!0}),o=document.createElement("Button");o.innerHTML="\n<h1>Shader Compilation Error in "+i+'</h1><br /><br />\n<code style="user-select:text;"><pre>\n'+s+"\n</pre></code>",o.style.top="10px",o.style.left="10px",o.style.position="absolute",o.style.zIndex="9999",o.style.width="100%",o.style.textAlign="left",document.body.appendChild(o);const a=document.getElementsByClassName("luma-compiler-log-error");null!=(n=a[0])&&n.scrollIntoView&&a[0].scrollIntoView(),o.onclick=()=>{const e="data:text/plain,"+encodeURIComponent(this.source);navigator.clipboard.writeText(e)}}}function Yt(e){return kt(e.source).name||e.id||(0,E.hQ)("unnamed "+e.stage+"-shader")}function zt(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}Kt.defaultProps={...pt._.defaultProps,language:"auto",stage:"vertex",source:"",sourceMap:null,entryPoint:"main",debug:"errors"};class jt extends Kt{constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(w.GL.VERTEX_SHADER);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(w.GL.FRAGMENT_SHADER);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return this.getCompilationInfoSync()}getCompilationInfoSync(){return function(e){const t=e.split(/\r?\n/),n=[];for(const r of t){if(r.length<=1)continue;const e=r.split(":");if(2===e.length){const[t,r]=e;n.push({message:r.trim(),type:zt(t),lineNum:0,linePos:0});continue}const[t,i,s,...o]=e;let a=parseInt(s,10);isNaN(a)&&(a=0);let l=parseInt(i,10);isNaN(l)&&(l=0),n.push({message:o.join(":").trim(),type:zt(t),lineNum:a,linePos:l})}return n}(this.device.gl.getShaderInfoLog(this.handle))}_compile(e){e=(e=>e.startsWith("#version ")?e:"#version 100\n"+e)(e);const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),this.compilationStatus=t.getShaderParameter(this.handle,w.GL.COMPILE_STATUS)?"success":"error",this.debugShader(),"error"===this.compilationStatus)throw new Error("GLSL compilation errors in "+this.props.stage+" shader "+this.props.id)}}Wt=Symbol.toStringTag;class Zt extends pt._{get[Wt](){return"RenderPass"}constructor(e,t){super(e,t,Zt.defaultProps)}}Zt.defaultProps={...pt._.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1};const qt=6144;class Qt extends Zt{constructor(e,t){super(e,t),this.device=e,de(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){fe(this.device.gl),this.props.framebuffer&&le(this.device,{framebuffer:null})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e){void 0===e&&(e={});const t={};this.props.framebuffer&&(t.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[w.GL.RASTERIZER_DISCARD]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),t.scissorTest=Boolean(e.scissorRect),e.scissorRect&&(t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[w.GL.STENCIL_REF]=e.stencilReference),this.glParameters=t,le(this.device,t)}clear(){const e={...this.glParameters};let t=0;!1!==this.props.clearColor&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&st(this.device,e,(()=>{this.device.gl.clear(t)}))}clearColorBuffer(e,t){void 0===e&&(e=0),void 0===t&&(t=[0,0,0,0]),st(this.device.gl2,{framebuffer:this.props.framebuffer},(()=>{switch(t.constructor){case Int32Array:this.device.gl2.clearBufferiv(qt,e,t);break;case Uint32Array:this.device.gl2.clearBufferuiv(qt,e,t);break;case Float32Array:default:this.device.gl2.clearBufferfv(qt,e,t)}}))}}var $t=n(918);var Jt=n(6054),en=n(8404);var tn=n(3040);const nn={offset:0,stride:0,type:w.GL.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},rn={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class sn{static getBytesPerElement(e){return(0,tn.vN)(e.type||w.GL.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(e){(0,A.h)(e.size);return(0,tn.vN)(e.type||w.GL.FLOAT).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new sn(...[nn,...t])}constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>this._assign(e))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return sn.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return sn.getBytesPerVertex(this)}_assign(e){return void 0===e&&(e={}),void 0!==(e=function(e,t,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in t){const t=r[a]?e+"."+r[a]:"N/A";_.c.removed(e+"."+a,t)()}for(const a in i)if(a in t){const t=i[a];_.c.deprecated(e+"."+a,e+"."+t)()}let o=null;for(const[a,l]of Object.entries(s))a in t&&(_.c.deprecated(e+"."+a,e+"."+l)(),o=o||Object.assign({},t),o[l]=t[a],delete o[a]);return o||t}("Accessor",e,rn)).type&&(this.type=e.type,e.type!==w.GL.INT&&e.type!==w.GL.UNSIGNED_INT||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalize&&(this.normalized=e.normalize),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),void 0===this.offset&&delete this.offset,void 0===this.stride&&delete this.stride,void 0===this.type&&delete this.type,void 0===this.size&&delete this.size,void 0===this.divisor&&delete this.divisor,void 0===this.normalized&&delete this.normalized,void 0===this.integer&&delete this.integer,void 0===this.buffer&&delete this.buffer,void 0===this.index&&delete this.index,this}}const on=[w.GL.SAMPLER_2D,w.GL.SAMPLER_CUBE,w.GL.SAMPLER_3D,w.GL.SAMPLER_2D_SHADOW,w.GL.SAMPLER_2D_ARRAY,w.GL.SAMPLER_2D_ARRAY_SHADOW,w.GL.SAMPLER_CUBE_SHADOW,w.GL.INT_SAMPLER_2D,w.GL.INT_SAMPLER_3D,w.GL.INT_SAMPLER_CUBE,w.GL.INT_SAMPLER_2D_ARRAY,w.GL.UNSIGNED_INT_SAMPLER_2D,w.GL.UNSIGNED_INT_SAMPLER_3D,w.GL.UNSIGNED_INT_SAMPLER_CUBE,w.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY],an={[w.GL.FLOAT]:[w.GL.FLOAT,1,"float","f32","float32"],[w.GL.FLOAT_VEC2]:[w.GL.FLOAT,2,"vec2","vec2<f32>","float32x2"],[w.GL.FLOAT_VEC3]:[w.GL.FLOAT,3,"vec3","vec3<f32>","float32x3"],[w.GL.FLOAT_VEC4]:[w.GL.FLOAT,4,"vec4","vec4<f32>","float32x4"],[w.GL.INT]:[w.GL.INT,1,"int","i32","sint32"],[w.GL.INT_VEC2]:[w.GL.INT,2,"ivec2","vec2<i32>","sint32x2"],[w.GL.INT_VEC3]:[w.GL.INT,3,"ivec3","vec3<i32>","sint32x3"],[w.GL.INT_VEC4]:[w.GL.INT,4,"ivec4","vec4<i32>","sint32x4"],[w.GL.UNSIGNED_INT]:[w.GL.UNSIGNED_INT,1,"uint","u32","uint32"],[w.GL.UNSIGNED_INT_VEC2]:[w.GL.UNSIGNED_INT,2,"uvec2","vec2<u32>","uint32x2"],[w.GL.UNSIGNED_INT_VEC3]:[w.GL.UNSIGNED_INT,3,"uvec3","vec3<u32>","uint32x3"],[w.GL.UNSIGNED_INT_VEC4]:[w.GL.UNSIGNED_INT,4,"uvec4","vec4<u32>","uint32x4"],[w.GL.BOOL]:[w.GL.FLOAT,1,"bool","f32","float32"],[w.GL.BOOL_VEC2]:[w.GL.FLOAT,2,"bvec2","vec2<f32>","float32x2"],[w.GL.BOOL_VEC3]:[w.GL.FLOAT,3,"bvec3","vec3<f32>","float32x3"],[w.GL.BOOL_VEC4]:[w.GL.FLOAT,4,"bvec4","vec4<f32>","float32x4"],[w.GL.FLOAT_MAT2]:[w.GL.FLOAT,8,"mat2","mat2x2<f32>"],[w.GL.FLOAT_MAT2x3]:[w.GL.FLOAT,8,"mat2x3","mat2x3<f32>"],[w.GL.FLOAT_MAT2x4]:[w.GL.FLOAT,8,"mat2x4","mat2x4<f32>"],[w.GL.FLOAT_MAT3x2]:[w.GL.FLOAT,12,"mat3x2","mat3x2<f32>"],[w.GL.FLOAT_MAT3]:[w.GL.FLOAT,12,"mat3","mat3x3<f32>"],[w.GL.FLOAT_MAT3x4]:[w.GL.FLOAT,12,"mat3x4","mat3x4<f32>"],[w.GL.FLOAT_MAT4x2]:[w.GL.FLOAT,16,"mat4x2","mat4x2<f32>"],[w.GL.FLOAT_MAT4x3]:[w.GL.FLOAT,16,"mat4x3","mat4x3<f32>"],[w.GL.FLOAT_MAT4]:[w.GL.FLOAT,16,"mat4","mat4x4<f32>"]};function ln(e){const t=an[e];if(!t)throw new Error("uniform");const[n,r,,i]=t;return{format:i,components:r,glType:n}}function cn(e){const t=an[e];if(!t)throw new Error("attribute");const[,n,,r,i]=t;return{attributeType:r,vertexFormat:i,components:n}}function un(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i);if(!r)throw new Error("activeInfo");const{name:s,type:o}=r,a=e.getAttribLocation(t,s);if(a>=0){const{attributeType:e}=cn(o),t=/instance/i.test(s)?"instance":"vertex";n.push({name:s,location:a,stepMode:t,type:e})}}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);const r=function(e,t){if(!O(e))return[];const n=e,r=(e,r)=>n.getActiveUniformBlockParameter(t,e,r),i=[],s=n.getProgramParameter(t,w.GL.ACTIVE_UNIFORM_BLOCKS);for(let o=0;o<s;o++){const e={name:n.getActiveUniformBlockName(t,o)||"",location:r(o,w.GL.UNIFORM_BLOCK_BINDING),byteLength:r(o,w.GL.UNIFORM_BLOCK_DATA_SIZE),vertex:r(o,w.GL.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),fragment:r(o,w.GL.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),uniformCount:r(o,w.GL.UNIFORM_BLOCK_ACTIVE_UNIFORMS),uniforms:[]},s=r(o,w.GL.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)||[],a=n.getActiveUniforms(t,s,w.GL.UNIFORM_TYPE),l=n.getActiveUniforms(t,s,w.GL.UNIFORM_SIZE),c=n.getActiveUniforms(t,s,w.GL.UNIFORM_OFFSET),u=n.getActiveUniforms(t,s,w.GL.UNIFORM_ARRAY_STRIDE);for(let r=0;r<e.uniformCount;++r){const i=n.getActiveUniform(t,s[r]);if(!i)throw new Error("activeInfo");e.uniforms.push({name:i.name,format:ln(a[r]).format,type:a[r],arrayLength:l[r],byteOffset:c[r],byteStride:u[r]})}i.push(e)}return i.sort(((e,t)=>e.location-t.location)),i}(e,t);for(const l of r){const e=l.uniforms.map((e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength})));n.bindings.push({type:"uniform",name:l.name,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:e})}const i=function(e,t){const n=[],r=e.getProgramParameter(t,w.GL.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const r=e.getActiveUniform(t,i);if(!r)throw new Error("activeInfo");const{name:s,size:o,type:a}=r,{name:l,isArray:c}=dn(s);let u=e.getUniformLocation(t,l);const _={location:u,name:l,size:o,type:a,isArray:c};if(n.push(_),_.size>1)for(let i=0;i<_.size;i++){const r=l+"["+i+"]";u=e.getUniformLocation(t,r);const s={..._,name:r,location:u};n.push(s)}}return n}(e,t);let s=0;for(const l of i)if(o=l.type,on.includes(o)){const{viewDimension:e,sampleType:t}=hn(l.type);n.bindings.push({type:"texture",name:l.name,location:s,viewDimension:e,sampleType:t}),l.textureUnit=s,s+=1}var o;i.length&&(n.uniforms=i);const a=function(e,t){if(!O(e))return[];const n=e,r=[],i=e.getProgramParameter(t,w.GL.TRANSFORM_FEEDBACK_VARYINGS);for(let s=0;s<i;s++){const e=n.getTransformFeedbackVarying(t,s);if(!e)throw new Error("activeInfo");const{name:i,type:o,size:a}=e,{glType:l,components:c}=ln(o),u={location:s,name:i,accessor:new sn({type:l,size:a*c})};r.push(u)}return r.sort(((e,t)=>e.location-t.location)),r}(e,t);return null!=a&&a.length&&(n.varyings=a),n}const _n={[w.GL.SAMPLER_2D]:["2d","float"],[w.GL.SAMPLER_CUBE]:["cube","float"],[w.GL.SAMPLER_3D]:["3d","float"],[w.GL.SAMPLER_2D_SHADOW]:["3d","depth"],[w.GL.SAMPLER_2D_ARRAY]:["2d-array","float"],[w.GL.SAMPLER_2D_ARRAY_SHADOW]:["2d-array","depth"],[w.GL.SAMPLER_CUBE_SHADOW]:["cube","float"],[w.GL.INT_SAMPLER_2D]:["2d","sint"],[w.GL.INT_SAMPLER_3D]:["3d","sint"],[w.GL.INT_SAMPLER_CUBE]:["cube","sint"],[w.GL.INT_SAMPLER_2D_ARRAY]:["2d-array","uint"],[w.GL.UNSIGNED_INT_SAMPLER_2D]:["2d","uint"],[w.GL.UNSIGNED_INT_SAMPLER_3D]:["3d","uint"],[w.GL.UNSIGNED_INT_SAMPLER_CUBE]:["cube","uint"],[w.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY]:["2d-array","uint"]};function hn(e){const t=_n[e];if(!t)throw new Error("sampler");const[n,r]=t;return{viewDimension:n,sampleType:r}}function dn(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name "+e);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function fn(e,t,n,r){const i=e;let s=r;!0===s&&(s=1),!1===s&&(s=0);const o="number"==typeof s?[s]:s;switch(n){case w.GL.SAMPLER_2D:case w.GL.SAMPLER_CUBE:case w.GL.SAMPLER_3D:case w.GL.SAMPLER_2D_SHADOW:case w.GL.SAMPLER_2D_ARRAY:case w.GL.SAMPLER_2D_ARRAY_SHADOW:case w.GL.SAMPLER_CUBE_SHADOW:case w.GL.INT_SAMPLER_2D:case w.GL.INT_SAMPLER_3D:case w.GL.INT_SAMPLER_CUBE:case w.GL.INT_SAMPLER_2D_ARRAY:case w.GL.UNSIGNED_INT_SAMPLER_2D:case w.GL.UNSIGNED_INT_SAMPLER_3D:case w.GL.UNSIGNED_INT_SAMPLER_CUBE:case w.GL.UNSIGNED_INT_SAMPLER_2D_ARRAY:if("number"!=typeof r)throw new Error("samplers must be set to integers");return e.uniform1i(t,r);case w.GL.FLOAT:return e.uniform1fv(t,o);case w.GL.FLOAT_VEC2:return e.uniform2fv(t,o);case w.GL.FLOAT_VEC3:return e.uniform3fv(t,o);case w.GL.FLOAT_VEC4:return e.uniform4fv(t,o);case w.GL.INT:return e.uniform1iv(t,o);case w.GL.INT_VEC2:return e.uniform2iv(t,o);case w.GL.INT_VEC3:return e.uniform3iv(t,o);case w.GL.INT_VEC4:return e.uniform4iv(t,o);case w.GL.BOOL:return e.uniform1iv(t,o);case w.GL.BOOL_VEC2:return e.uniform2iv(t,o);case w.GL.BOOL_VEC3:return e.uniform3iv(t,o);case w.GL.BOOL_VEC4:return e.uniform4iv(t,o);case w.GL.UNSIGNED_INT:return i.uniform1uiv(t,o,1);case w.GL.UNSIGNED_INT_VEC2:return i.uniform2uiv(t,o,2);case w.GL.UNSIGNED_INT_VEC3:return i.uniform3uiv(t,o,3);case w.GL.UNSIGNED_INT_VEC4:return i.uniform4uiv(t,o,4);case w.GL.FLOAT_MAT2:return e.uniformMatrix2fv(t,!1,o);case w.GL.FLOAT_MAT3:return e.uniformMatrix3fv(t,!1,o);case w.GL.FLOAT_MAT4:return e.uniformMatrix4fv(t,!1,o);case w.GL.FLOAT_MAT2x3:return i.uniformMatrix2x3fv(t,!1,o);case w.GL.FLOAT_MAT2x4:return i.uniformMatrix2x4fv(t,!1,o);case w.GL.FLOAT_MAT3x2:return i.uniformMatrix3x2fv(t,!1,o);case w.GL.FLOAT_MAT3x4:return i.uniformMatrix3x4fv(t,!1,o);case w.GL.FLOAT_MAT4x2:return i.uniformMatrix4x2fv(t,!1,o);case w.GL.FLOAT_MAT4x3:return i.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}class En extends $t.h{constructor(e,t){super(e,t),this.uniforms={},this.bindings={},this.varyings=null,this._uniformCount=0,this._uniformSetters={},this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:r=w.GL.SEPARATE_ATTRIBS}=t;var i;n&&n.length>0&&(this.device.assertWebGL2(),this.varyings=n,null==(i=this.device.gl2)||i.transformFeedbackVaryings(this.handle,n,r));switch(this._compileAndLink(),this.introspectedLayout=un(this.device.gl,this.handle),this.shaderLayout=(0,en.uX)(this.introspectedLayout,t.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":_.c.warn("Primitive topology "+this.props.topology+" is deprecated and will be removed in v9.1")}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e){for(const[t,n]of Object.entries(e)){const e=this.shaderLayout.bindings.find((e=>e.name===t))||this.shaderLayout.bindings.find((e=>e.name===t+"Uniforms"));if(e){switch(n||_.c.warn('Unsetting binding "'+t+'" in render pipeline "'+this.id+'"')(),e.type){case"uniform":if(!(n instanceof Et||n.buffer instanceof Et))throw new Error("buffer value");break;case"texture":if(!(n instanceof Tt||n instanceof Nt))throw new Error("texture value");break;case"sampler":_.c.warn("Ignoring sampler "+t)();break;default:throw new Error(e.type)}this.bindings[t]=n}else{const e=this.shaderLayout.bindings.map((e=>'"'+e.name+'"')).join(", ");_.c.warn('Unknown binding "'+t+'" in render pipeline "'+this.id+'", expected one of '+e)()}}}setUniforms(e){const{bindings:t}=(0,Jt.y)(e);Object.keys(t).forEach((e=>{_.c.warn('Unsupported value "'+JSON.stringify(t[e])+'" used in setUniforms() for key '+e+". Use setBindings() instead?")()})),Object.assign(this.uniforms,e)}draw(e){var t;const{renderPass:n,vertexArray:r,vertexCount:i,instanceCount:s,firstVertex:o=0,transformFeedback:a}=e,l=function(e){switch(e){case"point-list":return w.GL.POINTS;case"line-list":return w.GL.LINES;case"line-strip":return w.GL.LINE_STRIP;case"line-loop-webgl":return w.GL.LINE_LOOP;case"triangle-list":return w.GL.TRIANGLES;case"triangle-strip":return w.GL.TRIANGLE_STRIP;case"triangle-fan-webgl":return w.GL.TRIANGLE_FAN;default:throw new Error(e)}}(this.props.topology),c=Boolean(r.indexBuffer),u=null==(t=r.indexBuffer)?void 0:t.glIndexType,_=Number(s)>0;if(!this._areTexturesRenderable()||0===i)return!1;this.device.gl.useProgram(this.handle),r.bindBeforeRender(n),a&&a.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const h=n;return function(e,t,n,r){if((0,E.nK)(t))return r(e);de(e.gl);try{return ot(e,t),le(e,n),r(e)}finally{fe(e.gl)}}(this.device,this.props.parameters,h.glParameters,(()=>{var e;if(c&&_)null==(e=this.device.gl2)||e.drawElementsInstanced(l,i||0,u,o,s||0);else if(c)this.device.gl.drawElements(l,i||0,u,o);else if(_){var t;null==(t=this.device.gl2)||t.drawArraysInstanced(l,o,i||0,s||0)}else this.device.gl.drawArrays(l,o,i||0);a&&a.end()})),r.unbindAfterRender(n),!0}_compileAndLink(){const{gl:e}=this.device;e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),_.c.time(4,"linkProgram for "+this.id)(),e.linkProgram(this.handle),_.c.timeEnd(4,"linkProgram for "+this.id)(),!e.debug&&_.c.level;if(!e.getProgramParameter(this.handle,e.LINK_STATUS))throw new Error("Error linking: "+e.getProgramInfoLog(this.handle));e.validateProgram(this.handle);if(!e.getProgramParameter(this.handle,e.VALIDATE_STATUS))throw new Error("Error validating: "+e.getProgramInfoLog(this.handle))}_areTexturesRenderable(){let e=!0;for(const[,t]of Object.entries(this.bindings))t instanceof Tt&&(t.update(),e=e&&t.loaded);return e}_applyBindings(){this.device.gl.useProgram(this.handle);const{gl2:e}=this.device;if(!e)throw new Error("bindings");let t=0,n=0;for(const r of this.shaderLayout.bindings){const i=this.bindings[r.name]||this.bindings[r.name.replace(/Uniforms$/,"")];if(!i)throw new Error("No value for binding "+r.name+" in "+this.id);switch(r.type){case"uniform":const{name:s}=r,o=e.getUniformBlockIndex(this.handle,s);if(o===w.GL.INVALID_INDEX)throw new Error("Invalid uniform block name "+s);e.uniformBlockBinding(this.handle,n,o),i instanceof Et?e.bindBufferBase(w.GL.UNIFORM_BUFFER,n,i.handle):e.bindBufferRange(w.GL.UNIFORM_BUFFER,n,i.buffer.handle,i.offset||0,i.size||i.buffer.byteLength-i.offset),n+=1;break;case"texture":if(!(i instanceof Tt||i instanceof Nt))throw new Error("texture");let a;if(i instanceof Tt)a=i;else{if(!(i instanceof Nt&&i.colorAttachments[0]instanceof Tt))throw new Error("No texture");_.c.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=i.colorAttachments[0]}e.activeTexture(w.GL.TEXTURE0+t),e.bindTexture(a.target,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error("binding type '"+r.type+"' not supported in WebGL")}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){var e;const{name:n,location:r,type:i,textureUnit:s}=t,o=null!=(e=this.uniforms[n])?e:s;void 0!==o&&fn(this.device.gl,r,i,o)}}}let pn,gn,mn;pn=Symbol.toStringTag;class An extends pt._{get[pn](){return"CommandEncoder"}constructor(e,t){super(e,t,An.defaultProps)}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}}An.defaultProps={...pt._.defaultProps,measureExecutionTime:void 0},gn=Symbol.toStringTag;class Rn extends pt._{get[gn](){return"CommandBuffer"}constructor(e,t){super(e,t,Rn.defaultProps)}}Rn.defaultProps={...pt._.defaultProps};class Tn extends Rn{constructor(e){super(e,{}),this.commands=[],this.device=e}submitCommands(e){void 0===e&&(e=this.commands);for(const t of e)switch(t.name){case"copy-buffer-to-buffer":Ln(this.device,t.options);break;case"copy-buffer-to-texture":vn(this.device,t.options);break;case"copy-texture-to-buffer":Sn(this.device,t.options);break;case"copy-texture-to-texture":bn(this.device,t.options)}}}function Ln(e,t){const n=t.source,r=t.destination,i=e.assertWebGL2();if(!i)throw new Error("copyBufferToBuffer not implemented in WebGL1");var s,o;i.bindBuffer(w.GL.COPY_READ_BUFFER,n.handle),i.bindBuffer(w.GL.COPY_WRITE_BUFFER,r.handle),i.copyBufferSubData(w.GL.COPY_READ_BUFFER,w.GL.COPY_WRITE_BUFFER,null!=(s=t.sourceOffset)?s:0,null!=(o=t.destinationOffset)?o:0,t.size),i.bindBuffer(w.GL.COPY_READ_BUFFER,null),i.bindBuffer(w.GL.COPY_WRITE_BUFFER,null)}function vn(e,t){throw new Error("Not implemented")}function Sn(e,t){const{source:n,mipLevel:r=0,aspect:i="all",width:s=t.source.width,height:o=t.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:_,rowsPerImage:h}=t;if("all"!==i)throw new Error("not supported");if(0!==r||0!==a||_||h)throw new Error("not implemented");const d=e.assertWebGL2(),{framebuffer:f,destroyFramebuffer:E}=Cn(n);try{const e=c,t=s||f.width,n=o||f.height,r=je(f.texture.format,!0),i=r.dataFormat,a=r.type;d.bindBuffer(w.GL.PIXEL_PACK_BUFFER,e.handle),d.bindFramebuffer(w.GL.FRAMEBUFFER,f.handle),d.readPixels(l[0],l[1],t,n,i,a,u)}finally{d.bindBuffer(w.GL.PIXEL_PACK_BUFFER,null),d.bindFramebuffer(w.GL.FRAMEBUFFER,null),E&&f.destroy()}}function bn(e,t){const{source:n,origin:r=[0,0],destination:i}=t;let{width:s=t.destination.width,height:o=t.destination.width}=t;const a=w.GL.RGBA,{framebuffer:l,destroyFramebuffer:c}=Cn(n),[u,_]=r;e.gl.bindFramebuffer(w.GL.FRAMEBUFFER,l.handle);let h,d=null;if(!(i instanceof Tt))throw new Error("whoops");return d=i,s=Number.isFinite(s)?s:d.width,o=Number.isFinite(o)?o:d.height,d.bind(0),h=d.destination,e.gl.copyTexImage2D(h,0,a,u,_,s,o,0),d&&d.unbind(),c&&l.destroy(),d}function Cn(e){if(e instanceof rt.x){const{width:t,height:n,id:r}=e;return{framebuffer:e.device.createFramebuffer({id:"framebuffer-for-"+r,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class Gn extends An{constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new Tn(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}}mn=Symbol.toStringTag;class Nn extends pt._{get[mn](){return"VertexArray"}constructor(e,t){super(e,t,Nn.defaultProps),this.indexBuffer=null,this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=(0,en.TX)(t.renderPipeline.shaderLayout,t.renderPipeline.bufferLayout,this.maxVertexAttributes)}}Nn.defaultProps={...pt._.defaultProps,renderPipeline:null};var yn=n(1536),In=n(3315);let Mn,wn;Mn=Symbol.toStringTag;class xn extends Nn{get[Mn](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"webgl2"===e.info.type||"Chrome"===(0,In.Z)()}constructor(e,t){super(e,t),this.buffer=null,this.bufferValue=null,this.init=!1,this.device=e,this.handle=this.device.gl2.createVertexArray()}destroy(){var e;(super.destroy(),this.buffer)&&(null==(e=this.buffer)||e.destroy());this.handle&&(this.device.gl2.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==w.GL.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setBuffer()");this.device.gl2.bindVertexArray(this.handle),this.device.gl2.bindBuffer(w.GL.ELEMENT_ARRAY_BUFFER,t?t.handle:null),this.indexBuffer=t}setBuffer(e,t){const n=t;if(n.glTarget===w.GL.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setIndexBuffer()");const{size:r,type:i,stride:s,offset:o,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl2.bindVertexArray(this.handle),this.device.gl.bindBuffer(w.GL.ARRAY_BUFFER,n.handle),l?(this.device.assertWebGL2(),this.device.gl2.vertexAttribIPointer(e,r,i,s,o)):this.device.gl.vertexAttribPointer(e,r,i,a,s,o),this.device.gl.enableVertexAttribArray(e),this.device.gl2.vertexAttribDivisor(e,c||0),this.attributes[e]=n}setConstant(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){if(this.device.gl2.bindVertexArray(this.handle),!this.init){const e=this.indexBuffer;this.device.gl2.bindBuffer(w.GL.ELEMENT_ARRAY_BUFFER,(null==e?void 0:e.handle)||null),this.init=!0}this._applyConstantAttributes()}unbindAfterRender(){this.device.gl2.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttribute(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error("Unknown attribute location "+e);const n=Ce(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t){void 0===t&&(t=!0);const n=xn.isConstantAttributeZeroSupported(this.device);(t||(n||0!==e))&&(e=Number(e),this.device.gl2.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl2.bindVertexArray(null))}getConstantBuffer(e,t){const n=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),r=n.byteLength*e,i=n.length*e;if(this.buffer&&r!==this.buffer.byteLength)throw new Error("Buffer size is immutable, byte length "+r+" !== "+this.buffer.byteLength+".");let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:r}),s=s||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue),s){const e=(0,yn.FD)(t.constructor,i);(0,yn.kg)({target:e,source:n,start:0,count:i}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}wn=Symbol.toStringTag;class On extends pt._{get[wn](){return"TransformFeedback"}constructor(e,t){super(e,t,On.defaultProps)}}On.defaultProps={...pt._.defaultProps,layout:void 0,buffers:{}};class Fn extends On{constructor(e,t){super(e,t),this.buffers={},this.unusedBuffers={},this.bindOnUse=!0,this._bound=!1,e.assertWebGL2(),this.device=e,this.gl2=e.gl2,this.handle=this.props.handle||this.gl2.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl2.deleteTransformFeedback(this.handle),super.destroy()}begin(e){void 0===e&&(e="point-list"),this.gl2.bindTransformFeedback(w.GL.TRANSFORM_FEEDBACK,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl2.beginTransformFeedback(function(e){switch(e){case"point-list":return w.GL.POINTS;case"line-list":case"line-strip":case"line-loop-webgl":return w.GL.LINES;case"triangle-list":case"triangle-strip":case"triangle-fan-webgl":return w.GL.TRIANGLES;default:throw new Error(e)}}(e))}end(){this.gl2.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl2.bindTransformFeedback(w.GL.TRANSFORM_FEEDBACK,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind((()=>{for(const t in e)this.setBuffer(t,e[t])}))}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=r,void _.c.warn(this.id+" unusedBuffers varying buffer "+e)();this.buffers[n]={buffer:r,byteLength:i,byteOffset:s},this.bindOnUse||this._bindBuffer(n,r,s,i)}getBuffer(e){if(Pn(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e){if(void 0===e&&(e=this.handle),"function"!=typeof e)return this.gl2.bindTransformFeedback(w.GL.TRANSFORM_FEEDBACK,e),this;let t;return this._bound?t=e():(this.gl2.bindTransformFeedback(w.GL.TRANSFORM_FEEDBACK,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl2.bindTransformFeedback(w.GL.TRANSFORM_FEEDBACK,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Et)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:r=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:r}}_getVaryingIndex(e){if(Pn(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:r}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,r,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl2.bindBufferBase(w.GL.TRANSFORM_FEEDBACK_BUFFER,Number(e),null)}_bindBuffer(e,t,n,r){void 0===n&&(n=0);const i=t&&t.handle;i&&void 0!==r?this.gl2.bindBufferRange(w.GL.TRANSFORM_FEEDBACK_BUFFER,e,i,n,r):this.gl2.bindBufferBase(w.GL.TRANSFORM_FEEDBACK_BUFFER,e,i)}}function Pn(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}var Bn=n(343);class Dn extends m{static isSupported(){return"undefined"!=typeof WebGLRenderingContext||null!==Ae}get features(){return this._features=this._features||Qe(this.gl),this._features}get limits(){return this._limits=this._limits||function(e){const t=F(e);return{maxTextureDimension1D:0,maxTextureDimension2D:e.getParameter(w.GL.MAX_TEXTURE_SIZE),maxTextureDimension3D:t?t.getParameter(w.GL.MAX_3D_TEXTURE_SIZE):0,maxTextureArrayLayers:t?t.getParameter(w.GL.MAX_ARRAY_TEXTURE_LAYERS):0,maxBindGroups:1,maxDynamicUniformBuffersPerPipelineLayout:0,maxDynamicStorageBuffersPerPipelineLayout:0,maxSampledTexturesPerShaderStage:e.getParameter(w.GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxSamplersPerShaderStage:e.getParameter(w.GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxStorageBuffersPerShaderStage:0,maxStorageTexturesPerShaderStage:0,maxUniformBuffersPerShaderStage:t?t.getParameter(w.GL.MAX_UNIFORM_BUFFER_BINDINGS):0,maxUniformBufferBindingSize:t?t.getParameter(w.GL.MAX_UNIFORM_BLOCK_SIZE):0,maxStorageBufferBindingSize:0,minUniformBufferOffsetAlignment:t?t.getParameter(w.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT):0,minStorageBufferOffsetAlignment:0,maxVertexBuffers:0,maxVertexAttributes:e.getParameter(w.GL.MAX_VERTEX_ATTRIBS),maxVertexBufferArrayStride:2048,maxInterStageShaderComponents:t?t.getParameter(w.GL.MAX_VARYING_COMPONENTS):0,maxComputeWorkgroupStorageSize:0,maxComputeInvocationsPerWorkgroup:0,maxComputeWorkgroupSizeX:0,maxComputeWorkgroupSizeY:0,maxComputeWorkgroupSizeZ:0,maxComputeWorkgroupsPerDimension:0}}(this.gl),this._limits}static attach(e){if(e instanceof Dn)return e;if((null==e?void 0:e.device)instanceof m)return e.device;if(!function(e){if("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext)return!0;if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGLRenderingContext");return new Dn({gl:e})}static async create(e){void 0===e&&(e={}),_.c.groupCollapsed(1,"WebGLDevice created")(),"string"==typeof e.canvas&&await b.pageLoaded,(_.c.get("debug")||e.debug)&&await async function(){(0,u.Z)()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await(0,it.ve)("https://unpkg.com/webgl-debug@2.0.1/index.js"))}();const{spector:t}=e;if((_.c.get("spector")||t)&&await async function(e){if(!globalThis.SPECTOR)try{await(0,it.ve)("https://spectorcdn.babylonjs.com/spector.bundle.js")}catch(t){_.c.warn(String(t))}}(),_.c.probe(2,"DOM is loaded")(),e.gl&&e.gl.device)return Dn.attach(e.gl);const n=new Dn(e),r="Created "+n.info.type+(n.debug?" debug":"")+" context: "+n.info.vendor+", "+n.info.renderer+" for canvas: "+n.canvasContext.id;return _.c.probe(1,r)(),_.c.table(1,n.info)(),_.c.groupEnd(1)(),n}constructor(e){var t,n;super({...e,id:e.id||(0,E.hQ)("webgl-device")}),this.renderPass=null,this.gl2=null,this.debug=!1,this._canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1},this._extensions={},this._polyfilled=!1;const r=null==(t=e.gl)?void 0:t.device;if(r)throw new Error("WebGL context already attached to device "+r.id);const i=e.canvas||(null==(n=e.gl)?void 0:n.canvas);this.canvasContext=new yt(this,{...e,canvas:i}),this.lost=new Promise((e=>{this._resolveContextLost=e}));const s=e=>{var t;return null==(t=this._resolveContextLost)?void 0:t.call(this,{reason:"destroyed",message:"Computer entered sleep mode, or too many apps or browser tabs are using the GPU."})};let o=e.gl||null;if(o=o||((0,u.Z)()?function(e,t){t={...ge,...t};let n=null;const r=e=>n=e.statusMessage||n;e.addEventListener("webglcontextcreationerror",r,!1);let i=null;if("webgl2"===t.type&&(t={...t,webgl1:!1}),"webgl1"===t.type&&(t={...t,webgl2:!1}),!i&&t.webgl2&&(i=e.getContext("webgl2",t)),!i&&t.webgl1&&(i=e.getContext("webgl",t)),e.removeEventListener("webglcontextcreationerror",r,!1),!i)throw new Error("Failed to create "+(t.webgl2&&!t.webgl1?"WebGL2":"WebGL")+" context: "+(n||"Unknown error"));if(t.onContextLost){const{onContextLost:n}=t;e.addEventListener("webglcontextlost",(e=>n(e)),!1)}if(t.onContextRestored){const{onContextRestored:n}=t;e.addEventListener("webglcontextrestored",(e=>n(e)),!1)}return i}(this.canvasContext.canvas,{...e,onContextLost:s}):null),o=o||((0,u.Z)()?null:function(e){e={...me,...e};const{width:t,height:n,webgl1:r,webgl2:i}=e;if(i&&!r)throw new Error("headless-gl does not support WebGL2");if(!Ae)throw new Error("  luma.gl: loaded under Node.js without headless gl installed, meaning that WebGL   contexts can not be created. This may not be an error. For example, this is a   typical configuration for isorender applications running on the server.");const s=Ae(t,n,e);if(!s)throw new Error("Failed to create WebGL context in Node.js, headless gl returned null");return s}({...e,onContextLost:s})),!o)throw new Error("WebGL context creation failed");this.handle=o,this.gl=this.handle,this.gl2=this.gl,this.isWebGL2=function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&2===e._version)}(this.gl),this.isWebGL1=!this.isWebGL2,this.canvasContext.resize(),this.info=Re(this.gl),this.gl.device=this,this.gl._version=this.isWebGL2?2:1,Y(this.gl);const{enable:a=!0,copyState:l=!1}=e;if(he(this.gl,{enable:a,copyState:l,log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return _.c.log(1,...t)()}}),(0,u.Z)()&&e.debug&&(this.gl=Ot(this.gl,{...e,webgl2:this.isWebGL2,throwOnError:!0}),this.gl2=this.gl,this.debug=!0,_.c.level=Math.max(_.c.level,1),_.c.warn("WebGL debug mode activated. Performance reduced.")()),(0,u.Z)()&&e.spector){const t=this.handle.canvas||e.canvas;this.spector=function(e){var t,n,r,i;if(null==(t=e={...It,...e})||!t.spector)return null;if(!Mt&&globalThis.SPECTOR&&(_.c.probe(1,"SPECTOR found and initialized")(),Mt=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=Mt)),!Mt)return null;if(wt||(wt=!0,Mt.spyCanvases(),null==(r=Mt)||r.onCaptureStarted.add((e=>_.c.info("Spector capture started:",e)())),null==(i=Mt)||i.onCapture.add((e=>{var t,n,r;_.c.info("Spector capture complete:",e)(),null==(t=Mt)||t.getResultUI(),null==(n=Mt)||n.resultView.display(),null==(r=Mt)||r.resultView.addCapture(e)}))),null!=(n=e)&&n.canvas){var s,o;if("string"==typeof e.spector&&e.spector!==e.canvas.id)return Mt;null==(s=Mt)||s.startCapture(null==(o=e)?void 0:o.canvas,500),new Promise((e=>setTimeout(e,2e3))).then((e=>{var t;_.c.info("Spector capture stopped after 2 seconds")(),null==(t=Mt)||t.stopCapture()}))}return Mt}({...this.props,canvas:t})}}destroy(){const e=this.gl.getExtension("STACKGL_destroy_context");e&&e.destroy()}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return Ke(this.gl,e)}isTextureFormatFilterable(e){return function(e,t){const n=Ye(t);if(!Ke(e,n))return!1;try{if(Se(n).signed)return!1}catch{return!1}return n.endsWith("32float")?Boolean(e.getExtension("OES_texture_float_linear")):!n.endsWith("16float")||Boolean(e.getExtension("OES_texture_half_float_linear"))}(this.gl,e)}isTextureFormatRenderable(e){return function(e,t){const n=Ye(t);return!!Ke(e,n)&&"number"!=typeof n}(this.gl,e)}assertWebGL2(){if(!this.gl2)throw new Error("Requires WebGL2");return this.gl2}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._getBufferProps(e);return new Et(this,t)}_createTexture(e){return new Tt(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new At(this,e)}createShader(e){return new jt(this,e)}createFramebuffer(e){return new Nt(this,e)}createRenderPipeline(e){return new En(this,e)}createVertexArray(e){return new xn(this,e)}beginRenderPass(e){return new Qt(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}createTransformFeedback(e){return new Fn(this,e)}getDefaultRenderPass(){return this.renderPass=this.renderPass||this.beginRenderPass({framebuffer:this.canvasContext.getCurrentFramebuffer()}),this.renderPass}createCommandEncoder(e){return new Gn(this,e)}submit(){var e;null==(e=this.renderPass)||e.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return(0,Bn.z6)(e,t)}readPixelsToBufferWebGL2(e,t){return(0,Bn.Jb)(e,t)}get webglLimits(){return this._webglLimits=this._webglLimits||function(e){const t=F(e);function n(t){return e.getParameter(t)}function r(e,n){return t?t.getParameter(e):n||0}return{[w.GL.ALIASED_LINE_WIDTH_RANGE]:n(w.GL.ALIASED_LINE_WIDTH_RANGE),[w.GL.ALIASED_POINT_SIZE_RANGE]:n(w.GL.ALIASED_POINT_SIZE_RANGE),[w.GL.MAX_TEXTURE_SIZE]:n(w.GL.MAX_TEXTURE_SIZE),[w.GL.MAX_CUBE_MAP_TEXTURE_SIZE]:n(w.GL.MAX_CUBE_MAP_TEXTURE_SIZE),[w.GL.MAX_TEXTURE_IMAGE_UNITS]:n(w.GL.MAX_TEXTURE_IMAGE_UNITS),[w.GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS]:n(w.GL.MAX_COMBINED_TEXTURE_IMAGE_UNITS),[w.GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS]:n(w.GL.MAX_VERTEX_TEXTURE_IMAGE_UNITS),[w.GL.MAX_RENDERBUFFER_SIZE]:n(w.GL.MAX_RENDERBUFFER_SIZE),[w.GL.MAX_VARYING_VECTORS]:n(w.GL.MAX_VARYING_VECTORS),[w.GL.MAX_VERTEX_ATTRIBS]:n(w.GL.MAX_VERTEX_ATTRIBS),[w.GL.MAX_VERTEX_UNIFORM_VECTORS]:n(w.GL.MAX_VERTEX_UNIFORM_VECTORS),[w.GL.MAX_FRAGMENT_UNIFORM_VECTORS]:n(w.GL.MAX_FRAGMENT_UNIFORM_VECTORS),[w.GL.MAX_VIEWPORT_DIMS]:n(w.GL.MAX_VIEWPORT_DIMS),[w.GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT]:n(w.GL.MAX_TEXTURE_MAX_ANISOTROPY_EXT),[w.GL.MAX_3D_TEXTURE_SIZE]:r(w.GL.MAX_3D_TEXTURE_SIZE),[w.GL.MAX_ARRAY_TEXTURE_LAYERS]:r(w.GL.MAX_ARRAY_TEXTURE_LAYERS),[w.GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL]:r(w.GL.MAX_CLIENT_WAIT_TIMEOUT_WEBGL),[w.GL.MAX_COLOR_ATTACHMENTS]:r(w.GL.MAX_COLOR_ATTACHMENTS),[w.GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS]:r(w.GL.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS),[w.GL.MAX_COMBINED_UNIFORM_BLOCKS]:r(w.GL.MAX_COMBINED_UNIFORM_BLOCKS),[w.GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS]:r(w.GL.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS),[w.GL.MAX_DRAW_BUFFERS]:r(w.GL.MAX_DRAW_BUFFERS),[w.GL.MAX_ELEMENT_INDEX]:r(w.GL.MAX_ELEMENT_INDEX),[w.GL.MAX_ELEMENTS_INDICES]:r(w.GL.MAX_ELEMENTS_INDICES),[w.GL.MAX_ELEMENTS_VERTICES]:r(w.GL.MAX_ELEMENTS_VERTICES),[w.GL.MAX_FRAGMENT_INPUT_COMPONENTS]:r(w.GL.MAX_FRAGMENT_INPUT_COMPONENTS),[w.GL.MAX_FRAGMENT_UNIFORM_BLOCKS]:r(w.GL.MAX_FRAGMENT_UNIFORM_BLOCKS),[w.GL.MAX_FRAGMENT_UNIFORM_COMPONENTS]:r(w.GL.MAX_FRAGMENT_UNIFORM_COMPONENTS),[w.GL.MAX_SAMPLES]:r(w.GL.MAX_SAMPLES),[w.GL.MAX_SERVER_WAIT_TIMEOUT]:r(w.GL.MAX_SERVER_WAIT_TIMEOUT),[w.GL.MAX_TEXTURE_LOD_BIAS]:r(w.GL.MAX_TEXTURE_LOD_BIAS),[w.GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS]:r(w.GL.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS),[w.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS]:r(w.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS),[w.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS]:r(w.GL.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS),[w.GL.MAX_UNIFORM_BLOCK_SIZE]:r(w.GL.MAX_UNIFORM_BLOCK_SIZE),[w.GL.MAX_UNIFORM_BUFFER_BINDINGS]:r(w.GL.MAX_UNIFORM_BUFFER_BINDINGS),[w.GL.MAX_VARYING_COMPONENTS]:r(w.GL.MAX_VARYING_COMPONENTS),[w.GL.MAX_VERTEX_OUTPUT_COMPONENTS]:r(w.GL.MAX_VERTEX_OUTPUT_COMPONENTS),[w.GL.MAX_VERTEX_UNIFORM_BLOCKS]:r(w.GL.MAX_VERTEX_UNIFORM_BLOCKS),[w.GL.MAX_VERTEX_UNIFORM_COMPONENTS]:r(w.GL.MAX_VERTEX_UNIFORM_COMPONENTS),[w.GL.MIN_PROGRAM_TEXEL_OFFSET]:r(w.GL.MIN_PROGRAM_TEXEL_OFFSET),[w.GL.MAX_PROGRAM_TEXEL_OFFSET]:r(w.GL.MAX_PROGRAM_TEXEL_OFFSET),[w.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT]:r(w.GL.UNIFORM_BUFFER_OFFSET_ALIGNMENT)}}(this.gl),this._webglLimits}loseDevice(){var e;let t=!1;const n=this.gl.getExtension("WEBGL_lose_context");return n&&(t=!0,n.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){de(this.gl)}popState(){fe(this.gl)}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){t=t||this.gl2||this.gl;const n=Number(e);for(const r in t)if(t[r]===n)return"GL."+r;return String(e)}setConstantAttribute(e,t){this._constants=this._constants||new Array(this.limits.maxVertexAttributes).fill(null);const n=this._constants[e];switch(n&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,t)&&_.c.info(1,"setConstantAttribute("+e+") could have been skipped, value unchanged")(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n);break;default:(0,A.h)(!1)}}(this,e,t);break;case Int32Array:!function(e,t,n){var r;e.assertWebGL2(),null==(r=e.gl2)||r.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){var r;e.assertWebGL2(),null==(r=e.gl2)||r.vertexAttribI4uiv(t,n)}(this,e,t);break;default:(0,A.h)(!1)}}}Dn.type="webgl";class Un extends p.l{constructor(e,t){super(e,t),this.device=e,this.byteLength=function(e){var t;return e.byteLength||(null==(t=e.data)?void 0:t.byteLength)||0}(t);const n=Boolean(t.data),r=4*Math.ceil(this.byteLength/4);this.handle=this.props.handle||this.device.handle.createBuffer({size:r,usage:this.props.usage||GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:this.props.mappedAtCreation||n,label:this.props.id}),t.data&&this._writeMapped(t.data),n&&!t.mappedAtCreation&&this.handle.unmap()}destroy(){this.handle.destroy()}write(e,t){void 0===t&&(t=0),this.device.handle.queue.writeBuffer(this.handle,t,e.buffer,e.byteOffset,e.byteLength)}async readAsync(e,t){void 0===e&&(e=0),void 0===t&&(t=this.byteLength);const n=new Un(this.device,{usage:p.l.MAP_READ|p.l.COPY_DST,byteLength:t}),r=this.device.handle.createCommandEncoder();r.copyBufferToBuffer(this.handle,e,n.handle,0,t),this.device.handle.queue.submit([r.finish()]),await n.handle.mapAsync(GPUMapMode.READ,e,t);const i=n.handle.getMappedRange().slice(0);return n.handle.unmap(),n.destroy(),new Uint8Array(i)}_writeMapped(e){const t=this.handle.getMappedRange();new e.constructor(t).set(e)}mapAsync(e,t,n){return void 0===t&&(t=0),this.handle.mapAsync(e,t,n)}getMappedRange(e,t){return void 0===e&&(e=0),this.handle.getMappedRange(e,t)}unmap(){this.handle.unmap()}}function kn(e){if(e.includes("webgl"))throw new Error("webgl-only format");return e}class Vn extends mt{constructor(e,t){super(e,t),this.device=e;const n={...this.props};"comparison-sampler"!==n.type&&delete n.compare,this.handle=this.handle||this.device.handle.createSampler(n),this.handle.label=this.props.id}destroy(){}}const Xn={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Hn extends rt.x{constructor(e,t){super(e,t),this.height=1,this.width=1,this.device=e,t.data instanceof Promise?t.data.then((e=>{this.props={...t,data:e},this.initialize(this.props)})):this.initialize(t)}initialize(e){var t;this.handle=this.props.handle||this.createHandle(),(t=this.handle).label||(t.label=this.id),this.props.data&&this.setData({data:this.props.data}),this.width=this.handle.width,this.height=this.handle.height,this.sampler=e.sampler instanceof Vn?e.sampler:new Vn(this.device,e.sampler),this.view=this.createView()}createHandle(){var e,t;const n=this.props.width||(null==(e=this.props.data)?void 0:e.width)||1,r=this.props.height||(null==(t=this.props.data)?void 0:t.height)||1;return this.device.handle.createTexture({label:this.id,size:{width:n,height:r,depthOrArrayLayers:this.props.depth},dimension:Xn[this.props.dimension],format:kn(this.props.format),usage:this.props.usage,mipLevelCount:this.props.mipLevels,sampleCount:this.props.samples})}destroy(){this.handle.destroy()}setSampler(e){return this.sampler=e instanceof Vn?e:new Vn(this.device,e),this}setData(e){return this.setImage({source:e.data})}setImage(e){const{source:t,width:n=e.source.width,height:r=e.source.height,depth:i=1,sourceX:s=0,sourceY:o=0,mipLevel:a=0,x:l=0,y:c=0,z:u=0,aspect:_="all",colorSpace:h="srgb",premultipliedAlpha:d=!1}=e;return this.device.handle.queue.copyExternalImageToTexture({source:t,origin:[s,o]},{texture:this.handle,origin:[l,c,u],mipLevel:a,aspect:_,colorSpace:h,premultipliedAlpha:d},[n,r,i]),{width:n,height:r}}createView(){return this.handle.createView({label:this.id})}}let Wn;Wn=Symbol.toStringTag;class Kn extends pt._{get[Wn](){return"ExternalTexture"}constructor(e,t){super(e,t,Kn.defaultProps)}}Kn.defaultProps={...pt._.defaultProps,source:null,colorSpace:"srgb"};class Yn extends Kn{constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.importExternalTexture({source:t.source,colorSpace:t.colorSpace}),this.sampler=null}destroy(){}setSampler(e){return this.sampler=e instanceof Vn?e:new Vn(this.device,e),this}}class zn extends Kt{constructor(e,t){super(e,t),this.device=e,this.device.handle.pushErrorScope("validation"),this.handle=this.props.handle||this.createHandle(),this.handle.label=this.props.id,this._checkCompilationError(this.device.handle.popErrorScope())}async _checkCompilationError(e){const t=await e;if(t){this.debugShader();const e=await this.getCompilationInfo();throw _.c.error("Shader compilation error: "+t.message,e)(),new Error("Shader compilation error: "+t.message)}}destroy(){}async getCompilationInfo(){return(await this.handle.getCompilationInfo()).messages}createHandle(){const{source:e,stage:t}=this.props;let n=this.props.language;switch("auto"===n&&(n=e.includes("->")?"wgsl":"glsl"),n){case"wgsl":return this.device.handle.createShaderModule({code:e});case"glsl":return this.device.handle.createShaderModule({code:e,transform:e=>this.device.glslang.compileGLSL(e,t)});default:throw new Error(n)}}}function jn(e){return e.depthStencil=e.depthStencil||{format:"depth24plus",stencilFront:{},stencilBack:{},depthWriteEnabled:!1,depthCompare:"less-equal"},e.depthStencil}const Zn={cullMode:(e,t,n)=>{n.primitive=n.primitive||{},n.primitive.cullMode=t},frontFace:(e,t,n)=>{n.primitive=n.primitive||{},n.primitive.frontFace=t},depthWriteEnabled:(e,t,n)=>{jn(n).depthWriteEnabled=t},depthCompare:(e,t,n)=>{jn(n).depthCompare=t},depthFormat:(e,t,n)=>{jn(n).format=t},depthBias:(e,t,n)=>{jn(n).depthBias=t},depthBiasSlopeScale:(e,t,n)=>{jn(n).depthBiasSlopeScale=t},depthBiasClamp:(e,t,n)=>{jn(n).depthBiasClamp=t},stencilReadMask:(e,t,n)=>{jn(n).stencilReadMask=t},stencilWriteMask:(e,t,n)=>{jn(n).stencilWriteMask=t},stencilCompare:(e,t,n)=>{const r=jn(n);r.stencilFront.compare=t,r.stencilBack.compare=t},stencilPassOperation:(e,t,n)=>{const r=jn(n);r.stencilFront.passOp=t,r.stencilBack.passOp=t},stencilFailOperation:(e,t,n)=>{const r=jn(n);r.stencilFront.failOp=t,r.stencilBack.failOp=t},stencilDepthFailOperation:(e,t,n)=>{const r=jn(n);r.stencilFront.depthFailOp=t,r.stencilBack.depthFailOp=t},sampleCount:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.count=t},sampleMask:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.mask=t},sampleAlphaToCoverageEnabled:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.alphaToCoverageEnabled=t},colorMask:(e,t,n)=>{$n(n)[0].writeMask=t},blendColorOperation:(e,t,n)=>{$n(n)}},qn={primitive:{cullMode:"back",topology:"triangle-list"},vertex:{module:void 0,entryPoint:"main"},fragment:{module:void 0,entryPoint:"main",targets:[]},layout:"auto"};function Qn(e,t){void 0===t&&(t={}),Object.assign(e,{...qn,...e}),function(e,t){for(const[n,r]of Object.entries(t)){const t=Zn[n];if(!t)throw new Error("Illegal parameter "+n);t(n,r,e)}}(e,t)}function $n(e){var t,n,r,i,s;if(e.fragment.targets=(null==(t=e.fragment)?void 0:t.targets)||[],!Array.isArray(null==(n=e.fragment)?void 0:n.targets))throw new Error("colorstate");0===(null==(r=e.fragment)||null==(r=r.targets)?void 0:r.length)&&(null==(s=e.fragment.targets)||s.push({}));return null==(i=e.fragment)?void 0:i.targets}function Jn(e,t,n,r){const i=function(e,t){const n=[];for(const[r,i]of Object.entries(e)){const e=er(t,r);e&&n.push(tr(i,e.location))}return n}(r,n);return e.createBindGroup({layout:t,entries:i})}function er(e,t){const n=e.bindings.find((e=>e.name===t||e.name+"uniforms"===t.toLocaleLowerCase()));return n||_.c.warn("Binding "+t+" not set: Not found in shader layout.")(),n}function tr(e,t){if(e instanceof p.l)return{binding:t,resource:{buffer:e.handle}};if(e instanceof mt)return{binding:t,resource:e.handle};if(e instanceof rt.x)return{binding:t,resource:e.handle.createView({label:"bind-group-auto-created"})};throw new Error("invalid binding")}var nr=n(1477);function rr(e){if(e.endsWith("-webgl"))throw new Error("WebGPU does not support vertex format "+e);return e}function ir(e,t){const n=[],r=new Set;for(const i of t){const t=[];let s="vertex",o=0;if(i.attributes)for(const n of i.attributes){const a=sr(e,n.attribute,r);s=a.stepMode||(a.name.startsWith("instance")?"instance":"vertex"),t.push({format:rr(n.format||i.format),offset:n.byteOffset,shaderLocation:a.location}),o+=(0,nr.$)(i.format).byteLength}else{const n=sr(e,i.name,r);if(!n)continue;o=(0,nr.$)(i.format).byteLength,s=n.stepMode||(n.name.startsWith("instance")?"instance":"vertex"),t.push({format:rr(i.format),offset:0,shaderLocation:n.location})}n.push({arrayStride:i.byteStride||o,stepMode:s,attributes:t})}for(const i of e.attributes)r.has(i.name)||n.push({arrayStride:(0,nr.$)("float32x3").byteLength,stepMode:i.stepMode||(i.name.startsWith("instance")?"instance":"vertex"),attributes:[{format:rr("float32x3"),offset:0,shaderLocation:i.location}]});return n}function sr(e,t,n){const r=e.attributes.find((e=>e.name===t));if(!r)return _.c.warn("Unknown attribute "+t)(),null;if(n.has(t))throw new Error("Duplicate attribute "+t);return n.add(t),r}class or extends $t.h{constructor(e,t){if(super(e,t),this.fs=null,this._bindGroupLayout=null,this._bindGroup=null,this.device=e,this.handle=this.props.handle,!this.handle){const e=this._getRenderPipelineDescriptor();_.c.groupCollapsed(1,"new WebGPURenderPipeline("+this.id+")")(),_.c.probe(1,JSON.stringify(e,null,2))(),_.c.groupEnd(1)(),this.handle=this.device.handle.createRenderPipeline(e)}this.handle.label=this.props.id,this.vs=t.vs,this.fs=t.fs}destroy(){}setBindings(e){Object.assign(this.props.bindings,e)}setUniforms(e){if(!(0,E.nK)(e))throw new Error("WebGPU does not support uniforms")}draw(e){const t=e.renderPass||this.device.getDefaultRenderPass();t.handle.setPipeline(this.handle);const n=this._getBindGroup();n&&t.handle.setBindGroup(0,n),e.vertexArray.bindBeforeRender(e.renderPass),e.indexCount?t.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):t.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstInstance),e.vertexArray.unbindAfterRender(e.renderPass)}_getBindGroup(){return this._bindGroupLayout=this._bindGroupLayout||this.handle.getBindGroupLayout(0),this._bindGroup=this._bindGroup||Jn(this.device.handle,this._bindGroupLayout,this.props.shaderLayout,this.props.bindings),this._bindGroup}_getRenderPipelineDescriptor(){const e={module:this.props.vs.handle,entryPoint:this.props.vsEntryPoint||"main",buffers:ir(this.props.shaderLayout,this.props.bufferLayout)};let t;var n;this.props.fs&&(t={module:this.props.fs.handle,entryPoint:this.props.fsEntryPoint||"main",targets:[{format:kn(null==(n=this.device)||null==(n=n.canvasContext)?void 0:n.format)}]});switch(this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":throw new Error("WebGPU does not support primitive topology "+this.props.topology)}const r={vertex:e,fragment:t,primitive:{topology:this.props.topology},layout:"auto"};return Qn(r,this.props.parameters),r}}let ar,lr;ar=Symbol.toStringTag;class cr extends pt._{get[ar](){return"ComputePipeline"}constructor(e,t){super(e,t,cr.defaultProps),this.hash=""}}cr.defaultProps={...pt._.defaultProps,cs:void 0,csEntryPoint:void 0,csConstants:{},shaderLayout:[]};class ur extends cr{constructor(e,t){super(e,t),this.device=e;const n=this.props.cs;this.handle=this.props.handle||this.device.handle.createComputePipeline({label:this.props.id,compute:{module:n.handle,entryPoint:this.props.csEntryPoint},layout:"auto"})}_getBindGroupLayout(){return this.handle.getBindGroupLayout(0)}}class _r extends Zt{constructor(e,t){void 0===t&&(t={}),super(e,t),this.pipeline=null,this.device=e;const n=t.framebuffer||e.canvasContext.getCurrentFramebuffer(),r=this.getRenderPassDescriptor(n);_.c.groupCollapsed(3,"new WebGPURenderPass("+this.id+")")(),_.c.probe(3,JSON.stringify(r,null,2))(),_.c.groupEnd(3)(),this.handle=this.props.handle||e.commandEncoder.beginRenderPass(r),this.handle.label=this.props.id}destroy(){}end(){this.handle.end()}setPipeline(e){this.pipeline=e,this.handle.setPipeline(this.pipeline.handle)}setBindings(e){var t,n;null==(t=this.pipeline)||t.setBindings(e);const r=null==(n=this.pipeline)?void 0:n._getBindGroup();r&&this.handle.setBindGroup(0,r)}setIndexBuffer(e,t,n,r){void 0===n&&(n=0),this.handle.setIndexBuffer(e.handle,t,n,r)}setVertexBuffer(e,t,n){void 0===n&&(n=0),this.handle.setVertexBuffer(e,t.handle,n)}draw(e){e.indexCount?this.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):this.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstIndex,e.firstInstance)}drawIndirect(){}setParameters(e){const{blendConstant:t,stencilReference:n,scissorRect:r,viewport:i}=e;t&&this.handle.setBlendConstant(t),n&&this.handle.setStencilReference(n),r&&this.handle.setScissorRect(r[0],r[1],r[2],r[3]),i&&this.handle.setViewport(i[0],i[1],i[2],i[3],i[4],i[5])}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}getRenderPassDescriptor(e){const t={colorAttachments:[]};if(t.colorAttachments=e.colorAttachments.map((e=>({loadOp:!1!==this.props.clearColor?"clear":"load",colorClearValue:this.props.clearColor||[0,0,0,0],storeOp:this.props.discard?"discard":"store",view:e.createView()}))),e.depthStencilAttachment){t.depthStencilAttachment={view:e.depthStencilAttachment.createView()};const{depthStencilAttachment:n}=t;this.props.depthReadOnly&&(n.depthReadOnly=!0),n.depthClearValue=this.props.clearDepth||0;!0&&(n.depthLoadOp=!1!==this.props.clearDepth?"clear":"load",n.depthStoreOp="store");!1&&(n.stencilLoadOp=!1!==this.props.clearStencil?"clear":"load",n.stencilStoreOp="store")}return t}}lr=Symbol.toStringTag;class hr extends pt._{get[lr](){return"ComputePass"}constructor(e,t){super(e,t,pt._.defaultProps)}}hr.defaultProps={...pt._.defaultProps};class dr extends hr{constructor(e,t){var n;super(e,t),this._bindGroupLayout=null,this.device=e,this.handle=this.props.handle||(null==(n=e.commandEncoder)?void 0:n.beginComputePass({label:this.props.id}))}destroy(){}end(){this.handle.end()}setPipeline(e){const t=e;this.handle.setPipeline(t.handle),this._bindGroupLayout=t._getBindGroupLayout()}setBindings(e){throw new Error("fix me")}dispatch(e,t,n){this.handle.dispatchWorkgroups(e,t,n)}dispatchIndirect(e,t){void 0===t&&(t=0);const n=e;this.handle.dispatchWorkgroupsIndirect(n.handle,t)}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}}class fr extends Nn{get[Symbol.toStringTag](){return"WebGPUVertexArray"}static isConstantAttributeZeroSupported(e){return"webgl2"===e.info.type||"Chrome"===(0,In.Z)()}constructor(e,t){super(e,t),this.device=e}destroy(){}setIndexBuffer(e){this.indexBuffer=e}setBuffer(e,t){this.attributes[e]=t}setConstant(e,t){_.c.warn(this.id+" constant attributes not supported on WebGPU")}bindBeforeRender(e,t,n){const r=e,i=this.indexBuffer;null!=i&&i.handle&&(_.c.warn("setting index buffer",null==i?void 0:i.handle,null==i?void 0:i.indexType)(),r.handle.setIndexBuffer(null==i?void 0:i.handle,null==i?void 0:i.indexType));for(let s=0;s<this.maxVertexAttributes;s++){const e=this.attributes[s];null!=e&&e.handle&&(_.c.warn("setting vertex buffer "+s,null==e?void 0:e.handle)(),r.handle.setVertexBuffer(s,null==e?void 0:e.handle))}}unbindAfterRender(e){}}class Er extends nt.A{constructor(e,t){super(e,t),this.device=e,this.autoCreateAttachmentTextures()}}class pr extends b{constructor(e,t,n){super(n),this.format=navigator.gpu.getPreferredCanvasFormat(),this.depthStencilFormat="depth24plus",this.depthStencilAttachment=null,this.device=e,this.width=-1,this.height=-1,this._setAutoCreatedCanvasId(this.device.id+"-canvas"),this.gpuCanvasContext=this.canvas.getContext("webgpu"),this.format="bgra8unorm"}destroy(){this.gpuCanvasContext.unconfigure()}getCurrentFramebuffer(){this.update();const e=this.getCurrentTexture();return this.width=e.width,this.height=e.height,this._createDepthStencilAttachment(),new Er(this.device,{colorAttachments:[e],depthStencilAttachment:this.depthStencilAttachment})}update(){const[e,t]=this.getPixelSize();(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.depthStencilAttachment&&(this.depthStencilAttachment.destroy(),this.depthStencilAttachment=null),this.gpuCanvasContext.configure({device:this.device.handle,format:kn(this.format),colorSpace:this.props.colorSpace,alphaMode:this.props.alphaMode}),_.c.log(1,"Resized to "+this.width+"x"+this.height+"px")())}resize(e){this.update()}getCurrentTexture(){return this.device._createTexture({id:this.id+"#color-texture",handle:this.gpuCanvasContext.getCurrentTexture()})}_createDepthStencilAttachment(){return this.depthStencilAttachment||(this.depthStencilAttachment=this.device.createTexture({id:this.id+"#depth-stencil-texture",format:this.depthStencilFormat,width:this.width,height:this.height,usage:GPUTextureUsage.RENDER_ATTACHMENT})),this.depthStencilAttachment}}class gr extends m{static isSupported(){return Boolean("undefined"!=typeof navigator&&navigator.gpu)}static async create(e){if(!navigator.gpu)throw new Error("WebGPU not available. Open in Chrome Canary and turn on chrome://flags/#enable-unsafe-webgpu");_.c.groupCollapsed(1,"WebGPUDevice created")();const t=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!t)throw new Error("Failed to request WebGPU adapter");const n=await t.requestAdapterInfo();_.c.probe(2,"Adapter available",n)();const r=await t.requestDevice({requiredFeatures:t.features});_.c.probe(1,"GPUDevice available")(),"string"==typeof e.canvas&&(await b.pageLoaded,_.c.probe(1,"DOM is loaded")());const i=new gr(r,t,n,e);return _.c.probe(1,"Device created. For more info, set chrome://flags/#enable-webgpu-developer-features")(),_.c.table(1,i.info)(),_.c.groupEnd(1)(),i}constructor(e,t,n,r){super({...r,id:r.id||(0,E.hQ)("webgpu-device")}),this.canvasContext=null,this.commandEncoder=null,this.renderPass=null,this._isLost=!1,this.handle=e,this.adapter=t;const[i,s]=(n.driver||"").split(" Version "),o=n.vendor||this.adapter.__brand||"unknown",a=i||"",l=s||"",c="apple"===o?"apple":"unknown",u=n.architecture||"unknown",_=n.backend||"unknown",h=(n.type||"").split(" ")[0].toLowerCase()||"unknown";this._info={type:"webgpu",vendor:o,renderer:a,version:l,gpu:c,gpuType:h,gpuBackend:_,gpuArchitecture:u,shadingLanguage:"wgsl",shadingLanguageVersion:100},this.lost=new Promise((async e=>{const t=await this.handle.lost;this._isLost=!0,e({reason:"destroyed",message:t.message})})),this.canvasContext=new pr(this,this.adapter,{canvas:r.canvas,height:r.height,width:r.width,container:r.container}),this.features=this._getFeatures()}destroy(){this.handle.destroy()}get info(){return this._info}get limits(){return this.handle.limits}isTextureFormatSupported(e){return!e.includes("webgl")}isTextureFormatFilterable(e){return this.isTextureFormatSupported(e)}isTextureFormatRenderable(e){return this.isTextureFormatSupported(e)}get isLost(){return this._isLost}createBuffer(e){const t=this._getBufferProps(e);return new Un(this,t)}_createTexture(e){return new Hn(this,e)}createExternalTexture(e){return new Yn(this,e)}createShader(e){return new zn(this,e)}createSampler(e){return new Vn(this,e)}createRenderPipeline(e){return new or(this,e)}createFramebuffer(e){throw new Error("Not implemented")}createComputePipeline(e){return new ur(this,e)}createVertexArray(e){return new fr(this,e)}beginRenderPass(e){return this.commandEncoder=this.commandEncoder||this.handle.createCommandEncoder(),new _r(this,e)}beginComputePass(e){return this.commandEncoder=this.commandEncoder||this.handle.createCommandEncoder(),new dr(this,e)}createTransformFeedback(e){throw new Error("Transform feedback not supported in WebGPU")}createCanvasContext(e){return new pr(this,this.adapter,e)}getDefaultRenderPass(){throw new Error("a")}submit(){var e;const t=null==(e=this.commandEncoder)?void 0:e.finish();t&&this.handle.queue.submit([t]),this.commandEncoder=null}_getFeatures(){const e=new Set(this.handle.features);return e.has("depth-clamping")&&(e.delete("depth-clamping"),e.add("depth-clip-control")),e.has("texture-compression-bc")&&e.add("texture-compression-bc5-webgl"),e.add("webgpu"),e.add("timer-query-webgl"),e.add("vertex-array-object-webgl1"),e.add("instanced-rendering-webgl1"),e.add("multiple-render-targets-webgl1"),e.add("index-uint32-webgl1"),e.add("blend-minmax-webgl1"),e.add("texture-blend-float-webgl1"),e.add("texture-formats-srgb-webgl1"),e.add("texture-formats-depth-webgl1"),e.add("texture-formats-float32-webgl1"),e.add("texture-formats-float16-webgl1"),e.add("texture-filter-linear-float32-webgl"),e.add("texture-filter-linear-float16-webgl"),e.add("texture-filter-anisotropic-webgl"),e.add("texture-renderable-rgba32float-webgl"),e.add("texture-renderable-float32-webgl"),e.add("texture-renderable-float16-webgl"),e.add("glsl-frag-data"),e.add("glsl-frag-depth"),e.add("glsl-derivatives"),e.add("glsl-texture-lod"),e}copyExternalImageToTexture(e){var t;const{source:n,sourceX:r=0,sourceY:i=0,texture:s,mipLevel:o=0,aspect:a="all",colorSpace:l="display-p3",premultipliedAlpha:c=!1,width:u=s.width,height:_=s.height,depth:h=1}=e,d=s;null==(t=this.handle)||t.queue.copyExternalImageToTexture({source:n,origin:[r,i]},{texture:d.handle,origin:[0,0,0],mipLevel:o,aspect:a,colorSpace:l,premultipliedAlpha:c},[u,_,h])}}gr.type="webgpu",T.registerDevices([Dn,gr]);let mr,Ar={};const Rr=(0,c.Ue)((e=>({deviceType:void 0,deviceError:void 0,device:void 0,setDeviceType:async t=>{let n,r;try{r=await async function(e){const t=e.toLowerCase();return Ar[t]=Ar[t]||T.createDevice({type:t,height:0,container:(mr||(mr=document.createElement("div"),mr.style.display="none",document.body.appendChild(mr)),mr)}),await Ar[t]}(t)}catch(i){n=i.message}return e((e=>({deviceType:t,deviceError:n,device:r})))}})));Rr.getState().setDeviceType("webgl2");var Tr,Lr,vr=n(9521);function Sr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const br=vr.ZP.div(Tr||(Tr=Sr(["\n  display: flex;\n  flex-direction: row;\n\n  & > * + * {\n    margin-left: 2px;\n  }\n"]))),Cr=vr.ZP.div((e=>"\n  cursor: pointer;\n  padding: 10px 20px;\n  font-weight: bold;\n  &:hover {\n    background-color: #eeefef;\n  }\n  "+(e.isSelected?"\n    color: #276EF1;\n    border-bottom: 4px solid #276EF1;\n  ":"")+"\n")),Gr=vr.ZP.div(Lr||(Lr=Sr(["\n  background-color: rgb(250, 248, 245);\n"]))),Nr=e=>{var t,n;const{children:i}=e,s=r.Children.toArray(i),[o,a]=(0,r.useState)((null==(t=s[0])?void 0:t.props.tag)||(null==(n=s[0])?void 0:n.props.title));let l=void 0!==e.selectedItem?e.selectedItem:o;const c=void 0!==e.setSelectedItem?e.setSelectedItem:a;return s.some((e=>(e.props.tag||e.props.title)===l))||(l=o),r.createElement(r.Fragment,null,r.createElement(br,null,s.map((e=>r.createElement(Cr,{key:e.props.title,isSelected:(e.props.tag||e.props.title)===l,onClick:()=>c(e.props.tag||e.props.title)},e.props.title)))),r.createElement(Gr,null,s.find((e=>(e.props.tag||e.props.title)===l))))},yr=e=>{const{children:t}=e;return r.createElement(r.Fragment,null,t)};var Ir=n(748);const Mr=e=>{const t=Rr((e=>e.deviceType)),n=Rr((e=>e.deviceError)),i=Rr((e=>e.setDeviceType));return r.createElement(Nr,{selectedItem:t,setSelectedItem:i},r.createElement(yr,{key:"WebGL2",title:"WebGL2",tag:"webgl2"},n),r.createElement(yr,{key:"WebGL",title:"WebGL",tag:"webgl1"},n),r.createElement(yr,{key:"WebGPU",title:"WebGPU",tag:"webgpu"},n))},wr=()=>r.createElement(Ir.Z,null,(()=>r.createElement(Mr,null)));const xr=e=>{let{f:t}=e;const n=Rr((e=>e.device)),i=n?n.info[t]:"N/A";return r.createElement("code",{style:{color:"darkgreen"}},i)},Or=e=>{let{f:t}=e;const n=Rr((e=>e.device));return r.createElement("code",{style:{color:"darkgreen"}},function(e,t){return e?e.limits[t]?String(e.limits[t]):"0 \u274c":"N/A"}(n,t))},Fr=e=>{let{f:t}=e;const n=Rr((e=>e.device));return r.createElement("span",null,function(e,t){return e?e.features.has(t)?"\u2705":"\u274c":"N/A"}(n,t))},Pr=e=>{let{f:t}=e;const n=Rr((e=>e.device));return r.createElement("span",{key:t},function(e,t){const n=e&&e.isTextureFormatSupported(t);return e?n?"\u2705":"\u274c":"N/A"}(n,t))},Br=e=>{let{f:t}=e;const n=Rr((e=>e.device));return r.createElement("span",null,function(e,t){const n=e&&e.isTextureFormatSupported(t)&&e.isTextureFormatFilterable(t);return e?n?"\u2705":"\u274c":"N/A"}(n,t))},Dr=e=>{let{f:t}=e;const n=Rr((e=>e.device)),r=t,i=n&&n.isTextureFormatSupported(r)&&n.isTextureFormatRenderable(r);return n?i?"\u2705":"\u274c":"N/A"},Ur=e=>{let{f:t}=e;const n=Rr((e=>e.device)),i=n instanceof Dn?n:null,s=i?i.webglLimits[w.GL[t]]?String(i.webglLimits[w.GL[t]]):"0 \u274c":"N/A";return r.createElement("code",{style:{color:"darkgreen"}},s)},kr=e=>{let{f:t}=e;const n=Rr((e=>e.device)),i=n instanceof Dn?n:null,s=i?i.gl.getSupportedExtensions():[];return r.createElement("ul",null,s.map((e=>r.createElement("li",{key:e,style:{color:"darkgreen"}},r.createElement("a",{href:"https://www.khronos.org/registry/webgl/extensions/"+e,target:"_blank"},e)))))};let Vr=0;const Xr={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:T.stats.get("animation-loop-"+Vr++),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class Hr{constructor(e){if(this.device=null,this.canvas=null,this.animationProps=null,this.timeline=null,this.needsRedraw="initialized",this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.props={...Xr,...e},!(e=this.props).device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new h.Z({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return null!=(e=this.device)&&e.isLost||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:null==(e=this.device)||null==(e=e.canvasContext)?void 0:e.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=(null==(e=this.device.canvasContext)?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,r]=(null==(e=this.device)||null==(e=e.canvasContext)?void 0:e.getPixelSize())||[1,1];let i=1;const s=null==(t=this.device)||null==(t=t.canvasContext)?void 0:t.canvas;return s&&s.clientHeight?i=s.clientWidth/s.clientHeight:n>0&&r>0&&(i=n/r),{width:n,height:r,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e;this.props.autoResizeDrawingBuffer&&(null==(e=this.device)||null==(e=e.canvasContext)||e.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}"undefined"!=typeof window&&(window.website=!0);const Wr=e=>{let t="ssr";const[n,i]=(0,r.useState)(null),s=(0,r.useRef)(new WeakMap),o=(0,r.useRef)(null),a=Rr((e=>e.deviceType));return t=e.container||"luma-example-container-"+a,(0,r.useEffect)((()=>{if(!n||s.current.get(n))return;s.current.set(n,!0);let r=null,i=null;const l=async()=>{var s;n.style.width="100%",n.style.height="100%",i=await T.createDevice({type:a,canvas:n,container:t}),r=function(e,t){let n=null;const r=(null==t?void 0:t.device)||T.createDevice(),i=new Hr({...t,device:r,async onInitialize(t){var r;return n=new e(t),await(null==(r=n)?void 0:r.onInitialize(t))},onRender:e=>{var t;return null==(t=n)?void 0:t.onRender(e)},onFinalize:e=>{var t;return null==(t=n)?void 0:t.onFinalize(e)}});return i.getInfo=()=>this.AnimationLoopTemplateCtor.info,i}(e.template,{device:i,autoResizeViewport:!0,autoResizeDrawingBuffer:!0}),null==(s=r)||s.start();const o="https://raw.githubusercontent.com/visgl/luma.gl/master";e.directory?(0,it.VY)(o+"/examples/"+e.directory+"/"+e.id+"/"):(0,it.VY)(o+"/website/static/images/")};return o.current=Promise.resolve(o.current).then((()=>{l().catch((e=>{console.error("start "+a+" failed",e)}))})),()=>{o.current=Promise.resolve(o.current).then((()=>{r&&(r.destroy(),r=null),i&&i.destroy()})).catch((e=>{console.error("unmounting "+a+" failed",e)}))}}),[a,n]),r.createElement("canvas",{key:a,ref:i})}},5251:(e,t,n)=>{var r=n(7294),i=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,s={},c=null,u=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,r)&&!l.hasOwnProperty(r)&&(s[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===s[r]&&(s[r]=t[r]);return{$$typeof:i,type:e,key:c,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=c,t.jsxs=c},5893:(e,t,n)=>{e.exports=n(5251)},1151:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>o});var r=n(7294);const i={},s=r.createContext(i);function o(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);