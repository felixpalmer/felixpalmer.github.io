"use strict";(self.webpackChunkwebsite_docusaurus=self.webpackChunkwebsite_docusaurus||[]).push([[8617],{3320:(e,t,n)=>{n.d(t,{A:()=>c});var i,r,s=n(6540),o=["title","titleId"];function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},a.apply(this,arguments)}function l(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},s=Object.keys(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(i=0;i<s.length;i++)n=s[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}const c=function(e){var t=e.title,n=e.titleId,c=l(e,o);return s.createElement("svg",a({width:36,height:36,viewBox:"0 0 36 36",xmlns:"http://www.w3.org/2000/svg","aria-labelledby":n},c),void 0===t?s.createElement("title",{id:n},"high-precision"):t?s.createElement("title",{id:n},t):null,i||(i=s.createElement("defs",null,s.createElement("linearGradient",{x1:"21.466%",y1:"9.071%",x2:"49.902%",y2:"99.686%",id:"a"},s.createElement("stop",{stopColor:"#00ADE7",offset:"0%"}),s.createElement("stop",{stopColor:"#04E3D5",offset:"100%"})))),r||(r=s.createElement("g",{fill:"url(#a)",fillRule:"evenodd"},s.createElement("path",{d:"M31.48 17.6c-.2-7.12-5.88-12.88-13.08-13.08V0h-.8v4.52c-7.2.16-12.88 5.92-13.08 13.08H0v.8h4.52c.2 7.12 5.96 12.88 13.08 13.08V36h.8v-4.52c7.12-.2 12.88-5.96 13.08-13.08H36v-.8h-4.52Zm-1.2.8A12.26 12.26 0 0 1 18.4 30.28V27.2h-.8v3.08A12.26 12.26 0 0 1 5.72 18.4H8.8v-.8H5.72c.2-6.48 5.48-11.72 11.88-11.88V9.2h.8V5.72c6.4.2 11.68 5.44 11.88 11.88H26.8v.8h3.48Z"}),s.createElement("circle",{cx:18,cy:18,r:2.4}),s.createElement("path",{d:"M18 12.8a5.19 5.19 0 0 0-5.2 5.2c0 2.88 2.32 5.2 5.2 5.2 2.88 0 5.2-2.32 5.2-5.2 0-2.88-2.32-5.2-5.2-5.2Zm0 9.6c-2.44 0-4.4-1.96-4.4-4.4 0-2.44 1.96-4.4 4.4-4.4 2.44 0 4.4 1.96 4.4 4.4 0 2.44-1.96 4.4-4.4 4.4Z"}))))}},9282:(e,t,n)=>{n.d(t,{Mr:()=>l,PV:()=>a,GE:()=>h});var i=n(3522);const r={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},s={f32:4,f16:2,i32:4,u32:4};var o=n(1970);function a(e,t){const n={};for(const i of e.attributes)n[i.name]=c(e,t,i.name);return n}function l(e,t,n){void 0===n&&(n=16);const i=a(e,t),r=new Array(n).fill(null);for(const s of Object.values(i))r[s.location]=s;return r}function c(e,t,n){const a=function(e,t){const n=e.attributes.find((e=>e.name===t));n||i.R.warn('shader layout attribute "'+t+'" not present in shader');return n||null}(e,n),l=function(e,t){u(e);let n=function(e,t){for(const n of e)if(n.format&&n.name===t)return{attributeName:n.name,bufferName:t,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}(e,t);if(n)return n;if(n=function(e,t){for(const i of e){var n;let e=i.byteStride;if("number"!=typeof i.byteStride)for(const t of i.attributes||[]){e+=(0,o.w)(t.format).byteLength}const r=null==(n=i.attributes)?void 0:n.find((e=>e.attribute===t));if(r)return{attributeName:r.attribute,bufferName:i.name,stepMode:i.stepMode,vertexFormat:r.format,byteOffset:r.byteOffset,byteStride:e}}return null}(e,t),n)return n;return i.R.warn('layout for attribute "'+t+'" not present in buffer layout'),null}(t,n);if(!a)return null;const c=function(e){const[t,n]=r[e],i="i32"===t||"u32"===t,o="u32"!==t,a=s[t]*n,l=function(e,t){let n;switch(e){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?n:n+"x"+t}(t,n);return{dataType:t,components:n,defaultVertexFormat:l,byteLength:a,integer:i,signed:o}}(a.type),h=(null==l?void 0:l.vertexFormat)||c.defaultVertexFormat,_=(0,o.w)(h);return{attributeName:(null==l?void 0:l.attributeName)||a.name,bufferName:(null==l?void 0:l.bufferName)||a.name,location:a.location,shaderType:a.type,shaderDataType:c.dataType,shaderComponents:c.components,vertexFormat:h,bufferDataType:_.type,bufferComponents:_.components,normalized:_.normalized,integer:c.integer,stepMode:(null==l?void 0:l.stepMode)||a.stepMode,byteOffset:(null==l?void 0:l.byteOffset)||0,byteStride:(null==l?void 0:l.byteStride)||0}}function u(e){for(const t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&i.R.warn("BufferLayout "+name+" must have either 'attributes' or 'format' field")}function h(e,t){const n={...e,attributes:e.attributes.map((e=>({...e})))};for(const r of(null==t?void 0:t.attributes)||[]){const e=n.attributes.find((e=>e.name===r.name));e?(e.type=r.type||e.type,e.stepMode=r.stepMode||e.stepMode):i.R.warn("shader layout attribute "+r.name+" not present in shader")}return n}},5056:(e,t,n)=>{n.d(t,{h:()=>s});var i=n(7862);let r;r=Symbol.toStringTag;class s extends i.F{get[r](){return"Buffer"}constructor(e,t){const n={...t};(t.usage||0)&s.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?n.indexType="uint32":t.data instanceof Uint16Array&&(n.indexType="uint16")),super(e,n,s.defaultProps),this.debugData=new ArrayBuffer(0),this.usage=t.usage||0,this.indexType=n.indexType}readSyncWebGL(e,t){throw new Error("not implemented")}_setDebugData(e,t,n){const i=ArrayBuffer.isView(e)?e.buffer:e,r=Math.min(e?e.byteLength:n,s.DEBUG_DATA_MAX_LENGTH);null===e?this.debugData=new ArrayBuffer(r):0===t&&n===e.byteLength?this.debugData=i.slice(0,r):this.debugData=i.slice(t,t+r)}}s.defaultProps={...i.F.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1},s.MAP_READ=1,s.MAP_WRITE=2,s.COPY_SRC=4,s.COPY_DST=8,s.INDEX=16,s.VERTEX=32,s.UNIFORM=64,s.STORAGE=128,s.INDIRECT=256,s.QUERY_RESOLVE=512,s.DEBUG_DATA_MAX_LENGTH=32},3145:(e,t,n)=>{n.d(t,{r:()=>s});var i=n(7862);let r;r=Symbol.toStringTag;class s extends i.F{get[r](){return"RenderPipeline"}constructor(e,t){super(e,t,s.defaultProps),this.linkStatus="pending",this.hash="",this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw new Error("Use uniform blocks")}}s.defaultProps={...i.F.defaultProps,vs:null,vsEntryPoint:"",vsConstants:{},fs:null,fsEntryPoint:"",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}}},7862:(e,t,n)=>{n.d(t,{F:()=>r});var i=n(469);class r{constructor(e,t,n){if(this.userData={},this.destroyed=!1,this.allocatedBytes=0,this._attachedResources=new Set,!e)throw new Error("no device");this._device=e,this.props=function(e,t){const n={...t};for(const i in e)void 0!==e[i]&&(n[i]=e[i]);return n}(t,n);const r="undefined"!==this.props.id?this.props.id:(0,i.L)(this[Symbol.toStringTag]);this.props.id=r,this.id=r,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return(this[Symbol.toStringTag]||this.constructor.name)+"("+this.id+")"}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(t+"s Active").decrementCount()}trackAllocatedMemory(e,t){void 0===t&&(t=this[Symbol.toStringTag]);const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").addCount(e),n.get(t+" Memory").addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e){void 0===e&&(e=this[Symbol.toStringTag]);const t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(e+" Memory").subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(t+"s Created").incrementCount(),e.get(t+"s Active").incrementCount()}}r.defaultProps={id:"undefined",handle:void 0,userData:void 0}},5612:(e,t,n)=>{n.d(t,{M:()=>h});var i=n(7862),r=n(469);function s(e,t,n,i){if(null!=i&&i.inlineSource){const i=function(e,t,n){let i="";for(let r=t-2;r<=t;r++){const s=e[r-1];void 0!==s&&(i+=o(s,t,n))}return i}(t,n);return"\n"+i+(e.linePos>0?" ".repeat(e.linePos+5)+"^^^\n":"")+e.type.toUpperCase()+": "+e.message+"\n\n"}return null!=i&&i.html?"<div class='luma-compiler-log-error' style=\"color:red;\"><b> "+e.type.toUpperCase()+": "+e.message+"</b></div>":e.type.toUpperCase()+": "+e.message}function o(e,t,n){const i=null!=n&&n.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return function(e,t){let n="";for(let i=e.length;i<t;++i)n+=" ";return n+e}(String(t),4)+": "+i+(null!=n&&n.html?"<br/>":"\n")}function a(e,t){return{name:l(e,t),language:"glsl",version:c(e)}}function l(e,t){void 0===t&&(t="unnamed");const n=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return n?n[1]:t}function c(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}return t}let u;u=Symbol.toStringTag;class h extends i.F{get[u](){return"Shader"}constructor(e,t){super(e,{id:_(t),...t},h.defaultProps),this.compilationStatus="pending",this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(e){switch(void 0===e&&(e=this.props.debug),e){case"never":return;case"errors":if("success"===this.compilationStatus)return}const t=await this.getCompilationInfo();"warnings"===this.props.debug&&0===(null==t?void 0:t.length)||this._displayShaderLog(t)}_displayShaderLog(e){var t,n;if("undefined"==typeof document||null==(t=document)||!t.createElement)return;const i=a(this.source).name,r=this.stage+" "+i;let l=function(e,t,n){let i="";const r=t.split(/\r?\n/),a=e.slice().sort(((e,t)=>e.lineNum-t.lineNum));switch((null==n?void 0:n.showSourceCode)||"no"){case"all":let t=0;for(let e=1;e<=r.length;e++)for(i+=o(r[e-1],e,n);a.length>t&&a[t].lineNum===e;){const e=a[t++];i+=s(e,r,e.lineNum,{...n,inlineSource:!1})}return i;case"issues":case"no":for(const o of e)i+=s(o,r,o.lineNum,{inlineSource:"no"!==(null==n?void 0:n.showSourceCode)});return i}}(e,this.source,{showSourceCode:"all",html:!0});const c=this.getTranslatedSource();c&&(l+='<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>'+c+"</pre></code>");const u=document.createElement("Button");u.innerHTML="\n<h1>Shader Compilation Error in "+r+'</h1><br /><br />\n<code style="user-select:text;"><pre>\n'+l+"\n</pre></code>",u.style.top="10px",u.style.left="10px",u.style.position="absolute",u.style.zIndex="9999",u.style.width="100%",u.style.textAlign="left",document.body.appendChild(u);const h=document.getElementsByClassName("luma-compiler-log-error");null!=(n=h[0])&&n.scrollIntoView&&h[0].scrollIntoView(),u.onclick=()=>{const e="data:text/plain,"+encodeURIComponent(this.source);navigator.clipboard.writeText(e)}}}function _(e){return a(e.source).name||e.id||(0,r.L)("unnamed "+e.stage+"-shader")}h.defaultProps={...i.F.defaultProps,language:"auto",stage:"vertex",source:"",sourceMap:null,entryPoint:"main",debug:"errors"}},5787:(e,t,n)=>{function i(e){const t=function(e){const t=s[e];return t}(r[e]),n=e.includes("norm"),i=!n&&!e.startsWith("float"),o=e.startsWith("s");return{dataType:r[e],byteLength:t,integer:i,signed:o,normalized:n}}n.d(t,{l:()=>i});const r={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},s={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4}},1970:(e,t,n)=>{n.d(t,{w:()=>r});var i=n(5787);function r(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);const[n,r]=e.split("x"),s=n,o=r?parseInt(r):1,a=(0,i.l)(s),l={type:s,components:o,byteLength:a.byteLength*o,integer:a.integer,signed:a.signed,normalized:a.normalized};return t&&(l.webglOnly=!0),l}},7590:(e,t,n)=>{n.d(t,{l:()=>r});var i=n(4390);function r(e){const t={bindings:{},uniforms:{}};return Object.keys(e).forEach((n=>{const r=e[n];var s;s=r,null!==(0,i.p)(s)||"number"==typeof s||"boolean"==typeof s?t.uniforms[n]=r:t.bindings[n]=r})),t}},1649:(e,t,n)=>{let i;function r(e){return(!i||i.byteLength<e)&&(i=new ArrayBuffer(e)),i}function s(e,t){return new e(r(e.BYTES_PER_ELEMENT*t),0,t)}function o(e){const{target:t,source:n,start:i=0,count:r=1}=e,s=n.length,o=r*s;let a=0;for(let l=i;a<s;a++)t[l++]=n[a];for(;a<o;)a<o-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+o-a),a=o);return e.target}n.d(t,{R2:()=>o,oF:()=>s,oK:()=>r})},4468:(e,t,n)=>{function i(e,t){if(!e)throw new Error(t||"luma.gl: assertion failed.")}n.d(t,{v:()=>i})},4390:(e,t,n)=>{function i(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]?e:null:function(e){return!ArrayBuffer.isView(e)||e instanceof DataView?null:e}(e)}n.d(t,{p:()=>i})},4789:(e,t,n)=>{n.d(t,{Dt:()=>s,Qj:()=>r,k0:()=>a,yt:()=>o});let i="";function r(e){i=e}async function s(e,t){const n=new Image;return n.crossOrigin=(null==t?void 0:t.crossOrigin)||"anonymous",n.src=e.startsWith("http")?e:i+e,await n.decode(),await createImageBitmap(n)}async function o(e,t){return await new Promise(((n,r)=>{try{const s=new Image;s.onload=()=>n(s),s.onerror=()=>r(new Error("Could not load image "+e+".")),s.crossOrigin=(null==t?void 0:t.crossOrigin)||"anonymous",s.src=e.startsWith("http")?e:i+e}catch(s){r(s)}}))}async function a(e,t){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),t&&(i.id=t),new Promise(((t,r)=>{i.onload=t,i.onerror=t=>r(new Error("Unable to load script '"+e+"': "+t)),n.appendChild(i)}))}},3522:(e,t,n)=>{n.d(t,{R:()=>i});const i=new(n(1369).t)({id:"luma.gl"})},469:(e,t,n)=>{n.d(t,{L:()=>r,Z:()=>s});const i={};function r(e){void 0===e&&(e="id"),i[e]=i[e]||1;return e+"-"+i[e]++}function s(e){let t=!0;for(const n in e){t=!1;break}return t}},3177:(e,t,n)=>{n.d(t,{PZ:()=>ns,gl:()=>is,MV:()=>as,zW:()=>ls,Jh:()=>cs,zk:()=>Es,y3:()=>gs,Gk:()=>us,LL:()=>ss,BA:()=>hs,_j:()=>os,QQ:()=>ms,YE:()=>_s,ZM:()=>ds,Z5:()=>rs,Xb:()=>As,rq:()=>ps,yt:()=>fs,HH:()=>Rs});var i=n(6540),r=n(3534);const s=e=>""+e;var o=n(5056),a=n(4390);class l{constructor(e){if(this.uniforms={},this.modifiedUniforms={},this.modified=!0,this.bindingLayout={},this.needsRedraw="initialized",this.name=null==e?void 0:e.name,null!=e&&e.name&&null!=e&&e.shaderLayout){var t;const n=null==e||null==(t=e.shaderLayout.bindings)?void 0:t.find((t=>"uniform"===t.type&&t.name===(null==e?void 0:e.name)));if(!n)throw new Error(null==e?void 0:e.name);const i=n;for(const e of i.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(const[t,n]of Object.entries(e))this._setUniform(t,n),this.needsRedraw||this.setNeedsRedraw(this.name+"."+t+"="+n)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){(function(e,t,n){if(void 0===n&&(n=16),e!==t)return!1;const i=(0,a.p)(e);if(!i)return!1;const r=(0,a.p)(t);if(r&&i.length===r.length)for(let s=0;s<i.length;++s)if(r[s]!==i[s])return!1;return!0})(this.uniforms[e],t)||(this.uniforms[e]=function(e){const t=(0,a.p)(e);return t?t.slice():e}(t),this.modifiedUniforms[e]=!0,this.modified=!0)}}var c=n(4468);const u={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function h(e){const t=u[e];return(0,c.v)(e),t}function _(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}var d=n(1649),f=n(3522);class p{constructor(e){this.layout={};let t=0;for(const[i,r]of Object.entries(e)){const e=h(r),{type:n,components:s}=e;t=_(t,s);const o=t;t+=s,this.layout[i]={type:n,size:s,offset:o}}t+=(4-t%4)%4;const n=4*t;this.byteLength=Math.max(n,1024)}getData(e){const t=Math.max(this.byteLength,1024),n=(0,d.oK)(t),i={i32:new Int32Array(n),u32:new Uint32Array(n),f32:new Float32Array(n),f16:new Uint16Array(n)};for(const[r,s]of Object.entries(e)){const e=this.layout[r];if(!e){f.R.warn("Supplied uniform value "+r+" not present in uniform block layout")();continue}const{type:t,size:n,offset:o}=e,l=i[t];if(1===n){if("number"!=typeof s&&"boolean"!=typeof s){f.R.warn("Supplied value for single component uniform "+r+" is not a number: "+s)();continue}l[o]=Number(s)}else{const e=(0,a.p)(s);if(!e){f.R.warn("Supplied value for multi component / array uniform "+r+" is not a numeric array: "+s)();continue}l.set(e,o)}}return new Uint8Array(n)}has(e){return Boolean(this.layout[e])}get(e){return this.layout[e]}}class E{constructor(e){this.uniformBlocks=new Map,this.uniformBufferLayouts=new Map,this.uniformBuffers=new Map;for(const[t,n]of Object.entries(e)){const e=t,i=new p(n.uniformTypes||{});this.uniformBufferLayouts.set(e,i);const r=new l({name:t});r.setUniforms(n.defaultUniforms||{}),this.uniformBlocks.set(e,r)}}destroy(){for(const e of Object.values(this.uniformBuffers))e.destroy()}setUniforms(e){for(const[t,n]of Object.entries(e))this.uniformBlocks.get(t).setUniforms(n);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const t=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(t)}createUniformBuffer(e,t,n){n&&this.setUniforms(n);const i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:i}),s=this.getUniformBufferData(t);return r.write(s),r}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){const n=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:n});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(const t of this.uniformBlocks.keys()){const n=this.updateUniformBuffer(t);e||(e=n)}return e&&f.R.log(3,"UniformStore.updateUniformBuffers(): "+e)(),e}updateUniformBuffer(e){const t=this.uniformBlocks.get(e);let n=!1;if(this.uniformBuffers.get(e)&&t.needsRedraw){n||(n=t.needsRedraw);const i=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(i);const r=this.uniformBlocks.get(e).getAllUniforms();f.R.log(4,"Writing to uniform buffer "+String(e),i,r)()}return n}}class g{constructor(e){}async onInitialize(e){return null}}let m=1,A=1;class R{constructor(){this.time=0,this.channels=new Map,this.animations=new Map,this.playing=!1,this.lastEngineTime=-1}addChannel(e){const{delay:t=0,duration:n=Number.POSITIVE_INFINITY,rate:i=1,repeat:r=1}=e,s=m++,o={time:0,delay:t,duration:n,rate:i,repeat:r};return this._setChannelTime(o,this.time),this.channels.set(s,o),s}removeChannel(e){this.channels.delete(e);for(const[t,n]of this.animations)n.channel===e&&this.detachAnimation(t)}isFinished(e){const t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;const t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){this.time=Math.max(0,e);const t=this.channels.values();for(const i of t)this._setChannelTime(i,this.time);const n=this.animations.values();for(const i of n){const{animation:e,channel:t}=i;e.setTime(this.getTime(t))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){const n=A++;return this.animations.set(n,{animation:e,channel:t}),e.setTime(this.getTime(t)),n}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){const n=t-e.delay;n>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,n)%e.duration,e.time*=e.rate)}}class T{constructor(e){this.startIndex=-1,this.endIndex=-1,this.factor=0,this.times=[],this.values=[],this._lastTime=-1,this.setKeyFrames(e),this.setTime(0)}setKeyFrames(e){const t=e.length;this.times.length=t,this.values.length=t;for(let n=0;n<t;++n)this.times[n]=e[n][0],this.values[n]=e[n][1];this._calculateKeys(this._lastTime)}setTime(e){(e=Math.max(0,e))!==this._lastTime&&(this._calculateKeys(e),this._lastTime=e)}getStartTime(){return this.times[this.startIndex]}getEndTime(){return this.times[this.endIndex]}getStartData(){return this.values[this.startIndex]}getEndData(){return this.values[this.endIndex]}_calculateKeys(e){let t=0;const n=this.times.length;for(t=0;t<n-2&&!(this.times[t+1]>e);++t);this.startIndex=t,this.endIndex=t+1;const i=this.times[this.startIndex],r=this.times[this.endIndex];this.factor=Math.min(Math.max(0,(e-i)/(r-i)),1)}}var v=n(3145),S=n(469);function b(e,t,n){if(e===t)return!0;if(!n||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(!b(e[i],t[i],n-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){const i=Object.keys(e),r=Object.keys(t);if(i.length!==r.length)return!1;for(const s of i){if(!t.hasOwnProperty(s))return!1;if(!b(e[s],t[s],n-1))return!1}return!0}return!1}var C,y,N,I,L,w=n(7590),P=n(9282);function F(e,t,n){if(!t||t>4)throw new Error("size "+t);const i=t;let r=function(e){const t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(t.constructor.name)}}(e);if("uint8"===r||"sint8"===r){if(1===i||3===i)throw new Error("size: "+t);return n&&(r=r.replace("int","norm")),r+"x"+i}if("uint16"===r||"sint16"===r){if(1===i||3===i)throw new Error("size: "+t);return n&&(r=r.replace("int","norm")),r+"x"+i}return 1===i?r:r+"x"+i}class O{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class M{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}}class x extends M{constructor(){super()}}class D extends x{constructor(e,t,n,i){super(),this.name=e,this.args=t,this.returnType=n,this.body=i}get astNodeType(){return"function"}}class B extends x{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class U extends x{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}}class G extends x{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class k extends x{constructor(e,t,n,i){super(),this.init=e,this.condition=t,this.increment=n,this.body=i}get astNodeType(){return"for"}}class H extends x{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"var"}}class V extends x{constructor(e,t,n){super(),this.name=e,this.type=t,this.value=n}get astNodeType(){return"override"}}class X extends x{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"let"}}class W extends x{constructor(e,t,n,i,r){super(),this.name=e,this.type=t,this.storage=n,this.access=i,this.value=r}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}!function(e){e.increment="++",e.decrement="--"}(C||(C={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for IncrementOperator");return e[n]}}(C||(C={}));class K extends x{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}}!function(e){e.assign="=",e.addAssign="+=",e.subtractAssin="-=",e.multiplyAssign="*=",e.divideAssign="/=",e.moduloAssign="%=",e.andAssign="&=",e.orAssign="|=",e.xorAssign="^=",e.shiftLeftAssign="<<=",e.shiftRightAssign=">>="}(y||(y={})),function(e){e.parse=function(t){const n=t;if("parse"==n)throw new Error("Invalid value for AssignOperator");return e[n]}}(y||(y={}));class z extends x{constructor(e,t,n){super(),this.operator=e,this.variable=t,this.value=n}get astNodeType(){return"assign"}}class Y extends x{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}}class j extends x{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}}class q extends x{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"body"}}class Q extends x{constructor(e,t,n,i){super(),this.condition=e,this.body=t,this.elseif=n,this.else=i}get astNodeType(){return"if"}}class Z extends x{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class J extends x{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class $ extends x{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class ee extends x{constructor(){super()}get astNodeType(){return"discard"}}class te extends x{constructor(){super()}get astNodeType(){return"break"}}class ne extends x{constructor(){super()}get astNodeType(){return"continue"}}class ie extends x{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class re extends ie{constructor(e,t){super(e),this.members=t}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return-1}}class se extends ie{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"template"}}class oe extends ie{constructor(e,t,n,i){super(e),this.storage=t,this.type=n,this.access=i}get astNodeType(){return"pointer"}}class ae extends ie{constructor(e,t,n,i){super(e),this.attributes=t,this.format=n,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class le extends ie{constructor(e,t,n){super(e),this.format=t,this.access=n}get astNodeType(){return"sampler"}}class ce extends M{constructor(){super()}}class ue extends ce{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class he extends ce{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}}class _e extends ce{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return 180*this.args[0].evaluate(e)/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class de extends ce{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class fe extends ce{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}evaluate(e){var t,n;if(this.initializer instanceof he){const i=null===(t=this.postfix)||void 0===t?void 0:t.evaluateString(e),r=null===(n=this.initializer.type)||void 0===n?void 0:n.name,s=e.structs.get(r),o=null==s?void 0:s.getMemberIndex(i);if(-1!=o){return this.initializer.args[o].evaluate(e)}console.log(o)}return this.initializer.evaluate(e)}}class pe extends ce{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Ee extends ce{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}}class ge extends ce{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class me extends ce{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class Ae extends ce{constructor(){super()}}class Re extends Ae{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class Te extends Ae{constructor(e,t,n){super(),this.operator=e,this.left=t,this.right=n}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error("Unknown operator "+this.operator)}}}class ve extends M{constructor(){super()}}class Se extends ve{constructor(e,t){super(),this.selector=e,this.body=t}get astNodeType(){return"case"}}class be extends ve{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class Ce extends M{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"argument"}}class ye extends M{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}}class Ne extends M{constructor(e,t,n){super(),this.name=e,this.type=t,this.attributes=n}get astNodeType(){return"member"}}class Ie extends M{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}!function(e){e[e.token=0]="token",e[e.keyword=1]="keyword",e[e.reserved=2]="reserved"}(I||(I={}));class Le{constructor(e,t,n){this.name=e,this.type=t,this.rule=n}toString(){return this.name}}class we{}N=we,we.none=new Le("",I.reserved,""),we.eof=new Le("EOF",I.token,""),we.reserved={asm:new Le("asm",I.reserved,"asm"),bf16:new Le("bf16",I.reserved,"bf16"),do:new Le("do",I.reserved,"do"),enum:new Le("enum",I.reserved,"enum"),f16:new Le("f16",I.reserved,"f16"),f64:new Le("f64",I.reserved,"f64"),handle:new Le("handle",I.reserved,"handle"),i8:new Le("i8",I.reserved,"i8"),i16:new Le("i16",I.reserved,"i16"),i64:new Le("i64",I.reserved,"i64"),mat:new Le("mat",I.reserved,"mat"),premerge:new Le("premerge",I.reserved,"premerge"),regardless:new Le("regardless",I.reserved,"regardless"),typedef:new Le("typedef",I.reserved,"typedef"),u8:new Le("u8",I.reserved,"u8"),u16:new Le("u16",I.reserved,"u16"),u64:new Le("u64",I.reserved,"u64"),unless:new Le("unless",I.reserved,"unless"),using:new Le("using",I.reserved,"using"),vec:new Le("vec",I.reserved,"vec"),void:new Le("void",I.reserved,"void")},we.keywords={array:new Le("array",I.keyword,"array"),atomic:new Le("atomic",I.keyword,"atomic"),bool:new Le("bool",I.keyword,"bool"),f32:new Le("f32",I.keyword,"f32"),i32:new Le("i32",I.keyword,"i32"),mat2x2:new Le("mat2x2",I.keyword,"mat2x2"),mat2x3:new Le("mat2x3",I.keyword,"mat2x3"),mat2x4:new Le("mat2x4",I.keyword,"mat2x4"),mat3x2:new Le("mat3x2",I.keyword,"mat3x2"),mat3x3:new Le("mat3x3",I.keyword,"mat3x3"),mat3x4:new Le("mat3x4",I.keyword,"mat3x4"),mat4x2:new Le("mat4x2",I.keyword,"mat4x2"),mat4x3:new Le("mat4x3",I.keyword,"mat4x3"),mat4x4:new Le("mat4x4",I.keyword,"mat4x4"),ptr:new Le("ptr",I.keyword,"ptr"),sampler:new Le("sampler",I.keyword,"sampler"),sampler_comparison:new Le("sampler_comparison",I.keyword,"sampler_comparison"),struct:new Le("struct",I.keyword,"struct"),texture_1d:new Le("texture_1d",I.keyword,"texture_1d"),texture_2d:new Le("texture_2d",I.keyword,"texture_2d"),texture_2d_array:new Le("texture_2d_array",I.keyword,"texture_2d_array"),texture_3d:new Le("texture_3d",I.keyword,"texture_3d"),texture_cube:new Le("texture_cube",I.keyword,"texture_cube"),texture_cube_array:new Le("texture_cube_array",I.keyword,"texture_cube_array"),texture_multisampled_2d:new Le("texture_multisampled_2d",I.keyword,"texture_multisampled_2d"),texture_storage_1d:new Le("texture_storage_1d",I.keyword,"texture_storage_1d"),texture_storage_2d:new Le("texture_storage_2d",I.keyword,"texture_storage_2d"),texture_storage_2d_array:new Le("texture_storage_2d_array",I.keyword,"texture_storage_2d_array"),texture_storage_3d:new Le("texture_storage_3d",I.keyword,"texture_storage_3d"),texture_depth_2d:new Le("texture_depth_2d",I.keyword,"texture_depth_2d"),texture_depth_2d_array:new Le("texture_depth_2d_array",I.keyword,"texture_depth_2d_array"),texture_depth_cube:new Le("texture_depth_cube",I.keyword,"texture_depth_cube"),texture_depth_cube_array:new Le("texture_depth_cube_array",I.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new Le("texture_depth_multisampled_2d",I.keyword,"texture_depth_multisampled_2d"),texture_external:new Le("texture_external",I.keyword,"texture_external"),u32:new Le("u32",I.keyword,"u32"),vec2:new Le("vec2",I.keyword,"vec2"),vec3:new Le("vec3",I.keyword,"vec3"),vec4:new Le("vec4",I.keyword,"vec4"),bitcast:new Le("bitcast",I.keyword,"bitcast"),block:new Le("block",I.keyword,"block"),break:new Le("break",I.keyword,"break"),case:new Le("case",I.keyword,"case"),continue:new Le("continue",I.keyword,"continue"),continuing:new Le("continuing",I.keyword,"continuing"),default:new Le("default",I.keyword,"default"),discard:new Le("discard",I.keyword,"discard"),else:new Le("else",I.keyword,"else"),enable:new Le("enable",I.keyword,"enable"),fallthrough:new Le("fallthrough",I.keyword,"fallthrough"),false:new Le("false",I.keyword,"false"),fn:new Le("fn",I.keyword,"fn"),for:new Le("for",I.keyword,"for"),function:new Le("function",I.keyword,"function"),if:new Le("if",I.keyword,"if"),let:new Le("let",I.keyword,"let"),const:new Le("const",I.keyword,"const"),loop:new Le("loop",I.keyword,"loop"),while:new Le("while",I.keyword,"while"),private:new Le("private",I.keyword,"private"),read:new Le("read",I.keyword,"read"),read_write:new Le("read_write",I.keyword,"read_write"),return:new Le("return",I.keyword,"return"),storage:new Le("storage",I.keyword,"storage"),switch:new Le("switch",I.keyword,"switch"),true:new Le("true",I.keyword,"true"),alias:new Le("alias",I.keyword,"alias"),type:new Le("type",I.keyword,"type"),uniform:new Le("uniform",I.keyword,"uniform"),var:new Le("var",I.keyword,"var"),override:new Le("override",I.keyword,"override"),workgroup:new Le("workgroup",I.keyword,"workgroup"),write:new Le("write",I.keyword,"write"),r8unorm:new Le("r8unorm",I.keyword,"r8unorm"),r8snorm:new Le("r8snorm",I.keyword,"r8snorm"),r8uint:new Le("r8uint",I.keyword,"r8uint"),r8sint:new Le("r8sint",I.keyword,"r8sint"),r16uint:new Le("r16uint",I.keyword,"r16uint"),r16sint:new Le("r16sint",I.keyword,"r16sint"),r16float:new Le("r16float",I.keyword,"r16float"),rg8unorm:new Le("rg8unorm",I.keyword,"rg8unorm"),rg8snorm:new Le("rg8snorm",I.keyword,"rg8snorm"),rg8uint:new Le("rg8uint",I.keyword,"rg8uint"),rg8sint:new Le("rg8sint",I.keyword,"rg8sint"),r32uint:new Le("r32uint",I.keyword,"r32uint"),r32sint:new Le("r32sint",I.keyword,"r32sint"),r32float:new Le("r32float",I.keyword,"r32float"),rg16uint:new Le("rg16uint",I.keyword,"rg16uint"),rg16sint:new Le("rg16sint",I.keyword,"rg16sint"),rg16float:new Le("rg16float",I.keyword,"rg16float"),rgba8unorm:new Le("rgba8unorm",I.keyword,"rgba8unorm"),rgba8unorm_srgb:new Le("rgba8unorm_srgb",I.keyword,"rgba8unorm_srgb"),rgba8snorm:new Le("rgba8snorm",I.keyword,"rgba8snorm"),rgba8uint:new Le("rgba8uint",I.keyword,"rgba8uint"),rgba8sint:new Le("rgba8sint",I.keyword,"rgba8sint"),bgra8unorm:new Le("bgra8unorm",I.keyword,"bgra8unorm"),bgra8unorm_srgb:new Le("bgra8unorm_srgb",I.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new Le("rgb10a2unorm",I.keyword,"rgb10a2unorm"),rg11b10float:new Le("rg11b10float",I.keyword,"rg11b10float"),rg32uint:new Le("rg32uint",I.keyword,"rg32uint"),rg32sint:new Le("rg32sint",I.keyword,"rg32sint"),rg32float:new Le("rg32float",I.keyword,"rg32float"),rgba16uint:new Le("rgba16uint",I.keyword,"rgba16uint"),rgba16sint:new Le("rgba16sint",I.keyword,"rgba16sint"),rgba16float:new Le("rgba16float",I.keyword,"rgba16float"),rgba32uint:new Le("rgba32uint",I.keyword,"rgba32uint"),rgba32sint:new Le("rgba32sint",I.keyword,"rgba32sint"),rgba32float:new Le("rgba32float",I.keyword,"rgba32float"),static_assert:new Le("static_assert",I.keyword,"static_assert")},we.tokens={decimal_float_literal:new Le("decimal_float_literal",I.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new Le("hex_float_literal",I.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new Le("int_literal",I.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new Le("uint_literal",I.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new Le("ident",I.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new Le("and",I.token,"&"),and_and:new Le("and_and",I.token,"&&"),arrow:new Le("arrow ",I.token,"->"),attr:new Le("attr",I.token,"@"),attr_left:new Le("attr_left",I.token,"[["),attr_right:new Le("attr_right",I.token,"]]"),forward_slash:new Le("forward_slash",I.token,"/"),bang:new Le("bang",I.token,"!"),bracket_left:new Le("bracket_left",I.token,"["),bracket_right:new Le("bracket_right",I.token,"]"),brace_left:new Le("brace_left",I.token,"{"),brace_right:new Le("brace_right",I.token,"}"),colon:new Le("colon",I.token,":"),comma:new Le("comma",I.token,","),equal:new Le("equal",I.token,"="),equal_equal:new Le("equal_equal",I.token,"=="),not_equal:new Le("not_equal",I.token,"!="),greater_than:new Le("greater_than",I.token,">"),greater_than_equal:new Le("greater_than_equal",I.token,">="),shift_right:new Le("shift_right",I.token,">>"),less_than:new Le("less_than",I.token,"<"),less_than_equal:new Le("less_than_equal",I.token,"<="),shift_left:new Le("shift_left",I.token,"<<"),modulo:new Le("modulo",I.token,"%"),minus:new Le("minus",I.token,"-"),minus_minus:new Le("minus_minus",I.token,"--"),period:new Le("period",I.token,"."),plus:new Le("plus",I.token,"+"),plus_plus:new Le("plus_plus",I.token,"++"),or:new Le("or",I.token,"|"),or_or:new Le("or_or",I.token,"||"),paren_left:new Le("paren_left",I.token,"("),paren_right:new Le("paren_right",I.token,")"),semicolon:new Le("semicolon",I.token,";"),star:new Le("star",I.token,"*"),tilde:new Le("tilde",I.token,"~"),underscore:new Le("underscore",I.token,"_"),xor:new Le("xor",I.token,"^"),plus_equal:new Le("plus_equal",I.token,"+="),minus_equal:new Le("minus_equal",I.token,"-="),times_equal:new Le("times_equal",I.token,"*="),division_equal:new Le("division_equal",I.token,"/="),modulo_equal:new Le("modulo_equal",I.token,"%="),and_equal:new Le("and_equal",I.token,"&="),or_equal:new Le("or_equal",I.token,"|="),xor_equal:new Le("xor_equal",I.token,"^="),shift_right_equal:new Le("shift_right_equal",I.token,">>="),shift_left_equal:new Le("shift_left_equal",I.token,"<<=")},we.storage_class=[N.keywords.function,N.keywords.private,N.keywords.workgroup,N.keywords.uniform,N.keywords.storage],we.access_mode=[N.keywords.read,N.keywords.write,N.keywords.read_write],we.sampler_type=[N.keywords.sampler,N.keywords.sampler_comparison],we.sampled_texture_type=[N.keywords.texture_1d,N.keywords.texture_2d,N.keywords.texture_2d_array,N.keywords.texture_3d,N.keywords.texture_cube,N.keywords.texture_cube_array],we.multisampled_texture_type=[N.keywords.texture_multisampled_2d],we.storage_texture_type=[N.keywords.texture_storage_1d,N.keywords.texture_storage_2d,N.keywords.texture_storage_2d_array,N.keywords.texture_storage_3d],we.depth_texture_type=[N.keywords.texture_depth_2d,N.keywords.texture_depth_2d_array,N.keywords.texture_depth_cube,N.keywords.texture_depth_cube_array,N.keywords.texture_depth_multisampled_2d],we.texture_external_type=[N.keywords.texture_external],we.any_texture_type=[...N.sampled_texture_type,...N.multisampled_texture_type,...N.storage_texture_type,...N.depth_texture_type,...N.texture_external_type],we.texel_format=[N.keywords.r8unorm,N.keywords.r8snorm,N.keywords.r8uint,N.keywords.r8sint,N.keywords.r16uint,N.keywords.r16sint,N.keywords.r16float,N.keywords.rg8unorm,N.keywords.rg8snorm,N.keywords.rg8uint,N.keywords.rg8sint,N.keywords.r32uint,N.keywords.r32sint,N.keywords.r32float,N.keywords.rg16uint,N.keywords.rg16sint,N.keywords.rg16float,N.keywords.rgba8unorm,N.keywords.rgba8unorm_srgb,N.keywords.rgba8snorm,N.keywords.rgba8uint,N.keywords.rgba8sint,N.keywords.bgra8unorm,N.keywords.bgra8unorm_srgb,N.keywords.rgb10a2unorm,N.keywords.rg11b10float,N.keywords.rg32uint,N.keywords.rg32sint,N.keywords.rg32float,N.keywords.rgba16uint,N.keywords.rgba16sint,N.keywords.rgba16float,N.keywords.rgba32uint,N.keywords.rgba32sint,N.keywords.rgba32float],we.const_literal=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal,N.keywords.true,N.keywords.false],we.literal_or_ident=[N.tokens.ident,N.tokens.int_literal,N.tokens.uint_literal,N.tokens.decimal_float_literal,N.tokens.hex_float_literal],we.element_count_expression=[N.tokens.int_literal,N.tokens.uint_literal,N.tokens.ident],we.template_types=[N.keywords.vec2,N.keywords.vec3,N.keywords.vec4,N.keywords.mat2x2,N.keywords.mat2x3,N.keywords.mat2x4,N.keywords.mat3x2,N.keywords.mat3x3,N.keywords.mat3x4,N.keywords.mat4x2,N.keywords.mat4x3,N.keywords.mat4x4,N.keywords.atomic,N.keywords.bitcast,...N.any_texture_type],we.attribute_name=[N.tokens.ident,N.keywords.block],we.assignment_operators=[N.tokens.equal,N.tokens.plus_equal,N.tokens.minus_equal,N.tokens.times_equal,N.tokens.division_equal,N.tokens.modulo_equal,N.tokens.and_equal,N.tokens.or_equal,N.tokens.xor_equal,N.tokens.shift_right_equal,N.tokens.shift_left_equal],we.increment_operators=[N.tokens.plus_plus,N.tokens.minus_minus];class Pe{constructor(e,t,n){this.type=e,this.lexeme=t,this.line=n}toString(){return this.lexeme}isTemplateType(){return-1!=we.template_types.indexOf(this.type)}isArrayType(){return this.type==we.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class Fe{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw"Invalid syntax at line "+this._line;return this._tokens.push(new Pe(we.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0;){if(this._isAtEnd())return!0;if(e=this._advance(),"\n"==e)this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),t--,0==t))return!0}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++)}return!0}}let t=we.none;for(;;){let n=this._findType(e);const i=this._peekAhead();if(">"==e&&(">"==i||"="==i)){let e=!1,t=this._tokens.length-1;for(let n=0;n<5&&t>=0;++n,--t)if(this._tokens[t].type===we.tokens.less_than){t>0&&this._tokens[t-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(n),!0}if(n===we.none){let i=e,r=0;const s=2;for(let e=0;e<s;++e)if(i+=this._peekAhead(e),n=this._findType(i),n!==we.none){r=e;break}if(n===we.none)return t!==we.none&&(this._current--,this._addToken(t),!0);e=i,this._current+=r+1}if(t=n,this._isAtEnd())break;e+=this._advance()}return t!==we.none&&(this._addToken(t),!0)}_findType(e){for(const t in we.keywords){const n=we.keywords[t];if(this._match(e,n.rule))return n}for(const t in we.tokens){const n=we.tokens[t];if(this._match(e,n.rule))return n}return we.none}_match(e,t){if("string"==typeof t){if(t==e)return!0}else{const n=t.exec(e);if(n&&0==n.index&&n[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return" "==e||"\t"==e||"\r"==e}_advance(e){void 0===e&&(e=0);let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e){return void 0===e&&(e=0),e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const t=this._source.substring(this._start,this._current);this._tokens.push(new Pe(e,t,this._line))}}class Oe{constructor(){this._tokens=[],this._current=0,this._context=new O}parse(e){this._initialize(e);let t=[];for(;!this._isAtEnd();){const e=this._global_decl_or_directive();if(!e)break;t.push(e)}return t}_initialize(e){if(e)if("string"==typeof e){const t=new Fe(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,t){return console.error(e,t),{token:e,message:t,toString:function(){return""+t}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==we.eof}_match(e){if(e instanceof Le)return!!this._check(e)&&(this._advance(),!0);for(let t=0,n=e.length;t<n;++t){const n=e[t];if(this._check(n))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),t)}_check(e){if(this._isAtEnd())return!1;const t=this._peek();if(e instanceof Array){let n=t.type;return-1!=e.indexOf(n)}return t.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(we.tokens.semicolon)&&!this._isAtEnd(););if(this._match(we.keywords.alias)){const e=this._type_alias();return this._consume(we.tokens.semicolon,"Expected ';'"),e}if(this._match(we.keywords.enable)){const e=this._enable_directive();return this._consume(we.tokens.semicolon,"Expected ';'"),e}const e=this._attribute();if(this._check(we.keywords.var)){const t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),t}if(this._check(we.keywords.override)){const t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),t}if(this._check(we.keywords.let)){const t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),t}if(this._check(we.keywords.const)){const t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(we.tokens.semicolon,"Expected ';'."),t}if(this._check(we.keywords.struct)){const t=this._struct_decl();return null!=t&&(t.attributes=e),t}if(this._check(we.keywords.fn)){const t=this._function_decl();return null!=t&&(t.attributes=e),t}return null}_function_decl(){if(!this._match(we.keywords.fn))return null;const e=this._consume(we.tokens.ident,"Expected function name.").toString();this._consume(we.tokens.paren_left,"Expected '(' for function arguments.");const t=[];if(!this._check(we.tokens.paren_right))do{if(this._check(we.tokens.paren_right))break;const e=this._attribute(),n=this._consume(we.tokens.ident,"Expected argument name.").toString();this._consume(we.tokens.colon,"Expected ':' for argument type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i,t.push(new Ce(n,r,e)))}while(this._match(we.tokens.comma));this._consume(we.tokens.paren_right,"Expected ')' after function arguments.");let n=null;if(this._match(we.tokens.arrow)){const e=this._attribute();n=this._type_decl(),null!=n&&(n.attributes=e)}const i=this._compound_statement();return new D(e,t,n,i)}_compound_statement(){const e=[];for(this._consume(we.tokens.brace_left,"Expected '{' for block.");!this._check(we.tokens.brace_right);){const t=this._statement();null!==t&&e.push(t)}return this._consume(we.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(we.tokens.semicolon)&&!this._isAtEnd(););if(this._check(we.keywords.if))return this._if_statement();if(this._check(we.keywords.switch))return this._switch_statement();if(this._check(we.keywords.loop))return this._loop_statement();if(this._check(we.keywords.for))return this._for_statement();if(this._check(we.keywords.while))return this._while_statement();if(this._check(we.keywords.continuing))return this._continuing_statement();if(this._check(we.keywords.static_assert))return this._static_assert_statement();if(this._check(we.tokens.brace_left))return this._compound_statement();let e=null;return e=this._check(we.keywords.return)?this._return_statement():this._check([we.keywords.var,we.keywords.let,we.keywords.const])?this._variable_statement():this._match(we.keywords.discard)?new ee:this._match(we.keywords.break)?new te:this._match(we.keywords.continue)?new ne:this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),null!=e&&this._consume(we.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(we.keywords.static_assert))return null;let e=this._optional_paren_expression();return new B(e)}_while_statement(){if(!this._match(we.keywords.while))return null;let e=this._optional_paren_expression();const t=this._compound_statement();return new U(e,t)}_continuing_statement(){if(!this._match(we.keywords.continuing))return null;const e=this._compound_statement();return new G(e)}_for_statement(){if(!this._match(we.keywords.for))return null;this._consume(we.tokens.paren_left,"Expected '('.");const e=this._check(we.tokens.semicolon)?null:this._for_init();this._consume(we.tokens.semicolon,"Expected ';'.");const t=this._check(we.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(we.tokens.semicolon,"Expected ';'.");const n=this._check(we.tokens.paren_right)?null:this._for_increment();this._consume(we.tokens.paren_right,"Expected ')'.");const i=this._compound_statement();return new k(e,t,n,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(we.keywords.var)){const e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(we.tokens.equal)&&(t=this._short_circuit_or_expression()),new H(e.name,e.type,e.storage,e.access,t)}if(this._match(we.keywords.let)){const e=this._consume(we.tokens.ident,"Expected name for let.").toString();let t=null;if(this._match(we.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(we.tokens.equal,"Expected '=' for let.");const n=this._short_circuit_or_expression();return new X(e,t,null,null,n)}if(this._match(we.keywords.const)){const e=this._consume(we.tokens.ident,"Expected name for const.").toString();let t=null;if(this._match(we.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}this._consume(we.tokens.equal,"Expected '=' for const.");const n=this._short_circuit_or_expression();return new W(e,t,null,null,n)}return null}_increment_decrement_statement(){const e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(we.increment_operators))return this._current=e,null;const n=this._consume(we.increment_operators,"Expected increment operator");return new K(n.type===we.tokens.plus_plus?C.increment:C.decrement,t)}_assignment_statement(){let e=null;if(this._check(we.tokens.brace_right))return null;let t=this._match(we.tokens.underscore);if(t||(e=this._unary_expression()),!t&&null==e)return null;const n=this._consume(we.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new z(y.parse(n.lexeme),e,i)}_func_call_statement(){if(!this._check(we.tokens.ident))return null;const e=this._current,t=this._consume(we.tokens.ident,"Expected function name."),n=this._argument_expression_list();return null===n?(this._current=e,null):new Y(t.lexeme,n)}_loop_statement(){if(!this._match(we.keywords.loop))return null;this._consume(we.tokens.brace_left,"Expected '{' for loop.");const e=[];let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let n of t)e.push(n);else e.push(t);t=this._statement()}let n=null;return this._match(we.keywords.continuing)&&(n=this._compound_statement()),this._consume(we.tokens.brace_right,"Expected '}' for loop."),new j(e,n)}_switch_statement(){if(!this._match(we.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(we.tokens.brace_left,"Expected '{' for switch.");const t=this._switch_body();if(null==t||0==t.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(we.tokens.brace_right,"Expected '}' for switch."),new q(e,t)}_switch_body(){const e=[];if(this._match(we.keywords.case)){const t=this._case_selectors();this._match(we.tokens.colon),this._consume(we.tokens.brace_left,"Exected '{' for switch case.");const n=this._case_body();this._consume(we.tokens.brace_right,"Exected '}' for switch case."),e.push(new Se(t,n))}if(this._match(we.keywords.default)){this._match(we.tokens.colon),this._consume(we.tokens.brace_left,"Exected '{' for switch default.");const t=this._case_body();this._consume(we.tokens.brace_right,"Exected '}' for switch default."),e.push(new be(t))}if(this._check([we.keywords.default,we.keywords.case])){const t=this._switch_body();e.push(t[0])}return e}_case_selectors(){var e,t,n,i;const r=[null!==(t=null===(e=this._shift_expression())||void 0===e?void 0:e.evaluate(this._context).toString())&&void 0!==t?t:""];for(;this._match(we.tokens.comma);)r.push(null!==(i=null===(n=this._shift_expression())||void 0===n?void 0:n.evaluate(this._context).toString())&&void 0!==i?i:"");return r}_case_body(){if(this._match(we.keywords.fallthrough))return this._consume(we.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);const t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(we.keywords.if))return null;const e=this._optional_paren_expression(),t=this._compound_statement();let n=[];this._match_elseif()&&(n=this._elseif_statement(n));let i=null;return this._match(we.keywords.else)&&(i=this._compound_statement()),new Q(e,t,n,i)}_match_elseif(){return this._tokens[this._current].type===we.keywords.else&&this._tokens[this._current+1].type===we.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e){void 0===e&&(e=[]);const t=this._optional_paren_expression(),n=this._compound_statement();return e.push(new ye(t,n)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(we.keywords.return))return null;const e=this._short_circuit_or_expression();return new Z(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(we.tokens.or_or);)e=new Te(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(we.tokens.and_and);)e=new Te(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(we.tokens.or);)e=new Te(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(we.tokens.xor);)e=new Te(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(we.tokens.and);)e=new Te(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([we.tokens.equal_equal,we.tokens.not_equal])?new Te(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([we.tokens.less_than,we.tokens.greater_than,we.tokens.less_than_equal,we.tokens.greater_than_equal]);)e=new Te(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([we.tokens.shift_left,we.tokens.shift_right]);)e=new Te(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([we.tokens.plus,we.tokens.minus]);)e=new Te(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([we.tokens.star,we.tokens.forward_slash,we.tokens.modulo]);)e=new Te(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([we.tokens.minus,we.tokens.bang,we.tokens.tilde,we.tokens.star,we.tokens.and])?new Re(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(we.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(we.tokens.bracket_right,"Expected ']'.");const t=this._postfix_expression();return t&&(e.postfix=t),e}if(this._match(we.tokens.period)){const e=this._consume(we.tokens.ident,"Expected member name."),t=this._postfix_expression(),n=new ue(e.lexeme);return t&&(n.postfix=t),n}return null}_getStruct(e){if(this._context.aliases.has(e)){return this._context.aliases.get(e).type}if(this._context.structs.has(e)){return this._context.structs.get(e)}return null}_primary_expression(){if(this._match(we.tokens.ident)){const e=this._previous().toString();if(this._check(we.tokens.paren_left)){const t=this._argument_expression_list(),n=this._getStruct(e);return null!=n?new he(n,t):new _e(e,t)}if(this._context.constants.has(e)){const t=this._context.constants.get(e);return new fe(e,t.value)}return new de(e)}if(this._match(we.const_literal))return new pe(parseFloat(this._previous().toString()));if(this._check(we.tokens.paren_left))return this._paren_expression();if(this._match(we.keywords.bitcast)){this._consume(we.tokens.less_than,"Expected '<'.");const e=this._type_decl();this._consume(we.tokens.greater_than,"Expected '>'.");const t=this._paren_expression();return new Ee(e,t)}const e=this._type_decl(),t=this._argument_expression_list();return new ge(e,t)}_argument_expression_list(){if(!this._match(we.tokens.paren_left))return null;const e=[];do{if(this._check(we.tokens.paren_right))break;const t=this._short_circuit_or_expression();e.push(t)}while(this._match(we.tokens.comma));return this._consume(we.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(we.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(we.tokens.paren_right),new me([e])}_paren_expression(){this._consume(we.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(we.tokens.paren_right,"Expected ')'."),new me([e])}_struct_decl(){if(!this._match(we.keywords.struct))return null;const e=this._consume(we.tokens.ident,"Expected name for struct.").toString();this._consume(we.tokens.brace_left,"Expected '{' for struct body.");const t=[];for(;!this._check(we.tokens.brace_right);){const e=this._attribute(),n=this._consume(we.tokens.ident,"Expected variable name.").toString();this._consume(we.tokens.colon,"Expected ':' for struct member type.");const i=this._attribute(),r=this._type_decl();null!=r&&(r.attributes=i),this._check(we.tokens.brace_right)?this._match(we.tokens.comma):this._consume(we.tokens.comma,"Expected ',' for struct member."),t.push(new Ne(n,r,e))}this._consume(we.tokens.brace_right,"Expected '}' after struct body.");const n=new re(e,t);return this._context.structs.set(e,n),n}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(we.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(we.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(we.keywords.const))return null;const e=this._consume(we.tokens.ident,"Expected variable name");let t=null;if(this._match(we.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;if(this._match(we.tokens.equal)){const e=this._short_circuit_or_expression();if(e instanceof he)n=e;else if(e instanceof fe&&e.initializer instanceof he)n=e.initializer;else try{const t=e.evaluate(this._context);n=new pe(t)}catch(N){n=e}}const i=new W(e.toString(),t,"","",n);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(we.keywords.let))return null;const e=this._consume(we.tokens.ident,"Expected variable name");let t=null;if(this._match(we.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}let n=null;return this._match(we.tokens.equal)&&(n=this._const_expression()),new X(e.toString(),t,"","",n)}_const_expression(){if(this._match(we.const_literal))return new ue(this._previous().toString());const e=this._type_decl();this._consume(we.tokens.paren_left,"Expected '('.");let t=[];for(;!this._check(we.tokens.paren_right)&&(t.push(this._const_expression()),this._check(we.tokens.comma));)this._advance();return this._consume(we.tokens.paren_right,"Expected ')'."),new he(e,t)}_variable_decl(){if(!this._match(we.keywords.var))return null;let e="",t="";this._match(we.tokens.less_than)&&(e=this._consume(we.storage_class,"Expected storage_class.").toString(),this._match(we.tokens.comma)&&(t=this._consume(we.access_mode,"Expected access_mode.").toString()),this._consume(we.tokens.greater_than,"Expected '>'."));const n=this._consume(we.tokens.ident,"Expected variable name");let i=null;if(this._match(we.tokens.colon)){const e=this._attribute();i=this._type_decl(),null!=i&&(i.attributes=e)}return new H(n.toString(),i,e,t,null)}_override_decl(){if(!this._match(we.keywords.override))return null;const e=this._consume(we.tokens.ident,"Expected variable name");let t=null;if(this._match(we.tokens.colon)){const e=this._attribute();t=this._type_decl(),null!=t&&(t.attributes=e)}return new V(e.toString(),t,null)}_enable_directive(){const e=this._consume(we.tokens.ident,"identity expected.");return new J(e.toString())}_type_alias(){const e=this._consume(we.tokens.ident,"identity expected.");this._consume(we.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);const n=new $(e.toString(),t);return this._context.aliases.set(n.name,n),n}_type_decl(){if(this._check([we.tokens.ident,...we.texel_format,we.keywords.bool,we.keywords.f32,we.keywords.i32,we.keywords.u32])){const e=this._advance(),t=e.toString();return this._context.structs.has(t)?this._context.structs.get(t):this._context.aliases.has(t)?this._context.aliases.get(t).type:new ie(e.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(we.template_types)){let e=this._advance().toString(),t=null,n=null;return this._match(we.tokens.less_than)&&(t=this._type_decl(),n=null,this._match(we.tokens.comma)&&(n=this._consume(we.access_mode,"Expected access_mode for pointer").toString()),this._consume(we.tokens.greater_than,"Expected '>' for type.")),new se(e,t,n)}if(this._match(we.keywords.ptr)){let e=this._previous().toString();this._consume(we.tokens.less_than,"Expected '<' for pointer.");const t=this._consume(we.storage_class,"Expected storage_class for pointer");this._consume(we.tokens.comma,"Expected ',' for pointer.");const n=this._type_decl();let i=null;return this._match(we.tokens.comma)&&(i=this._consume(we.access_mode,"Expected access_mode for pointer").toString()),this._consume(we.tokens.greater_than,"Expected '>' for pointer."),new oe(e,t.toString(),n,i)}const t=this._attribute();if(this._match(we.keywords.array)){let e=null,n=-1;const i=this._previous();if(this._match(we.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(we.tokens.comma)){t=this._shift_expression().evaluate(this._context).toString()}this._consume(we.tokens.greater_than,"Expected '>' for array."),n=t?parseInt(t):0}return new ae(i.toString(),t,e,n)}return null}_texture_sampler_types(){if(this._match(we.sampler_type))return new le(this._previous().toString(),null,null);if(this._match(we.depth_texture_type))return new le(this._previous().toString(),null,null);if(this._match(we.sampled_texture_type)||this._match(we.multisampled_texture_type)){const e=this._previous();this._consume(we.tokens.less_than,"Expected '<' for sampler type.");const t=this._type_decl();return this._consume(we.tokens.greater_than,"Expected '>' for sampler type."),new le(e.toString(),t,null)}if(this._match(we.storage_texture_type)){const e=this._previous();this._consume(we.tokens.less_than,"Expected '<' for sampler type.");const t=this._consume(we.texel_format,"Invalid texel format.").toString();this._consume(we.tokens.comma,"Expected ',' after texel format.");const n=this._consume(we.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(we.tokens.greater_than,"Expected '>' for sampler type."),new le(e.toString(),t,n)}return null}_attribute(){let e=[];for(;this._match(we.tokens.attr);){const t=this._consume(we.attribute_name,"Expected attribute name"),n=new Ie(t.toString(),null);if(this._match(we.tokens.paren_left)){if(n.value=this._consume(we.literal_or_ident,"Expected attribute value").toString(),this._check(we.tokens.comma)){this._advance();do{const e=this._consume(we.literal_or_ident,"Expected attribute value").toString();n.value instanceof Array||(n.value=[n.value]),n.value.push(e)}while(this._match(we.tokens.comma))}this._consume(we.tokens.paren_right,"Expected ')'")}e.push(n)}for(;this._match(we.tokens.attr_left);){if(!this._check(we.tokens.attr_right))do{const t=this._consume(we.attribute_name,"Expected attribute name"),n=new Ie(t.toString(),null);if(this._match(we.tokens.paren_left)){if(n.value=[this._consume(we.literal_or_ident,"Expected attribute value").toString()],this._check(we.tokens.comma)){this._advance();do{const e=this._consume(we.literal_or_ident,"Expected attribute value").toString();n.value.push(e)}while(this._match(we.tokens.comma))}this._consume(we.tokens.paren_right,"Expected ')'")}e.push(n)}while(this._match(we.tokens.comma));this._consume(we.tokens.attr_right,"Expected ']]' after attribute declarations")}return 0==e.length?null:e}}class Me{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class xe{constructor(e,t,n){this.name=e,this.type=t,this.attributes=n,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class De extends Me{constructor(e,t){super(e,t),this.members=[],this.align=0}get isStruct(){return!0}}class Be extends Me{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}}class Ue extends Me{constructor(e,t,n,i){super(e,n),this.format=t,this.access=i}get isTemplate(){return!0}}!function(e){e[e.Uniform=0]="Uniform",e[e.Storage=1]="Storage",e[e.Texture=2]="Texture",e[e.Sampler=3]="Sampler",e[e.StorageTexture=4]="StorageTexture"}(L||(L={}));class Ge{constructor(e,t,n,i,r,s,o){this.name=e,this.type=t,this.group=n,this.binding=i,this.attributes=r,this.resourceType=s,this.access=o}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ke{constructor(e,t){this.name=e,this.type=t}}class He{constructor(e,t){this.align=e,this.size=t}}class Ve{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i,this.interpolation=null}}class Xe{constructor(e,t,n,i){this.name=e,this.type=t,this.locationType=n,this.location=i}}class We{constructor(e,t){void 0===t&&(t=null),this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=t}}class Ke{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class ze{constructor(e,t,n,i){this.name=e,this.type=t,this.attributes=n,this.id=i}}class Ye{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new Ke,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}update(e){const t=(new Oe).parse(e);for(const n of t)if(n instanceof re){const e=this._getTypeInfo(n,null);e instanceof De&&this.structs.push(e)}else if(n instanceof $)this.aliases.push(this._getAliasInfo(n));else if(n instanceof V){const e=n,t=this._getAttributeNum(e.attributes,"id",0),i=null!=e.type?this._getTypeInfo(e.type,e.attributes):null;this.overrides.push(new ze(e.name,i,e.attributes,t))}else if(this._isUniformVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=new Ge(e.name,r,t,i,e.attributes,L.Uniform,e.access);this.uniforms.push(s)}else if(this._isStorageVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new Ge(e.name,r,t,i,e.attributes,s?L.StorageTexture:L.Storage,e.access);this.storage.push(o)}else if(this._isTextureVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=this._isStorageTexture(r),o=new Ge(e.name,r,t,i,e.attributes,s?L.StorageTexture:L.Texture,e.access);s?this.storage.push(o):this.textures.push(o)}else if(this._isSamplerVar(n)){const e=n,t=this._getAttributeNum(e.attributes,"group",0),i=this._getAttributeNum(e.attributes,"binding",0),r=this._getTypeInfo(e.type,e.attributes),s=new Ge(e.name,r,t,i,e.attributes,L.Sampler,e.access);this.samplers.push(s)}else if(n instanceof D){const e=this._getAttribute(n,"vertex"),t=this._getAttribute(n,"fragment"),i=this._getAttribute(n,"compute"),r=e||t||i;if(r){const e=new We(n.name,r.name);e.inputs=this._getInputs(n.args),e.outputs=this._getOutputs(n.returnType),this.entry[r.name].push(e)}}else;}getBindGroups(){const e=[];function t(t,n){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),n>=e[t].length&&(e[t].length=n+1)}for(const n of this.uniforms){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.storage){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.textures){t(n.group,n.binding);e[n.group][n.binding]=n}for(const n of this.samplers){t(n.group,n.binding);e[n.group][n.binding]=n}return e}_getOutputs(e,t){if(void 0===t&&(t=void 0),void 0===t&&(t=[]),e instanceof re)this._getStructOutputs(e,t);else{const n=this._getOutputInfo(e);null!==n&&t.push(n)}return t}_getStructOutputs(e,t){for(const n of e.members)if(n.type instanceof re)this._getStructOutputs(n.type,t);else{const e=this._getAttribute(n,"location")||this._getAttribute(n,"builtin");if(null!==e){const i=this._getTypeInfo(n.type,n.type.attributes),r=this._parseInt(e.value),s=new Xe(n.name,i,e.name,r);t.push(s)}}}_getOutputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getTypeInfo(e,e.attributes),i=this._parseInt(t.value);return new Xe("",n,t.name,i)}return null}_getInputs(e,t){void 0===t&&(t=void 0),void 0===t&&(t=[]);for(const n of e)if(n.type instanceof re)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(const n of e.members)if(n.type instanceof re)this._getStructInputs(n.type,t);else{const e=this._getInputInfo(n);null!==e&&t.push(e)}}_getInputInfo(e){const t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){const n=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),r=this._parseInt(t.value),s=new Ve(e.name,i,t.name,r);return null!==n&&(s.interpolation=this._parseString(n.value)),s}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(const t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new ke(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,t){if(this._types.has(e))return this._types.get(e);if(e instanceof ae){const n=e,i=this._getTypeInfo(n.format,n.attributes),r=new Be(n.name,t);return r.format=i,r.count=n.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof re){const n=e,i=new De(n.name,t);for(const e of n.members){const t=this._getTypeInfo(e.type,e.attributes);i.members.push(new xe(e.name,t,e.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof le){const n=e,i=n.format instanceof ie,r=n.format?i?this._getTypeInfo(n.format,null):new Me(n.format,null):null,s=new Ue(n.name,r,t,n.access);return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof se){const n=e,i=n.format?this._getTypeInfo(n.format,null):null,r=new Ue(n.name,i,t,n.access);return this._types.set(e,r),this._updateTypeInfo(r),r}const n=new Me(e.name,t);return this._types.set(e,n),this._updateTypeInfo(n),n}_updateTypeInfo(e){var t,n;const i=this._getTypeSize(e);if(e.size=null!==(t=null==i?void 0:i.size)&&void 0!==t?t:0,e instanceof Be){const t=this._getTypeSize(e.format);e.stride=null!==(n=null==t?void 0:t.size)&&void 0!==n?n:0,this._updateTypeInfo(e.format)}e instanceof De&&this._updateStructInfo(e)}_updateStructInfo(e){var t;let n=0,i=0,r=0,s=0;for(let o=0,a=e.members.length;o<a;++o){const a=e.members[o],l=this._getTypeSize(a);if(!l)continue;null!==(t=this._getAlias(a.type.name))&&void 0!==t||a.type;const c=l.align,u=l.size;n=this._roundUp(c,n+i),i=u,r=n,s=Math.max(s,c),a.offset=n,a.size=u,this._updateTypeInfo(a.type)}e.size=this._roundUp(s,r+i),e.align=s}_getTypeSize(e){var t;if(null==e)return null;const n=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof xe&&(e=e.type),e instanceof Me){const t=this._getAlias(e.name);null!==t&&(e=t)}{const t=Ye._typeInfo[e.name];if(void 0!==t){const r="f16"===e.format?2:1;return new He(Math.max(i,t.align/r),Math.max(n,t.size/r))}}{const t=Ye._typeInfo[e.name.substring(0,e.name.length-1)];if(t){const r="h"===e.name[e.name.length-1]?2:1;return new He(Math.max(i,t.align/r),Math.max(n,t.size/r))}}if(e instanceof Be){let r=e,s=8,o=8;const a=this._getTypeSize(r.format);null!==a&&(o=a.size,s=a.align);return o=r.count*this._getAttributeNum(null!==(t=null==e?void 0:e.attributes)&&void 0!==t?t:null,"stride",this._roundUp(s,o)),n&&(o=n),new He(Math.max(i,s),Math.max(n,o))}if(e instanceof De){let t=0,r=0,s=0,o=0,a=0;for(const n of e.members){const e=this._getTypeSize(n.type);null!==e&&(t=Math.max(e.align,t),s=this._roundUp(e.align,s+o),o=e.size,a=s)}return r=this._roundUp(t,a+o),new He(Math.max(i,t),Math.max(n,r))}return null}_isUniformVar(e){return e instanceof H&&"uniform"==e.storage}_isStorageVar(e){return e instanceof H&&"storage"==e.storage}_isTextureVar(e){return e instanceof H&&null!==e.type&&-1!=Ye._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof H&&null!==e.type&&-1!=Ye._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){const n=e;if(!n||!n.attributes)return null;const i=n.attributes;for(let r of i)if(r.name==t)return r;return null}_getAttributeNum(e,t,n){if(null===e)return n;for(let i of e)if(i.name==t){let e=null!==i&&null!==i.value?i.value:n;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):n}return n}_roundUp(e,t){return Math.ceil(t/e)*e}}function je(e){const t={attributes:[],bindings:[]},n=function(e){try{return new Ye(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&null!=t&&t.message&&(e+=": "+t.message+" "),"object"==typeof t&&null!=t&&t.token&&(e+=t.token.line||""),new Error(e,{cause:t})}}(e);for(const s of n.uniforms){const e=[];for(const t of s.type.members)e.push({name:t.name,type:qe(t.type)});t.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:e})}const i=n.entry.vertex[0],r=i.inputs.length;for(let s=0;s<r;s++){const e=i.inputs[s];if("location"===e.locationType){const n=qe(e.type);t.attributes.push({name:e.name,location:e.location,type:n})}}return t}function qe(e){return e.format?e.name+"<"+e.format.name+">":e.name}function Qe(e,t){if(!e)throw new Error(t||"shadertools: assertion failed.")}Ye._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},Ye._textureTypes=we.any_texture_type.map((e=>e.name)),Ye._samplerTypes=we.sampler_type.map((e=>e.name));const Ze={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function Je(e){let t=$e(e);if("object"!==t)return{value:e,...Ze[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...Ze[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=$e(e.value),{...e,...Ze[t],type:t}):{type:"object",value:null};throw new Error("props")}function $e(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}const et=e=>""+e;var tt,nt;function it(e,t){return t||(t=e.slice(0)),e.raw=t,e}const rt={vertex:et(tt||(tt=it(["#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"],["\\\n#ifdef MODULE_LOGDEPTH\n  logdepth_adjustPosition(gl_Position);\n#endif\n"]))),fragment:et(nt||(nt=it(["#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"],["\\\n#ifdef MODULE_MATERIAL\n  gl_FragColor = material_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LIGHTING\n  gl_FragColor = lighting_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_FOG\n  gl_FragColor = fog_filterColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_PICKING\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n#endif\n\n#ifdef MODULE_LOGDEPTH\n  logdepth_setFragDepth();\n#endif\n"])))},st=/void\s+main\s*\([^)]*\)\s*\{\n?/,ot=/}\n?[^{}]*$/,at=[],lt="__LUMA_INJECT_DECLARATIONS__";function ct(e){const t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(t)}}function ut(e,t,n,i){void 0===i&&(i=!1);const r="vertex"===t;for(const s in n){const t=n[s];t.sort(((e,t)=>e.order-t.order)),at.length=t.length;for(let e=0,n=t.length;e<n;++e)at[e]=t[e].injection;const i=at.join("\n")+"\n";switch(s){case"vs:#decl":r&&(e=e.replace(lt,i));break;case"vs:#main-start":r&&(e=e.replace(st,(e=>e+i)));break;case"vs:#main-end":r&&(e=e.replace(ot,(e=>i+e)));break;case"fs:#decl":r||(e=e.replace(lt,i));break;case"fs:#main-start":r||(e=e.replace(st,(e=>e+i)));break;case"fs:#main-end":r||(e=e.replace(ot,(e=>i+e)));break;default:e=e.replace(s,(e=>e+i))}}return e=e.replace(lt,""),i&&(e=e.replace(/\}\s*$/,(e=>e+rt[t]))),e}let ht=1;class _t{static instantiateModules(e){return e.map((e=>{if(e instanceof _t)return e;Qe("string"!=typeof e,"Shader module use by name is deprecated. Import shader module '"+JSON.stringify(e)+"' and use it directly."),e.name||(console.warn("shader module has no name"),e.name="shader-module-"+ht++);const t=new _t(e);return t.dependencies=_t.instantiateModules(e.dependencies||[]),t}))}constructor(e){this.uniforms={},this.uniformTypes={};const{name:t,vs:n,fs:i,dependencies:r=[],uniformPropTypes:s={},getUniforms:o,deprecations:a=[],defines:l={},inject:c={}}=e;Qe("string"==typeof t),this.name=t,this.vs=n,this.fs=i,this.getModuleUniforms=o,this.dependencies=_t.instantiateModules(r),this.deprecations=this._parseDeprecationDefinitions(a),this.defines=l,this.injections=function(e){const t={vertex:{},fragment:{}};for(const n in e){let i=e[n];"string"==typeof i&&(i={order:0,injection:i}),t[ct(n)][n]=i}return t}(c),s&&(this.uniforms=function(e){const t={};for(const[n,i]of Object.entries(e))t[n]=Je(i);return t}(s))}getModuleSource(e){let t;switch(e){case"vertex":t=this.vs||"";break;case"fragment":t=this.fs||"";break;default:Qe(!1)}const n=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return"// ----- MODULE "+this.name+" ---------------\n\n#define MODULE_"+n+"\n"+t+"\n\n"}getUniforms(e,t){return this.getModuleUniforms?this.getModuleUniforms(e,t):function(e,t,n){const i={};for(const[r,s]of Object.entries(t))e&&r in e&&!s.private?(s.validate&&Qe(s.validate(e[r],s),n+": invalid "+r),i[r]=e[r]):i[r]=s.value;return i}(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,t){this.deprecations.forEach((n=>{var i;null!=(i=n.regex)&&i.test(e)&&(n.deprecated?t.deprecated(n.old,n.new)():t.removed(n.old,n.new)())}))}_parseDeprecationDefinitions(e){return e.forEach((e=>{if("function"===e.type)e.regex=new RegExp("\\b"+e.old+"\\(");else e.regex=new RegExp(e.type+" "+e.old+";")})),e}_defaultGetUniforms(e){void 0===e&&(e={});const t={},n=this.uniforms;for(const i in n){const r=n[i];i in e&&!r.private?(r.validate&&Qe(r.validate(e[i],r),this.name+": invalid "+i),t[i]=e[i]):t[i]=r.value}return t}}function dt(e){return ft(_t.instantiateModules(e))}function ft(e){const t={},n={};return pt({modules:e,level:0,moduleMap:t,moduleDepth:n}),Object.keys(n).sort(((e,t)=>n[t]-n[e])).map((e=>t[e]))}function pt(e){const{modules:t,level:n,moduleMap:i,moduleDepth:r}=e;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of t)i[s.name]=s,(void 0===r[s.name]||r[s.name]<n)&&(r[s.name]=n);for(const s of t)s.dependencies&&pt({modules:s.dependencies,level:n+1,moduleMap:i,moduleDepth:r})}var Et,gt,mt,At,Rt,Tt,vt,St,bt,Ct;function yt(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Nt=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],It=[...Nt,[Pt("attribute"),"in $1"],[Pt("varying"),"out $1"]],Lt=[...Nt,[Pt("varying"),"in $1"]];function wt(e,t){for(const[n,i]of t)e=e.replace(n,i);return e}function Pt(e){return new RegExp("\\b"+e+"[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)","g")}function Ft(e,t){let n="";for(const i in e){const r=e[i];if(n+="void "+r.signature+" {\n",r.header&&(n+="  "+r.header),t[i]){const e=t[i];e.sort(((e,t)=>e.order-t.order));for(const t of e)n+="  "+t.injection+"\n"}r.footer&&(n+="  "+r.footer),n+="}\n"}return n}function Ot(e){const t={vertex:{},fragment:{}};for(const n of e){let e,i;"string"!=typeof n?(e=n,i=e.hook):(e={},i=n),i=i.trim();const[r,s]=i.split(":"),o=i.replace(/\(.+/,""),a=Object.assign(e,{signature:s});switch(r){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw new Error(r)}}return t}function Mt(e,t){void 0===t&&(t="unnamed");const n=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return n?n[1]:t}function xt(e){let t=100;const n=e.match(/[^\s]+/g);if(n&&n.length>=2&&"#version"===n[0]){const e=parseInt(n[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw new Error("Invalid GLSL version "+t);return t}var Dt;const Bt="\n\n"+lt+"\n",Ut=et(Dt||(Gt=["precision highp float;\n"],(kt=["\\\nprecision highp float;\n"])||(kt=Gt.slice(0)),Gt.raw=kt,Dt=Gt));var Gt,kt;function Ht(e,t){const{source:n,stage:i,modules:r,hookFunctions:s=[],inject:o={},log:a}=t;Qe("string"==typeof n,"shader source must be a string");const l=n;let c="";const u=Ot(s),h={},_={},d={};for(const p in o){const e="string"==typeof o[p]?{injection:o[p],order:0}:o[p],t=/^(v|f)s:(#)?([\w-]+)$/.exec(p);if(t){const n=t[2],i=t[3];n?"decl"===i?_[p]=[e]:d[p]=[e]:h[p]=[e]}else d[p]=[e]}const f="webgpu"!==e.type?r:[];for(const p of f){a&&p.checkDeprecations(l,a);c+=p.getModuleSource(i,"wgsl");const e=p.injections[i];for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?_:d;i[t]=i[t]||[],i[t].push(e[t])}else h[t]=h[t]||[],h[t].push(e[t])}}return c+=Bt,c=ut(c,i,_),c+=Ft(u[i],h),c+=l,c=ut(c,i,d),c}function Vt(e,t){const{id:n,source:i,stage:r,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=t;Qe("string"==typeof i,"shader source must be a string");const _="glsl"===s?function(e,t){return{name:Mt(e,t),language:"glsl",version:xt(e)}}(i).version:-1,d=e.shaderLanguageVersion,f=100===_?"#version 100":"#version 300 es",p=i.split("\n").slice(1).join("\n"),E={};o.forEach((e=>{Object.assign(E,e.getDefines())})),Object.assign(E,a);let g="";switch(s){case"wgsl":break;case"glsl":g=u?f+"\n\n// ----- PROLOGUE -------------------------\n"+function(e){const{id:t,source:n,stage:i}=e,r=t&&-1===n.indexOf("SHADER_NAME");return r?"\n#define SHADER_NAME "+t+"_"+i+"\n\n":""}({id:n,source:i,stage:r})+"\n#define SHADER_TYPE_"+r.toUpperCase()+"\n"+function(e){switch(null==e?void 0:e.gpu.toLowerCase()){case"apple":return et(Et||(Et=yt(["#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define APPLE_GPU\n// Apple optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])));case"nvidia":return et(gt||(gt=yt(["#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n"],["\\\n#define NVIDIA_GPU\n// Nvidia optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n"])));case"intel":return et(mt||(mt=yt(["#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define INTEL_GPU\n// Intel optimizes away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Intel's built-in 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])));case"amd":return et(At||(At=yt(["#define AMD_GPU\n"],["\\\n#define AMD_GPU\n"])));default:return et(Rt||(Rt=yt(["#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"],["\\\n#define DEFAULT_GPU\n// Prevent driver from optimizing away the calculation necessary for emulated fp64\n#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1\n// Headless Chrome's software shader 'tan' function doesn't have acceptable precision\n#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1\n// If the GPU doesn't have full 32 bits precision, will causes overflow\n#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1\n"])))}}(e)+"\n"+function(e){let t="";return e.features.has("webgl2")&&(t+=et(Tt||(Tt=yt(["# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n"],["\\\n# define FEATURE_GLSL_DERIVATIVES\n# define FEATURE_GLSL_DRAW_BUFFERS\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FEATURE_GLSL_TEXTURE_LOD\n"])))),e.features.has("webgl2")||(e.features.has("glsl-frag-depth")&&(t+=et(vt||(vt=yt(["\n// FEATURE_GLSL_FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n# extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"],["\\\n\n// FEATURE_GLSL_FRAG_DEPTH => gl_FragDepth is available\n#ifdef GL_EXT_frag_depth\n# extension GL_EXT_frag_depth : enable\n# define FEATURE_GLSL_FRAG_DEPTH\n# define FRAG_DEPTH\n# define gl_FragDepth gl_FragDepthEXT\n#endif\n"])))),null!=e&&e.features.has("glsl-derivatives")&&(t+=et(St||(St=yt(["\n// FEATURE_GLSL_DERIVATIVES => dxdF, dxdY and fwidth are available\n#if defined(GL_OES_standard_derivatives) || defined(FEATURE_GLSL_DERIVATIVES)\n# extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n#endif\n"],["\\\n\n// FEATURE_GLSL_DERIVATIVES => dxdF, dxdY and fwidth are available\n#if defined(GL_OES_standard_derivatives) || defined(FEATURE_GLSL_DERIVATIVES)\n# extension GL_OES_standard_derivatives : enable\n# define FEATURE_GLSL_DERIVATIVES\n#endif\n"])))),null!=e&&e.features.has("glsl-frag-data")&&(t+=et(bt||(bt=yt(["\n// FEATURE_GLSL_DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n# extension GL_EXT_draw_buffers : require\n# define FEATURE_GLSL_DRAW_BUFFERS\n#endif\n"],["\\\n\n// FEATURE_GLSL_DRAW_BUFFERS => gl_FragData[] is available\n#ifdef GL_EXT_draw_buffers\n# extension GL_EXT_draw_buffers : require\n# define FEATURE_GLSL_DRAW_BUFFERS\n#endif\n"])))),null!=e&&e.features.has("glsl-texture-lod")&&(t+=et(Ct||(Ct=yt(["// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n# extension GL_EXT_shader_texture_lod : enable\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n#endif\n"],["\\\n// TEXTURE_LOD => texture2DLod etc are available\n#ifdef GL_EXT_shader_texture_lod\n# extension GL_EXT_shader_texture_lod : enable\n# define FEATURE_GLSL_TEXTURE_LOD\n# define TEXTURE_LOD\n#endif\n"]))))),t}(e)+"\n"+("fragment"===r?Ut:"")+"\n\n// ----- APPLICATION DEFINES -------------------------\n\n"+function(e){void 0===e&&(e={});let t="";for(const n in e){const i=e[n];(i||Number.isFinite(i))&&(t+="#define "+n.toUpperCase()+" "+e[n]+"\n")}return t}(E)+"\n\n":f+"\n"}const m=Ot(l),A={},R={},T={};for(const v in c){const e="string"==typeof c[v]?{injection:c[v],order:0}:c[v],t=/^(v|f)s:(#)?([\w-]+)$/.exec(v);if(t){const n=t[2],i=t[3];n?"decl"===i?R[v]=[e]:T[v]=[e]:A[v]=[e]}else T[v]=[e]}for(const v of o){h&&v.checkDeprecations(p,h);g+=v.getModuleSource(r);const e=v.injections[r];for(const t in e){const n=/^(v|f)s:#([\w-]+)$/.exec(t);if(n){const i="decl"===n[2]?R:T;i[t]=i[t]||[],i[t].push(e[t])}else A[t]=A[t]||[],A[t].push(e[t])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=Bt,g=ut(g,r,R),g+=Ft(m[r],A),g+=p,g=ut(g,r,T),"glsl"===s&&_!==d&&(g=function(e,t){var n;if(300!==Number((null==(n=e.match(/^#version[ \t]+(\d+)/m))?void 0:n[1])||100))throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return wt(e,It);case"fragment":return wt(e,Lt);default:throw new Error(t)}}(g,r)),g.trim()}function Xt(e){return function(t){const n={};for(const i of e){const e=i.getUniforms(t,n);Object.assign(n,e)}return n}}function Wt(e,t){if("string"==typeof t)return t;if("webgpu"===e.type){if(null!=t&&t.wgsl)return t.wgsl;throw new Error("WebGPU does not support GLSL shaders")}if(null!=t&&t.glsl)return t.glsl;throw new Error("WebGL does not support WGSL shaders")}class Kt{constructor(){this._hookFunctions=[],this._defaultModules=[]}static getDefaultShaderAssembler(){return Kt.defaultShaderAssembler=Kt.defaultShaderAssembler||new Kt,Kt.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find((t=>t.name===("string"==typeof e?e:e.name)))||this._defaultModules.push(e)}removeDefaultModule(e){const t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter((e=>e.name!==t))}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleShaders(e){const t=this._getModuleList(e.modules),n=this._hookFunctions,i=function(e){if(!e.vs)throw new Error("no vertex shader");const t=Wt(e.platformInfo,e.vs);let n;return e.fs&&(n=Wt(e.platformInfo,e.fs)),{...e,vs:t,fs:n}}(e),r=function(e){const{vs:t,fs:n}=e,i=dt(e.modules||[]);switch(e.platformInfo.shaderLanguage){case"glsl":return{vs:Vt(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:Vt(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:Xt(i)};case"wgsl":return{vs:Ht(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:Ht(e.platformInfo,{...e,source:n,stage:"fragment",modules:i}),getUniforms:Xt(i)}}}({platformInfo:e.platformInfo,...i,modules:t,hookFunctions:n});return{...r,modules:t}}_getModuleList(e){void 0===e&&(e=[]);const t=new Array(this._defaultModules.length+e.length),n={};let i=0;for(let r=0,s=this._defaultModules.length;r<s;++r){const e=this._defaultModules[r],s=e.name;t[i++]=e,n[s]=!0}for(let r=0,s=e.length;r<s;++r){const s=e[r],o=s.name;n[o]||(t[i++]=s,n[o]=!0)}return t.length=i,_t.instantiateModules(t)}}class zt{constructor(e){const t=dt(Object.values(e));f.R.log(1,"Creating ShaderInputs with modules",t.map((e=>e.name)))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[n,i]of Object.entries(e)){const e=n;this.moduleUniforms[e]=i.defaultUniforms||{},this.moduleBindings[e]={}}}destroy(){}setProps(e){for(const t of Object.keys(e)){const n=t,i=e[n],r=this.modules[n];if(!r){f.R.warn("Module "+t+" not found")();continue}const s=this.moduleUniforms[n],o=(null==r.getUniforms?void 0:r.getUniforms(i,this.moduleUniforms[n]))||i;this.moduleUniforms[n]={...s,...o}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){const e={};for(const[n,i]of Object.entries(this.moduleUniforms))for(const[r,s]of Object.entries(i)){var t;e[n+"."+r]={type:null==(t=this.modules[n].uniformTypes)?void 0:t[r],value:String(s)}}return e}}class Yt{constructor(e){this.userData={},this.bufferLayout=[],this.id=e.id||(0,S.L)("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&(0,c.v)(this.indices.usage===o.h.INDEX)}destroy(){var e;this.indices.destroy(),this.attributes.positions.destroy(),this.attributes.normals.destroy(),this.attributes.texCoords.destroy(),null==(e=this.attributes.colors)||e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function jt(e,t){if(t instanceof Yt)return t;const n=function(e,t){if(!t.indices)return;const n=t.indices.value;return e.createBuffer({usage:o.h.INDEX,data:n})}(e,t),{attributes:i,bufferLayout:r}=function(e,t){const n=[],i={};for(const[s,o]of Object.entries(t.attributes)){let t=s;switch(s){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}i[t]=e.createBuffer({data:o.value,id:s+"-buffer"});const{value:r,size:a,normalized:l}=o;n.push({name:t,format:F(r,a,l)})}const r=t._calculateVertexCount(t.attributes,t.indices);return{attributes:i,bufferLayout:n,vertexCount:r}}(e,t);return new Yt({topology:t.topology||"triangle-list",bufferLayout:r,vertexCount:t.vertexCount,indices:n,attributes:i})}class qt{static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new qt(e),e._lumaData.defaultPipelineFactory}constructor(e){this._hashCounter=0,this._hashes={},this._useCounts={},this._pipelineCache={},this.device=e}createRenderPipeline(e){const t={...qt.defaultProps,...e},n=this._hashRenderPipeline({...t});if(!this._pipelineCache[n]){const e=this.device.createRenderPipeline({...t});e.hash=n,this._pipelineCache[n]=e,this._useCounts[n]=0}return this._useCounts[n]++,this._pipelineCache[n]}release(e){const t=e.hash;this._useCounts[t]--,0===this._useCounts[t]&&(this._pipelineCache[t].destroy(),delete this._pipelineCache[t],delete this._useCounts[t])}_hashRenderPipeline(e){const t=this._getHash(e.vs.source),n=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout));if("webgpu"===this.device.info.type){const r=this._getHash(JSON.stringify(e.parameters));return t+"/"+n+"V-T"+e.topology+"P"+r+"BL"+i}return t+"/"+n+"V-BL"+i}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}qt.defaultProps={...v.r.defaultProps};var Qt=n(5612);class Zt{static getDefaultShaderFactory(e){var t;return(t=e._lumaData).defaultShaderFactory||(t.defaultShaderFactory=new Zt(e)),e._lumaData.defaultShaderFactory}constructor(e){this._cache={},this.device=e}createShader(e){const t=this._hashShader(e);let n=this._cache[t];if(!n){const i=this.device.createShader({...e,id:e.id?e.id+"-cached":void 0});this._cache[t]=n={shader:i,useCount:0}}return n.useCount++,n.shader}release(e){const t=this._hashShader(e),n=this._cache[t];n.useCount--,0===n.useCount&&(delete this._cache[t],n.shader.destroy())}_hashShader(e){return e.stage+":"+e.source}}Zt.defaultProps={...Qt.M.defaultProps};let Jt=null,$t=null;class en{constructor(e,t){var n,i,r;this.userData={},this.instanceCount=0,this.indexBuffer=null,this.bufferAttributes={},this.constantAttributes={},this.bindings={},this.uniforms={},this.transformFeedback=null,this._pipelineNeedsUpdate="newly created",this._attributeInfos={},this._gpuGeometry=null,this._destroyed=!1,this._lastLogTime=0,this._logOpen=!1,this._drawCount=0,this.props={...en.defaultProps,...t},t=this.props,this.id=t.id||(0,S.L)("model"),this.device=e,Object.assign(this.userData,t.userData);const s=Object.fromEntries((null==(n=this.props.modules)?void 0:n.map((e=>[e.name,e])))||[]);this.setShaderInputs(t.shaderInputs||new zt(s));const o="webgpu"===this.device.info.type;if(this.props.source){var a;if(o)(a=this.props).shaderLayout||(a.shaderLayout=je(this.props.source));this.props.fs=this.props.source,this.props.vs=this.props.source}var l;o&&"string"!=typeof this.props.vs&&((l=this.props).shaderLayout||(l.shaderLayout=je(this.props.vs.wgsl)));const c=function(e){return{type:e.info.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),u=((null==(i=this.props.modules)?void 0:i.length)>0?this.props.modules:null==(r=this.shaderInputs)?void 0:r.getModules())||[],{vs:h,fs:_,getUniforms:d}=this.props.shaderAssembler.assembleShaders({platformInfo:c,...this.props,modules:u});if(this.vs=h,this.fs=_,this._getModuleUniforms=d,this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&(this._gpuGeometry=this.setGeometry(t.geometry)),this.pipelineFactory=t.pipelineFactory||qt.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||Zt.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),t.vertexCount&&this.setVertexCount(t.vertexCount),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.indices)throw new Error("Model.props.indices removed. Use props.indexBuffer");t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes,{ignoreUnknownAttributes:t.ignoreUnknownAttributes}),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniforms(t.uniforms),t.moduleSettings&&(f.R.warn("Model.props.moduleSettings is deprecated. Use Model.shaderInputs.setProps()")(),this.updateModuleSettings(t.moduleSettings)),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._destroyed=!0)}predraw(){this.updateShaderInputs()}draw(e){this.predraw();try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings),this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:t}=this.vertexArray,n=t?t.byteLength/("uint32"===t.indexType?4:2):void 0;this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback})}finally{this._logDrawCallEnd()}this._logFramebuffer(e)}setGeometry(e){const t=e&&jt(this.device,e);return this.setTopology(t.topology||"triangle-list"),this.bufferLayout=tn(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t),t}_setGeometryAttributes(e){const t={...e.attributes};for(const[n]of Object.entries(t))this.pipeline.shaderLayout.attributes.find((e=>e.name===n))||"positions"===n||delete t[n];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices),this.setAttributes(e.attributes,{ignoreUnknownAttributes:!0}),this.setAttributes(t,{ignoreUnknownAttributes:this.props.ignoreUnknownAttributes})}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?tn(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){b(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(e){this.vertexCount=e}setInstanceCount(e){this.instanceCount=e}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new E(this.shaderInputs.modules);for(const t of Object.keys(this.shaderInputs.modules)){const e=this._uniformStore.getManagedUniformBuffer(this.device,t);this.bindings[t+"Uniforms"]=e}}setShaderModuleProps(e){const t=this._getModuleUniforms(e),n=Object.keys(t).filter((e=>{const n=t[e];return!(0,a.p)(n)&&"number"!=typeof n&&"boolean"!=typeof n})),i={};for(const r of n)i[r]=t[r],delete t[r]}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues())}updateModuleSettings(e){f.R.warn("Model.updateModuleSettings is deprecated. Use Model.shaderInputs.setProps()")();const{bindings:t,uniforms:n}=(0,w.l)(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,n)}setBindings(e){Object.assign(this.bindings,e)}setUniforms(e){this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e)}setTransformFeedback(e){this.transformFeedback=e}setAttributes(e,t){e.indices&&f.R.warn("Model:"+this.id+" setAttributes() - indexBuffer should be set using setIndexBuffer()")();for(const[n,i]of Object.entries(e)){const e=this.bufferLayout.find((e=>nn(e).includes(n)));if(!e){f.R.warn("Model("+this.id+'): Missing layout for buffer "'+n+'".')();continue}const r=nn(e);let s=!1;for(const t of r){const e=this._attributeInfos[t];e&&(this.vertexArray.setBuffer(e.location,i),s=!0)}!s&&(null!=t&&t.ignoreUnknownAttributes||this.props.ignoreUnknownAttributes)&&f.R.warn("Model("+this.id+'): Ignoring buffer "'+i.id+'" for unknown attribute "'+n+'"')()}}setConstantAttributes(e){for(const[t,n]of Object.entries(e)){const e=this._attributeInfos[t];e?this.vertexArray.setConstantWebGL(e.location,n):f.R.warn('Model "'+this.id+': Ignoring constant supplied for unknown attribute "'+t+'"')()}}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate=this._pipelineNeedsUpdate||e}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(f.R.log(1,"Model "+this.id+': Recreating pipeline because "'+this._pipelineNeedsUpdate+'".')(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const n=this.shaderFactory.createShader({id:this.id+"-vertex",stage:"vertex",source:this.vs,debug:this.props.debugShaders}),i=this.fs?this.shaderFactory.createShader({id:this.id+"-fragment",stage:"fragment",source:this.fs,debug:this.props.debugShaders}):null;this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:n,fs:i}),this._attributeInfos=(0,P.PV)(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_logDrawCallStart(){const e=f.R.level>3?0:1e4;f.R.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,f.R.group(2,">>> DRAWING MODEL "+this.id,{collapsed:f.R.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=function(e,t){var n;const i={},r="Values";if(0===e.attributes.length&&(null==(n=e.varyings)||!n.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of e.attributes)s&&(i["in "+s.location+" "+s.name+": "+s.type]={[r]:s.stepMode||"vertex"});for(const s of e.varyings||[])i["out "+s.location+" "+s.name]={[r]:JSON.stringify(s.accessor)};return i}(this.pipeline.shaderLayout,this.id);f.R.table(2,e)();const t=this.shaderInputs.getDebugTable();for(const[i,r]of Object.entries(this.uniforms))t[i]={value:r};f.R.table(2,t)();const n=this._getAttributeDebugTable();f.R.table(2,this._attributeInfos)(),f.R.table(2,n)(),f.R.groupEnd(2)(),this._logOpen=!1}}_logFramebuffer(e){const t=f.R.get("framebuffer");if(this._drawCount++,!t||this._drawCount++>3&&this._drawCount%60)return;const n=e.props.framebuffer;n&&function(e,t){let{id:n,minimap:i,opaque:r,top:s="0",left:o="0",rgbaScale:a=1}=t;Jt||(Jt=document.createElement("canvas"),Jt.id=n,Jt.title=n,Jt.style.zIndex="100",Jt.style.position="absolute",Jt.style.top=s,Jt.style.left=o,Jt.style.border="blue 1px solid",Jt.style.transform="scaleY(-1)",document.body.appendChild(Jt),$t=Jt.getContext("2d")),Jt.width===e.width&&Jt.height===e.height||(Jt.width=e.width/2,Jt.height=e.height/2,Jt.style.width="400px",Jt.style.height="400px");const l=e.device.readPixelsToArrayWebGL(e),c=$t.createImageData(e.width,e.height);for(let u=0;u<l.length;u+=4)c.data[0+u+0]=l[u+0]*a,c.data[0+u+1]=l[u+1]*a,c.data[0+u+2]=l[u+2]*a,c.data[0+u+3]=r?255:l[u+3]*a;$t.putImageData(c,0,0)}(n,{id:n.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[t,n]of Object.entries(this._attributeInfos))e[n.location]={name:t,type:n.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[n.location],n.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:t}=this.vertexArray,n="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:n.toString()}}return e}_getBufferOrConstantValues(e,t){const n=function(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(e)}}(t);return(e instanceof o.h?new n(e.debugData):e).toString()}}function tn(e,t){const n=[...e];for(const i of t){const e=n.findIndex((e=>e.name===i.name));e<0?n.push(i):n[e]=i}return n}function nn(e){var t;return e.attributes?null==(t=e.attributes)?void 0:t.map((e=>e.attribute)):[e.name]}en.defaultProps={...v.r.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:Kt.getDefaultShaderAssembler(),debugShaders:void 0,ignoreUnknownAttributes:void 0};class rn{constructor(e){this.userData={};const{attributes:t={},indices:n=null,vertexCount:i=null}=e;this.id=e.id||(0,S.L)("geometry"),this.topology=e.topology,n&&(this.indices=ArrayBuffer.isView(n)?{value:n,size:1}:n),this.attributes={};for(const[r,s]of Object.entries(t)){const e=ArrayBuffer.isView(s)?{value:s}:s;(0,c.v)(ArrayBuffer.isView(e.value),this._print(r)+": must be typed array or object with value as typed array"),"POSITION"!==r&&"positions"!==r||e.size||(e.size=3),"indices"===r?((0,c.v)(!this.indices),this.indices=e):this.attributes[r]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return"Geometry "+this.id+" attribute "+e}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let n=1/0;for(const i of Object.values(e)){const{value:e,size:t,constant:r}=i;!r&&e&&t>=1&&(n=Math.min(n,e.length/t))}return(0,c.v)(Number.isFinite(n)),n}}class sn extends rn{constructor(e){void 0===e&&(e={});const{id:t=(0,S.L)("cube-geometry"),indices:n=!0}=e;super(n?{...e,id:t,topology:"triangle-list",indices:{size:1,value:on},attributes:{...dn,...e.attributes}}:{...e,id:t,topology:"triangle-list",indices:void 0,attributes:{...fn,...e.attributes}})}}const on=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),an=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),ln=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),cn=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),un=new Float32Array([1,-1,1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,-1,-1,1,1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,1,1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,1,1,1,-1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1]),hn=new Float32Array([1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,1,0,0]),_n=new Float32Array([1,0,1,1,0,0,1,1,0,0,0,1,1,0,0,1,1,0,1,1,0,0,0,1,1,1,1,1,1,0,1,1,1,0,0,1,1,1,0,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,1,1,1,1,0,1,0,1,0,1,0,1,1,1,1,1,0,1,0,0,1,1,0,1,1,1,0,1,0,1,0,0,0,1,0,0,1,1,0,1,0,1,1,1,1,1,0,1,1,1,0,0,1,1,0,0,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,0,0,1,0,1,0,1,1,1,0,1,1,0,0,1,0,1,0,1]),dn={POSITION:{size:3,value:an},NORMAL:{size:3,value:ln},TEXCOORD_0:{size:2,value:cn}},fn={POSITION:{size:3,value:un},TEXCOORD_0:{size:2,value:hn},COLOR_0:{size:3,value:_n}};var pn,En;function gn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const mn={name:"dirlight",dependencies:[],vs:et(pn||(pn=gn(["out vec3 dirlight_vNormal;\n\nvoid dirlight_setNormal(vec3 normal) {\n  dirlight_vNormal = normalize(normal);\n}\n"],["\\\nout vec3 dirlight_vNormal;\n\nvoid dirlight_setNormal(vec3 normal) {\n  dirlight_vNormal = normalize(normal);\n}\n"]))),fs:et(En||(En=gn(["uniform dirlightUniforms {\n  vec3 lightDirection;\n} dirlight;\n\nin vec3 dirlight_vNormal;\n\n// Returns color attenuated by angle from light source\nvec4 dirlight_filterColor(vec4 color) {\n  float d = abs(dot(dirlight_vNormal, normalize(dirlight.lightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n"],["\\\nuniform dirlightUniforms {\n  vec3 lightDirection;\n} dirlight;\n\nin vec3 dirlight_vNormal;\n\n// Returns color attenuated by angle from light source\nvec4 dirlight_filterColor(vec4 color) {\n  float d = abs(dot(dirlight_vNormal, normalize(dirlight.lightDirection)));\n  return vec4(color.rgb * d, color.a);\n}\n"]))),uniformTypes:{lightDirection:"vec3<f32>"},defaultUniforms:{lightDirection:new Float32Array([1,1,2])},getUniforms:function(e){void 0===e&&(e=mn.defaultUniforms);const t={};e.lightDirection&&(t.dirlight_uLightDirection=e.lightDirection);return t}};var An=n(6213),Rn=n(4901);function Tn(){let e=1,t=1;return()=>{return e=Math.sin(17.23*t),t=Math.cos(27.92*e),(n=1432.71*Math.abs(e*t))-Math.floor(n);var n}}Tn();var vn,Sn;function bn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Cn=Tn(),yn={uniformTypes:{uColor:"vec3<f32>",uModel:"mat4x4<f32>",uView:"mat4x4<f32>",uProjection:"mat4x4<f32>"}},Nn=s(vn||(vn=bn(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform appUniforms {\n  vec3 uColor;\n  mat4 uModel;\n  mat4 uView;\n  mat4 uProjection;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(app.uModel * vec4(normals, 0.0));\n\n  // Set up data for modules\n  color = app.uColor;\n  dirlight_setNormal(normal);\n  gl_Position = app.uProjection * app.uView * app.uModel * vec4(positions, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform appUniforms {\n  vec3 uColor;\n  mat4 uModel;\n  mat4 uView;\n  mat4 uProjection;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  vec3 normal = vec3(app.uModel * vec4(normals, 0.0));\n\n  // Set up data for modules\n  color = app.uColor;\n  dirlight_setNormal(normal);\n  gl_Position = app.uProjection * app.uView * app.uModel * vec4(positions, 1.0);\n}\n"]))),In=s(Sn||(Sn=bn(["#version 300 es\n\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n}\n"])));class Ln extends g{constructor(e){let{device:t,aspect:n,animationLoop:i}=e;super(),this.translations=[[2,-2,0],[2,2,0],[-2,2,0],[-2,-2,0]],this.rotations=[[Cn(),Cn(),Cn()],[Cn(),Cn(),Cn()],[Cn(),Cn(),Cn()],[Cn(),Cn(),Cn()]],this.colors=[[1,0,0],[0,1,0],[0,0,1],[1,1,0]],this.keyFrameData=[[0,0],[1e3,2*Math.PI],[2e3,Math.PI],[3e3,2*Math.PI],[4e3,0]],this.globalUniformStore=new E({dirlight:mn});const r=document.getElementById("play"),s=document.getElementById("pause");this.timeSlider=document.getElementById("time"),r&&s&&(r.addEventListener("click",(()=>this.timeline.play())),s.addEventListener("click",(()=>this.timeline.pause())),this.timeSlider.addEventListener("input",(e=>this.timeline.setTime(parseFloat(e.target.value))))),this.timeline=new R,i.attachTimeline(this.timeline),this.timeline.play();const o=[this.timeline.addChannel({delay:2e3,rate:.5,duration:8e3,repeat:2}),this.timeline.addChannel({delay:1e4,rate:.2,duration:2e4,repeat:1}),this.timeline.addChannel({delay:7e3,rate:1,duration:4e3,repeat:8}),this.timeline.addChannel({delay:0,rate:.8,duration:5e3,repeat:Number.POSITIVE_INFINITY})];this.cubes=new Array(4);const a=[new T(this.keyFrameData),new T(this.keyFrameData),new T(this.keyFrameData),new T(this.keyFrameData)];for(let l=0;l<4;++l){this.timeline.attachAnimation(a[l],o[l]);const e=new E({app:yn});e.setUniforms({app:{uProjection:(new An.k).perspective({fovy:(0,Rn.F2)(60),aspect:n,near:1,far:20}),uView:(new An.k).lookAt({center:[0,0,0],eye:[0,0,-8]}),uColor:this.colors[l]}}),this.cubes[l]={uniformStore:e,translation:this.translations[l],rotation:this.rotations[l],keyFrames:a[l],model:new en(t,{id:"cube-"+l,vs:Nn,fs:In,modules:[mn],geometry:new sn,parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"},bindings:{app:e.getManagedUniformBuffer(t,"app"),dirlight:this.globalUniformStore.getManagedUniformBuffer(t,"dirlight")}})}}}onFinalize(){for(const e of this.cubes)e.model.destroy()}onRender(e){let{device:t}=e;this.timeSlider&&(this.timeSlider.value=this.timeline.getTime());const n=new An.k;for(const r of this.cubes){const e=r.keyFrames.getStartData(),t=r.keyFrames.getEndData(),i=e+r.keyFrames.factor*(t-e),s=r.rotation[0]+i,o=r.rotation[1]+i,a=r.rotation[2];n.identity().translate(r.translation).rotateXYZ([s,o,a]),r.model.setUniforms({}),r.uniformStore.setUniforms({app:{uModel:n}}),r.uniformStore.updateUniformBuffers()}const i=t.beginRenderPass({clearColor:[0,0,0,1]});for(const r of this.cubes)r.model.draw(i);i.end()}}Ln.info='Key frame animation based on multiple hierarchical timelines.\n<button id="play">Play</button>\n<button id="pause">Pause</button><BR>\nTime: <input type="range" id="time" min="0" max="30000" step="1"><BR>\n';var wn,Pn,Fn,On,Mn=n(4789);function xn(e,t){return t||(t=e.slice(0)),e.raw=t,e}class Dn extends en{constructor(e,t){const n=s(wn||(wn=xn(["in vec3 positions;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = positions;\n}\n"],["\\\nin vec3 positions;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = positions;\n}\n"]))),i=s(Pn||(Pn=xn(["precision highp float;\n\nuniform samplerCube uTextureCube;\nin vec3 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  // The outer cube just samples the texture cube directly\n  fragColor = textureCube(uTextureCube, normalize(vPosition));\n}\n"],["\\\nprecision highp float;\n\nuniform samplerCube uTextureCube;\nin vec3 vPosition;\nout vec4 fragColor;\n\nvoid main(void) {\n  // The outer cube just samples the texture cube directly\n  fragColor = textureCube(uTextureCube, normalize(vPosition));\n}\n"])));super(e,{...t,geometry:new sn,fs:i,vs:n})}}class Bn extends en{constructor(e,t){const n=s(Fn||(Fn=xn(["in vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = vec3(uModel * vec4(positions,1));\n  vNormal = vec3(uModel * vec4(normals, 0));\n  vUV = texCoords;\n}\n"],["\\\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nuniform mat4 uModel;\nuniform mat4 uView;\nuniform mat4 uProjection;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nvoid main(void) {\n  gl_Position = uProjection * uView * uModel * vec4(positions, 1.0);\n  vPosition = vec3(uModel * vec4(positions,1));\n  vNormal = vec3(uModel * vec4(normals, 0));\n  vUV = texCoords;\n}\n"]))),i=s(On||(On=xn(["precision highp float;\n\nuniform sampler2D uTexture;\nuniform samplerCube uTextureCube;\nuniform vec3 uEyePosition;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nvoid main(void) {\n  vec4 color = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y));\n  vec3 reflectedDir = reflect(normalize(vPosition - uEyePosition), vNormal);\n  vec4 reflectedColor = textureCube(uTextureCube, reflectedDir);\n\n  gl_FragColor = color * reflectedColor;\n}\n"],["\\\nprecision highp float;\n\nuniform sampler2D uTexture;\nuniform samplerCube uTextureCube;\nuniform vec3 uEyePosition;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nvoid main(void) {\n  vec4 color = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y));\n  vec3 reflectedDir = reflect(normalize(vPosition - uEyePosition), vNormal);\n  vec4 reflectedColor = textureCube(uTextureCube, reflectedDir);\n\n  gl_FragColor = color * reflectedColor;\n}\n"])));super(e,{...t,geometry:new sn,vs:n,fs:i})}}class Un extends g{constructor(e){let{device:t}=e;super();const n=t.createTexture({dimension:"cube",mipmaps:!0,data:{"+X":(0,Mn.yt)("sky-posx.png"),"-X":(0,Mn.yt)("sky-negx.png"),"+Y":(0,Mn.yt)("sky-posy.png"),"-Y":(0,Mn.yt)("sky-negy.png"),"+Z":(0,Mn.yt)("sky-posz.png"),"-Z":(0,Mn.yt)("sky-negz.png")}}),i=t.createTexture({data:(0,Mn.yt)("vis-logo.png"),mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",mipmapFilter:"nearest"}});this.cube=new Dn(t,{bindings:{uTextureCube:n},uniforms:{uModel:(new An.k).scale([20,20,20])},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}}),this.prism=new Bn(t,{bindings:{uTexture:i,uTextureCube:n},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.prism.destroy(),this.cube.destroy()}onRender(e){let{device:t,aspect:n,tick:i}=e;const r=[5,-3,5],s=(new An.k).lookAt({eye:r}),o=(new An.k).perspective({fovy:(0,Rn.F2)(75),aspect:n}),a=t.beginRenderPass({clearColor:[0,0,0,1]});this.cube.setUniforms({uView:s,uProjection:o}),this.cube.draw(a),this.prism.setUniforms({uEyePosition:r,uView:s,uProjection:o,uModel:(new An.k).rotateX(.01*i).rotateY(.013*i)}),this.prism.draw(a),a.end()}}function Gn(e,t,n){return e+n*(t-e)}function kn(e,t){for(var n=[],i=e;i<=t;i++)n.push(i);return n}function Hn(e,t){for(var n,i=e.length,r=0;i;)n=Math.floor(t()*i),r=e[i-=1],e[i]=e[n],e[n]=r;return e}Un.info="\n<p>\nUses a luma.gl <code>TextureCube</code> to simulate a reflective\nsurface\n</p>\n";var Vn,Xn,Wn=function(e){return e*e*e*(e*(6*e-15)+10)},Kn=function(e,t,n,i){var r=15&e,s=r<8?t:n,o=r<4?n:12==r||14==r?t:i;return(1&r?-s:s)+(2&r?-o:o)};function zn(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Yn=Tn(),jn=s(Vn||(Vn=zn(["#version 300 es\nin vec3 position;\n\nuniform mat4 uMVP;\n\nout vec3 vUV;\nvoid main() {\n  vUV = position.xyz + 0.5;\n  gl_Position = uMVP * vec4(position, 1.0);\n  gl_PointSize = 2.0;\n}"],["\\\n#version 300 es\nin vec3 position;\n\nuniform mat4 uMVP;\n\nout vec3 vUV;\nvoid main() {\n  vUV = position.xyz + 0.5;\n  gl_Position = uMVP * vec4(position, 1.0);\n  gl_PointSize = 2.0;\n}"]))),qn=s(Xn||(Xn=zn(["#version 300 es\nprecision highp float;\nprecision lowp sampler3D;\nin vec3 vUV;\nuniform sampler3D uTexture;\nuniform float uTime;\nout vec4 fragColor;\nvoid main() {\n  float alpha = texture(uTexture, vUV + vec3(0.0, 0.0, uTime)).r * 0.1;\n  fragColor = vec4(fract(vUV) * alpha, alpha);\n}"],["\\\n#version 300 es\nprecision highp float;\nprecision lowp sampler3D;\nin vec3 vUV;\nuniform sampler3D uTexture;\nuniform float uTime;\nout vec4 fragColor;\nvoid main() {\n  float alpha = texture(uTexture, vUV + vec3(0.0, 0.0, uTime)).r * 0.1;\n  fragColor = vec4(fract(vUV) * alpha, alpha);\n}"])));class Qn extends g{constructor(e){let{device:t}=e;super(),this.mvpMat=new An.k,this.viewMat=(new An.k).lookAt({eye:[1,1,1]});const n=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("function"!=typeof e.interpolation)throw new TypeError("params.interpolation is not a function");if(!Array.isArray(e.permutation))throw new TypeError("params.permutation is not an array");if(256!=e.permutation.length)throw new Error("params.permutation must have 256 items");for(var t=e.interpolation,n=e.permutation.slice(0),i=0;i<256;i++)n[256+i]=n[i];return function(e,i,r){var s=Math.floor(e),o=Math.floor(i),a=Math.floor(r),l=255&s,c=255&o,u=255&a;i-=o,r-=a;var h=Wn(e-=s),_=Wn(i),d=Wn(r),f=n[l]+c,p=n[f]+u,E=n[f+1]+u,g=n[l+1]+c,m=n[g]+u,A=n[g+1]+u;return t(t(t(Kn(n[p],e,i,r),Kn(n[m],e-1,i,r),h),t(Kn(n[E],e,i-1,r),Kn(n[A],e-1,i-1,r),h),_),t(t(Kn(n[p+1],e,i,r-1),Kn(n[m+1],e-1,i,r-1),h),t(Kn(n[E+1],e,i-1,r-1),Kn(n[A+1],e-1,i-1,r-1),h),_),d)}}({interpolation:Gn,permutation:Hn(kn(0,255),Yn)}),i=128,r=.0078125,s=new Float32Array(6291456);let o=0,a=-.5;for(let f=0;f<i;++f){let e=-.5;for(let t=0;t<i;++t){let t=-.5;for(let n=0;n<i;++n)s[o++]=a,s[o++]=e,s[o++]=t,t+=r;e+=r}a+=r}const l=t.createBuffer(s),c=16,u=1.12,h=new Uint8Array(4096);let _=0;for(let f=0;f<c;++f)for(let e=0;e<c;++e)for(let t=0;t<c;++t)h[_++]=255*(.5+.5*n(f/u,e/u,t/u));const d=t.createTexture({dimension:"3d",width:c,height:c,depth:c,data:h,format:"r8unorm",mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",mipmapFilter:"linear"}});this.cloud=new en(t,{vs:jn,fs:qn,topology:"point-list",vertexCount:s.length/3,attributes:{position:l},bindings:{uTexture:d},uniforms:{uView:this.viewMat},parameters:{blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"one-minus-src-alpha"}})}onFinalize(){this.cloud.destroy()}onRender(e){let{device:t,tick:n,aspect:i}=e;this.mvpMat.perspective({fovy:(0,Rn.F2)(75),aspect:i,near:.1,far:10}).multiplyRight(this.viewMat);const r=t.beginRenderPass({clearColor:[0,0,0,1]});this.cloud.setUniforms({uTime:n/100,uMVP:this.mvpMat}),this.cloud.draw(r),r.end()}}var Zn,Jn;function $n(e,t){return t||(t=e.slice(0)),e.raw=t,e}Qn.info="\n<p>\nVolumetric 3D noise visualized using a <b>3D texture</b>.\n<p>\nUses the luma.gl <code>Texture3D</code> class.\n",Qn.props={useDevicePixels:!0};const ei=new Float32Array([0,1,1,1]),ti={name:"picking",vs:et(Zn||(Zn=$n(["uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    // if (!bool(picking.isAttribute)) {\n    // Stores the picking color so that the fragment shader can render it during picking\n    picking_vRGBcolor_Avalid.rgb = pickingColor;\n    // }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n"],["\\\nuniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nout vec4 picking_vRGBcolor_Avalid;\n\n// Normalize unsigned byte color to 0-1 range\nvec3 picking_normalizeColor(vec3 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\n// Normalize unsigned byte color to 0-1 range\nvec4 picking_normalizeColor(vec4 color) {\n  return picking.useFloatColors > 0.5 ? color : color / 255.0;\n}\n\nbool picking_isColorZero(vec3 color) {\n  return dot(color, vec3(1.0)) < 0.00001;\n}\n\nbool picking_isColorValid(vec3 color) {\n  return dot(color, vec3(1.0)) > 0.00001;\n}\n\n// Check if this vertex is highlighted \nbool isVertexHighlighted(vec3 vertexColor) {\n  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);\n  return\n    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));\n}\n\n// Set the current picking color\nvoid picking_setPickingColor(vec3 pickingColor) {\n  pickingColor = picking_normalizeColor(pickingColor);\n\n  if (bool(picking.isActive)) {\n    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\n\n    // if (!bool(picking.isAttribute)) {\n    // Stores the picking color so that the fragment shader can render it during picking\n    picking_vRGBcolor_Avalid.rgb = pickingColor;\n    // }\n  } else {\n    // Do the comparison with selected item color in vertex shader as it should mean fewer compares\n    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));\n  }\n}\n\nvoid picking_setPickingAttribute(float value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.r = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec2 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rg = value;\n  }\n}\n\nvoid picking_setPickingAttribute(vec3 value) {\n  if (bool(picking.isAttribute)) {\n    picking_vRGBcolor_Avalid.rgb = value;\n  }\n}\n"]))),fs:et(Jn||(Jn=$n(["uniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n"],["\\\nuniform pickingUniforms {\n  float isActive;\n  float isAttribute;\n  float isHighlightActive;\n  float useFloatColors;\n  vec3 highlightedObjectColor;\n  vec4 highlightColor;\n} picking;\n\nin vec4 picking_vRGBcolor_Avalid;\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 picking_filterHighlightColor(vec4 color) {\n  // If we are still picking, we don't highlight\n  if (picking.isActive > 0.5) {\n    return color;\n  }\n\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\n\n  if (selected) {\n    // Blend in highlight color based on its alpha value\n    float highLightAlpha = picking.highlightColor.a;\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\n    float highLightRatio = highLightAlpha / blendedAlpha;\n\n    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);\n    return vec4(blendedRGB, blendedAlpha);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 picking_filterPickingColor(vec4 color) {\n  if (bool(picking.isActive)) {\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\n      discard;\n    }\n    return picking_vRGBcolor_Avalid;\n  }\n  return color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 picking_filterColor(vec4 color) {\n  vec4 highlightColor = picking_filterHighlightColor(color);\n  return picking_filterPickingColor(highlightColor);\n}\n"]))),uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:ei},getUniforms:function(e,t){void 0===e&&(e={});const n={};if(void 0===e.highlightedObjectColor);else if(null===e.highlightedObjectColor)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const t=e.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=t}if(e.highlightColor){const t=Array.from(e.highlightColor,(e=>e/255));Number.isFinite(t[3])||(t[3]=1),n.highlightColor=t}void 0!==e.isActive&&(n.isActive=Boolean(e.isActive),n.isAttribute=Boolean(e.isAttribute));void 0!==e.useFloatColors&&(n.useFloatColors=Boolean(e.useFloatColors));return n}};var ni,ii;function ri(e,t){return t||(t=e.slice(0)),e.raw=t,e}const si=Tn(),oi=s(ni||(ni=ri(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nin vec2 instanceOffsets;\nin vec3 instanceColors;\nin vec2 instancePickingColors;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 viewMatrix;\n  mat4 projectionMatrix;\n  float time;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  color = instanceColors;\n\n  vec3 normal = vec3(app.modelMatrix * vec4(normals, 1.0));\n  dirlight_setNormal(normal);\n\n  vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  float delta = length(instanceOffsets);\n  vec4 offset = vec4(instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  gl_Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * vec4(positions * 1., 1.0) + offset);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nin vec2 instanceOffsets;\nin vec3 instanceColors;\nin vec2 instancePickingColors;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 viewMatrix;\n  mat4 projectionMatrix;\n  float time;\n} app;\n\nout vec3 color;\n\nvoid main(void) {\n  color = instanceColors;\n\n  vec3 normal = vec3(app.modelMatrix * vec4(normals, 1.0));\n  dirlight_setNormal(normal);\n\n  vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  float delta = length(instanceOffsets);\n  vec4 offset = vec4(instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  gl_Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * vec4(positions * 1., 1.0) + offset);\n}\n"]))),ai=s(ii||(ii=ri(["#version 300 es\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n  fragColor = picking_filterColor(fragColor);\n}\n"],["\\\n#version 300 es\nprecision highp float;\n\nin vec3 color;\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vec4(color, 1.);\n  fragColor = dirlight_filterColor(fragColor);\n  fragColor = picking_filterColor(fragColor);\n}\n"]))),li=256;class ci extends en{constructor(e,t){const n=[];for(let c=0;c<li;c++){const e=3*c-382.5;for(let t=0;t<li;t++){const i=3*t-382.5;n.push(e,i)}}const i=new Float32Array(n),r=new Uint8Array(262144).map(((e,t)=>255*(.75*si()+.25)));for(let c=0;c<r.length;c+=4)r[c+3]=255;const s=new Uint8Array(262144);for(let c=0;c<li;c++)for(let e=0;e<li;e++)s[2*(c*li+e)+0]=c,s[2*(c*li+e)+1]=e,s[2*(c*li+e)+2]=0,s[2*(c*li+e)+3]=0;const o=e.createBuffer(i),a=e.createBuffer(r),l=e.createBuffer(s);super(e,{...t,vs:{wgsl:"struct AppUniforms {\n  modelMatrix: mat4x4<f32>,\n  viewMatrix: mat4x4<f32>,\n  projectionMatrix: mat4x4<f32>,\n  time: f32,\n};\n\n@binding(0) @group(0) var<uniform> app : AppUniforms;\n\nstruct VertexInputs {\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) normals : vec3<f32>,\n  // INSTANCED ATTRIBUTES\n  @location(2) instanceOffsets : vec2<f32>,\n  @location(3) instanceColors : vec4<f32>,\n  @location(4) instancePickingColors : vec2<f32>,\n}\n\nstruct FragmentInputs {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) normal: vec3<f32>,\n  @location(1) color : vec4<f32>,\n}\n\n@vertex\nfn main(inputs: VertexInputs) -> FragmentInputs {\n  var outputs: FragmentInputs;\n\n  outputs.normal = (app.modelMatrix * vec4<f32>(inputs.normals, 0.0)).xyz;\n  outputs.color = inputs.instanceColors;\n\n  // vec4 pickColor = vec4(0., instancePickingColors, 1.0);\n  // picking_setPickingColor(pickColor.rgb);\n\n  // Vertex position (z coordinate undulates with time), and model rotates around center\n  let delta = length(inputs.instanceOffsets);\n  let offset = vec4<f32>(inputs.instanceOffsets, sin((app.time + delta) * 0.1) * 16.0, 0);\n  outputs.Position = app.projectionMatrix * app.viewMatrix * (app.modelMatrix * inputs.positions + offset);\n  return outputs;\n}\n",glsl:oi},fs:{wgsl:"\nstruct DirlightUniforms {\n  lightDirection: vec3<f32>,\n}\n\n// @binding(1) @group(0) var<uniform> dirlight : DirlightUniforms;\n\nfn dirlight_filterColor(color: vec4<f32>, normal: vec3<f32>) -> vec4<f32> {\n  const dirlight_lightDirection = vec3<f32>(1, 1, 2);\n  let d: f32 = abs(dot(normal, normalize(dirlight_lightDirection)));\n  return vec4<f32>(color.rgb * d, color.a);\n}\n\nstruct FragmentInputs {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) normal: vec3<f32>,\n  @location(1) color : vec4<f32>,\n}\n\n@fragment\nfn main(inputs: FragmentInputs) -> @location(0) vec4<f32> { \n  return dirlight_filterColor(inputs.color, inputs.normal); \n}\n",glsl:ai},modules:"webgpu"!==e.info.type?[mn,ti]:[],instanceCount:65536,geometry:new sn({indices:!0}),bufferLayout:[{name:"instanceOffsets",format:"float32x2"},{name:"instanceColors",format:"unorm8x4"},{name:"instancePickingColors",format:"unorm8x4"}],attributes:{instanceOffsets:o,instanceColors:a,instancePickingColors:l},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}}const ui={uniformTypes:{modelMatrix:"mat4x4<f32>",viewMatrix:"mat4x4<f32>",projectionMatrix:"mat4x4<f32>",time:"f32"}};class hi extends g{constructor(e){let{device:t,animationLoop:n}=e;super(),this.shaderInputs=new zt({app:ui,dirlight:mn,picking:ti}),this.timeline=new R,n.attachTimeline(this.timeline),this.timeline.play(),this.timelineChannels={timeChannel:this.timeline.addChannel({rate:.01}),eyeXChannel:this.timeline.addChannel({rate:3e-4}),eyeYChannel:this.timeline.addChannel({rate:4e-4}),eyeZChannel:this.timeline.addChannel({rate:2e-4})},"webgpu"!==t.info.type&&(this.pickingFramebuffer=t.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"})),this.cube=new ci(t,{shaderInputs:this.shaderInputs})}onRender(e){const{device:t,aspect:n,tick:i}=e,{_mousePosition:r}=e,{timeChannel:s,eyeXChannel:o,eyeYChannel:a,eyeZChannel:l}=this.timelineChannels;this.shaderInputs.setProps({app:{time:this.timeline.getTime(s),projectionMatrix:(new An.k).perspective({fovy:(0,Rn.F2)(60),aspect:n,near:1,far:2048}),viewMatrix:(new An.k).lookAt({center:[0,0,0],eye:[Math.cos(this.timeline.getTime(o))*li/2,Math.sin(this.timeline.getTime(a))*li/2,(Math.sin(this.timeline.getTime(l))+1)*li/4+32]}),modelMatrix:(new An.k).rotateX(.01*i).rotateY(.013*i)}}),"webgpu"!==t.info.type&&this.pickInstance(t,r,this.cube,this.pickingFramebuffer);const c=t.beginRenderPass({clearColor:[0,0,0,1],clearDepth:1,clearStencil:0});this.cube.draw(c),c.end()}onFinalize(e){this.cube.destroy()}pickInstance(e,t,n,i){if(!t)return void this.shaderInputs.setProps({picking:{highlightedObjectColor:null}});const r=e.canvasContext.cssToDevicePixels(t),s=r.x+Math.floor(r.width/2),o=r.y+Math.floor(r.height/2);i.resize(e.canvasContext.getPixelSize()),this.shaderInputs.setProps({picking:{isActive:!0}});const a=e.beginRenderPass({framebuffer:i,clearColor:[0,0,0,0],clearDepth:1});n.draw(a),a.end();const l=i.device.readPixelsToArrayWebGL(i,{sourceX:s,sourceY:o,sourceWidth:1,sourceHeight:1});let c=new Float32Array(l).map((e=>e/255));c[0]+c[1]+c[2]>0||(c=null),this.shaderInputs.setProps({picking:{isActive:!1,highlightedObjectColor:c}})}}hi.info="\n<p>\nCube drawn with <b>instanced rendering</b>.\n<p>\nA luma.gl <code>Cube</code>, rendering 65,536 instances in a\nsingle GPU draw call using instanced vertex attributes.\n",hi.props={createFramebuffer:!0,debug:!0};class _i extends rn{constructor(e){void 0===e&&(e={});const{id:t=(0,S.L)("sphere-geometry")}=e,{indices:n,attributes:i}=function(e){const{nlat:t=10,nlong:n=10}=e,i=0,r=Math.PI-i,s=0,o=2*Math.PI-s,a=(t+1)*(n+1),l=(t,n,i,r,s)=>e.radius||1,c=new Float32Array(3*a),u=new Float32Array(3*a),h=new Float32Array(2*a),_=new(a>65535?Uint32Array:Uint16Array)(t*n*6);for(let f=0;f<=t;f++)for(let e=0;e<=n;e++){const i=e/n,s=f/t,a=e+f*(n+1),_=2*a,d=3*a,p=o*i,E=r*s,g=Math.sin(p),m=Math.cos(p),A=Math.sin(E),R=m*A,T=Math.cos(E),v=g*A,S=l(R,T,v,i,s);c[d+0]=S*R,c[d+1]=S*T,c[d+2]=S*v,u[d+0]=R,u[d+1]=T,u[d+2]=v,h[_+0]=i,h[_+1]=1-s}const d=n+1;for(let f=0;f<n;f++)for(let e=0;e<t;e++){const n=6*(f*t+e);_[n+0]=e*d+f,_[n+1]=e*d+f+1,_[n+2]=(e+1)*d+f,_[n+3]=(e+1)*d+f,_[n+4]=e*d+f+1,_[n+5]=(e+1)*d+f+1}return{indices:{size:1,value:_},attributes:{POSITION:{size:3,value:c},NORMAL:{size:3,value:u},TEXCOORD_0:{size:2,value:h}}}}(e);super({...e,id:t,topology:"triangle-list",indices:n,attributes:{...i,...e.attributes}})}}var di,fi,pi,Ei,gi,mi=n(7909);function Ai(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Ri={uniformTypes:{color:"vec3<f32>",lighting:"f32",modelViewMatrix:"mat4x4<f32>",projectionMatrix:"mat4x3<f32>"}},Ti=s(di||(di=Ai(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform sphereUniforms {\n  // fragment shader\n  vec3 color;\n  bool lighting;\n  // vertex shader\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nout vec3 normal;\n\nvoid main(void) {\n  gl_Position = sphere.projectionMatrix * sphere.modelViewMatrix * vec4(positions, 1.0);\n  normal = vec3((sphere.modelViewMatrix * vec4(normals, 0.0)));\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\n\nuniform sphereUniforms {\n  // fragment shader\n  vec3 color;\n  bool lighting;\n  // vertex shader\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nout vec3 normal;\n\nvoid main(void) {\n  gl_Position = sphere.projectionMatrix * sphere.modelViewMatrix * vec4(positions, 1.0);\n  normal = vec3((sphere.modelViewMatrix * vec4(normals, 0.0)));\n}\n"]))),vi=s(fi||(fi=Ai(["#version 300 es\n\nprecision highp float;\n\nuniform sphereUniforms {\n  // fragment\n  vec3 color;\n  bool lighting;\n  // vertex\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nin vec3 normal;\nout vec4 fragColor;\n\nvoid main(void) {\n  float attenuation = 1.0;\n  if (sphere.lighting) {\n    vec3 light = normalize(vec3(1,1,2));\n    attenuation = dot(normal, light);\n  }\n  fragColor = vec4(sphere.color * attenuation, 1);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sphereUniforms {\n  // fragment\n  vec3 color;\n  bool lighting;\n  // vertex\n  mat4 modelViewMatrix;\n  mat4 projectionMatrix;\n} sphere;\n\nin vec3 normal;\nout vec4 fragColor;\n\nvoid main(void) {\n  float attenuation = 1.0;\n  if (sphere.lighting) {\n    vec3 light = normalize(vec3(1,1,2));\n    attenuation = dot(normal, light);\n  }\n  fragColor = vec4(sphere.color * attenuation, 1);\n}\n"]))),Si={uniformTypes:{resolution:"vec2<f32>"}},bi=s(pi||(pi=Ai(["#version 300 es\n\nin vec2 aPosition;\n\nvoid main(void) {\n  gl_Position = vec4(aPosition, 0, 1);\n}\n"],["\\\n#version 300 es\n\nin vec2 aPosition;\n\nvoid main(void) {\n  gl_Position = vec4(aPosition, 0, 1);\n}\n"]))),Ci=s(Ei||(Ei=Ai(["#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nuniform screenQuadUniforms {\n  vec2 resolution;\n} screenQuad;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy/screenQuad.resolution.xy;\n  fragColor = texture(uTexture, p);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nuniform screenQuadUniforms {\n  vec2 resolution;\n} screenQuad;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy/screenQuad.resolution.xy;\n  fragColor = texture(uTexture, p);\n}\n"]))),yi={uniformTypes:{resolution:"vec2<f32>"}},Ni=s(gi||(gi=Ai(["#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uScene;\nuniform sampler2D uPersistence;\n\nuniform persistenceQuadUniforms {\n  vec2 resolution;\n} persistence;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy / persistence.resolution.xy;\n  vec4 cS = texture(uScene, p);\n  vec4 cP = texture(uPersistence, p);\n  fragColor = mix(cS*4.0, cP, 0.9);\n}\n"],["\\\n#version 300 es\n\nprecision highp float;\n\nuniform sampler2D uScene;\nuniform sampler2D uPersistence;\n\nuniform persistenceQuadUniforms {\n  vec2 resolution;\n} persistence;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec2 p = gl_FragCoord.xy / persistence.resolution.xy;\n  vec4 cS = texture(uScene, p);\n  vec4 cP = texture(uPersistence, p);\n  fragColor = mix(cS*4.0, cP, 0.9);\n}\n"]))),Ii=Tn(),Li=[],wi=[],Pi=[];class Fi extends g{constructor(e){let{device:t,width:n,height:i}=e;super(),this.uniformStore=new E({sphere:Ri,screenQuad:Si,persistenceQuad:yi}),this.electron=new en(t,{id:"electron",vs:Ti,fs:vi,geometry:new _i({nlat:20,nlong:30}),bindings:{sphere:this.uniformStore.getManagedUniformBuffer(t,"sphere")},parameters:{depthWriteEnabled:!0,depthCompare:"less",cullMode:"back"}}),this.nucleon=new en(t,{id:"nucleon",vs:Ti,fs:vi,geometry:new _i({nlat:20,nlong:30}),parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"},bindings:{sphere:this.uniformStore.getManagedUniformBuffer(t,"sphere")}}),this.mainFramebuffer=t.createFramebuffer({width:n,height:i,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"}),this.pingpongFramebuffers=[t.createFramebuffer({width:n,height:i,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"}),t.createFramebuffer({width:n,height:i,colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth24plus"})];const r=new rn({topology:"triangle-list",attributes:{aPosition:{value:new Float32Array([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1]),size:2}},vertexCount:6});this.screenQuad=new en(t,{id:"quad",vs:bi,fs:Ci,geometry:r,bindings:{screenQuad:this.uniformStore.getManagedUniformBuffer(t,"screenQuad")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"}}),this.persistenceQuad=new en(t,{id:"persistence-quad",vs:bi,fs:Ni,geometry:r,bindings:{persistenceQuad:this.uniformStore.getManagedUniformBuffer(t,"persistenceQuad")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal",cullMode:"back"}});for(let s=0;s<64;s++){const e=new mi.P(Ii()-.5,Ii()-.5,Ii()-.5),t=Ii()+1;e.normalize().scale(t);const n=1.25;e.scale(n),Li.push(e);const i=new mi.P(Ii()-.5,Ii()-.5,Ii()-.5),r=e.clone().cross(i).normalize(),s=4/t*.0125,o=(new An.k).rotateAxis(s,r);wi.push(o)}for(let s=0;s<64;s++){let e=new mi.P(Ii()-.5,Ii()-.5,Ii()-.5);e=e.normalize().scale(.5),Pi.push(e)}}onFinalize(e){this.electron.destroy(),this.nucleon.destroy(),this.mainFramebuffer.destroy(),this.pingpongFramebuffers[0].destroy(),this.pingpongFramebuffers[1].destroy(),this.screenQuad.destroy(),this.persistenceQuad.destroy()}onRender(e){let{device:t,tick:n,width:i,height:r,aspect:s}=e;this.mainFramebuffer.resize({width:i,height:r}),this.pingpongFramebuffers[0].resize({width:i,height:r}),this.pingpongFramebuffers[1].resize({width:i,height:r});const o=(new An.k).perspective({fovy:(0,Rn.F2)(75),aspect:s}),a=(new An.k).lookAt({eye:[0,0,4]}),l=t.beginRenderPass({framebuffer:this.mainFramebuffer,clearColor:[0,0,0,1],clearDepth:1});this.uniformStore.setUniforms({sphere:{color:[0,.5,1],lighting:!1}});for(let f=0;f<64;f++){Li[f]=wi[f].transformVector(Li[f]);const e=(new An.k).translate(Li[f]).scale([.06125,.06125,.06125]);this.uniformStore.setUniforms({sphere:{modelViewMatrix:a.clone().multiplyRight(e),projectionMatrix:o}}),this.uniformStore.updateUniformBuffers(),this.electron.draw(l)}this.uniformStore.setUniforms({sphere:{color:[1,.25,.25],lighting:!0}});for(let f=0;f<64;f++){const e=(new An.k).rotateXYZ([.013*n,0,0]).rotateXYZ([0,.021*n,0]).translate(Pi[f]),t=[e[12],e[13],e[14]];e.identity().translate(t).scale([.25,.25,.25]),this.uniformStore.setUniforms({sphere:{modelViewMatrix:a.clone().multiplyRight(e),projectionMatrix:o}}),this.uniformStore.updateUniformBuffers(),this.nucleon.draw(l)}l.end();const c=n%2,u=this.pingpongFramebuffers[c],h=this.pingpongFramebuffers[1-c],_=t.beginRenderPass({framebuffer:u,clearColor:[0,0,0,1]});this.persistenceQuad.setBindings({uScene:this.mainFramebuffer.colorAttachments[0],uPersistence:h.colorAttachments[0]}),this.uniformStore.setUniforms({persistenceQuad:{resolution:[i,r]}}),this.uniformStore.updateUniformBuffers(),this.persistenceQuad.draw(_),_.end();const d=t.beginRenderPass({clearColor:[1,0,0,1]});this.screenQuad.setBindings({uTexture:u.colorAttachments[0]}),this.uniformStore.setUniforms({screenQuad:{resolution:[i,r]}}),this.uniformStore.updateUniformBuffers(),this.screenQuad.draw(d),d.end()}}var Oi,Mi;function xi(e,t){return t||(t=e.slice(0)),e.raw=t,e}Fi.info="\n<p>\n  Electron trails renderings persist across multiple frames.\n<p>\n  Uses multiple luma.gl <code>Framebuffer</code>s to hold previously rendered data between frames.\n</p>\n";const Di={uniformTypes:{mvpMatrix:"mat4x4<f32>"}},Bi=s(Oi||(Oi=xi(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 uMVP;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\n\nvoid main(void) {\n  gl_Position = app.uMVP * vec4(positions, 1.0);\n  fragUV = texCoords;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 uMVP;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\n\nvoid main(void) {\n  gl_Position = app.uMVP * vec4(positions, 1.0);\n  fragUV = texCoords;\n}\n"]))),Ui=s(Mi||(Mi=xi(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main(void) {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main(void) {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));\n}\n"]))),Gi=[0,0,5];class ki extends g{constructor(e){let{device:t}=e;super(),this.mvpMatrix=new An.k,this.viewMatrix=(new An.k).lookAt({eye:Gi}),this.uniformStore=new E({app:Di});const n=t.createTexture({data:(0,Mn.yt)("vis-logo.png"),mipmaps:!0,sampler:t.createSampler({minFilter:"linear",magFilter:"linear",mipmapFilter:"linear"})});this.model=new en(t,{vs:Bi,fs:Ui,geometry:new sn({indices:!1}),bindings:{uTexture:n,app:this.uniformStore.getManagedUniformBuffer(t,"app")},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.model.destroy(),this.uniformStore.destroy()}onRender(e){let{device:t,aspect:n,tick:i}=e;this.mvpMatrix.perspective({fovy:Math.PI/3,aspect:n}).multiplyRight(this.viewMatrix).rotateX(.01*i).rotateY(.013*i),this.uniformStore.setUniforms({app:{mvpMatrix:this.mvpMatrix}});const r=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(r),r.end()}}var Hi,Vi,Xi,Wi;function Ki(e,t){return t||(t=e.slice(0)),e.raw=t,e}ki.info="<p>\nDrawing a textured cube\n</p>\n";const zi={name:"color",vs:s(Hi||(Hi=Ki(["out vec3 color_vColor;\n\nvoid color_setColor(vec3 color) {\n  color_vColor = color;\n}\n  "],["\\\nout vec3 color_vColor;\n\nvoid color_setColor(vec3 color) {\n  color_vColor = color;\n}\n  "]))),fs:s(Vi||(Vi=Ki(["in vec3 color_vColor;\n\nvec3 color_getColor() {\n  return color_vColor;\n}\n  "],["\\\nin vec3 color_vColor;\n\nvec3 color_getColor() {\n  return color_vColor;\n}\n  "])))};class Yi extends g{constructor(e){let{device:t}=e;super(),this.positionBuffer=t.createBuffer(new Float32Array([-.2,-.2,.2,-.2,0,.2])),this.colorBuffer=t.createBuffer(new Float32Array([1,0,0,0,1,0,0,0,1,1,1,0])),this.offsetBuffer=t.createBuffer(new Float32Array([.5,.5,-.5,.5,.5,-.5,-.5,-.5])),this.model=new en(t,{vs:s(Xi||(Xi=Ki(["#version 300 es\nin vec2 position;\nin vec3 instanceColor;\nin vec2 instanceOffset;\n\nvoid main() {\n  color_setColor(instanceColor);\n  gl_Position = vec4(position + instanceOffset, 0.0, 1.0);\n}\n      "],["\\\n#version 300 es\nin vec2 position;\nin vec3 instanceColor;\nin vec2 instanceOffset;\n\nvoid main() {\n  color_setColor(instanceColor);\n  gl_Position = vec4(position + instanceOffset, 0.0, 1.0);\n}\n      "]))),fs:s(Wi||(Wi=Ki(["#version 300 es\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(color_getColor(), 1.0);\n}\n      "],["\\\n#version 300 es\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(color_getColor(), 1.0);\n}\n      "]))),modules:[zi],bufferLayout:[{name:"position",format:"float32x2"},{name:"instanceColor",format:"float32x3",stepMode:"instance"},{name:"instanceOffset",format:"float32x2",stepMode:"instance"}],attributes:{position:this.positionBuffer,instanceColor:this.colorBuffer,instanceOffset:this.offsetBuffer},vertexCount:3,instanceCount:4})}onFinalize(){this.model.destroy(),this.positionBuffer.destroy(),this.colorBuffer.destroy(),this.offsetBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(n),n.end()}}var ji;Yi.info="\nInstanced triangles using luma.gl's high-level API\n";const qi=s(ji||(ji=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["#version 300 es\n\nin vec3 vColor;\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(vColor, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 vColor;\nout vec4 fragColor;\nvoid main() {\n  fragColor = vec4(vColor, 1.0);\n}\n"])));class Qi extends g{constructor(e){let{device:t}=e;super();const n=new Float32Array([0,0,-.5,-.5,1,0,0,.5,-.5,0,1,0,0,.5,0,0,1]);this.interleavedBuffer=t.createBuffer(n),this.model=new en(t,{id:"triangle",vs:"#version 300 es\n\nin vec2 position;\nin vec3 color;\n\nout vec3 vColor;\n\nvoid main() {\n  vColor = color;\n  gl_Position = vec4(position, 0.0, 1.0);\n}\n",fs:qi,bufferLayout:[{name:"vertexData",byteStride:20,attributes:[{attribute:"position",format:"float32x2",byteOffset:8},{attribute:"color",format:"float32x3",byteOffset:16}]}],attributes:{vertexData:this.interleavedBuffer},vertexCount:3})}onFinalize(){this.model.destroy(),this.interleavedBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(n),n.end()}}var Zi;Qi.info="\nHave to start somewhere...\n";const Ji=et(Zi||(Zi=function(e,t){return t||(t=e.slice(0)),e.raw=t,e}(["precision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int pointLightCount;\n  int directionalLightCount;\n\n  vec3 ambientColor;\n\n  int lightType;\n  vec3 lightColor;\n  vec3 lightDirection;\n  vec3 lightPosition;\n  vec3 lightAttenuation;\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n"],["\\\nprecision highp int;\n\n// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))\nstruct AmbientLight {\n  vec3 color;\n};\n\nstruct PointLight {\n  vec3 color;\n  vec3 position;\n  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential\n};\n\nstruct DirectionalLight {\n  vec3 color;\n  vec3 direction;\n};\n\nuniform lightingUniforms {\n  int enabled;\n  int pointLightCount;\n  int directionalLightCount;\n\n  vec3 ambientColor;\n\n  int lightType;\n  vec3 lightColor;\n  vec3 lightDirection;\n  vec3 lightPosition;\n  vec3 lightAttenuation;\n\n  // AmbientLight ambientLight;\n  // PointLight pointLight[MAX_LIGHTS];\n  // DirectionalLight directionalLight[MAX_LIGHTS];\n} lighting;\n\nPointLight lighting_getPointLight(int index) {\n  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);\n}\n\nDirectionalLight lighting_getDirectionalLight(int index) {\n  return DirectionalLight(lighting.lightColor, lighting.lightDirection);\n} \n\nfloat getPointLightAttenuation(PointLight pointLight, float distance) {\n  return pointLight.attenuation.x\n       + pointLight.attenuation.y * distance\n       + pointLight.attenuation.z * distance * distance;\n}\n\n// #endif\n"]))),$i=255;var er=function(e){return e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL",e}(er||{});const tr={name:"lighting",vs:Ji,fs:Ji,getUniforms:(e,t)=>function(e,t){void 0===t&&(t={});if(e=e?{...e}:e,!e)return{...tr.defaultUniforms};e.lights&&(e={...e,...ir(e.lights),lights:void 0});const{ambientLight:n,pointLights:i,directionalLights:r}=e||{};if(!(n||i&&i.length>0||r&&r.length>0))return{...tr.defaultUniforms,enabled:0};const s={...tr.defaultUniforms,...t,...nr({ambientLight:n,pointLights:i,directionalLights:r})};void 0!==e.enabled&&(s.enabled=e.enabled?1:0);return s}(e),defines:{MAX_LIGHTS:5},uniformTypes:{enabled:"i32",ambientLightColor:"vec3<f32>",numberOfLights:"i32",lightType:"i32",lightColor:"vec3<f32>",lightPosition:"vec3<f32>",lightDirection:"vec3<f32>",lightAttenuation:"vec3<f32>"},defaultUniforms:{enabled:1,ambientLightColor:[.1,.1,.1],numberOfLights:0,lightType:er.POINT,lightColor:[1,1,1],lightPosition:[1,1,2],lightDirection:[1,1,1],lightAttenuation:[1,1,1]}};function nr(e){let{ambientLight:t,pointLights:n=[],directionalLights:i=[]}=e;const r={};r.ambientLightColor=rr(t);let s=0;for(const o of n)r.lightType=er.POINT,r.lightColor=rr(o),r.lightPosition=o.position,r.lightAttenuation=[o.attenuation||1,0,0],s++;for(const o of i)r.lightType=er.DIRECTIONAL,r.lightColor=rr(o),r.lightPosition=o.position,r.lightDirection=o.direction,s++;return r.numberOfLights=s,r}function ir(e){var t,n;const i={pointLights:[],directionalLights:[]};for(const r of e||[])switch(r.type){case"ambient":i.ambientLight=r;break;case"directional":null==(t=i.directionalLights)||t.push(r);break;case"point":null==(n=i.pointLights)||n.push(r)}return i}function rr(e){void 0===e&&(e={});const{color:t=[0,0,0],intensity:n=1}=e;return t.map((e=>e*n/$i))}var sr,or;function ar(e,t){return t||(t=e.slice(0)),e.raw=t,e}const lr={name:"phong-lighting",vs:et(sr||(sr=ar(["uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n"],["\\\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n"]))),fs:et(or||(or=ar(["uniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    PointLight pointLight = lighting_getPointLight(0);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0:\n        PointLight pointLight = lighting_getPointLight(0);\n        vec3 light_position_worldspace = pointLight.position;\n        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n        break;\n\n      case 1:\n        DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n        break;\n    }\n  }\n  return lightColor;\n}\n"],["\\\nuniform phongMaterialUniforms {\n  uniform float ambient;\n  uniform float diffuse;\n  uniform float shininess;\n  uniform vec3  specularColor;\n} material;\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {\n  vec3 halfway_direction = normalize(light_direction + view_direction);\n  float lambertian = dot(light_direction, normal_worldspace);\n  float specular = 0.0;\n  if (lambertian > 0.0) {\n    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nvec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  vec3 view_direction = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    PointLight pointLight = lighting_getPointLight(0);\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n  return lightColor;\n}\n\nvec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {\n  vec3 lightColor = vec3(0, 0, 0);\n  vec3 surfaceColor = vec3(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    vec3 view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0:\n        PointLight pointLight = lighting_getPointLight(0);\n        vec3 light_position_worldspace = pointLight.position;\n        vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n        break;\n\n      case 1:\n        DirectionalLight directionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n        break;\n    }\n  }\n  return lightColor;\n}\n"]))),defines:{LIGHTING_FRAGMENT:1},dependencies:[tr],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms:e=>({...lr.defaultUniforms,...e})};var cr,ur;function hr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const _r=s(cr||(cr=hr(["#version 300 es\n\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} app;\n\nvoid main(void) {\n  vPosition = (app.modelMatrix * vec4(positions, 1.0)).xyz;\n  vNormal = mat3(app.modelMatrix) * normals;\n  vUV = texCoords;\n  gl_Position = app.mvpMatrix * vec4(positions, 1.0);\n}\n"],["\\\n#version 300 es\n\nin vec3 positions;\nin vec3 normals;\nin vec2 texCoords;\n\nout vec3 vPosition;\nout vec3 vNormal;\nout vec2 vUV;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} app;\n\nvoid main(void) {\n  vPosition = (app.modelMatrix * vec4(positions, 1.0)).xyz;\n  vNormal = mat3(app.modelMatrix) * normals;\n  vUV = texCoords;\n  gl_Position = app.mvpMatrix * vec4(positions, 1.0);\n}\n"]))),dr=s(ur||(ur=hr(["#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nuniform sampler2D uTexture;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} uApp;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec3 surfaceColor = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n  surfaceColor = lighting_getLightColor(surfaceColor, uApp.eyePosition, vPosition, normalize(vNormal));\n\n  fragColor = vec4(surfaceColor, 1.0);\n}\n"],["\\\n#version 300 es\nprecision highp float;\n\nin vec3 vPosition;\nin vec3 vNormal;\nin vec2 vUV;\n\nuniform sampler2D uTexture;\n\nuniform appUniforms {\n  mat4 modelMatrix;\n  mat4 mvpMatrix;\n  vec3 eyePosition;\n} uApp;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  vec3 surfaceColor = texture(uTexture, vec2(vUV.x, 1.0 - vUV.y)).rgb;\n  surfaceColor = lighting_getLightColor(surfaceColor, uApp.eyePosition, vPosition, normalize(vNormal));\n\n  fragColor = vec4(surfaceColor, 1.0);\n}\n"]))),fr={name:"app",uniformTypes:{modelMatrix:"mat4x4<f32>",mvpMatrix:"mat4x4<f32>",eyePosition:"vec3<f32>"}},pr=[0,0,5];class Er extends g{constructor(e){let{device:t}=e;super(),this.shaderInputs=new zt({app:fr,lighting:tr,phongMaterial:lr}),this.modelMatrix=new An.k,this.viewMatrix=(new An.k).lookAt({eye:pr}),this.mvpMatrix=new An.k,this.shaderInputs.setProps({lighting:{lights:[{type:"ambient",color:[255,255,255]},{type:"point",color:[255,255,255],position:[1,2,1]}]},phongMaterial:{specularColor:[255,255,255]}});const n=t.createTexture({data:(0,Mn.yt)("vis-logo.png")});this.model=new en(t,{vs:_r,fs:dr,shaderInputs:this.shaderInputs,geometry:new sn,bindings:{uTexture:n},parameters:{depthWriteEnabled:!0,depthCompare:"less-equal"}})}onFinalize(){this.model.destroy()}onRender(e){let{device:t,aspect:n,tick:i}=e;this.modelMatrix.identity().rotateX(.01*i).rotateY(.013*i),this.mvpMatrix.perspective({fovy:Math.PI/3,aspect:n}).multiplyRight(this.viewMatrix).multiplyRight(this.modelMatrix),this.shaderInputs.setProps({app:{mvpMatrix:this.mvpMatrix,modelMatrix:this.modelMatrix}});const r=t.beginRenderPass({clearColor:[0,0,0,1],clearDepth:!0});this.model.draw(r),r.end()}}Er.info="\n<p>\nDrawing a phong-shaded cube\n</p>\n";const gr="#version 300 es\n\nin vec2 position;\n\nvoid main() {\n  gl_Position = vec4(position, 0.0, 1.0);\n  OFFSET_POSITION(gl_Position);\n}\n",mr="#version 300 es\n\nuniform appUniforms {  \n  vec3 color;\n} app;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(app.color, 1.0);\n}\n",Ar={name:"offsetLeft",inject:{"vs:OFFSET_POSITION":"position.x -= 0.5;"}},Rr={name:"offsetRight",inject:{"vs:OFFSET_POSITION":"position.x += 0.5;"}};class Tr extends g{constructor(e){let{device:t}=e;super(),this.uniformStore=new E({app:{uniformTypes:{color:"vec3<f32>"}}});const n=Kt.getDefaultShaderAssembler();n.addShaderHook("vs:OFFSET_POSITION(inout vec4 position)"),this.positionBuffer=t.createBuffer(new Float32Array([-.3,-.5,.3,-.5,0,.5])),this.uniformBuffer1=this.uniformStore.createUniformBuffer(t,"app",{app:{color:[1,0,0]}});const i=this.uniformStore.getUniformBufferData("app");this.uniformBuffer1.write(i),this.uniformBuffer2=this.uniformStore.createUniformBuffer(t,"app",{app:{color:[0,0,1]}}),this.model1=new en(t,{vs:gr,fs:mr,shaderAssembler:n,modules:[Ar],bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3,bindings:{app:this.uniformBuffer1}}),this.model2=new en(t,{vs:gr,fs:mr,shaderAssembler:n,modules:[Rr],bufferLayout:[{name:"position",format:"float32x2"}],vertexCount:3,attributes:{position:this.positionBuffer},bindings:{app:this.uniformBuffer2}})}onFinalize(){this.model1.destroy(),this.model2.destroy(),this.positionBuffer.destroy(),this.uniformStore.destroy(),this.uniformBuffer1.destroy(),this.uniformBuffer2.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model1.draw(n),this.model2.draw(n),n.end()}}Tr.info="\nModifying shader behavior with shader hooks\n";const vr={name:"color",fs:"\nvec3 color_hsv2rgb(vec3 hsv) {\n  vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n  vec3 p = abs(fract(hsv.xxx + K.xyz) * 6.0 - K.www);\n  vec3 rgb = hsv.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), hsv.y);\n  return rgb;\n}\n  ",uniformTypes:{hsv:"vec3<f32>"}};class Sr extends g{constructor(e){let{device:t}=e;super(),this.shaderInputs1=new zt({color:vr}),this.shaderInputs2=new zt({color:vr}),this.positionBuffer=t.createBuffer(new Float32Array([-.3,-.5,.3,-.5,0,.5])),this.shaderInputs1.setProps({color:{hsv:[.7,1,1]}}),this.shaderInputs2.setProps({color:{hsv:[1,1,1]}}),this.model1=new en(t,{vs:"#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position - vec2(0.5, 0.0), 0.0, 1.0);\n}\n",fs:"#version 300 es\nprecision highp float;\n\nuniform colorUniforms {\n  vec3 hsv;\n} color;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(color_hsv2rgb(color.hsv), 1.0);\n}\n",shaderInputs:this.shaderInputs1,bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3}),this.model2=new en(t,{vs:"#version 300 es\nin vec2 position;\nvoid main() {\n  gl_Position = vec4(position + vec2(0.5, 0.0), 0.0, 1.0);\n}\n",fs:"#version 300 es\n\nprecision highp float;\n\nuniform colorUniforms {\n  vec3 hsv;\n} color;\n\nout vec4 fragColor;\n\nvoid main() {\n  fragColor = vec4(color_hsv2rgb(color.hsv) - 0.3, 1.0);\n}\n",shaderInputs:this.shaderInputs2,bufferLayout:[{name:"position",format:"float32x2"}],attributes:{position:this.positionBuffer},vertexCount:3})}onFinalize(){this.model1.destroy(),this.model2.destroy(),this.positionBuffer.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[0,0,0,1]});this.model1.draw(n),this.model2.draw(n),n.end()}}var br,Cr;function yr(e,t){return t||(t=e.slice(0)),e.raw=t,e}Sr.info="\nRe-using shader code with shader modules\n";const Nr={vs:{glsl:s(br||(br=yr(["#version 300 es\nconst vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\nvoid main() {\n  gl_Position = vec4(pos[gl_VertexID], 0.0, 1.0);\n}\n"],["\\\n#version 300 es\nconst vec2 pos[3] = vec2[3](vec2(0.0f, 0.5f), vec2(-0.5f, -0.5f), vec2(0.5f, -0.5f));\nvoid main() {\n  gl_Position = vec4(pos[gl_VertexID], 0.0, 1.0);\n}\n"]))),wgsl:"@vertex\nfn main(@builtin(vertex_index) VertexIndex : u32) -> @builtin(position) vec4<f32> {\n  var pos = array<vec2<f32>, 3>(\n    vec2(0.0, 0.5),\n    vec2(-0.5, -0.5),\n    vec2(0.5, -0.5)\n  );\n\n  return vec4<f32>(pos[VertexIndex], 0.0, 1.0);\n}\n"},fs:{glsl:s(Cr||(Cr=yr(["#version 300 es\nprecision highp float;\nlayout(location = 0) out vec4 outColor;\nvoid main() {\n    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n"],["\\\n#version 300 es\nprecision highp float;\nlayout(location = 0) out vec4 outColor;\nvoid main() {\n    outColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n"]))),wgsl:"@fragment\nfn main() -> @location(0) vec4<f32> {\n  return vec4<f32>(1.0, 0.0, 0.0, 1.0);\n}\n"}};class Ir extends g{constructor(e){let{device:t}=e;super(),this.model=new en(t,{vs:Nr.vs,fs:Nr.fs,topology:"triangle-list",vertexCount:3,shaderLayout:{attributes:[],bindings:[]},parameters:{depthFormat:"depth24plus"}})}onFinalize(){this.model.destroy()}onRender(e){let{device:t}=e;const n=t.beginRenderPass({clearColor:[1,1,1,1]});this.model.draw(n),n.end()}}var Lr,wr;function Pr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Fr=s(Lr||(Lr=Pr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix[16];\n} app;\n\n// CUBE GEOMETRY\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix[gl_InstanceID] * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix[16];\n} app;\n\n// CUBE GEOMETRY\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix[gl_InstanceID] * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"]))),Or=s(wr||(wr=Pr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class Mr extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer=t.createBuffer({id:"uniforms",usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:1024}),this.cubeModel=new en(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : array<mat4x4<f32>, 16>,\n};\n\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  @builtin(instance_index) instanceIdx : u32,\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix[instanceIdx] * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4<f32>(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:Fr},fs:{wgsl:"@fragment\nfn main(\n  @location(0) fragUV: vec2<f32>,\n  @location(1) fragPosition: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:Or},geometry:new sn({indices:!1}),instanceCount:16,parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer}})}onFinalize(e){this.uniformBuffer.destroy(),this.cubeModel.destroy()}onRender(e){var t;let{device:n}=e;const i=new An.k,r=null==(t=n.canvasContext)?void 0:t.getAspect(),s=Date.now()/1e3;i.perspective({fovy:2*Math.PI/5,aspect:r,near:1,far:100});const o=function(e,t){const n=(new An.k).translate([0,0,-12]),i=new An.k;let r=0,s=0;for(let o=0;o<4;o++)for(let a=0;a<4;a++)i.copy(xr[r]).rotateAxis(1,[Math.sin((o+.5)*t),Math.cos((a+.5)*t),0]).multiplyLeft(n).multiplyLeft(e),Dr.set(i,s),r++,s+=16;return Dr}(i,s);this.uniformBuffer.write(o);const a=n.beginRenderPass();this.cubeModel.draw(a),a.end()}}const xr=[];for(let Ts=0;Ts<4;Ts++)for(let e=0;e<4;e++)xr.push((new An.k).translate([4*(Ts-2+.5),4*(e-2+.5),0]));const Dr=new Float32Array(256);var Br,Ur;function Gr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const kr=s(Br||(Br=Gr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = 0.5 * (vec4(positions, 1.) + vec4(1., 1., 1., 1.));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = 0.5 * (vec4(positions, 1.) + vec4(1., 1., 1., 1.));\n}\n"]))),Hr=s(Ur||(Ur=Gr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class Vr extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer=t.createBuffer({id:"uniforms",byteLength:64,usage:o.h.UNIFORM|o.h.COPY_DST}),this.model=new en(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  // CUBE GEOMETRY\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:kr},fs:{wgsl:"@fragment\nfn main(\n  @location(0) fragUV: vec2<f32>,\n  @location(1) fragPosition: vec4<f32>\n) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:Hr},geometry:new sn({indices:!1}),parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer}})}onFinalize(){this.model.destroy(),this.uniformBuffer.destroy()}onRender(e){var t;let{device:n}=e;const i=new An.k,r=new An.k,s=new An.k,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;r.identity().translate([0,0,-4]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),i.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),s.copy(r).multiplyLeft(i),this.uniformBuffer.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.model.setBindings({app:this.uniformBuffer}),this.model.draw(l),l.end()}}var Xr,Wr;function Kr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const zr=s(Xr||(Xr=Kr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n  // fragPosition = 0.5 * (vec4(position, 1.) + vec4(1., 1., 1., 1.));\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\n// CUBE GEOMETRY \nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n  // fragPosition = 0.5 * (vec4(position, 1.) + vec4(1., 1., 1., 1.));\n}\n"]))),Yr=s(Wr||(Wr=Kr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform sampler2D uTexture;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = texture(uTexture, vec2(fragUV.x, 1.0 - fragUV.y));;\n}\n"])));class jr extends g{constructor(e){let{device:t}=e;super();const n=t.createTexture({data:(0,Mn.Dt)("https://raw.githubusercontent.com/uber/luma.gl/8.5-release/examples/getting-started/hello-cube/vis-logo.png"),mipmaps:!0,sampler:{magFilter:"linear",minFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}});this.uniformBuffer=t.createBuffer({id:"uniforms",byteLength:64,usage:o.h.UNIFORM|o.h.COPY_DST}),this.model=new en(t,{id:"cube",vs:{wgsl:"\nstruct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @ group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n};\n\n@vertex\nfn main(\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>) -> VertexOutput \n{\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4<f32>(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:zr},fs:{wgsl:"\n@group(0) @binding(1) var uSampler: sampler;\n@group(0) @binding(2) var uTexture: texture_2d<f32>;\n\n@fragment\nfn main(@location(0) fragUV: vec2<f32>,\n        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {\n  let flippedUV = vec2<f32>(1.0 - fragUV.x, fragUV.y);\n  return textureSample(uTexture, uSampler, flippedUV) * fragPosition;\n}\n",glsl:Yr},geometry:new sn({indices:!1}),bindings:{app:this.uniformBuffer,uSampler:n.sampler,uTexture:n},parameters:{depthWriteEnabled:!0,depthCompare:"less"}})}onFinalize(){this.model.destroy(),this.uniformBuffer.destroy()}onRender(e){var t;let{device:n}=e;const i=new An.k,r=new An.k,s=new An.k,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;r.identity().translate([0,0,-4]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),i.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),s.copy(r).multiplyLeft(i),this.uniformBuffer.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.model.draw(l),l.end()}}var qr,Qr;function Zr(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Jr=s(qr||(qr=Zr(["#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-vs\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nlayout(location=0) in vec3 positions;\nlayout(location=1) in vec2 texCoords;\n\nout vec2 fragUV;\nout vec4 fragPosition;\n\nvoid main() {\n  gl_Position = app.modelViewProjectionMatrix * vec4(positions, 1.0);\n  fragUV = texCoords;\n  fragPosition = vec4(positions, 1.);\n}\n"]))),$r=s(Qr||(Qr=Zr(["#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"],["\\\n#version 300 es\n#define SHADER_NAME cube-fs\nprecision highp float;\n\nuniform appUniforms {\n  mat4 modelViewProjectionMatrix;\n} app;\n\nin vec2 fragUV;\nin vec4 fragPosition;\n\nlayout (location=0) out vec4 fragColor;\n\nvoid main() {\n  fragColor = fragPosition;\n}\n"])));class es extends g{constructor(e){let{device:t}=e;super(),this.uniformBuffer1=t.createBuffer({id:"uniforms-1",usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:64}),this.uniformBuffer2=t.createBuffer({id:"uniforms-2",usage:o.h.UNIFORM|o.h.COPY_DST,byteLength:64}),this.cubeModel=new en(t,{id:"cube",vs:{wgsl:"struct Uniforms {\n  modelViewProjectionMatrix : mat4x4<f32>,\n};\n@binding(0) @group(0) var<uniform> app : Uniforms;\n\nstruct VertexOutput {\n  @builtin(position) Position : vec4<f32>,\n  @location(0) fragUV : vec2<f32>,\n  @location(1) fragPosition: vec4<f32>,\n}\n\n@vertex\nfn main(\n  @location(0) positions : vec4<f32>,\n  @location(1) texCoords : vec2<f32>\n) -> VertexOutput {\n  var output : VertexOutput;\n  output.Position = app.modelViewProjectionMatrix * positions;\n  output.fragUV = texCoords;\n  output.fragPosition = 0.5 * (positions + vec4(1.0, 1.0, 1.0, 1.0));\n  return output;\n}\n",glsl:Jr},fs:{wgsl:"\n@fragment\nfn main(@location(0) fragUV: vec2<f32>,\n        @location(1) fragPosition: vec4<f32>) -> @location(0) vec4<f32> {\n  return fragPosition;\n}\n",glsl:$r},geometry:new sn({indices:!1}),parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back"},bindings:{app:this.uniformBuffer1}})}onFinalize(){this.cubeModel.destroy(),this.uniformBuffer1.destroy(),this.uniformBuffer2.destroy()}onRender(e){var t;let{device:n}=e;const i=new An.k,r=new An.k,s=new An.k,o=null==(t=n.canvasContext)?void 0:t.getAspect(),a=Date.now()/1e3;i.perspective({fovy:2*Math.PI/5,aspect:o,near:1,far:100}),r.identity().translate([-2,0,-7]).rotateAxis(1,[Math.sin(a),Math.cos(a),0]),s.copy(r).multiplyLeft(i),this.uniformBuffer1.write(new Float32Array(s)),r.identity().translate([2,0,-7]).rotateAxis(1,[Math.cos(a),Math.sin(a),0]),s.copy(r).multiplyLeft(i),this.uniformBuffer2.write(new Float32Array(s));const l=n.beginRenderPass({clearColor:[0,0,0,1]});this.cubeModel.setBindings({app:this.uniformBuffer1}),this.cubeModel.draw(l),this.cubeModel.setBindings({app:this.uniformBuffer2}),this.cubeModel.draw(l),l.end()}}const ts={},ns=()=>i.createElement(r.fo,{id:"animation",directory:"api",template:Ln,config:ts}),is=()=>i.createElement(r.fo,{id:"cubemap",directory:"api",template:Un,config:ts}),rs=()=>i.createElement(r.fo,{id:"texture-3d",directory:"api-3d",template:Qn,config:ts}),ss=()=>i.createElement(r.fo,{id:"instancing",directory:"showcase",template:hi,config:ts}),os=()=>i.createElement(r.fo,{id:"persistence",directory:"showcase/persistence",template:Fi,config:ts}),as=()=>i.createElement(r.fo,{id:"hello-cube",directory:"tutorials",template:ki,config:ts}),ls=()=>i.createElement(r.fo,{id:"hello-instancing",directory:"tutorials",template:Yi,config:ts}),cs=()=>i.createElement(r.fo,{id:"hello-triangle",directory:"tutorials",template:Qi,config:ts}),us=()=>i.createElement("h2",null,i.createElement("i",null,"Note: Transform examples temporarily disabled")),hs=()=>i.createElement(r.fo,{id:"lighting",directory:"tutorials",template:Er,config:ts}),_s=()=>i.createElement(r.fo,{id:"shader-hooks",directory:"tutorials",template:Tr,config:ts}),ds=()=>i.createElement(r.fo,{id:"shader-modules",directory:"tutorials",template:Sr,config:ts}),fs=()=>i.createElement("h2",null,i.createElement("i",null,"Note: Transform examples temporarily disabled")),ps=()=>i.createElement("h2",null,i.createElement("i",null,"Note: Transform examples temporarily disabled")),Es=()=>i.createElement(r.fo,{id:"hello-triangle-webgpu",directory:"webgpu",template:Ir,config:ts}),gs=()=>i.createElement(r.fo,{id:"instanced-cubes-webgpu",directory:"webgpu",template:Mr,config:ts}),ms=()=>i.createElement(r.fo,{id:"rotating-cube-webgpu",directory:"webgpu",template:Vr,config:ts}),As=()=>i.createElement(r.fo,{id:"textured-cube-webgpu",directory:"webgpu",template:jr,config:ts}),Rs=()=>i.createElement(r.fo,{id:"two-cubes-webgpu",directory:"webgpu",template:es,config:ts})},354:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});var i=n(6540),r=n(7685),s=(n(4783),n(7639));function o(e){var t,n,i="";if("string"==typeof e||"number"==typeof e)i+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=o(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}const a=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=o(e))&&(i&&(i+=" "),i+=t);return i},l={features:"features_xdhU",featureSvg:"featureSvg__8YW"};function c(){return c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},c.apply(this,arguments)}const u=[{title:"The Right Stuff",Svg:n(3320).A,description:i.createElement(i.Fragment,null,"Focused on high-performance data processing, e.g. instanced rendering and GPU compute.")},{title:"Battle Tested",Svg:n(3320).A,description:i.createElement(i.Fragment,null,"The core 3D rendering technology behind tools such as deck.gl, kepler.gl, and avs.auto.")},{title:"Modern, Portable API",Svg:n(3320).A,description:i.createElement(i.Fragment,null,"A clean TypeScript and WebGPU friendly GPU API that works across WebGPU and WebGL 2.")}];function h(e){let{Svg:t,title:n,description:r}=e;return i.createElement("div",{className:a("col col--4")},i.createElement("div",{className:"text--center"},i.createElement(t,{className:l.featureSvg,alt:n})),i.createElement("div",{className:"text--center padding-horiz--md"},i.createElement("h3",null,n),i.createElement("p",null,r)))}function _(){return i.createElement("section",{className:l.features},i.createElement("div",{className:"container"},i.createElement("div",{className:"row"},u.map(((e,t)=>i.createElement(h,c({key:t},e)))))))}var d=n(3177);function f(){const{siteConfig:e}=(0,s.A)();return i.createElement(r.A,{title:""+e.title,description:"WebGPU and WebGL 2 APIs<head />"},i.createElement("main",null,i.createElement(d.LL,null),i.createElement(_,null)))}},3534:(e,t,n)=>{n.d(t,{xN:()=>Ii,Xj:()=>Pi,dJ:()=>Oi,yL:()=>Fi,R2:()=>Li,I$:()=>wi,fo:()=>Ui,dw:()=>Mi});var i=n(6540),r=n(5556),s=n.n(r);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},o.apply(this,arguments)}class a extends i.Component{render(){const{height:e,width:t,viewBox:n,style:r={},children:s,predefinedClassName:a,className:l,colors:c,totalColor:u,...h}=this.props,_=e,d=t||_;r.fill="currentColor";const f=Array.isArray(c)&&u&&((e,t)=>new Array(e).fill(1).reduce(((e,n,i)=>e+".cr"+(i+1)+" {fill:"+t[i%t.length]+";}"),""))(u,c);return i.createElement("svg",o({viewBox:n,width:d,height:_,style:r,className:a+" "+l},h),f?i.createElement("style",{type:"text/css"},f):null,s)}}a.displayName="Base Icon",a.propTypes={height:s().string,width:s().string,viewBox:s().string,children:s().node,predefinedClassName:s().string,className:s().string},a.defaultProps={height:null,width:null,viewBox:"0 0 64 64",predefinedClassName:"",className:""};const l=e=>i.createElement(a,e,i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.02167 13.7625C4.69623 13.4459 4.69623 12.9325 5.02167 12.6159L9.76574 8.00002L5.02167 3.38416C4.69623 3.06752 4.69623 2.55415 5.02167 2.2375C5.3471 1.92086 5.87474 1.92086 6.20018 2.2375L11.5335 7.42669C11.6898 7.57875 11.7776 7.78498 11.7776 8.00002C11.7776 8.21506 11.6898 8.4213 11.5335 8.57335L6.20018 13.7625C5.87474 14.0792 5.3471 14.0792 5.02167 13.7625Z"}));l.propTypes={height:s().string},l.defaultProps={height:"16px",viewBox:"0 0 17 16",predefinedClassName:"unfolded-icons-arrowbigright"};var c=n(4745),u=n(6769),h=n(3522),_=n(6237);const d=new class{constructor(){this.stats=new Map}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new _.A({id:e})),this.stats.get(e)}};const f=function(){const e="undefined"!=typeof __VERSION__?__VERSION__:"running from source";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error("luma.gl - multiple VERSIONs detected: "+globalThis.luma.VERSION+" vs "+e);return globalThis.luma||((0,u.A)()&&h.R.log(1,e+" - set luma.log.level=1 (or higher) to trace rendering")(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:h.R,stats:d}),e}();var p=n(469),E=n(5056),g=n(5787);const m=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],A=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function R(e){const t=A.exec(e);if(t){const[,e,n,i,r,s]=t;if(e){const t=""+i+n,o=(0,g.l)(t);return{format:e,components:e.length,srgb:"-srgb"===r,unsized:"-unsized"===s,webgl:"-webgl"===s,...o}}}return function(e){var t;const n=T[e];if(!n)throw new Error("Unknown format "+e);return{format:n.format||"",components:n.components||(null==(t=n.format)?void 0:t.length)||1,byteLength:n.bpp||1,srgb:!1,unsized:!1}}(e)}const T={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};let v;class S{}class b{constructor(e){void 0===e&&(e=[]),this.features=new Set(e)}*[Symbol.iterator](){yield*this.features}has(e){return this.features.has(e)}}v=Symbol.toStringTag;class C{get[v](){return"Device"}constructor(e){this.statsManager=d,this.userData={},this._lumaData={},this.props={...C.defaultProps,...e},this.id=this.props.id||(0,p.L)(this[Symbol.toStringTag].toLowerCase())}isTextureFormatCompressed(e){return t=e,m.some((e=>t.startsWith(e)));var t}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||"string"==typeof e)&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e){throw void 0===e&&(e={}),new Error("not implemented")}readPixelsToArrayWebGL(e,t){throw new Error("not implemented")}readPixelsToBufferWebGL(e,t){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,t){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const t={...e};return(e.usage||0)&E.h.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":h.R.warn("indices buffer content must be of integer type")()),t}}C.defaultProps={id:null,type:"best-available",canvas:null,container:null,manageState:!0,width:800,height:600,requestMaximalLimits:!0,debug:Boolean(h.R.get("debug")),spector:Boolean(h.R.get("spector")),break:[],gl:null,onError:e=>h.R.error(e.message)},C.VERSION=f;var y=n(4468);const N=new Map;class I{static registerDevices(e){for(const t of e)(0,y.v)(t.type&&t.isSupported&&t.create),N.set(t.type,t)}static getAvailableDevices(){return Array.from(N).map((e=>e.type))}static getSupportedDevices(){return Array.from(N).filter((e=>e.isSupported())).map((e=>e.type))}static setDefaultDeviceProps(e){Object.assign(C.defaultProps,e)}static async createDevice(e){let t;switch(void 0===e&&(e={}),(e={...C.defaultProps,...e}).gl&&(e.type="webgl"),e.type){case"webgpu":if(t=N.get("webgpu"),t)return await t.create(e);break;case"webgl":if(t=N.get("webgl"),t)return await t.create(e);break;case"best-available":if(t=N.get("webgpu"),t&&t.isSupported())return await t.create(e);if(t=N.get("webgl"),t&&t.isSupported())return await t.create(e)}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}}I.stats=d,I.log=h.R;const L=(0,u.A)()&&"undefined"!=typeof document,w=()=>L&&"complete"===document.readyState,P={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class F{static get isPageLoaded(){return w()}constructor(e){if(this.width=1,this.height=1,this._canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1},this.props={...P,...e},e=this.props,!(0,u.A)())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"==typeof e.canvas?this.canvas=function(e){const t=document.getElementById(e);if(!t&&!w())throw new Error("Accessing '"+e+"' before page was loaded");if(!(t instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{var t,n;const i=function(e){const{width:t,height:n}=e,i=document.createElement("canvas");return i.id="lumagl-auto-created-canvas",i.width=t||1,i.height=n||1,i.style.width=Number.isFinite(t)?t+"px":"100%",i.style.height=Number.isFinite(n)?n+"px":"100%",i}(e),r=function(e){if("string"==typeof e){const t=document.getElementById(e);if(!t&&!w())throw new Error("Accessing '"+e+"' before page was loaded");if(!t)throw new Error(e+" is not an HTML element");return t}if(e)return e;return document.body}((null==(t=e)?void 0:t.container)||null);r.insertBefore(i,r.firstChild),this.canvas=i,null!=(n=e)&&n.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver((e=>{for(const t of e)t.target===this.canvas&&this.update()})),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){if("undefined"!=typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas)return 1;if(!(e=void 0===e?this.props.useDevicePixels:e)||e<=0)return 1;if(!0===e){return"undefined"!=typeof window&&window.devicePixelRatio||1}return e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:t}=this._canvasSizeInfo;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t){void 0===t&&(t=!0);const n=this.cssToDeviceRatio(),[i,r]=this.getDrawingBufferSize();return function(e,t,n,i,r){const s=e,o=O(s[0],t,n);let a=M(s[1],t,i,r),l=O(s[0]+1,t,n);const c=l===n-1?l:l-1;let u;l=M(s[1]+1,t,i,r),r?(l=0===l?l:l+1,u=a,a=l):u=l===i-1?l:l-1;return{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}(e,n,i,r,t)}setDevicePixelRatio(e,t){if(void 0===t&&(t={}),!this.htmlCanvas)return;let n="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;n&&i||(h.R.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,n=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const r=this._canvasSizeInfo;if(r.clientWidth!==n||r.clientHeight!==i||r.devicePixelRatio!==e){let t=e;const r=Math.floor(n*t),s=Math.floor(i*t);this.htmlCanvas.width=r,this.htmlCanvas.height=s;const[o,a]=this.getDrawingBufferSize();o===r&&a===s||(t=Math.min(o/n,a/i),this.htmlCanvas.width=Math.floor(n*t),this.htmlCanvas.height=Math.floor(i*t),h.R.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=n,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var t;"lumagl-auto-created-canvas"===(null==(t=this.htmlCanvas)?void 0:t.id)&&(this.htmlCanvas.id=e)}}function O(e,t,n){return Math.min(Math.round(e*t),n-1)}function M(e,t,n,i){return i?Math.max(0,n-1-Math.round(e*t)):Math.min(Math.round(e*t),n-1)}F.pageLoaded=function(){if(w()||"undefined"==typeof window)return Promise.resolve();return new Promise((e=>{window.addEventListener("load",(()=>e()))}))}();var x=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT",e}(x||{});const D={[x.BLEND]:!1,[x.BLEND_COLOR]:new Float32Array([0,0,0,0]),[x.BLEND_EQUATION_RGB]:x.FUNC_ADD,[x.BLEND_EQUATION_ALPHA]:x.FUNC_ADD,[x.BLEND_SRC_RGB]:x.ONE,[x.BLEND_DST_RGB]:x.ZERO,[x.BLEND_SRC_ALPHA]:x.ONE,[x.BLEND_DST_ALPHA]:x.ZERO,[x.COLOR_CLEAR_VALUE]:new Float32Array([0,0,0,0]),[x.COLOR_WRITEMASK]:[!0,!0,!0,!0],[x.CULL_FACE]:!1,[x.CULL_FACE_MODE]:x.BACK,[x.DEPTH_TEST]:!1,[x.DEPTH_CLEAR_VALUE]:1,[x.DEPTH_FUNC]:x.LESS,[x.DEPTH_RANGE]:new Float32Array([0,1]),[x.DEPTH_WRITEMASK]:!0,[x.DITHER]:!0,[x.CURRENT_PROGRAM]:null,[x.FRAMEBUFFER_BINDING]:null,[x.RENDERBUFFER_BINDING]:null,[x.VERTEX_ARRAY_BINDING]:null,[x.ARRAY_BUFFER_BINDING]:null,[x.FRONT_FACE]:x.CCW,[x.GENERATE_MIPMAP_HINT]:x.DONT_CARE,[x.LINE_WIDTH]:1,[x.POLYGON_OFFSET_FILL]:!1,[x.POLYGON_OFFSET_FACTOR]:0,[x.POLYGON_OFFSET_UNITS]:0,[x.SAMPLE_ALPHA_TO_COVERAGE]:!1,[x.SAMPLE_COVERAGE]:!1,[x.SAMPLE_COVERAGE_VALUE]:1,[x.SAMPLE_COVERAGE_INVERT]:!1,[x.SCISSOR_TEST]:!1,[x.SCISSOR_BOX]:new Int32Array([0,0,1024,1024]),[x.STENCIL_TEST]:!1,[x.STENCIL_CLEAR_VALUE]:0,[x.STENCIL_WRITEMASK]:4294967295,[x.STENCIL_BACK_WRITEMASK]:4294967295,[x.STENCIL_FUNC]:x.ALWAYS,[x.STENCIL_REF]:0,[x.STENCIL_VALUE_MASK]:4294967295,[x.STENCIL_BACK_FUNC]:x.ALWAYS,[x.STENCIL_BACK_REF]:0,[x.STENCIL_BACK_VALUE_MASK]:4294967295,[x.STENCIL_FAIL]:x.KEEP,[x.STENCIL_PASS_DEPTH_FAIL]:x.KEEP,[x.STENCIL_PASS_DEPTH_PASS]:x.KEEP,[x.STENCIL_BACK_FAIL]:x.KEEP,[x.STENCIL_BACK_PASS_DEPTH_FAIL]:x.KEEP,[x.STENCIL_BACK_PASS_DEPTH_PASS]:x.KEEP,[x.VIEWPORT]:[0,0,1024,1024],[x.TRANSFORM_FEEDBACK_BINDING]:null,[x.COPY_READ_BUFFER_BINDING]:null,[x.COPY_WRITE_BUFFER_BINDING]:null,[x.PIXEL_PACK_BUFFER_BINDING]:null,[x.PIXEL_UNPACK_BUFFER_BINDING]:null,[x.FRAGMENT_SHADER_DERIVATIVE_HINT]:x.DONT_CARE,[x.READ_FRAMEBUFFER_BINDING]:null,[x.RASTERIZER_DISCARD]:!1,[x.PACK_ALIGNMENT]:4,[x.UNPACK_ALIGNMENT]:4,[x.UNPACK_FLIP_Y_WEBGL]:!1,[x.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:!1,[x.UNPACK_COLORSPACE_CONVERSION_WEBGL]:x.BROWSER_DEFAULT_WEBGL,[x.PACK_ROW_LENGTH]:0,[x.PACK_SKIP_PIXELS]:0,[x.PACK_SKIP_ROWS]:0,[x.UNPACK_ROW_LENGTH]:0,[x.UNPACK_IMAGE_HEIGHT]:0,[x.UNPACK_SKIP_PIXELS]:0,[x.UNPACK_SKIP_ROWS]:0,[x.UNPACK_SKIP_IMAGES]:0},B=(e,t,n)=>t?e.enable(n):e.disable(n),U=(e,t,n)=>e.hint(n,t),G=(e,t,n)=>e.pixelStorei(n,t),k=(e,t,n)=>{const i=n===x.FRAMEBUFFER_BINDING?x.DRAW_FRAMEBUFFER:x.READ_FRAMEBUFFER;return e.bindFramebuffer(i,t)},H=(e,t,n)=>{const i={[x.ARRAY_BUFFER_BINDING]:x.ARRAY_BUFFER,[x.COPY_READ_BUFFER_BINDING]:x.COPY_READ_BUFFER,[x.COPY_WRITE_BUFFER_BINDING]:x.COPY_WRITE_BUFFER,[x.PIXEL_PACK_BUFFER_BINDING]:x.PIXEL_PACK_BUFFER,[x.PIXEL_UNPACK_BUFFER_BINDING]:x.PIXEL_UNPACK_BUFFER}[n];e.bindBuffer(i,t)};function V(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}const X={[x.BLEND]:B,[x.BLEND_COLOR]:(e,t)=>e.blendColor(...t),[x.BLEND_EQUATION_RGB]:"blendEquation",[x.BLEND_EQUATION_ALPHA]:"blendEquation",[x.BLEND_SRC_RGB]:"blendFunc",[x.BLEND_DST_RGB]:"blendFunc",[x.BLEND_SRC_ALPHA]:"blendFunc",[x.BLEND_DST_ALPHA]:"blendFunc",[x.COLOR_CLEAR_VALUE]:(e,t)=>e.clearColor(...t),[x.COLOR_WRITEMASK]:(e,t)=>e.colorMask(...t),[x.CULL_FACE]:B,[x.CULL_FACE_MODE]:(e,t)=>e.cullFace(t),[x.DEPTH_TEST]:B,[x.DEPTH_CLEAR_VALUE]:(e,t)=>e.clearDepth(t),[x.DEPTH_FUNC]:(e,t)=>e.depthFunc(t),[x.DEPTH_RANGE]:(e,t)=>e.depthRange(...t),[x.DEPTH_WRITEMASK]:(e,t)=>e.depthMask(t),[x.DITHER]:B,[x.FRAGMENT_SHADER_DERIVATIVE_HINT]:U,[x.CURRENT_PROGRAM]:(e,t)=>e.useProgram(t),[x.RENDERBUFFER_BINDING]:(e,t)=>e.bindRenderbuffer(x.RENDERBUFFER,t),[x.TRANSFORM_FEEDBACK_BINDING]:(e,t)=>null==e.bindTransformFeedback?void 0:e.bindTransformFeedback(x.TRANSFORM_FEEDBACK,t),[x.VERTEX_ARRAY_BINDING]:(e,t)=>e.bindVertexArray(t),[x.FRAMEBUFFER_BINDING]:k,[x.READ_FRAMEBUFFER_BINDING]:k,[x.ARRAY_BUFFER_BINDING]:H,[x.COPY_READ_BUFFER_BINDING]:H,[x.COPY_WRITE_BUFFER_BINDING]:H,[x.PIXEL_PACK_BUFFER_BINDING]:H,[x.PIXEL_UNPACK_BUFFER_BINDING]:H,[x.FRONT_FACE]:(e,t)=>e.frontFace(t),[x.GENERATE_MIPMAP_HINT]:U,[x.LINE_WIDTH]:(e,t)=>e.lineWidth(t),[x.POLYGON_OFFSET_FILL]:B,[x.POLYGON_OFFSET_FACTOR]:"polygonOffset",[x.POLYGON_OFFSET_UNITS]:"polygonOffset",[x.RASTERIZER_DISCARD]:B,[x.SAMPLE_ALPHA_TO_COVERAGE]:B,[x.SAMPLE_COVERAGE]:B,[x.SAMPLE_COVERAGE_VALUE]:"sampleCoverage",[x.SAMPLE_COVERAGE_INVERT]:"sampleCoverage",[x.SCISSOR_TEST]:B,[x.SCISSOR_BOX]:(e,t)=>e.scissor(...t),[x.STENCIL_TEST]:B,[x.STENCIL_CLEAR_VALUE]:(e,t)=>e.clearStencil(t),[x.STENCIL_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(x.FRONT,t),[x.STENCIL_BACK_WRITEMASK]:(e,t)=>e.stencilMaskSeparate(x.BACK,t),[x.STENCIL_FUNC]:"stencilFuncFront",[x.STENCIL_REF]:"stencilFuncFront",[x.STENCIL_VALUE_MASK]:"stencilFuncFront",[x.STENCIL_BACK_FUNC]:"stencilFuncBack",[x.STENCIL_BACK_REF]:"stencilFuncBack",[x.STENCIL_BACK_VALUE_MASK]:"stencilFuncBack",[x.STENCIL_FAIL]:"stencilOpFront",[x.STENCIL_PASS_DEPTH_FAIL]:"stencilOpFront",[x.STENCIL_PASS_DEPTH_PASS]:"stencilOpFront",[x.STENCIL_BACK_FAIL]:"stencilOpBack",[x.STENCIL_BACK_PASS_DEPTH_FAIL]:"stencilOpBack",[x.STENCIL_BACK_PASS_DEPTH_PASS]:"stencilOpBack",[x.VIEWPORT]:(e,t)=>e.viewport(...t),[x.DEPTH_CLAMP_EXT]:B,[x.POLYGON_OFFSET_LINE_WEBGL]:B,[x.CLIP_DISTANCE0_WEBGL]:B,[x.CLIP_DISTANCE1_WEBGL]:B,[x.CLIP_DISTANCE2_WEBGL]:B,[x.CLIP_DISTANCE3_WEBGL]:B,[x.CLIP_DISTANCE4_WEBGL]:B,[x.CLIP_DISTANCE5_WEBGL]:B,[x.CLIP_DISTANCE6_WEBGL]:B,[x.CLIP_DISTANCE7_WEBGL]:B,[x.PACK_ALIGNMENT]:G,[x.UNPACK_ALIGNMENT]:G,[x.UNPACK_FLIP_Y_WEBGL]:G,[x.UNPACK_PREMULTIPLY_ALPHA_WEBGL]:G,[x.UNPACK_COLORSPACE_CONVERSION_WEBGL]:G,[x.PACK_ROW_LENGTH]:G,[x.PACK_SKIP_PIXELS]:G,[x.PACK_SKIP_ROWS]:G,[x.UNPACK_ROW_LENGTH]:G,[x.UNPACK_IMAGE_HEIGHT]:G,[x.UNPACK_SKIP_PIXELS]:G,[x.UNPACK_SKIP_ROWS]:G,[x.UNPACK_SKIP_IMAGES]:G,framebuffer:(e,t)=>{const n=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(x.FRAMEBUFFER,n)},blend:(e,t)=>t?e.enable(x.BLEND):e.disable(x.BLEND),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{const n="number"==typeof t?[t,t]:t;e.blendEquationSeparate(...n)},blendFunc:(e,t)=>{const n=2===(null==t?void 0:t.length)?[...t,...t]:t;e.blendFuncSeparate(...n)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(x.CULL_FACE):e.disable(x.CULL_FACE),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(x.DEPTH_TEST):e.disable(x.DEPTH_TEST),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(x.DITHER):e.disable(x.DITHER),derivativeHint:(e,t)=>{e.hint(x.FRAGMENT_SHADER_DERIVATIVE_HINT,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(x.GENERATE_MIPMAP_HINT,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(x.POLYGON_OFFSET_FILL):e.disable(x.POLYGON_OFFSET_FILL),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(...t),scissorTest:(e,t)=>t?e.enable(x.SCISSOR_TEST):e.disable(x.SCISSOR_TEST),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(x.STENCIL_TEST):e.disable(x.STENCIL_TEST),stencilMask:(e,t)=>{t=V(t)?t:[t,t];const[n,i]=t;e.stencilMaskSeparate(x.FRONT,n),e.stencilMaskSeparate(x.BACK,i)},stencilFunc:(e,t)=>{t=V(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilFuncSeparate(x.FRONT,n,i,r),e.stencilFuncSeparate(x.BACK,s,o,a)},stencilOp:(e,t)=>{t=V(t)&&3===t.length?[...t,...t]:t;const[n,i,r,s,o,a]=t;e.stencilOpSeparate(x.FRONT,n,i,r),e.stencilOpSeparate(x.BACK,s,o,a)},viewport:(e,t)=>e.viewport(...t)};function W(e,t,n){return void 0!==t[e]?t[e]:n[e]}const K={blendEquation:(e,t,n)=>e.blendEquationSeparate(W(x.BLEND_EQUATION_RGB,t,n),W(x.BLEND_EQUATION_ALPHA,t,n)),blendFunc:(e,t,n)=>e.blendFuncSeparate(W(x.BLEND_SRC_RGB,t,n),W(x.BLEND_DST_RGB,t,n),W(x.BLEND_SRC_ALPHA,t,n),W(x.BLEND_DST_ALPHA,t,n)),polygonOffset:(e,t,n)=>e.polygonOffset(W(x.POLYGON_OFFSET_FACTOR,t,n),W(x.POLYGON_OFFSET_UNITS,t,n)),sampleCoverage:(e,t,n)=>e.sampleCoverage(W(x.SAMPLE_COVERAGE_VALUE,t,n),W(x.SAMPLE_COVERAGE_INVERT,t,n)),stencilFuncFront:(e,t,n)=>e.stencilFuncSeparate(x.FRONT,W(x.STENCIL_FUNC,t,n),W(x.STENCIL_REF,t,n),W(x.STENCIL_VALUE_MASK,t,n)),stencilFuncBack:(e,t,n)=>e.stencilFuncSeparate(x.BACK,W(x.STENCIL_BACK_FUNC,t,n),W(x.STENCIL_BACK_REF,t,n),W(x.STENCIL_BACK_VALUE_MASK,t,n)),stencilOpFront:(e,t,n)=>e.stencilOpSeparate(x.FRONT,W(x.STENCIL_FAIL,t,n),W(x.STENCIL_PASS_DEPTH_FAIL,t,n),W(x.STENCIL_PASS_DEPTH_PASS,t,n)),stencilOpBack:(e,t,n)=>e.stencilOpSeparate(x.BACK,W(x.STENCIL_BACK_FAIL,t,n),W(x.STENCIL_BACK_PASS_DEPTH_FAIL,t,n),W(x.STENCIL_BACK_PASS_DEPTH_PASS,t,n))},z={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,n)=>e({[t]:n}),hint:(e,t,n)=>e({[t]:n}),useProgram:(e,t)=>e({[x.CURRENT_PROGRAM]:t}),bindRenderbuffer:(e,t,n)=>e({[x.RENDERBUFFER_BINDING]:n}),bindTransformFeedback:(e,t,n)=>e({[x.TRANSFORM_FEEDBACK_BINDING]:n}),bindVertexArray:(e,t)=>e({[x.VERTEX_ARRAY_BINDING]:t}),bindFramebuffer:(e,t,n)=>{switch(t){case x.FRAMEBUFFER:return e({[x.DRAW_FRAMEBUFFER_BINDING]:n,[x.READ_FRAMEBUFFER_BINDING]:n});case x.DRAW_FRAMEBUFFER:return e({[x.DRAW_FRAMEBUFFER_BINDING]:n});case x.READ_FRAMEBUFFER:return e({[x.READ_FRAMEBUFFER_BINDING]:n});default:return null}},bindBuffer:(e,t,n)=>{const i={[x.ARRAY_BUFFER]:[x.ARRAY_BUFFER_BINDING],[x.COPY_READ_BUFFER]:[x.COPY_READ_BUFFER_BINDING],[x.COPY_WRITE_BUFFER]:[x.COPY_WRITE_BUFFER_BINDING],[x.PIXEL_PACK_BUFFER]:[x.PIXEL_PACK_BUFFER_BINDING],[x.PIXEL_UNPACK_BUFFER]:[x.PIXEL_UNPACK_BUFFER_BINDING]}[t];return i?e({[i]:n}):{valueChanged:!0}},blendColor:(e,t,n,i,r)=>e({[x.BLEND_COLOR]:new Float32Array([t,n,i,r])}),blendEquation:(e,t)=>e({[x.BLEND_EQUATION_RGB]:t,[x.BLEND_EQUATION_ALPHA]:t}),blendEquationSeparate:(e,t,n)=>e({[x.BLEND_EQUATION_RGB]:t,[x.BLEND_EQUATION_ALPHA]:n}),blendFunc:(e,t,n)=>e({[x.BLEND_SRC_RGB]:t,[x.BLEND_DST_RGB]:n,[x.BLEND_SRC_ALPHA]:t,[x.BLEND_DST_ALPHA]:n}),blendFuncSeparate:(e,t,n,i,r)=>e({[x.BLEND_SRC_RGB]:t,[x.BLEND_DST_RGB]:n,[x.BLEND_SRC_ALPHA]:i,[x.BLEND_DST_ALPHA]:r}),clearColor:(e,t,n,i,r)=>e({[x.COLOR_CLEAR_VALUE]:new Float32Array([t,n,i,r])}),clearDepth:(e,t)=>e({[x.DEPTH_CLEAR_VALUE]:t}),clearStencil:(e,t)=>e({[x.STENCIL_CLEAR_VALUE]:t}),colorMask:(e,t,n,i,r)=>e({[x.COLOR_WRITEMASK]:[t,n,i,r]}),cullFace:(e,t)=>e({[x.CULL_FACE_MODE]:t}),depthFunc:(e,t)=>e({[x.DEPTH_FUNC]:t}),depthRange:(e,t,n)=>e({[x.DEPTH_RANGE]:new Float32Array([t,n])}),depthMask:(e,t)=>e({[x.DEPTH_WRITEMASK]:t}),frontFace:(e,t)=>e({[x.FRONT_FACE]:t}),lineWidth:(e,t)=>e({[x.LINE_WIDTH]:t}),polygonOffset:(e,t,n)=>e({[x.POLYGON_OFFSET_FACTOR]:t,[x.POLYGON_OFFSET_UNITS]:n}),sampleCoverage:(e,t,n)=>e({[x.SAMPLE_COVERAGE_VALUE]:t,[x.SAMPLE_COVERAGE_INVERT]:n}),scissor:(e,t,n,i,r)=>e({[x.SCISSOR_BOX]:new Int32Array([t,n,i,r])}),stencilMask:(e,t)=>e({[x.STENCIL_WRITEMASK]:t,[x.STENCIL_BACK_WRITEMASK]:t}),stencilMaskSeparate:(e,t,n)=>e({[t===x.FRONT?x.STENCIL_WRITEMASK:x.STENCIL_BACK_WRITEMASK]:n}),stencilFunc:(e,t,n,i)=>e({[x.STENCIL_FUNC]:t,[x.STENCIL_REF]:n,[x.STENCIL_VALUE_MASK]:i,[x.STENCIL_BACK_FUNC]:t,[x.STENCIL_BACK_REF]:n,[x.STENCIL_BACK_VALUE_MASK]:i}),stencilFuncSeparate:(e,t,n,i,r)=>e({[t===x.FRONT?x.STENCIL_FUNC:x.STENCIL_BACK_FUNC]:n,[t===x.FRONT?x.STENCIL_REF:x.STENCIL_BACK_REF]:i,[t===x.FRONT?x.STENCIL_VALUE_MASK:x.STENCIL_BACK_VALUE_MASK]:r}),stencilOp:(e,t,n,i)=>e({[x.STENCIL_FAIL]:t,[x.STENCIL_PASS_DEPTH_FAIL]:n,[x.STENCIL_PASS_DEPTH_PASS]:i,[x.STENCIL_BACK_FAIL]:t,[x.STENCIL_BACK_PASS_DEPTH_FAIL]:n,[x.STENCIL_BACK_PASS_DEPTH_PASS]:i}),stencilOpSeparate:(e,t,n,i,r)=>e({[t===x.FRONT?x.STENCIL_FAIL:x.STENCIL_BACK_FAIL]:n,[t===x.FRONT?x.STENCIL_PASS_DEPTH_FAIL:x.STENCIL_BACK_PASS_DEPTH_FAIL]:i,[t===x.FRONT?x.STENCIL_PASS_DEPTH_PASS:x.STENCIL_BACK_PASS_DEPTH_PASS]:r}),viewport:(e,t,n,i,r)=>e({[x.VIEWPORT]:[t,n,i,r]})},Y=(e,t)=>e.isEnabled(t),j={[x.BLEND]:Y,[x.CULL_FACE]:Y,[x.DEPTH_TEST]:Y,[x.DITHER]:Y,[x.POLYGON_OFFSET_FILL]:Y,[x.SAMPLE_ALPHA_TO_COVERAGE]:Y,[x.SAMPLE_COVERAGE]:Y,[x.SCISSOR_TEST]:Y,[x.STENCIL_TEST]:Y,[x.RASTERIZER_DISCARD]:Y},q=new Set([x.ACTIVE_TEXTURE,x.TRANSFORM_FEEDBACK_ACTIVE,x.TRANSFORM_FEEDBACK_PAUSED,x.TRANSFORM_FEEDBACK_BUFFER_BINDING,x.UNIFORM_BUFFER_BINDING,x.ELEMENT_ARRAY_BUFFER_BINDING,x.IMPLEMENTATION_COLOR_READ_FORMAT,x.IMPLEMENTATION_COLOR_READ_TYPE,x.READ_BUFFER,x.DRAW_BUFFER0,x.DRAW_BUFFER1,x.DRAW_BUFFER2,x.DRAW_BUFFER3,x.DRAW_BUFFER4,x.DRAW_BUFFER5,x.DRAW_BUFFER6,x.DRAW_BUFFER7,x.DRAW_BUFFER8,x.DRAW_BUFFER9,x.DRAW_BUFFER10,x.DRAW_BUFFER11,x.DRAW_BUFFER12,x.DRAW_BUFFER13,x.DRAW_BUFFER14,x.DRAW_BUFFER15,x.SAMPLER_BINDING,x.TEXTURE_BINDING_2D,x.TEXTURE_BINDING_2D_ARRAY,x.TEXTURE_BINDING_3D,x.TEXTURE_BINDING_CUBE_MAP]);function Q(e,t){const n=Fn.attach(e).gl;if(function(e){for(const t in e)return!1;return!0}(t))return;const i={};for(const s in t){const e=Number(s),r=X[s];r&&("string"==typeof r?i[r]=!0:r(n,t[s],e))}const r=n.state&&n.state.cache;if(r)for(const s in i){(0,K[s])(n,t,r)}}function Z(e,t){void 0===t&&(t=D);const n=Fn.attach(e).gl;if("number"==typeof t){const e=t,i=j[e];return i?i(n,e):n.getParameter(e)}const i=Array.isArray(t)?t:Object.keys(t),r={};for(const s of i){const e=j[s];r[s]=e?e(n,Number(s)):n.getParameter(Number(s))}return r}function J(e,t){if(e===t)return!0;const n=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(n&&i&&e.length===t.length){for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}return!1}class ${constructor(e,t){let{copyState:n=!1,log:i=(()=>{})}=void 0===t?{}:t;this.program=null,this.stateStack=[],this.enable=!0,this.gl=e,this.cache=n?Z(e):Object.assign({},D),this.log=i,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e){void 0===e&&(e={}),this.stateStack.push({})}pop(){(0,y.v)(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Q(this.gl,e),this.stateStack.pop()}_updateCache(e){let t,n=!1;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const r in e){(0,y.v)(void 0!==r);const s=e[r],o=this.cache[r];J(s,o)||(n=!0,t=o,i&&!(r in i)&&(i[r]=o),this.cache[r]=s)}return{valueChanged:n,oldValue:t}}}function ee(e){return e.state}function te(e,t){const{enable:n=!0,copyState:i}=t;if((0,y.v)(void 0!==i),!e.state){e.state=new $(e,{copyState:i}),function(e){const t=e.useProgram.bind(e);e.useProgram=function(n){const i=ee(e);i.program!==n&&(t(n),i.program=n)}}(e);for(const t in z){se(e,t,z[t])}re(e,"getParameter"),re(e,"isEnabled")}return ee(e).enable=n,e}function ne(e){let t=ee(e);t||(te(e,{copyState:!1}),t=ee(e)),t.push()}function ie(e){const t=ee(e);(0,y.v)(t),t.pop()}function re(e,t){const n=e[t].bind(e);e[t]=function(t){if(void 0===t||q.has(t))return n(t);const i=ee(e);return t in i.cache||(i.cache[t]=n(t)),i.enable?i.cache[t]:n(t)},Object.defineProperty(e[t],"name",{value:t+"-from-cache",configurable:!1})}function se(e,t,n){if(!e[t])return;const i=e[t].bind(e);e[t]=function(){const t=ee(e);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];const{valueChanged:a,oldValue:l}=n(t._updateCache,...s);return a&&i(...s),l},Object.defineProperty(e[t],"name",{value:t+"-to-cache",configurable:!1})}const oe={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function ae(e,t,n){return void 0===n[t]&&(n[t]=e.getExtension(t)||null),n[t]}function le(e,t){const n=e.getParameter(x.VENDOR),i=e.getParameter(x.RENDERER);ae(e,"WEBGL_debug_renderer_info",t);const r=t.WEBGL_debug_renderer_info,s=e.getParameter(r?r.UNMASKED_VENDOR_WEBGL:x.VENDOR)||n,o=e.getParameter(r?r.UNMASKED_RENDERER_WEBGL:x.RENDERER)||i,a=e.getParameter(x.VERSION),l=ce(s,o),c=function(e,t){if(/Metal/i.exec(e)||/Metal/i.exec(t))return"metal";if(/ANGLE/i.exec(e)||/ANGLE/i.exec(t))return"opengl";return"unknown"}(s,o),u=function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(ce(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(s,o);return{type:"webgl",gpu:l,gpuType:u,gpuBackend:c,vendor:s,renderer:o,version:a,shadingLanguage:"glsl",shadingLanguageVersion:300}}function ce(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}function ue(e){switch(e){case"uint8":case"unorm8":return x.UNSIGNED_BYTE;case"sint8":case"snorm8":return x.BYTE;case"uint16":case"unorm16":return x.UNSIGNED_SHORT;case"sint16":case"snorm16":return x.SHORT;case"uint32":return x.UNSIGNED_INT;case"sint32":return x.INT;case"float16":return x.HALF_FLOAT;case"float32":return x.FLOAT}throw new Error(String(e))}const he="texture-compression-bc",_e="texture-compression-astc",de="texture-compression-etc2",fe="texture-compression-pvrtc-webgl",pe="texture-compression-atc-webgl",Ee="float32-renderable-webgl",ge="float16-renderable-webgl",me="snorm8-renderable-webgl",Ae="norm16-renderable-webgl",Re="snorm16-renderable-webgl",Te="float32-filterable",ve="float16-filterable-webgl",Se="WEBGL_compressed_texture_s3tc",be="WEBGL_compressed_texture_s3tc_srgb",Ce="EXT_texture_compression_rgtc",ye="EXT_texture_compression_bptc",Ne="EXT_texture_norm16",Ie="EXT_render_snorm",Le={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[Ie],"norm16-renderable-webgl":[Ne],"snorm16-renderable-webgl":[Ne,Ie],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Se,be,Ce,ye],"texture-compression-bc5-webgl":[Ce],"texture-compression-bc7-webgl":[ye],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]};function we(e,t,n){return(Le[t]||[]).every((t=>ae(e,t,n)))}const Pe={"rgb8unorm-unsized":{gl:x.RGB,b:4,c:2,bpp:4,dataFormat:x.RGB,types:[x.UNSIGNED_BYTE,x.UNSIGNED_SHORT_5_6_5]},"rgba8unorm-unsized":{gl:x.RGBA,b:4,c:2,bpp:4,dataFormat:x.RGBA,types:[x.UNSIGNED_BYTE,x.UNSIGNED_SHORT_4_4_4_4,x.UNSIGNED_SHORT_5_5_5_1]},r8unorm:{gl:x.R8,b:1,c:1,renderbuffer:!0},r8snorm:{gl:x.R8_SNORM,b:1,c:1,render:me},r8uint:{gl:x.R8UI,b:1,c:1,renderbuffer:!0},r8sint:{gl:x.R8I,b:1,c:1,renderbuffer:!0},rg8unorm:{gl:x.RG8,b:2,c:2,renderbuffer:!0},rg8snorm:{gl:x.RG8_SNORM,b:2,c:2,render:me},rg8uint:{gl:x.RG8UI,b:2,c:2,renderbuffer:!0},rg8sint:{gl:x.RG8I,b:2,c:2,renderbuffer:!0},r16uint:{gl:x.R16UI,b:2,c:1,renderbuffer:!0},r16sint:{gl:x.R16I,b:2,c:1,renderbuffer:!0},r16float:{gl:x.R16F,b:2,c:1,render:ge,filter:"float16-filterable-webgl",renderbuffer:!0},"r16unorm-webgl":{gl:x.R16_EXT,b:2,c:1,f:Ae,renderbuffer:!0},"r16snorm-webgl":{gl:x.R16_SNORM_EXT,b:2,c:1,f:Re},"rgba4unorm-webgl":{gl:x.RGBA4,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb565unorm-webgl":{gl:x.RGB565,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb5a1unorm-webgl":{gl:x.RGB5_A1,b:2,c:4,wgpu:!1,renderbuffer:!0},"rgb8unorm-webgl":{gl:x.RGB8,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:x.RGB8_SNORM,b:3,c:3,wgpu:!1},rgba8unorm:{gl:x.RGBA8,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:x.SRGB8_ALPHA8,b:4,c:4,bpp:4},rgba8snorm:{gl:x.RGBA8_SNORM,b:4,c:4,render:me},rgba8uint:{gl:x.RGBA8UI,b:4,c:4,bpp:4},rgba8sint:{gl:x.RGBA8I,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:x.RG16UI,b:4,c:1,bpp:4},rg16sint:{gl:x.RG16I,b:4,c:2,bpp:4},rg16float:{gl:x.RG16F,bpp:4,b:4,c:2,render:ge,filter:ve,renderbuffer:!0},"rg16unorm-webgl":{gl:x.RG16_EXT,b:2,c:2,render:Ae},"rg16snorm-webgl":{gl:x.RG16_SNORM_EXT,b:2,c:2,render:Re},r32uint:{gl:x.R32UI,b:4,c:1,bpp:4,renderbuffer:!0},r32sint:{gl:x.R32I,b:4,c:1,bpp:4,renderbuffer:!0},r32float:{gl:x.R32F,bpp:4,b:4,c:1,render:Ee,filter:Te},rgb9e5ufloat:{gl:x.RGB9_E5,b:4,c:3,p:1,render:"rgb9e5ufloat_renderable-webgl"},rg11b10ufloat:{gl:x.R11F_G11F_B10F,b:4,c:3,p:1,render:Ee,renderbuffer:!0},rgb10a2unorm:{gl:x.RGB10_A2,b:4,c:4,p:1,renderbuffer:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:x.RGB10_A2UI,p:1,wgpu:!1,bpp:4,renderbuffer:!0},"rgb16unorm-webgl":{gl:x.RGB16_EXT,b:2,c:3,f:Ae},"rgb16snorm-webgl":{gl:x.RGB16_SNORM_EXT,b:2,c:3,f:Ae},rg32uint:{gl:x.RG32UI,b:8,c:2,renderbuffer:!0},rg32sint:{gl:x.RG32I,b:8,c:2,renderbuffer:!0},rg32float:{gl:x.RG32F,b:8,c:2,render:Ee,filter:Te,renderbuffer:!0},rgba16uint:{gl:x.RGBA16UI,b:8,c:4,renderbuffer:!0},rgba16sint:{gl:x.RGBA16I,b:8,c:4,renderbuffer:!0},rgba16float:{gl:x.RGBA16F,b:8,c:4,render:ge,filter:ve},"rgba16unorm-webgl":{gl:x.RGBA16_EXT,b:2,c:4,render:Ae,renderbuffer:!0},"rgba16snorm-webgl":{gl:x.RGBA16_SNORM_EXT,b:2,c:4,render:Re},"rgb32float-webgl":{gl:x.RGB32F,render:Ee,filter:Te,gl2ext:"EXT_color_buffer_float",dataFormat:x.RGB,types:[x.FLOAT]},rgba32uint:{gl:x.RGBA32UI,b:16,c:4,renderbuffer:!0},rgba32sint:{gl:x.RGBA32I,b:16,c:4,renderbuffer:!0},rgba32float:{gl:x.RGBA32F,b:16,c:4,render:Ee,filter:Te,renderbuffer:!0},stencil8:{gl:x.STENCIL_INDEX8,b:1,c:1,attachment:x.STENCIL_ATTACHMENT,renderbuffer:!0},depth16unorm:{gl:x.DEPTH_COMPONENT16,b:2,c:1,attachment:x.DEPTH_ATTACHMENT,renderbuffer:!0},depth24plus:{gl:x.DEPTH_COMPONENT24,b:3,c:1,attachment:x.DEPTH_ATTACHMENT},depth32float:{gl:x.DEPTH_COMPONENT32F,b:4,c:1,attachment:x.DEPTH_ATTACHMENT,renderbuffer:!0},"depth24plus-stencil8":{gl:x.DEPTH_STENCIL,b:4,c:2,p:1,attachment:x.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0,depthTexture:!0},"depth24unorm-stencil8":{gl:x.DEPTH24_STENCIL8,b:4,c:2,p:1,attachment:x.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0},"depth32float-stencil8":{gl:x.DEPTH32F_STENCIL8,b:5,c:2,p:1,attachment:x.DEPTH_STENCIL_ATTACHMENT,renderbuffer:!0},"bc1-rgb-unorm-webgl":{gl:x.COMPRESSED_RGB_S3TC_DXT1_EXT,x:Se,f:he},"bc1-rgb-unorm-srgb-webgl":{gl:x.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:be,f:he},"bc1-rgba-unorm":{gl:x.COMPRESSED_RGBA_S3TC_DXT1_EXT,x:Se,f:he},"bc1-rgba-unorm-srgb":{gl:x.COMPRESSED_SRGB_S3TC_DXT1_EXT,x:be,f:he},"bc2-rgba-unorm":{gl:x.COMPRESSED_RGBA_S3TC_DXT3_EXT,x:Se,f:he},"bc2-rgba-unorm-srgb":{gl:x.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,x:be,f:he},"bc3-rgba-unorm":{gl:x.COMPRESSED_RGBA_S3TC_DXT5_EXT,x:Se,f:he},"bc3-rgba-unorm-srgb":{gl:x.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT,x:be,f:he},"bc4-r-unorm":{gl:x.COMPRESSED_RED_RGTC1_EXT,x:Ce,f:he},"bc4-r-snorm":{gl:x.COMPRESSED_SIGNED_RED_RGTC1_EXT,x:Ce,f:he},"bc5-rg-unorm":{gl:x.COMPRESSED_RED_GREEN_RGTC2_EXT,x:Ce,f:he},"bc5-rg-snorm":{gl:x.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT,x:Ce,f:he},"bc6h-rgb-ufloat":{gl:x.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,x:ye,f:he},"bc6h-rgb-float":{gl:x.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,x:ye,f:he},"bc7-rgba-unorm":{gl:x.COMPRESSED_RGBA_BPTC_UNORM_EXT,x:ye,f:he},"bc7-rgba-unorm-srgb":{gl:x.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT,x:ye,f:he},"etc2-rgb8unorm":{gl:x.COMPRESSED_RGB8_ETC2,f:de},"etc2-rgb8unorm-srgb":{gl:x.COMPRESSED_SRGB8_ETC2,f:de},"etc2-rgb8a1unorm":{gl:x.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,f:de},"etc2-rgb8a1unorm-srgb":{gl:x.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,f:de},"etc2-rgba8unorm":{gl:x.COMPRESSED_RGBA8_ETC2_EAC,f:de},"etc2-rgba8unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,f:de},"eac-r11unorm":{gl:x.COMPRESSED_R11_EAC,f:de},"eac-r11snorm":{gl:x.COMPRESSED_SIGNED_R11_EAC,f:de},"eac-rg11unorm":{gl:x.COMPRESSED_RG11_EAC,f:de},"eac-rg11snorm":{gl:x.COMPRESSED_SIGNED_RG11_EAC,f:de},"astc-4x4-unorm":{gl:x.COMPRESSED_RGBA_ASTC_4x4_KHR,f:_e},"astc-4x4-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,f:_e},"astc-5x4-unorm":{gl:x.COMPRESSED_RGBA_ASTC_5x4_KHR,f:_e},"astc-5x4-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,f:_e},"astc-5x5-unorm":{gl:x.COMPRESSED_RGBA_ASTC_5x5_KHR,f:_e},"astc-5x5-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,f:_e},"astc-6x5-unorm":{gl:x.COMPRESSED_RGBA_ASTC_6x5_KHR,f:_e},"astc-6x5-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,f:_e},"astc-6x6-unorm":{gl:x.COMPRESSED_RGBA_ASTC_6x6_KHR,f:_e},"astc-6x6-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,f:_e},"astc-8x5-unorm":{gl:x.COMPRESSED_RGBA_ASTC_8x5_KHR,f:_e},"astc-8x5-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,f:_e},"astc-8x6-unorm":{gl:x.COMPRESSED_RGBA_ASTC_8x6_KHR,f:_e},"astc-8x6-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,f:_e},"astc-8x8-unorm":{gl:x.COMPRESSED_RGBA_ASTC_8x8_KHR,f:_e},"astc-8x8-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,f:_e},"astc-10x5-unorm":{gl:x.COMPRESSED_RGBA_ASTC_10x10_KHR,f:_e},"astc-10x5-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,f:_e},"astc-10x6-unorm":{gl:x.COMPRESSED_RGBA_ASTC_10x6_KHR,f:_e},"astc-10x6-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,f:_e},"astc-10x8-unorm":{gl:x.COMPRESSED_RGBA_ASTC_10x8_KHR,f:_e},"astc-10x8-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,f:_e},"astc-10x10-unorm":{gl:x.COMPRESSED_RGBA_ASTC_10x10_KHR,f:_e},"astc-10x10-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,f:_e},"astc-12x10-unorm":{gl:x.COMPRESSED_RGBA_ASTC_12x10_KHR,f:_e},"astc-12x10-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,f:_e},"astc-12x12-unorm":{gl:x.COMPRESSED_RGBA_ASTC_12x12_KHR,f:_e},"astc-12x12-unorm-srgb":{gl:x.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR,f:_e},"pvrtc-rgb4unorm-webgl":{gl:x.COMPRESSED_RGB_PVRTC_4BPPV1_IMG,f:fe},"pvrtc-rgba4unorm-webgl":{gl:x.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG,f:fe},"pvrtc-rbg2unorm-webgl":{gl:x.COMPRESSED_RGB_PVRTC_2BPPV1_IMG,f:fe},"pvrtc-rgba2unorm-webgl":{gl:x.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG,f:fe},"etc1-rbg-unorm-webgl":{gl:x.COMPRESSED_RGB_ETC1_WEBGL,f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{gl:x.COMPRESSED_RGB_ATC_WEBGL,f:pe},"atc-rgba-unorm-webgl":{gl:x.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL,f:pe},"atc-rgbai-unorm-webgl":{gl:x.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL,f:pe}},Fe={[x.RED]:1,[x.RED_INTEGER]:1,[x.RG]:2,[x.RG_INTEGER]:2,[x.RGB]:3,[x.RGB_INTEGER]:3,[x.RGBA]:4,[x.RGBA_INTEGER]:4,[x.DEPTH_COMPONENT]:1,[x.DEPTH_STENCIL]:1,[x.ALPHA]:1,[x.LUMINANCE]:1,[x.LUMINANCE_ALPHA]:2},Oe={[x.FLOAT]:4,[x.UNSIGNED_INT]:4,[x.INT]:4,[x.UNSIGNED_SHORT]:2,[x.SHORT]:2,[x.HALF_FLOAT]:2,[x.BYTE]:1,[x.UNSIGNED_BYTE]:1};function Me(e,t,n){const i=xe(t),r=Pe[i];if(!r)return!1;if(void 0===r.gl)return!1;const s=r.x||r.gl2ext;return!s||Boolean(ae(e,s,n))}function xe(e){if("string"==typeof e)return e;const t=Object.entries(Pe).find((t=>{let[,n]=t;return n.gl===e}));if(!t)throw new Error("Unknown texture format "+e);return t[0]}function De(e){const t=Pe[e],n=null==t?void 0:t.gl;if(void 0===n)throw new Error("Unsupported texture format "+e);return n}function Be(e){const t=xe(e),n=De(t),i=R(t);return{format:n,dataFormat:Ge(i.format,i.integer,i.normalized,n),type:i.dataType?ue(i.dataType):x.UNSIGNED_BYTE,compressed:i.compressed}}function Ue(e){const t=Be(xe(e));return(Fe[t.dataFormat]||4)*(Oe[t.type]||1)}function Ge(e,t,n,i){if(i===x.RGBA||i===x.RGB)return i;switch(e){case"r":return t&&!n?x.RED_INTEGER:x.RED;case"rg":return t&&!n?x.RG_INTEGER:x.RG;case"rgb":return t&&!n?x.RGB_INTEGER:x.RGB;case"rgba":return t&&!n?x.RGBA_INTEGER:x.RGBA;default:return x.RGBA}}let ke;const He={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};ke=Symbol.iterator;class Ve extends b{constructor(e,t){super(),this.testedFeatures=new Set,this.gl=e,this.extensions=t,ae(e,"EXT_color_buffer_float",t)}*[ke](){for(const e of Object.keys(He))this.has(e)&&(yield e);for(const e of Object.keys(Le))this.has(e)&&(yield e);return[]}has(e){return this.testedFeatures.has(e)||(this.testedFeatures.add(e),function(e){return e in Le}(e)&&we(this.gl,e,this.extensions)&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)),this.features.has(e)}getWebGLFeature(e){const t=He[e];return"string"==typeof t?Boolean(ae(this.gl,t,this.extensions)):Boolean(t)}}class Xe extends S{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(x.MAX_TEXTURE_SIZE)}get maxTextureDimension3D(){return this.getParameter(x.MAX_3D_TEXTURE_SIZE)}get maxTextureArrayLayers(){return this.getParameter(x.MAX_ARRAY_TEXTURE_LAYERS)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS)}get maxSamplersPerShaderStage(){return this.getParameter(x.MAX_COMBINED_TEXTURE_IMAGE_UNITS)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(x.MAX_UNIFORM_BUFFER_BINDINGS)}get maxUniformBufferBindingSize(){return this.getParameter(x.MAX_UNIFORM_BLOCK_SIZE)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(x.UNIFORM_BUFFER_OFFSET_ALIGNMENT)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(x.MAX_VERTEX_ATTRIBS)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(x.MAX_VARYING_COMPONENTS)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}constructor(e){super(),this.limits={},this.gl=e}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]}}var We=n(7862);let Ke,ze;Ke=Symbol.toStringTag;class Ye extends We.F{get[Ke](){return"Texture"}constructor(e,t,n){void 0===n&&(n=Ye.defaultProps),super(e,t,n),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth}}Ye.defaultProps={...We.F.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0},Ye.COPY_SRC=1,Ye.COPY_DST=2,Ye.TEXTURE_BINDING=4,Ye.STORAGE_BINDING=8,Ye.RENDER_ATTACHMENT=16,ze=Symbol.toStringTag;class je extends We.F{get[ze](){return"Framebuffer"}constructor(e,t){void 0===t&&(t={}),super(e,t,je.defaultProps),this.colorAttachments=[],this.depthStencilAttachment=null,this.width=this.props.width,this.height=this.props.height}resize(e){let t=!e;if(e){const[n,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||n!==this.width,this.width=n,this.height=i}t&&(h.R.log(2,"Resizing framebuffer "+this.id+" to "+this.width+"x"+this.height)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){this.colorAttachments=this.props.colorAttachments.map((e=>{if("string"==typeof e){const t=this.createColorTexture(e);return this.attachResource(t),t.view}return e instanceof Ye?e.view:e}));const e=this.props.depthStencilAttachment;if(e)if("string"==typeof e){const t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else this.depthStencilAttachment=e instanceof Ye?e.view:e}createColorTexture(e){return this.device.createTexture({id:"color-attachment",usage:Ye.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}createDepthStencilTexture(e){return this.device.createTexture({id:"depth-stencil-attachment",usage:Ye.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height})}resizeAttachments(e,t){for(let n=0;n<this.colorAttachments.length;++n)if(this.colorAttachments[n]){const i=this.device._createTexture({...this.colorAttachments[n].props,width:e,height:t});this.destroyAttachedResource(this.colorAttachments[n]),this.colorAttachments[n]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){const n=this.device._createTexture({...this.depthStencilAttachment.props,width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=n.view,this.attachResource(n)}}}je.defaultProps={...We.F.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};var qe=n(4789);function Qe(e,t,n){const i=Fn.attach(e).gl;if(function(e){for(const t in e)return!1;return!0}(t))return n(e);const{nocatch:r=!0}=t;let s;if(ne(i),Q(i,t),r)s=n(i),ie(i);else try{s=n(i)}finally{ie(i)}return s}function Ze(e,t){const n=Fn.attach(e),{gl:i}=n;if(t.cullMode)switch(t.cullMode){case"none":i.disable(x.CULL_FACE);break;case"front":i.enable(x.CULL_FACE),i.cullFace(x.FRONT);break;case"back":i.enable(x.CULL_FACE),i.cullFace(x.BACK)}if(t.frontFace&&i.frontFace(nt("frontFace",t.frontFace,{ccw:x.CCW,cw:x.CW})),t.unclippedDepth&&e.features.has("depth-clip-control")&&i.enable(x.DEPTH_CLAMP_EXT),void 0!==t.depthBias&&i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0),e.features.has("provoking-vertex-webgl")){const e=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex;if(t.provokingVertex){const n=nt("provokingVertex",t.provokingVertex,{first:x.FIRST_VERTEX_CONVENTION_WEBGL,last:x.LAST_VERTEX_CONVENTION_WEBGL});null==e||e.provokingVertexWEBGL(n)}}if(e.features.has("polygon-mode-webgl")){const e=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode;if(t.polygonMode){const n=nt("polygonMode",t.provokingVertex,{fill:x.FILL_WEBGL,lint:x.LINE_WEBGL});null==e||e.polygonModeWEBGL(x.FRONT,n),null==e||e.polygonModeWEBGL(x.BACK,n)}t.polygonOffsetLine&&i.enable(x.POLYGON_OFFSET_LINE_WEBGL)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(x.CLIP_DISTANCE0_WEBGL),t.clipDistance1&&i.enable(x.CLIP_DISTANCE1_WEBGL),t.clipDistance2&&i.enable(x.CLIP_DISTANCE2_WEBGL),t.clipDistance3&&i.enable(x.CLIP_DISTANCE3_WEBGL),t.clipDistance4&&i.enable(x.CLIP_DISTANCE4_WEBGL),t.clipDistance5&&i.enable(x.CLIP_DISTANCE5_WEBGL),t.clipDistance6&&i.enable(x.CLIP_DISTANCE6_WEBGL),t.clipDistance7&&i.enable(x.CLIP_DISTANCE7_WEBGL)),void 0!==t.depthWriteEnabled&&i.depthMask(t.depthWriteEnabled),t.depthCompare&&("always"!==t.depthCompare?i.enable(x.DEPTH_TEST):i.disable(x.DEPTH_TEST),i.depthFunc(Je("depthCompare",t.depthCompare))),t.stencilWriteMask){const e=t.stencilWriteMask;i.stencilMaskSeparate(x.FRONT,e),i.stencilMaskSeparate(x.BACK,e)}if(t.stencilReadMask&&h.R.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){const e=t.stencilReadMask||4294967295,n=Je("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(x.STENCIL_TEST):i.disable(x.STENCIL_TEST),i.stencilFuncSeparate(x.FRONT,n,0,e),i.stencilFuncSeparate(x.BACK,n,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){const e=$e("stencilPassOperation",t.stencilPassOperation),n=$e("stencilFailOperation",t.stencilFailOperation),r=$e("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(x.FRONT,n,r,e),i.stencilOpSeparate(x.BACK,n,r,e)}if(t.blendColorOperation||t.blendAlphaOperation){i.enable(x.BLEND);const e=et("blendColorOperation",t.blendColorOperation||"add"),n=et("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,n);const r=tt("blendColorSrcFactor",t.blendColorSrcFactor||"one"),s=tt("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=tt("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=tt("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(r,s,o,a)}}function Je(e,t){return nt(e,t,{never:x.NEVER,less:x.LESS,equal:x.EQUAL,"less-equal":x.LEQUAL,greater:x.GREATER,"not-equal":x.NOTEQUAL,"greater-equal":x.GEQUAL,always:x.ALWAYS})}function $e(e,t){return nt(e,t,{keep:x.KEEP,zero:x.ZERO,replace:x.REPLACE,invert:x.INVERT,"increment-clamp":x.INCR,"decrement-clamp":x.DECR,"increment-wrap":x.INCR_WRAP,"decrement-wrap":x.DECR_WRAP})}function et(e,t){return nt(e,t,{add:x.FUNC_ADD,subtract:x.FUNC_SUBTRACT,"reverse-subtract":x.FUNC_REVERSE_SUBTRACT,min:x.MIN,max:x.MAX})}function tt(e,t){return nt(e,t,{one:x.ONE,zero:x.ZERO,"src-color":x.SRC_COLOR,"one-minus-src-color":x.ONE_MINUS_SRC_COLOR,"dst-color":x.DST_COLOR,"one-minus-dst-color":x.ONE_MINUS_DST_COLOR,"src-alpha":x.SRC_ALPHA,"one-minus-src-alpha":x.ONE_MINUS_SRC_ALPHA,"dst-alpha":x.DST_ALPHA,"one-minus-dst-alpha":x.ONE_MINUS_DST_ALPHA})}function nt(e,t,n){if(!(t in n))throw new Error(function(e,t){return"Illegal parameter "+t+" for "+e}(e,t));return n[t]}function it(e){const t={};return e.addressModeU&&(t[x.TEXTURE_WRAP_S]=rt(e.addressModeU)),e.addressModeV&&(t[x.TEXTURE_WRAP_T]=rt(e.addressModeV)),e.addressModeW&&(t[x.TEXTURE_WRAP_R]=rt(e.addressModeW)),e.magFilter&&(t[x.TEXTURE_MAG_FILTER]=st(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[x.TEXTURE_MIN_FILTER]=function(e,t){if(!t)return st(e);switch(e){case"nearest":return"nearest"===t?x.NEAREST_MIPMAP_NEAREST:x.NEAREST_MIPMAP_LINEAR;case"linear":return"nearest"===t?x.LINEAR_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[x.TEXTURE_MIN_LOD]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[x.TEXTURE_MAX_LOD]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[x.TEXTURE_COMPARE_MODE]=x.COMPARE_REF_TO_TEXTURE),e.compare&&(t[x.TEXTURE_COMPARE_FUNC]=Je("compare",e.compare)),e.maxAnisotropy&&(t[x.TEXTURE_MAX_ANISOTROPY_EXT]=e.maxAnisotropy),t}function rt(e){switch(e){case"clamp-to-edge":return x.CLAMP_TO_EDGE;case"repeat":return x.REPEAT;case"mirror-repeat":return x.MIRRORED_REPEAT}}function st(e){switch(e){case"nearest":return x.NEAREST;case"linear":return x.LINEAR}}class ot extends E.h{constructor(e,t){void 0===t&&(t={}),super(e,t),this.glIndexType=x.UNSIGNED_SHORT,this.device=e,this.gl=this.device.gl;const n="object"==typeof t?t.handle:void 0;this.handle=n||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=function(e){if(e&E.h.INDEX)return x.ELEMENT_ARRAY_BUFFER;if(e&E.h.VERTEX)return x.ARRAY_BUFFER;if(e&E.h.UNIFORM)return x.UNIFORM_BUFFER;return x.ARRAY_BUFFER}(this.props.usage),this.glUsage=function(e){if(e&E.h.INDEX)return x.STATIC_DRAW;if(e&E.h.VERTEX)return x.STATIC_DRAW;if(e&E.h.UNIFORM)return x.DYNAMIC_DRAW;return x.STATIC_DRAW}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?x.UNSIGNED_INT:x.UNSIGNED_SHORT,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t,n){void 0===t&&(t=0),void 0===n&&(n=e.byteLength+t);const i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,n,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(e,t,n),this.trackAllocatedMemory(n)}_initWithByteLength(e){(0,y.v)(e>=0);let t=e;0===e&&(t=new Float32Array(0));const n=this.glTarget;return this.gl.bindBuffer(n,this.handle),this.gl.bufferData(n,t,this.glUsage),this.gl.bindBuffer(n,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t){void 0===t&&(t=0);const n=x.COPY_WRITE_BUFFER;this.gl.bindBuffer(n,this.handle),this.gl.bufferSubData(n,t,e),this.gl.bindBuffer(n,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e,t){return void 0===e&&(e=0),this.readSyncWebGL(e,t)}readSyncWebGL(e,t){var n;void 0===e&&(e=0),t=null!=(n=t)?n:this.byteLength-e;const i=new Uint8Array(t);return this.gl.bindBuffer(x.COPY_READ_BUFFER,this.handle),this.gl.getBufferSubData(x.COPY_READ_BUFFER,e,i,0,t),this.gl.bindBuffer(x.COPY_READ_BUFFER,null),this._setDebugData(i,e,t),i}}let at,lt;at=Symbol.toStringTag;class ct extends We.F{get[at](){return"Sampler"}constructor(e,t){super(e,t,ct.defaultProps)}}ct.defaultProps={...We.F.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};class ut extends ct{constructor(e,t){super(e,t),this.device=e,this.parameters=it(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return"Sampler("+this.id+","+JSON.stringify(this.props)+")"}_setSamplerParameters(e){for(const[t,n]of Object.entries(e)){const e=Number(t);switch(e){case x.TEXTURE_MIN_LOD:case x.TEXTURE_MAX_LOD:this.device.gl.samplerParameterf(this.handle,e,n);break;default:this.device.gl.samplerParameteri(this.handle,e,n)}}}}lt=Symbol.toStringTag;class ht extends We.F{get[lt](){return"TextureView"}constructor(e,t){super(e,t,ht.defaultProps)}}ht.defaultProps={...We.F.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};class _t extends ht{constructor(e,t){super(e,{...Ye.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}const dt={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0};class ft extends Ye{constructor(e,t){var n;super(e,{...dt,format:"rgba8unorm",...t}),this.sampler=void 0,this.view=void 0,this.glFormat=void 0,this.type=void 0,this.dataFormat=void 0,this.mipmaps=void 0,this.textureUnit=void 0,this.loaded=!1,this.device=e,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=x.RGBA,this.target=function(e){switch(e.dimension){case"2d":return x.TEXTURE_2D;case"cube":return x.TEXTURE_CUBE_MAP;case"2d-array":return x.TEXTURE_2D_ARRAY;case"3d":return x.TEXTURE_3D;default:throw new Error(e.dimension)}}(this.props),this.loaded=!1,"string"==typeof(null==(n=this.props)?void 0:n.data)&&Object.assign(this.props,{data:(0,qe.yt)(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return"Texture("+this.id+","+this.width+"x"+this.height+")"}initialize(e){if(void 0===e&&(e={}),"cube"===this.props.dimension)return this.initializeCube(e);let t=e.data;if(t instanceof Promise)return t.then((t=>this.initialize(Object.assign({},e,{pixels:t,data:t})))),this;const n="undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement;if(n&&t.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,t.addEventListener("loadeddata",(()=>this.initialize(e))),this;const{parameters:i={}}=e,{pixels:r=null,pixelStore:s={},textureUnit:o,mipmaps:a=!0}=e;t||(t=r);let{width:l,height:c,dataFormat:u,type:h,compressed:_=!1}=e;const{depth:d=0}=e,f=De(e.format);return({width:l,height:c,compressed:_,dataFormat:u,type:h}=this._deduceParameters({format:e.format,type:h,dataFormat:u,compressed:_,data:t,width:l,height:c})),this.width=l,this.height=c,this.glFormat=f,this.type=h,this.dataFormat=u,this.textureUnit=o,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(x.TEXTURE0+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=a,this.setImageData({data:t,width:l,height:c,depth:d,format:f,type:h,dataFormat:u,parameters:s,compressed:_}),this.setSampler(e.sampler),this._setSamplerParameters(i),this.view=new _t(this.device,{...this.props,texture:this}),a&&this.generateMipmap(),n&&(this._video={video:t,parameters:i,lastTime:t.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?t.currentTime:-1}),this}initializeCube(e){const{mipmaps:t=!0,parameters:n={}}=e;return this.setCubeMapImageData(e).then((()=>{this.loaded=!0,t&&this.generateMipmap(e),this.setSampler(e.sampler),this._setSamplerParameters(n)})),this}setSampler(e){let t;void 0===e&&(e={}),e instanceof ut?(this.sampler=e,t=e.props):(this.sampler=new ut(this.device,e),t=e);const n=it(t);return this._setSamplerParameters(n),this}resize(e){const{height:t,width:n,mipmaps:i=!1}=e;return n!==this.width||t!==this.height?this.initialize({width:n,height:t,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:i}):this}update(){if(this._video){const{video:e,parameters:t,lastTime:n}=this._video;if(n===e.currentTime||e.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:e,parameters:t}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=e.currentTime}}generateMipmap(e){return void 0===e&&(e={}),this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Qe(this.gl,e,(()=>{this.gl.generateMipmap(this.target)})),this.gl.bindTexture(this.target,null),this}setImageData(e){if("3d"===this.props.dimension||"2d-array"===this.props.dimension)return this.setImageData3D(e);this.trackDeallocatedMemory("Texture");const{target:t=this.target,pixels:n=null,level:i=0,glFormat:r=this.glFormat,offset:s=0,parameters:o={}}=e;let{data:a=null,type:l=this.type,width:c=this.width,height:u=this.height,dataFormat:h=this.dataFormat,compressed:_=!1}=e;a||(a=n),({type:l,dataFormat:h,compressed:_,width:c,height:u}=this._deduceParameters({format:this.props.format,type:l,dataFormat:h,compressed:_,data:a,width:c,height:u}));const{gl:d}=this;d.bindTexture(this.target,this.handle);let f=null;if(({data:a,dataType:f}=this._getDataType({data:a,compressed:_})),Qe(this.gl,o,(()=>{switch(f){case"null":case"browser-object":d.texImage2D(t,i,r,c,u,0,h,l,a);break;case"typed-array":d.texImage2D(t,i,r,c,u,0,h,l,a,s);break;case"buffer":this.device.gl.bindBuffer(x.PIXEL_UNPACK_BUFFER,a.handle||a),this.device.gl.texImage2D(t,i,r,c,u,0,h,l,s),this.device.gl.bindBuffer(x.PIXEL_UNPACK_BUFFER,null);break;case"compressed":for(const[e,n]of a.entries())d.compressedTexImage2D(t,e,n.format,n.width,n.height,0,n.data);break;default:(0,y.v)(!1,"Unknown image data type")}})),a&&a.byteLength)this.trackAllocatedMemory(a.byteLength,"Texture");else{const e=Ue(this.props.format);this.trackAllocatedMemory(this.width*this.height*e,"Texture")}return this.loaded=!0,this}setSubImageData(e){let{target:t=this.target,pixels:n=null,data:i=null,x:r=0,y:s=0,width:o=this.width,height:a=this.height,level:l=0,glFormat:c=this.glFormat,type:u=this.type,dataFormat:h=this.dataFormat,compressed:_=!1,offset:d=0,parameters:f={}}=e;if(({type:u,dataFormat:h,compressed:_,width:o,height:a}=this._deduceParameters({format:this.props.format,type:u,dataFormat:h,compressed:_,data:i,width:o,height:a})),(0,y.v)(1===this.depth,"texSubImage not supported for 3D textures"),i||(i=n),i&&i.data){const e=i;i=e.data,o=e.shape[0],a=e.shape[1]}i instanceof ot&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Qe(this.gl,f,(()=>{_?this.gl.compressedTexSubImage2D(t,l,r,s,o,a,c,i):null===i?this.gl.texSubImage2D(t,l,r,s,o,a,h,u,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(t,l,r,s,o,a,h,u,i,d):"undefined"!=typeof WebGLBuffer&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(x.PIXEL_UNPACK_BUFFER,i),this.device.gl.texSubImage2D(t,l,r,s,o,a,h,u,d),this.device.gl.bindBuffer(x.PIXEL_UNPACK_BUFFER,null)):this.device.gl.texSubImage2D(t,l,r,s,o,a,h,u,i)})),this.gl.bindTexture(this.target,null)}copyFramebuffer(e){return void 0===e&&(e={}),h.R.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(x.ACTIVE_TEXTURE)-x.TEXTURE0}bind(e){void 0===e&&(e=this.textureUnit);const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,this.handle),e}unbind(e){void 0===e&&(e=this.textureUnit);const{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(t.TEXTURE0+e)),t.bindTexture(this.target,null),e}_getDataType(e){let{data:t,compressed:n=!1}=e;return n?{data:t,dataType:"compressed"}:null===t?{data:t,dataType:"null"}:ArrayBuffer.isView(t)?{data:t,dataType:"typed-array"}:t instanceof ot?{data:t.handle,dataType:"buffer"}:"undefined"!=typeof WebGLBuffer&&t instanceof WebGLBuffer?{data:t,dataType:"buffer"}:{data:t,dataType:"browser-object"}}_deduceParameters(e){const{format:t,data:n}=e;let{width:i,height:r,dataFormat:s,type:o,compressed:a}=e;const l=Be(t);return s=s||l.dataFormat,o=o||l.type,a=a||l.compressed,({width:i,height:r}=this._deduceImageSize(n,i,r)),{dataFormat:s,type:o,compressed:a,width:i,height:r,format:t,data:n}}_deduceImageSize(e,t,n){let i;return i="undefined"!=typeof ImageData&&e instanceof ImageData?{width:e.width,height:e.height}:"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement?{width:e.naturalWidth,height:e.naturalHeight}:"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?{width:e.width,height:e.height}:"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement?{width:e.videoWidth,height:e.videoHeight}:e?{width:t,height:n}:{width:t>=0?t:1,height:n>=0?n:1},(0,y.v)(i,"Could not deduced texture size"),(0,y.v)(void 0===t||i.width===t,"Deduced texture width does not match supplied width"),(0,y.v)(void 0===n||i.height===n,"Deduced texture height does not match supplied height"),i}async setCubeMapImageData(e){const{gl:t}=this,{width:n,height:i,pixels:r,data:s,format:o=x.RGBA,type:a=x.UNSIGNED_BYTE}=e,l=r||s,c=await Promise.all(ft.FACES.map((e=>{const t=l[e];return Promise.all(Array.isArray(t)?t:[t])})));this.bind(),ft.FACES.forEach(((e,r)=>{c[r].length>1&&!1!==this.props.mipmaps&&h.R.warn(this.id+" has mipmap and multiple LODs.")(),c[r].forEach(((r,s)=>{n&&i?t.texImage2D(e,s,o,n,i,0,o,a,r):t.texImage2D(e,s,o,o,a,r)}))})),this.unbind()}setImageDataForFace(e){const{face:t,width:n,height:i,pixels:r,data:s,format:o=x.RGBA,type:a=x.UNSIGNED_BYTE}=e,{gl:l}=this,c=r||s;return this.bind(),c instanceof Promise?c.then((n=>this.setImageDataForFace(Object.assign({},e,{face:t,data:n,pixels:n})))):this.width||this.height?l.texImage2D(t,0,o,n,i,0,o,a,c):l.texImage2D(t,0,o,o,a,c),this}setImageData3D(e){const{level:t=0,dataFormat:n,format:i,type:r,width:s,height:o,depth:a=1,offset:l=0,data:c,parameters:u={}}=e;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const h=Be(i);if(Qe(this.gl,u,(()=>{ArrayBuffer.isView(c)&&this.gl.texImage3D(this.target,t,h.format,s,o,a,0,h.dataFormat,h.type,c),c instanceof ot&&(this.gl.bindBuffer(x.PIXEL_UNPACK_BUFFER,c.handle),this.gl.texImage3D(this.target,t,n,s,o,a,0,i,r,l))})),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const e=Ue(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*e,"Texture")}return this.loaded=!0,this}_setSamplerParameters(e){if(!(0,p.Z)(e)){!function(e){h.R.log(1,"texture sampler parameters",e)()}(e),this.gl.bindTexture(this.target,this.handle);for(const[t,n]of Object.entries(e)){const e=Number(t),i=n;switch(e){case x.TEXTURE_MIN_LOD:case x.TEXTURE_MAX_LOD:this.gl.texParameterf(this.target,e,i);break;default:this.gl.texParameteri(this.target,e,i)}}this.gl.bindTexture(this.target,null)}}}ft.FACES=[x.TEXTURE_CUBE_MAP_POSITIVE_X,x.TEXTURE_CUBE_MAP_NEGATIVE_X,x.TEXTURE_CUBE_MAP_POSITIVE_Y,x.TEXTURE_CUBE_MAP_NEGATIVE_Y,x.TEXTURE_CUBE_MAP_POSITIVE_Z,x.TEXTURE_CUBE_MAP_NEGATIVE_Z];const pt="Resource subclass must define virtual methods";class Et extends We.F{constructor(e,t,n){super(e,t,n),this._bound=!1,this.byteLength=0,this.device=Fn.attach(e);const i=this.device.gl,{id:r}=t||{};this.gl=i,this.gl2=i,this.id=r||(0,p.L)(this.constructor.name),this._handle=null==t?void 0:t.handle,void 0===this._handle&&(this._handle=this._createHandle()),this.byteLength=0}toString(){return this.constructor.name+"("+this.id+")"}get handle(){return this._handle}delete(e){let{deleteChildren:t=!1}=void 0===e?{}:e;const n=this._handle&&this._deleteHandle(this._handle);return this._handle&&this.removeStats(),this._handle=null,n&&t&&n.filter(Boolean).forEach((e=>e.destroy())),this}bind(e){if(void 0===e&&(e=this.handle),"function"!=typeof e)return this._bindHandle(e),this;let t;return this._bound?t=e():(this._bindHandle(this.handle),this._bound=!0,t=e(),this._bound=!1,this._bindHandle(null)),t}unbind(){this.bind(null)}stubRemovedMethods(e,t,n){return function(e,t,n,i){const r="See luma.gl "+n+" Upgrade Guide at https://luma.gl/docs/upgrade-guide",s=Object.getPrototypeOf(e);i.forEach((e=>{s.methodName||(s[e]=()=>{throw h.R.removed("Calling removed method "+t+"."+e+": ",r)(),new Error(e)})}))}(this,e,t,n)}initialize(e){}_createHandle(){throw new Error(pt)}_deleteHandle(){throw new Error(pt)}_bindHandle(e){throw new Error(pt)}_getOptsFromHandle(){throw new Error(pt)}_getParameter(e,t){throw new Error(pt)}_setParameter(e,t){throw new Error(pt)}}let gt;gt=Symbol.toStringTag;class mt extends Et{get[gt](){return"Renderbuffer"}get width(){return this.props.width}get height(){return this.props.height}get format(){return this.props.format}get samples(){return this.props.samples}get attachment(){}static isTextureFormatSupported(e,t){return function(e,t,n){var i;return Me(e,t,n)&&(null==(i=Pe[t])?void 0:i.renderbuffer)}(e.gl,t,e._extensions)}constructor(e,t){if("number"==typeof t.format)throw new Error("Renderbuffer");super(e,t,mt.defaultProps),this.glFormat=De(this.props.format),this._initialize(this.props)}resize(e){e.width===this.width&&e.height===this.height||(Object.assign(this.props,{...e,format:this.format,samples:this.samples}),this._initialize(this.props))}_initialize(e){const{format:t,width:n,height:i,samples:r}=e;(0,y.v)(t,"Needs format"),this.trackDeallocatedMemory(),this.gl.bindRenderbuffer(x.RENDERBUFFER,this.handle),0!==r?this.gl.renderbufferStorageMultisample(x.RENDERBUFFER,r,this.glFormat,n,i):this.gl.renderbufferStorage(x.RENDERBUFFER,this.glFormat,n,i),this.gl.bindRenderbuffer(x.RENDERBUFFER,null),this.trackAllocatedMemory(n*i*(r||1)*Ue(this.glFormat))}_createHandle(){return this.gl.createRenderbuffer()}_deleteHandle(){this.gl.deleteRenderbuffer(this.handle),this.trackDeallocatedMemory()}_bindHandle(e){this.gl.bindRenderbuffer(x.RENDERBUFFER,e)}}mt.defaultProps={id:void 0,handle:void 0,userData:void 0,format:void 0,width:1,height:1,samples:0};class At extends je{get texture(){return this.colorAttachments[0]}constructor(e,t){super(e,t);const n=null===t.handle;if(this.device=e,this.gl=e.gl,this.handle=this.props.handle||n?this.props.handle:this.gl.createFramebuffer(),!n){e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.gl.bindFramebuffer(x.FRAMEBUFFER,this.handle);for(let e=0;e<this.colorAttachments.length;++e){const t=this.colorAttachments[e],n=x.COLOR_ATTACHMENT0+e;t&&this._attachOne(n,t)}if(this.depthStencilAttachment&&this._attachOne(function(e){const t=Pe[e];if(null==t||!t.attachment)throw new Error(e+" is not a depth stencil format");return t.attachment}(this.depthStencilAttachment.props.format),this.depthStencilAttachment),!1!==t.check){const e=this.gl.checkFramebufferStatus(x.FRAMEBUFFER);if(e!==x.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer "+function(e){switch(e){case x.FRAMEBUFFER_COMPLETE:return"success";case x.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"Mismatched attachments";case x.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"No attachments";case x.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"Height/width mismatch";case x.FRAMEBUFFER_UNSUPPORTED:return"Unsupported or split attachments";case x.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE:return"Samples mismatch";default:return""+e}}(e))}this.gl.bindFramebuffer(x.FRAMEBUFFER,null)}}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(e){return new mt(this.device,{id:this.id+"-depth-stencil",format:e,width:this.width,height:this.height})}resizeAttachments(e,t){if(null===this.handle)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;void 0===e&&(e=this.gl.drawingBufferWidth),void 0===t&&(t=this.gl.drawingBufferHeight);for(const n of this.colorAttachments)n.texture.resize({width:e,height:t});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:e,height:t}),this}_attachOne(e,t){if(t instanceof mt)return this._attachWEBGLRenderbuffer(e,t),t;if(Array.isArray(t)){const[n,i=0,r=0]=t;return this._attachTexture(e,n,i,r),n}if(t instanceof ft)return this._attachTexture(e,t,0,0),t;if(t instanceof _t){const n=t;return this._attachTexture(e,n.texture,n.props.baseMipLevel,n.props.baseArrayLayer),t.texture}throw new Error("attach")}_attachWEBGLRenderbuffer(e,t){this.gl.framebufferRenderbuffer(x.FRAMEBUFFER,e,x.RENDERBUFFER,t.handle)}_attachTexture(e,t,n,i){const{gl:r}=this.device;switch(r.bindTexture(t.target,t.handle),t.target){case x.TEXTURE_2D_ARRAY:case x.TEXTURE_3D:r.framebufferTextureLayer(x.FRAMEBUFFER,e,t.target,i,n);break;case x.TEXTURE_CUBE_MAP:const s=function(e){return e<x.TEXTURE_CUBE_MAP_POSITIVE_X?e+x.TEXTURE_CUBE_MAP_POSITIVE_X:e}(n);r.framebufferTexture2D(x.FRAMEBUFFER,e,s,t.handle,i);break;case x.TEXTURE_2D:r.framebufferTexture2D(x.FRAMEBUFFER,e,x.TEXTURE_2D,t.handle,i);break;default:(0,y.v)(!1,"Illegal texture type")}r.bindTexture(t.target,null)}}class Rt extends F{constructor(e,t){super(t),this._framebuffer=null,this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(this.device.id+"-canvas"),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new At(this.device,{handle:null}),this._framebuffer}update(){const e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl)if(this.canvas){const t=this.getDevicePixelRatio(null==e?void 0:e.useDevicePixels);this.setDevicePixelRatio(t,e)}else;}commit(){}}const Tt={spector:h.R.get("spector")||h.R.get("inspect")};let vt=null,St=!1;function bt(e){return e.luma=e.luma||{},e.luma}function Ct(e,t){return void 0===t&&(t={}),e?t.debug?function(e,t){if(!globalThis.WebGLDebugUtils)return h.R.warn("webgl-debug not loaded")(),e;const n=bt(e);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...x,...e});const i=globalThis.WebGLDebugUtils.makeDebugContext(e,Nt.bind(null,t),It.bind(null,t));for(const o in x)o in i||"number"!=typeof x[o]||(i[o]=x[o]);class r{}Object.setPrototypeOf(i,Object.getPrototypeOf(e)),Object.setPrototypeOf(r,i);const s=Object.create(r);return n.realContext=e,n.debugContext=s,s.debug=!0,s}(e,t):function(e){const t=bt(e);return t.realContext?t.realContext:e}(e):null}function yt(e,t){t=Array.from(t).map((e=>void 0===e?"undefined":e));let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return n=n.slice(0,100)+(n.length>100?"...":""),"gl."+e+"("+n+")"}function Nt(e,t,n,i){i=Array.from(i).map((e=>void 0===e?"undefined":e));const r=globalThis.WebGLDebugUtils.glEnumToString(t)+" in gl."+n+"("+globalThis.WebGLDebugUtils.glFunctionArgsToString(n,i)+")";if(h.R.error(r)(),e.throwOnError)throw new Error(r)}function It(e,t,n){let i="";if(h.R.level>=1&&(i=yt(t,n),h.R.log(1,i)()),e.break&&e.break.length>0){i=i||yt(t,n);e.break.every((e=>-1!==i.indexOf(e)))}for(const r of n)if(void 0===r){if(i=i||yt(t,n),e.throwOnError)throw new Error("Undefined argument: "+i);h.R.error("Undefined argument: "+i)()}}var Lt=n(5612);function wt(e){const t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class Pt extends Lt.M{constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(x.VERTEX_SHADER);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(x.FRAGMENT_SHADER);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){return function(e){const t=e.split(/\r?\n/),n=[];for(const i of t){if(i.length<=1)continue;const e=i.split(":");if(2===e.length){const[t,i]=e;n.push({message:i.trim(),type:wt(t),lineNum:0,linePos:0});continue}const[t,r,s,...o]=e;let a=parseInt(s,10);isNaN(a)&&(a=0);let l=parseInt(r,10);isNaN(l)&&(l=0),n.push({message:o.join(":").trim(),type:wt(t),lineNum:a,linePos:l})}return n}(this.device.gl.getShaderInfoLog(this.handle))}getTranslatedSource(){const e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return null==e?void 0:e.getTranslatedShaderSource(this.handle)}async _compile(e){e=(e=>e.startsWith("#version ")?e:"#version 100\n"+e)(e);const{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),0!==h.R.level)if(this.device.features.has("compilation-status-async-webgl"))h.R.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),h.R.info(2,"Shader "+this.id+" - async compilation complete: "+this.compilationStatus)(),this._getCompilationStatus(),this.debugShader();else{if(this._getCompilationStatus(),"error"===this.compilationStatus)throw new Error("GLSL compilation errors in "+this.props.stage+" shader "+this.props.id);this.debugShader()}else this.compilationStatus="pending"}async _waitForCompilationComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,x.COMPLETION_STATUS_KHR))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,x.COMPILE_STATUS)?"success":"error"}}let Ft;Ft=Symbol.toStringTag;class Ot extends We.F{get[Ft](){return"RenderPass"}constructor(e,t){super(e,t,Ot.defaultProps)}}Ot.defaultProps={...We.F.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};const Mt=6144;class xt extends Ot{constructor(e,t){super(e,t),this.device=e,ne(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){ie(this.device.gl),this.props.framebuffer&&Q(this.device,{framebuffer:null})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e){void 0===e&&(e={});const t={};this.props.framebuffer&&(t.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=this.props.stencilReadOnly?0:1,t[x.RASTERIZER_DISCARD]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),t.scissorTest=Boolean(e.scissorRect),e.scissorRect&&(t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[x.STENCIL_REF]=e.stencilReference),this.glParameters=t,Q(this.device,t)}beginOcclusionQuery(e){const t=this.props.occlusionQuerySet;null==t||t.beginOcclusionQuery()}endOcclusionQuery(){const e=this.props.occlusionQuerySet;null==e||e.endOcclusionQuery()}clear(){const e={...this.glParameters};let t=0;!1!==this.props.clearColor&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&Qe(this.device,e,(()=>{this.device.gl.clear(t)}))}clearColorBuffer(e,t){void 0===e&&(e=0),void 0===t&&(t=[0,0,0,0]),Qe(this.device.gl,{framebuffer:this.props.framebuffer},(()=>{switch(t.constructor){case Int32Array:this.device.gl.clearBufferiv(Mt,e,t);break;case Uint32Array:this.device.gl.clearBufferuiv(Mt,e,t);break;case Float32Array:default:this.device.gl.clearBufferfv(Mt,e,t)}}))}}var Dt=n(3145);var Bt=n(7590),Ut=n(9282);const Gt="Failed to deduce GL constant from typed array";function kt(e,t){const{clamped:n=!0}=t||{};switch(e){case x.FLOAT:return Float32Array;case x.UNSIGNED_SHORT:case x.UNSIGNED_SHORT_5_6_5:case x.UNSIGNED_SHORT_4_4_4_4:case x.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;case x.UNSIGNED_INT:return Uint32Array;case x.UNSIGNED_BYTE:return n?Uint8ClampedArray:Uint8Array;case x.BYTE:return Int8Array;case x.SHORT:return Int16Array;case x.INT:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const Ht={offset:0,stride:0,type:x.FLOAT,size:1,divisor:0,normalized:!1,integer:!1},Vt={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Xt{static getBytesPerElement(e){return kt(e.type||x.FLOAT).BYTES_PER_ELEMENT}static getBytesPerVertex(e){(0,y.v)(e.size);return kt(e.type||x.FLOAT).BYTES_PER_ELEMENT*e.size}static resolve(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Xt(...[Ht,...t])}constructor(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach((e=>this._assign(e))),Object.freeze(this)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Xt.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Xt.getBytesPerVertex(this)}_assign(e){return void 0===e&&(e={}),void 0!==(e=function(e,t,n){const{removedProps:i={},deprecatedProps:r={},replacedProps:s={}}=n;for(const a in i)if(a in t){const t=i[a]?e+"."+i[a]:"N/A";h.R.removed(e+"."+a,t)()}for(const a in r)if(a in t){const t=r[a];h.R.deprecated(e+"."+a,e+"."+t)()}let o=null;for(const[a,l]of Object.entries(s))a in t&&(h.R.deprecated(e+"."+a,e+"."+l)(),o=o||Object.assign({},t),o[l]=t[a],delete o[a]);return o||t}("Accessor",e,Vt)).type&&(this.type=e.type,e.type!==x.INT&&e.type!==x.UNSIGNED_INT||(this.integer=!0)),void 0!==e.size&&(this.size=e.size),void 0!==e.offset&&(this.offset=e.offset),void 0!==e.stride&&(this.stride=e.stride),void 0!==e.normalize&&(this.normalized=e.normalize),void 0!==e.normalized&&(this.normalized=e.normalized),void 0!==e.integer&&(this.integer=e.integer),void 0!==e.divisor&&(this.divisor=e.divisor),void 0!==e.buffer&&(this.buffer=e.buffer),void 0!==e.index&&("boolean"==typeof e.index?this.index=e.index?1:0:this.index=e.index),void 0!==e.instanced&&(this.divisor=e.instanced?1:0),void 0!==e.isInstanced&&(this.divisor=e.isInstanced?1:0),void 0===this.offset&&delete this.offset,void 0===this.stride&&delete this.stride,void 0===this.type&&delete this.type,void 0===this.size&&delete this.size,void 0===this.divisor&&delete this.divisor,void 0===this.normalized&&delete this.normalized,void 0===this.integer&&delete this.integer,void 0===this.buffer&&delete this.buffer,void 0===this.index&&delete this.index,this}}const Wt=[x.SAMPLER_2D,x.SAMPLER_CUBE,x.SAMPLER_3D,x.SAMPLER_2D_SHADOW,x.SAMPLER_2D_ARRAY,x.SAMPLER_2D_ARRAY_SHADOW,x.SAMPLER_CUBE_SHADOW,x.INT_SAMPLER_2D,x.INT_SAMPLER_3D,x.INT_SAMPLER_CUBE,x.INT_SAMPLER_2D_ARRAY,x.UNSIGNED_INT_SAMPLER_2D,x.UNSIGNED_INT_SAMPLER_3D,x.UNSIGNED_INT_SAMPLER_CUBE,x.UNSIGNED_INT_SAMPLER_2D_ARRAY],Kt={[x.FLOAT]:[x.FLOAT,1,"float","f32","float32"],[x.FLOAT_VEC2]:[x.FLOAT,2,"vec2","vec2<f32>","float32x2"],[x.FLOAT_VEC3]:[x.FLOAT,3,"vec3","vec3<f32>","float32x3"],[x.FLOAT_VEC4]:[x.FLOAT,4,"vec4","vec4<f32>","float32x4"],[x.INT]:[x.INT,1,"int","i32","sint32"],[x.INT_VEC2]:[x.INT,2,"ivec2","vec2<i32>","sint32x2"],[x.INT_VEC3]:[x.INT,3,"ivec3","vec3<i32>","sint32x3"],[x.INT_VEC4]:[x.INT,4,"ivec4","vec4<i32>","sint32x4"],[x.UNSIGNED_INT]:[x.UNSIGNED_INT,1,"uint","u32","uint32"],[x.UNSIGNED_INT_VEC2]:[x.UNSIGNED_INT,2,"uvec2","vec2<u32>","uint32x2"],[x.UNSIGNED_INT_VEC3]:[x.UNSIGNED_INT,3,"uvec3","vec3<u32>","uint32x3"],[x.UNSIGNED_INT_VEC4]:[x.UNSIGNED_INT,4,"uvec4","vec4<u32>","uint32x4"],[x.BOOL]:[x.FLOAT,1,"bool","f32","float32"],[x.BOOL_VEC2]:[x.FLOAT,2,"bvec2","vec2<f32>","float32x2"],[x.BOOL_VEC3]:[x.FLOAT,3,"bvec3","vec3<f32>","float32x3"],[x.BOOL_VEC4]:[x.FLOAT,4,"bvec4","vec4<f32>","float32x4"],[x.FLOAT_MAT2]:[x.FLOAT,8,"mat2","mat2x2<f32>"],[x.FLOAT_MAT2x3]:[x.FLOAT,8,"mat2x3","mat2x3<f32>"],[x.FLOAT_MAT2x4]:[x.FLOAT,8,"mat2x4","mat2x4<f32>"],[x.FLOAT_MAT3x2]:[x.FLOAT,12,"mat3x2","mat3x2<f32>"],[x.FLOAT_MAT3]:[x.FLOAT,12,"mat3","mat3x3<f32>"],[x.FLOAT_MAT3x4]:[x.FLOAT,12,"mat3x4","mat3x4<f32>"],[x.FLOAT_MAT4x2]:[x.FLOAT,16,"mat4x2","mat4x2<f32>"],[x.FLOAT_MAT4x3]:[x.FLOAT,16,"mat4x3","mat4x3<f32>"],[x.FLOAT_MAT4]:[x.FLOAT,16,"mat4","mat4x4<f32>"]};function zt(e){const t=Kt[e];if(!t)throw new Error("uniform");const[n,i,,r]=t;return{format:r,components:i,glType:n}}function Yt(e){const t=Kt[e];if(!t)throw new Error("attribute");const[,n,,i,r]=t;return{attributeType:i,vertexFormat:r,components:n}}function jt(e,t){const n={attributes:[],bindings:[]};n.attributes=function(e,t){const n=[],i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const i=e.getActiveAttrib(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o}=i,a=e.getAttribLocation(t,s);if(a>=0){const{attributeType:e}=Yt(o),t=/instance/i.test(s)?"instance":"vertex";n.push({name:s,location:a,stepMode:t,type:e})}}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);const i=function(e,t){const n=(n,i)=>e.getActiveUniformBlockParameter(t,n,i),i=[],r=e.getProgramParameter(t,x.ACTIVE_UNIFORM_BLOCKS);for(let s=0;s<r;s++){const r={name:e.getActiveUniformBlockName(t,s)||"",location:n(s,x.UNIFORM_BLOCK_BINDING),byteLength:n(s,x.UNIFORM_BLOCK_DATA_SIZE),vertex:n(s,x.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER),fragment:n(s,x.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER),uniformCount:n(s,x.UNIFORM_BLOCK_ACTIVE_UNIFORMS),uniforms:[]},o=n(s,x.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES)||[],a=e.getActiveUniforms(t,o,x.UNIFORM_TYPE),l=e.getActiveUniforms(t,o,x.UNIFORM_SIZE),c=e.getActiveUniforms(t,o,x.UNIFORM_OFFSET),u=e.getActiveUniforms(t,o,x.UNIFORM_ARRAY_STRIDE);for(let n=0;n<r.uniformCount;++n){const i=e.getActiveUniform(t,o[n]);if(!i)throw new Error("activeInfo");r.uniforms.push({name:i.name,format:zt(a[n]).format,type:a[n],arrayLength:l[n],byteOffset:c[n],byteStride:u[n]})}i.push(r)}return i.sort(((e,t)=>e.location-t.location)),i}(e,t);for(const l of i){const e=l.uniforms.map((e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength})));n.bindings.push({type:"uniform",name:l.name,location:l.location,visibility:(l.vertex?1:0)&(l.fragment?2:0),minBindingSize:l.byteLength,uniforms:e})}const r=function(e,t){const n=[],i=e.getProgramParameter(t,x.ACTIVE_UNIFORMS);for(let r=0;r<i;r++){const i=e.getActiveUniform(t,r);if(!i)throw new Error("activeInfo");const{name:s,size:o,type:a}=i,{name:l,isArray:c}=Zt(s);let u=e.getUniformLocation(t,l);const h={location:u,name:l,size:o,type:a,isArray:c};if(n.push(h),h.size>1)for(let r=0;r<h.size;r++){const i=l+"["+r+"]";u=e.getUniformLocation(t,i);const s={...h,name:i,location:u};n.push(s)}}return n}(e,t);let s=0;for(const l of r)if(o=l.type,Wt.includes(o)){const{viewDimension:e,sampleType:t}=Qt(l.type);n.bindings.push({type:"texture",name:l.name,location:s,viewDimension:e,sampleType:t}),l.textureUnit=s,s+=1}var o;r.length&&(n.uniforms=r);const a=function(e,t){const n=[],i=e.getProgramParameter(t,x.TRANSFORM_FEEDBACK_VARYINGS);for(let r=0;r<i;r++){const i=e.getTransformFeedbackVarying(t,r);if(!i)throw new Error("activeInfo");const{name:s,type:o,size:a}=i,{glType:l,components:c}=zt(o),u={location:r,name:s,accessor:new Xt({type:l,size:a*c})};n.push(u)}return n.sort(((e,t)=>e.location-t.location)),n}(e,t);return null!=a&&a.length&&(n.varyings=a),n}const qt={[x.SAMPLER_2D]:["2d","float"],[x.SAMPLER_CUBE]:["cube","float"],[x.SAMPLER_3D]:["3d","float"],[x.SAMPLER_2D_SHADOW]:["3d","depth"],[x.SAMPLER_2D_ARRAY]:["2d-array","float"],[x.SAMPLER_2D_ARRAY_SHADOW]:["2d-array","depth"],[x.SAMPLER_CUBE_SHADOW]:["cube","float"],[x.INT_SAMPLER_2D]:["2d","sint"],[x.INT_SAMPLER_3D]:["3d","sint"],[x.INT_SAMPLER_CUBE]:["cube","sint"],[x.INT_SAMPLER_2D_ARRAY]:["2d-array","uint"],[x.UNSIGNED_INT_SAMPLER_2D]:["2d","uint"],[x.UNSIGNED_INT_SAMPLER_3D]:["3d","uint"],[x.UNSIGNED_INT_SAMPLER_CUBE]:["cube","uint"],[x.UNSIGNED_INT_SAMPLER_2D_ARRAY]:["2d-array","uint"]};function Qt(e){const t=qt[e];if(!t)throw new Error("sampler");const[n,i]=t;return{viewDimension:n,sampleType:i}}function Zt(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};const t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name "+e);return{name:t[1],length:t[2]?1:0,isArray:Boolean(t[2])}}function Jt(e,t,n,i){const r=e;let s=i;!0===s&&(s=1),!1===s&&(s=0);const o="number"==typeof s?[s]:s;switch(n){case x.SAMPLER_2D:case x.SAMPLER_CUBE:case x.SAMPLER_3D:case x.SAMPLER_2D_SHADOW:case x.SAMPLER_2D_ARRAY:case x.SAMPLER_2D_ARRAY_SHADOW:case x.SAMPLER_CUBE_SHADOW:case x.INT_SAMPLER_2D:case x.INT_SAMPLER_3D:case x.INT_SAMPLER_CUBE:case x.INT_SAMPLER_2D_ARRAY:case x.UNSIGNED_INT_SAMPLER_2D:case x.UNSIGNED_INT_SAMPLER_3D:case x.UNSIGNED_INT_SAMPLER_CUBE:case x.UNSIGNED_INT_SAMPLER_2D_ARRAY:if("number"!=typeof i)throw new Error("samplers must be set to integers");return e.uniform1i(t,i);case x.FLOAT:return e.uniform1fv(t,o);case x.FLOAT_VEC2:return e.uniform2fv(t,o);case x.FLOAT_VEC3:return e.uniform3fv(t,o);case x.FLOAT_VEC4:return e.uniform4fv(t,o);case x.INT:return e.uniform1iv(t,o);case x.INT_VEC2:return e.uniform2iv(t,o);case x.INT_VEC3:return e.uniform3iv(t,o);case x.INT_VEC4:return e.uniform4iv(t,o);case x.BOOL:return e.uniform1iv(t,o);case x.BOOL_VEC2:return e.uniform2iv(t,o);case x.BOOL_VEC3:return e.uniform3iv(t,o);case x.BOOL_VEC4:return e.uniform4iv(t,o);case x.UNSIGNED_INT:return r.uniform1uiv(t,o,1);case x.UNSIGNED_INT_VEC2:return r.uniform2uiv(t,o,2);case x.UNSIGNED_INT_VEC3:return r.uniform3uiv(t,o,3);case x.UNSIGNED_INT_VEC4:return r.uniform4uiv(t,o,4);case x.FLOAT_MAT2:return e.uniformMatrix2fv(t,!1,o);case x.FLOAT_MAT3:return e.uniformMatrix3fv(t,!1,o);case x.FLOAT_MAT4:return e.uniformMatrix4fv(t,!1,o);case x.FLOAT_MAT2x3:return r.uniformMatrix2x3fv(t,!1,o);case x.FLOAT_MAT2x4:return r.uniformMatrix2x4fv(t,!1,o);case x.FLOAT_MAT3x2:return r.uniformMatrix3x2fv(t,!1,o);case x.FLOAT_MAT3x4:return r.uniformMatrix3x4fv(t,!1,o);case x.FLOAT_MAT4x2:return r.uniformMatrix4x2fv(t,!1,o);case x.FLOAT_MAT4x3:return r.uniformMatrix4x3fv(t,!1,o)}throw new Error("Illegal uniform")}class $t extends Dt.r{constructor(e,t){super(e,t),this.uniforms={},this.bindings={},this.varyings=null,this._uniformCount=0,this._uniformSetters={},this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;const{varyings:n,bufferMode:i=x.SEPARATE_ATTRIBS}=t;switch(n&&n.length>0&&(this.varyings=n,this.device.gl.transformFeedbackVaryings(this.handle,n,i)),this._linkShaders(),h.R.time(0,"RenderPipeline "+this.id+" - shaderLayout introspection")(),this.introspectedLayout=jt(this.device.gl,this.handle),h.R.timeEnd(0,"RenderPipeline "+this.id+" - shaderLayout introspection")(),this.shaderLayout=(0,Ut.GE)(this.introspectedLayout,t.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":h.R.warn("Primitive topology "+this.props.topology+" is deprecated and will be removed in v9.1")}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e){for(const[t,n]of Object.entries(e)){const e=this.shaderLayout.bindings.find((e=>e.name===t))||this.shaderLayout.bindings.find((e=>e.name===t+"Uniforms"));if(e){switch(n||h.R.warn('Unsetting binding "'+t+'" in render pipeline "'+this.id+'"')(),e.type){case"uniform":if(!(n instanceof ot||n.buffer instanceof ot))throw new Error("buffer value");break;case"texture":if(!(n instanceof _t||n instanceof ft||n instanceof At))throw new Error("texture value");break;case"sampler":h.R.warn("Ignoring sampler "+t)();break;default:throw new Error(e.type)}this.bindings[t]=n}else{const e=this.shaderLayout.bindings.map((e=>'"'+e.name+'"')).join(", ");h.R.warn('Unknown binding "'+t+'" in render pipeline "'+this.id+'", expected one of '+e)()}}}draw(e){var t;if("success"!==this.linkStatus)return!1;const{renderPass:n,vertexArray:i,vertexCount:r,instanceCount:s,firstVertex:o=0,transformFeedback:a}=e,l=function(e){switch(e){case"point-list":return x.POINTS;case"line-list":return x.LINES;case"line-strip":return x.LINE_STRIP;case"line-loop-webgl":return x.LINE_LOOP;case"triangle-list":return x.TRIANGLES;case"triangle-strip":return x.TRIANGLE_STRIP;case"triangle-fan-webgl":return x.TRIANGLE_FAN;default:throw new Error(e)}}(this.props.topology),c=Boolean(i.indexBuffer),u=null==(t=i.indexBuffer)?void 0:t.glIndexType,h=Number(s)>0;if(!this._areTexturesRenderable()||0===r)return!1;this.device.gl.useProgram(this.handle),i.bindBeforeRender(n),a&&a.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const _=n;return function(e,t,n,i){if((0,p.Z)(t))return i(e);ne(e.gl);try{return Ze(e,t),Q(e,n),i(e)}finally{ie(e.gl)}}(this.device,this.props.parameters,_.glParameters,(()=>{c&&h?this.device.gl.drawElementsInstanced(l,r||0,u,o,s||0):c?this.device.gl.drawElements(l,r||0,u,o):h?this.device.gl.drawArraysInstanced(l,o,r||0,s||0):this.device.gl.drawArrays(l,o,r||0),a&&a.end()})),i.unbindAfterRender(n),!0}setUniformsWebGL(e){const{bindings:t}=(0,Bt.l)(e);Object.keys(t).forEach((e=>{h.R.warn('Unsupported value "'+JSON.stringify(t[e])+'" used in setUniforms() for key '+e+". Use setBindings() instead?")()})),Object.assign(this.uniforms,e)}async _linkShaders(){const{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),h.R.time(4,"linkProgram for "+this.id)(),e.linkProgram(this.handle),h.R.timeEnd(4,"linkProgram for "+this.id)(),h.R.level,!this.device.features.has("compilation-status-async-webgl")){const e=this._getLinkStatus();return void this._reportLinkStatus(e)}h.R.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),h.R.info(2,"RenderPipeline "+this.id+" - async linking complete: "+this.linkStatus)();const t=this._getLinkStatus();this._reportLinkStatus(t)}_reportLinkStatus(e){var t;if("success"!==e){if("error"===this.vs.compilationStatus)throw this.vs.debugShader(),new Error("Error during compilation of shader "+this.vs.id);if("error"===(null==(t=this.fs)?void 0:t.compilationStatus))throw this.vs.debugShader(),new Error("Error during compilation of shader "+this.fs.id);throw new Error("Error during "+e+": "+this.device.gl.getProgramInfoLog(this.handle))}}_getLinkStatus(){const{gl:e}=this.device;if(!e.getProgramParameter(this.handle,e.LINK_STATUS))return this.linkStatus="error","linking";e.validateProgram(this.handle);return e.getProgramParameter(this.handle,e.VALIDATE_STATUS)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")}async _waitForLinkComplete(){const e=async e=>await new Promise((t=>setTimeout(t,e)));if(!this.device.features.has("compilation-status-async-webgl"))return void await e(10);const{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,x.COMPLETION_STATUS_KHR))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(const[,t]of Object.entries(this.bindings))t instanceof ft&&(t.update(),e=e&&t.loaded);return e}_applyBindings(){if("success"!==this.linkStatus)return;const{gl:e}=this.device;e.useProgram(this.handle);let t=0,n=0;for(const i of this.shaderLayout.bindings){const r=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!r)throw new Error("No value for binding "+i.name+" in "+this.id);switch(i.type){case"uniform":const{name:s}=i,o=e.getUniformBlockIndex(this.handle,s);if(o===x.INVALID_INDEX)throw new Error("Invalid uniform block name "+s);e.uniformBlockBinding(this.handle,n,o),r instanceof ot?e.bindBufferBase(x.UNIFORM_BUFFER,n,r.handle):e.bindBufferRange(x.UNIFORM_BUFFER,n,r.buffer.handle,r.offset||0,r.size||r.buffer.byteLength-r.offset),n+=1;break;case"texture":if(!(r instanceof _t||r instanceof ft||r instanceof At))throw new Error("texture");let a;if(r instanceof _t)a=r.texture;else if(r instanceof ft)a=r;else{if(!(r instanceof At&&r.colorAttachments[0]instanceof ft))throw new Error("No texture");h.R.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),a=r.colorAttachments[0]}e.activeTexture(x.TEXTURE0+t),e.bindTexture(a.target,a.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error("binding type '"+i.type+"' not supported in WebGL")}}}_applyUniforms(){for(const t of this.shaderLayout.uniforms||[]){var e;const{name:n,location:i,type:r,textureUnit:s}=t,o=null!=(e=this.uniforms[n])?e:s;void 0!==o&&Jt(this.device.gl,i,r,o)}}}let en,tn,nn;en=Symbol.toStringTag;class rn extends We.F{get[en](){return"CommandEncoder"}constructor(e,t){super(e,t,rn.defaultProps)}}rn.defaultProps={...We.F.defaultProps,measureExecutionTime:void 0},tn=Symbol.toStringTag;class sn extends We.F{get[tn](){return"CommandBuffer"}constructor(e,t){super(e,t,sn.defaultProps)}}sn.defaultProps={...We.F.defaultProps};class on extends sn{constructor(e){super(e,{}),this.commands=[],this.device=e}submitCommands(e){void 0===e&&(e=this.commands);for(const t of e)switch(t.name){case"copy-buffer-to-buffer":an(this.device,t.options);break;case"copy-buffer-to-texture":ln(this.device,t.options);break;case"copy-texture-to-buffer":cn(this.device,t.options);break;case"copy-texture-to-texture":un(this.device,t.options)}}}function an(e,t){var n,i;const r=t.source,s=t.destination;e.gl.bindBuffer(x.COPY_READ_BUFFER,r.handle),e.gl.bindBuffer(x.COPY_WRITE_BUFFER,s.handle),e.gl.copyBufferSubData(x.COPY_READ_BUFFER,x.COPY_WRITE_BUFFER,null!=(n=t.sourceOffset)?n:0,null!=(i=t.destinationOffset)?i:0,t.size),e.gl.bindBuffer(x.COPY_READ_BUFFER,null),e.gl.bindBuffer(x.COPY_WRITE_BUFFER,null)}function ln(e,t){throw new Error("Not implemented")}function cn(e,t){const{source:n,mipLevel:i=0,aspect:r="all",width:s=t.source.width,height:o=t.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:_}=t;if("all"!==r)throw new Error("not supported");if(0!==i||0!==a||h||_)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:f}=hn(n);try{const t=c,n=s||d.width,i=o||d.height,r=Be(d.texture.props.format),a=r.dataFormat,h=r.type;e.gl.bindBuffer(x.PIXEL_PACK_BUFFER,t.handle),e.gl.bindFramebuffer(x.FRAMEBUFFER,d.handle),e.gl.readPixels(l[0],l[1],n,i,a,h,u)}finally{e.gl.bindBuffer(x.PIXEL_PACK_BUFFER,null),e.gl.bindFramebuffer(x.FRAMEBUFFER,null),f&&d.destroy()}}function un(e,t){const{source:n,origin:i=[0,0],destination:r}=t;let{width:s=t.destination.width,height:o=t.destination.width}=t;const a=x.RGBA,{framebuffer:l,destroyFramebuffer:c}=hn(n),[u,h]=i;e.gl.bindFramebuffer(x.FRAMEBUFFER,l.handle);let _,d=null;if(!(r instanceof ft))throw new Error("whoops");return d=r,s=Number.isFinite(s)?s:d.width,o=Number.isFinite(o)?o:d.height,d.bind(0),_=d.destination,e.gl.copyTexImage2D(_,0,a,u,h,s,o,0),d&&d.unbind(),c&&l.destroy(),d}function hn(e){if(e instanceof Ye){const{width:t,height:n,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:"framebuffer-for-"+i,width:t,height:n,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class _n extends rn{constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new on(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,n){}}nn=Symbol.toStringTag;class dn extends We.F{get[nn](){return"VertexArray"}constructor(e,t){super(e,t,dn.defaultProps),this.indexBuffer=null,this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=(0,Ut.Mr)(t.renderPipeline.shaderLayout,t.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(e,t){throw new Error("constant attributes not supported")}}dn.defaultProps={...We.F.defaultProps,renderPipeline:null};var fn=n(1649),pn=n(7651);let En,gn,mn,An;En=Symbol.toStringTag;class Rn extends dn{get[En](){return"VertexArray"}static isConstantAttributeZeroSupported(e){return"Chrome"===(0,pn.A)()}constructor(e,t){super(e,t),this.buffer=null,this.bufferValue=null,this.init=!1,this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){var e;(super.destroy(),this.buffer)&&(null==(e=this.buffer)||e.destroy());this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){const t=e;if(t&&t.glTarget!==x.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(x.ELEMENT_ARRAY_BUFFER,t?t.handle:null),this.indexBuffer=t}setBuffer(e,t){const n=t;if(n.glTarget===x.ELEMENT_ARRAY_BUFFER)throw new Error("Use .setIndexBuffer()");const{size:i,type:r,stride:s,offset:o,normalized:a,integer:l,divisor:c}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(x.ARRAY_BUFFER,n.handle),l?this.device.gl.vertexAttribIPointer(e,i,r,s,o):this.device.gl.vertexAttribPointer(e,i,r,a,s,o),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,c||0),this.attributes[e]=n}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){if(this.device.gl.bindVertexArray(this.handle),!this.init){const e=this.indexBuffer;this.device.gl.bindBuffer(x.ELEMENT_ARRAY_BUFFER,(null==e?void 0:e.handle)||null),this.init=!0}this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){const t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){const t=this.attributeInfos[e];if(!t)throw new Error("Unknown attribute location "+e);const n=ue(t.bufferDataType);return{size:t.bufferComponents,type:n,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:"instance"===t.stepMode?1:0}}_enable(e,t){void 0===t&&(t=!0);const n=Rn.isConstantAttributeZeroSupported(this.device);(t||(n||0!==e))&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){const n=function(e){if(Array.isArray(e))return new Float32Array(e);return e}(t),i=n.byteLength*e,r=n.length*e;if(this.buffer&&i!==this.buffer.byteLength)throw new Error("Buffer size is immutable, byte length "+i+" !== "+this.buffer.byteLength+".");let s=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:i}),s=s||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(n,this.bufferValue),s){const e=(0,fn.oF)(t.constructor,r);(0,fn.R2)({target:e,source:n,start:0,count:r}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}gn=Symbol.toStringTag;class Tn extends We.F{get[gn](){return"TransformFeedback"}constructor(e,t){super(e,t,Tn.defaultProps)}}Tn.defaultProps={...We.F.defaultProps,layout:void 0,buffers:{}};class vn extends Tn{constructor(e,t){super(e,t),this.buffers={},this.unusedBuffers={},this.bindOnUse=!0,this._bound=!1,this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e){void 0===e&&(e="point-list"),this.gl.bindTransformFeedback(x.TRANSFORM_FEEDBACK,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return x.POINTS;case"line-list":case"line-strip":case"line-loop-webgl":return x.LINES;case"triangle-list":case"triangle-strip":case"triangle-fan-webgl":return x.TRIANGLES;default:throw new Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(x.TRANSFORM_FEEDBACK,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind((()=>{for(const t in e)this.setBuffer(t,e[t])}))}setBuffer(e,t){const n=this._getVaryingIndex(e),{buffer:i,byteLength:r,byteOffset:s}=this._getBufferRange(t);if(n<0)return this.unusedBuffers[e]=i,void h.R.warn(this.id+" unusedBuffers varying buffer "+e)();this.buffers[n]={buffer:i,byteLength:r,byteOffset:s},this.bindOnUse||this._bindBuffer(n,i,s,r)}getBuffer(e){if(Sn(e))return this.buffers[e]||null;const t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e){if(void 0===e&&(e=this.handle),"function"!=typeof e)return this.gl.bindTransformFeedback(x.TRANSFORM_FEEDBACK,e),this;let t;return this._bound?t=e():(this.gl.bindTransformFeedback(x.TRANSFORM_FEEDBACK,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(x.TRANSFORM_FEEDBACK,null)),t}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof ot)return{buffer:e,byteOffset:0,byteLength:e.byteLength};const{buffer:t,byteOffset:n=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:n,byteLength:i}}_getVaryingIndex(e){if(Sn(e))return Number(e);for(const t of this.layout.varyings)if(e===t.name)return t.location;return-1}_bindBuffers(){for(const e in this.buffers){const{buffer:t,byteLength:n,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,n)}}_unbindBuffers(){for(const e in this.buffers)this.gl.bindBufferBase(x.TRANSFORM_FEEDBACK_BUFFER,Number(e),null)}_bindBuffer(e,t,n,i){void 0===n&&(n=0);const r=t&&t.handle;r&&void 0!==i?this.gl.bindBufferRange(x.TRANSFORM_FEEDBACK_BUFFER,e,r,n,i):this.gl.bindBufferBase(x.TRANSFORM_FEEDBACK_BUFFER,e,r)}}function Sn(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}mn=Symbol.toStringTag;class bn extends We.F{get[mn](){return"QuerySet"}constructor(e,t){super(e,t,bn.defaultProps)}}bn.defaultProps={...We.F.defaultProps,type:void 0,count:void 0},An=Symbol.toStringTag;class Cn extends bn{get[An](){return"Query"}constructor(e,t){if(super(e,t),this.target=null,this._queryPending=!1,this._pollingPromise=null,this.device=e,t.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(x.TIME_ELAPSED_EXT)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(null!=e&&e.conservative?x.ANY_SAMPLES_PASSED_CONSERVATIVE:x.ANY_SAMPLES_PASSED)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(x.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){this._queryPending||(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const e=this.device.gl.getQueryParameter(this.handle,x.QUERY_RESULT_AVAILABLE);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(x.GPU_DISJOINT_EXT)}getResult(){return this.device.gl.getQueryParameter(this.handle,x.QUERY_RESULT)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e){if(void 0===e&&(e=Number.POSITIVE_INFINITY),this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise(((n,i)=>{const r=()=>{this.isResultAvailable()?(n(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(r)};requestAnimationFrame(r)})),this._pollingPromise}}function yn(e){switch(e){case x.ALPHA:case x.R32F:case x.RED:return 1;case x.RG32F:case x.RG:return 2;case x.RGB:case x.RGB32F:return 3;case x.RGBA:case x.RGBA32F:return 4;default:return(0,y.v)(!1),0}}function Nn(e,t){var n;const{sourceX:i=0,sourceY:r=0,sourceFormat:s=x.RGBA,sourceAttachment:o=x.COLOR_ATTACHMENT0}=t||{};let{target:a=null,sourceWidth:l,sourceHeight:c,sourceType:u}=t||{};const{framebuffer:h,deleteFramebuffer:_}=Ln(e);(0,y.v)(h);const{gl:d,handle:f}=h;l=l||h.width,c=c||h.height;const p=o-x.COLOR_ATTACHMENT0;u=u||(null==(n=h.colorAttachments[p])||null==(n=n.texture)?void 0:n.type)||x.UNSIGNED_BYTE,a=function(e,t,n,i,r){if(e)return e;const s=kt(t=t||x.UNSIGNED_BYTE,{clamped:!1}),o=yn(n);return new s(i*r*o)}(a,u,s,l,c),u=u||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return x.FLOAT;case Uint16Array:return x.UNSIGNED_SHORT;case Uint32Array:return x.UNSIGNED_INT;case Uint8Array:case Uint8ClampedArray:return x.UNSIGNED_BYTE;case Int8Array:return x.BYTE;case Int16Array:return x.SHORT;case Int32Array:return x.INT;default:throw new Error(Gt)}}(a);const E=d.bindFramebuffer(x.FRAMEBUFFER,f);return d.readPixels(i,r,l,c,s,u,a),d.bindFramebuffer(x.FRAMEBUFFER,E||null),_&&h.destroy(),a}function In(e,t){const{target:n,sourceX:i=0,sourceY:r=0,sourceFormat:s=x.RGBA,targetByteOffset:o=0}=t||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=t||{};const{framebuffer:u,deleteFramebuffer:h}=Ln(e);(0,y.v)(u),a=a||u.width,l=l||u.height;const _=u;c=c||x.UNSIGNED_BYTE;let d=n;if(!d){const e=o+a*l*yn(s)*function(e){switch(e){case x.UNSIGNED_BYTE:return 1;case x.UNSIGNED_SHORT_5_6_5:case x.UNSIGNED_SHORT_4_4_4_4:case x.UNSIGNED_SHORT_5_5_5_1:return 2;case x.FLOAT:return 4;default:return(0,y.v)(!1),0}}(c);d=_.device.createBuffer({byteLength:e})}const f=e.device.createCommandEncoder();return f.copyTextureToBuffer({source:e,width:a,height:l,origin:[i,r],destination:d,byteOffset:o}),f.destroy(),h&&u.destroy(),d}function Ln(e){return e instanceof je?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:wn(e),deleteFramebuffer:!0}}function wn(e,t){const{device:n,width:i,height:r,id:s}=e;return n.createFramebuffer({...t,id:"framebuffer-for-"+s,width:i,height:r,colorAttachments:[e]})}const Pn="clear: bad arguments";class Fn extends C{static isSupported(){return"undefined"!=typeof WebGL2RenderingContext}static attach(e){if(e instanceof Fn)return e;if((null==e?void 0:e.device)instanceof C)return e.device;if(!function(e){if("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)return!0;return Boolean(e&&Number.isFinite(e._version))}(e))throw new Error("Invalid WebGL2RenderingContext");return new Fn({gl:e})}static async create(e){var t;void 0===e&&(e={}),h.R.groupCollapsed(1,"WebGLDevice created")();const n=[];if(e.debug&&n.push(async function(){(0,u.A)()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await(0,qe.k0)("https://unpkg.com/webgl-debug@2.0.1/index.js"))}()),e.spector&&n.push(async function(e){if(!globalThis.SPECTOR)try{await(0,qe.k0)("https://spectorcdn.babylonjs.com/spector.bundle.js")}catch(t){h.R.warn(String(t))}}()),"string"==typeof e.canvas&&n.push(F.pageLoaded),await Promise.all(n),h.R.probe(2,"DOM is loaded")(),null!=(t=e.gl)&&t.device)return Fn.attach(e.gl);const i=new Fn(e),r="Created "+i.info.type+(i.debug?" debug":"")+" context: "+i.info.vendor+", "+i.info.renderer+" for canvas: "+i.canvasContext.id;return h.R.probe(1,r)(),h.R.table(1,i.info)(),h.R.groupEnd(1)(),i}constructor(e){var t,n;super({...e,id:e.id||(0,p.L)("webgl-device")}),this.renderPass=null,this.debug=!1,this._canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1},this._extensions={},this._polyfilled=!1;const i=null==(t=e.gl)?void 0:t.device;if(i)throw new Error("WebGL context already attached to device "+i.id);const r=(null==(n=e.gl)?void 0:n.canvas)||e.canvas;this.canvasContext=new Rt(this,{...e,canvas:r}),this.lost=new Promise((e=>{this._resolveContextLost=e}));let s=e.gl||null;if(s||(s=function(e,t){t={...oe,...t};let n=null;const i=e=>n=e.statusMessage||n;e.addEventListener("webglcontextcreationerror",i,!1);let r=null;if(r||(r=e.getContext("webgl2",t)),e.removeEventListener("webglcontextcreationerror",i,!1),!r)throw new Error("Failed to create WebGL context: "+(n||"Unknown error"));if(t.onContextLost){const{onContextLost:n}=t;e.addEventListener("webglcontextlost",(e=>n(e)),!1)}if(t.onContextRestored){const{onContextRestored:n}=t;e.addEventListener("webglcontextrestored",(e=>n(e)),!1)}return r}(this.canvasContext.canvas,{...e,onContextLost:e=>{var t;return null==(t=this._resolveContextLost)?void 0:t.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,this.info=le(this.gl,this._extensions),this.features=new Ve(this.gl,this._extensions),this.limits=new Xe(this.gl),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=e;te(this.gl,{enable:o,copyState:a,log:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return h.R.log(1,...t)()}}),e.debug&&(this.gl=Ct(this.gl,{...e,throwOnError:!0}),this.debug=!0,h.R.level=Math.max(h.R.level,1),h.R.warn("WebGL debug mode activated. Performance reduced.")()),e.spector&&(this.spectorJS=function(e){var t,n,i,r;if(null==(t=e={...Tt,...e})||!t.spector)return null;if(!vt&&globalThis.SPECTOR&&(h.R.probe(1,"SPECTOR found and initialized")(),vt=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=vt)),!vt)return null;if(St||(St=!0,vt.spyCanvases(),null==(i=vt)||i.onCaptureStarted.add((e=>h.R.info("Spector capture started:",e)())),null==(r=vt)||r.onCapture.add((e=>{var t,n,i;h.R.info("Spector capture complete:",e)(),null==(t=vt)||t.getResultUI(),null==(n=vt)||n.resultView.display(),null==(i=vt)||i.resultView.addCapture(e)}))),null!=(n=e)&&n.canvas){var s,o;if("string"==typeof e.spector&&e.spector!==e.canvas.id)return vt;null==(s=vt)||s.startCapture(null==(o=e)?void 0:o.canvas,500),new Promise((e=>setTimeout(e,2e3))).then((e=>{var t;h.R.info("Spector capture stopped after 2 seconds")(),null==(t=vt)||t.stopCapture()}))}return vt}({...this.props,canvas:this.handle.canvas}))}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(e){return Me(this.gl,e,this._extensions)}isTextureFormatFilterable(e){return function(e,t,n){const i=xe(t);if(!Me(e,i,n))return!1;try{if(R(i).signed)return!1}catch{return!1}return i.endsWith("32float")?Boolean(ae(e,"OES_texture_float_linear, extensions",n)):!i.endsWith("16float")||Boolean(ae(e,"OES_texture_half_float_linear, extensions",n))}(this.gl,e,this._extensions)}isTextureFormatRenderable(e){return function(e,t,n){const i=xe(t);return!!Me(e,i,n)&&"number"!=typeof i}(this.gl,e,this._extensions)}createCanvasContext(e){throw new Error("WebGL only supports a single canvas")}createBuffer(e){const t=this._getBufferProps(e);return new ot(this,t)}_createTexture(e){return new ft(this,e)}createExternalTexture(e){throw new Error("createExternalTexture() not implemented")}createSampler(e){return new ut(this,e)}createShader(e){return new Pt(this,e)}createFramebuffer(e){return new At(this,e)}createVertexArray(e){return new Rn(this,e)}createTransformFeedback(e){return new vn(this,e)}createQuerySet(e){return new Cn(this,e)}createRenderPipeline(e){return new $t(this,e)}beginRenderPass(e){return new xt(this,e)}createComputePipeline(e){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw new Error("ComputePass not supported in WebGL")}getDefaultRenderPass(){return this.renderPass=this.renderPass||this.beginRenderPass({framebuffer:this.canvasContext.getCurrentFramebuffer()}),this.renderPass}createCommandEncoder(e){return new _n(this,e)}submit(){var e;null==(e=this.renderPass)||e.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return Nn(e,t)}readPixelsToBufferWebGL(e,t){return In(e,t)}setParametersWebGL(e){Q(this,e)}getParametersWebGL(e){return Z(this,e)}withParametersWebGL(e,t){Qe(this,e,t)}clearWebGL(e){!function(e,t){const{framebuffer:n=null,color:i=null,depth:r=null,stencil:s=null}=t||{},o={};n&&(o.framebuffer=n);let a=0;i&&(a|=16384,!0!==i&&(o.clearColor=i)),r&&(a|=256,!0!==r&&(o.clearDepth=r)),s&&(a|=1024,!0!==r&&(o.clearStencil=r)),(0,y.v)(0!==a,Pn),Qe(e,o,(()=>{e.gl.clear(a)}))}(this,e)}loseDevice(){var e;let t=!1;const n=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return n&&(t=!0,n.loseContext()),null==(e=this._resolveContextLost)||e.call(this,{reason:"destroyed",message:"Application triggered context loss"}),t}pushState(){ne(this.gl)}popState(){ie(this.gl)}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){t=t||this.gl2||this.gl;const n=Number(e);for(const i in t)if(t[i]===n)return"GL."+i;return String(e)}setConstantAttributeWebGL(e,t){const n=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(n).fill(null);const i=this._constants[e];switch(i&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(i,t)&&h.R.info(1,"setConstantAttributeWebGL("+e+") could have been skipped, value unchanged")(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,n){switch(n.length){case 1:e.gl.vertexAttrib1fv(t,n);break;case 2:e.gl.vertexAttrib2fv(t,n);break;case 3:e.gl.vertexAttrib3fv(t,n);break;case 4:e.gl.vertexAttrib4fv(t,n);break;default:(0,y.v)(!1)}}(this,e,t);break;case Int32Array:!function(e,t,n){e.gl.vertexAttribI4iv(t,n)}(this,e,t);break;case Uint32Array:!function(e,t,n){e.gl.vertexAttribI4uiv(t,n)}(this,e,t);break;default:(0,y.v)(!1)}}getExtension(e){return ae(this.gl,e,this._extensions),this._extensions}}Fn.type="webgl";class On extends E.h{constructor(e,t){super(e,t),this.device=e,this.byteLength=function(e){var t;return e.byteLength||(null==(t=e.data)?void 0:t.byteLength)||0}(t);const n=Boolean(t.data),i=4*Math.ceil(this.byteLength/4);this.handle=this.props.handle||this.device.handle.createBuffer({size:i,usage:this.props.usage||GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,mappedAtCreation:this.props.mappedAtCreation||n,label:this.props.id}),t.data&&this._writeMapped(t.data),n&&!t.mappedAtCreation&&this.handle.unmap()}destroy(){this.handle.destroy()}write(e,t){void 0===t&&(t=0),this.device.handle.queue.writeBuffer(this.handle,t,e.buffer,e.byteOffset,e.byteLength)}async readAsync(e,t){void 0===e&&(e=0),void 0===t&&(t=this.byteLength);const n=new On(this.device,{usage:E.h.MAP_READ|E.h.COPY_DST,byteLength:t}),i=this.device.handle.createCommandEncoder();i.copyBufferToBuffer(this.handle,e,n.handle,0,t),this.device.handle.queue.submit([i.finish()]),await n.handle.mapAsync(GPUMapMode.READ,e,t);const r=n.handle.getMappedRange().slice(0);return n.handle.unmap(),n.destroy(),new Uint8Array(r)}_writeMapped(e){const t=this.handle.getMappedRange();new e.constructor(t).set(e)}mapAsync(e,t,n){return void 0===t&&(t=0),this.handle.mapAsync(e,t,n)}getMappedRange(e,t){return void 0===e&&(e=0),this.handle.getMappedRange(e,t)}unmap(){this.handle.unmap()}}function Mn(e){if(e.includes("webgl"))throw new Error("webgl-only format");return e}class xn extends ct{constructor(e,t){super(e,t),this.device=e;const n={...this.props};"comparison-sampler"!==n.type&&delete n.compare,this.handle=this.handle||this.device.handle.createSampler(n),this.handle.label=this.props.id}destroy(){}}class Dn extends ht{constructor(e,t){super(e,t),this.device=e,this.texture=t.texture,this.handle=this.handle||this.texture.handle.createView({format:t.format||this.texture.format,dimension:t.dimension||this.texture.dimension,aspect:t.aspect,baseMipLevel:t.baseMipLevel,mipLevelCount:t.mipLevelCount,baseArrayLayer:t.baseArrayLayer,arrayLayerCount:t.arrayLayerCount}),this.handle.label=this.props.id}destroy(){}}const Bn={"1d":"1d","2d":"2d","2d-array":"2d",cube:"2d","cube-array":"2d","3d":"3d"};class Un extends Ye{constructor(e,t){super(e,t),this.height=1,this.width=1,this.device=e,t.data instanceof Promise?t.data.then((e=>{this.props={...t,data:e},this.initialize(this.props)})):this.initialize(t)}initialize(e){var t;this.handle=this.props.handle||this.createHandle(),(t=this.handle).label||(t.label=this.id),this.props.data&&this.setData({data:this.props.data}),this.width=this.handle.width,this.height=this.handle.height,this.sampler=e.sampler instanceof xn?e.sampler:new xn(this.device,e.sampler),this.view=new Dn(this.device,{...this.props,texture:this})}createHandle(){var e,t;const n=this.props.width||(null==(e=this.props.data)?void 0:e.width)||1,i=this.props.height||(null==(t=this.props.data)?void 0:t.height)||1;return this.device.handle.createTexture({label:this.id,size:{width:n,height:i,depthOrArrayLayers:this.props.depth},dimension:Bn[this.props.dimension],format:Mn(this.props.format),usage:this.props.usage,mipLevelCount:this.props.mipLevels,sampleCount:this.props.samples})}destroy(){this.handle.destroy()}setSampler(e){return this.sampler=e instanceof xn?e:new xn(this.device,e),this}setData(e){return this.setImage({source:e.data})}setImage(e){const{source:t,width:n=e.source.width,height:i=e.source.height,depth:r=1,sourceX:s=0,sourceY:o=0,mipLevel:a=0,x:l=0,y:c=0,z:u=0,aspect:h="all",colorSpace:_="srgb",premultipliedAlpha:d=!1}=e;return this.device.handle.queue.copyExternalImageToTexture({source:t,origin:[s,o]},{texture:this.handle,origin:[l,c,u],mipLevel:a,aspect:h,colorSpace:_,premultipliedAlpha:d},[n,i,r]),{width:n,height:i}}createView(){return this.handle.createView({label:this.id})}}let Gn;Gn=Symbol.toStringTag;class kn extends We.F{get[Gn](){return"ExternalTexture"}constructor(e,t){super(e,t,kn.defaultProps)}}kn.defaultProps={...We.F.defaultProps,source:null,colorSpace:"srgb"};class Hn extends kn{constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.importExternalTexture({source:t.source,colorSpace:t.colorSpace}),this.sampler=null}destroy(){}setSampler(e){return this.sampler=e instanceof xn?e:new xn(this.device,e),this}}class Vn extends Lt.M{constructor(e,t){super(e,t),this.device=e,this.device.handle.pushErrorScope("validation"),this.handle=this.props.handle||this.createHandle(),this.handle.label=this.props.id,this._checkCompilationError(this.device.handle.popErrorScope())}async _checkCompilationError(e){const t=await e;if(t){this.debugShader();const e=await this.getCompilationInfo();throw h.R.error("Shader compilation error: "+t.message,e)(),new Error("Shader compilation error: "+t.message)}}destroy(){}async getCompilationInfo(){return(await this.handle.getCompilationInfo()).messages}createHandle(){const{source:e,stage:t}=this.props;let n=this.props.language;switch("auto"===n&&(n=e.includes("->")?"wgsl":"glsl"),n){case"wgsl":return this.device.handle.createShaderModule({code:e});case"glsl":return this.device.handle.createShaderModule({code:e,transform:e=>this.device.glslang.compileGLSL(e,t)});default:throw new Error(n)}}}function Xn(e){return e.depthStencil=e.depthStencil||{format:"depth24plus",stencilFront:{},stencilBack:{},depthWriteEnabled:!1,depthCompare:"less-equal"},e.depthStencil}const Wn={cullMode:(e,t,n)=>{n.primitive=n.primitive||{},n.primitive.cullMode=t},frontFace:(e,t,n)=>{n.primitive=n.primitive||{},n.primitive.frontFace=t},depthWriteEnabled:(e,t,n)=>{Xn(n).depthWriteEnabled=t},depthCompare:(e,t,n)=>{Xn(n).depthCompare=t},depthFormat:(e,t,n)=>{Xn(n).format=t},depthBias:(e,t,n)=>{Xn(n).depthBias=t},depthBiasSlopeScale:(e,t,n)=>{Xn(n).depthBiasSlopeScale=t},depthBiasClamp:(e,t,n)=>{Xn(n).depthBiasClamp=t},stencilReadMask:(e,t,n)=>{Xn(n).stencilReadMask=t},stencilWriteMask:(e,t,n)=>{Xn(n).stencilWriteMask=t},stencilCompare:(e,t,n)=>{const i=Xn(n);i.stencilFront.compare=t,i.stencilBack.compare=t},stencilPassOperation:(e,t,n)=>{const i=Xn(n);i.stencilFront.passOp=t,i.stencilBack.passOp=t},stencilFailOperation:(e,t,n)=>{const i=Xn(n);i.stencilFront.failOp=t,i.stencilBack.failOp=t},stencilDepthFailOperation:(e,t,n)=>{const i=Xn(n);i.stencilFront.depthFailOp=t,i.stencilBack.depthFailOp=t},sampleCount:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.count=t},sampleMask:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.mask=t},sampleAlphaToCoverageEnabled:(e,t,n)=>{n.multisample=n.multisample||{},n.multisample.alphaToCoverageEnabled=t},colorMask:(e,t,n)=>{Yn(n)[0].writeMask=t},blendColorOperation:(e,t,n)=>{Yn(n)}},Kn={primitive:{cullMode:"back",topology:"triangle-list"},vertex:{module:void 0,entryPoint:"main"},fragment:{module:void 0,entryPoint:"main",targets:[]},layout:"auto"};function zn(e,t){void 0===t&&(t={}),Object.assign(e,{...Kn,...e}),function(e,t){for(const[n,i]of Object.entries(t)){const t=Wn[n];if(!t)throw new Error("Illegal parameter "+n);t(n,i,e)}}(e,t)}function Yn(e){var t,n,i,r,s;if(e.fragment.targets=(null==(t=e.fragment)?void 0:t.targets)||[],!Array.isArray(null==(n=e.fragment)?void 0:n.targets))throw new Error("colorstate");0===(null==(i=e.fragment)||null==(i=i.targets)?void 0:i.length)&&(null==(s=e.fragment.targets)||s.push({}));return null==(r=e.fragment)?void 0:r.targets}function jn(e,t,n,i){const r=function(e,t){const n=[];for(const[i,r]of Object.entries(e)){const e=qn(t,i);e&&n.push(Qn(r,e.location))}return n}(i,n);return e.createBindGroup({layout:t,entries:r})}function qn(e,t){const n=e.bindings.find((e=>e.name===t||e.name+"uniforms"===t.toLocaleLowerCase()));return n||h.R.warn("Binding "+t+" not set: Not found in shader layout.")(),n}function Qn(e,t){if(e instanceof E.h)return{binding:t,resource:{buffer:e.handle}};if(e instanceof ct)return{binding:t,resource:e.handle};if(e instanceof Ye)return{binding:t,resource:e.handle.createView({label:"bind-group-auto-created"})};throw new Error("invalid binding")}var Zn=n(1970);function Jn(e){if(e.endsWith("-webgl"))throw new Error("WebGPU does not support vertex format "+e);return e}function $n(e,t){const n=[],i=new Set;for(const r of t){const t=[];let s="vertex",o=0;if(r.attributes)for(const n of r.attributes){const a=ei(e,n.attribute,i);s=a.stepMode||(a.name.startsWith("instance")?"instance":"vertex"),t.push({format:Jn(n.format||r.format),offset:n.byteOffset,shaderLocation:a.location}),o+=(0,Zn.w)(r.format).byteLength}else{const n=ei(e,r.name,i);if(!n)continue;o=(0,Zn.w)(r.format).byteLength,s=n.stepMode||(n.name.startsWith("instance")?"instance":"vertex"),t.push({format:Jn(r.format),offset:0,shaderLocation:n.location})}n.push({arrayStride:r.byteStride||o,stepMode:s,attributes:t})}for(const r of e.attributes)i.has(r.name)||n.push({arrayStride:(0,Zn.w)("float32x3").byteLength,stepMode:r.stepMode||(r.name.startsWith("instance")?"instance":"vertex"),attributes:[{format:Jn("float32x3"),offset:0,shaderLocation:r.location}]});return n}function ei(e,t,n){const i=e.attributes.find((e=>e.name===t));if(!i)return h.R.warn("Unknown attribute "+t)(),null;if(n.has(t))throw new Error("Duplicate attribute "+t);return n.add(t),i}class ti extends Dt.r{constructor(e,t){if(super(e,t),this.fs=null,this._bindGroupLayout=null,this._bindGroup=null,this.device=e,this.handle=this.props.handle,!this.handle){const e=this._getRenderPipelineDescriptor();h.R.groupCollapsed(1,"new WebGPURenderPipeline("+this.id+")")(),h.R.probe(1,JSON.stringify(e,null,2))(),h.R.groupEnd(1)(),this.handle=this.device.handle.createRenderPipeline(e)}this.handle.label=this.props.id,this.vs=t.vs,this.fs=t.fs}destroy(){}setBindings(e){Object.assign(this.props.bindings,e)}draw(e){const t=e.renderPass||this.device.getDefaultRenderPass();t.handle.setPipeline(this.handle);const n=this._getBindGroup();n&&t.handle.setBindGroup(0,n),e.vertexArray.bindBeforeRender(e.renderPass),e.indexCount?t.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):t.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstInstance),e.vertexArray.unbindAfterRender(e.renderPass)}_getBindGroup(){return this._bindGroupLayout=this._bindGroupLayout||this.handle.getBindGroupLayout(0),this._bindGroup=this._bindGroup||jn(this.device.handle,this._bindGroupLayout,this.props.shaderLayout,this.props.bindings),this._bindGroup}_getRenderPipelineDescriptor(){const e={module:this.props.vs.handle,entryPoint:this.props.vsEntryPoint||"main",buffers:$n(this.props.shaderLayout,this.props.bufferLayout)};let t;var n;this.props.fs&&(t={module:this.props.fs.handle,entryPoint:this.props.fsEntryPoint||"main",targets:[{format:Mn(null==(n=this.device)||null==(n=n.canvasContext)?void 0:n.format)}]});switch(this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":throw new Error("WebGPU does not support primitive topology "+this.props.topology)}const i={vertex:e,fragment:t,primitive:{topology:this.props.topology},layout:"auto"};return zn(i,this.props.parameters),i}}let ni,ii;ni=Symbol.toStringTag;class ri extends We.F{get[ni](){return"ComputePipeline"}constructor(e,t){super(e,t,ri.defaultProps),this.hash=""}}ri.defaultProps={...We.F.defaultProps,cs:void 0,csEntryPoint:void 0,csConstants:{},shaderLayout:[]};class si extends ri{constructor(e,t){super(e,t),this.device=e;const n=this.props.cs;this.handle=this.props.handle||this.device.handle.createComputePipeline({label:this.props.id,compute:{module:n.handle,entryPoint:this.props.csEntryPoint},layout:"auto"})}_getBindGroupLayout(){return this.handle.getBindGroupLayout(0)}}class oi extends Ot{constructor(e,t){void 0===t&&(t={}),super(e,t),this.pipeline=null,this.device=e;const n=t.framebuffer||e.canvasContext.getCurrentFramebuffer(),i=this.getRenderPassDescriptor(n),r=t.timestampQuerySet;if(r&&(i.occlusionQuerySet=r.handle),e.features.has("timestamp-query")){const e=t.timestampQuerySet;i.timestampWrites=e?{querySet:e.handle,beginningOfPassWriteIndex:t.beginTimestampIndex,endOfPassWriteIndex:t.endTimestampIndex}:void 0}this.handle=this.props.handle||e.commandEncoder.beginRenderPass(i),this.handle.label=this.props.id,h.R.groupCollapsed(3,"new WebGPURenderPass("+this.id+")")(),h.R.probe(3,JSON.stringify(i,null,2))(),h.R.groupEnd(3)()}destroy(){}end(){this.handle.end()}setPipeline(e){this.pipeline=e,this.handle.setPipeline(this.pipeline.handle)}setBindings(e){var t,n;null==(t=this.pipeline)||t.setBindings(e);const i=null==(n=this.pipeline)?void 0:n._getBindGroup();i&&this.handle.setBindGroup(0,i)}setIndexBuffer(e,t,n,i){void 0===n&&(n=0),this.handle.setIndexBuffer(e.handle,t,n,i)}setVertexBuffer(e,t,n){void 0===n&&(n=0),this.handle.setVertexBuffer(e,t.handle,n)}draw(e){e.indexCount?this.handle.drawIndexed(e.indexCount,e.instanceCount,e.firstIndex,e.baseVertex,e.firstInstance):this.handle.draw(e.vertexCount||0,e.instanceCount||1,e.firstIndex,e.firstInstance)}drawIndirect(){}setParameters(e){const{blendConstant:t,stencilReference:n,scissorRect:i,viewport:r}=e;t&&this.handle.setBlendConstant(t),n&&this.handle.setStencilReference(n),i&&this.handle.setScissorRect(i[0],i[1],i[2],i[3]),r&&this.handle.setViewport(r[0],r[1],r[2],r[3],r[4],r[5])}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}beginOcclusionQuery(e){this.handle.beginOcclusionQuery(e)}endOcclusionQuery(){this.handle.endOcclusionQuery()}getRenderPassDescriptor(e){const t={colorAttachments:[]};if(t.colorAttachments=e.colorAttachments.map((e=>({loadOp:!1!==this.props.clearColor?"clear":"load",colorClearValue:this.props.clearColor||[0,0,0,0],storeOp:this.props.discard?"discard":"store",view:e.handle}))),e.depthStencilAttachment){t.depthStencilAttachment={view:e.depthStencilAttachment.handle};const{depthStencilAttachment:n}=t;this.props.depthReadOnly&&(n.depthReadOnly=!0),n.depthClearValue=this.props.clearDepth||0;!0&&(n.depthLoadOp=!1!==this.props.clearDepth?"clear":"load",n.depthStoreOp="store");!1&&(n.stencilLoadOp=!1!==this.props.clearStencil?"clear":"load",n.stencilStoreOp="store")}return t}}ii=Symbol.toStringTag;class ai extends We.F{get[ii](){return"ComputePass"}constructor(e,t){super(e,t,ai.defaultProps)}}ai.defaultProps={...We.F.defaultProps,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};class li extends ai{constructor(e,t){var n;let i;if(super(e,t),this._bindGroupLayout=null,this.device=e,e.features.has("timestamp-query")){const e=t.timestampQuerySet;e&&(i={querySet:e.handle,beginningOfPassWriteIndex:t.beginTimestampIndex,endOfPassWriteIndex:t.endTimestampIndex})}this.handle=this.props.handle||(null==(n=e.commandEncoder)?void 0:n.beginComputePass({label:this.props.id,timestampWrites:i}))}destroy(){}end(){this.handle.end()}setPipeline(e){const t=e;this.handle.setPipeline(t.handle),this._bindGroupLayout=t._getBindGroupLayout()}setBindings(e){throw new Error("fix me")}dispatch(e,t,n){this.handle.dispatchWorkgroups(e,t,n)}dispatchIndirect(e,t){void 0===t&&(t=0);const n=e;this.handle.dispatchWorkgroupsIndirect(n.handle,t)}pushDebugGroup(e){this.handle.pushDebugGroup(e)}popDebugGroup(){this.handle.popDebugGroup()}insertDebugMarker(e){this.handle.insertDebugMarker(e)}}class ci extends dn{get[Symbol.toStringTag](){return"WebGPUVertexArray"}constructor(e,t){super(e,t),this.device=e}destroy(){}setIndexBuffer(e){this.indexBuffer=e}setBuffer(e,t){this.attributes[e]=t}bindBeforeRender(e,t,n){const i=e,r=this.indexBuffer;null!=r&&r.handle&&(h.R.warn("setting index buffer",null==r?void 0:r.handle,null==r?void 0:r.indexType)(),i.handle.setIndexBuffer(null==r?void 0:r.handle,null==r?void 0:r.indexType));for(let s=0;s<this.maxVertexAttributes;s++){const e=this.attributes[s];null!=e&&e.handle&&(h.R.warn("setting vertex buffer "+s,null==e?void 0:e.handle)(),i.handle.setVertexBuffer(s,null==e?void 0:e.handle))}}unbindAfterRender(e){}static isConstantAttributeZeroSupported(e){return"Chrome"===(0,pn.A)()}}class ui extends je{constructor(e,t){super(e,t),this.device=e,this.autoCreateAttachmentTextures()}}class hi extends F{constructor(e,t,n){super(n),this.format=navigator.gpu.getPreferredCanvasFormat(),this.depthStencilFormat="depth24plus",this.depthStencilAttachment=null,this.device=e,this.width=-1,this.height=-1,this._setAutoCreatedCanvasId(this.device.id+"-canvas"),this.gpuCanvasContext=this.canvas.getContext("webgpu"),this.format="bgra8unorm"}destroy(){this.gpuCanvasContext.unconfigure()}getCurrentFramebuffer(){this.update();const e=this.getCurrentTexture();return this.width=e.width,this.height=e.height,this._createDepthStencilAttachment(),new ui(this.device,{colorAttachments:[e],depthStencilAttachment:this.depthStencilAttachment})}update(){const[e,t]=this.getPixelSize();(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.depthStencilAttachment&&(this.depthStencilAttachment.destroy(),this.depthStencilAttachment=null),this.gpuCanvasContext.configure({device:this.device.handle,format:Mn(this.format),colorSpace:this.props.colorSpace,alphaMode:this.props.alphaMode}),h.R.log(1,"Resized to "+this.width+"x"+this.height+"px")())}resize(e){this.update()}getCurrentTexture(){return this.device._createTexture({id:this.id+"#color-texture",handle:this.gpuCanvasContext.getCurrentTexture()})}_createDepthStencilAttachment(){return this.depthStencilAttachment||(this.depthStencilAttachment=this.device.createTexture({id:this.id+"#depth-stencil-texture",format:this.depthStencilFormat,width:this.width,height:this.height,usage:GPUTextureUsage.RENDER_ATTACHMENT})),this.depthStencilAttachment}}class _i extends bn{constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.handle.createQuerySet({type:this.props.type,count:this.props.count}),this.handle.label=this.props.id}destroy(){this.handle.destroy()}}class di extends C{static isSupported(){return Boolean("undefined"!=typeof navigator&&navigator.gpu)}static async create(e){if(!navigator.gpu)throw new Error("WebGPU not available. Open in Chrome Canary and turn on chrome://flags/#enable-unsafe-webgpu");h.R.groupCollapsed(1,"WebGPUDevice created")();const t=await navigator.gpu.requestAdapter({powerPreference:"high-performance"});if(!t)throw new Error("Failed to request WebGPU adapter");const n=await t.requestAdapterInfo();h.R.probe(2,"Adapter available",n)();const i=[],r={};if(e.requestMaximalLimits){i.push(...Array.from(t.features));for(const e in t.limits)r[e]=t.limits[e];delete r.minSubgroupSize,delete r.maxSubgroupSize}const s=await t.requestDevice({requiredFeatures:i,requiredLimits:r});h.R.probe(1,"GPUDevice available")(),"string"==typeof e.canvas&&(await F.pageLoaded,h.R.probe(1,"DOM is loaded")());const o=new di(s,t,n,e);return h.R.probe(1,"Device created. For more info, set chrome://flags/#enable-webgpu-developer-features")(),h.R.table(1,o.info)(),h.R.groupEnd(1)(),o}constructor(e,t,n,i){super({...i,id:i.id||(0,p.L)("webgpu-device")}),this.canvasContext=null,this._isLost=!1,this.commandEncoder=null,this.renderPass=null,this.handle=e,this.adapter=t,this.adapterInfo=n,this.info=this._getInfo(),this.features=this._getFeatures(),this.limits=this.handle.limits,this.lost=new Promise((async e=>{const t=await this.handle.lost;this._isLost=!0,e({reason:"destroyed",message:t.message})})),this.canvasContext=new hi(this,this.adapter,{canvas:i.canvas,height:i.height,width:i.width,container:i.container})}destroy(){this.handle.destroy()}isTextureFormatSupported(e){return!e.includes("webgl")}isTextureFormatFilterable(e){return this.isTextureFormatSupported(e)}isTextureFormatRenderable(e){return this.isTextureFormatSupported(e)}get isLost(){return this._isLost}createBuffer(e){const t=this._getBufferProps(e);return new On(this,t)}_createTexture(e){return new Un(this,e)}createExternalTexture(e){return new Hn(this,e)}createShader(e){return new Vn(this,e)}createSampler(e){return new xn(this,e)}createRenderPipeline(e){return new ti(this,e)}createFramebuffer(e){throw new Error("Not implemented")}createComputePipeline(e){return new si(this,e)}createVertexArray(e){return new ci(this,e)}beginRenderPass(e){return this.commandEncoder=this.commandEncoder||this.handle.createCommandEncoder(),new oi(this,e)}beginComputePass(e){return this.commandEncoder=this.commandEncoder||this.handle.createCommandEncoder(),new li(this,e)}createTransformFeedback(e){throw new Error("Transform feedback not supported in WebGPU")}createQuerySet(e){return new _i(this,e)}createCanvasContext(e){return new hi(this,this.adapter,e)}getDefaultRenderPass(){throw new Error("a")}submit(){var e;const t=null==(e=this.commandEncoder)?void 0:e.finish();t&&this.handle.queue.submit([t]),this.commandEncoder=null}_getInfo(){const[e,t]=(this.adapterInfo.driver||"").split(" Version "),n=this.adapterInfo.vendor||this.adapter.__brand||"unknown",i=e||"",r=t||"",s="apple"===n?"apple":"unknown",o=this.adapterInfo.architecture||"unknown",a=this.adapterInfo.backend||"unknown";return{type:"webgpu",vendor:n,renderer:i,version:r,gpu:s,gpuType:(this.adapterInfo.type||"").split(" ")[0].toLowerCase()||"unknown",gpuBackend:a,gpuArchitecture:o,shadingLanguage:"wgsl",shadingLanguageVersion:100}}_getFeatures(){const e=new Set(this.handle.features);e.has("depth-clamping")&&(e.delete("depth-clamping"),e.add("depth-clip-control")),e.has("texture-compression-bc")&&e.add("texture-compression-bc5-webgl");const t=["timer-query-webgl","compilation-status-async-webgl","float32-renderable-webgl","float16-renderable-webgl","norm16-renderable-webgl","texture-filterable-anisotropic-webgl","shader-noperspective-interpolation-webgl"];for(const n of t)e.add(n);return new b(Array.from(e))}copyExternalImageToTexture(e){var t;const{source:n,sourceX:i=0,sourceY:r=0,texture:s,mipLevel:o=0,aspect:a="all",colorSpace:l="display-p3",premultipliedAlpha:c=!1,width:u=s.width,height:h=s.height,depth:_=1}=e,d=s;null==(t=this.handle)||t.queue.copyExternalImageToTexture({source:n,origin:[i,r]},{texture:d.handle,origin:[0,0,0],mipLevel:o,aspect:a,colorSpace:l,premultipliedAlpha:c},[u,h,_])}}di.type="webgpu",I.registerDevices([Fn,di]);let fi,pi={};const Ei=(0,c.vt)((e=>({deviceType:void 0,deviceError:void 0,device:void 0,setDeviceType:async t=>{let n,i;try{i=await async function(e){return pi[e]=pi[e]||I.createDevice({type:e,height:0,container:(fi||(fi=document.createElement("div"),fi.style.display="none",document.body.appendChild(fi)),fi)}),await pi[e]}(t)}catch(r){n=r.message}return e((e=>({deviceType:t,deviceError:n,device:i})))}})));Ei.getState().setDeviceType("webgl");var gi,mi,Ai=n(6065);function Ri(e,t){return t||(t=e.slice(0)),e.raw=t,e}const Ti=Ai.Ay.div(gi||(gi=Ri(["\n  display: flex;\n  flex-direction: row;\n\n  & > * + * {\n    margin-left: 2px;\n  }\n"]))),vi=Ai.Ay.div((e=>"\n  cursor: pointer;\n  padding: 10px 20px;\n  font-weight: bold;\n  &:hover {\n    background-color: #eeefef;\n  }\n  "+(e.isSelected?"\n    color: #276EF1;\n    border-bottom: 4px solid #276EF1;\n  ":"")+"\n")),Si=Ai.Ay.div(mi||(mi=Ri(["\n  background-color: rgb(250, 248, 245);\n"]))),bi=e=>{var t,n;const{children:r}=e,s=i.Children.toArray(r),[o,a]=(0,i.useState)((null==(t=s[0])?void 0:t.props.tag)||(null==(n=s[0])?void 0:n.props.title));let l=void 0!==e.selectedItem?e.selectedItem:o;const c=void 0!==e.setSelectedItem?e.setSelectedItem:a;return s.some((e=>(e.props.tag||e.props.title)===l))||(l=o),i.createElement(i.Fragment,null,i.createElement(Ti,null,s.map((e=>i.createElement(vi,{key:e.props.title,isSelected:(e.props.tag||e.props.title)===l,onClick:()=>c(e.props.tag||e.props.title)},e.props.title)))),i.createElement(Si,null,s.find((e=>(e.props.tag||e.props.title)===l))))},Ci=e=>{const{children:t}=e;return i.createElement(i.Fragment,null,t)};var yi=n(9813);const Ni=e=>{const t=Ei((e=>e.deviceType)),n=Ei((e=>e.deviceError)),r=Ei((e=>e.setDeviceType));return i.createElement(bi,{selectedItem:t,setSelectedItem:r},i.createElement(Ci,{key:"WebGL2",title:"WebGL2",tag:"webgl"},n),i.createElement(Ci,{key:"WebGPU",title:"WebGPU",tag:"webgpu"},n))},Ii=()=>i.createElement(yi.A,null,(()=>i.createElement(Ni,null)));const Li=e=>{let{f:t}=e;const n=Ei((e=>e.device)),r=n?n.info[t]:"N/A";return i.createElement("code",{style:{color:"darkgreen"}},r)},wi=e=>{let{f:t}=e;const n=Ei((e=>e.device));return i.createElement("code",{style:{color:"darkgreen"}},function(e,t){return e?e.limits[t]?String(e.limits[t]):"0 \u274c":"N/A"}(n,t))},Pi=e=>{let{f:t}=e;const n=Ei((e=>e.device));return i.createElement("span",null,function(e,t){return e?e.features.has(t)?"\u2705":"\u274c":"N/A"}(n,t))},Fi=e=>{let{f:t}=e;const n=Ei((e=>e.device));return i.createElement("span",{key:t},function(e,t){const n=e&&e.isTextureFormatSupported(t);return e?n?"\u2705":"\u274c":"N/A"}(n,t))},Oi=e=>{let{f:t}=e;const n=Ei((e=>e.device));return i.createElement("span",null,function(e,t){const n=e&&e.isTextureFormatSupported(t)&&e.isTextureFormatFilterable(t);return e?n?"\u2705":"\u274c":"N/A"}(n,t))},Mi=e=>{let{f:t}=e;const n=Ei((e=>e.device)),i=t,r=n&&n.isTextureFormatSupported(i)&&n.isTextureFormatRenderable(i);return n?r?"\u2705":"\u274c":"N/A"};let xi=0;const Di={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:I.stats.get("animation-loop-"+xi++),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class Bi{constructor(e){if(this.device=null,this.canvas=null,this.animationProps=null,this.timeline=null,this.needsRedraw="initialized",this._initialized=!1,this._running=!1,this._animationFrameId=null,this._nextFramePromise=null,this._resolveNextFrame=null,this._cpuStartTime=0,this.props={...Di,...e},!(e=this.props).device)throw new Error("No device provided");const{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new _.A({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const t=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(t),t}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return null!=(e=this.device)&&e.isLost||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise((e=>{this._resolveNextFrame=e}))),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:null==(e=this.device)||null==(e=e.canvasContext)?void 0:e.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:t,aspect:n}=this._getSizeAndAspect();e===this.animationProps.width&&t===this.animationProps.height||this.setNeedsRedraw("drawing buffer resized"),n!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=n,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=(null==(e=this.device.canvasContext)?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);const n=this.props.onAddHTML(t);n&&(t.innerHTML=n)}}_getSizeAndAspect(){var e,t;if(!this.device)return{width:1,height:1,aspect:1};const[n,i]=(null==(e=this.device)||null==(e=e.canvasContext)?void 0:e.getPixelSize())||[1,1];let r=1;const s=null==(t=this.device)||null==(t=t.canvasContext)?void 0:t.canvas;return s&&s.clientHeight?r=s.clientWidth/s.clientHeight:n>0&&i>0&&(r=n/i),{width:n,height:i,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e;this.props.autoResizeDrawingBuffer&&(null==(e=this.device)||null==(e=e.canvasContext)||e.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}"undefined"!=typeof window&&(window.website=!0);const Ui=e=>{let t="ssr";const[n,r]=(0,i.useState)(null),s=(0,i.useRef)(new WeakMap),o=(0,i.useRef)(null),a=Ei((e=>e.deviceType));return t=e.container||"luma-example-container-"+a,(0,i.useEffect)((()=>{if(!n||s.current.get(n))return;s.current.set(n,!0);let i=null,r=null;const l=async()=>{var s;n.style.width="100%",n.style.height="100%",r=await I.createDevice({type:a,canvas:n,container:t}),i=function(e,t){let n=null;const i=(null==t?void 0:t.device)||I.createDevice(),r=new Bi({...t,device:i,async onInitialize(t){var i;return n=new e(t),await(null==(i=n)?void 0:i.onInitialize(t))},onRender:e=>{var t;return null==(t=n)?void 0:t.onRender(e)},onFinalize:e=>{var t;return null==(t=n)?void 0:t.onFinalize(e)}});return r.getInfo=()=>this.AnimationLoopTemplateCtor.info,r}(e.template,{device:r,autoResizeViewport:!0,autoResizeDrawingBuffer:!0}),null==(s=i)||s.start();const o="https://raw.githubusercontent.com/visgl/luma.gl/master";e.directory?(0,qe.Qj)(o+"/examples/"+e.directory+"/"+e.id+"/"):(0,qe.Qj)(o+"/website/static/images/")};return o.current=Promise.resolve(o.current).then((()=>{l().catch((e=>{console.error("start "+a+" failed",e)}))})),()=>{o.current=Promise.resolve(o.current).then((()=>{i&&(i.destroy(),i=null),r&&r.destroy()})).catch((e=>{console.error("unmounting "+a+" failed",e)}))}}),[a,n]),i.createElement("canvas",{key:a,ref:r})}}}]);