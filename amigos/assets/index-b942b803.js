var CS=Object.defineProperty;var PS=(t,e,n)=>e in t?CS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var T=(t,e,n)=>(PS(t,typeof e!="symbol"?e+"":e,n),n);function xS(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var dU=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bd(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var d0={exports:{}},G={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xo=Symbol.for("react.element"),MS=Symbol.for("react.portal"),IS=Symbol.for("react.fragment"),OS=Symbol.for("react.strict_mode"),NS=Symbol.for("react.profiler"),kS=Symbol.for("react.provider"),FS=Symbol.for("react.context"),DS=Symbol.for("react.forward_ref"),BS=Symbol.for("react.suspense"),US=Symbol.for("react.memo"),LS=Symbol.for("react.lazy"),mg=Symbol.iterator;function zS(t){return t===null||typeof t!="object"?null:(t=mg&&t[mg]||t["@@iterator"],typeof t=="function"?t:null)}var p0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g0=Object.assign,_0={};function Gi(t,e,n){this.props=t,this.context=e,this.refs=_0,this.updater=n||p0}Gi.prototype.isReactComponent={};Gi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Gi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function m0(){}m0.prototype=Gi.prototype;function Cd(t,e,n){this.props=t,this.context=e,this.refs=_0,this.updater=n||p0}var Pd=Cd.prototype=new m0;Pd.constructor=Cd;g0(Pd,Gi.prototype);Pd.isPureReactComponent=!0;var yg=Array.isArray,y0=Object.prototype.hasOwnProperty,xd={current:null},v0={key:!0,ref:!0,__self:!0,__source:!0};function T0(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)y0.call(e,r)&&!v0.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:xo,type:t,key:s,ref:o,props:i,_owner:xd.current}}function VS(t,e){return{$$typeof:xo,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Md(t){return typeof t=="object"&&t!==null&&t.$$typeof===xo}function jS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var vg=/\/+/g;function yu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?jS(""+t.key):e.toString(36)}function Da(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case xo:case MS:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+yu(o,0):r,yg(i)?(n="",t!=null&&(n=t.replace(vg,"$&/")+"/"),Da(i,e,n,"",function(c){return c})):i!=null&&(Md(i)&&(i=VS(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(vg,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",yg(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+yu(s,a);o+=Da(s,e,n,l,i)}else if(l=zS(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+yu(s,a++),o+=Da(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ea(t,e,n){if(t==null)return t;var r=[],i=0;return Da(t,r,"","",function(s){return e.call(n,s,i++)}),r}function WS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ze={current:null},Ba={transition:null},HS={ReactCurrentDispatcher:Ze,ReactCurrentBatchConfig:Ba,ReactCurrentOwner:xd};G.Children={map:ea,forEach:function(t,e,n){ea(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ea(t,function(){e++}),e},toArray:function(t){return ea(t,function(e){return e})||[]},only:function(t){if(!Md(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};G.Component=Gi;G.Fragment=IS;G.Profiler=NS;G.PureComponent=Cd;G.StrictMode=OS;G.Suspense=BS;G.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HS;G.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=g0({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=xd.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)y0.call(e,l)&&!v0.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:xo,type:t.type,key:i,ref:s,props:r,_owner:o}};G.createContext=function(t){return t={$$typeof:FS,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:kS,_context:t},t.Consumer=t};G.createElement=T0;G.createFactory=function(t){var e=T0.bind(null,t);return e.type=t,e};G.createRef=function(){return{current:null}};G.forwardRef=function(t){return{$$typeof:DS,render:t}};G.isValidElement=Md;G.lazy=function(t){return{$$typeof:LS,_payload:{_status:-1,_result:t},_init:WS}};G.memo=function(t,e){return{$$typeof:US,type:t,compare:e===void 0?null:e}};G.startTransition=function(t){var e=Ba.transition;Ba.transition={};try{t()}finally{Ba.transition=e}};G.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};G.useCallback=function(t,e){return Ze.current.useCallback(t,e)};G.useContext=function(t){return Ze.current.useContext(t)};G.useDebugValue=function(){};G.useDeferredValue=function(t){return Ze.current.useDeferredValue(t)};G.useEffect=function(t,e){return Ze.current.useEffect(t,e)};G.useId=function(){return Ze.current.useId()};G.useImperativeHandle=function(t,e,n){return Ze.current.useImperativeHandle(t,e,n)};G.useInsertionEffect=function(t,e){return Ze.current.useInsertionEffect(t,e)};G.useLayoutEffect=function(t,e){return Ze.current.useLayoutEffect(t,e)};G.useMemo=function(t,e){return Ze.current.useMemo(t,e)};G.useReducer=function(t,e,n){return Ze.current.useReducer(t,e,n)};G.useRef=function(t){return Ze.current.useRef(t)};G.useState=function(t){return Ze.current.useState(t)};G.useSyncExternalStore=function(t,e,n){return Ze.current.useSyncExternalStore(t,e,n)};G.useTransition=function(){return Ze.current.useTransition()};G.version="18.2.0";d0.exports=G;var V=d0.exports;const In=bd(V);var w0={exports:{}},dt={},E0={exports:{}},S0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(W,Y){var q=W.length;W.push(Y);e:for(;0<q;){var K=q-1>>>1,J=W[K];if(0<i(J,Y))W[K]=Y,W[q]=J,q=K;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var Y=W[0],q=W.pop();if(q!==Y){W[0]=q;e:for(var K=0,J=W.length,he=J>>>1;K<he;){var Le=2*(K+1)-1,Rt=W[Le],rn=Le+1,Ee=W[rn];if(0>i(Rt,q))rn<J&&0>i(Ee,Rt)?(W[K]=Ee,W[rn]=q,K=rn):(W[K]=Rt,W[Le]=q,K=Le);else if(rn<J&&0>i(Ee,q))W[K]=Ee,W[rn]=q,K=rn;else break e}}return Y}function i(W,Y){var q=W.sortIndex-Y.sortIndex;return q!==0?q:W.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,h=null,f=3,d=!1,_=!1,v=!1,A=typeof setTimeout=="function"?setTimeout:null,p=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function m(W){for(var Y=n(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=W)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=n(c)}}function E(W){if(v=!1,m(W),!_)if(n(l)!==null)_=!0,Je(b);else{var Y=n(c);Y!==null&&Ue(E,Y.startTime-W)}}function b(W,Y){_=!1,v&&(v=!1,p(M),M=-1),d=!0;var q=f;try{for(m(Y),h=n(l);h!==null&&(!(h.expirationTime>Y)||W&&!z());){var K=h.callback;if(typeof K=="function"){h.callback=null,f=h.priorityLevel;var J=K(h.expirationTime<=Y);Y=t.unstable_now(),typeof J=="function"?h.callback=J:h===n(l)&&r(l),m(Y)}else r(l);h=n(l)}if(h!==null)var he=!0;else{var Le=n(c);Le!==null&&Ue(E,Le.startTime-Y),he=!1}return he}finally{h=null,f=q,d=!1}}var x=!1,O=null,M=-1,N=5,k=-1;function z(){return!(t.unstable_now()-k<N)}function L(){if(O!==null){var W=t.unstable_now();k=W;var Y=!0;try{Y=O(!0,W)}finally{Y?j():(x=!1,O=null)}}else x=!1}var j;if(typeof g=="function")j=function(){g(L)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,Z=X.port2;X.port1.onmessage=L,j=function(){Z.postMessage(null)}}else j=function(){A(L,0)};function Je(W){O=W,x||(x=!0,j())}function Ue(W,Y){M=A(function(){W(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_continueExecution=function(){_||d||(_=!0,Je(b))},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return f},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(W){switch(f){case 1:case 2:case 3:var Y=3;break;default:Y=f}var q=f;f=Y;try{return W()}finally{f=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(W,Y){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var q=f;f=W;try{return Y()}finally{f=q}},t.unstable_scheduleCallback=function(W,Y,q){var K=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?K+q:K):q=K,W){case 1:var J=-1;break;case 2:J=250;break;case 5:J=1073741823;break;case 4:J=1e4;break;default:J=5e3}return J=q+J,W={id:u++,callback:Y,priorityLevel:W,startTime:q,expirationTime:J,sortIndex:-1},q>K?(W.sortIndex=q,e(c,W),n(l)===null&&W===n(c)&&(v?(p(M),M=-1):v=!0,Ue(E,q-K))):(W.sortIndex=J,e(l,W),_||d||(_=!0,Je(b))),W},t.unstable_shouldYield=z,t.unstable_wrapCallback=function(W){var Y=f;return function(){var q=f;f=Y;try{return W.apply(this,arguments)}finally{f=q}}}})(S0);E0.exports=S0;var $S=E0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var A0=V,ft=$S;function B(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var R0=new Set,Js={};function zr(t,e){Ni(t,e),Ni(t+"Capture",e)}function Ni(t,e){for(Js[t]=e,t=0;t<e.length;t++)R0.add(e[t])}var mn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mh=Object.prototype.hasOwnProperty,XS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Tg={},wg={};function YS(t){return Mh.call(wg,t)?!0:Mh.call(Tg,t)?!1:XS.test(t)?wg[t]=!0:(Tg[t]=!0,!1)}function KS(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function qS(t,e,n,r){if(e===null||typeof e>"u"||KS(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Qe(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Be={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Be[t]=new Qe(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Be[e]=new Qe(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Be[t]=new Qe(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Be[t]=new Qe(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Be[t]=new Qe(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Be[t]=new Qe(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Be[t]=new Qe(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Be[t]=new Qe(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Be[t]=new Qe(t,5,!1,t.toLowerCase(),null,!1,!1)});var Id=/[\-:]([a-z])/g;function Od(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(Id,Od);Be[e]=new Qe(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(Id,Od);Be[e]=new Qe(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(Id,Od);Be[e]=new Qe(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Be[t]=new Qe(t,1,!1,t.toLowerCase(),null,!1,!1)});Be.xlinkHref=new Qe("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Be[t]=new Qe(t,1,!1,t.toLowerCase(),null,!0,!0)});function Nd(t,e,n,r){var i=Be.hasOwnProperty(e)?Be[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(qS(e,n,i,r)&&(n=null),r||i===null?YS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var An=A0.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,ta=Symbol.for("react.element"),ii=Symbol.for("react.portal"),si=Symbol.for("react.fragment"),kd=Symbol.for("react.strict_mode"),Ih=Symbol.for("react.profiler"),b0=Symbol.for("react.provider"),C0=Symbol.for("react.context"),Fd=Symbol.for("react.forward_ref"),Oh=Symbol.for("react.suspense"),Nh=Symbol.for("react.suspense_list"),Dd=Symbol.for("react.memo"),On=Symbol.for("react.lazy"),P0=Symbol.for("react.offscreen"),Eg=Symbol.iterator;function cs(t){return t===null||typeof t!="object"?null:(t=Eg&&t[Eg]||t["@@iterator"],typeof t=="function"?t:null)}var me=Object.assign,vu;function As(t){if(vu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);vu=e&&e[1]||""}return`
`+vu+t}var Tu=!1;function wu(t,e){if(!t||Tu)return"";Tu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{Tu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?As(t):""}function ZS(t){switch(t.tag){case 5:return As(t.type);case 16:return As("Lazy");case 13:return As("Suspense");case 19:return As("SuspenseList");case 0:case 2:case 15:return t=wu(t.type,!1),t;case 11:return t=wu(t.type.render,!1),t;case 1:return t=wu(t.type,!0),t;default:return""}}function kh(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case si:return"Fragment";case ii:return"Portal";case Ih:return"Profiler";case kd:return"StrictMode";case Oh:return"Suspense";case Nh:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case C0:return(t.displayName||"Context")+".Consumer";case b0:return(t._context.displayName||"Context")+".Provider";case Fd:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Dd:return e=t.displayName||null,e!==null?e:kh(t.type)||"Memo";case On:e=t._payload,t=t._init;try{return kh(t(e))}catch{}}return null}function QS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return kh(e);case 8:return e===kd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function x0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function JS(t){var e=x0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function na(t){t._valueTracker||(t._valueTracker=JS(t))}function M0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=x0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Ga(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Fh(t,e){var n=e.checked;return me({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Sg(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Gn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function I0(t,e){e=e.checked,e!=null&&Nd(t,"checked",e,!1)}function Dh(t,e){I0(t,e);var n=Gn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Bh(t,e.type,n):e.hasOwnProperty("defaultValue")&&Bh(t,e.type,Gn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Ag(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Bh(t,e,n){(e!=="number"||Ga(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Rs=Array.isArray;function Si(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Gn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Uh(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(B(91));return me({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Rg(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(B(92));if(Rs(n)){if(1<n.length)throw Error(B(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Gn(n)}}function O0(t,e){var n=Gn(e.value),r=Gn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function bg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function N0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Lh(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?N0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var ra,k0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(ra=ra||document.createElement("div"),ra.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ra.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Gs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var ks={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},GS=["Webkit","ms","Moz","O"];Object.keys(ks).forEach(function(t){GS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),ks[e]=ks[t]})});function F0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||ks.hasOwnProperty(t)&&ks[t]?(""+e).trim():e+"px"}function D0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=F0(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var e1=me({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zh(t,e){if(e){if(e1[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(B(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(B(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(B(61))}if(e.style!=null&&typeof e.style!="object")throw Error(B(62))}}function Vh(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jh=null;function Bd(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Wh=null,Ai=null,Ri=null;function Cg(t){if(t=Oo(t)){if(typeof Wh!="function")throw Error(B(280));var e=t.stateNode;e&&(e=Fc(e),Wh(t.stateNode,t.type,e))}}function B0(t){Ai?Ri?Ri.push(t):Ri=[t]:Ai=t}function U0(){if(Ai){var t=Ai,e=Ri;if(Ri=Ai=null,Cg(t),e)for(t=0;t<e.length;t++)Cg(e[t])}}function L0(t,e){return t(e)}function z0(){}var Eu=!1;function V0(t,e,n){if(Eu)return t(e,n);Eu=!0;try{return L0(t,e,n)}finally{Eu=!1,(Ai!==null||Ri!==null)&&(z0(),U0())}}function eo(t,e){var n=t.stateNode;if(n===null)return null;var r=Fc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(B(231,e,typeof n));return n}var Hh=!1;if(mn)try{var us={};Object.defineProperty(us,"passive",{get:function(){Hh=!0}}),window.addEventListener("test",us,us),window.removeEventListener("test",us,us)}catch{Hh=!1}function t1(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Fs=!1,el=null,tl=!1,$h=null,n1={onError:function(t){Fs=!0,el=t}};function r1(t,e,n,r,i,s,o,a,l){Fs=!1,el=null,t1.apply(n1,arguments)}function i1(t,e,n,r,i,s,o,a,l){if(r1.apply(this,arguments),Fs){if(Fs){var c=el;Fs=!1,el=null}else throw Error(B(198));tl||(tl=!0,$h=c)}}function Vr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function j0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Pg(t){if(Vr(t)!==t)throw Error(B(188))}function s1(t){var e=t.alternate;if(!e){if(e=Vr(t),e===null)throw Error(B(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Pg(i),t;if(s===r)return Pg(i),e;s=s.sibling}throw Error(B(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(B(189))}}if(n.alternate!==r)throw Error(B(190))}if(n.tag!==3)throw Error(B(188));return n.stateNode.current===n?t:e}function W0(t){return t=s1(t),t!==null?H0(t):null}function H0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=H0(t);if(e!==null)return e;t=t.sibling}return null}var $0=ft.unstable_scheduleCallback,xg=ft.unstable_cancelCallback,o1=ft.unstable_shouldYield,a1=ft.unstable_requestPaint,we=ft.unstable_now,l1=ft.unstable_getCurrentPriorityLevel,Ud=ft.unstable_ImmediatePriority,X0=ft.unstable_UserBlockingPriority,nl=ft.unstable_NormalPriority,c1=ft.unstable_LowPriority,Y0=ft.unstable_IdlePriority,Ic=null,Jt=null;function u1(t){if(Jt&&typeof Jt.onCommitFiberRoot=="function")try{Jt.onCommitFiberRoot(Ic,t,void 0,(t.current.flags&128)===128)}catch{}}var Nt=Math.clz32?Math.clz32:d1,h1=Math.log,f1=Math.LN2;function d1(t){return t>>>=0,t===0?32:31-(h1(t)/f1|0)|0}var ia=64,sa=4194304;function bs(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function rl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=bs(a):(s&=o,s!==0&&(r=bs(s)))}else o=n&~i,o!==0?r=bs(o):s!==0&&(r=bs(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Nt(e),i=1<<n,r|=t[n],e&=~i;return r}function p1(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function g1(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Nt(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=p1(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function Xh(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function K0(){var t=ia;return ia<<=1,!(ia&4194240)&&(ia=64),t}function Su(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Mo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Nt(e),t[e]=n}function _1(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Nt(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Ld(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Nt(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var re=0;function q0(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Z0,zd,Q0,J0,G0,Yh=!1,oa=[],Wn=null,Hn=null,$n=null,to=new Map,no=new Map,Fn=[],m1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mg(t,e){switch(t){case"focusin":case"focusout":Wn=null;break;case"dragenter":case"dragleave":Hn=null;break;case"mouseover":case"mouseout":$n=null;break;case"pointerover":case"pointerout":to.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":no.delete(e.pointerId)}}function hs(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Oo(e),e!==null&&zd(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function y1(t,e,n,r,i){switch(e){case"focusin":return Wn=hs(Wn,t,e,n,r,i),!0;case"dragenter":return Hn=hs(Hn,t,e,n,r,i),!0;case"mouseover":return $n=hs($n,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return to.set(s,hs(to.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,no.set(s,hs(no.get(s)||null,t,e,n,r,i)),!0}return!1}function ev(t){var e=_r(t.target);if(e!==null){var n=Vr(e);if(n!==null){if(e=n.tag,e===13){if(e=j0(n),e!==null){t.blockedOn=e,G0(t.priority,function(){Q0(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ua(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Kh(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);jh=r,n.target.dispatchEvent(r),jh=null}else return e=Oo(n),e!==null&&zd(e),t.blockedOn=n,!1;e.shift()}return!0}function Ig(t,e,n){Ua(t)&&n.delete(e)}function v1(){Yh=!1,Wn!==null&&Ua(Wn)&&(Wn=null),Hn!==null&&Ua(Hn)&&(Hn=null),$n!==null&&Ua($n)&&($n=null),to.forEach(Ig),no.forEach(Ig)}function fs(t,e){t.blockedOn===e&&(t.blockedOn=null,Yh||(Yh=!0,ft.unstable_scheduleCallback(ft.unstable_NormalPriority,v1)))}function ro(t){function e(i){return fs(i,t)}if(0<oa.length){fs(oa[0],t);for(var n=1;n<oa.length;n++){var r=oa[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Wn!==null&&fs(Wn,t),Hn!==null&&fs(Hn,t),$n!==null&&fs($n,t),to.forEach(e),no.forEach(e),n=0;n<Fn.length;n++)r=Fn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Fn.length&&(n=Fn[0],n.blockedOn===null);)ev(n),n.blockedOn===null&&Fn.shift()}var bi=An.ReactCurrentBatchConfig,il=!0;function T1(t,e,n,r){var i=re,s=bi.transition;bi.transition=null;try{re=1,Vd(t,e,n,r)}finally{re=i,bi.transition=s}}function w1(t,e,n,r){var i=re,s=bi.transition;bi.transition=null;try{re=4,Vd(t,e,n,r)}finally{re=i,bi.transition=s}}function Vd(t,e,n,r){if(il){var i=Kh(t,e,n,r);if(i===null)Nu(t,e,r,sl,n),Mg(t,r);else if(y1(i,t,e,n,r))r.stopPropagation();else if(Mg(t,r),e&4&&-1<m1.indexOf(t)){for(;i!==null;){var s=Oo(i);if(s!==null&&Z0(s),s=Kh(t,e,n,r),s===null&&Nu(t,e,r,sl,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Nu(t,e,r,null,n)}}var sl=null;function Kh(t,e,n,r){if(sl=null,t=Bd(r),t=_r(t),t!==null)if(e=Vr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=j0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return sl=t,null}function tv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(l1()){case Ud:return 1;case X0:return 4;case nl:case c1:return 16;case Y0:return 536870912;default:return 16}default:return 16}}var Bn=null,jd=null,La=null;function nv(){if(La)return La;var t,e=jd,n=e.length,r,i="value"in Bn?Bn.value:Bn.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return La=i.slice(t,1<r?1-r:void 0)}function za(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function aa(){return!0}function Og(){return!1}function pt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?aa:Og,this.isPropagationStopped=Og,this}return me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=aa)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=aa)},persist:function(){},isPersistent:aa}),e}var es={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wd=pt(es),Io=me({},es,{view:0,detail:0}),E1=pt(Io),Au,Ru,ds,Oc=me({},Io,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hd,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ds&&(ds&&t.type==="mousemove"?(Au=t.screenX-ds.screenX,Ru=t.screenY-ds.screenY):Ru=Au=0,ds=t),Au)},movementY:function(t){return"movementY"in t?t.movementY:Ru}}),Ng=pt(Oc),S1=me({},Oc,{dataTransfer:0}),A1=pt(S1),R1=me({},Io,{relatedTarget:0}),bu=pt(R1),b1=me({},es,{animationName:0,elapsedTime:0,pseudoElement:0}),C1=pt(b1),P1=me({},es,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),x1=pt(P1),M1=me({},es,{data:0}),kg=pt(M1),I1={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},O1={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},N1={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function k1(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=N1[t])?!!e[t]:!1}function Hd(){return k1}var F1=me({},Io,{key:function(t){if(t.key){var e=I1[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=za(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?O1[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hd,charCode:function(t){return t.type==="keypress"?za(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?za(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),D1=pt(F1),B1=me({},Oc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Fg=pt(B1),U1=me({},Io,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hd}),L1=pt(U1),z1=me({},es,{propertyName:0,elapsedTime:0,pseudoElement:0}),V1=pt(z1),j1=me({},Oc,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),W1=pt(j1),H1=[9,13,27,32],$d=mn&&"CompositionEvent"in window,Ds=null;mn&&"documentMode"in document&&(Ds=document.documentMode);var $1=mn&&"TextEvent"in window&&!Ds,rv=mn&&(!$d||Ds&&8<Ds&&11>=Ds),Dg=String.fromCharCode(32),Bg=!1;function iv(t,e){switch(t){case"keyup":return H1.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var oi=!1;function X1(t,e){switch(t){case"compositionend":return sv(e);case"keypress":return e.which!==32?null:(Bg=!0,Dg);case"textInput":return t=e.data,t===Dg&&Bg?null:t;default:return null}}function Y1(t,e){if(oi)return t==="compositionend"||!$d&&iv(t,e)?(t=nv(),La=jd=Bn=null,oi=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return rv&&e.locale!=="ko"?null:e.data;default:return null}}var K1={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ug(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!K1[t.type]:e==="textarea"}function ov(t,e,n,r){B0(r),e=ol(e,"onChange"),0<e.length&&(n=new Wd("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Bs=null,io=null;function q1(t){mv(t,0)}function Nc(t){var e=ci(t);if(M0(e))return t}function Z1(t,e){if(t==="change")return e}var av=!1;if(mn){var Cu;if(mn){var Pu="oninput"in document;if(!Pu){var Lg=document.createElement("div");Lg.setAttribute("oninput","return;"),Pu=typeof Lg.oninput=="function"}Cu=Pu}else Cu=!1;av=Cu&&(!document.documentMode||9<document.documentMode)}function zg(){Bs&&(Bs.detachEvent("onpropertychange",lv),io=Bs=null)}function lv(t){if(t.propertyName==="value"&&Nc(io)){var e=[];ov(e,io,t,Bd(t)),V0(q1,e)}}function Q1(t,e,n){t==="focusin"?(zg(),Bs=e,io=n,Bs.attachEvent("onpropertychange",lv)):t==="focusout"&&zg()}function J1(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nc(io)}function G1(t,e){if(t==="click")return Nc(e)}function eA(t,e){if(t==="input"||t==="change")return Nc(e)}function tA(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Dt=typeof Object.is=="function"?Object.is:tA;function so(t,e){if(Dt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Mh.call(e,i)||!Dt(t[i],e[i]))return!1}return!0}function Vg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function jg(t,e){var n=Vg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Vg(n)}}function cv(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?cv(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function uv(){for(var t=window,e=Ga();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Ga(t.document)}return e}function Xd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function nA(t){var e=uv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&cv(n.ownerDocument.documentElement,n)){if(r!==null&&Xd(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=jg(n,s);var o=jg(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var rA=mn&&"documentMode"in document&&11>=document.documentMode,ai=null,qh=null,Us=null,Zh=!1;function Wg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Zh||ai==null||ai!==Ga(r)||(r=ai,"selectionStart"in r&&Xd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Us&&so(Us,r)||(Us=r,r=ol(qh,"onSelect"),0<r.length&&(e=new Wd("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ai)))}function la(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var li={animationend:la("Animation","AnimationEnd"),animationiteration:la("Animation","AnimationIteration"),animationstart:la("Animation","AnimationStart"),transitionend:la("Transition","TransitionEnd")},xu={},hv={};mn&&(hv=document.createElement("div").style,"AnimationEvent"in window||(delete li.animationend.animation,delete li.animationiteration.animation,delete li.animationstart.animation),"TransitionEvent"in window||delete li.transitionend.transition);function kc(t){if(xu[t])return xu[t];if(!li[t])return t;var e=li[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in hv)return xu[t]=e[n];return t}var fv=kc("animationend"),dv=kc("animationiteration"),pv=kc("animationstart"),gv=kc("transitionend"),_v=new Map,Hg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rr(t,e){_v.set(t,e),zr(e,[t])}for(var Mu=0;Mu<Hg.length;Mu++){var Iu=Hg[Mu],iA=Iu.toLowerCase(),sA=Iu[0].toUpperCase()+Iu.slice(1);rr(iA,"on"+sA)}rr(fv,"onAnimationEnd");rr(dv,"onAnimationIteration");rr(pv,"onAnimationStart");rr("dblclick","onDoubleClick");rr("focusin","onFocus");rr("focusout","onBlur");rr(gv,"onTransitionEnd");Ni("onMouseEnter",["mouseout","mouseover"]);Ni("onMouseLeave",["mouseout","mouseover"]);Ni("onPointerEnter",["pointerout","pointerover"]);Ni("onPointerLeave",["pointerout","pointerover"]);zr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));zr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));zr("onBeforeInput",["compositionend","keypress","textInput","paste"]);zr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));zr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));zr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Cs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oA=new Set("cancel close invalid load scroll toggle".split(" ").concat(Cs));function $g(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,i1(r,e,void 0,t),t.currentTarget=null}function mv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;$g(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;$g(i,a,c),s=l}}}if(tl)throw t=$h,tl=!1,$h=null,t}function ce(t,e){var n=e[tf];n===void 0&&(n=e[tf]=new Set);var r=t+"__bubble";n.has(r)||(yv(e,t,2,!1),n.add(r))}function Ou(t,e,n){var r=0;e&&(r|=4),yv(n,t,r,e)}var ca="_reactListening"+Math.random().toString(36).slice(2);function oo(t){if(!t[ca]){t[ca]=!0,R0.forEach(function(n){n!=="selectionchange"&&(oA.has(n)||Ou(n,!1,t),Ou(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ca]||(e[ca]=!0,Ou("selectionchange",!1,e))}}function yv(t,e,n,r){switch(tv(e)){case 1:var i=T1;break;case 4:i=w1;break;default:i=Vd}n=i.bind(null,e,n,t),i=void 0,!Hh||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Nu(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=_r(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}V0(function(){var c=s,u=Bd(n),h=[];e:{var f=_v.get(t);if(f!==void 0){var d=Wd,_=t;switch(t){case"keypress":if(za(n)===0)break e;case"keydown":case"keyup":d=D1;break;case"focusin":_="focus",d=bu;break;case"focusout":_="blur",d=bu;break;case"beforeblur":case"afterblur":d=bu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=Ng;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=A1;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=L1;break;case fv:case dv:case pv:d=C1;break;case gv:d=V1;break;case"scroll":d=E1;break;case"wheel":d=W1;break;case"copy":case"cut":case"paste":d=x1;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=Fg}var v=(e&4)!==0,A=!v&&t==="scroll",p=v?f!==null?f+"Capture":null:f;v=[];for(var g=c,m;g!==null;){m=g;var E=m.stateNode;if(m.tag===5&&E!==null&&(m=E,p!==null&&(E=eo(g,p),E!=null&&v.push(ao(g,E,m)))),A)break;g=g.return}0<v.length&&(f=new d(f,_,null,n,u),h.push({event:f,listeners:v}))}}if(!(e&7)){e:{if(f=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",f&&n!==jh&&(_=n.relatedTarget||n.fromElement)&&(_r(_)||_[yn]))break e;if((d||f)&&(f=u.window===u?u:(f=u.ownerDocument)?f.defaultView||f.parentWindow:window,d?(_=n.relatedTarget||n.toElement,d=c,_=_?_r(_):null,_!==null&&(A=Vr(_),_!==A||_.tag!==5&&_.tag!==6)&&(_=null)):(d=null,_=c),d!==_)){if(v=Ng,E="onMouseLeave",p="onMouseEnter",g="mouse",(t==="pointerout"||t==="pointerover")&&(v=Fg,E="onPointerLeave",p="onPointerEnter",g="pointer"),A=d==null?f:ci(d),m=_==null?f:ci(_),f=new v(E,g+"leave",d,n,u),f.target=A,f.relatedTarget=m,E=null,_r(u)===c&&(v=new v(p,g+"enter",_,n,u),v.target=m,v.relatedTarget=A,E=v),A=E,d&&_)t:{for(v=d,p=_,g=0,m=v;m;m=qr(m))g++;for(m=0,E=p;E;E=qr(E))m++;for(;0<g-m;)v=qr(v),g--;for(;0<m-g;)p=qr(p),m--;for(;g--;){if(v===p||p!==null&&v===p.alternate)break t;v=qr(v),p=qr(p)}v=null}else v=null;d!==null&&Xg(h,f,d,v,!1),_!==null&&A!==null&&Xg(h,A,_,v,!0)}}e:{if(f=c?ci(c):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var b=Z1;else if(Ug(f))if(av)b=eA;else{b=J1;var x=Q1}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(b=G1);if(b&&(b=b(t,c))){ov(h,b,n,u);break e}x&&x(t,f,c),t==="focusout"&&(x=f._wrapperState)&&x.controlled&&f.type==="number"&&Bh(f,"number",f.value)}switch(x=c?ci(c):window,t){case"focusin":(Ug(x)||x.contentEditable==="true")&&(ai=x,qh=c,Us=null);break;case"focusout":Us=qh=ai=null;break;case"mousedown":Zh=!0;break;case"contextmenu":case"mouseup":case"dragend":Zh=!1,Wg(h,n,u);break;case"selectionchange":if(rA)break;case"keydown":case"keyup":Wg(h,n,u)}var O;if($d)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else oi?iv(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(rv&&n.locale!=="ko"&&(oi||M!=="onCompositionStart"?M==="onCompositionEnd"&&oi&&(O=nv()):(Bn=u,jd="value"in Bn?Bn.value:Bn.textContent,oi=!0)),x=ol(c,M),0<x.length&&(M=new kg(M,t,null,n,u),h.push({event:M,listeners:x}),O?M.data=O:(O=sv(n),O!==null&&(M.data=O)))),(O=$1?X1(t,n):Y1(t,n))&&(c=ol(c,"onBeforeInput"),0<c.length&&(u=new kg("onBeforeInput","beforeinput",null,n,u),h.push({event:u,listeners:c}),u.data=O))}mv(h,e)})}function ao(t,e,n){return{instance:t,listener:e,currentTarget:n}}function ol(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=eo(t,n),s!=null&&r.unshift(ao(t,s,i)),s=eo(t,e),s!=null&&r.push(ao(t,s,i))),t=t.return}return r}function qr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Xg(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=eo(n,s),l!=null&&o.unshift(ao(n,l,a))):i||(l=eo(n,s),l!=null&&o.push(ao(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var aA=/\r\n?/g,lA=/\u0000|\uFFFD/g;function Yg(t){return(typeof t=="string"?t:""+t).replace(aA,`
`).replace(lA,"")}function ua(t,e,n){if(e=Yg(e),Yg(t)!==e&&n)throw Error(B(425))}function al(){}var Qh=null,Jh=null;function Gh(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var ef=typeof setTimeout=="function"?setTimeout:void 0,cA=typeof clearTimeout=="function"?clearTimeout:void 0,Kg=typeof Promise=="function"?Promise:void 0,uA=typeof queueMicrotask=="function"?queueMicrotask:typeof Kg<"u"?function(t){return Kg.resolve(null).then(t).catch(hA)}:ef;function hA(t){setTimeout(function(){throw t})}function ku(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),ro(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);ro(e)}function Xn(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function qg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ts=Math.random().toString(36).slice(2),Yt="__reactFiber$"+ts,lo="__reactProps$"+ts,yn="__reactContainer$"+ts,tf="__reactEvents$"+ts,fA="__reactListeners$"+ts,dA="__reactHandles$"+ts;function _r(t){var e=t[Yt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[yn]||n[Yt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=qg(t);t!==null;){if(n=t[Yt])return n;t=qg(t)}return e}t=n,n=t.parentNode}return null}function Oo(t){return t=t[Yt]||t[yn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ci(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(B(33))}function Fc(t){return t[lo]||null}var nf=[],ui=-1;function ir(t){return{current:t}}function ue(t){0>ui||(t.current=nf[ui],nf[ui]=null,ui--)}function ae(t,e){ui++,nf[ui]=t.current,t.current=e}var er={},$e=ir(er),nt=ir(!1),xr=er;function ki(t,e){var n=t.type.contextTypes;if(!n)return er;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function rt(t){return t=t.childContextTypes,t!=null}function ll(){ue(nt),ue($e)}function Zg(t,e,n){if($e.current!==er)throw Error(B(168));ae($e,e),ae(nt,n)}function vv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(B(108,QS(t)||"Unknown",i));return me({},n,r)}function cl(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||er,xr=$e.current,ae($e,t),ae(nt,nt.current),!0}function Qg(t,e,n){var r=t.stateNode;if(!r)throw Error(B(169));n?(t=vv(t,e,xr),r.__reactInternalMemoizedMergedChildContext=t,ue(nt),ue($e),ae($e,t)):ue(nt),ae(nt,n)}var un=null,Dc=!1,Fu=!1;function Tv(t){un===null?un=[t]:un.push(t)}function pA(t){Dc=!0,Tv(t)}function sr(){if(!Fu&&un!==null){Fu=!0;var t=0,e=re;try{var n=un;for(re=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}un=null,Dc=!1}catch(i){throw un!==null&&(un=un.slice(t+1)),$0(Ud,sr),i}finally{re=e,Fu=!1}}return null}var hi=[],fi=0,ul=null,hl=0,mt=[],yt=0,Mr=null,dn=1,pn="";function hr(t,e){hi[fi++]=hl,hi[fi++]=ul,ul=t,hl=e}function wv(t,e,n){mt[yt++]=dn,mt[yt++]=pn,mt[yt++]=Mr,Mr=t;var r=dn;t=pn;var i=32-Nt(r)-1;r&=~(1<<i),n+=1;var s=32-Nt(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,dn=1<<32-Nt(e)+i|n<<i|r,pn=s+t}else dn=1<<s|n<<i|r,pn=t}function Yd(t){t.return!==null&&(hr(t,1),wv(t,1,0))}function Kd(t){for(;t===ul;)ul=hi[--fi],hi[fi]=null,hl=hi[--fi],hi[fi]=null;for(;t===Mr;)Mr=mt[--yt],mt[yt]=null,pn=mt[--yt],mt[yt]=null,dn=mt[--yt],mt[yt]=null}var ht=null,lt=null,fe=!1,Mt=null;function Ev(t,e){var n=vt(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Jg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ht=t,lt=Xn(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ht=t,lt=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Mr!==null?{id:dn,overflow:pn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=vt(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ht=t,lt=null,!0):!1;default:return!1}}function rf(t){return(t.mode&1)!==0&&(t.flags&128)===0}function sf(t){if(fe){var e=lt;if(e){var n=e;if(!Jg(t,e)){if(rf(t))throw Error(B(418));e=Xn(n.nextSibling);var r=ht;e&&Jg(t,e)?Ev(r,n):(t.flags=t.flags&-4097|2,fe=!1,ht=t)}}else{if(rf(t))throw Error(B(418));t.flags=t.flags&-4097|2,fe=!1,ht=t}}}function Gg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ht=t}function ha(t){if(t!==ht)return!1;if(!fe)return Gg(t),fe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Gh(t.type,t.memoizedProps)),e&&(e=lt)){if(rf(t))throw Sv(),Error(B(418));for(;e;)Ev(t,e),e=Xn(e.nextSibling)}if(Gg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(B(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){lt=Xn(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}lt=null}}else lt=ht?Xn(t.stateNode.nextSibling):null;return!0}function Sv(){for(var t=lt;t;)t=Xn(t.nextSibling)}function Fi(){lt=ht=null,fe=!1}function qd(t){Mt===null?Mt=[t]:Mt.push(t)}var gA=An.ReactCurrentBatchConfig;function Pt(t,e){if(t&&t.defaultProps){e=me({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var fl=ir(null),dl=null,di=null,Zd=null;function Qd(){Zd=di=dl=null}function Jd(t){var e=fl.current;ue(fl),t._currentValue=e}function of(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Ci(t,e){dl=t,Zd=di=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(tt=!0),t.firstContext=null)}function St(t){var e=t._currentValue;if(Zd!==t)if(t={context:t,memoizedValue:e,next:null},di===null){if(dl===null)throw Error(B(308));di=t,dl.dependencies={lanes:0,firstContext:t}}else di=di.next=t;return e}var mr=null;function Gd(t){mr===null?mr=[t]:mr.push(t)}function Av(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Gd(e)):(n.next=i.next,i.next=n),e.interleaved=n,vn(t,r)}function vn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Nn=!1;function ep(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Rv(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _n(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,te&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,vn(t,n)}return i=r.interleaved,i===null?(e.next=e,Gd(r)):(e.next=i.next,i.next=e),r.interleaved=e,vn(t,n)}function Va(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ld(t,n)}}function e_(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function pl(t,e,n,r){var i=t.updateQueue;Nn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var h=i.baseState;o=0,u=c=l=null,a=s;do{var f=a.lane,d=a.eventTime;if((r&f)===f){u!==null&&(u=u.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var _=t,v=a;switch(f=e,d=n,v.tag){case 1:if(_=v.payload,typeof _=="function"){h=_.call(d,h,f);break e}h=_;break e;case 3:_.flags=_.flags&-65537|128;case 0:if(_=v.payload,f=typeof _=="function"?_.call(d,h,f):_,f==null)break e;h=me({},h,f);break e;case 2:Nn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=i.effects,f===null?i.effects=[a]:f.push(a))}else d={eventTime:d,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=d,l=h):u=u.next=d,o|=f;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;f=a,a=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(1);if(u===null&&(l=h),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Or|=o,t.lanes=o,t.memoizedState=h}}function t_(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(B(191,i));i.call(r)}}}var bv=new A0.Component().refs;function af(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:me({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Bc={isMounted:function(t){return(t=t._reactInternals)?Vr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=qe(),i=qn(t),s=_n(r,i);s.payload=e,n!=null&&(s.callback=n),e=Yn(t,s,i),e!==null&&(kt(e,t,i,r),Va(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=qe(),i=qn(t),s=_n(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Yn(t,s,i),e!==null&&(kt(e,t,i,r),Va(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=qe(),r=qn(t),i=_n(n,r);i.tag=2,e!=null&&(i.callback=e),e=Yn(t,i,r),e!==null&&(kt(e,t,r,n),Va(e,t,r))}};function n_(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!so(n,r)||!so(i,s):!0}function Cv(t,e,n){var r=!1,i=er,s=e.contextType;return typeof s=="object"&&s!==null?s=St(s):(i=rt(e)?xr:$e.current,r=e.contextTypes,s=(r=r!=null)?ki(t,i):er),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Bc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function r_(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Bc.enqueueReplaceState(e,e.state,null)}function lf(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs=bv,ep(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=St(s):(s=rt(e)?xr:$e.current,i.context=ki(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(af(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Bc.enqueueReplaceState(i,i.state,null),pl(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function ps(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(B(309));var r=n.stateNode}if(!r)throw Error(B(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;a===bv&&(a=i.refs={}),o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(B(284));if(!n._owner)throw Error(B(290,t))}return t}function fa(t,e){throw t=Object.prototype.toString.call(e),Error(B(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function i_(t){var e=t._init;return e(t._payload)}function Pv(t){function e(p,g){if(t){var m=p.deletions;m===null?(p.deletions=[g],p.flags|=16):m.push(g)}}function n(p,g){if(!t)return null;for(;g!==null;)e(p,g),g=g.sibling;return null}function r(p,g){for(p=new Map;g!==null;)g.key!==null?p.set(g.key,g):p.set(g.index,g),g=g.sibling;return p}function i(p,g){return p=Zn(p,g),p.index=0,p.sibling=null,p}function s(p,g,m){return p.index=m,t?(m=p.alternate,m!==null?(m=m.index,m<g?(p.flags|=2,g):m):(p.flags|=2,g)):(p.flags|=1048576,g)}function o(p){return t&&p.alternate===null&&(p.flags|=2),p}function a(p,g,m,E){return g===null||g.tag!==6?(g=ju(m,p.mode,E),g.return=p,g):(g=i(g,m),g.return=p,g)}function l(p,g,m,E){var b=m.type;return b===si?u(p,g,m.props.children,E,m.key):g!==null&&(g.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===On&&i_(b)===g.type)?(E=i(g,m.props),E.ref=ps(p,g,m),E.return=p,E):(E=Ya(m.type,m.key,m.props,null,p.mode,E),E.ref=ps(p,g,m),E.return=p,E)}function c(p,g,m,E){return g===null||g.tag!==4||g.stateNode.containerInfo!==m.containerInfo||g.stateNode.implementation!==m.implementation?(g=Wu(m,p.mode,E),g.return=p,g):(g=i(g,m.children||[]),g.return=p,g)}function u(p,g,m,E,b){return g===null||g.tag!==7?(g=Sr(m,p.mode,E,b),g.return=p,g):(g=i(g,m),g.return=p,g)}function h(p,g,m){if(typeof g=="string"&&g!==""||typeof g=="number")return g=ju(""+g,p.mode,m),g.return=p,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case ta:return m=Ya(g.type,g.key,g.props,null,p.mode,m),m.ref=ps(p,null,g),m.return=p,m;case ii:return g=Wu(g,p.mode,m),g.return=p,g;case On:var E=g._init;return h(p,E(g._payload),m)}if(Rs(g)||cs(g))return g=Sr(g,p.mode,m,null),g.return=p,g;fa(p,g)}return null}function f(p,g,m,E){var b=g!==null?g.key:null;if(typeof m=="string"&&m!==""||typeof m=="number")return b!==null?null:a(p,g,""+m,E);if(typeof m=="object"&&m!==null){switch(m.$$typeof){case ta:return m.key===b?l(p,g,m,E):null;case ii:return m.key===b?c(p,g,m,E):null;case On:return b=m._init,f(p,g,b(m._payload),E)}if(Rs(m)||cs(m))return b!==null?null:u(p,g,m,E,null);fa(p,m)}return null}function d(p,g,m,E,b){if(typeof E=="string"&&E!==""||typeof E=="number")return p=p.get(m)||null,a(g,p,""+E,b);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case ta:return p=p.get(E.key===null?m:E.key)||null,l(g,p,E,b);case ii:return p=p.get(E.key===null?m:E.key)||null,c(g,p,E,b);case On:var x=E._init;return d(p,g,m,x(E._payload),b)}if(Rs(E)||cs(E))return p=p.get(m)||null,u(g,p,E,b,null);fa(g,E)}return null}function _(p,g,m,E){for(var b=null,x=null,O=g,M=g=0,N=null;O!==null&&M<m.length;M++){O.index>M?(N=O,O=null):N=O.sibling;var k=f(p,O,m[M],E);if(k===null){O===null&&(O=N);break}t&&O&&k.alternate===null&&e(p,O),g=s(k,g,M),x===null?b=k:x.sibling=k,x=k,O=N}if(M===m.length)return n(p,O),fe&&hr(p,M),b;if(O===null){for(;M<m.length;M++)O=h(p,m[M],E),O!==null&&(g=s(O,g,M),x===null?b=O:x.sibling=O,x=O);return fe&&hr(p,M),b}for(O=r(p,O);M<m.length;M++)N=d(O,p,M,m[M],E),N!==null&&(t&&N.alternate!==null&&O.delete(N.key===null?M:N.key),g=s(N,g,M),x===null?b=N:x.sibling=N,x=N);return t&&O.forEach(function(z){return e(p,z)}),fe&&hr(p,M),b}function v(p,g,m,E){var b=cs(m);if(typeof b!="function")throw Error(B(150));if(m=b.call(m),m==null)throw Error(B(151));for(var x=b=null,O=g,M=g=0,N=null,k=m.next();O!==null&&!k.done;M++,k=m.next()){O.index>M?(N=O,O=null):N=O.sibling;var z=f(p,O,k.value,E);if(z===null){O===null&&(O=N);break}t&&O&&z.alternate===null&&e(p,O),g=s(z,g,M),x===null?b=z:x.sibling=z,x=z,O=N}if(k.done)return n(p,O),fe&&hr(p,M),b;if(O===null){for(;!k.done;M++,k=m.next())k=h(p,k.value,E),k!==null&&(g=s(k,g,M),x===null?b=k:x.sibling=k,x=k);return fe&&hr(p,M),b}for(O=r(p,O);!k.done;M++,k=m.next())k=d(O,p,M,k.value,E),k!==null&&(t&&k.alternate!==null&&O.delete(k.key===null?M:k.key),g=s(k,g,M),x===null?b=k:x.sibling=k,x=k);return t&&O.forEach(function(L){return e(p,L)}),fe&&hr(p,M),b}function A(p,g,m,E){if(typeof m=="object"&&m!==null&&m.type===si&&m.key===null&&(m=m.props.children),typeof m=="object"&&m!==null){switch(m.$$typeof){case ta:e:{for(var b=m.key,x=g;x!==null;){if(x.key===b){if(b=m.type,b===si){if(x.tag===7){n(p,x.sibling),g=i(x,m.props.children),g.return=p,p=g;break e}}else if(x.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===On&&i_(b)===x.type){n(p,x.sibling),g=i(x,m.props),g.ref=ps(p,x,m),g.return=p,p=g;break e}n(p,x);break}else e(p,x);x=x.sibling}m.type===si?(g=Sr(m.props.children,p.mode,E,m.key),g.return=p,p=g):(E=Ya(m.type,m.key,m.props,null,p.mode,E),E.ref=ps(p,g,m),E.return=p,p=E)}return o(p);case ii:e:{for(x=m.key;g!==null;){if(g.key===x)if(g.tag===4&&g.stateNode.containerInfo===m.containerInfo&&g.stateNode.implementation===m.implementation){n(p,g.sibling),g=i(g,m.children||[]),g.return=p,p=g;break e}else{n(p,g);break}else e(p,g);g=g.sibling}g=Wu(m,p.mode,E),g.return=p,p=g}return o(p);case On:return x=m._init,A(p,g,x(m._payload),E)}if(Rs(m))return _(p,g,m,E);if(cs(m))return v(p,g,m,E);fa(p,m)}return typeof m=="string"&&m!==""||typeof m=="number"?(m=""+m,g!==null&&g.tag===6?(n(p,g.sibling),g=i(g,m),g.return=p,p=g):(n(p,g),g=ju(m,p.mode,E),g.return=p,p=g),o(p)):n(p,g)}return A}var Di=Pv(!0),xv=Pv(!1),No={},Gt=ir(No),co=ir(No),uo=ir(No);function yr(t){if(t===No)throw Error(B(174));return t}function tp(t,e){switch(ae(uo,e),ae(co,t),ae(Gt,No),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Lh(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Lh(e,t)}ue(Gt),ae(Gt,e)}function Bi(){ue(Gt),ue(co),ue(uo)}function Mv(t){yr(uo.current);var e=yr(Gt.current),n=Lh(e,t.type);e!==n&&(ae(co,t),ae(Gt,n))}function np(t){co.current===t&&(ue(Gt),ue(co))}var pe=ir(0);function gl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Du=[];function rp(){for(var t=0;t<Du.length;t++)Du[t]._workInProgressVersionPrimary=null;Du.length=0}var ja=An.ReactCurrentDispatcher,Bu=An.ReactCurrentBatchConfig,Ir=0,_e=null,be=null,Me=null,_l=!1,Ls=!1,ho=0,_A=0;function ze(){throw Error(B(321))}function ip(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Dt(t[n],e[n]))return!1;return!0}function sp(t,e,n,r,i,s){if(Ir=s,_e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,ja.current=t===null||t.memoizedState===null?TA:wA,t=n(r,i),Ls){s=0;do{if(Ls=!1,ho=0,25<=s)throw Error(B(301));s+=1,Me=be=null,e.updateQueue=null,ja.current=EA,t=n(r,i)}while(Ls)}if(ja.current=ml,e=be!==null&&be.next!==null,Ir=0,Me=be=_e=null,_l=!1,e)throw Error(B(300));return t}function op(){var t=ho!==0;return ho=0,t}function Xt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Me===null?_e.memoizedState=Me=t:Me=Me.next=t,Me}function At(){if(be===null){var t=_e.alternate;t=t!==null?t.memoizedState:null}else t=be.next;var e=Me===null?_e.memoizedState:Me.next;if(e!==null)Me=e,be=t;else{if(t===null)throw Error(B(310));be=t,t={memoizedState:be.memoizedState,baseState:be.baseState,baseQueue:be.baseQueue,queue:be.queue,next:null},Me===null?_e.memoizedState=Me=t:Me=Me.next=t}return Me}function fo(t,e){return typeof e=="function"?e(t):e}function Uu(t){var e=At(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var r=be,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((Ir&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var h={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=h,o=r):l=l.next=h,_e.lanes|=u,Or|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,Dt(r,e.memoizedState)||(tt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,_e.lanes|=s,Or|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Lu(t){var e=At(),n=e.queue;if(n===null)throw Error(B(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Dt(s,e.memoizedState)||(tt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Iv(){}function Ov(t,e){var n=_e,r=At(),i=e(),s=!Dt(r.memoizedState,i);if(s&&(r.memoizedState=i,tt=!0),r=r.queue,ap(Fv.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Me!==null&&Me.memoizedState.tag&1){if(n.flags|=2048,po(9,kv.bind(null,n,r,i,e),void 0,null),Ie===null)throw Error(B(349));Ir&30||Nv(n,e,i)}return i}function Nv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function kv(t,e,n,r){e.value=n,e.getSnapshot=r,Dv(e)&&Bv(t)}function Fv(t,e,n){return n(function(){Dv(e)&&Bv(t)})}function Dv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Dt(t,n)}catch{return!0}}function Bv(t){var e=vn(t,1);e!==null&&kt(e,t,1,-1)}function s_(t){var e=Xt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:fo,lastRenderedState:t},e.queue=t,t=t.dispatch=vA.bind(null,_e,t),[e.memoizedState,t]}function po(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Uv(){return At().memoizedState}function Wa(t,e,n,r){var i=Xt();_e.flags|=t,i.memoizedState=po(1|e,n,void 0,r===void 0?null:r)}function Uc(t,e,n,r){var i=At();r=r===void 0?null:r;var s=void 0;if(be!==null){var o=be.memoizedState;if(s=o.destroy,r!==null&&ip(r,o.deps)){i.memoizedState=po(e,n,s,r);return}}_e.flags|=t,i.memoizedState=po(1|e,n,s,r)}function o_(t,e){return Wa(8390656,8,t,e)}function ap(t,e){return Uc(2048,8,t,e)}function Lv(t,e){return Uc(4,2,t,e)}function zv(t,e){return Uc(4,4,t,e)}function Vv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function jv(t,e,n){return n=n!=null?n.concat([t]):null,Uc(4,4,Vv.bind(null,e,t),n)}function lp(){}function Wv(t,e){var n=At();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ip(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function Hv(t,e){var n=At();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&ip(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function $v(t,e,n){return Ir&21?(Dt(n,e)||(n=K0(),_e.lanes|=n,Or|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,tt=!0),t.memoizedState=n)}function mA(t,e){var n=re;re=n!==0&&4>n?n:4,t(!0);var r=Bu.transition;Bu.transition={};try{t(!1),e()}finally{re=n,Bu.transition=r}}function Xv(){return At().memoizedState}function yA(t,e,n){var r=qn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Yv(t))Kv(e,n);else if(n=Av(t,e,n,r),n!==null){var i=qe();kt(n,t,r,i),qv(n,e,r)}}function vA(t,e,n){var r=qn(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Yv(t))Kv(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Dt(a,o)){var l=e.interleaved;l===null?(i.next=i,Gd(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=Av(t,e,i,r),n!==null&&(i=qe(),kt(n,t,r,i),qv(n,e,r))}}function Yv(t){var e=t.alternate;return t===_e||e!==null&&e===_e}function Kv(t,e){Ls=_l=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function qv(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Ld(t,n)}}var ml={readContext:St,useCallback:ze,useContext:ze,useEffect:ze,useImperativeHandle:ze,useInsertionEffect:ze,useLayoutEffect:ze,useMemo:ze,useReducer:ze,useRef:ze,useState:ze,useDebugValue:ze,useDeferredValue:ze,useTransition:ze,useMutableSource:ze,useSyncExternalStore:ze,useId:ze,unstable_isNewReconciler:!1},TA={readContext:St,useCallback:function(t,e){return Xt().memoizedState=[t,e===void 0?null:e],t},useContext:St,useEffect:o_,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Wa(4194308,4,Vv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Wa(4194308,4,t,e)},useInsertionEffect:function(t,e){return Wa(4,2,t,e)},useMemo:function(t,e){var n=Xt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Xt();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=yA.bind(null,_e,t),[r.memoizedState,t]},useRef:function(t){var e=Xt();return t={current:t},e.memoizedState=t},useState:s_,useDebugValue:lp,useDeferredValue:function(t){return Xt().memoizedState=t},useTransition:function(){var t=s_(!1),e=t[0];return t=mA.bind(null,t[1]),Xt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=_e,i=Xt();if(fe){if(n===void 0)throw Error(B(407));n=n()}else{if(n=e(),Ie===null)throw Error(B(349));Ir&30||Nv(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,o_(Fv.bind(null,r,s,t),[t]),r.flags|=2048,po(9,kv.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Xt(),e=Ie.identifierPrefix;if(fe){var n=pn,r=dn;n=(r&~(1<<32-Nt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=ho++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=_A++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},wA={readContext:St,useCallback:Wv,useContext:St,useEffect:ap,useImperativeHandle:jv,useInsertionEffect:Lv,useLayoutEffect:zv,useMemo:Hv,useReducer:Uu,useRef:Uv,useState:function(){return Uu(fo)},useDebugValue:lp,useDeferredValue:function(t){var e=At();return $v(e,be.memoizedState,t)},useTransition:function(){var t=Uu(fo)[0],e=At().memoizedState;return[t,e]},useMutableSource:Iv,useSyncExternalStore:Ov,useId:Xv,unstable_isNewReconciler:!1},EA={readContext:St,useCallback:Wv,useContext:St,useEffect:ap,useImperativeHandle:jv,useInsertionEffect:Lv,useLayoutEffect:zv,useMemo:Hv,useReducer:Lu,useRef:Uv,useState:function(){return Lu(fo)},useDebugValue:lp,useDeferredValue:function(t){var e=At();return be===null?e.memoizedState=t:$v(e,be.memoizedState,t)},useTransition:function(){var t=Lu(fo)[0],e=At().memoizedState;return[t,e]},useMutableSource:Iv,useSyncExternalStore:Ov,useId:Xv,unstable_isNewReconciler:!1};function Ui(t,e){try{var n="",r=e;do n+=ZS(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function zu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function cf(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var SA=typeof WeakMap=="function"?WeakMap:Map;function Zv(t,e,n){n=_n(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){vl||(vl=!0,vf=r),cf(t,e)},n}function Qv(t,e,n){n=_n(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){cf(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){cf(t,e),typeof r!="function"&&(Kn===null?Kn=new Set([this]):Kn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function a_(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new SA;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=BA.bind(null,t,e,n),e.then(t,t))}function l_(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function c_(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=_n(-1,1),e.tag=2,Yn(n,e,1))),n.lanes|=1),t)}var AA=An.ReactCurrentOwner,tt=!1;function Ye(t,e,n,r){e.child=t===null?xv(e,null,n,r):Di(e,t.child,n,r)}function u_(t,e,n,r,i){n=n.render;var s=e.ref;return Ci(e,i),r=sp(t,e,n,r,s,i),n=op(),t!==null&&!tt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Tn(t,e,i)):(fe&&n&&Yd(e),e.flags|=1,Ye(t,e,r,i),e.child)}function h_(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!_p(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,Jv(t,e,s,r,i)):(t=Ya(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:so,n(o,r)&&t.ref===e.ref)return Tn(t,e,i)}return e.flags|=1,t=Zn(s,r),t.ref=e.ref,t.return=e,e.child=t}function Jv(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(so(s,r)&&t.ref===e.ref)if(tt=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(tt=!0);else return e.lanes=t.lanes,Tn(t,e,i)}return uf(t,e,n,r,i)}function Gv(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ae(gi,ot),ot|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ae(gi,ot),ot|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,ae(gi,ot),ot|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,ae(gi,ot),ot|=r;return Ye(t,e,i,n),e.child}function eT(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function uf(t,e,n,r,i){var s=rt(n)?xr:$e.current;return s=ki(e,s),Ci(e,i),n=sp(t,e,n,r,s,i),r=op(),t!==null&&!tt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,Tn(t,e,i)):(fe&&r&&Yd(e),e.flags|=1,Ye(t,e,n,i),e.child)}function f_(t,e,n,r,i){if(rt(n)){var s=!0;cl(e)}else s=!1;if(Ci(e,i),e.stateNode===null)Ha(t,e),Cv(e,n,r),lf(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=St(c):(c=rt(n)?xr:$e.current,c=ki(e,c));var u=n.getDerivedStateFromProps,h=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";h||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&r_(e,o,r,c),Nn=!1;var f=e.memoizedState;o.state=f,pl(e,r,o,i),l=e.memoizedState,a!==r||f!==l||nt.current||Nn?(typeof u=="function"&&(af(e,n,u,r),l=e.memoizedState),(a=Nn||n_(e,n,a,r,f,l,c))?(h||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Rv(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Pt(e.type,a),o.props=c,h=e.pendingProps,f=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=St(l):(l=rt(n)?xr:$e.current,l=ki(e,l));var d=n.getDerivedStateFromProps;(u=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==h||f!==l)&&r_(e,o,r,l),Nn=!1,f=e.memoizedState,o.state=f,pl(e,r,o,i);var _=e.memoizedState;a!==h||f!==_||nt.current||Nn?(typeof d=="function"&&(af(e,n,d,r),_=e.memoizedState),(c=Nn||n_(e,n,c,r,f,_,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,_,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,_,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=_),o.props=r,o.state=_,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),r=!1)}return hf(t,e,n,r,s,i)}function hf(t,e,n,r,i,s){eT(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&Qg(e,n,!1),Tn(t,e,s);r=e.stateNode,AA.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Di(e,t.child,null,s),e.child=Di(e,null,a,s)):Ye(t,e,a,s),e.memoizedState=r.state,i&&Qg(e,n,!0),e.child}function tT(t){var e=t.stateNode;e.pendingContext?Zg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Zg(t,e.context,!1),tp(t,e.containerInfo)}function d_(t,e,n,r,i){return Fi(),qd(i),e.flags|=256,Ye(t,e,n,r),e.child}var ff={dehydrated:null,treeContext:null,retryLane:0};function df(t){return{baseLanes:t,cachePool:null,transitions:null}}function nT(t,e,n){var r=e.pendingProps,i=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),ae(pe,i&1),t===null)return sf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=Vc(o,r,0,null),t=Sr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=df(n),e.memoizedState=ff,t):cp(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return RA(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=Zn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=Zn(a,s):(s=Sr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?df(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=ff,r}return s=t.child,t=s.sibling,r=Zn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function cp(t,e){return e=Vc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function da(t,e,n,r){return r!==null&&qd(r),Di(e,t.child,null,n),t=cp(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function RA(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=zu(Error(B(422))),da(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=Vc({mode:"visible",children:r.children},i,0,null),s=Sr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Di(e,t.child,null,o),e.child.memoizedState=df(o),e.memoizedState=ff,s);if(!(e.mode&1))return da(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(B(419)),r=zu(s,r,void 0),da(t,e,o,r)}if(a=(o&t.childLanes)!==0,tt||a){if(r=Ie,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,vn(t,i),kt(r,t,i,-1))}return gp(),r=zu(Error(B(421))),da(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=UA.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,lt=Xn(i.nextSibling),ht=e,fe=!0,Mt=null,t!==null&&(mt[yt++]=dn,mt[yt++]=pn,mt[yt++]=Mr,dn=t.id,pn=t.overflow,Mr=e),e=cp(e,r.children),e.flags|=4096,e)}function p_(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),of(t.return,e,n)}function Vu(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function rT(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ye(t,e,r.children,n),r=pe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&p_(t,n,e);else if(t.tag===19)p_(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(ae(pe,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&gl(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Vu(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&gl(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Vu(e,!0,n,null,s);break;case"together":Vu(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ha(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Tn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Or|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(B(153));if(e.child!==null){for(t=e.child,n=Zn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Zn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function bA(t,e,n){switch(e.tag){case 3:tT(e),Fi();break;case 5:Mv(e);break;case 1:rt(e.type)&&cl(e);break;case 4:tp(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;ae(fl,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(ae(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?nT(t,e,n):(ae(pe,pe.current&1),t=Tn(t,e,n),t!==null?t.sibling:null);ae(pe,pe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return rT(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),ae(pe,pe.current),r)break;return null;case 22:case 23:return e.lanes=0,Gv(t,e,n)}return Tn(t,e,n)}var iT,pf,sT,oT;iT=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};pf=function(){};sT=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,yr(Gt.current);var s=null;switch(n){case"input":i=Fh(t,i),r=Fh(t,r),s=[];break;case"select":i=me({},i,{value:void 0}),r=me({},r,{value:void 0}),s=[];break;case"textarea":i=Uh(t,i),r=Uh(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=al)}zh(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Js.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(Js.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ce("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};oT=function(t,e,n,r){n!==r&&(e.flags|=4)};function gs(t,e){if(!fe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Ve(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function CA(t,e,n){var r=e.pendingProps;switch(Kd(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ve(e),null;case 1:return rt(e.type)&&ll(),Ve(e),null;case 3:return r=e.stateNode,Bi(),ue(nt),ue($e),rp(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ha(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Mt!==null&&(Ef(Mt),Mt=null))),pf(t,e),Ve(e),null;case 5:np(e);var i=yr(uo.current);if(n=e.type,t!==null&&e.stateNode!=null)sT(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(B(166));return Ve(e),null}if(t=yr(Gt.current),ha(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Yt]=e,r[lo]=s,t=(e.mode&1)!==0,n){case"dialog":ce("cancel",r),ce("close",r);break;case"iframe":case"object":case"embed":ce("load",r);break;case"video":case"audio":for(i=0;i<Cs.length;i++)ce(Cs[i],r);break;case"source":ce("error",r);break;case"img":case"image":case"link":ce("error",r),ce("load",r);break;case"details":ce("toggle",r);break;case"input":Sg(r,s),ce("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ce("invalid",r);break;case"textarea":Rg(r,s),ce("invalid",r)}zh(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&ua(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ua(r.textContent,a,t),i=["children",""+a]):Js.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",r)}switch(n){case"input":na(r),Ag(r,s,!0);break;case"textarea":na(r),bg(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=al)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=N0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Yt]=e,t[lo]=r,iT(t,e,!1,!1),e.stateNode=t;e:{switch(o=Vh(n,r),n){case"dialog":ce("cancel",t),ce("close",t),i=r;break;case"iframe":case"object":case"embed":ce("load",t),i=r;break;case"video":case"audio":for(i=0;i<Cs.length;i++)ce(Cs[i],t);i=r;break;case"source":ce("error",t),i=r;break;case"img":case"image":case"link":ce("error",t),ce("load",t),i=r;break;case"details":ce("toggle",t),i=r;break;case"input":Sg(t,r),i=Fh(t,r),ce("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=me({},r,{value:void 0}),ce("invalid",t);break;case"textarea":Rg(t,r),i=Uh(t,r),ce("invalid",t);break;default:i=r}zh(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?D0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&k0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Gs(t,l):typeof l=="number"&&Gs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Js.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ce("scroll",t):l!=null&&Nd(t,s,l,o))}switch(n){case"input":na(t),Ag(t,r,!1);break;case"textarea":na(t),bg(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Gn(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?Si(t,!!r.multiple,s,!1):r.defaultValue!=null&&Si(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=al)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Ve(e),null;case 6:if(t&&e.stateNode!=null)oT(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(B(166));if(n=yr(uo.current),yr(Gt.current),ha(e)){if(r=e.stateNode,n=e.memoizedProps,r[Yt]=e,(s=r.nodeValue!==n)&&(t=ht,t!==null))switch(t.tag){case 3:ua(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ua(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Yt]=e,e.stateNode=r}return Ve(e),null;case 13:if(ue(pe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(fe&&lt!==null&&e.mode&1&&!(e.flags&128))Sv(),Fi(),e.flags|=98560,s=!1;else if(s=ha(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(B(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(B(317));s[Yt]=e}else Fi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Ve(e),s=!1}else Mt!==null&&(Ef(Mt),Mt=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Ce===0&&(Ce=3):gp())),e.updateQueue!==null&&(e.flags|=4),Ve(e),null);case 4:return Bi(),pf(t,e),t===null&&oo(e.stateNode.containerInfo),Ve(e),null;case 10:return Jd(e.type._context),Ve(e),null;case 17:return rt(e.type)&&ll(),Ve(e),null;case 19:if(ue(pe),s=e.memoizedState,s===null)return Ve(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)gs(s,!1);else{if(Ce!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=gl(t),o!==null){for(e.flags|=128,gs(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ae(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&we()>Li&&(e.flags|=128,r=!0,gs(s,!1),e.lanes=4194304)}else{if(!r)if(t=gl(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),gs(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!fe)return Ve(e),null}else 2*we()-s.renderingStartTime>Li&&n!==1073741824&&(e.flags|=128,r=!0,gs(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=we(),e.sibling=null,n=pe.current,ae(pe,r?n&1|2:n&1),e):(Ve(e),null);case 22:case 23:return pp(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ot&1073741824&&(Ve(e),e.subtreeFlags&6&&(e.flags|=8192)):Ve(e),null;case 24:return null;case 25:return null}throw Error(B(156,e.tag))}function PA(t,e){switch(Kd(e),e.tag){case 1:return rt(e.type)&&ll(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Bi(),ue(nt),ue($e),rp(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return np(e),null;case 13:if(ue(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(B(340));Fi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(pe),null;case 4:return Bi(),null;case 10:return Jd(e.type._context),null;case 22:case 23:return pp(),null;case 24:return null;default:return null}}var pa=!1,He=!1,xA=typeof WeakSet=="function"?WeakSet:Set,$=null;function pi(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ve(t,e,r)}else n.current=null}function gf(t,e,n){try{n()}catch(r){ve(t,e,r)}}var g_=!1;function MA(t,e){if(Qh=il,t=uv(),Xd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,h=t,f=null;t:for(;;){for(var d;h!==n||i!==0&&h.nodeType!==3||(a=o+i),h!==s||r!==0&&h.nodeType!==3||(l=o+r),h.nodeType===3&&(o+=h.nodeValue.length),(d=h.firstChild)!==null;)f=h,h=d;for(;;){if(h===t)break t;if(f===n&&++c===i&&(a=o),f===s&&++u===r&&(l=o),(d=h.nextSibling)!==null)break;h=f,f=h.parentNode}h=d}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Jh={focusedElem:t,selectionRange:n},il=!1,$=e;$!==null;)if(e=$,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,$=t;else for(;$!==null;){e=$;try{var _=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(_!==null){var v=_.memoizedProps,A=_.memoizedState,p=e.stateNode,g=p.getSnapshotBeforeUpdate(e.elementType===e.type?v:Pt(e.type,v),A);p.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var m=e.stateNode.containerInfo;m.nodeType===1?m.textContent="":m.nodeType===9&&m.documentElement&&m.removeChild(m.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(B(163))}}catch(E){ve(e,e.return,E)}if(t=e.sibling,t!==null){t.return=e.return,$=t;break}$=e.return}return _=g_,g_=!1,_}function zs(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&gf(e,n,s)}i=i.next}while(i!==r)}}function Lc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function _f(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function aT(t){var e=t.alternate;e!==null&&(t.alternate=null,aT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Yt],delete e[lo],delete e[tf],delete e[fA],delete e[dA])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function lT(t){return t.tag===5||t.tag===3||t.tag===4}function __(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||lT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function mf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=al));else if(r!==4&&(t=t.child,t!==null))for(mf(t,e,n),t=t.sibling;t!==null;)mf(t,e,n),t=t.sibling}function yf(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(yf(t,e,n),t=t.sibling;t!==null;)yf(t,e,n),t=t.sibling}var ke=null,xt=!1;function bn(t,e,n){for(n=n.child;n!==null;)cT(t,e,n),n=n.sibling}function cT(t,e,n){if(Jt&&typeof Jt.onCommitFiberUnmount=="function")try{Jt.onCommitFiberUnmount(Ic,n)}catch{}switch(n.tag){case 5:He||pi(n,e);case 6:var r=ke,i=xt;ke=null,bn(t,e,n),ke=r,xt=i,ke!==null&&(xt?(t=ke,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):ke.removeChild(n.stateNode));break;case 18:ke!==null&&(xt?(t=ke,n=n.stateNode,t.nodeType===8?ku(t.parentNode,n):t.nodeType===1&&ku(t,n),ro(t)):ku(ke,n.stateNode));break;case 4:r=ke,i=xt,ke=n.stateNode.containerInfo,xt=!0,bn(t,e,n),ke=r,xt=i;break;case 0:case 11:case 14:case 15:if(!He&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&gf(n,e,o),i=i.next}while(i!==r)}bn(t,e,n);break;case 1:if(!He&&(pi(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){ve(n,e,a)}bn(t,e,n);break;case 21:bn(t,e,n);break;case 22:n.mode&1?(He=(r=He)||n.memoizedState!==null,bn(t,e,n),He=r):bn(t,e,n);break;default:bn(t,e,n)}}function m_(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new xA),e.forEach(function(r){var i=LA.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Ct(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:ke=a.stateNode,xt=!1;break e;case 3:ke=a.stateNode.containerInfo,xt=!0;break e;case 4:ke=a.stateNode.containerInfo,xt=!0;break e}a=a.return}if(ke===null)throw Error(B(160));cT(s,o,i),ke=null,xt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){ve(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)uT(e,t),e=e.sibling}function uT(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ct(e,t),zt(t),r&4){try{zs(3,t,t.return),Lc(3,t)}catch(v){ve(t,t.return,v)}try{zs(5,t,t.return)}catch(v){ve(t,t.return,v)}}break;case 1:Ct(e,t),zt(t),r&512&&n!==null&&pi(n,n.return);break;case 5:if(Ct(e,t),zt(t),r&512&&n!==null&&pi(n,n.return),t.flags&32){var i=t.stateNode;try{Gs(i,"")}catch(v){ve(t,t.return,v)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&I0(i,s),Vh(a,o);var c=Vh(a,s);for(o=0;o<l.length;o+=2){var u=l[o],h=l[o+1];u==="style"?D0(i,h):u==="dangerouslySetInnerHTML"?k0(i,h):u==="children"?Gs(i,h):Nd(i,u,h,c)}switch(a){case"input":Dh(i,s);break;case"textarea":O0(i,s);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?Si(i,!!s.multiple,d,!1):f!==!!s.multiple&&(s.defaultValue!=null?Si(i,!!s.multiple,s.defaultValue,!0):Si(i,!!s.multiple,s.multiple?[]:"",!1))}i[lo]=s}catch(v){ve(t,t.return,v)}}break;case 6:if(Ct(e,t),zt(t),r&4){if(t.stateNode===null)throw Error(B(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(v){ve(t,t.return,v)}}break;case 3:if(Ct(e,t),zt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{ro(e.containerInfo)}catch(v){ve(t,t.return,v)}break;case 4:Ct(e,t),zt(t);break;case 13:Ct(e,t),zt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(fp=we())),r&4&&m_(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(He=(c=He)||u,Ct(e,t),He=c):Ct(e,t),zt(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for($=t,u=t.child;u!==null;){for(h=$=u;$!==null;){switch(f=$,d=f.child,f.tag){case 0:case 11:case 14:case 15:zs(4,f,f.return);break;case 1:pi(f,f.return);var _=f.stateNode;if(typeof _.componentWillUnmount=="function"){r=f,n=f.return;try{e=r,_.props=e.memoizedProps,_.state=e.memoizedState,_.componentWillUnmount()}catch(v){ve(r,n,v)}}break;case 5:pi(f,f.return);break;case 22:if(f.memoizedState!==null){v_(h);continue}}d!==null?(d.return=f,$=d):v_(h)}u=u.sibling}e:for(u=null,h=t;;){if(h.tag===5){if(u===null){u=h;try{i=h.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=h.stateNode,l=h.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=F0("display",o))}catch(v){ve(t,t.return,v)}}}else if(h.tag===6){if(u===null)try{h.stateNode.nodeValue=c?"":h.memoizedProps}catch(v){ve(t,t.return,v)}}else if((h.tag!==22&&h.tag!==23||h.memoizedState===null||h===t)&&h.child!==null){h.child.return=h,h=h.child;continue}if(h===t)break e;for(;h.sibling===null;){if(h.return===null||h.return===t)break e;u===h&&(u=null),h=h.return}u===h&&(u=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:Ct(e,t),zt(t),r&4&&m_(t);break;case 21:break;default:Ct(e,t),zt(t)}}function zt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(lT(n)){var r=n;break e}n=n.return}throw Error(B(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Gs(i,""),r.flags&=-33);var s=__(t);yf(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=__(t);mf(t,a,o);break;default:throw Error(B(161))}}catch(l){ve(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function IA(t,e,n){$=t,hT(t)}function hT(t,e,n){for(var r=(t.mode&1)!==0;$!==null;){var i=$,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||pa;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||He;a=pa;var c=He;if(pa=o,(He=l)&&!c)for($=i;$!==null;)o=$,l=o.child,o.tag===22&&o.memoizedState!==null?T_(i):l!==null?(l.return=o,$=l):T_(i);for(;s!==null;)$=s,hT(s),s=s.sibling;$=i,pa=a,He=c}y_(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,$=s):y_(t)}}function y_(t){for(;$!==null;){var e=$;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:He||Lc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!He)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Pt(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&t_(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}t_(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var h=u.dehydrated;h!==null&&ro(h)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(B(163))}He||e.flags&512&&_f(e)}catch(f){ve(e,e.return,f)}}if(e===t){$=null;break}if(n=e.sibling,n!==null){n.return=e.return,$=n;break}$=e.return}}function v_(t){for(;$!==null;){var e=$;if(e===t){$=null;break}var n=e.sibling;if(n!==null){n.return=e.return,$=n;break}$=e.return}}function T_(t){for(;$!==null;){var e=$;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Lc(4,e)}catch(l){ve(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){ve(e,i,l)}}var s=e.return;try{_f(e)}catch(l){ve(e,s,l)}break;case 5:var o=e.return;try{_f(e)}catch(l){ve(e,o,l)}}}catch(l){ve(e,e.return,l)}if(e===t){$=null;break}var a=e.sibling;if(a!==null){a.return=e.return,$=a;break}$=e.return}}var OA=Math.ceil,yl=An.ReactCurrentDispatcher,up=An.ReactCurrentOwner,wt=An.ReactCurrentBatchConfig,te=0,Ie=null,Re=null,De=0,ot=0,gi=ir(0),Ce=0,go=null,Or=0,zc=0,hp=0,Vs=null,et=null,fp=0,Li=1/0,ln=null,vl=!1,vf=null,Kn=null,ga=!1,Un=null,Tl=0,js=0,Tf=null,$a=-1,Xa=0;function qe(){return te&6?we():$a!==-1?$a:$a=we()}function qn(t){return t.mode&1?te&2&&De!==0?De&-De:gA.transition!==null?(Xa===0&&(Xa=K0()),Xa):(t=re,t!==0||(t=window.event,t=t===void 0?16:tv(t.type)),t):1}function kt(t,e,n,r){if(50<js)throw js=0,Tf=null,Error(B(185));Mo(t,n,r),(!(te&2)||t!==Ie)&&(t===Ie&&(!(te&2)&&(zc|=n),Ce===4&&Dn(t,De)),it(t,r),n===1&&te===0&&!(e.mode&1)&&(Li=we()+500,Dc&&sr()))}function it(t,e){var n=t.callbackNode;g1(t,e);var r=rl(t,t===Ie?De:0);if(r===0)n!==null&&xg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&xg(n),e===1)t.tag===0?pA(w_.bind(null,t)):Tv(w_.bind(null,t)),uA(function(){!(te&6)&&sr()}),n=null;else{switch(q0(r)){case 1:n=Ud;break;case 4:n=X0;break;case 16:n=nl;break;case 536870912:n=Y0;break;default:n=nl}n=vT(n,fT.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function fT(t,e){if($a=-1,Xa=0,te&6)throw Error(B(327));var n=t.callbackNode;if(Pi()&&t.callbackNode!==n)return null;var r=rl(t,t===Ie?De:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=wl(t,r);else{e=r;var i=te;te|=2;var s=pT();(Ie!==t||De!==e)&&(ln=null,Li=we()+500,Er(t,e));do try{FA();break}catch(a){dT(t,a)}while(1);Qd(),yl.current=s,te=i,Re!==null?e=0:(Ie=null,De=0,e=Ce)}if(e!==0){if(e===2&&(i=Xh(t),i!==0&&(r=i,e=wf(t,i))),e===1)throw n=go,Er(t,0),Dn(t,r),it(t,we()),n;if(e===6)Dn(t,r);else{if(i=t.current.alternate,!(r&30)&&!NA(i)&&(e=wl(t,r),e===2&&(s=Xh(t),s!==0&&(r=s,e=wf(t,s))),e===1))throw n=go,Er(t,0),Dn(t,r),it(t,we()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(B(345));case 2:fr(t,et,ln);break;case 3:if(Dn(t,r),(r&130023424)===r&&(e=fp+500-we(),10<e)){if(rl(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){qe(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=ef(fr.bind(null,t,et,ln),e);break}fr(t,et,ln);break;case 4:if(Dn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Nt(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=we()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*OA(r/1960))-r,10<r){t.timeoutHandle=ef(fr.bind(null,t,et,ln),r);break}fr(t,et,ln);break;case 5:fr(t,et,ln);break;default:throw Error(B(329))}}}return it(t,we()),t.callbackNode===n?fT.bind(null,t):null}function wf(t,e){var n=Vs;return t.current.memoizedState.isDehydrated&&(Er(t,e).flags|=256),t=wl(t,e),t!==2&&(e=et,et=n,e!==null&&Ef(e)),t}function Ef(t){et===null?et=t:et.push.apply(et,t)}function NA(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Dt(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Dn(t,e){for(e&=~hp,e&=~zc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Nt(e),r=1<<n;t[n]=-1,e&=~r}}function w_(t){if(te&6)throw Error(B(327));Pi();var e=rl(t,0);if(!(e&1))return it(t,we()),null;var n=wl(t,e);if(t.tag!==0&&n===2){var r=Xh(t);r!==0&&(e=r,n=wf(t,r))}if(n===1)throw n=go,Er(t,0),Dn(t,e),it(t,we()),n;if(n===6)throw Error(B(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,fr(t,et,ln),it(t,we()),null}function dp(t,e){var n=te;te|=1;try{return t(e)}finally{te=n,te===0&&(Li=we()+500,Dc&&sr())}}function Nr(t){Un!==null&&Un.tag===0&&!(te&6)&&Pi();var e=te;te|=1;var n=wt.transition,r=re;try{if(wt.transition=null,re=1,t)return t()}finally{re=r,wt.transition=n,te=e,!(te&6)&&sr()}}function pp(){ot=gi.current,ue(gi)}function Er(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,cA(n)),Re!==null)for(n=Re.return;n!==null;){var r=n;switch(Kd(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ll();break;case 3:Bi(),ue(nt),ue($e),rp();break;case 5:np(r);break;case 4:Bi();break;case 13:ue(pe);break;case 19:ue(pe);break;case 10:Jd(r.type._context);break;case 22:case 23:pp()}n=n.return}if(Ie=t,Re=t=Zn(t.current,null),De=ot=e,Ce=0,go=null,hp=zc=Or=0,et=Vs=null,mr!==null){for(e=0;e<mr.length;e++)if(n=mr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}mr=null}return t}function dT(t,e){do{var n=Re;try{if(Qd(),ja.current=ml,_l){for(var r=_e.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}_l=!1}if(Ir=0,Me=be=_e=null,Ls=!1,ho=0,up.current=null,n===null||n.return===null){Ce=1,go=e,Re=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=De,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,h=u.tag;if(!(u.mode&1)&&(h===0||h===11||h===15)){var f=u.alternate;f?(u.updateQueue=f.updateQueue,u.memoizedState=f.memoizedState,u.lanes=f.lanes):(u.updateQueue=null,u.memoizedState=null)}var d=l_(o);if(d!==null){d.flags&=-257,c_(d,o,a,s,e),d.mode&1&&a_(s,c,e),e=d,l=c;var _=e.updateQueue;if(_===null){var v=new Set;v.add(l),e.updateQueue=v}else _.add(l);break e}else{if(!(e&1)){a_(s,c,e),gp();break e}l=Error(B(426))}}else if(fe&&a.mode&1){var A=l_(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),c_(A,o,a,s,e),qd(Ui(l,a));break e}}s=l=Ui(l,a),Ce!==4&&(Ce=2),Vs===null?Vs=[s]:Vs.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var p=Zv(s,l,e);e_(s,p);break e;case 1:a=l;var g=s.type,m=s.stateNode;if(!(s.flags&128)&&(typeof g.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(Kn===null||!Kn.has(m)))){s.flags|=65536,e&=-e,s.lanes|=e;var E=Qv(s,a,e);e_(s,E);break e}}s=s.return}while(s!==null)}_T(n)}catch(b){e=b,Re===n&&n!==null&&(Re=n=n.return);continue}break}while(1)}function pT(){var t=yl.current;return yl.current=ml,t===null?ml:t}function gp(){(Ce===0||Ce===3||Ce===2)&&(Ce=4),Ie===null||!(Or&268435455)&&!(zc&268435455)||Dn(Ie,De)}function wl(t,e){var n=te;te|=2;var r=pT();(Ie!==t||De!==e)&&(ln=null,Er(t,e));do try{kA();break}catch(i){dT(t,i)}while(1);if(Qd(),te=n,yl.current=r,Re!==null)throw Error(B(261));return Ie=null,De=0,Ce}function kA(){for(;Re!==null;)gT(Re)}function FA(){for(;Re!==null&&!o1();)gT(Re)}function gT(t){var e=yT(t.alternate,t,ot);t.memoizedProps=t.pendingProps,e===null?_T(t):Re=e,up.current=null}function _T(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=PA(n,e),n!==null){n.flags&=32767,Re=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Ce=6,Re=null;return}}else if(n=CA(n,e,ot),n!==null){Re=n;return}if(e=e.sibling,e!==null){Re=e;return}Re=e=t}while(e!==null);Ce===0&&(Ce=5)}function fr(t,e,n){var r=re,i=wt.transition;try{wt.transition=null,re=1,DA(t,e,n,r)}finally{wt.transition=i,re=r}return null}function DA(t,e,n,r){do Pi();while(Un!==null);if(te&6)throw Error(B(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(B(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(_1(t,s),t===Ie&&(Re=Ie=null,De=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||ga||(ga=!0,vT(nl,function(){return Pi(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=wt.transition,wt.transition=null;var o=re;re=1;var a=te;te|=4,up.current=null,MA(t,n),uT(n,t),nA(Jh),il=!!Qh,Jh=Qh=null,t.current=n,IA(n),a1(),te=a,re=o,wt.transition=s}else t.current=n;if(ga&&(ga=!1,Un=t,Tl=i),s=t.pendingLanes,s===0&&(Kn=null),u1(n.stateNode),it(t,we()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(vl)throw vl=!1,t=vf,vf=null,t;return Tl&1&&t.tag!==0&&Pi(),s=t.pendingLanes,s&1?t===Tf?js++:(js=0,Tf=t):js=0,sr(),null}function Pi(){if(Un!==null){var t=q0(Tl),e=wt.transition,n=re;try{if(wt.transition=null,re=16>t?16:t,Un===null)var r=!1;else{if(t=Un,Un=null,Tl=0,te&6)throw Error(B(331));var i=te;for(te|=4,$=t.current;$!==null;){var s=$,o=s.child;if($.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for($=c;$!==null;){var u=$;switch(u.tag){case 0:case 11:case 15:zs(8,u,s)}var h=u.child;if(h!==null)h.return=u,$=h;else for(;$!==null;){u=$;var f=u.sibling,d=u.return;if(aT(u),u===c){$=null;break}if(f!==null){f.return=d,$=f;break}$=d}}}var _=s.alternate;if(_!==null){var v=_.child;if(v!==null){_.child=null;do{var A=v.sibling;v.sibling=null,v=A}while(v!==null)}}$=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,$=o;else e:for(;$!==null;){if(s=$,s.flags&2048)switch(s.tag){case 0:case 11:case 15:zs(9,s,s.return)}var p=s.sibling;if(p!==null){p.return=s.return,$=p;break e}$=s.return}}var g=t.current;for($=g;$!==null;){o=$;var m=o.child;if(o.subtreeFlags&2064&&m!==null)m.return=o,$=m;else e:for(o=g;$!==null;){if(a=$,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Lc(9,a)}}catch(b){ve(a,a.return,b)}if(a===o){$=null;break e}var E=a.sibling;if(E!==null){E.return=a.return,$=E;break e}$=a.return}}if(te=i,sr(),Jt&&typeof Jt.onPostCommitFiberRoot=="function")try{Jt.onPostCommitFiberRoot(Ic,t)}catch{}r=!0}return r}finally{re=n,wt.transition=e}}return!1}function E_(t,e,n){e=Ui(n,e),e=Zv(t,e,1),t=Yn(t,e,1),e=qe(),t!==null&&(Mo(t,1,e),it(t,e))}function ve(t,e,n){if(t.tag===3)E_(t,t,n);else for(;e!==null;){if(e.tag===3){E_(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Kn===null||!Kn.has(r))){t=Ui(n,t),t=Qv(e,t,1),e=Yn(e,t,1),t=qe(),e!==null&&(Mo(e,1,t),it(e,t));break}}e=e.return}}function BA(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=qe(),t.pingedLanes|=t.suspendedLanes&n,Ie===t&&(De&n)===n&&(Ce===4||Ce===3&&(De&130023424)===De&&500>we()-fp?Er(t,0):hp|=n),it(t,e)}function mT(t,e){e===0&&(t.mode&1?(e=sa,sa<<=1,!(sa&130023424)&&(sa=4194304)):e=1);var n=qe();t=vn(t,e),t!==null&&(Mo(t,e,n),it(t,n))}function UA(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),mT(t,n)}function LA(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(B(314))}r!==null&&r.delete(e),mT(t,n)}var yT;yT=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||nt.current)tt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return tt=!1,bA(t,e,n);tt=!!(t.flags&131072)}else tt=!1,fe&&e.flags&1048576&&wv(e,hl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ha(t,e),t=e.pendingProps;var i=ki(e,$e.current);Ci(e,n),i=sp(null,e,r,t,i,n);var s=op();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,rt(r)?(s=!0,cl(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,ep(e),i.updater=Bc,e.stateNode=i,i._reactInternals=e,lf(e,r,t,n),e=hf(null,e,r,!0,s,n)):(e.tag=0,fe&&s&&Yd(e),Ye(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Ha(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=VA(r),t=Pt(r,t),i){case 0:e=uf(null,e,r,t,n);break e;case 1:e=f_(null,e,r,t,n);break e;case 11:e=u_(null,e,r,t,n);break e;case 14:e=h_(null,e,r,Pt(r.type,t),n);break e}throw Error(B(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pt(r,i),uf(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pt(r,i),f_(t,e,r,i,n);case 3:e:{if(tT(e),t===null)throw Error(B(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Rv(t,e),pl(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ui(Error(B(423)),e),e=d_(t,e,r,n,i);break e}else if(r!==i){i=Ui(Error(B(424)),e),e=d_(t,e,r,n,i);break e}else for(lt=Xn(e.stateNode.containerInfo.firstChild),ht=e,fe=!0,Mt=null,n=xv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Fi(),r===i){e=Tn(t,e,n);break e}Ye(t,e,r,n)}e=e.child}return e;case 5:return Mv(e),t===null&&sf(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Gh(r,i)?o=null:s!==null&&Gh(r,s)&&(e.flags|=32),eT(t,e),Ye(t,e,o,n),e.child;case 6:return t===null&&sf(e),null;case 13:return nT(t,e,n);case 4:return tp(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Di(e,null,r,n):Ye(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pt(r,i),u_(t,e,r,i,n);case 7:return Ye(t,e,e.pendingProps,n),e.child;case 8:return Ye(t,e,e.pendingProps.children,n),e.child;case 12:return Ye(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,ae(fl,r._currentValue),r._currentValue=o,s!==null)if(Dt(s.value,o)){if(s.children===i.children&&!nt.current){e=Tn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=_n(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),of(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(B(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),of(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ye(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,Ci(e,n),i=St(i),r=r(i),e.flags|=1,Ye(t,e,r,n),e.child;case 14:return r=e.type,i=Pt(r,e.pendingProps),i=Pt(r.type,i),h_(t,e,r,i,n);case 15:return Jv(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Pt(r,i),Ha(t,e),e.tag=1,rt(r)?(t=!0,cl(e)):t=!1,Ci(e,n),Cv(e,r,i),lf(e,r,i,n),hf(null,e,r,!0,t,n);case 19:return rT(t,e,n);case 22:return Gv(t,e,n)}throw Error(B(156,e.tag))};function vT(t,e){return $0(t,e)}function zA(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function vt(t,e,n,r){return new zA(t,e,n,r)}function _p(t){return t=t.prototype,!(!t||!t.isReactComponent)}function VA(t){if(typeof t=="function")return _p(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Fd)return 11;if(t===Dd)return 14}return 2}function Zn(t,e){var n=t.alternate;return n===null?(n=vt(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Ya(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")_p(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case si:return Sr(n.children,i,s,e);case kd:o=8,i|=8;break;case Ih:return t=vt(12,n,e,i|2),t.elementType=Ih,t.lanes=s,t;case Oh:return t=vt(13,n,e,i),t.elementType=Oh,t.lanes=s,t;case Nh:return t=vt(19,n,e,i),t.elementType=Nh,t.lanes=s,t;case P0:return Vc(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case b0:o=10;break e;case C0:o=9;break e;case Fd:o=11;break e;case Dd:o=14;break e;case On:o=16,r=null;break e}throw Error(B(130,t==null?t:typeof t,""))}return e=vt(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function Sr(t,e,n,r){return t=vt(7,t,r,e),t.lanes=n,t}function Vc(t,e,n,r){return t=vt(22,t,r,e),t.elementType=P0,t.lanes=n,t.stateNode={isHidden:!1},t}function ju(t,e,n){return t=vt(6,t,null,e),t.lanes=n,t}function Wu(t,e,n){return e=vt(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function jA(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Su(0),this.expirationTimes=Su(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Su(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function mp(t,e,n,r,i,s,o,a,l){return t=new jA(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=vt(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ep(s),t}function WA(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ii,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function TT(t){if(!t)return er;t=t._reactInternals;e:{if(Vr(t)!==t||t.tag!==1)throw Error(B(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(rt(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(B(171))}if(t.tag===1){var n=t.type;if(rt(n))return vv(t,n,e)}return e}function wT(t,e,n,r,i,s,o,a,l){return t=mp(n,r,!0,t,i,s,o,a,l),t.context=TT(null),n=t.current,r=qe(),i=qn(n),s=_n(r,i),s.callback=e??null,Yn(n,s,i),t.current.lanes=i,Mo(t,i,r),it(t,r),t}function jc(t,e,n,r){var i=e.current,s=qe(),o=qn(i);return n=TT(n),e.context===null?e.context=n:e.pendingContext=n,e=_n(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Yn(i,e,o),t!==null&&(kt(t,i,o,s),Va(t,i,o)),o}function El(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function S_(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function yp(t,e){S_(t,e),(t=t.alternate)&&S_(t,e)}function HA(){return null}var ET=typeof reportError=="function"?reportError:function(t){console.error(t)};function vp(t){this._internalRoot=t}Wc.prototype.render=vp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(B(409));jc(t,e,null,null)};Wc.prototype.unmount=vp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Nr(function(){jc(null,t,null,null)}),e[yn]=null}};function Wc(t){this._internalRoot=t}Wc.prototype.unstable_scheduleHydration=function(t){if(t){var e=J0();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Fn.length&&e!==0&&e<Fn[n].priority;n++);Fn.splice(n,0,t),n===0&&ev(t)}};function Tp(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Hc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function A_(){}function $A(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=El(o);s.call(c)}}var o=wT(e,r,t,0,null,!1,!1,"",A_);return t._reactRootContainer=o,t[yn]=o.current,oo(t.nodeType===8?t.parentNode:t),Nr(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=El(l);a.call(c)}}var l=mp(t,0,!1,null,null,!1,!1,"",A_);return t._reactRootContainer=l,t[yn]=l.current,oo(t.nodeType===8?t.parentNode:t),Nr(function(){jc(e,l,n,r)}),l}function $c(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=El(o);a.call(l)}}jc(e,o,t,i)}else o=$A(n,e,t,i,r);return El(o)}Z0=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=bs(e.pendingLanes);n!==0&&(Ld(e,n|1),it(e,we()),!(te&6)&&(Li=we()+500,sr()))}break;case 13:Nr(function(){var r=vn(t,1);if(r!==null){var i=qe();kt(r,t,1,i)}}),yp(t,1)}};zd=function(t){if(t.tag===13){var e=vn(t,134217728);if(e!==null){var n=qe();kt(e,t,134217728,n)}yp(t,134217728)}};Q0=function(t){if(t.tag===13){var e=qn(t),n=vn(t,e);if(n!==null){var r=qe();kt(n,t,e,r)}yp(t,e)}};J0=function(){return re};G0=function(t,e){var n=re;try{return re=t,e()}finally{re=n}};Wh=function(t,e,n){switch(e){case"input":if(Dh(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Fc(r);if(!i)throw Error(B(90));M0(r),Dh(r,i)}}}break;case"textarea":O0(t,n);break;case"select":e=n.value,e!=null&&Si(t,!!n.multiple,e,!1)}};L0=dp;z0=Nr;var XA={usingClientEntryPoint:!1,Events:[Oo,ci,Fc,B0,U0,dp]},_s={findFiberByHostInstance:_r,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},YA={bundleType:_s.bundleType,version:_s.version,rendererPackageName:_s.rendererPackageName,rendererConfig:_s.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:An.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=W0(t),t===null?null:t.stateNode},findFiberByHostInstance:_s.findFiberByHostInstance||HA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var _a=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!_a.isDisabled&&_a.supportsFiber)try{Ic=_a.inject(YA),Jt=_a}catch{}}dt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XA;dt.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tp(e))throw Error(B(200));return WA(t,e,null,n)};dt.createRoot=function(t,e){if(!Tp(t))throw Error(B(299));var n=!1,r="",i=ET;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=mp(t,1,!1,null,null,n,!1,r,i),t[yn]=e.current,oo(t.nodeType===8?t.parentNode:t),new vp(e)};dt.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(B(188)):(t=Object.keys(t).join(","),Error(B(268,t)));return t=W0(e),t=t===null?null:t.stateNode,t};dt.flushSync=function(t){return Nr(t)};dt.hydrate=function(t,e,n){if(!Hc(e))throw Error(B(200));return $c(null,t,e,!0,n)};dt.hydrateRoot=function(t,e,n){if(!Tp(t))throw Error(B(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=ET;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=wT(e,null,t,1,n??null,i,!1,s,o),t[yn]=e.current,oo(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new Wc(e)};dt.render=function(t,e,n){if(!Hc(e))throw Error(B(200));return $c(null,t,e,!1,n)};dt.unmountComponentAtNode=function(t){if(!Hc(t))throw Error(B(40));return t._reactRootContainer?(Nr(function(){$c(null,null,t,!1,function(){t._reactRootContainer=null,t[yn]=null})}),!0):!1};dt.unstable_batchedUpdates=dp;dt.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Hc(n))throw Error(B(200));if(t==null||t._reactInternals===void 0)throw Error(B(38));return $c(t,e,n,!1,r)};dt.version="18.2.0-next-9e3b772b8-20220608";function ST(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(ST)}catch(t){console.error(t)}}ST(),w0.exports=dt;var wp=w0.exports,AT,R_=wp;AT=R_.createRoot,R_.hydrateRoot;const KA="modulepreload",qA=function(t){return"/"+t},b_={},ZA=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=qA(s),s in b_)return;b_[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const h=i[u];if(h.href===s&&(!o||h.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":KA,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,h)=>{c.addEventListener("load",u),c.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},QA=V.createContext(null);function JA(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function hn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!hn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!hn(t[i],e[i]))return!1;return!0}return!1}function GA(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function C_(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();hn(n,r)||e.setProjection(n)}function P_(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function x_(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const eR=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function M_(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of eR)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}const I_={version:8,sources:{},layers:[]},O_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Hu={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},N_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},tR=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],nR=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class zi{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[N_[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[O_[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Hu[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=zi.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=I_}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||rR()||null,container:e,style:M_(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),C_(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in O_)o.on(u,this._onPointerEvent);for(const u in Hu)o.on(u,this._onCameraEvent);for(const u in N_)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),zi.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=GA(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,l=r.isMoving();l&&(i.cameraElevationReference="sea");const c=x_(i,{...P_(r.transform),...e});if(l&&(i.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==i.zoom),u.rotate||(u.rotate=a!==i.bearing),u.pitch||(u.pitch=o!==i.pitch)}return l||x_(r.transform,e),c}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of tR)if(s in e&&!hn(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=I_,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(M_(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!hn(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!hn(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!hn(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of nR){const l=(r=e[a])!==null&&r!==void 0?r:!0,c=(i=n[a])!==null&&i!==void 0?i:!0;hn(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Hu&&(typeof n=="object"&&(n.viewState=P_(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{C_(this._renderTransform,n),e.transform=n}}}zi.savedMaps=[];function rR(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const iR=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function sR(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of oR(e))!(r in n)&&!iR.includes(r)&&(n[r]=e[r].bind(e));return n}function oR(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const aR=typeof document<"u"?V.useLayoutEffect:V.useEffect,lR=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function cR(t,e){for(const r of lR)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const Xc=V.createContext(null);function uR(t,e,n){const r=V.useContext(QA),[i,s]=V.useState(null),o=V.useRef(),{current:a}=V.useRef({mapLib:null,map:null});V.useEffect(()=>{const u=t.mapLib;let h=!0,f;return Promise.resolve(u||n).then(d=>{if(!h)return;if(!d)throw new Error("Invalid mapLib");const _="Map"in d?d:d.default;if(!_.Map)throw new Error("Invalid mapLib");if(cR(_,t),!_.supported||_.supported(t))t.reuseMaps&&(f=zi.reuse(t,o.current)),f||(f=new zi(_.Map,t,o.current)),a.map=sR(f),a.mapLib=_,s(f),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(d=>{const{onError:_}=t;_?_({type:"error",target:null,originalEvent:null,error:d}):console.error(d)}),()=>{h=!1,f&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?f.recycle():f.destroy())}},[]),aR(()=>{i&&i.setProps(t)}),V.useImperativeHandle(e,()=>a.map,[i]);const l=V.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return V.createElement("div",{id:t.id,ref:o,style:l},i&&V.createElement(Xc.Provider,{value:a},V.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const hR=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function jr(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!hR.test(r)?n[r]=`${i}px`:n[r]=i}}function fR(t,e){const{map:n,mapLib:r}=V.useContext(Xc),i=V.useRef({props:t});i.current.props=t;const s=V.useMemo(()=>{let v=!1;V.Children.forEach(t.children,g=>{g&&(v=!0)});const A={...t,element:v?document.createElement("div"):null},p=new r.Marker(A);return p.setLngLat([t.longitude,t.latitude]),p.getElement().addEventListener("click",g=>{var m,E;(E=(m=i.current.props).onClick)===null||E===void 0||E.call(m,{type:"click",target:p,originalEvent:g})}),p.on("dragstart",g=>{var m,E;const b=g;b.lngLat=s.getLngLat(),(E=(m=i.current.props).onDragStart)===null||E===void 0||E.call(m,b)}),p.on("drag",g=>{var m,E;const b=g;b.lngLat=s.getLngLat(),(E=(m=i.current.props).onDrag)===null||E===void 0||E.call(m,b)}),p.on("dragend",g=>{var m,E;const b=g;b.lngLat=s.getLngLat(),(E=(m=i.current.props).onDragEnd)===null||E===void 0||E.call(m,b)}),p},[]);V.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:h=null,rotation:f=0,rotationAlignment:d="auto",pitchAlignment:_="auto"}=t;return V.useEffect(()=>{jr(s.getElement(),c)},[c]),V.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!JA(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==f&&s.setRotation(f),s.getRotationAlignment()!==d&&s.setRotationAlignment(d),s.getPitchAlignment()!==_&&s.setPitchAlignment(_),s.getPopup()!==h&&s.setPopup(h),wp.createPortal(t.children,s.getElement())}V.memo(V.forwardRef(fR));function k_(t){return new Set(t?t.trim().split(/\s+/):[])}function dR(t,e){const{map:n,mapLib:r}=V.useContext(Xc),i=V.useMemo(()=>document.createElement("div"),[]),s=V.useRef({props:t});s.current.props=t;const o=V.useMemo(()=>{const a={...t},l=new r.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,h;(h=(u=s.current.props).onOpen)===null||h===void 0||h.call(u,c)}),l},[]);if(V.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),V.useEffect(()=>{jr(o.getElement(),t.style)},[t.style]),V.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!hn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=k_(o.options.className),l=k_(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return wp.createPortal(t.children,i)}V.memo(V.forwardRef(dR));function ko(t,e,n,r){const i=V.useContext(Xc),s=V.useMemo(()=>t(i),[]);return V.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=i;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{l&&l(i),c.hasControl(s)&&c.removeControl(s)}},[]),s}function pR(t){const e=ko(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return V.useEffect(()=>{jr(e._container,t.style)},[t.style]),null}V.memo(pR);function gR(t){const e=ko(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return V.useEffect(()=>{jr(e._controlContainer,t.style)},[t.style]),null}V.memo(gR);function _R(t,e){const n=V.useRef({props:t}),r=ko(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,V.useImperativeHandle(e,()=>r,[]),V.useEffect(()=>{jr(r._container,t.style)},[t.style]),null}V.memo(V.forwardRef(_R));function mR(t){const e=ko(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return V.useEffect(()=>{jr(e._container,t.style)},[t.style]),null}V.memo(mR);function yR(t){const e=ko(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=V.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),V.useEffect(()=>{jr(e._container,i)},[i]),null}V.memo(yR);const vR=ZA(()=>import("./maplibre-gl-0aa4fea0.js").then(t=>t.m),[]),TR=(()=>V.forwardRef(function(e,n){return uR(e,n,vR)}))(),F_=100;class wR{constructor(e,n){if(this.schema=void 0,this.options=void 0,this.shape=void 0,this.length=0,this.rows=null,this.cursor=0,this._headers=[],this.options=n,this.schema=e,!Array.isArray(e)){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.shape="array-row-table",this.rows=this.rows||new Array(F_),this.rows[this.length]=e,this.length++}addObjectRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.shape="object-row-table",this.rows=this.rows||new Array(F_),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function RT(t,e){if(!t)throw new Error("null row");const n={};if(e)for(let r=0;r<e.length;r++)n[e[r]]=t[r];else for(let r=0;r<t.length;r++){const i=`column-${r}`;n[i]=t[r]}return n}function bT(t,e){if(!t)throw new Error("null row");if(e){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}return Object.values(t)}function ER(t){const e=[];for(let n=0;n<t.length;n++){const r=`column-${n}`;e.push(r)}return e}function SR(t){return Object.keys(t)}const D_=100;class AR{constructor(e,n){if(this.schema=void 0,this.options=void 0,this.length=0,this.objectRows=null,this.arrayRows=null,this.cursor=0,this._headers=null,this.options=n,this.schema=e,e){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=ER(e)),this.options.shape){case"object-row-table":const r=RT(e,this._headers);this.addObjectRow(r,n);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(D_),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=SR(e)),this.options.shape){case"array-row-table":const r=bT(e,this._headers);this.addArrayRow(r,n);break;case"object-row-table":this.objectRows=this.objectRows||new Array(D_),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const RR=100;class bR{constructor(e,n){this.schema=void 0,this.length=0,this.allocated=0,this.columns={},this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let n=0;for(const r in this.columns)this.columns[r][this.length]=e[n++];this.length++}addObjectRow(e){this._reallocateColumns();for(const n in e)this.columns[n][this.length]=e[n];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const r in this.schema){const i=this.schema[r];e[i.name]=this.columns[i.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:RR,this.columns={};for(const e in this.schema){const n=this.schema[e],r=n.type||Float32Array,i=this.columns[n.index];if(i&&ArrayBuffer.isView(i)){const s=new r(this.allocated);s.set(i),this.columns[n.index]=s}else i?(i.length=this.allocated,this.columns[n.index]=i):this.columns[n.index]=new r(this.allocated)}}}_pruneColumns(){for(const[e,n]of Object.entries(this.columns))this.columns[e]=n.slice(0,this.length)}}const CR={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},PR="TableBatchBuilder";class _o{constructor(e,n){this.schema=void 0,this.options=void 0,this.aggregator=null,this.batchCount=0,this.bytesUsed=0,this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),this.totalLength=0,this.totalBytes=0,this.rowBytes=0,this.schema=e,this.options={...CR,...n}}limitReached(){var e,n;return!!(!((e=this.options)===null||e===void 0)&&e.limit&&this.totalLength>=this.options.limit||!((n=this.options)===null||n===void 0)&&n._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e!=null&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);const n=this.aggregator.getBatch();return n.count=this.batchCount,n.bytesUsed=this.bytesUsed,Object.assign(n,e),this.batchCount++,this.aggregator=null,n}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return AR;case"columnar-table":return bR;case"arrow-table":if(!_o.ArrowBatch)throw new Error(PR);return _o.ArrowBatch;default:return wR}}}_o.ArrowBatch=void 0;let CT;class B_ extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}CT=Symbol.asyncIterator;class xR{constructor(){this._values=void 0,this._settlers=void 0,this._closed=void 0,this._values=new B_,this._settlers=new B_,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[CT](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const n=this._settlers.dequeue();e instanceof Error?n.reject(e):n.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,n)=>{this._settlers.enqueue({resolve:e,reject:n})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const U_="\uFEFF",qt={parse:MR,unparse:IR,RECORD_SEP:String.fromCharCode(30),UNIT_SEP:String.fromCharCode(31),BYTE_ORDER_MARK:U_,BAD_DELIMITERS:["\r",`
`,'"',U_],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:Sf,ParserHandle:xT,ChunkStreamer:PT,StringStreamer:Vi},Yc=qt;function MR(t,e,n){e=e||{};var r=e.dynamicTyping||!1;if(Ke(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=Ke(e.transform)?e.transform:!1,e.worker&&qt.WORKERS_SUPPORTED){var i=newWorker();i.userStep=e.step,i.userChunk=e.chunk,i.userComplete=e.complete,i.userError=e.error,e.step=Ke(e.step),e.chunk=Ke(e.chunk),e.complete=Ke(e.complete),e.error=Ke(e.error),delete e.worker,i.postMessage({input:t,config:e,workerId:i.id});return}var s=null;return typeof t=="string"&&(s=new Vi(e)),s||(s=new n(e)),s.stream(t)}function IR(t,e){var n=!1,r=!0,i=",",s=`\r
`,o='"',a=o+o,l=!1,c=null;h();var u=new RegExp(mo(o),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return d(null,t,l);if(typeof t[0]=="object")return d(c||f(t[0]),t,l)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:f(t.data[0])),!Array.isArray(t.data[0])&&typeof t.data[0]!="object"&&(t.data=[t.data])),d(t.fields||[],t.data||[],l);throw new Error("Unable to serialize unrecognized input");function h(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!qt.BAD_DELIMITERS.filter(function(A){return e.delimiter.indexOf(A)!==-1}).length&&(i=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(n=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(l=e.skipEmptyLines),typeof e.newline=="string"&&(s=e.newline),typeof e.quoteChar=="string"&&(o=e.quoteChar),typeof e.header=="boolean"&&(r=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");c=e.columns}e.escapeChar!==void 0&&(a=e.escapeChar+o)}}function f(A){if(typeof A!="object")return[];var p=[];for(var g in A)p.push(g);return p}function d(A,p,g){var m="";typeof A=="string"&&(A=JSON.parse(A)),typeof p=="string"&&(p=JSON.parse(p));var E=Array.isArray(A)&&A.length>0,b=!Array.isArray(p[0]);if(E&&r){for(var x=0;x<A.length;x++)x>0&&(m+=i),m+=_(A[x],x);p.length>0&&(m+=s)}for(var O=0;O<p.length;O++){var M=E?A.length:p[O].length,N=!1,k=E?Object.keys(p[O]).length===0:p[O].length===0;if(g&&!E&&(N=g==="greedy"?p[O].join("").trim()==="":p[O].length===1&&p[O][0].length===0),g==="greedy"&&E){for(var z=[],L=0;L<M;L++){var j=b?A[L]:L;z.push(p[O][j])}N=z.join("").trim()===""}if(!N){for(var X=0;X<M;X++){X>0&&!k&&(m+=i);var Z=E&&b?A[X]:X;m+=_(p[O][Z],X)}O<p.length-1&&(!g||M>0&&!k)&&(m+=s)}}return m}function _(A,p){if(typeof A>"u"||A===null)return"";if(A.constructor===Date)return JSON.stringify(A).slice(1,25);A=A.toString().replace(u,a);var g=typeof n=="boolean"&&n||Array.isArray(n)&&n[p]||v(A,qt.BAD_DELIMITERS)||A.indexOf(i)>-1||A.charAt(0)===" "||A.charAt(A.length-1)===" ";return g?o+A+o:A}function v(A,p){for(var g=0;g<p.length;g++)if(A.indexOf(p[g])>-1)return!0;return!1}}function PT(t){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},e.call(this,t),this.parseChunk=function(n,r){if(this.isFirstChunk&&Ke(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(n);i!==void 0&&(n=i)}this.isFirstChunk=!1;var s=this._partialLine+n;this._partialLine="";var o=this._handle.parse(s,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var a=o.meta.cursor;this._finished||(this._partialLine=s.substring(a-this._baseIndex),this._baseIndex=a),o&&o.data&&(this._rowCount+=o.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(Ke(this._config.chunk)&&!r){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return;o=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!this._completed&&l&&Ke(this._config.complete)&&(!o||!o.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),!l&&(!o||!o.meta.paused)&&this._nextChunk(),o}},this._sendError=function(n){Ke(this._config.error)&&this._config.error(n)};function e(n){var r=Ep(n);r.chunkSize=parseInt(r.chunkSize),!n.step&&!n.chunk&&(r.chunkSize=null),this._handle=new xT(r),this._handle.streamer=this,this._config=r}}function Vi(t){t=t||{},PT.call(this,t);var e;this.stream=function(n){return e=n,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var n=this._config.chunkSize,r=n?e.substr(0,n):e;return e=n?e.substr(n):"",this._finished=!e,this.parseChunk(r)}}}Vi.prototype=Object.create(Vi.prototype);Vi.prototype.constructor=Vi;function xT(t){var e=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,n=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,r=this,i=0,s=0,o,a,l=!1,c=!1,u,h=[],f={data:[],errors:[],meta:{}};if(Ke(t.step)){var d=t.step;t.step=function(M){if(f=M,A())v();else{if(v(),!f.data||f.data.length===0)return;i+=M.data.length,t.preview&&i>t.preview?a.abort():d(f,r)}}}this.parse=function(M,N,k){var z=t.quoteChar||'"';if(t.newline||(t.newline=x(M,z)),u=!1,t.delimiter)Ke(t.delimiter)&&(t.delimiter=t.delimiter(M),f.meta.delimiter=t.delimiter);else{var L=b(M,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);L.successful?t.delimiter=L.bestDelimiter:(u=!0,t.delimiter=qt.DefaultDelimiter),f.meta.delimiter=t.delimiter}var j=Ep(t);return t.preview&&t.header&&j.preview++,o=M,a=new Sf(j),f=a.parse(o,N,k),v(),l?{meta:{paused:!0}}:f||{meta:{paused:!1}}},this.paused=function(){return l},this.pause=function(){l=!0,a.abort(),o=o.substr(a.getCharIndex())},this.resume=function(){l=!1,r.streamer.parseChunk(o,!0)},this.aborted=function(){return c},this.abort=function(){c=!0,a.abort(),f.meta.aborted=!0,Ke(t.complete)&&t.complete(f),o=""};function _(M){return t.skipEmptyLines==="greedy"?M.join("").trim()==="":M.length===1&&M[0].length===0}function v(){if(f&&u&&(O("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+qt.DefaultDelimiter+"'"),u=!1),t.skipEmptyLines)for(var M=0;M<f.data.length;M++)_(f.data[M])&&f.data.splice(M--,1);return A()&&p(),E()}function A(){return t.header&&h.length===0}function p(){if(!f)return;function M(k){Ke(t.transformHeader)&&(k=t.transformHeader(k)),h.push(k)}if(Array.isArray(f.data[0])){for(var N=0;A()&&N<f.data.length;N++)f.data[N].forEach(M);f.data.splice(0,1)}else f.data.forEach(M)}function g(M){return t.dynamicTypingFunction&&t.dynamicTyping[M]===void 0&&(t.dynamicTyping[M]=t.dynamicTypingFunction(M)),(t.dynamicTyping[M]||t.dynamicTyping)===!0}function m(M,N){return g(M)?N==="true"||N==="TRUE"?!0:N==="false"||N==="FALSE"?!1:e.test(N)?parseFloat(N):n.test(N)?new Date(N):N===""?null:N:N}function E(){if(!f||!f.data||!t.header&&!t.dynamicTyping&&!t.transform)return f;function M(k,z){var L=t.header?{}:[],j;for(j=0;j<k.length;j++){var X=j,Z=k[j];t.header&&(X=j>=h.length?"__parsed_extra":h[j]),t.transform&&(Z=t.transform(Z,X)),Z=m(X,Z),X==="__parsed_extra"?(L[X]=L[X]||[],L[X].push(Z)):L[X]=Z}return t.header&&(j>h.length?O("FieldMismatch","TooManyFields","Too many fields: expected "+h.length+" fields but parsed "+j,s+z):j<h.length&&O("FieldMismatch","TooFewFields","Too few fields: expected "+h.length+" fields but parsed "+j,s+z)),L}var N=1;return!f.data[0]||Array.isArray(f.data[0])?(f.data=f.data.map(M),N=f.data.length):f.data=M(f.data,0),t.header&&f.meta&&(f.meta.fields=h),s+=N,f}function b(M,N,k,z,L){var j,X,Z;L=L||[",","	","|",";",qt.RECORD_SEP,qt.UNIT_SEP];for(var Je=0;Je<L.length;Je++){var Ue=L[Je],W=0,Y=0,q=0;Z=void 0;for(var K=new Sf({comments:z,delimiter:Ue,newline:N,preview:10}).parse(M),J=0;J<K.data.length;J++){if(k&&_(K.data[J])){q++;continue}var he=K.data[J].length;if(Y+=he,typeof Z>"u"){Z=0;continue}else he>1&&(W+=Math.abs(he-Z),Z=he)}K.data.length>0&&(Y/=K.data.length-q),(typeof X>"u"||W>X)&&Y>1.99&&(X=W,j=Ue)}return t.delimiter=j,{successful:!!j,bestDelimiter:j}}function x(M,N){M=M.substr(0,1024*1024);var k=new RegExp(mo(N)+"([^]*?)"+mo(N),"gm");M=M.replace(k,"");var z=M.split("\r"),L=M.split(`
`),j=L.length>1&&L[0].length<z[0].length;if(z.length===1||j)return`
`;for(var X=0,Z=0;Z<z.length;Z++)z[Z][0]===`
`&&X++;return X>=z.length/2?`\r
`:"\r"}function O(M,N,k,z){f.errors.push({type:M,code:N,message:k,row:z})}}function mo(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Sf(t){t=t||{};var e=t.delimiter,n=t.newline,r=t.comments,i=t.step,s=t.preview,o=t.fastMode,a;t.quoteChar===void 0?a='"':a=t.quoteChar;var l=a;if(t.escapeChar!==void 0&&(l=t.escapeChar),(typeof e!="string"||qt.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),r===e)throw new Error("Comment character same as delimiter");r===!0?r="#":(typeof r!="string"||qt.BAD_DELIMITERS.indexOf(r)>-1)&&(r=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var c=0,u=!1;this.parse=function(h,f,d){if(typeof h!="string")throw new Error("Input must be a string");var _=h.length,v=e.length,A=n.length,p=r.length,g=Ke(i);c=0;var m=[],E=[],b=[],x=0;if(!h)return K();if(o||o!==!1&&h.indexOf(a)===-1){for(var O=h.split(n),M=0;M<O.length;M++){if(b=O[M],c+=b.length,M!==O.length-1)c+=n.length;else if(d)return K();if(!(r&&b.substr(0,p)===r)){if(g){if(m=[],Ue(b.split(e)),J(),u)return K()}else Ue(b.split(e));if(s&&M>=s)return m=m.slice(0,s),K(!0)}}return K()}for(var N=h.indexOf(e,c),k=h.indexOf(n,c),z=new RegExp(mo(l)+mo(a),"g"),L;;){if(h[c]===a){for(L=c,c++;;){if(L=h.indexOf(a,L+1),L===-1)return d||E.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:m.length,index:c}),Y();if(L===_-1){var j=h.substring(c,L).replace(z,a);return Y(j)}if(a===l&&h[L+1]===l){L++;continue}if(!(a!==l&&L!==0&&h[L-1]===l)){var X=k===-1?N:Math.min(N,k),Z=W(X);if(h[L+1+Z]===e){if(b.push(h.substring(c,L).replace(z,a)),c=L+1+Z+v,N=h.indexOf(e,c),k=h.indexOf(n,c),g&&(J(),u))return K();if(s&&m.length>=s)return K(!0);break}var Je=W(k);if(h.substr(L+1+Je,A)===n){if(b.push(h.substring(c,L).replace(z,a)),q(L+1+Je+A),N=h.indexOf(e,c),g&&(J(),u))return K();if(s&&m.length>=s)return K(!0);break}E.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:m.length,index:c}),L++}}if(g&&(J(),u))return K();if(s&&m.length>=s)return K(!0);continue}if(r&&b.length===0&&h.substr(c,p)===r){if(k===-1)return K();c=k+A,k=h.indexOf(n,c),N=h.indexOf(e,c);continue}if(N!==-1&&(N<k||k===-1)){b.push(h.substring(c,N)),c=N+v,N=h.indexOf(e,c);continue}if(k!==-1){if(b.push(h.substring(c,k)),q(k+A),g&&(J(),u))return K();if(s&&m.length>=s)return K(!0);continue}break}return Y();function Ue(he){m.push(he),x=c}function W(he){var Le=0;if(he!==-1){var Rt=h.substring(L+1,he);Rt&&Rt.trim()===""&&(Le=Rt.length)}return Le}function Y(he){return d||(typeof he>"u"&&(he=h.substr(c)),b.push(he),c=_,Ue(b),g&&J()),K()}function q(he){c=he,Ue(b),b=[],k=h.indexOf(n,c)}function K(he,Le){var Rt=Le||!1;return{data:Rt?m[0]:m,errors:E,meta:{delimiter:e,linebreak:n,aborted:u,truncated:!!he,cursor:x+(f||0)}}}function J(){i(K(void 0,!0)),m=[],E=[]}},this.abort=function(){u=!0},this.getCharIndex=function(){return c}}function Ep(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var n in t)e[n]=Ep(t[n]);return e}function Ke(t){return typeof t=="function"}const{ChunkStreamer:MT}=Yc;function Sl(t){t=t||{},MT.call(this,t),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(e){this._input=e;try{for await(const n of e)this.parseChunk(this.getStringChunk(n));this._finished=!0,this.parseChunk("")}catch(n){this._sendError(n)}},this._nextChunk=function(){},this.getStringChunk=function(e){return typeof e=="string"?e:this.textDecoder.decode(e,{stream:!0})}}Sl.prototype=Object.create(MT.prototype);Sl.prototype.constructor=Sl;const OR="4.1.4",Sp="object-row-table",Ap={id:"csv",module:"csv",name:"CSV",version:OR,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(t,e)=>L_(new TextDecoder().decode(t),e),parseText:(t,e)=>L_(t,e),parseInBatches:NR,options:{csv:{shape:Sp,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function L_(t,e){const n={...Ap.options.csv,...e==null?void 0:e.csv},r=kR(t),s=n.header==="auto"?IT(r):!!n.header,o={...n,header:s,download:!1,transformHeader:s?OT():void 0,error:h=>{throw new Error(h)}},a=Yc.parse(t,o),l=a.data,c=a.meta.fields||NT(n.columnPrefix,r.length),u=n.shape||Sp;switch(u){case"object-row-table":return{shape:"object-row-table",data:l.map(h=>Array.isArray(h)?RT(h,c):h)};case"array-row-table":return{shape:"array-row-table",data:l.map(h=>Array.isArray(h)?h:bT(h,c))};default:throw new Error(u)}}function NR(t,e){var n;e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const r={...Ap.options.csv,...(n=e)===null||n===void 0?void 0:n.csv},i=new xR;let s=!0,o=null,a=null,l=null;const c={...r,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(u){let h=u.data;if(r.skipEmptyLines&&h.flat().join("").trim()==="")return;const f=u.meta.cursor;if(s&&!o&&(r.header==="auto"?IT(h):!!r.header)){o=h.map(OT());return}s&&(s=!1,o||(o=NT(r.columnPrefix,h.length)),l=FR(h,o)),r.optimizeMemoryUsage&&(h=JSON.parse(JSON.stringify(h)));const d=r.shape||Sp;a=a||new _o(l,{shape:d,...e});try{a.addRow(h);const _=a&&a.getFullBatch({bytesUsed:f});_&&i.enqueue(_)}catch(_){i.enqueue(_)}},complete(u){try{const h=u.meta.cursor,f=a&&a.getFinalBatch({bytesUsed:h});f&&i.enqueue(f)}catch(h){i.enqueue(h)}i.close()}};return Yc.parse(t,c,Sl),i}function IT(t){return t&&t.every(e=>typeof e=="string")}function kR(t){return Yc.parse(t,{download:!1,dynamicTyping:!0,preview:1}).data[0]}function OT(){const t=new Set;return e=>{let n=e,r=1;for(;t.has(n);)n=`${e}.${r}`,r++;return t.add(n),n}}function NT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=[];for(let r=0;r<e;r++)n.push(`${t}${r+1}`);return n}function FR(t,e){const n=e?{}:[];for(let r=0;r<t.length;r++){const i=e&&e[r]||r;switch(typeof t[r]){case"number":case"boolean":n[i]={name:String(i),index:r,type:Float32Array};break;case"string":default:n[i]={name:String(i),index:r,type:Array}}}return n}function Al(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const Rp=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),z_=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);z_&&parseFloat(z_[1]);function DR(t,e){return kT(t||{},e)}function kT(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=kT(r[i]||{},e[i],n+1):r[i]=e[i];return r}const BR="latest";function UR(){var t;return(t=globalThis._loadersgl_)!==null&&t!==void 0&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.1.4"),globalThis._loadersgl_.version}const LR=UR();function tr(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Ar=typeof process!="object"||String(process)!=="[object process]"||process.browser,zR=typeof window<"u"&&typeof window.orientation<"u",V_=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);V_&&parseFloat(V_[1]);class VR{constructor(e,n){this.name=void 0,this.workerThread=void 0,this.isRunning=!0,this.result=void 0,this._resolve=()=>{},this._reject=()=>{},this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){tr(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){tr(this.isRunning),this.isRunning=!1,this._reject(e)}}class $u{terminate(){}}const Xu=new Map;function jR(t){tr(t.source&&!t.url||!t.source&&t.url);let e=Xu.get(t.source||t.url);return e||(t.url&&(e=WR(t.url),Xu.set(t.url,e)),t.source&&(e=FT(t.source),Xu.set(t.source,e))),tr(e),e}function WR(t){if(!t.startsWith("http"))return t;const e=HR(t);return FT(e)}function FT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function HR(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function DT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2?arguments[2]:void 0;const r=n||new Set;if(t){if(j_(t))r.add(t);else if(j_(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)DT(t[i],e,r)}}return n===void 0?Array.from(r):[]}function j_(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Yu=()=>{};class Af{static isSupported(){return typeof Worker<"u"&&Ar||typeof $u<"u"&&!Ar}constructor(e){this.name=void 0,this.source=void 0,this.url=void 0,this.terminated=!1,this.worker=void 0,this.onMessage=void 0,this.onError=void 0,this._loadableURL="";const{name:n,source:r,url:i}=e;tr(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Yu,this.onError=s=>console.log(s),this.worker=Ar?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=Yu,this.onError=Yu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||DT(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=jR({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new $u(r,{eval:!1})}else if(this.source)e=new $u(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class $R{static isSupported(){return Af.isSupported()}constructor(e){this.name="unnamed",this.source=void 0,this.url=void 0,this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=()=>{},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:(s,o,a)=>s.done(a),r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:(s,o)=>s.error(o);const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new VR(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Ar||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new Af({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return zR?this.maxMobileConcurrency:this.maxConcurrency}}const XR={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class fn{static isSupported(){return Af.isSupported()}static getWorkerFarm(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return fn._workerFarm=fn._workerFarm||new fn({}),fn._workerFarm.setProps(e),fn._workerFarm}constructor(e){this.props=void 0,this.workerPools=new Map,this.props={...XR},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new $R({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}fn._workerFarm=void 0;function YR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=e[t.id]||{},r=Ar?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Ar?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=BR);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return tr(i),i}function KR(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:LR;tr(t,"no worker provided");const n=t.version;return!(!e||!n)}function qR(t,e){return!fn.isSupported()||!Ar&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function ZR(t,e,n,r,i){const s=t.id,o=YR(t,n),l=fn.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",QR.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function QR(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function JR(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function GR(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return eb(e)}function eb(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function tb(t){const e=[];for await(const n of t)e.push(n);return GR(...e)}function W_(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class H_{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=W_(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(W_()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Kc{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof H_?i=e:i=new H_(n,r),this.stats[n]=i),i}}let nb="";const $_={};function rb(t){for(const e in $_)if(t.startsWith(e)){const n=$_[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${nb}${t}`),t}function ib(t){return t&&typeof t=="object"&&t.isBuffer}function BT(t){if(ib(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function UT(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function sb(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const ob=t=>typeof t=="boolean",Ws=t=>typeof t=="function",Fo=t=>t!==null&&typeof t=="object",X_=t=>Fo(t)&&t.constructor==={}.constructor,ab=t=>!!t&&typeof t[Symbol.iterator]=="function",lb=t=>t&&typeof t[Symbol.asyncIterator]=="function",Wr=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Hr=t=>typeof Blob<"u"&&t instanceof Blob,cb=t=>t&&typeof t=="object"&&t.isBuffer,ub=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Fo(t)&&Ws(t.tee)&&Ws(t.cancel)&&Ws(t.getReader),hb=t=>Fo(t)&&Ws(t.read)&&Ws(t.pipe)&&ob(t.readable),LT=t=>ub(t)||hb(t),fb=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,db=/^([-\w.]+\/[-\w.+]+)/;function pb(t){const e=db.exec(t);return e?e[1]:t}function Y_(t){const e=fb.exec(t);return e?e[1]:""}const zT=/\?.*/;function gb(t){const e=t.match(zT);return e&&e[0]}function bp(t){return t.replace(zT,"")}function qc(t){return Wr(t)?t.url:Hr(t)?t.name||"":typeof t=="string"?t:""}function Cp(t){if(Wr(t)){const e=t,n=e.headers.get("content-type")||"",r=bp(e.url);return pb(n)||Y_(r)}return Hr(t)?t.type||"":typeof t=="string"?Y_(t):""}function _b(t){return Wr(t)?t.headers["content-length"]||-1:Hr(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function VT(t){if(Wr(t))return t;const e={},n=_b(t);n>=0&&(e["content-length"]=String(n));const r=qc(t),i=Cp(t);i&&(e["content-type"]=i);const s=await vb(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function mb(t){if(!t.ok){const e=await yb(t);throw new Error(e)}}async function yb(t){let e=`Failed to fetch resource ${t.url} (${t.status}): `;try{const n=t.headers.get("Content-Type");let r=t.statusText;n!=null&&n.includes("application/json")&&(r+=` ${await t.text()}`),e+=r,e=e.length>60?`${e.slice(0,60)}...`:e}catch{}return e}async function vb(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r(s==null||(o=s.target)===null||o===void 0?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${Tb(n)}`}return null}function Tb(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function wb(t){return!Eb(t)&&!Sb(t)}function Eb(t){return t.startsWith("http:")||t.startsWith("https:")}function Sb(t){return t.startsWith("data:")}async function K_(t,e){if(typeof t=="string"){const i=rb(t);if(wb(i)){var n;if((n=globalThis.loaders)!==null&&n!==void 0&&n.fetchNode){var r;return(r=globalThis.loaders)===null||r===void 0?void 0:r.fetchNode(i,e)}}return await fetch(i,e)}return await VT(t)}const ma=globalThis,Zr=globalThis.process||{},Ab=globalThis.navigator||{};function jT(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function or(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||jT()}function Rb(t){return!t&&!or()?"Node":jT(t)?"Electron":(t||Ab.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const WT="4.0.7";function bb(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class Cb{constructor(e,n,r="sessionStorage"){this.storage=bb(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function Pb(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function xb(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var Rl;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(Rl||(Rl={}));const Mb=10;function q_(t){return typeof t!="string"?t:(t=t.toUpperCase(),Rl[t]||Rl.WHITE)}function Ib(t,e,n){return!or&&typeof t=="string"&&(e&&(t=`\x1B[${q_(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${q_(n)+Mb}m${t}\x1B[49m`)),t}function Ob(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function Pp(t,e){if(!t)throw new Error(e||"Assertion failed")}function Qr(){var e,n,r;let t;if(or()&&ma.performance)t=(n=(e=ma==null?void 0:ma.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Zr){const i=(r=Zr==null?void 0:Zr.hrtime)==null?void 0:r.call(Zr);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Jr={debug:or()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Nb={enabled:!0,level:0};function Gr(){}const Z_={},Q_={once:!0};class Do{constructor({id:e}={id:""}){this.VERSION=WT,this._startTs=Qr(),this._deltaTs=Qr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new Cb(`__probe-${this.id}__`,Nb),this.timeStamp(`${this.id} started`),Ob(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Qr()-this._startTs).toPrecision(10))}getDelta(){return Number((Qr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Jr.warn,arguments,Q_)}error(e){return this._getLogFunction(0,e,Jr.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Jr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Jr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Jr.debug||Jr.info,arguments,Q_)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Gr,r&&[r],{tag:Fb(n)}):Gr}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Gr)}group(e,n,r={collapsed:!1}){const i=J_({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Gr)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=HT(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=J_({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,Pp(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=Qr();const o=s.tag||s.message;if(s.once&&o)if(!Z_[o])Z_[o]=Qr();else return Gr;return n=kb(this.id,s.message,s),r.bind(console,n,...s.args)}return Gr}}Do.VERSION=WT;function HT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Pp(Number.isFinite(e)&&e>=0),e}function J_(t){const{logLevel:e,message:n}=t;t.logLevel=HT(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Pp(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function kb(t,e,n){if(typeof e=="string"){const r=n.time?xb(Pb(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=Ib(e,n.color,n.background)}return e}function Fb(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const G_=new Do({id:"loaders.gl"});class Db{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class Bb{constructor(){this.console=void 0,this.console=console}log(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.log.bind(this.console,...n)}info(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.info.bind(this.console,...n)}warn(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.warn.bind(this.console,...n)}error(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this.console.error.bind(this.console,...n)}}const $T={fetch:null,mimeType:void 0,nothrow:!1,log:new Bb,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Rp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Ub={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function XT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state=t._state||{},t._state}function YT(){const t=XT();return t.globalOptions=t.globalOptions||{...$T},t.globalOptions}function Lb(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],zb(t,n),jb(e,t,r)}function zb(t,e){em(t,null,$T,Ub,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};em(r,n.id,i,s,e)}}function em(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&Fo(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)G_.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const h=Vb(a,i);G_.warn(`${s} loader option '${o}${a}' not recognized. ${h}`)()}}}}function Vb(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function jb(t,e,n){const i={...t.options||{}};return Wb(i,n),i.log===null&&(i.log=new Db),tm(i,YT()),tm(i,e),i}function tm(t,e){for(const n in e)if(n in e){const r=e[n];X_(r)&&X_(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function Wb(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function xp(t){var e;return t?(Array.isArray(t)&&(t=t[0]),Array.isArray((e=t)===null||e===void 0?void 0:e.extensions)):!1}function Mp(t){var e,n;Al(t,"null loader"),Al(xp(t),"invalid loader");let r;return Array.isArray(t)&&(r=t[1],t=t[0],t={...t,options:{...t.options,...r}}),((e=t)!==null&&e!==void 0&&e.parseTextSync||(n=t)!==null&&n!==void 0&&n.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const KT=()=>{const t=XT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function Hb(t){const e=KT();t=Array.isArray(t)?t:[t];for(const n of t){const r=Mp(n);e.find(i=>r===i)||e.unshift(r)}}function $b(){return KT()}const Xb=new Do({id:"loaders.gl"}),Yb=/\.([^.]+)$/;async function Kb(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!qT(t))return null;let i=nm(t,e,{...n,nothrow:!0},r);if(i)return i;if(Hr(t)&&(t=await t.slice(0,10).arrayBuffer(),i=nm(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(ZT(t));return i}function nm(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!qT(t))return null;if(e&&!Array.isArray(e))return Mp(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...$b()),Zb(i);const s=qb(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(ZT(t));return s}function qb(t,e,n,r){const i=qc(t),s=Cp(t),o=bp(i)||(r==null?void 0:r.url);let a=null,l="";if(n!=null&&n.mimeType&&(a=Ku(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||Qb(e,o),l=l||(a?`matched url ${o}`:""),a=a||Ku(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||Gb(e,t),l=l||(a?`matched initial data ${QT(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||Ku(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l){var c;Xb.log(1,`selectLoader selected ${(c=a)===null||c===void 0?void 0:c.name}: ${l}.`)}return a}function qT(t){return!(t instanceof Response&&t.status===204)}function ZT(t){const e=qc(t),n=Cp(t);let r="No valid loader found (";r+=e?`${UT(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?QT(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function Zb(t){for(const e of t)Mp(e)}function Qb(t,e){const n=e&&Yb.exec(e),r=n&&n[1];return r?Jb(t,r):null}function Jb(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function Ku(t,e){for(const n of t)if(n.mimeTypes&&n.mimeTypes.includes(e)||e===`application/x.${n.id}`)return n;return null}function Gb(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(eC(e,n))return n}else if(ArrayBuffer.isView(e)){if(rm(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&rm(e,0,n))return n;return null}function eC(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function rm(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>tC(t,e,n,i))}function tC(t,e,n,r){if(r instanceof ArrayBuffer)return JR(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=Rf(t,e,r.length);return r===i;default:return!1}}function QT(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?Rf(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?Rf(t,0,e):""}function Rf(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const nC=256*1024;function*rC(t,e){const n=(e==null?void 0:e.chunkSize)||nC;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const iC=256*1024;function sC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return function*(){const{chunkSize:n=iC}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}()}const oC=1024*1024;async function*aC(t,e){const n=(e==null?void 0:e.chunkSize)||oC;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function im(t,e){return Rp?lC(t,e):cC(t)}async function*lC(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield BT(o)}}catch{n.releaseLock()}}async function*cC(t,e){for await(const n of t)yield BT(n)}function uC(t,e){if(typeof t=="string")return rC(t,e);if(t instanceof ArrayBuffer)return sC(t,e);if(Hr(t))return aC(t,e);if(LT(t))return im(t,e);if(Wr(t))return im(t.body,e);throw new Error("makeIterator")}const JT="Cannot convert supplied data type";function hC(t,e,n){if(e.text&&typeof t=="string")return t;if(cb(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(JT)}async function fC(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return hC(t,e);if(Hr(t)&&(t=await VT(t)),Wr(t)){const i=t;return await mb(i),e.binary?await i.arrayBuffer():await i.text()}if(LT(t)&&(t=uC(t,n)),ab(t)||lb(t))return tb(t);throw new Error(JT)}function GT(t,e){const n=YT(),r=t||n;return typeof r.fetch=="function"?r.fetch:Fo(r.fetch)?i=>K_(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:K_}function dC(t,e,n){if(n)return n;const r={fetch:GT(e,t),...t};if(r.url){const i=bp(r.url);r.baseUrl=i,r.queryString=gb(r.url),r.filename=UT(i),r.baseUrl=sb(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function pC(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function bl(t,e,n,r){e&&!Array.isArray(e)&&!xp(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=qc(t),o=pC(e,r),a=await Kb(t,o,n);return a?(n=Lb(n,a,o,i),r=dC({url:i,_parse:bl,loaders:o},n,r||null),await gC(a,t,n,r)):null}async function gC(t,e,n,r){if(KR(t),n=DR(t.options,n),Wr(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:h}=s,f=Object.fromEntries(s.headers.entries());r.response={headers:f,ok:o,redirected:a,status:l,statusText:c,type:u,url:h}}e=await fC(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(qR(t,n))return await ZR(t,e,n,r,bl);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw tr(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Cl(t,e,n,r){let i,s;!Array.isArray(e)&&!xp(e)?(i=[],s=e):(i=e,s=n);const o=GT(s);let a=t;return typeof t=="string"&&(a=await o(t)),Hr(t)&&(a=await o(t)),Array.isArray(i)?await bl(a,i,s):await bl(a,i,s)}const _C="4.1.4";var qu;const mC=(qu=globalThis.loaders)===null||qu===void 0?void 0:qu.parseImageNode,bf=typeof Image<"u",Cf=typeof ImageBitmap<"u",yC=!!mC,Pf=Rp?!0:yC;function vC(t){switch(t){case"auto":return Cf||bf||Pf;case"imagebitmap":return Cf;case"image":return bf;case"data":return Pf;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function TC(){if(Cf)return"imagebitmap";if(bf)return"image";if(Pf)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function wC(t){const e=SC(t);if(!e)throw new Error("Not an image");return e}function EC(t){switch(wC(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function SC(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const AC=/^data:image\/svg\+xml/,RC=/\.svg((\?|#).*)?$/;function Ip(t){return t&&(AC.test(t)||RC.test(t))}function bC(t,e){if(Ip(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return ew(t,e)}function ew(t,e){if(Ip(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function tw(t,e,n){const r=bC(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await CC(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function CC(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const PC={};let sm=!0;async function xC(t,e,n){let r;Ip(n)?r=await tw(t,e,n):r=ew(t,n);const i=e&&e.imagebitmap;return await MC(r,i)}async function MC(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if((IC(e)||!sm)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),sm=!1}return await createImageBitmap(t)}function IC(t){for(const e in t||PC)return!1;return!0}function OC(t){return!DC(t,"ftyp",4)||!(t[8]&96)?null:NC(t)}function NC(t){switch(kC(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function kC(t,e,n){return String.fromCharCode(...t.slice(e,n))}function FC(t){return[...t].map(e=>e.charCodeAt(0))}function DC(t,e){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const r=FC(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Kt=!1,Hs=!0;function nw(t){const e=Bo(t);return UC(e)||VC(e)||LC(e)||zC(e)||BC(e)}function BC(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=OC(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function UC(t){const e=Bo(t);return e.byteLength>=24&&e.getUint32(0,Kt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Kt),height:e.getUint32(20,Kt)}:null}function LC(t){const e=Bo(t);return e.byteLength>=10&&e.getUint32(0,Kt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Hs),height:e.getUint16(8,Hs)}:null}function zC(t){const e=Bo(t);return e.byteLength>=14&&e.getUint16(0,Kt)===16973&&e.getUint32(2,Hs)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Hs),height:e.getUint32(22,Hs)}:null}function VC(t){const e=Bo(t);if(!(e.byteLength>=3&&e.getUint16(0,Kt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=jC();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Kt);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Kt),width:e.getUint16(s+7,Kt)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Kt)}return null}function jC(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Bo(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function WC(t,e){var n;const{mimeType:r}=nw(t)||{},i=(n=globalThis.loaders)===null||n===void 0?void 0:n.parseImageNode;return Al(i),await i(t,r)}async function HC(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=$C(i);let a;switch(o){case"imagebitmap":a=await xC(t,e,s);break;case"image":a=await tw(t,e,s);break;case"data":a=await WC(t);break;default:Al(!1)}return i==="data"&&(a=EC(a)),a}function $C(t){switch(t){case"auto":case"data":return TC();default:return vC(t),t}}const XC=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],YC=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],KC={image:{type:"auto",decode:!0}},qC={id:"image",module:"images",name:"Images",version:_C,mimeTypes:YC,extensions:XC,parse:HC,tests:[t=>!!nw(new DataView(t))],options:KC},ZC=new Do({id:"deck"}),ne=ZC;let xf={};function QC(t){xf=t}function We(t,e,n,r){ne.level>0&&xf[t]&&xf[t].call(null,e,n,r)}function JC(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const GC={id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:JC,parseTextSync:JSON.parse};function e3(){const t="9.0.0",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ne.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ne,_registerLoggers:QC},Hb([GC,[qC,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const t3=e3();function vr(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Zu={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function n3(t){const e={};for(const[n,r]of Object.entries(t))e[n]=i3(r);return e}function r3(t,e,n){const r={};for(const[i,s]of Object.entries(e))t&&i in t&&!s.private?(s.validate&&vr(s.validate(t[i],s),`${n}: invalid ${i}`),r[i]=t[i]):r[i]=s.value;return r}function i3(t){let e=om(t);if(e!=="object")return{value:t,...Zu[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Zu[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=om(t.value),{...t,...Zu[e],type:e}):{type:"object",value:null};throw new Error("props")}function om(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const s3=`#ifdef MODULE_LOGDEPTH
logdepth_adjustPosition(gl_Position);
#endif
`,o3=`#ifdef MODULE_MATERIAL
gl_FragColor = material_filterColor(gl_FragColor);
#endif
#ifdef MODULE_LIGHTING
gl_FragColor = lighting_filterColor(gl_FragColor);
#endif
#ifdef MODULE_FOG
gl_FragColor = fog_filterColor(gl_FragColor);
#endif
#ifdef MODULE_PICKING
gl_FragColor = picking_filterHighlightColor(gl_FragColor);
gl_FragColor = picking_filterPickingColor(gl_FragColor);
#endif
#ifdef MODULE_LOGDEPTH
logdepth_setFragDepth();
#endif
`,a3={vertex:s3,fragment:o3},am=/void\s+main\s*\([^)]*\)\s*\{\n?/,lm=/}\n?[^{}]*$/,Qu=[],Ka="__LUMA_INJECT_DECLARATIONS__";function l3(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=c3(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function c3(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Pl(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),Qu.length=o.length;for(let l=0,c=o.length;l<c;++l)Qu[l]=o[l].injection;const a=`${Qu.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(Ka,a));break;case"vs:#main-start":i&&(t=t.replace(am,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(lm,l=>a+l));break;case"fs:#decl":i||(t=t.replace(Ka,a));break;case"fs:#main-start":i||(t=t.replace(am,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(lm,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Ka,""),r&&(t=t.replace(/\}\s*$/,s=>s+a3[e])),t}let u3=1;class Tr{constructor(e){T(this,"name");T(this,"vs");T(this,"fs");T(this,"getModuleUniforms");T(this,"dependencies");T(this,"deprecations");T(this,"defines");T(this,"injections");T(this,"uniforms",{});T(this,"uniformTypes",{});const{name:n,vs:r,fs:i,dependencies:s=[],uniformPropTypes:o={},getUniforms:a,deprecations:l=[],defines:c={},inject:u={}}=e;vr(typeof n=="string"),this.name=n,this.vs=r,this.fs=i,this.getModuleUniforms=a,this.dependencies=Tr.instantiateModules(s),this.deprecations=this._parseDeprecationDefinitions(l),this.defines=c,this.injections=l3(u),o&&(this.uniforms=n3(o))}static instantiateModules(e){return e.map(n=>{if(n instanceof Tr)return n;vr(typeof n!="string",`Shader module use by name is deprecated. Import shader module '${JSON.stringify(n)}' and use it directly.`),n.name||(console.warn("shader module has no name"),n.name=`shader-module-${u3++}`);const r=new Tr(n);return r.dependencies=Tr.instantiateModules(n.dependencies||[]),r})}getModuleSource(e){let n;switch(e){case"vertex":n=this.vs||"";break;case"fragment":n=this.fs||"";break;default:vr(!1)}const r=this.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");return`// ----- MODULE ${this.name} ---------------

#define MODULE_${r}
${n}

`}getUniforms(e,n){return this.getModuleUniforms?this.getModuleUniforms(e,n):r3(e,this.uniforms,this.name)}getDefines(){return this.defines}checkDeprecations(e,n){this.deprecations.forEach(r=>{var i;(i=r.regex)!=null&&i.test(e)&&(r.deprecated?n.deprecated(r.old,r.new)():n.removed(r.old,r.new)())})}_parseDeprecationDefinitions(e){return e.forEach(n=>{switch(n.type){case"function":n.regex=new RegExp(`\\b${n.old}\\(`);break;default:n.regex=new RegExp(`${n.type} ${n.old};`)}}),e}_defaultGetUniforms(e={}){const n={},r=this.uniforms;for(const i in r){const s=r[i];i in e&&!s.private?(s.validate&&vr(s.validate(e[i],s),`${this.name}: invalid ${i}`),n[i]=e[i]):n[i]=s.value}return n}}function cm(t){if(t.source&&t.platformInfo.type==="webgpu")return{...t,vs:void 0,fs:void 0};if(!t.vs)throw new Error("no vertex shader");const e=um(t.platformInfo,t.vs);let n;return t.fs&&(n=um(t.platformInfo,t.fs)),{...t,vs:e,fs:n}}function um(t,e){if(typeof e=="string")return e;switch(t.type){case"webgpu":if(e!=null&&e.wgsl)return e.wgsl;throw new Error("WebGPU does not support GLSL shaders");default:if(e!=null&&e.glsl)return e.glsl;throw new Error("WebGL does not support WGSL shaders")}}function Zc(t){const e=Tr.instantiateModules(t);return h3(e)}function h3(t){const e={},n={};return rw({modules:t,level:0,moduleMap:e,moduleDepth:n}),Object.keys(n).sort((r,i)=>n[i]-n[r]).map(r=>e[r])}function rw(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&rw({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function f3(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function d3(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=hm(t,p3),t;case"fragment":return t=hm(t,g3),t;default:throw new Error(e)}}const iw=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],p3=[...iw,[Mf("attribute"),"in $1"],[Mf("varying"),"out $1"]],g3=[...iw,[Mf("varying"),"in $1"]];function hm(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Mf(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function sw(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function ow(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function _3(t,e){return{name:m3(t,e),language:"glsl",version:y3(t)}}function m3(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function y3(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const aw=`

${Ka}
`,v3=`precision highp float;
`;function T3(t){const e=Zc(t.modules||[]);return{source:If(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:Op(e)}}function w3(t){const e=Zc(t.modules||[]);return{vs:If(t.platformInfo,{...t,source:t.vs,stage:"vertex",modules:e}),fs:If(t.platformInfo,{...t,source:t.fs,stage:"fragment",modules:e}),getUniforms:Op(e)}}function E3(t){const{vs:e,fs:n}=t,r=Zc(t.modules||[]);return{vs:fm(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:fm(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:Op(r)}}function If(t,e){const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;vr(typeof n=="string","shader source must be a string");const l=n;let c="";const u=ow(s),h={},f={},d={};for(const v in o){const A=typeof o[v]=="string"?{injection:o[v],order:0}:o[v],p=/^(v|f)s:(#)?([\w-]+)$/.exec(v);if(p){const g=p[2],m=p[3];g?m==="decl"?f[v]=[A]:d[v]=[A]:h[v]=[A]}else d[v]=[A]}const _=t.type!=="webgpu"?i:[];for(const v of _){a&&v.checkDeprecations(l,a);const A=v.getModuleSource(r,"wgsl");c+=A;const p=v.injections[r];for(const g in p){const m=/^(v|f)s:#([\w-]+)$/.exec(g);if(m){const b=m[2]==="decl"?f:d;b[g]=b[g]||[],b[g].push(p[g])}else h[g]=h[g]||[],h[g].push(p[g])}}return c+=aw,c=Pl(c,r,f),c+=sw(u[r],h),c+=l,c=Pl(c,r,d),c}function fm(t,e){const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:h}=e;vr(typeof r=="string","shader source must be a string");const f=s==="glsl"?_3(r).version:-1,d=t.shaderLanguageVersion,_=f===100?"#version 100":"#version 300 es",A=r.split(`
`).slice(1).join(`
`),p={};o.forEach(O=>{Object.assign(p,O.getDefines())}),Object.assign(p,a);let g="";switch(s){case"wgsl":break;case"glsl":g=u?`${_}

// ----- PROLOGUE -------------------------
${S3({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}
${f3(t)}
${i==="fragment"?v3:""}

// ----- APPLICATION DEFINES -------------------------

${A3(p)}

`:`${_}
`;break}const m=ow(l),E={},b={},x={};for(const O in c){const M=typeof c[O]=="string"?{injection:c[O],order:0}:c[O],N=/^(v|f)s:(#)?([\w-]+)$/.exec(O);if(N){const k=N[2],z=N[3];k?z==="decl"?b[O]=[M]:x[O]=[M]:E[O]=[M]}else x[O]=[M]}for(const O of o){h&&O.checkDeprecations(A,h);const M=O.getModuleSource(i);g+=M;const N=O.injections[i];for(const k in N){const z=/^(v|f)s:#([\w-]+)$/.exec(k);if(z){const j=z[2]==="decl"?b:x;j[k]=j[k]||[],j[k].push(N[k])}else E[k]=E[k]||[],E[k].push(N[k])}}return g+="// ----- MAIN SHADER SOURCE -------------------------",g+=aw,g=Pl(g,i,b),g+=sw(m[i],E),g+=A,g=Pl(g,i,x),s==="glsl"&&f!==d&&(g=d3(g,i)),g.trim()}function Op(t){return function(n){const r={};for(const i of t){const s=i.getUniforms(n,r);Object.assign(r,s)}return r}}function S3(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}

`:""}function A3(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}const pr=class pr{constructor(){T(this,"_hookFunctions",[]);T(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return pr.defaultShaderAssembler=pr.defaultShaderAssembler||new pr,pr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,i=cm(e);return{...T3({platformInfo:e.platformInfo,...i,modules:n,hookFunctions:r}),modules:n}}assembleShaderPair(e){const n=cm(e),r=this._getModuleList(e.modules),i=this._hookFunctions,{platformInfo:s}=e;return{...e.platformInfo.shaderLanguage==="wgsl"?w3({platformInfo:s,...n,modules:r,hookFunctions:i}):E3({platformInfo:s,...n,modules:r,hookFunctions:i}),modules:r}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,Tr.instantiateModules(n)}};T(pr,"defaultShaderAssembler");let xl=pr;const R3=`out vec4 transform_output;
void main() {
transform_output = vec4(0);
}`,b3=`#version 300 es
${R3}`;function C3(t){const{input:e,inputChannels:n,output:r}=t||{};if(!e)return b3;if(!n)throw new Error("inputChannels");const i=P3(n),s=x3(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function P3(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function x3(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}const U=new Do({id:"luma.gl"});class M3{constructor(){T(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Kc({id:e})),this.stats.get(e)}}const Np=new M3;function I3(){const t="9.0.6",e="set luma.log.level=1 (or higher) to trace rendering";if(globalThis.luma&&globalThis.luma.VERSION!==t)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${t}`);return globalThis.luma||(or()&&U.log(1,`${t} - ${e}`)(),globalThis.luma=globalThis.luma||{VERSION:t,version:t,log:U,stats:Np}),t}const O3=I3();function N3(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)?t:null}function yo(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number"?t:null:N3(t)}const Ju={};function $r(t="id"){Ju[t]=Ju[t]||1;const e=Ju[t]++;return`${t}-${e}`}function Ml(t){let e=!0;for(const n in t){e=!1;break}return e}var xh;let oe=(xh=class{constructor(e,n,r){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"_device");T(this,"destroyed",!1);T(this,"allocatedBytes",0);T(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=k3(n,r);const i=this.props.id!=="undefined"?this.props.id:$r(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},T(xh,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),xh);function k3(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const Ne=class Ne extends oe{constructor(n,r){const i={...r};(r.usage||0)&Ne.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16"));super(n,i,Ne.defaultProps);T(this,"usage");T(this,"indexType");T(this,"updateTimestamp");T(this,"debugData",new ArrayBuffer(0));this.usage=r.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,Ne.DEBUG_DATA_MAX_LENGTH);n===null?this.debugData=new ArrayBuffer(o):r===0&&i===n.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};T(Ne,"defaultProps",{...oe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),T(Ne,"MAP_READ",1),T(Ne,"MAP_WRITE",2),T(Ne,"COPY_SRC",4),T(Ne,"COPY_DST",8),T(Ne,"INDEX",16),T(Ne,"VERTEX",32),T(Ne,"UNIFORM",64),T(Ne,"STORAGE",128),T(Ne,"INDIRECT",256),T(Ne,"QUERY_RESOLVE",512),T(Ne,"DEBUG_DATA_MAX_LENGTH",32);let de=Ne;function lw(t){const e=dm[t],n=F3(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:dm[t],byteLength:n,integer:i,signed:s,normalized:r}}function F3(t){return D3[t]}const dm={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},D3={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},B3=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],U3=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function L3(t){return B3.some(e=>t.startsWith(e))}function cw(t){const e=U3.exec(t);if(e){const[,n,r,i,s,o]=e;if(n){const a=`${i}${r}`,l=lw(a);return{format:n,components:n.length,srgb:s==="-srgb",unsized:o==="-unsized",webgl:o==="-webgl",...l}}}return V3(t)}const z3={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};function V3(t){var n;const e=z3[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||((n=e.format)==null?void 0:n.length)||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}class j3{}class W3{constructor(e=[],n){T(this,"features");T(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures[e]&&this.features.has(e)}}const qs=class qs{constructor(e){T(this,"id");T(this,"props");T(this,"userData",{});T(this,"statsManager",Np);T(this,"_lumaData",{});T(this,"timestamp",0);this.props={...qs.defaultProps,...e},this.id=this.props.id||$r(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return L3(e)}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(e){return(e instanceof Promise||typeof e=="string")&&(e={data:e}),this._createTexture(e)}createCommandEncoder(e={}){throw new Error("not implemented")}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}_getBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&de.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":U.warn("indices buffer content must be of integer type")()),n}};T(qs,"defaultProps",{id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:!!U.get("debug"),spector:!!U.get("spector"),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:e=>U.error(e.message)}),T(qs,"VERSION",O3);let Rr=qs;function le(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const ms=new Map;class br{static registerDevices(e){for(const n of e)le(n.type&&n.isSupported&&n.create),ms.set(n.type,n)}static getAvailableDevices(){return Array.from(ms).map(e=>e.type)}static getSupportedDevices(){return Array.from(ms).filter(e=>e.isSupported()).map(e=>e.type)}static setDefaultDeviceProps(e){Object.assign(Rr.defaultProps,e)}static async attachDevice(e){const n=pm(e.devices)||ms;if(e.handle instanceof WebGL2RenderingContext){const r=n.get("webgl");if(r)return await r.attach(e.handle)}if(e.handle===null){const r=n.get("unknown");if(r)return await r.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(e={}){var r,i;e={...Rr.defaultProps,...e},e.gl&&(e.type="webgl");const n=pm(e.devices)||ms;switch(e.type){case"webgpu":let s=n.get("webgpu");if(s)return await s.create(e);break;case"webgl":let o=n.get("webgl");if(o)return await o.create(e);break;case"unknown":const a=n.get("unknown");if(a)return await a.create(e);break;case"best-available":if(s=n.get("webgpu"),(r=s==null?void 0:s.isSupported)!=null&&r.call(s))return await s.create(e);if(o=n.get("webgl"),(i=o==null?void 0:o.isSupported)!=null&&i.call(o))return await o.create(e);break}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}}T(br,"defaultProps",{...Rr.defaultProps,type:"best-available",devices:void 0}),T(br,"stats",Np),T(br,"log",U);function pm(t){if(!t||(t==null?void 0:t.length)===0)return null;const e=new Map;for(const n of t)e.set(n.type,n);return e}const H3=or()&&typeof document<"u",Qc=()=>H3&&document.readyState==="complete",$3={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class kp{constructor(e){T(this,"id");T(this,"props");T(this,"canvas");T(this,"htmlCanvas");T(this,"offscreenCanvas");T(this,"type");T(this,"width",1);T(this,"height",1);T(this,"resizeObserver");T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...$3,...e},e=this.props,!or()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=K3(e.canvas):this.canvas=e.canvas;else{const n=q3(e),r=Y3((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}static get isPageLoaded(){return Qc()}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return Z3(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(U.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);this.htmlCanvas.width=a,this.htmlCanvas.height=l;const[c,u]=this.getDrawingBufferSize();(c!==a||u!==l)&&(o=Math.min(c/r,u/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),U.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}T(kp,"pageLoaded",X3());function X3(){return Qc()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}function Y3(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e&&!Qc())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function K3(t){const e=document.getElementById(t);if(!e&&!Qc())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function q3(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function Z3(t,e,n,r,i){const s=t,o=gm(s[0],e,n);let a=_m(s[1],e,r,i),l=gm(s[0]+1,e,n);const c=l===n-1?l:l-1;l=_m(s[1]+1,e,r,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function gm(t,e,n){return Math.min(Math.round(t*e),n-1)}function _m(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const cn=class cn extends oe{constructor(n,r,i=cn.defaultProps){super(n,r,i);T(this,"dimension");T(this,"format");T(this,"width");T(this,"height");T(this,"depth");T(this,"updateTimestamp");this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}};T(cn,"defaultProps",{...oe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0}),T(cn,"COPY_SRC",1),T(cn,"COPY_DST",2),T(cn,"TEXTURE_BINDING",4),T(cn,"STORAGE_BINDING",8),T(cn,"RENDER_ATTACHMENT",16);let Tt=cn;const Gl=class Gl extends oe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,Gl.defaultProps)}};T(Gl,"defaultProps",{...oe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Il=Gl;function Q3(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=uw(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=mm(l,i,l.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=mm(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function mm(t,e,n,r){if(r!=null&&r.inlineSource){const i=J3(e,n),s=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${i}${s}${t.type.toUpperCase()}: ${t.message}

`}return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function J3(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=uw(s,e,n))}return r}function uw(t,e,n){const r=n!=null&&n.html?eP(t):t;return`${G3(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function G3(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function eP(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}function hw(t,e){return{name:tP(t,e),language:"glsl",version:nP(t)}}function tP(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function nP(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}return e}const ec=class ec extends oe{constructor(n,r){super(n,{id:rP(r),...r},ec.defaultProps);T(this,"stage");T(this,"source");T(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(n=this.props.debug){switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();this.props.debug==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var c;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=hw(this.source).name,i=`${this.stage} ${r}`;let s=Q3(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);const l=document.getElementsByClassName("luma-compiler-log-error");(c=l[0])!=null&&c.scrollIntoView&&l[0].scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};T(ec,"defaultProps",{...oe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"});let Ol=ec;function rP(t){return hw(t.source).name||t.id||$r(`unnamed ${t.stage}-shader`)}const tc=class tc extends oe{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){super(e,n,tc.defaultProps)}};T(tc,"defaultProps",{...oe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Nl=tc;const nc=class nc extends oe{constructor(n,r={}){super(n,r,nc.defaultProps);T(this,"width");T(this,"height");T(this,"colorAttachments",[]);T(this,"depthStencilAttachment",null);this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(U.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map(r=>{if(typeof r=="string"){const i=this.createColorTexture(r);return this.attachResource(i),i.view}return r instanceof Tt?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof Tt?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n){return this.device.createTexture({id:"color-attachment",usage:Tt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}createDepthStencilTexture(n){return this.device.createTexture({id:"depth-stencil-attachment",usage:Tt.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.device._createTexture({...this.colorAttachments[i].props,width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.device._createTexture({...this.depthStencilAttachment.props,width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}}};T(nc,"defaultProps",{...oe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let kl=nc;const rc=class rc extends oe{constructor(n,r){super(n,r,rc.defaultProps);T(this,"shaderLayout");T(this,"bufferLayout");T(this,"linkStatus","pending");T(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};T(rc,"defaultProps",{...oe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}});let ji=rc;const ic=class ic extends oe{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){super(e,n,ic.defaultProps)}};T(ic,"defaultProps",{...oe.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Of=ic;const sc=class sc extends oe{constructor(n,r){super(n,r,sc.defaultProps);T(this,"hash","")}get[Symbol.toStringTag](){return"ComputePipeline"}};T(sc,"defaultProps",{...oe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let Fl=sc;const oc=class oc extends oe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,oc.defaultProps)}};T(oc,"defaultProps",{...oe.defaultProps,measureExecutionTime:void 0});let Nf=oc;const ac=class ac extends oe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,ac.defaultProps)}};T(ac,"defaultProps",{...oe.defaultProps});let kf=ac;function iP(t){const[e,n]=oP[t],r=e==="i32"||e==="u32",i=e!=="u32",s=aP[e]*n,o=sP(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function sP(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const oP={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},aP={f32:4,f16:2,i32:4,u32:4};function fw(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=lw(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function dw(t,e){const n={};for(const r of t.attributes)n[r.name]=cP(t,e,r.name);return n}function lP(t,e,n=16){const r=dw(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function cP(t,e,n){const r=uP(t,n),i=hP(e,n);if(!r)return null;const s=iP(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=fw(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode,byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function uP(t,e){const n=t.attributes.find(r=>r.name===e);return n||U.warn(`shader layout attribute "${e}" not present in shader`),n||null}function hP(t,e){fP(t);let n=dP(t,e);return n||(n=pP(t,e),n)?n:(U.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function fP(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&U.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function dP(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function pP(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=fw(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}function gP(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):U.warn(`shader layout attribute ${r.name} not present in shader`)}return n}const lc=class lc extends oe{constructor(n,r){super(n,r,lc.defaultProps);T(this,"maxVertexAttributes");T(this,"attributeInfos");T(this,"indexBuffer",null);T(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=lP(r.renderPipeline.shaderLayout,r.renderPipeline.bufferLayout,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};T(lc,"defaultProps",{...oe.defaultProps,renderPipeline:null});let Ff=lc;const cc=class cc extends oe{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,cc.defaultProps)}};T(cc,"defaultProps",{...oe.defaultProps,layout:void 0,buffers:{}});let Df=cc;const uc=class uc extends oe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,uc.defaultProps)}};T(uc,"defaultProps",{...oe.defaultProps,type:void 0,count:void 0});let Bf=uc;const _P={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function mP(t){const e=_P[t];return le(t),e}function yP(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let ya;function pw(t){return(!ya||ya.byteLength<t)&&(ya=new ArrayBuffer(t)),ya}function vP(t,e){const n=pw(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function TP(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}const ym=1024;class wP{constructor(e){T(this,"layout",{});T(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=mP(s),{type:a,components:l}=o;n=yP(n,l);const c=n;n+=l,this.layout[i]={type:a,size:l,offset:c}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,ym)}getData(e){const n=Math.max(this.byteLength,ym),r=pw(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){U.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:c,offset:u}=a,h=i[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){U.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}h[u]=Number(o)}else{const f=yo(o);if(!f){U.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}h.set(f,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function EP(t,e,n=16){if(t!==e)return!1;const r=yo(t);if(!r)return!1;const i=yo(e);if(i&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function SP(t){const e=yo(t);return e?e.slice():t}class AP{constructor(e){T(this,"name");T(this,"uniforms",{});T(this,"modifiedUniforms",{});T(this,"modified",!0);T(this,"bindingLayout",{});T(this,"needsRedraw","initialized");var n;if(this.name=e==null?void 0:e.name,e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){EP(this.uniforms[e],n)||(this.uniforms[e]=SP(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class RP{constructor(e){T(this,"uniformBlocks",new Map);T(this,"uniformBufferLayouts",new Map);T(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new wP(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new AP({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(const[n,r]of Object.entries(e))this.uniformBlocks.get(n).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e).byteLength}getUniformBufferData(e){const n=this.uniformBlocks.get(e).getAllUniforms();return this.uniformBufferLayouts.get(e).getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:de.UNIFORM|de.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:de.UNIFORM|de.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&U.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){const n=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e);let i=!1;if(r&&n.needsRedraw){i||(i=n.needsRedraw);const s=this.getUniformBufferData(e);this.uniformBuffers.get(e).write(s);const a=this.uniformBlocks.get(e).getAllUniforms();U.log(4,`Writing to uniform buffer ${String(e)}`,s,a)()}return i}}function gw(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function _w(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function bP(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=gw(t);if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}function CP(t){return yo(t)!==null||typeof t=="number"||typeof t=="boolean"}function mw(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];CP(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function PP(t,e,n){const{removedProps:r={},deprecatedProps:i={},replacedProps:s={}}=n;for(const a in r)if(a in e){const c=r[a]?`${t}.${r[a]}`:"N/A";U.removed(`${t}.${a}`,c)()}for(const a in i)if(a in e){const l=i[a];U.deprecated(`${t}.${a}`,`${t}.${l}`)()}let o=null;for(const[a,l]of Object.entries(s))a in e&&(U.deprecated(`${t}.${a}`,`${t}.${l}`)(),o=o||Object.assign({},e),o[l]=e[a],delete o[a]);return o||e}let xP="";async function MP(t,e){return await new Promise((n,r)=>{try{const i=new Image;i.onload=()=>n(i),i.onerror=()=>r(new Error(`Could not load image ${t}.`)),i.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",i.src=t.startsWith("http")?t:xP+t}catch(i){r(i)}})}async function yw(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}function Uf(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Uf(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Uf(t[s],e[s],n-1))return!1;return!0}return!1}function IP(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function OP(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}class NP{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}let Xr=class{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}};class Te extends Xr{constructor(){super()}}class vw extends Te{constructor(e,n,r,i){super(),this.name=e,this.args=n,this.returnType=r,this.body=i}get astNodeType(){return"function"}}class kP extends Te{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}}class FP extends Te{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}}class DP extends Te{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}}class BP extends Te{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}}class _i extends Te{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}}class Tw extends Te{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}}class vm extends Te{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}}class Tm extends Te{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}}var Wi;(function(t){t.increment="++",t.decrement="--"})(Wi||(Wi={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Wi||(Wi={}));class UP extends Te{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}}var vo;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(vo||(vo={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return t[r]}t.parse=e})(vo||(vo={}));class LP extends Te{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}}class zP extends Te{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}}class VP extends Te{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class jP extends Te{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class WP extends Te{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}}class HP extends Te{constructor(e){super(),this.value=e}get astNodeType(){return"return"}}class $P extends Te{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class ww extends Te{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class XP extends Te{constructor(){super()}get astNodeType(){return"discard"}}class YP extends Te{constructor(){super()}get astNodeType(){return"break"}}class KP extends Te{constructor(){super()}get astNodeType(){return"continue"}}class Yr extends Te{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class dr extends Yr{constructor(e,n){super(e),this.members=n}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class Ew extends Yr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class qP extends Yr{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Sw extends Yr{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Ps extends Yr{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class nn extends Xr{constructor(){super()}}class wm extends nn{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class xs extends nn{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}}class ZP extends nn{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}}class QP extends nn{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}}class Em extends nn{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof xs){const i=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(i);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}}class Sm extends nn{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class JP extends nn{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}}class GP extends nn{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}}class Am extends nn{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}}class Aw extends nn{constructor(){super()}}class ex extends Aw{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}}class Vt extends Aw{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}}class Rw extends Xr{constructor(){super()}}class tx extends Rw{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}}class nx extends Rw{constructor(e){super(),this.body=e}get astNodeType(){return"default"}}class rx extends Xr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class ix extends Xr{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}}class sx extends Xr{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let Rm=class extends Xr{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var F,C;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(C||(C={}));class P{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class S{}F=S;S.none=new P("",C.reserved,"");S.eof=new P("EOF",C.token,"");S.reserved={asm:new P("asm",C.reserved,"asm"),bf16:new P("bf16",C.reserved,"bf16"),do:new P("do",C.reserved,"do"),enum:new P("enum",C.reserved,"enum"),f16:new P("f16",C.reserved,"f16"),f64:new P("f64",C.reserved,"f64"),handle:new P("handle",C.reserved,"handle"),i8:new P("i8",C.reserved,"i8"),i16:new P("i16",C.reserved,"i16"),i64:new P("i64",C.reserved,"i64"),mat:new P("mat",C.reserved,"mat"),premerge:new P("premerge",C.reserved,"premerge"),regardless:new P("regardless",C.reserved,"regardless"),typedef:new P("typedef",C.reserved,"typedef"),u8:new P("u8",C.reserved,"u8"),u16:new P("u16",C.reserved,"u16"),u64:new P("u64",C.reserved,"u64"),unless:new P("unless",C.reserved,"unless"),using:new P("using",C.reserved,"using"),vec:new P("vec",C.reserved,"vec"),void:new P("void",C.reserved,"void")};S.keywords={array:new P("array",C.keyword,"array"),atomic:new P("atomic",C.keyword,"atomic"),bool:new P("bool",C.keyword,"bool"),f32:new P("f32",C.keyword,"f32"),i32:new P("i32",C.keyword,"i32"),mat2x2:new P("mat2x2",C.keyword,"mat2x2"),mat2x3:new P("mat2x3",C.keyword,"mat2x3"),mat2x4:new P("mat2x4",C.keyword,"mat2x4"),mat3x2:new P("mat3x2",C.keyword,"mat3x2"),mat3x3:new P("mat3x3",C.keyword,"mat3x3"),mat3x4:new P("mat3x4",C.keyword,"mat3x4"),mat4x2:new P("mat4x2",C.keyword,"mat4x2"),mat4x3:new P("mat4x3",C.keyword,"mat4x3"),mat4x4:new P("mat4x4",C.keyword,"mat4x4"),ptr:new P("ptr",C.keyword,"ptr"),sampler:new P("sampler",C.keyword,"sampler"),sampler_comparison:new P("sampler_comparison",C.keyword,"sampler_comparison"),struct:new P("struct",C.keyword,"struct"),texture_1d:new P("texture_1d",C.keyword,"texture_1d"),texture_2d:new P("texture_2d",C.keyword,"texture_2d"),texture_2d_array:new P("texture_2d_array",C.keyword,"texture_2d_array"),texture_3d:new P("texture_3d",C.keyword,"texture_3d"),texture_cube:new P("texture_cube",C.keyword,"texture_cube"),texture_cube_array:new P("texture_cube_array",C.keyword,"texture_cube_array"),texture_multisampled_2d:new P("texture_multisampled_2d",C.keyword,"texture_multisampled_2d"),texture_storage_1d:new P("texture_storage_1d",C.keyword,"texture_storage_1d"),texture_storage_2d:new P("texture_storage_2d",C.keyword,"texture_storage_2d"),texture_storage_2d_array:new P("texture_storage_2d_array",C.keyword,"texture_storage_2d_array"),texture_storage_3d:new P("texture_storage_3d",C.keyword,"texture_storage_3d"),texture_depth_2d:new P("texture_depth_2d",C.keyword,"texture_depth_2d"),texture_depth_2d_array:new P("texture_depth_2d_array",C.keyword,"texture_depth_2d_array"),texture_depth_cube:new P("texture_depth_cube",C.keyword,"texture_depth_cube"),texture_depth_cube_array:new P("texture_depth_cube_array",C.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new P("texture_depth_multisampled_2d",C.keyword,"texture_depth_multisampled_2d"),texture_external:new P("texture_external",C.keyword,"texture_external"),u32:new P("u32",C.keyword,"u32"),vec2:new P("vec2",C.keyword,"vec2"),vec3:new P("vec3",C.keyword,"vec3"),vec4:new P("vec4",C.keyword,"vec4"),bitcast:new P("bitcast",C.keyword,"bitcast"),block:new P("block",C.keyword,"block"),break:new P("break",C.keyword,"break"),case:new P("case",C.keyword,"case"),continue:new P("continue",C.keyword,"continue"),continuing:new P("continuing",C.keyword,"continuing"),default:new P("default",C.keyword,"default"),discard:new P("discard",C.keyword,"discard"),else:new P("else",C.keyword,"else"),enable:new P("enable",C.keyword,"enable"),fallthrough:new P("fallthrough",C.keyword,"fallthrough"),false:new P("false",C.keyword,"false"),fn:new P("fn",C.keyword,"fn"),for:new P("for",C.keyword,"for"),function:new P("function",C.keyword,"function"),if:new P("if",C.keyword,"if"),let:new P("let",C.keyword,"let"),const:new P("const",C.keyword,"const"),loop:new P("loop",C.keyword,"loop"),while:new P("while",C.keyword,"while"),private:new P("private",C.keyword,"private"),read:new P("read",C.keyword,"read"),read_write:new P("read_write",C.keyword,"read_write"),return:new P("return",C.keyword,"return"),storage:new P("storage",C.keyword,"storage"),switch:new P("switch",C.keyword,"switch"),true:new P("true",C.keyword,"true"),alias:new P("alias",C.keyword,"alias"),type:new P("type",C.keyword,"type"),uniform:new P("uniform",C.keyword,"uniform"),var:new P("var",C.keyword,"var"),override:new P("override",C.keyword,"override"),workgroup:new P("workgroup",C.keyword,"workgroup"),write:new P("write",C.keyword,"write"),r8unorm:new P("r8unorm",C.keyword,"r8unorm"),r8snorm:new P("r8snorm",C.keyword,"r8snorm"),r8uint:new P("r8uint",C.keyword,"r8uint"),r8sint:new P("r8sint",C.keyword,"r8sint"),r16uint:new P("r16uint",C.keyword,"r16uint"),r16sint:new P("r16sint",C.keyword,"r16sint"),r16float:new P("r16float",C.keyword,"r16float"),rg8unorm:new P("rg8unorm",C.keyword,"rg8unorm"),rg8snorm:new P("rg8snorm",C.keyword,"rg8snorm"),rg8uint:new P("rg8uint",C.keyword,"rg8uint"),rg8sint:new P("rg8sint",C.keyword,"rg8sint"),r32uint:new P("r32uint",C.keyword,"r32uint"),r32sint:new P("r32sint",C.keyword,"r32sint"),r32float:new P("r32float",C.keyword,"r32float"),rg16uint:new P("rg16uint",C.keyword,"rg16uint"),rg16sint:new P("rg16sint",C.keyword,"rg16sint"),rg16float:new P("rg16float",C.keyword,"rg16float"),rgba8unorm:new P("rgba8unorm",C.keyword,"rgba8unorm"),rgba8unorm_srgb:new P("rgba8unorm_srgb",C.keyword,"rgba8unorm_srgb"),rgba8snorm:new P("rgba8snorm",C.keyword,"rgba8snorm"),rgba8uint:new P("rgba8uint",C.keyword,"rgba8uint"),rgba8sint:new P("rgba8sint",C.keyword,"rgba8sint"),bgra8unorm:new P("bgra8unorm",C.keyword,"bgra8unorm"),bgra8unorm_srgb:new P("bgra8unorm_srgb",C.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new P("rgb10a2unorm",C.keyword,"rgb10a2unorm"),rg11b10float:new P("rg11b10float",C.keyword,"rg11b10float"),rg32uint:new P("rg32uint",C.keyword,"rg32uint"),rg32sint:new P("rg32sint",C.keyword,"rg32sint"),rg32float:new P("rg32float",C.keyword,"rg32float"),rgba16uint:new P("rgba16uint",C.keyword,"rgba16uint"),rgba16sint:new P("rgba16sint",C.keyword,"rgba16sint"),rgba16float:new P("rgba16float",C.keyword,"rgba16float"),rgba32uint:new P("rgba32uint",C.keyword,"rgba32uint"),rgba32sint:new P("rgba32sint",C.keyword,"rgba32sint"),rgba32float:new P("rgba32float",C.keyword,"rgba32float"),static_assert:new P("static_assert",C.keyword,"static_assert")};S.tokens={decimal_float_literal:new P("decimal_float_literal",C.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new P("hex_float_literal",C.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new P("int_literal",C.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new P("uint_literal",C.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new P("ident",C.token,/[a-zA-Z][0-9a-zA-Z_]*/),and:new P("and",C.token,"&"),and_and:new P("and_and",C.token,"&&"),arrow:new P("arrow ",C.token,"->"),attr:new P("attr",C.token,"@"),attr_left:new P("attr_left",C.token,"[["),attr_right:new P("attr_right",C.token,"]]"),forward_slash:new P("forward_slash",C.token,"/"),bang:new P("bang",C.token,"!"),bracket_left:new P("bracket_left",C.token,"["),bracket_right:new P("bracket_right",C.token,"]"),brace_left:new P("brace_left",C.token,"{"),brace_right:new P("brace_right",C.token,"}"),colon:new P("colon",C.token,":"),comma:new P("comma",C.token,","),equal:new P("equal",C.token,"="),equal_equal:new P("equal_equal",C.token,"=="),not_equal:new P("not_equal",C.token,"!="),greater_than:new P("greater_than",C.token,">"),greater_than_equal:new P("greater_than_equal",C.token,">="),shift_right:new P("shift_right",C.token,">>"),less_than:new P("less_than",C.token,"<"),less_than_equal:new P("less_than_equal",C.token,"<="),shift_left:new P("shift_left",C.token,"<<"),modulo:new P("modulo",C.token,"%"),minus:new P("minus",C.token,"-"),minus_minus:new P("minus_minus",C.token,"--"),period:new P("period",C.token,"."),plus:new P("plus",C.token,"+"),plus_plus:new P("plus_plus",C.token,"++"),or:new P("or",C.token,"|"),or_or:new P("or_or",C.token,"||"),paren_left:new P("paren_left",C.token,"("),paren_right:new P("paren_right",C.token,")"),semicolon:new P("semicolon",C.token,";"),star:new P("star",C.token,"*"),tilde:new P("tilde",C.token,"~"),underscore:new P("underscore",C.token,"_"),xor:new P("xor",C.token,"^"),plus_equal:new P("plus_equal",C.token,"+="),minus_equal:new P("minus_equal",C.token,"-="),times_equal:new P("times_equal",C.token,"*="),division_equal:new P("division_equal",C.token,"/="),modulo_equal:new P("modulo_equal",C.token,"%="),and_equal:new P("and_equal",C.token,"&="),or_equal:new P("or_equal",C.token,"|="),xor_equal:new P("xor_equal",C.token,"^="),shift_right_equal:new P("shift_right_equal",C.token,">>="),shift_left_equal:new P("shift_left_equal",C.token,"<<=")};S.storage_class=[F.keywords.function,F.keywords.private,F.keywords.workgroup,F.keywords.uniform,F.keywords.storage];S.access_mode=[F.keywords.read,F.keywords.write,F.keywords.read_write];S.sampler_type=[F.keywords.sampler,F.keywords.sampler_comparison];S.sampled_texture_type=[F.keywords.texture_1d,F.keywords.texture_2d,F.keywords.texture_2d_array,F.keywords.texture_3d,F.keywords.texture_cube,F.keywords.texture_cube_array];S.multisampled_texture_type=[F.keywords.texture_multisampled_2d];S.storage_texture_type=[F.keywords.texture_storage_1d,F.keywords.texture_storage_2d,F.keywords.texture_storage_2d_array,F.keywords.texture_storage_3d];S.depth_texture_type=[F.keywords.texture_depth_2d,F.keywords.texture_depth_2d_array,F.keywords.texture_depth_cube,F.keywords.texture_depth_cube_array,F.keywords.texture_depth_multisampled_2d];S.texture_external_type=[F.keywords.texture_external];S.any_texture_type=[...F.sampled_texture_type,...F.multisampled_texture_type,...F.storage_texture_type,...F.depth_texture_type,...F.texture_external_type];S.texel_format=[F.keywords.r8unorm,F.keywords.r8snorm,F.keywords.r8uint,F.keywords.r8sint,F.keywords.r16uint,F.keywords.r16sint,F.keywords.r16float,F.keywords.rg8unorm,F.keywords.rg8snorm,F.keywords.rg8uint,F.keywords.rg8sint,F.keywords.r32uint,F.keywords.r32sint,F.keywords.r32float,F.keywords.rg16uint,F.keywords.rg16sint,F.keywords.rg16float,F.keywords.rgba8unorm,F.keywords.rgba8unorm_srgb,F.keywords.rgba8snorm,F.keywords.rgba8uint,F.keywords.rgba8sint,F.keywords.bgra8unorm,F.keywords.bgra8unorm_srgb,F.keywords.rgb10a2unorm,F.keywords.rg11b10float,F.keywords.rg32uint,F.keywords.rg32sint,F.keywords.rg32float,F.keywords.rgba16uint,F.keywords.rgba16sint,F.keywords.rgba16float,F.keywords.rgba32uint,F.keywords.rgba32sint,F.keywords.rgba32float];S.const_literal=[F.tokens.int_literal,F.tokens.uint_literal,F.tokens.decimal_float_literal,F.tokens.hex_float_literal,F.keywords.true,F.keywords.false];S.literal_or_ident=[F.tokens.ident,F.tokens.int_literal,F.tokens.uint_literal,F.tokens.decimal_float_literal,F.tokens.hex_float_literal];S.element_count_expression=[F.tokens.int_literal,F.tokens.uint_literal,F.tokens.ident];S.template_types=[F.keywords.vec2,F.keywords.vec3,F.keywords.vec4,F.keywords.mat2x2,F.keywords.mat2x3,F.keywords.mat2x4,F.keywords.mat3x2,F.keywords.mat3x3,F.keywords.mat3x4,F.keywords.mat4x2,F.keywords.mat4x3,F.keywords.mat4x4,F.keywords.atomic,F.keywords.bitcast,...F.any_texture_type];S.attribute_name=[F.tokens.ident,F.keywords.block];S.assignment_operators=[F.tokens.equal,F.tokens.plus_equal,F.tokens.minus_equal,F.tokens.times_equal,F.tokens.division_equal,F.tokens.modulo_equal,F.tokens.and_equal,F.tokens.or_equal,F.tokens.xor_equal,F.tokens.shift_right_equal,F.tokens.shift_left_equal];S.increment_operators=[F.tokens.plus_plus,F.tokens.minus_minus];class bm{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return S.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==S.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class ox{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new bm(S.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let r=1;for(;r>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),r--,r==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),r++)}return!0}}let n=S.none;for(;;){let r=this._findType(e);const i=this._peekAhead();if(e==">"&&(i==">"||i=="=")){let s=!1,o=this._tokens.length-1;for(let a=0;a<5&&o>=0;++a,--o)if(this._tokens[o].type===S.tokens.less_than){o>0&&this._tokens[o-1].isArrayOrTemplateType()&&(s=!0);break}if(s)return this._addToken(r),!0}if(r===S.none){let s=e,o=0;const a=2;for(let l=0;l<a;++l)if(s+=this._peekAhead(l),r=this._findType(s),r!==S.none){o=l;break}if(r===S.none)return n===S.none?!1:(this._current--,this._addToken(n),!0);e=s,this._current+=o+1}if(n=r,this._isAtEnd())break;e+=this._advance()}return n===S.none?!1:(this._addToken(n),!0)}_findType(e){for(const n in S.keywords){const r=S.keywords[n];if(this._match(e,r.rule))return r}for(const n in S.tokens){const r=S.tokens[n];if(this._match(e,r.rule))return r}return S.none}_match(e,n){if(typeof n=="string"){if(n==e)return!0}else{const r=n.exec(e);if(r&&r.index==0&&r[0]==e)return!0}return!1}_isAtEnd(){return this._current>=this._source.length}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new bm(e,n,this._line))}}class ax{constructor(){this._tokens=[],this._current=0,this._context=new NP}parse(e){this._initialize(e);let n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new ox(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return console.error(e,n),{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==S.eof}_match(e){if(e instanceof P)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){let r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){return this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._match(S.keywords.alias)){const n=this._type_alias();return this._consume(S.tokens.semicolon,"Expected ';'"),n}if(this._match(S.keywords.enable)){const n=this._enable_directive();return this._consume(S.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(S.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(S.tokens.semicolon,"Expected ';'."),n}if(this._check(S.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(S.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(S.keywords.fn))return null;const e=this._consume(S.tokens.ident,"Expected function name.").toString();this._consume(S.tokens.paren_left,"Expected '(' for function arguments.");const n=[];if(!this._check(S.tokens.paren_right))do{if(this._check(S.tokens.paren_right))break;const s=this._attribute(),o=this._consume(S.tokens.ident,"Expected argument name.").toString();this._consume(S.tokens.colon,"Expected ':' for argument type.");const a=this._attribute(),l=this._type_decl();l!=null&&(l.attributes=a,n.push(new rx(o,l,s)))}while(this._match(S.tokens.comma));this._consume(S.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(S.tokens.arrow)){const s=this._attribute();r=this._type_decl(),r!=null&&(r.attributes=s)}const i=this._compound_statement();return new vw(e,n,r,i)}_compound_statement(){const e=[];for(this._consume(S.tokens.brace_left,"Expected '{' for block.");!this._check(S.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(S.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(S.tokens.semicolon)&&!this._isAtEnd(););if(this._check(S.keywords.if))return this._if_statement();if(this._check(S.keywords.switch))return this._switch_statement();if(this._check(S.keywords.loop))return this._loop_statement();if(this._check(S.keywords.for))return this._for_statement();if(this._check(S.keywords.while))return this._while_statement();if(this._check(S.keywords.continuing))return this._continuing_statement();if(this._check(S.keywords.static_assert))return this._static_assert_statement();if(this._check(S.tokens.brace_left))return this._compound_statement();let e=null;return this._check(S.keywords.return)?e=this._return_statement():this._check([S.keywords.var,S.keywords.let,S.keywords.const])?e=this._variable_statement():this._match(S.keywords.discard)?e=new XP:this._match(S.keywords.break)?e=new YP:this._match(S.keywords.continue)?e=new KP:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(S.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(S.keywords.static_assert))return null;let e=this._optional_paren_expression();return new kP(e)}_while_statement(){if(!this._match(S.keywords.while))return null;let e=this._optional_paren_expression();const n=this._compound_statement();return new FP(e,n)}_continuing_statement(){if(!this._match(S.keywords.continuing))return null;const e=this._compound_statement();return new DP(e)}_for_statement(){if(!this._match(S.keywords.for))return null;this._consume(S.tokens.paren_left,"Expected '('.");const e=this._check(S.tokens.semicolon)?null:this._for_init();this._consume(S.tokens.semicolon,"Expected ';'.");const n=this._check(S.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(S.tokens.semicolon,"Expected ';'.");const r=this._check(S.tokens.paren_right)?null:this._for_increment();this._consume(S.tokens.paren_right,"Expected ')'.");const i=this._compound_statement();return new BP(e,n,r,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(S.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(S.tokens.equal)&&(n=this._short_circuit_or_expression()),new _i(e.name,e.type,e.storage,e.access,n)}if(this._match(S.keywords.let)){const e=this._consume(S.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(S.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new vm(e,n,null,null,r)}if(this._match(S.keywords.const)){const e=this._consume(S.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(S.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new Tm(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(S.increment_operators))return this._current=e,null;const r=this._consume(S.increment_operators,"Expected increment operator");return new UP(r.type===S.tokens.plus_plus?Wi.increment:Wi.decrement,n)}_assignment_statement(){let e=null;if(this._check(S.tokens.brace_right))return null;let n=this._match(S.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(S.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new LP(vo.parse(r.lexeme),e,i)}_func_call_statement(){if(!this._check(S.tokens.ident))return null;const e=this._current,n=this._consume(S.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new zP(n.lexeme,r)}_loop_statement(){if(!this._match(S.keywords.loop))return null;this._consume(S.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.push(i);else e.push(n);n=this._statement()}let r=null;return this._match(S.keywords.continuing)&&(r=this._compound_statement()),this._consume(S.tokens.brace_right,"Expected '}' for loop."),new VP(e,r)}_switch_statement(){if(!this._match(S.keywords.switch))return null;const e=this._optional_paren_expression();this._consume(S.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(S.tokens.brace_right,"Expected '}' for switch."),new jP(e,n)}_switch_body(){const e=[];if(this._match(S.keywords.case)){const n=this._case_selectors();this._match(S.tokens.colon),this._consume(S.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch case."),e.push(new tx(n,r))}if(this._match(S.keywords.default)){this._match(S.tokens.colon),this._consume(S.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(S.tokens.brace_right,"Exected '}' for switch default."),e.push(new nx(n))}if(this._check([S.keywords.default,S.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){var e,n,r,i;const s=[(n=(e=this._shift_expression())===null||e===void 0?void 0:e.evaluate(this._context).toString())!==null&&n!==void 0?n:""];for(;this._match(S.tokens.comma);)s.push((i=(r=this._shift_expression())===null||r===void 0?void 0:r.evaluate(this._context).toString())!==null&&i!==void 0?i:"");return s}_case_body(){if(this._match(S.keywords.fallthrough))return this._consume(S.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(S.keywords.if))return null;const e=this._optional_paren_expression(),n=this._compound_statement();let r=[];this._match_elseif()&&(r=this._elseif_statement(r));let i=null;return this._match(S.keywords.else)&&(i=this._compound_statement()),new WP(e,n,r,i)}_match_elseif(){return this._tokens[this._current].type===S.keywords.else&&this._tokens[this._current+1].type===S.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new ix(n,r)),this._match_elseif()&&this._elseif_statement(e),e}_return_statement(){if(!this._match(S.keywords.return))return null;const e=this._short_circuit_or_expression();return new HP(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(S.tokens.or_or);)e=new Vt(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(S.tokens.and_and);)e=new Vt(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(S.tokens.or);)e=new Vt(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(S.tokens.xor);)e=new Vt(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(S.tokens.and);)e=new Vt(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([S.tokens.equal_equal,S.tokens.not_equal])?new Vt(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([S.tokens.less_than,S.tokens.greater_than,S.tokens.less_than_equal,S.tokens.greater_than_equal]);)e=new Vt(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([S.tokens.shift_left,S.tokens.shift_right]);)e=new Vt(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([S.tokens.plus,S.tokens.minus]);)e=new Vt(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([S.tokens.star,S.tokens.forward_slash,S.tokens.modulo]);)e=new Vt(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([S.tokens.minus,S.tokens.bang,S.tokens.tilde,S.tokens.star,S.tokens.and])?new ex(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(S.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(S.tokens.bracket_right,"Expected ']'.");const n=this._postfix_expression();return n&&(e.postfix=n),e}if(this._match(S.tokens.period)){const e=this._consume(S.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new wm(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(S.tokens.ident)){const r=this._previous().toString();if(this._check(S.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new xs(s,i):new ZP(r,i)}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return new Em(r,i.value)}return new QP(r)}if(this._match(S.const_literal))return new Sm(parseFloat(this._previous().toString()));if(this._check(S.tokens.paren_left))return this._paren_expression();if(this._match(S.keywords.bitcast)){this._consume(S.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(S.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new JP(r,i)}const e=this._type_decl(),n=this._argument_expression_list();return new GP(e,n)}_argument_expression_list(){if(!this._match(S.tokens.paren_left))return null;const e=[];do{if(this._check(S.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(S.tokens.comma));return this._consume(S.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(S.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(S.tokens.paren_right),new Am([e])}_paren_expression(){this._consume(S.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(S.tokens.paren_right,"Expected ')'."),new Am([e])}_struct_decl(){if(!this._match(S.keywords.struct))return null;const e=this._consume(S.tokens.ident,"Expected name for struct.").toString();this._consume(S.tokens.brace_left,"Expected '{' for struct body.");const n=[];for(;!this._check(S.tokens.brace_right);){const i=this._attribute(),s=this._consume(S.tokens.ident,"Expected variable name.").toString();this._consume(S.tokens.colon,"Expected ':' for struct member type.");const o=this._attribute(),a=this._type_decl();a!=null&&(a.attributes=o),this._check(S.tokens.brace_right)?this._match(S.tokens.comma):this._consume(S.tokens.comma,"Expected ',' for struct member."),n.push(new sx(s,a,i))}this._consume(S.tokens.brace_right,"Expected '}' after struct body.");const r=new dr(e,n);return this._context.structs.set(e,r),r}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(S.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(S.keywords.const))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(S.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof xs)r=s;else if(s instanceof Em&&s.initializer instanceof xs)r=s.initializer;else try{const o=s.evaluate(this._context);r=new Sm(o)}catch{r=s}}const i=new Tm(e.toString(),n,"","",r);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(S.keywords.let))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;return this._match(S.tokens.equal)&&(r=this._const_expression()),new vm(e.toString(),n,"","",r)}_const_expression(){if(this._match(S.const_literal))return new wm(this._previous().toString());const e=this._type_decl();this._consume(S.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(S.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(S.tokens.comma));)this._advance();return this._consume(S.tokens.paren_right,"Expected ')'."),new xs(e,n)}_variable_decl(){if(!this._match(S.keywords.var))return null;let e="",n="";this._match(S.tokens.less_than)&&(e=this._consume(S.storage_class,"Expected storage_class.").toString(),this._match(S.tokens.comma)&&(n=this._consume(S.access_mode,"Expected access_mode.").toString()),this._consume(S.tokens.greater_than,"Expected '>'."));const r=this._consume(S.tokens.ident,"Expected variable name");let i=null;if(this._match(S.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return new _i(r.toString(),i,e,n,null)}_override_decl(){if(!this._match(S.keywords.override))return null;const e=this._consume(S.tokens.ident,"Expected variable name");let n=null;if(this._match(S.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new Tw(e.toString(),n,null)}_enable_directive(){const e=this._consume(S.tokens.ident,"identity expected.");return new $P(e.toString())}_type_alias(){const e=this._consume(S.tokens.ident,"identity expected.");this._consume(S.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new ww(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([S.tokens.ident,...S.texel_format,S.keywords.bool,S.keywords.f32,S.keywords.i32,S.keywords.u32])){const r=this._advance(),i=r.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new Yr(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(S.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(S.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(S.tokens.comma)&&(s=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for type.")),new Ew(r,i,s)}if(this._match(S.keywords.ptr)){let r=this._previous().toString();this._consume(S.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(S.storage_class,"Expected storage_class for pointer");this._consume(S.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(S.tokens.comma)&&(o=this._consume(S.access_mode,"Expected access_mode for pointer").toString()),this._consume(S.tokens.greater_than,"Expected '>' for pointer."),new qP(r,i.toString(),s,o)}const n=this._attribute();if(this._match(S.keywords.array)){let r=null,i=-1;const s=this._previous();if(this._match(S.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let o="";this._match(S.tokens.comma)&&(o=this._shift_expression().evaluate(this._context).toString()),this._consume(S.tokens.greater_than,"Expected '>' for array."),i=o?parseInt(o):0}return new Sw(s.toString(),n,r,i)}return null}_texture_sampler_types(){if(this._match(S.sampler_type))return new Ps(this._previous().toString(),null,null);if(this._match(S.depth_texture_type))return new Ps(this._previous().toString(),null,null);if(this._match(S.sampled_texture_type)||this._match(S.multisampled_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new Ps(e.toString(),n,null)}if(this._match(S.storage_texture_type)){const e=this._previous();this._consume(S.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(S.texel_format,"Invalid texel format.").toString();this._consume(S.tokens.comma,"Expected ',' after texel format.");const r=this._consume(S.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(S.tokens.greater_than,"Expected '>' for sampler type."),new Ps(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(S.tokens.attr);){const n=this._consume(S.attribute_name,"Expected attribute name"),r=new Rm(n.toString(),null);if(this._match(S.tokens.paren_left)){if(r.value=this._consume(S.literal_or_ident,"Expected attribute value").toString(),this._check(S.tokens.comma)){this._advance();do{const i=this._consume(S.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(r)}for(;this._match(S.tokens.attr_left);){if(!this._check(S.tokens.attr_right))do{const n=this._consume(S.attribute_name,"Expected attribute name"),r=new Rm(n.toString(),null);if(this._match(S.tokens.paren_left)){if(r.value=[this._consume(S.literal_or_ident,"Expected attribute value").toString()],this._check(S.tokens.comma)){this._advance();do{const i=this._consume(S.literal_or_ident,"Expected attribute value").toString();r.value.push(i)}while(this._match(S.tokens.comma))}this._consume(S.tokens.paren_right,"Expected ')'")}e.push(r)}while(this._match(S.tokens.comma));this._consume(S.tokens.attr_right,"Expected ']]' after attribute declarations")}return e.length==0?null:e}}class xi{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class Cm{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class va extends xi{constructor(e,n){super(e,n),this.members=[],this.align=0}get isStruct(){return!0}}class Gu extends xi{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class Pm extends xi{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}}var kn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(kn||(kn={}));class Ta{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class lx{constructor(e,n){this.name=e,this.type=n}}class wa{constructor(e,n){this.align=e,this.size=n}}class cx{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class xm{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class ux{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.name=e,this.stage=n}}class hx{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class fx{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class gn{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new hx,this._types=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new ax().parse(e);for(const i of r){if(i instanceof dr){const s=this._getTypeInfo(i,null);s instanceof va&&this.structs.push(s);continue}if(i instanceof ww){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof Tw){const s=i,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new fx(s.name,a,s.attributes,o));continue}if(this._isUniformVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new Ta(s.name,l,o,a,s.attributes,kn.Uniform,s.access);this.uniforms.push(c);continue}if(this._isStorageVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new Ta(s.name,l,o,a,s.attributes,c?kn.StorageTexture:kn.Storage,s.access);this.storage.push(u);continue}if(this._isTextureVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new Ta(s.name,l,o,a,s.attributes,c?kn.StorageTexture:kn.Texture,s.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new Ta(s.name,l,o,a,s.attributes,kn.Sampler,s.access);this.samplers.push(c);continue}if(i instanceof vw){const s=this._getAttribute(i,"vertex"),o=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=s||o||a;if(l){const c=new ux(i.name,l.name);c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(c)}continue}}}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof dr)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof dr)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new xm(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new xm("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof dr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof dr)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new cx(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new lx(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof Sw){const i=e,s=this._getTypeInfo(i.format,i.attributes),o=new Gu(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof dr){const i=e,s=new va(i.name,n);for(const o of i.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new Cm(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Ps){const i=e,s=i.format instanceof Yr,o=i.format?s?this._getTypeInfo(i.format,null):new xi(i.format,null):null,a=new Pm(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Ew){const i=e,s=i.format?this._getTypeInfo(i.format,null):null,o=new Pm(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new xi(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const i=this._getTypeSize(e);if(e.size=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,e instanceof Gu){const s=this._getTypeSize(e.format);e.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof va&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const h=u.align,f=u.size;r=this._roundUp(h,r+i),i=f,s=r,o=Math.max(o,h),c.offset=r,c.size=f,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof Cm&&(e=e.type),e instanceof xi){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=gn._typeInfo[e.name];if(s!==void 0){const o=e.format==="f16"?2:1;return new wa(Math.max(i,s.align/o),Math.max(r,s.size/o))}}{const s=gn._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const o=e.name[e.name.length-1]==="h"?2:1;return new wa(Math.max(i,s.align/o),Math.max(r,s.size/o))}}if(e instanceof Gu){let s=e,o=8,a=8;const l=this._getTypeSize(s.format);l!==null&&(a=l.size,o=l.align);const c=s.count,u=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,a));return a=c*u,r&&(a=r),new wa(Math.max(i,o),Math.max(r,a))}if(e instanceof va){let s=0,o=0,a=0,l=0,c=0;for(const u of e.members){const h=this._getTypeSize(u.type);h!==null&&(s=Math.max(h.align,s),a=this._roundUp(h.align,a+l),l=h.size,c=a)}return o=this._roundUp(s,c+l),new wa(Math.max(i,s),Math.max(r,o))}return null}_isUniformVar(e){return e instanceof _i&&e.storage=="uniform"}_isStorageVar(e){return e instanceof _i&&e.storage=="storage"}_isTextureVar(e){return e instanceof _i&&e.type!==null&&gn._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof _i&&e.type!==null&&gn._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}gn._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};gn._textureTypes=S.any_texture_type.map(t=>t.name);gn._samplerTypes=S.sampler_type.map(t=>t.name);function dx(t){const e={attributes:[],bindings:[]};let n;try{n=px(t)}catch(s){return U.error(s.message)(),e}for(const s of n.uniforms){const o=[];for(const a of s.type.members)o.push({name:a.name,type:Mm(a.type)});e.bindings.push({type:"uniform",name:s.name,location:s.binding,group:s.group,members:o})}const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let s=0;s<i;s++){const o=r.inputs[s];if(o.locationType==="location"){const a=Mm(o.type);e.attributes.push({name:o.name,location:o.location,type:a})}}return e}function Mm(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function px(t){try{return new gn(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const gx=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;
const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;
const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;
const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01;
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03;
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04;
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06;
float sin_taylor_fp32(float a) {
float r, s, t, x;
if (a == 0.0) {
return 0.0;
}
x = -a * a;
s = a;
r = a;
r = r * x;
t = r * INVERSE_FACTORIAL_3;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_5;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_7;
s = s + t;
r = r * x;
t = r * INVERSE_FACTORIAL_9;
s = s + t;
return s;
}
void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
if (a == 0.0) {
sin_t = 0.0;
cos_t = 1.0;
}
sin_t = sin_taylor_fp32(a);
cos_t = sqrt(1.0 - sin_t * sin_t);
}
float tan_taylor_fp32(float a) {
float sin_a;
float cos_a;
if (a == 0.0) {
return 0.0;
}
float z = floor(a / TWO_PI);
float r = a - TWO_PI * z;
float t;
float q = floor(r / PI_2 + 0.5);
int j = int(q);
if (j < -2 || j > 2) {
return 1.0 / 0.0;
}
t = r - PI_2 * q;
q = floor(t / PI_16 + 0.5);
int k = int(q);
int abs_k = int(abs(float(k)));
if (abs_k > 4) {
return 1.0 / 0.0;
} else {
t = t - PI_16 * q;
}
float u = 0.0;
float v = 0.0;
float sin_t, cos_t;
float s, c;
sincos_taylor_fp32(t, sin_t, cos_t);
if (k == 0) {
s = sin_t;
c = cos_t;
} else {
if (abs(float(abs_k) - 1.0) < 0.5) {
u = COS_TABLE_0;
v = SIN_TABLE_0;
} else if (abs(float(abs_k) - 2.0) < 0.5) {
u = COS_TABLE_1;
v = SIN_TABLE_1;
} else if (abs(float(abs_k) - 3.0) < 0.5) {
u = COS_TABLE_2;
v = SIN_TABLE_2;
} else if (abs(float(abs_k) - 4.0) < 0.5) {
u = COS_TABLE_3;
v = SIN_TABLE_3;
}
if (k > 0) {
s = u * sin_t + v * cos_t;
c = u * cos_t - v * sin_t;
} else {
s = u * sin_t - v * cos_t;
c = u * cos_t + v * sin_t;
}
}
if (j == 0) {
sin_a = s;
cos_a = c;
} else if (j == 1) {
sin_a = c;
cos_a = -s;
} else if (j == -1) {
sin_a = -c;
cos_a = s;
} else {
sin_a = -s;
cos_a = -c;
}
return sin_a / cos_a;
}
#endif
float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
return tan_taylor_fp32(a);
#else
return tan(a);
#endif
}
`,_x={name:"fp32",vs:gx},mx=new Float32Array([0,1,1,1]),yx=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
out vec4 picking_vRGBcolor_Avalid;
vec3 picking_normalizeColor(vec3 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
vec4 picking_normalizeColor(vec4 color) {
return picking.useFloatColors > 0.5 ? color : color / 255.0;
}
bool picking_isColorZero(vec3 color) {
return dot(color, vec3(1.0)) < 0.00001;
}
bool picking_isColorValid(vec3 color) {
return dot(color, vec3(1.0)) > 0.00001;
}
bool isVertexHighlighted(vec3 vertexColor) {
vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
return
bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}
void picking_setPickingColor(vec3 pickingColor) {
pickingColor = picking_normalizeColor(pickingColor);
if (bool(picking.isActive)) {
picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));
picking_vRGBcolor_Avalid.rgb = pickingColor;
} else {
picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
}
}
void picking_setPickingAttribute(float value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.r = value;
}
}
void picking_setPickingAttribute(vec2 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rg = value;
}
}
void picking_setPickingAttribute(vec3 value) {
if (bool(picking.isAttribute)) {
picking_vRGBcolor_Avalid.rgb = value;
}
}
`,vx=`uniform pickingUniforms {
float isActive;
float isAttribute;
float isHighlightActive;
float useFloatColors;
vec3 highlightedObjectColor;
vec4 highlightColor;
} picking;
in vec4 picking_vRGBcolor_Avalid;
vec4 picking_filterHighlightColor(vec4 color) {
if (picking.isActive > 0.5) {
return color;
}
bool selected = bool(picking_vRGBcolor_Avalid.a);
if (selected) {
float highLightAlpha = picking.highlightColor.a;
float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
float highLightRatio = highLightAlpha / blendedAlpha;
vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
return vec4(blendedRGB, blendedAlpha);
} else {
return color;
}
}
vec4 picking_filterPickingColor(vec4 color) {
if (bool(picking.isActive)) {
if (picking_vRGBcolor_Avalid.a == 0.0) {
discard;
}
return picking_vRGBcolor_Avalid;
}
return color;
}
vec4 picking_filterColor(vec4 color) {
vec4 highlightColor = picking_filterHighlightColor(color);
return picking_filterPickingColor(highlightColor);
}
`,Im={name:"picking",vs:yx,fs:vx,uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:new Float32Array([0,0,0]),highlightColor:mx},getUniforms:Tx};function Tx(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const wx={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...wx}};const ct=globalThis.mathgl.config;function Ex(t,{precision:e=ct.precision}={}){return t=Sx(t),`${parseFloat(t.toPrecision(e))}`}function Hi(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ln(t,e,n){return Rx(t,r=>Math.max(e,Math.min(n,r)))}function To(t,e,n){return Hi(t)?t.map((r,i)=>To(r,e[i],n)):n*e+(1-n)*t}function $i(t,e,n){const r=ct.EPSILON;n&&(ct.EPSILON=n);try{if(t===e)return!0;if(Hi(t)&&Hi(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!$i(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=ct.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{ct.EPSILON=r}}function Sx(t){return Math.round(t/ct.EPSILON)*ct.EPSILON}function Ax(t){return t.clone?t.clone():new Array(t.length)}function Rx(t,e,n){if(Hi(t)){const r=t;n=n||Ax(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class bw extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Hi(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ct)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+Ex(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!$i(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(ct.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function bx(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function at(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function eh(t,e,n=""){if(ct.debug&&!bx(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function Om(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class Cx extends bw{get x(){return this[0]}set x(e){this[0]=at(e)}get y(){return this[1]}set y(e){this[1]=at(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return at(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return at(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Om(e>=0&&e<this.ELEMENTS,"index is out of range"),at(this[e])}setComponent(e,n){return Om(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const qa=1e-6;let Xi=typeof Float32Array<"u"?Float32Array:Array;function Px(){const t=new Xi(2);return Xi!=Float32Array&&(t[0]=0,t[1]=0),t}function Lf(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function xx(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Mx(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function Ix(t){const e=t[0],n=t[1];return Math.sqrt(e*e+n*n)}function Ox(t,e){return t[0]=-e[0],t[1]=-e[1],t}function Cw(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function Nx(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}const kx=xx;(function(){const t=Px();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function Fx(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function Pw(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function Dx(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function Bx(){const t=new Xi(3);return Xi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ux(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Lx(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function zx(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Vx(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function xw(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function jx(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function Wx(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=i*c-s*l,h=s*a-r*c,f=r*l-i*a,d=i*f-s*h,_=s*u-r*f,v=r*h-i*u;const A=o*2;return u*=A,h*=A,f*=A,d*=2,_*=2,v*=2,t[0]=a+u+d,t[1]=l+h+_,t[2]=c+f+v,t}function Hx(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function $x(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Xx(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function Yx(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),c=l&&zx(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const Kx=Ux;(function(){const t=Bx();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const th=[0,0,0];let Ea;class en extends Cx{static get ZERO(){return Ea||(Ea=new en(0,0,0),Object.freeze(Ea)),Ea}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Hi(e)?this.copy(e):(ct.debug&&(at(e),at(n),at(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ct.debug&&(at(e.x),at(e.y),at(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=at(e)}angle(e){return Yx(this,e)}cross(e){return Vx(this,this,e),this.check()}rotateX({radians:e,origin:n=th}){return Hx(this,this,n,e),this.check()}rotateY({radians:e,origin:n=th}){return $x(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=th}){return Xx(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return xw(this,this,e),this.check()}transformAsVector(e){return Pw(this,this,e),this.check()}transformByMatrix3(e){return jx(this,this,e),this.check()}transformByMatrix2(e){return Dx(this,this,e),this.check()}transformByQuaternion(e){return Wx(this,this,e),this.check()}}class qx extends bw{toString(){let e="[";if(ct.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=at(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function Zx(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qx(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function zf(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],h=e[9],f=e[10],d=e[11],_=e[12],v=e[13],A=e[14],p=e[15],g=n*a-r*o,m=n*l-i*o,E=n*c-s*o,b=r*l-i*a,x=r*c-s*a,O=i*c-s*l,M=u*v-h*_,N=u*A-f*_,k=u*p-d*_,z=h*A-f*v,L=h*p-d*v,j=f*p-d*A;let X=g*j-m*L+E*z+b*k-x*N+O*M;return X?(X=1/X,t[0]=(a*j-l*L+c*z)*X,t[1]=(i*L-r*j-s*z)*X,t[2]=(v*O-A*x+p*b)*X,t[3]=(f*x-h*O-d*b)*X,t[4]=(l*k-o*j-c*N)*X,t[5]=(n*j-i*k+s*N)*X,t[6]=(A*E-_*O-p*m)*X,t[7]=(u*O-f*E+d*m)*X,t[8]=(o*L-a*k+c*M)*X,t[9]=(r*k-n*L-s*M)*X,t[10]=(_*x-v*E+p*g)*X,t[11]=(h*E-u*x-d*g)*X,t[12]=(a*N-o*z-l*M)*X,t[13]=(n*z-r*N+i*M)*X,t[14]=(v*m-_*b-A*g)*X,t[15]=(u*b-h*m+f*g)*X,t):null}function Jx(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],h=t[10],f=t[11],d=t[12],_=t[13],v=t[14],A=t[15],p=e*o-n*s,g=e*a-r*s,m=n*a-r*o,E=c*_-u*d,b=c*v-h*d,x=u*v-h*_,O=e*x-n*b+r*E,M=s*x-o*b+a*E,N=c*m-u*g+h*p,k=d*m-_*g+v*p;return l*O-i*M+A*N-f*k}function Cr(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],h=e[8],f=e[9],d=e[10],_=e[11],v=e[12],A=e[13],p=e[14],g=e[15];let m=n[0],E=n[1],b=n[2],x=n[3];return t[0]=m*r+E*a+b*h+x*v,t[1]=m*i+E*l+b*f+x*A,t[2]=m*s+E*c+b*d+x*p,t[3]=m*o+E*u+b*_+x*g,m=n[4],E=n[5],b=n[6],x=n[7],t[4]=m*r+E*a+b*h+x*v,t[5]=m*i+E*l+b*f+x*A,t[6]=m*s+E*c+b*d+x*p,t[7]=m*o+E*u+b*_+x*g,m=n[8],E=n[9],b=n[10],x=n[11],t[8]=m*r+E*a+b*h+x*v,t[9]=m*i+E*l+b*f+x*A,t[10]=m*s+E*c+b*d+x*p,t[11]=m*o+E*u+b*_+x*g,m=n[12],E=n[13],b=n[14],x=n[15],t[12]=m*r+E*a+b*h+x*v,t[13]=m*i+E*l+b*f+x*A,t[14]=m*s+E*c+b*d+x*p,t[15]=m*o+E*u+b*_+x*g,t}function Dl(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,c,u,h,f,d,_,v,A,p;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],h=e[5],f=e[6],d=e[7],_=e[8],v=e[9],A=e[10],p=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=h,t[6]=f,t[7]=d,t[8]=_,t[9]=v,t[10]=A,t[11]=p,t[12]=o*r+u*i+_*s+e[12],t[13]=a*r+h*i+v*s+e[13],t[14]=l*r+f*i+A*s+e[14],t[15]=c*r+d*i+p*s+e[15]),t}function Fp(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Gx(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,c,u,h,f,d,_,v,A,p,g,m,E,b,x,O,M,N,k,z,L,j,X,Z;return a<qa?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,h=e[0],f=e[1],d=e[2],_=e[3],v=e[4],A=e[5],p=e[6],g=e[7],m=e[8],E=e[9],b=e[10],x=e[11],O=i*i*u+l,M=s*i*u+o*c,N=o*i*u-s*c,k=i*s*u-o*c,z=s*s*u+l,L=o*s*u+i*c,j=i*o*u+s*c,X=s*o*u-i*c,Z=o*o*u+l,t[0]=h*O+v*M+m*N,t[1]=f*O+A*M+E*N,t[2]=d*O+p*M+b*N,t[3]=_*O+g*M+x*N,t[4]=h*k+v*z+m*L,t[5]=f*k+A*z+E*L,t[6]=d*k+p*z+b*L,t[7]=_*k+g*z+x*L,t[8]=h*j+v*X+m*Z,t[9]=f*j+A*X+E*Z,t[10]=d*j+p*X+b*Z,t[11]=_*j+g*X+x*Z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Mw(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+h*r,t[7]=l*i+f*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=h*i-a*r,t[11]=f*i-l*r,t}function e2(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-h*r,t[3]=l*i-f*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+h*i,t[11]=l*r+f*i,t}function Iw(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+h*r,t[3]=l*i+f*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=h*i-a*r,t[7]=f*i-l*r,t}function t2(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,h=r*a,f=i*o,d=i*a,_=i*l,v=s*o,A=s*a,p=s*l;return t[0]=1-h-_,t[1]=u+p,t[2]=f-A,t[3]=0,t[4]=u-p,t[5]=1-c-_,t[6]=d+v,t[7]=0,t[8]=f+A,t[9]=d-v,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function n2(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function r2(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const i2=r2;function s2(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}const o2=s2;function a2(t,e,n,r){let i,s,o,a,l,c,u,h,f,d;const _=e[0],v=e[1],A=e[2],p=r[0],g=r[1],m=r[2],E=n[0],b=n[1],x=n[2];return Math.abs(_-E)<qa&&Math.abs(v-b)<qa&&Math.abs(A-x)<qa?Zx(t):(h=_-E,f=v-b,d=A-x,i=1/Math.sqrt(h*h+f*f+d*d),h*=i,f*=i,d*=i,s=g*d-m*f,o=m*h-p*d,a=p*f-g*h,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=f*a-d*o,c=d*s-h*a,u=h*o-f*s,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=h,t[3]=0,t[4]=o,t[5]=c,t[6]=f,t[7]=0,t[8]=a,t[9]=u,t[10]=d,t[11]=0,t[12]=-(s*_+o*v+a*A),t[13]=-(l*_+c*v+u*A),t[14]=-(h*_+f*v+d*A),t[15]=1,t)}function l2(){const t=new Xi(4);return Xi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function c2(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Uo(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=l2();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Vf;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Vf||(Vf={}));const u2=45*Math.PI/180,h2=1,nh=.1,rh=500,f2=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class tn extends qx{static get IDENTITY(){return p2()}static get ZERO(){return d2()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Vf}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,h,f,d,_,v,A){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=h,this[11]=f,this[12]=d,this[13]=_,this[14]=v,this[15]=A,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,h,f,d,_,v,A){return this[0]=e,this[1]=s,this[2]=c,this[3]=d,this[4]=n,this[5]=o,this[6]=u,this[7]=_,this[8]=r,this[9]=a,this[10]=h,this[11]=v,this[12]=i,this[13]=l,this[14]=f,this[15]=A,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(f2)}fromObject(e){return this.check()}fromQuaternion(e){return t2(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=nh,far:a=rh}=e;return a===1/0?g2(this,n,r,i,s,o):n2(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return a2(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=nh,far:a=rh}=e;return o2(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=u2,aspect:r=h2,focalDistance:i=1,near:s=nh,far:o=rh}=e;Nm(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Nm(n),i2(this,n,r,i,s),this.check()}determinant(){return Jx(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return Qx(this,this),this.check()}invert(){return zf(this,this),this.check()}multiplyLeft(e){return Cr(this,e,this),this.check()}multiplyRight(e){return Cr(this,this,e),this.check()}rotateX(e){return Mw(this,this,e),this.check()}rotateY(e){return e2(this,this,e),this.check()}rotateZ(e){return Iw(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return Gx(this,this,e,n),this.check()}scale(e){return Fp(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Dl(this,this,e),this.check()}transform(e,n){return e.length===4?(n=Uo(n||[-0,-0,-0,-0],e,this),eh(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=Nx(n||[-0,-0],e,this);break;case 3:i=xw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return eh(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=Fx(n||[-0,-0],e,this);break;case 3:r=Pw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return eh(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let Sa,Aa;function d2(){return Sa||(Sa=new tn([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(Sa)),Sa}function p2(){return Aa||(Aa=new tn,Object.freeze(Aa)),Aa}function Nm(t){if(t>Math.PI*2)throw Error("expected radians")}function g2(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,h=-1,f=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=h,t[12]=0,t[13]=0,t[14]=f,t[15]=0,t}const km=`#if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform AmbientLight lighting_uAmbientLight;
uniform PointLight lighting_uPointLight[MAX_LIGHTS];
uniform DirectionalLight lighting_uDirectionalLight[MAX_LIGHTS];
uniform int lighting_uPointLightCount;
uniform int lighting_uDirectionalLightCount;
uniform bool lighting_uEnabled;
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
#endif
`,_2={lightSources:{}};function ih(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/255)}function m2({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};return t?r["lighting_uAmbientLight.color"]=ih(t):r["lighting_uAmbientLight.color"]=[0,0,0],e.forEach((i,s)=>{r[`lighting_uPointLight[${s}].color`]=ih(i),r[`lighting_uPointLight[${s}].position`]=i.position,r[`lighting_uPointLight[${s}].attenuation`]=i.attenuation||[1,0,0]}),r.lighting_uPointLightCount=e.length,n.forEach((i,s)=>{r[`lighting_uDirectionalLight[${s}].color`]=ih(i),r[`lighting_uDirectionalLight[${s}].direction`]=i.direction}),r.lighting_uDirectionalLightCount=n.length,r}function Ow(t=_2){var e,n;if("lightSources"in t){const{ambientLight:r,pointLights:i,directionalLights:s}=t.lightSources||{};return r||i&&i.length>0||s&&s.length>0?Object.assign({},m2({ambientLight:r,pointLights:i,directionalLights:s}),{lighting_uEnabled:!0}):{lighting_uEnabled:!1}}if("lights"in t){const r={pointLights:[],directionalLights:[]};for(const i of t.lights||[])switch(i.type){case"ambient":r.ambientLight=i;break;case"directional":(e=r.directionalLights)==null||e.push(i);break;case"point":(n=r.pointLights)==null||n.push(i);break}return Ow({lightSources:r})}return{}}const y2={name:"lights",vs:km,fs:km,getUniforms:Ow,defines:{MAX_LIGHTS:3}},v2=`uniform float lighting_uAmbient;
uniform float lighting_uDiffuse;
uniform float lighting_uShininess;
uniform vec3  lighting_uSpecularColor;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, lighting_uShininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * lighting_uDiffuse * surfaceColor + specular * lighting_uSpecularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = lighting_uAmbient * surfaceColor * lighting_uAmbientLight.color;
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
vec3 lighting_getSpecularLightColor(vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = vec3(0, 0, 0);
vec3 surfaceColor = vec3(0, 0, 0);
if (lighting_uEnabled) {
vec3 view_direction = normalize(cameraPosition - position_worldspace);
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uPointLightCount) {
break;
}
PointLight pointLight = lighting_uPointLight[i];
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
}
for (int i = 0; i < MAX_LIGHTS; i++) {
if (i >= lighting_uDirectionalLightCount) {
break;
}
DirectionalLight directionalLight = lighting_uDirectionalLight[i];
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
}
return lightColor;
}
`,T2={};function w2(t){const{ambient:e=.35,diffuse:n=.6,shininess:r=32,specularColor:i=[30,30,30]}=t;return{lighting_uAmbient:e,lighting_uDiffuse:n,lighting_uShininess:r,lighting_uSpecularColor:i.map(s=>s/255)}}function E2(t=T2){if(!("material"in t))return{};const{material:e}=t;return e?w2(e):{lighting_uEnabled:!1}}const S2={name:"gouraud-lighting",dependencies:[y2],vs:v2,defines:{LIGHTING_VERTEX:1},getUniforms:E2},Nw="#define SMOOTH_EDGE_RADIUS 0.5",A2=`
${Nw}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,R2=`
${Nw}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,b2={name:"geometry",vs:A2,fs:R2},ee={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(ee,"IDENTITY",{get:()=>(ne.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Zt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},kr={common:0,meters:1,pixels:2},jf={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},C2=Object.keys(ee).map(t=>`const int COORDINATE_SYSTEM_${t} = ${ee[t]};`).join(""),P2=Object.keys(Zt).map(t=>`const int PROJECTION_MODE_${t} = ${Zt[t]};`).join(""),x2=Object.keys(kr).map(t=>`const int UNIT_${t.toUpperCase()} = ${kr[t]};`).join(""),M2=`${C2}
${P2}
${x2}
uniform int project_uCoordinateSystem;
uniform int project_uProjectionMode;
uniform float project_uScale;
uniform bool project_uWrapLongitude;
uniform vec3 project_uCommonUnitsPerMeter;
uniform vec3 project_uCommonUnitsPerWorldUnit;
uniform vec3 project_uCommonUnitsPerWorldUnit2;
uniform vec4 project_uCenter;
uniform mat4 project_uModelMatrix;
uniform mat4 project_uViewProjectionMatrix;
uniform vec2 project_uViewportSize;
uniform float project_uDevicePixelRatio;
uniform float project_uFocalDistance;
uniform vec3 project_uCameraPosition;
uniform vec3 project_uCoordinateOrigin;
uniform vec3 project_uCommonOrigin;
uniform bool project_uPseudoMeters;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project_uPseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project_uCommonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project_uCommonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project_uCommonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project_uCommonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project_uCommonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project_uModelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project_uCommonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project_uCommonUnitsPerWorldUnit + project_uCommonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project_uWrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project_uModelMatrix * position;
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project_uCoordinateOrigin;
}
}
if (project_uProjectionMode == PROJECTION_MODE_GLOBE) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project_uCoordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project_uCommonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project_uProjectionMode == PROJECTION_MODE_IDENTITY ||
(project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project_uCoordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project_uModelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project_uViewProjectionMatrix, project_uCenter);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project_uViewportSize * project_uDevicePixelRatio * 2.0;
return offset * project_uFocalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project_uScale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project_uScale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project_uScale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project_uScale;
}
`;function I2(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function Lo(t){let e={},n;return r=>{for(const i in r)if(!I2(r[i],e[i])){n=t(r),e=r;break}return n}}const Fm=[0,0,0,0],O2=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],kw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],N2=[0,0,0],Fw=[0,0,0],k2=Lo(B2);function Dw(t,e,n=Fw){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===ee.LNGLAT_OFFSETS||e===ee.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Zt.WEB_MERCATOR:(e===ee.LNGLAT||e===ee.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Zt.WEB_MERCATOR_AUTO_OFFSET:e===ee.LNGLAT?r=i:e===ee.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Zt.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Zt.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function F2(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Fm,l=Fm,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:f}=Dw(t,e,n);return f&&(l=t.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=Uo([],l,o),s=r||s,o=Cr([],i,s),o=Cr([],o,O2)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}function D2({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=ee.DEFAULT,coordinateOrigin:i=Fw,autoWrapLongitude:s=!1}){r===ee.DEFAULT&&(r=t.isGeospatial?ee.LNGLAT:ee.CARTESIAN);const o=k2({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.project_uWrapLongitude=s,o.project_uModelMatrix=n||kw,o}function B2({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=F2(t,n,r),u=t.getDistanceScales(),h=[t.width*e,t.height*e],f=Uo([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,d={project_uCoordinateSystem:n,project_uProjectionMode:t.projectionMode,project_uCoordinateOrigin:l,project_uCommonOrigin:o.slice(0,3),project_uCenter:i,project_uPseudoMeters:!!t._pseudoMeters,project_uViewportSize:h,project_uDevicePixelRatio:e,project_uFocalDistance:f,project_uCommonUnitsPerMeter:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit:u.unitsPerMeter,project_uCommonUnitsPerWorldUnit2:N2,project_uScale:t.scale,project_uWrapLongitude:!1,project_uViewProjectionMatrix:s,project_uModelMatrix:kw,project_uCameraPosition:a};if(c){const _=t.getDistanceScales(c);switch(n){case ee.METER_OFFSETS:d.project_uCommonUnitsPerWorldUnit=_.unitsPerMeter,d.project_uCommonUnitsPerWorldUnit2=_.unitsPerMeter2;break;case ee.LNGLAT:case ee.LNGLAT_OFFSETS:t._pseudoMeters||(d.project_uCommonUnitsPerMeter=_.unitsPerMeter),d.project_uCommonUnitsPerWorldUnit=_.unitsPerDegree,d.project_uCommonUnitsPerWorldUnit2=_.unitsPerDegree2;break;case ee.CARTESIAN:d.project_uCommonUnitsPerWorldUnit=[1,1,_.unitsPerMeter[2]],d.project_uCommonUnitsPerWorldUnit2=[0,0,_.unitsPerMeter2[2]];break}}return d}const U2={};function L2(t=U2){return"viewport"in t?D2(t):{}}const Jc={name:"project",dependencies:[_x,b2],vs:M2,getUniforms:L2},z2=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,zo={name:"project32",dependencies:[Jc],vs:z2};function V2(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Mi(t,e){const n=Uo([],e,t);return c2(n,n,1/n[3]),n}function Dm(t,e){const n=t%e;return n<0?e+n:n}function j2(t,e,n){return n*e+(1-n)*t}function Wf(t,e,n){return t<e?e:t>n?n:t}function W2(t){return Math.log(t)*Math.LOG2E}const Dp=Math.log2||W2;function wn(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const It=Math.PI,Bw=It/4,Et=It/180,Hf=180/It,Yi=512,Bl=4003e4,Ra=85.051129,H2=1.5;function Bm(t){return Math.pow(2,t)}function Uw(t){return Dp(t)}function Ki(t){const[e,n]=t;wn(Number.isFinite(e)),wn(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*Et,i=n*Et,s=Yi*(r+It)/(2*It),o=Yi*(It+Math.log(Math.tan(Bw+i*.5)))/(2*It);return[s,o]}function En(t){const[e,n]=t,r=e/Yi*(2*It)-It,i=2*(Math.atan(Math.exp(n/Yi*(2*It)-It))-Bw);return[r*Hf,i*Hf]}function $2(t){const{latitude:e}=t;wn(Number.isFinite(e));const n=Math.cos(e*Et);return Uw(Bl*n)-9}function sh(t){const e=Math.cos(t*Et);return Yi/Bl/e}function $f(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;wn(Number.isFinite(e)&&Number.isFinite(n));const i=Yi,s=Math.cos(e*Et),o=i/360,a=o/s,l=i/Bl/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=Et*Math.tan(e*Et)/s,h=o*u/2,f=i/Bl*u,d=f/a*l;c.unitsPerDegree2=[0,h,f],c.unitsPerMeter2=[d,0,d]}return c}function Lw(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=$f({longitude:n,latitude:r,highPrecision:!0}),u=Ki(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const h=En(u),f=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[h[0],h[1],f]:h}function X2(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=V2();Dl(a,a,[0,0,-i]),Mw(a,a,-n*Et),Iw(a,a,r*Et);const l=s/e;return Fp(a,a,[l,l,l]),o&&Dl(a,a,Lx([],o)),a}function Y2(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=Ul(H2)}=t;r!==void 0&&(u=Ul(r));const h=u*Et,f=i*Et,d=zw(u);let _=d;o&&(_+=o[2]*a/Math.cos(f)/n);const v=h*(.5+(s?s[1]:0)/n),A=Math.sin(v)*_/Math.sin(Wf(Math.PI/2-f-v,.01,Math.PI-.01)),p=Math.sin(f)*A+_,g=_*10,m=Math.min(p*c,g);return{fov:h,aspect:e/n,focalDistance:d,near:l,far:m}}function Ul(t){return 2*Math.atan(.5/t)*Hf}function zw(t){return .5/Math.tan(.5*t*Et)}function Vw(t,e){const[n,r,i=0]=t;return wn(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),Mi(e,[n,r,i,1])}function Bp(t,e,n=0){const[r,i,s]=t;if(wn(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return Mi(e,[r,i,s,1]);const o=Mi(e,[r,i,0,1]),a=Mi(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return Cw([],o,a,u)}function K2(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,h=q2(t.padding),f=Ki([a,Wf(u,-Ra,Ra)]),d=Ki([c,Wf(l,-Ra,Ra)]),_=[Math.max(Math.abs(d[0]-f[0]),i),Math.max(Math.abs(d[1]-f[1]),i)],v=[e-h.left-h.right-Math.abs(o[0])*2,n-h.top-h.bottom-Math.abs(o[1])*2];wn(v[0]>0&&v[1]>0);const A=v[0]/_[0],p=v[1]/_[1],g=(h.right-h.left)/2/A,m=(h.top-h.bottom)/2/p,E=[(d[0]+f[0])/2+g,(d[1]+f[1])/2+m],b=En(E),x=Math.min(s,Dp(Math.abs(Math.min(A,p))));return wn(Number.isFinite(x)),{longitude:b[0],latitude:b[1],zoom:x}}function q2(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(wn(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Um=Math.PI/180;function Z2(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*Um:Math.atan(.5/t.altitude),h=(90-t.pitch)*Um;return u>h-.01?(l=Lm(t,0,e),c=Lm(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function Lm(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=Mi(r,[e,0,1,1]),s=Mi(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=Cw([],i,s,a),c=En(l);return c.push(n),c}const zm=512;function Q2(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=Dm(i+180,360)-180),(a<-180||a>180)&&(a=Dm(a+180,360)-180);const l=Dp(n/zm);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=En([0,c])[1];if(s<u)s=u;else{const h=En([0,zm-c])[1];s>h&&(s=h)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const jw=.01,J2=["longitude","latitude","zoom"],Ww={curve:1.414,speed:1.2};function G2(t,e,n,r){const{startZoom:i,startCenterXY:s,uDelta:o,w0:a,u1:l,S:c,rho:u,rho2:h,r0:f}=Hw(t,e,r);if(l<jw){const E={};for(const b of J2){const x=t[b],O=e[b];E[b]=j2(x,O,n)}return E}const d=n*c,_=Math.cosh(f)/Math.cosh(f+u*d),v=a*((Math.cosh(f)*Math.tanh(f+u*d)-Math.sinh(f))/h)/l,A=1/_,p=i+Uw(A),g=Mx([],o,v);Lf(g,g,s);const m=En(g);return{longitude:m[0],latitude:m[1],zoom:p}}function eM(t,e,n){const r={...Ww,...n},{screenSpeed:i,speed:s,maxDuration:o}=r,{S:a,rho:l}=Hw(t,e,r),c=1e3*a;let u;return Number.isFinite(i)?u=c/(i/l):u=c/s,Number.isFinite(o)&&u>o?0:u}function Hw(t,e,n){n=Object.assign({},Ww,n);const r=n.curve,i=t.zoom,s=[t.longitude,t.latitude],o=Bm(i),a=e.zoom,l=[e.longitude,e.latitude],c=Bm(a-i),u=Ki(s),h=Ki(l),f=kx([],h,u),d=Math.max(t.width,t.height),_=d/c,v=Ix(f)*o,A=Math.max(v,jw),p=r*r,g=(_*_-d*d+p*p*A*A)/(2*d*p*A),m=(_*_-d*d-p*p*A*A)/(2*_*p*A),E=Math.log(Math.sqrt(g*g+1)-g),b=Math.log(Math.sqrt(m*m+1)-m),x=(b-E)/r;return{startZoom:i,startCenterXY:u,uDelta:f,w0:d,u1:v,S:x,rho:r,rho2:p,r0:E,r1:b}}const tM=`
const int max_lights = 2;
uniform mat4 shadow_uViewProjectionMatrices[max_lights];
uniform vec4 shadow_uProjectCenters[max_lights];
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform int shadow_uLightId;
uniform float shadow_uLightCount;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  if (shadow_uDrawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[shadow_uLightId], shadow_uProjectCenters[shadow_uLightId]);
  }
  if (shadow_uUseShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow_uLightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, shadow_uViewProjectionMatrices[i], shadow_uProjectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,nM=`
const int max_lights = 2;
uniform bool shadow_uDrawShadowMap;
uniform bool shadow_uUseShadowMap;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;
uniform vec4 shadow_uColor;
uniform float shadow_uLightCount;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow_uDrawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow_uUseShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow_uLightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow_uColor.a / shadow_uLightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow_uColor.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,rM=Lo(lM),iM=Lo(cM),sM=[0,0,0,1],oM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function aM(t,e){const[n,r,i]=t,s=Bp([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function lM({viewport:t,center:e}){return new tn(t.viewProjectionMatrix).invert().transform(e)}function cM({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>aM(o,r));for(const o of e){const a=o.clone().translate(new en(t.center).negate()),l=s.map(u=>a.transform(u)),c=new tn().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function uM(t,e){const{shadowEnabled:n=!0}=t;if(!n||!t.shadowMatrices||!t.shadowMatrices.length)return{shadow_uDrawShadowMap:!1,shadow_uUseShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const r={shadow_uDrawShadowMap:!!t.drawToShadowMap,shadow_uUseShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,shadow_uColor:t.shadowColor||sM,shadow_uLightId:t.shadowLightId||0,shadow_uLightCount:t.shadowMatrices.length},i=rM({viewport:t.viewport,center:e.project_uCenter}),s=[],o=iM({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=o[a],c=l.clone().translate(new en(t.viewport.center).negate());e.project_uCoordinateSystem===ee.LNGLAT&&e.project_uProjectionMode===Zt.WEB_MERCATOR?(o[a]=c,s[a]=i):(o[a]=l.clone().multiplyRight(oM),s[a]=c.transform(i))}for(let a=0;a<o.length;a++)r[`shadow_uViewProjectionMatrices[${a}]`]=o[a],r[`shadow_uProjectCenters[${a}]`]=s[a];for(let a=0;a<2;a++)r[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return r}const Vm={name:"shadow",dependencies:[Jc],vs:tM,fs:nM,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?uM(t,e):{}},Vo={...Im,defaultUniforms:{...Im.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},hM=[Jc],fM=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function dM(){const t=xl.getDefaultShaderAssembler();for(const e of hM)t.addDefaultModule(e);for(const e of fM)t.addShaderHook(e);return t}const pM=[255,255,255],gM=1;let _M=0;class $w{constructor(e={}){this.type="ambient";const{color:n=pM}=e,{intensity:r=gM}=e;this.id=e.id||`ambient-${_M++}`,this.color=n,this.intensity=r}}const mM=[255,255,255],yM=1,vM=[0,0,-1];let TM=0;class Xf{constructor(e={}){this.type="directional";const{color:n=mM}=e,{intensity:r=yM}=e,{direction:i=vM}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${TM++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new en(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class wM{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class Gc extends wM{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=e.colorMask??15,l={viewport:[0,0,n,r]};e.colorMask&&(l.colorMask=a),e.scissorRect&&(l.scissorRect=e.scissorRect);const c=this.device.beginRenderPass({framebuffer:e.target,parameters:l,clearColor:s,clearDepth:o});try{return this._drawLayers(c,e)}finally{c.end()}}_drawLayers(e,n){const{target:r,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const h=o&&o[u.id];a==null||a(u);const f=this._getDrawLayerParams(u,n),d=u.subViewports||[u];for(const _ of d){const v=this._drawLayersInViewport(e,{target:r,moduleParameters:i,viewport:_,view:h,pass:n.pass,layers:n.layers},f);c.push(v)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){var _;const u=[],h=Xw(this._lastRenderIndex+1),f={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},d={};for(let v=0;v<n.length;v++){const A=n[v],p=this._shouldDrawLayer(A,f,s,d),g={shouldDrawLayer:p};p&&!c&&(g.layerRenderIndex=h(A,p),g.moduleParameters=this._getModuleParameters(A,a,r,l),g.layerParameters={...(_=A.context.deck)==null?void 0:_.props.parameters,...this.getLayerParameters(A,v,e)}),u[v]=g}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const c=EM(this.device,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const h=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(h))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let h=0;h<n.length;h++){const f=n[h],{shouldDrawLayer:d,layerRenderIndex:_,moduleParameters:v,layerParameters:A}=l[h];if(d&&f.props.pickable&&u.pickableCount++,f.isComposite)u.compositeCount++;else if(d){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,_),v.viewport=o,f.context.renderPass=e;try{f._drawLayer({renderPass:e,moduleParameters:v,uniforms:{layerIndex:_},parameters:A})}catch(p){f.raiseError(p,`drawing ${f} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const c of n)Object.assign(o,(l=c.getModuleParameters)==null?void 0:l.call(c,e));return Object.assign(o,this.getModuleParameters(e,n),i)}}function Xw(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||Xw(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function EM(t,{moduleParameters:e,target:n,viewport:r}){const i=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}class SM extends Gc{constructor(e,n){super(e,n),this.shadowMap=e.createTexture({width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),this.depthBuffer=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1,dataFormat:6402,type:5125}),this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[this.shadowMap],depthStencilAttachment:this.depthBuffer})}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null),this.shadowMap&&(this.shadowMap.destroy(),this.shadowMap=null),this.depthBuffer&&(this.depthBuffer.destroy(),this.depthBuffer=null)}}const AM={color:[255,255,255],intensity:1},jm=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],RM=[0,0,0,200/255];class Up{constructor(e={}){this.id="lighting-effect",this.shadowColor=RM,this.shadow=!1,this.ambientLight=null,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.shadowMaps=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(Vm),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=null,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowMaps,dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.shadowMaps.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(Vm))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new tn().lookAt({eye:new en(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new SM(e);this.shadowPasses[n]=r,this.shadowMaps[n]=r.shadowMap}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new $w(AM),this.directionalLights.push(new Xf(jm[0]),new Xf(jm[1])))}}class bM{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let h=1/0;l&&(h=l*r+s);const f=this._allocate(c,u,a,h);return e&&o?f.set(e):a||f.fill(0,0,4),this._release(e),f}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const qi=new bM;function Ms(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function CM(t){return[t[12],t[13],t[14]]}function PM(t){return{left:ei(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:ei(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:ei(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:ei(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:ei(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:ei(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Wm=new en;function ei(t,e,n,r){Wm.set(t,e,n);const i=Wm.len();return{distance:r/i,normal:new en(-t/i,-e/i,-n/i)}}function xM(t){return t-Math.fround(t)}let ys;function oh(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;ys=qi.allocate(ys,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];ys[a+l]=c,ys[a+l+n]=xM(c)}a+=n*2}return ys.subarray(0,s*n*2)}function MM(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const IM=Math.PI/180,OM=Ms(),Hm=[0,0,0],NM={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function kM({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new tn().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new tn().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:h=0,top:f=0,bottom:d=0}=s,_=Ln((u+t-h)/2,0,t)-t/2,v=Ln((f+e-d)/2,0,e)-e/2;c[8]-=_*2/t,c[9]+=v*2/e}return c}const hc=class hc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||NM,this.focalDistance=e.focalDistance||1,this.position=e.position||Hm,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Zt.WEB_MERCATOR:Zt.WEB_MERCATOR_AUTO_OFFSET:Zt.IDENTITY}equals(e){return e instanceof hc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&$i(e.projectionMatrix,this.projectionMatrix)&&$i(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=Vw(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=Bp([i,a,o],this.pixelUnprojectionMatrix,l),[u,h,f]=this.unprojectPosition(c);return Number.isFinite(o)?[u,h,f]:Number.isFinite(r)?[u,h,r]:[u,h]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Ki(e);return n[1]=Ln(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?En(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e?$f({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,PM(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=$2({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||$f({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=Hm;if(s&&(a=o?new tn(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new en(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=OM,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new tn().multiplyRight(n).translate(new en(this.center).negate()),this.projectionMatrix=r||kM({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*IM,focalDistance:u,padding:c,near:a,far:l});const h=Ms();Cr(h,h,this.projectionMatrix),Cr(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=zf([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=CM(this.viewMatrixInverse);const f=Ms(),d=Ms();Fp(f,f,[this.width/2,-this.height/2,1]),Dl(f,f,[1,-1,0]),Cr(d,f,this.viewProjectionMatrix),this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=zf(Ms(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ne.warn("Pixel project matrix not invertible")()}};hc.displayName="Viewport";let Ll=hc;const Zs=class Zs extends Ll{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:h=!1,projectionMatrix:f,repeat:d=!1,worldOffset:_=0,position:v,padding:A,legacyMeterSizes:p=!1}=e;let{width:g,height:m,altitude:E=1.5}=e;const b=Math.pow(2,i);g=g||1,m=m||1;let x,O=null;if(f)E=f[5]/2,x=Ul(E);else{e.fovy?(x=e.fovy,E=zw(x)):x=Ul(E);let N;if(A){const{top:k=0,bottom:z=0}=A;N=[0,Ln((k+m-z)/2,0,m)-m/2]}O=Y2({width:g,height:m,scale:b,center:v&&[0,0,v[2]*sh(n)],offset:N,pitch:s,fovy:x,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(O.near=c),Number.isFinite(u)&&(O.far=u)}let M=X2({height:m,pitch:s,bearing:o,scale:b,altitude:E});_&&(M=new tn().translate([512*_,0,0]).multiplyLeft(M)),super({...e,width:g,height:m,viewMatrix:M,longitude:r,latitude:n,zoom:i,...O,fovy:x,focalDistance:E}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=E,this.fovy=x,this.orthographic=h,this._subViewports=d?[]:null,this._pseudoMeters=p,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Zs({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*sh(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/sh(r);return[n,r,i]}addMetersToLngLat(e,n){return Lw(e,n)}panByPosition(e,n){const r=Bp(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=Lf([],i,Ox([],r)),o=Lf([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=Z2(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=K2({width:r,height:i,bounds:e,...n});return new Zs({width:r,height:i,longitude:s,latitude:o,zoom:a})}};Zs.displayName="WebMercatorViewport";let zl=Zs;const $m=[0,0,0];function ah(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof zl){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function FM(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===ee.DEFAULT&&(i=e.isGeospatial?ee.LNGLAT:ee.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function Yw(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=Uo([],[o,a,l,1],n)),r){case ee.LNGLAT:return ah([o,a,l],e,s);case ee.LNGLAT_OFFSETS:return ah([o+i[0],a+i[1],l+(i[2]||0)],e,s);case ee.METER_OFFSETS:return ah(Lw(i,[o,a,l]),e,s);case ee.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function DM(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=FM(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=$m,shaderCoordinateOrigin:u=$m,offsetMode:h=!1}=l?Dw(n,r,i):{},f=Yw(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:h});if(h){const d=n.projectPosition(c||u);Kx(f,f,d)}return f}const Fr=Math.PI/180,BM=1e3*60*60*24,UM=2440588,LM=2451545,Vl=Fr*23.4397,zM=357.5291,VM=.98560028,jM=280.147,WM=360.9856235;function HM(t,e,n){const r=Fr*-n,i=Fr*e,s=XM(t),o=eI(s),a=QM(s,r)-o.rightAscension;return{azimuth:qM(a,i,o.declination),altitude:ZM(a,i,o.declination)}}function Xm(t,e,n){const{azimuth:r,altitude:i}=HM(t,e,n);return[Math.sin(r)*Math.cos(i),Math.cos(r)*Math.cos(i),-Math.sin(i)]}function $M(t){return(typeof t=="number"?t:t.getTime())/BM-.5+UM}function XM(t){return $M(t)-LM}function YM(t,e){const n=t;return Math.atan2(Math.sin(n)*Math.cos(Vl)-Math.tan(e)*Math.sin(Vl),Math.cos(n))}function KM(t,e){const n=t;return Math.asin(Math.sin(e)*Math.cos(Vl)+Math.cos(e)*Math.sin(Vl)*Math.sin(n))}function qM(t,e,n){const r=t,i=e,s=n;return Math.atan2(Math.sin(r),Math.cos(r)*Math.sin(i)-Math.tan(s)*Math.cos(i))}function ZM(t,e,n){const r=t,i=e,s=n;return Math.asin(Math.sin(i)*Math.sin(s)+Math.cos(i)*Math.cos(s)*Math.cos(r))}function QM(t,e){return Fr*(jM+WM*t)-e}function JM(t){return Fr*(zM+VM*t)}function GM(t){const e=t,n=Fr*(1.9148*Math.sin(e)+.02*Math.sin(2*e)+3e-4*Math.sin(3*e)),r=Fr*102.9372;return e+n+r+Math.PI}function eI(t){const e=JM(t),n=GM(e);return{declination:KM(n,0),rightAscension:YM(n,0)}}class tI extends Xf{constructor(e){super(e),this.timestamp=e.timestamp}getProjectedLight({layer:e}){const{viewport:n}=e.context;if(n.resolution&&n.resolution>0){const[i,s,o]=Xm(this.timestamp,0,0);this.direction=[i,-o,s]}else{const{latitude:i,longitude:s}=n;this.direction=Xm(this.timestamp,i,s)}return this}}let nI=1,rI=1;class Kw{constructor(){T(this,"time",0);T(this,"channels",new Map);T(this,"animations",new Map);T(this,"playing",!1);T(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=nI++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=rI++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}let iI=0;const sI={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:br.stats.get(`animation-loop-${iI++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class oI{constructor(e){T(this,"device",null);T(this,"canvas",null);T(this,"props");T(this,"animationProps",null);T(this,"timeline",null);T(this,"stats");T(this,"cpuTime");T(this,"gpuTime");T(this,"frameRate");T(this,"display");T(this,"needsRedraw","initialized");T(this,"_initialized",!1);T(this,"_running",!1);T(this,"_animationFrameId",null);T(this,"_nextFramePromise",null);T(this,"_resolveNextFrame",null);T(this,"_cpuStartTime",0);if(this.props={...sI,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Kc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=IP(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(OP(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var e,n;if(!this.device)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:(n=(e=this.device)==null?void 0:e.canvasContext)==null?void 0:n.canvas,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}class Ym{constructor(e){T(this,"id");T(this,"userData",{});T(this,"topology");T(this,"bufferLayout",[]);T(this,"vertexCount");T(this,"indices");T(this,"attributes");this.id=e.id||$r("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&le(this.indices.usage===de.INDEX)}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices}_calculateVertexCount(e){return e.byteLength/12}}function aI(t,e){if(e instanceof Ym)return e;const n=lI(t,e),{attributes:r,bufferLayout:i}=cI(t,e);return new Ym({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function lI(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:de.INDEX,data:n})}function cI(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:bP(l,c,u)})}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}class uI{constructor(e){T(this,"modules");T(this,"moduleUniforms");T(this,"moduleBindings");T(this,"moduleUniformsChanged");const n=Zc(Object.values(e));U.log(1,"Creating ShaderInputs with modules",n.map(r=>r.name))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e)){const s=r;this.moduleUniforms[s]=i.defaultUniforms||{},this.moduleBindings[s]={}}}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i],o=this.modules[i];if(!o){U.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=((n=o.getUniforms)==null?void 0:n.call(o,s,this.moduleUniforms[i]))||s;this.moduleUniforms[i]={...a,...l}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindings(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}}const fc=class fc{constructor(e){T(this,"device");T(this,"_hashCounter",0);T(this,"_hashes",{});T(this,"_renderPipelineCache",{});T(this,"_computePipelineCache",{});this.device=e}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new fc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...ji.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...Fl.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof Fl?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=this._getHash(e.vs.source),r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};T(fc,"defaultProps",{...ji.defaultProps});let Yf=fc;const dc=class dc{constructor(e){T(this,"device");T(this,"_cache",{});this.device=e}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new dc(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};T(dc,"defaultProps",{...Ol.defaultProps});let Kf=dc;function hI(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s.accessor)}}return n}let xe=null,lh=null;function fI(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){xe||(xe=document.createElement("canvas"),xe.id=e,xe.title=e,xe.style.zIndex="100",xe.style.position="absolute",xe.style.top=i,xe.style.left=s,xe.style.border="blue 1px solid",xe.style.transform="scaleY(-1)",document.body.appendChild(xe),lh=xe.getContext("2d")),(xe.width!==t.width||xe.height!==t.height)&&(xe.width=t.width/2,xe.height=t.height/2,xe.style.width="400px",xe.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=lh.createImageData(t.width,t.height),c=0;for(let u=0;u<a.length;u+=4)l.data[c+u+0]=a[u+0]*o,l.data[c+u+1]=a[u+1]*o,l.data[c+u+2]=a[u+2]*o,l.data[c+u+3]=r?255:a[u+3]*o;lh.putImageData(l,0,0)}const ti=2,dI=1e4,pc=class pc{constructor(e,n){T(this,"device");T(this,"id");T(this,"source");T(this,"vs");T(this,"fs");T(this,"pipelineFactory");T(this,"shaderFactory");T(this,"userData",{});T(this,"parameters");T(this,"topology");T(this,"bufferLayout");T(this,"vertexCount");T(this,"instanceCount",0);T(this,"indexBuffer",null);T(this,"bufferAttributes",{});T(this,"constantAttributes",{});T(this,"bindings",{});T(this,"uniforms",{});T(this,"vertexArray");T(this,"transformFeedback",null);T(this,"pipeline");T(this,"shaderInputs");T(this,"_uniformStore");T(this,"_attributeInfos",{});T(this,"_gpuGeometry",null);T(this,"_getModuleUniforms");T(this,"props");T(this,"_pipelineNeedsUpdate","newly created");T(this,"_needsRedraw","initializing");T(this,"_destroyed",!1);T(this,"_lastDrawTimestamp",-1);T(this,"_lastLogTime",0);T(this,"_logOpen",!1);T(this,"_drawCount",0);var a,l,c,u;this.props={...pc.defaultProps,...n},n=this.props,this.id=n.id||$r("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(h=>[h.name,h]))||[]);this.setShaderInputs(n.shaderInputs||new uI(r));const i=pI(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(c=this.shaderInputs)==null?void 0:c.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=dx(this.props.source));const{source:h,getUniforms:f}=this.props.shaderAssembler.assembleShader({platformInfo:i,...this.props,modules:s});this.source=h,this._getModuleUniforms=f}else{const{vs:h,fs:f,getUniforms:d}=this.props.shaderAssembler.assembleShaderPair({platformInfo:i,...this.props,modules:s});this.vs=h,this.fs=f,this._getModuleUniforms=d}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Yf.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||Kf.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),n.vertexCount&&this.setVertexCount(n.vertexCount),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline(),this.pipeline.setBindings(this.bindings,{disableWarnings:this.props.disableWarnings}),Ml(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:r}=this.vertexArray,i=r?r.byteLength/(r.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:i,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&aI(this.device,e);n&&(this.setTopology(n.topology||"triangle-list"),this.bufferLayout=Km(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)),this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){this.bufferLayout=this._gpuGeometry?Km(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Uf(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setInstanceCount(e){this.instanceCount=e,this.setNeedsRedraw("instanceCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new RP(this.shaderInputs.modules);for(const n of Object.keys(this.shaderInputs.modules)){const r=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=r}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){e.indices&&U.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();for(const[r,i]of Object.entries(e)){const s=this.bufferLayout.find(l=>qm(l).includes(r));if(!s){U.warn(`Model(${this.id}): Missing layout for buffer "${r}".`)();continue}const o=qm(s);let a=!1;for(const l of o){const c=this._attributeInfos[l];c&&(this.vertexArray.setBuffer(c.location,i),a=!0)}!a&&!((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)&&U.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${r}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||U.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Ml(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){U.warn("Model.updateModuleSettings is deprecated. Use Model.shaderInputs.setProps()")();const{bindings:n,uniforms:r}=mw(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Il?e=Math.max(e,n.texture.updateTimestamp):n instanceof de||n instanceof Tt?e=Math.max(e,n.updateTimestamp):n instanceof Nl||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(U.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debug:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debug:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,vs:r,fs:i}),this._attributeInfos=dw(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=U.level>3?0:dI;U.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,U.group(ti,`>>> DRAWING MODEL ${this.id}`,{collapsed:U.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=hI(this.pipeline.shaderLayout,this.id);U.table(ti,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};U.table(ti,n)();const r=this._getAttributeDebugTable();U.table(ti,this._attributeInfos)(),U.table(ti,r)(),U.groupEnd(ti)(),this._logOpen=!1}}_logFramebuffer(e){const n=U.get("framebuffer");if(this._drawCount++,!n||this._drawCount++>3&&this._drawCount%60)return;const r=e.props.framebuffer;r&&fI(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos))e[r.location]={name:n,type:r.shaderType,values:this._getBufferOrConstantValues(this.vertexArray.attributes[r.location],r.bufferDataType)};if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=_w(n);return(e instanceof de?new r(e.debugData):e).toString()}};T(pc,"defaultProps",{...ji.defaultProps,source:null,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:xl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Ft=pc;function Km(t,e){const n=[...t];for(const r of e){const i=n.findIndex(s=>s.name===r.name);i<0?n.push(r):n[i]=r}return n}function pI(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function qm(t){var e;return t.attributes?(e=t.attributes)==null?void 0:e.map(n=>n.attribute):[t.name]}class eu{constructor(e,n=Ft.defaultProps){T(this,"device");T(this,"model");T(this,"transformFeedback");le(eu.isSupported(e),"BufferTransform not yet implemented on WebGPU"),this.device=e,this.model=new Ft(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||C3(),topology:n.topology||"point-list",...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}update(...e){console.warn("TextureTransform#update() not implemented")}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(n instanceof de)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}}class Zi{constructor(e){T(this,"id");T(this,"topology");T(this,"vertexCount");T(this,"indices");T(this,"attributes");T(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||$r("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;le(ArrayBuffer.isView(a.value),`${this._print(s)}: must be typed array or object with value as typed array`),(s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"?(le(!this.indices),this.indices=a):this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o>=1&&(r=Math.min(r,s.length/o))}return le(Number.isFinite(r)),r}}const gI={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class qw extends Gc{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:h,effects:f,pass:d="picking",pickZ:_,moduleParameters:v}){this.pickZ=_;const A=this._resetColorEncoder(_),p=[a,l,c,u],g=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:h,effects:f==null?void 0:f.filter(E=>E.useInPicking),pass:d,isPicking:!0,moduleParameters:v,clearColor:[0,0,0,0],colorMask:15,scissorRect:p});return this._colorEncoderState=null,{decodePickingColor:A&&mI.bind(null,A),stats:g}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{}}}getLayerParameters(e,n,r){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters,...gI,blend:!this.pickZ},{pickable:s,operation:o}=e.props;return this._colorEncoderState?s&&o.includes("draw")&&(i.blend=!0,i.blendColor=_I(this._colorEncoderState,e,r)):i.blend=!1,o.includes("terrain")&&(i.blend=!1),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function _I(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(ne.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function mI(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const ri={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},jl=Symbol.for("component"),Qn=Symbol.for("propTypes"),ch=Symbol.for("deprecatedProps"),Ii=Symbol.for("asyncPropDefaults"),Dr=Symbol.for("asyncPropOriginal"),zn=Symbol.for("asyncPropResolved");function Lp(t,e=()=>!0){return Array.isArray(t)?Zw(t,e,[]):e(t)?[t]:[]}function Zw(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?Zw(i,e,n):e(i)&&n.push(i)}return n}function yI({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class vI{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Cl(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class TI{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new vI(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const wI="layerManager.setLayers",EI="layerManager.activateViewport";class SI{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{We(EI,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new TI({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:dM(),defaultShaderModules:[],renderPass:void 0,stats:i||new Kc({id:"deck.gl"}),viewport:s||new Ll({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Kw,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){We(wI,this,n,e),this._lastRenderedLayers=e;const r=Lp(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?ne.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&ne.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=ri.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=ri.MATCHED,n!==e&&(e.lifecycle=ri.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=ri.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=ri.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function ut(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!ut(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!ut(t[s],e[s],n-1))return!1;return!0}return!1}class AI{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Lp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!ut(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ne.warn("missing `viewState` or `initialViewState`")()}_onViewStateChange(e,n){this._eventCallbacks.onViewStateChange&&this._eventCallbacks.onViewStateChange({...n,viewId:e})}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._onViewStateChange.bind(this,n.id),onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const RI=/([0-9]+\.?[0-9]*)(%|px)/;function Cn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=RI.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function Pn(t,e){return t.relative?Math.round(t.position*e):t.position}class Qi{constructor(e={}){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Cn(r),this._y=Cn(i),this._width=Cn(s),this._height=Cn(o),this._padding=a&&{left:Cn(a.left||0),right:Cn(a.right||0),top:Cn(a.top||0),bottom:Cn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&ut(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:Pn(this._x,e),y:Pn(this._y,n),width:Pn(this._width,e),height:Pn(this._height,n)};return this._padding&&(r.padding={left:Pn(this._padding.left,e),top:Pn(this._padding.top,n),right:Pn(this._padding.right,e),bottom:Pn(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class tu{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Zm=()=>{},qf={BREAK:1,SNAP_TO_END:2,IGNORE:3},bI=t=>t,CI=qf.BREAK;class PI{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new tu(e.timeline),this.onViewStateChange=e.onViewStateChange||Zm,this.onStateChange=e.onStateChange||Zm}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===qf.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===qf.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||bI,interpolator:s,interruption:n.transitionInterruption||CI,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Fe(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class Qw{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!$i(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Fe(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const xI=["longitude","latitude","zoom","bearing","pitch"],MI=["longitude","latitude","zoom"];class zp extends Qw{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:xI,required:MI},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=To(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,To(e.around,n.around,r)))}return i}}const xn={transitionDuration:0},II=300,ba=t=>1-(1-t)*(1-t),ni={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ur={};class OI{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new PI({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?II:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(ni.WHEEL,u&&r),this.toggleEvents(ni.PAN,u),this.toggleEvents(ni.PINCH,u&&(a||l)),this.toggleEvents(ni.TRIPLE_PAN,u&&l),this.toggleEvents(ni.DOUBLE_TAP,u&&o),this.toggleEvents(ni.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,xn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,xn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ba},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,xn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ba},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,xn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,xn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:ba},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ur._startPinchRotation=e.rotation,ur._lastPinchEvent=e,this.updateViewport(r,xn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:ur._startPinchRotation-r})}return this.updateViewport(n,xn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ur._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=ur;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:ba},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ur._startPinchRotation=null,ur._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?xn:e?{...n,transitionInterpolator:new zp({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class NI{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Qm=5,kI=1.2;class FI extends NI{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:h=20,minZoom:f=0,maxPitch:d=60,minPitch:_=0,startPanLngLat:v,startZoomLngLat:A,startRotatePos:p,startBearing:g,startPitch:m,startZoom:E,normalize:b=!0}=e;Fe(Number.isFinite(s)),Fe(Number.isFinite(i)),Fe(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:h,minZoom:f,maxPitch:d,minPitch:_,normalize:b,position:u},{startPanLngLat:v,startZoomLngLat:A,startRotatePos:p,startBearing:g,startPitch:m,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=Ln(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=Ln(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=Ln(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,Q2(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),h=s/c;let f=0;o>0?Math.abs(u-l)>Qm&&(f=o/(l-u)*kI):o<0&&l>Qm&&(f=1-a/l),f=Ln(f,-1,1);const{minPitch:d,maxPitch:_}=this.getViewportProps(),v=i+180*h;let A=r;return f>0?A=r+f*(_-r):f<0&&(A=r-f*(d-r)),{pitch:A,bearing:v}}}class DI extends OI{constructor(){super(...arguments),this.ControllerState=FI,this.transition={transitionDuration:300,transitionInterpolator:new zp({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}const Kp=class Kp extends Qi{get ViewportType(){return zl}get ControllerType(){return DI}};Kp.displayName="MapView";let Zf=Kp;const BI=new Up;function UI(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class LI{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>UI(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(ut(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof Up)||this._resolvedEffects.push(BI),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class zI extends Gc{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const VI="deckRenderer.renderLayers";class jI{constructor(e){this.device=e,this.gl=e.gl,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new zI(e),this.pickLayersPass=new qw(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0]);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,We(VI,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const WI={pickedColor:null,pickedObjectIndex:-1};function HI({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,h=-1,f=0;for(let d=0;d<c;d++){const _=d+a-r,v=_*_;if(v>u)f+=4*l;else for(let A=0;A<l;A++){if(t[f+3]-1>=0){const g=A+o-n,m=g*g+v;m<=u&&(u=m,h=f)}f+=4}}if(h>=0){const d=t.slice(h,h+4),_=e(d);if(_){const v=Math.floor(h/4/l),A=h/4-v*l;return{..._,pickedColor:d,pickedX:o+A,pickedY:a+v}}ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}return WI}function $I({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function Jw({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=YI((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function XI(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const h=n.index,f=n.layerId,d=o?o.props.id:null;if(d!==f||a!==h){if(d!==f){const _=i.find(v=>v.props.id===f);_&&l.unshift(_)}n.layerId=d,n.index=a,n.info=null}}const c=Jw(t),u=new Map;return u.set(null,c),l.forEach(h=>{let f={...c};h===o&&(f.color=s,f.index=a,f.picked=!0),f=Gw({layer:h,info:f,mode:r});const d=f.layer;h===o&&r==="hover"&&(n.info=f),u.set(d.id,f),r==="hover"&&d.updateAutoHighlight(f)}),u}function Gw({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function YI(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class KI{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new qw(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.delete(),this.depthFBO&&(this.depthFBO.colorAttachments[0].delete(),this.depthFBO.delete())}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(f=>f.id===o):null,c=a&&i.find(f=>f.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"]}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:[this.device.createTexture({format:"rgba32float"})]});this.depthFBO=i}const e=this.device.gl;(n=this.pickingFBO)==null||n.resize({width:e.canvas.width,height:e.canvas.height}),(r=this.depthFBO)==null||r.resize({width:e.canvas.width,height:e.canvas.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:h}){const f=this.device.canvasContext.cssToDeviceRatio(),d=this._getPickable(e);if(!d||r.length===0)return{result:[],emptyInfo:Jw({viewports:r,x:i,y:s,pixelRatio:f})};this._resizeBuffer();const _=this.device.canvasContext.cssToDevicePixels([i,s],!0),v=[_.x+Math.floor(_.width/2),_.y+Math.floor(_.height/2)],A=Math.round(o*f),{width:p,height:g}=this.pickingFBO,m=this._getPickingRect({deviceX:v[0],deviceY:v[1],deviceRadius:A,deviceWidth:p,deviceHeight:g}),E={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let b;const x=[],O=new Set;for(let M=0;M<a;M++){let N;if(m){const z=this._drawAndSample({layers:d,views:n,viewports:r,onViewportActive:u,deviceRect:m,cullRect:E,effects:h,pass:`picking:${l}`});N=HI({...z,deviceX:v[0],deviceY:v[1],deviceRadius:A,deviceRect:m})}else N={pickedColor:null,pickedObjectIndex:-1};let k;if(N.pickedLayer&&c&&this.depthFBO){const{pickedColors:z}=this._drawAndSample({layers:[N.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:N.pickedX,y:N.pickedY,width:1,height:1},cullRect:E,effects:h,pass:`picking:${l}:z`},!0);z[3]&&(k=z[0])}N.pickedLayer&&M+1<a&&(O.add(N.pickedLayer),N.pickedLayer.disablePickingIndex(N.pickedObjectIndex)),b=XI({pickInfo:N,lastPickedInfo:this.lastPickedInfo,mode:l,layers:d,viewports:r,x:i,y:s,z:k,pixelRatio:f});for(const z of b.values())z.layer&&x.push(z);if(!N.pickedColor)break}for(const M of O)M.restorePickingColors();return{result:x,emptyInfo:b.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:h}){const f=this._getPickable(e);if(!f||r.length===0)return[];this._resizeBuffer();const d=this.device.canvasContext.cssToDeviceRatio(),_=this.device.canvasContext.cssToDevicePixels([i,s],!0),v=_.x,A=_.y+_.height,p=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),g=p.x+p.width,m=p.y,E={x:v,y:m,width:g-v,height:A-m},b=this._drawAndSample({layers:f,views:n,viewports:r,onViewportActive:u,deviceRect:E,cullRect:{x:i,y:s,width:o,height:a},effects:h,pass:`picking:${l}`}),x=$I(b),O=new Map,M=[],N=Number.isFinite(c);for(let k=0;k<x.length&&!(N&&M.length>=c);k++){const z=x[k];let L={color:z.pickedColor,layer:null,index:z.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:d};L=Gw({layer:z.pickedLayer,info:L,mode:l});const j=L.layer.id;O.has(j)||O.set(j,new Set);const X=O.get(j),Z=L.object??L.index;X.has(Z)||(X.add(Z),M.push(L))}return M}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,h={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const g of a)g.useInPicking&&(h.preRenderStats[g.id]=g.preRender(h));const{decodePickingColor:f}=this.pickLayersPass.render(h),{x:d,y:_,width:v,height:A}=s,p=new(c?Float32Array:Uint8Array)(v*A*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:d,sourceY:_,sourceWidth:v,sourceHeight:A,target:p}),{pickedColors:p,decodePickingColor:f}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const qI={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},ZI="top-left",Jm="__root";class QI{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!ut(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=ZI}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||Jm;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",Object.assign(s.style,qI[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===Jm||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const r=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const c=r[l];c&&(a.onViewportChange&&!c.equals(i[l])&&a.onViewportChange(c),(s=a.onRedraw)==null||s.call(a,{viewports:[c],layers:n}))}else{if(a.onViewportChange)for(const c of e)c.equals(i[c.id])||a.onViewportChange(c);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=jf[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r.handler])==null||s.call(o,e,n))}}}const JI={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class GI{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,JI),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var mi;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(mi||(mi={}));const Vp={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ae=(t,e,n)=>e?t.enable(n):t.disable(n),Gm=(t,e,n)=>t.hint(n,e),st=(t,e,n)=>t.pixelStorei(n,e),ey=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},vs=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function uh(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const eO={3042:Ae,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Ae,2885:(t,e)=>t.cullFace(e),2929:Ae,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Ae,35723:Gm,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:ey,36010:ey,34964:vs,36662:vs,36663:vs,35053:vs,35055:vs,2886:(t,e)=>t.frontFace(e),33170:Gm,2849:(t,e)=>t.lineWidth(e),32823:Ae,32824:"polygonOffset",10752:"polygonOffset",35977:Ae,32926:Ae,32928:Ae,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ae,3088:(t,e)=>t.scissor(...e),2960:Ae,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Ae,10754:Ae,12288:Ae,12289:Ae,12290:Ae,12291:Ae,12292:Ae,12293:Ae,12294:Ae,12295:Ae,3333:st,3317:st,37440:st,37441:st,37443:st,3330:st,3332:st,3331:st,3314:st,32878:st,3316:st,3315:st,32877:st,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(...e),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=uh(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=uh(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=uh(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function ye(t,e,n){return e[t]!==void 0?e[t]:n[t]}const tO={blendEquation:(t,e,n)=>t.blendEquationSeparate(ye(32777,e,n),ye(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ye(32969,e,n),ye(32968,e,n),ye(32971,e,n),ye(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ye(32824,e,n),ye(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ye(32938,e,n),ye(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ye(2962,e,n),ye(2967,e,n),ye(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ye(34816,e,n),ye(36003,e,n),ye(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ye(2964,e,n),ye(2965,e,n),ye(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ye(34817,e,n),ye(34818,e,n),ye(34819,e,n))},ty={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},jt=(t,e)=>t.isEnabled(e),ny={3042:jt,2884:jt,2929:jt,3024:jt,32823:jt,32926:jt,32928:jt,3089:jt,2960:jt,35977:jt},nO=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Br(t,e){if(iO(e))return;const n={};for(const i in e){const s=Number(i),o=eO[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=tO[i];s(t,e,r)}}function eE(t,e=Vp){if(typeof e=="number"){const i=e,s=ny[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=ny[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function rO(t){Br(t,Vp)}function iO(t){for(const e in t)return!1;return!0}function sO(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class oO{constructor(e,{copyState:n=!1,log:r=()=>{}}={}){T(this,"gl");T(this,"program",null);T(this,"stateStack",[]);T(this,"enable",!0);T(this,"cache");T(this,"log");this.gl=e,this.cache=n?eE(e):Object.assign({},Vp),this.log=r,this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){le(this.stateStack.length>0);const e=this.stateStack[this.stateStack.length-1];Br(this.gl,e),this.stateStack.pop()}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){le(s!==void 0);const o=e[s],a=this.cache[s];sO(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function Ur(t){return t.state}function tE(t,e){const{enable:n=!0,copyState:r}=e;if(le(r!==void 0),!t.state){t.state=new oO(t,{copyState:r}),lO(t);for(const s in ty){const o=ty[s];aO(t,s,o)}ry(t,"getParameter"),ry(t,"isEnabled")}const i=Ur(t);return i.enable=n,t}function nu(t){let e=Ur(t);e||(tE(t,{copyState:!1}),e=Ur(t)),e.push()}function wo(t){const e=Ur(t);le(e),e.pop()}function ry(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||nO.has(i))return n(i);const s=Ur(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function aO(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=Ur(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function lO(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=Ur(t);i.program!==r&&(e(r),i.program=r)}}const cO={powerPreference:"high-performance",onContextLost:()=>console.error("WebGL context lost"),onContextRestored:()=>console.info("WebGL context restored")};function uO(t,e){e={...cO,...e};let n=null;const r=s=>n=s.statusMessage||n;t.addEventListener("webglcontextcreationerror",r,!1);let i=null;if(i||(i=t.getContext("webgl2",e)),t.removeEventListener("webglcontextcreationerror",r,!1),!i)throw new Error(`Failed to create WebGL context: ${n||"Unknown error"}`);if(e.onContextLost){const{onContextLost:s}=e;t.addEventListener("webglcontextlost",o=>s(o),!1)}if(e.onContextRestored){const{onContextRestored:s}=e;t.addEventListener("webglcontextrestored",o=>s(o),!1)}return i}function nr(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function hO(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);nr(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,c=t.getParameter(7938),u=nE(a,l),h=fO(a,l),f=dO(a,l);return{type:"webgl",gpu:u,gpuType:f,gpuBackend:h,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function nE(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function fO(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function dO(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(nE(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function rE(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const je="texture-compression-bc",ie="texture-compression-astc",Wt="texture-compression-etc2",pO="texture-compression-etc1-webgl",Ca="texture-compression-pvrtc-webgl",hh="texture-compression-atc-webgl",Ts="float32-renderable-webgl",fh="float16-renderable-webgl",gO="rgb9e5ufloat_renderable-webgl",dh="snorm8-renderable-webgl",ws="norm16-renderable-webgl",ph="snorm16-renderable-webgl",Pa="float32-filterable",iy="float16-filterable-webgl",Is="WEBGL_compressed_texture_s3tc",Os="WEBGL_compressed_texture_s3tc_srgb",yi="EXT_texture_compression_rgtc",vi="EXT_texture_compression_bptc",_O="WEBGL_compressed_texture_etc",mO="WEBGL_compressed_texture_astc",yO="WEBGL_compressed_texture_etc1",vO="WEBGL_compressed_texture_pvrtc",TO="WEBGL_compressed_texture_atc",sy="EXT_texture_norm16",oy="EXT_render_snorm",wO="EXT_color_buffer_float",jp={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[oy],"norm16-renderable-webgl":[sy],"snorm16-renderable-webgl":[sy,oy],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[Is,Os,yi,vi],"texture-compression-bc5-webgl":[yi],"texture-compression-bc7-webgl":[vi],"texture-compression-etc2":[_O],"texture-compression-astc":[mO],"texture-compression-etc1-webgl":[yO],"texture-compression-pvrtc-webgl":[vO],"texture-compression-atc-webgl":[TO]};function EO(t){return t in jp}function SO(t,e,n){return(jp[e]||[]).every(i=>nr(t,i,n))}const ru={"rgb8unorm-unsized":{gl:6407,b:4,c:2,bpp:4,dataFormat:6407,types:[5121,33635]},"rgba8unorm-unsized":{gl:6408,b:4,c:2,bpp:4,dataFormat:6408,types:[5121,32819,32820]},r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:dh},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:dh},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:fh,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:ws,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:ph},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:dh},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:fh,filter:iy,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:ws},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:ph},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:Ts,filter:Pa},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:gO},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:Ts,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:ws},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:ws},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:Ts,filter:Pa,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:fh,filter:iy},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:ws,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:ph},"rgb32float-webgl":{gl:34837,render:Ts,filter:Pa,gl2ext:wO,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:Ts,filter:Pa,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth24unorm-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,dataFormat:34041,types:[34042],rb:!0},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:Is,f:je},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Os,f:je},"bc1-rgba-unorm":{gl:33777,x:Is,f:je},"bc1-rgba-unorm-srgb":{gl:35916,x:Os,f:je},"bc2-rgba-unorm":{gl:33778,x:Is,f:je},"bc2-rgba-unorm-srgb":{gl:35918,x:Os,f:je},"bc3-rgba-unorm":{gl:33779,x:Is,f:je},"bc3-rgba-unorm-srgb":{gl:35919,x:Os,f:je},"bc4-r-unorm":{gl:36283,x:yi,f:je},"bc4-r-snorm":{gl:36284,x:yi,f:je},"bc5-rg-unorm":{gl:36285,x:yi,f:je},"bc5-rg-snorm":{gl:36286,x:yi,f:je},"bc6h-rgb-ufloat":{gl:36495,x:vi,f:je},"bc6h-rgb-float":{gl:36494,x:vi,f:je},"bc7-rgba-unorm":{gl:36492,x:vi,f:je},"bc7-rgba-unorm-srgb":{gl:36493,x:vi,f:je},"etc2-rgb8unorm":{gl:37492,f:Wt},"etc2-rgb8unorm-srgb":{gl:37494,f:Wt},"etc2-rgb8a1unorm":{gl:37496,f:Wt},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Wt},"etc2-rgba8unorm":{gl:37493,f:Wt},"etc2-rgba8unorm-srgb":{gl:37495,f:Wt},"eac-r11unorm":{gl:37488,f:Wt},"eac-r11snorm":{gl:37489,f:Wt},"eac-rg11unorm":{gl:37490,f:Wt},"eac-rg11snorm":{gl:37491,f:Wt},"astc-4x4-unorm":{gl:37808,f:ie},"astc-4x4-unorm-srgb":{gl:37840,f:ie},"astc-5x4-unorm":{gl:37809,f:ie},"astc-5x4-unorm-srgb":{gl:37841,f:ie},"astc-5x5-unorm":{gl:37810,f:ie},"astc-5x5-unorm-srgb":{gl:37842,f:ie},"astc-6x5-unorm":{gl:37811,f:ie},"astc-6x5-unorm-srgb":{gl:37843,f:ie},"astc-6x6-unorm":{gl:37812,f:ie},"astc-6x6-unorm-srgb":{gl:37844,f:ie},"astc-8x5-unorm":{gl:37813,f:ie},"astc-8x5-unorm-srgb":{gl:37845,f:ie},"astc-8x6-unorm":{gl:37814,f:ie},"astc-8x6-unorm-srgb":{gl:37846,f:ie},"astc-8x8-unorm":{gl:37815,f:ie},"astc-8x8-unorm-srgb":{gl:37847,f:ie},"astc-10x5-unorm":{gl:37819,f:ie},"astc-10x5-unorm-srgb":{gl:37851,f:ie},"astc-10x6-unorm":{gl:37817,f:ie},"astc-10x6-unorm-srgb":{gl:37849,f:ie},"astc-10x8-unorm":{gl:37818,f:ie},"astc-10x8-unorm-srgb":{gl:37850,f:ie},"astc-10x10-unorm":{gl:37819,f:ie},"astc-10x10-unorm-srgb":{gl:37851,f:ie},"astc-12x10-unorm":{gl:37820,f:ie},"astc-12x10-unorm-srgb":{gl:37852,f:ie},"astc-12x12-unorm":{gl:37821,f:ie},"astc-12x12-unorm-srgb":{gl:37853,f:ie},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Ca},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Ca},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Ca},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Ca},"etc1-rbg-unorm-webgl":{gl:36196,f:pO},"atc-rgb-unorm-webgl":{gl:35986,f:hh},"atc-rgba-unorm-webgl":{gl:35986,f:hh},"atc-rgbai-unorm-webgl":{gl:34798,f:hh}},AO={6403:1,36244:1,33319:2,33320:2,6407:3,36248:3,6408:4,36249:4,6402:1,34041:1,6406:1,6409:1,6410:2},RO={5126:4,5125:4,5124:4,5123:2,5122:2,5131:2,5120:1,5121:1};function Wp(t,e,n){const r=ru[e];if(!r||r.gl===void 0)return!1;const i=r.x||r.gl2ext;return i?!!nr(t,i,n):!0}function iE(t){const e=ru[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}function bO(t,e,n){if(!Wp(t,e,n)||e.startsWith("depth")||e.startsWith("stencil"))return!1;try{if(cw(e).signed)return!1}catch{return!1}return e.endsWith("32float")?!!nr(t,"OES_texture_float_linear, extensions",n):e.endsWith("16float")?!!nr(t,"OES_texture_half_float_linear, extensions",n):!0}function CO(t,e,n){return!(!Wp(t,e,n)||typeof e=="number")}function Wl(t){var i;const e=ru[t],n=iE(t),r=cw(t);return{format:n,dataFormat:(e==null?void 0:e.dataFormat)||xO(r.format,r.integer,r.normalized,n),type:r.dataType?rE(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed}}function PO(t){const e=ru[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function ay(t){const e=Wl(t),n=AO[e.dataFormat]||4,r=RO[e.type]||1;return n*r}function xO(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;default:return 6408}}const ly={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class MO extends W3{constructor(n,r,i){super([],i);T(this,"gl");T(this,"extensions");T(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,nr(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){return this.disabledFeatures[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),EO(n)&&SO(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(ly),...Object.keys(jp)]}getWebGLFeature(n){const r=ly[n];return typeof r=="string"?!!nr(this.gl,r,this.extensions):!!r}}class IO extends j3{constructor(n){super();T(this,"gl");T(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]}}function Vn(t,e,n){if(OO(e))return n(t);const{nocatch:r=!0}=e;nu(t),Br(t,e);let i;if(r)i=n(t),wo(t);else try{i=n(t)}finally{wo(t)}return i}function OO(t){for(const e in t)return!1;return!0}function NO(t,e,n,r){if(Ml(e))return r(t);const i=t;nu(i.gl);try{return kO(t,e),Br(i.gl,n),r(t)}finally{wo(i.gl)}}function kO(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(Pr("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=Pr("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=Pr("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(DO("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Qf("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&U.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Qf("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=gh("stencilPassOperation",e.stencilPassOperation),s=gh("stencilFailOperation",e.stencilFailOperation),o=gh("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}if(e.blendColorOperation||e.blendAlphaOperation){r.enable(3042);const i=cy("blendColorOperation",e.blendColorOperation||"add"),s=cy("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=xa("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=xa("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=xa("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=xa("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,c)}}function Qf(t,e){return Pr(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function gh(t,e){return Pr(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function cy(t,e){return Pr(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function xa(t,e){return Pr(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function FO(t,e){return`Illegal parameter ${e} for ${t}`}function Pr(t,e,n){if(!(e in n))throw new Error(FO(t,e));return n[e]}function DO(t,e){return e}function sE(t){const e={};return t.addressModeU&&(e[10242]=_h(t.addressModeU)),t.addressModeV&&(e[10243]=_h(t.addressModeV)),t.addressModeW&&(e[32882]=_h(t.addressModeW)),t.magFilter&&(e[10240]=oE(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=BO(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Qf("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function _h(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function oE(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function BO(t,e){if(!e)return oE(t);switch(t){case"nearest":return e==="nearest"?9984:9986;case"linear":return e==="nearest"?9985:9987}}class Jn extends de{constructor(n,r={}){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");T(this,"glTarget");T(this,"glUsage");T(this,"glIndexType",5123);T(this,"byteLength");T(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=UO(this.props.usage),this.glUsage=LO(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){le(n>=0);let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function UO(t){return t&de.INDEX?34963:t&de.VERTEX?34962:t&de.UNIFORM?35345:34962}function LO(t){return t&de.INDEX||t&de.VERTEX?35044:t&de.UNIFORM?35048:35044}class Jf extends Nl{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"parameters");this.device=n,this.parameters=sE(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}class Ti extends Il{constructor(n,r){super(n,{...Tt.defaultProps,...r});T(this,"device");T(this,"gl");T(this,"handle");T(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const zO={parameters:{},pixelStore:{},pixels:null,border:0,dataFormat:void 0,textureUnit:void 0,target:void 0},Qs=class Qs extends Tt{constructor(n,r){var i;super(n,{...zO,format:"rgba8unorm",...r});T(this,"MAX_ATTRIBUTES");T(this,"device");T(this,"gl");T(this,"handle");T(this,"sampler");T(this,"view");T(this,"glFormat");T(this,"type");T(this,"dataFormat");T(this,"mipmaps");T(this,"target");T(this,"textureUnit");T(this,"loaded",!1);T(this,"_video");this.device=n,this.gl=this.device.gl,this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glFormat=6408,this.target=VO(this.props),this.loaded=!1,typeof((i=this.props)==null?void 0:i.data)=="string"&&Object.assign(this.props,{data:MP(this.props.data)}),this.initialize(this.props),Object.seal(this)}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}toString(){return`Texture(${this.id},${this.width}x${this.height})`}createView(n){return new Ti(this.device,{...n,texture:this})}initialize(n={}){if(this.props.dimension==="cube")return this.initializeCube(n);let r=n.data;if(r instanceof Promise)return r.then(p=>this.initialize(Object.assign({},n,{pixels:p,data:p}))),this;const i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement;if(i&&r.readyState<HTMLVideoElement.HAVE_METADATA)return this._video=null,r.addEventListener("loadeddata",()=>this.initialize(n)),this;const{parameters:s={}}=n,{pixels:o=null,pixelStore:a={},textureUnit:l=void 0,mipmaps:c=!0}=n;r||(r=o);let{width:u,height:h,dataFormat:f,type:d,compressed:_=!1}=n;const{depth:v=0}=n,A=iE(n.format);return{width:u,height:h,compressed:_,dataFormat:f,type:d}=this._deduceParameters({format:n.format,type:d,dataFormat:f,compressed:_,data:r,width:u,height:h}),this.width=u,this.height=h,this.glFormat=A,this.type=d,this.dataFormat=f,this.textureUnit=l,Number.isFinite(this.textureUnit)&&(this.gl.activeTexture(33984+this.textureUnit),this.gl.bindTexture(this.target,this.handle)),this.mipmaps=c,this.setImageData({data:r,width:u,height:h,depth:v,format:A,type:d,dataFormat:f,parameters:a,compressed:_}),this.setSampler(n.sampler),this._setSamplerParameters(s),this.view=this.createView({...this.props,mipLevelCount:1,arrayLayerCount:1}),c&&this.device.isTextureFormatFilterable(n.format)&&this.generateMipmap(),i&&(this._video={video:r,parameters:s,lastTime:r.readyState>=HTMLVideoElement.HAVE_CURRENT_DATA?r.currentTime:-1}),this}initializeCube(n){const{mipmaps:r=!0,parameters:i={}}=n;return this.setCubeMapImageData(n).then(()=>{this.loaded=!0,r&&this.generateMipmap(n),this.setSampler(n.sampler),this._setSamplerParameters(i)}),this}setSampler(n={}){let r;n instanceof Jf?(this.sampler=n,r=n.props):(this.sampler=new Jf(this.device,n),r=n);const i=sE(r);return this._setSamplerParameters(i),this}resize(n){const{height:r,width:i,mipmaps:s=!1}=n;return i!==this.width||r!==this.height?this.initialize({width:i,height:r,format:this.format,type:this.type,dataFormat:this.dataFormat,mipmaps:s}):this}update(){if(this._video){const{video:n,parameters:r,lastTime:i}=this._video;if(i===n.currentTime||n.readyState<HTMLVideoElement.HAVE_CURRENT_DATA)return;this.setSubImageData({data:n,parameters:r}),this.mipmaps&&this.generateMipmap(),this._video.lastTime=n.currentTime}}generateMipmap(n={}){return this.mipmaps=!0,this.gl.bindTexture(this.target,this.handle),Vn(this.gl,n,()=>{this.gl.generateMipmap(this.target)}),this.gl.bindTexture(this.target,null),this}setImageData(n){if(this.props.dimension==="3d"||this.props.dimension==="2d-array")return this.setImageData3D(n);this.trackDeallocatedMemory("Texture");const{target:r=this.target,pixels:i=null,level:s=0,glFormat:o=this.glFormat,offset:a=0,parameters:l={}}=n;let{data:c=null,type:u=this.type,width:h=this.width,height:f=this.height,dataFormat:d=this.dataFormat,compressed:_=!1}=n;c||(c=i),{type:u,dataFormat:d,compressed:_,width:h,height:f}=this._deduceParameters({format:this.props.format,type:u,dataFormat:d,compressed:_,data:c,width:h,height:f});const{gl:v}=this;v.bindTexture(this.target,this.handle);let A=null;if({data:c,dataType:A}=this._getDataType({data:c,compressed:_}),Vn(this.gl,l,()=>{switch(A){case"null":v.texImage2D(r,s,o,h,f,0,d,u,c);break;case"typed-array":v.texImage2D(r,s,o,h,f,0,d,u,c,a);break;case"buffer":this.device.gl.bindBuffer(35052,c.handle||c),this.device.gl.texImage2D(r,s,o,h,f,0,d,u,a),this.device.gl.bindBuffer(35052,null);break;case"browser-object":v.texImage2D(r,s,o,h,f,0,d,u,c);break;case"compressed":for(const[p,g]of c.entries())v.compressedTexImage2D(r,p,g.format,g.width,g.height,0,g.data);break;default:le(!1,"Unknown image data type")}}),c&&c.byteLength)this.trackAllocatedMemory(c.byteLength,"Texture");else{const p=ay(this.props.format);this.trackAllocatedMemory(this.width*this.height*p,"Texture")}return this.loaded=!0,this}setSubImageData({target:n=this.target,pixels:r=null,data:i=null,x:s=0,y:o=0,width:a=this.width,height:l=this.height,level:c=0,glFormat:u=this.glFormat,type:h=this.type,dataFormat:f=this.dataFormat,compressed:d=!1,offset:_=0,parameters:v={}}){if({type:h,dataFormat:f,compressed:d,width:a,height:l}=this._deduceParameters({format:this.props.format,type:h,dataFormat:f,compressed:d,data:i,width:a,height:l}),le(this.depth===1,"texSubImage not supported for 3D textures"),i||(i=r),i&&i.data){const A=i;i=A.data,a=A.shape[0],l=A.shape[1]}i instanceof Jn&&(i=i.handle),this.gl.bindTexture(this.target,this.handle),Vn(this.gl,v,()=>{d?this.gl.compressedTexSubImage2D(n,c,s,o,a,l,u,i):i===null?this.gl.texSubImage2D(n,c,s,o,a,l,f,h,null):ArrayBuffer.isView(i)?this.gl.texSubImage2D(n,c,s,o,a,l,f,h,i,_):typeof WebGLBuffer<"u"&&i instanceof WebGLBuffer?(this.device.gl.bindBuffer(35052,i),this.device.gl.texSubImage2D(n,c,s,o,a,l,f,h,_),this.device.gl.bindBuffer(35052,null)):this.device.gl.texSubImage2D(n,c,s,o,a,l,f,h,i)}),this.gl.bindTexture(this.target,null)}copyFramebuffer(n={}){return U.error("Texture.copyFramebuffer({...}) is no logner supported, use copyToTexture(source, target, opts})")(),null}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,this.handle),n}unbind(n=this.textureUnit){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.target,null),n}_getDataType({data:n,compressed:r=!1}){return r?{data:n,dataType:"compressed"}:n===null?{data:n,dataType:"null"}:ArrayBuffer.isView(n)?{data:n,dataType:"typed-array"}:n instanceof Jn?{data:n.handle,dataType:"buffer"}:typeof WebGLBuffer<"u"&&n instanceof WebGLBuffer?{data:n,dataType:"buffer"}:{data:n,dataType:"browser-object"}}_deduceParameters(n){const{format:r,data:i}=n;let{width:s,height:o,dataFormat:a,type:l,compressed:c}=n;const u=Wl(r);return a=a||u.dataFormat,l=l||u.type,c=c||u.compressed,{width:s,height:o}=this._deduceImageSize(i,s,o),{dataFormat:a,type:l,compressed:c,width:s,height:o,format:r,data:i}}_deduceImageSize(n,r,i){let s;return typeof ImageData<"u"&&n instanceof ImageData?s={width:n.width,height:n.height}:typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement?s={width:n.naturalWidth,height:n.naturalHeight}:typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement?s={width:n.width,height:n.height}:typeof ImageBitmap<"u"&&n instanceof ImageBitmap?s={width:n.width,height:n.height}:typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement?s={width:n.videoWidth,height:n.videoHeight}:n?s={width:r,height:i}:s={width:r>=0?r:1,height:i>=0?i:1},le(s,"Could not deduced texture size"),le(r===void 0||s.width===r,"Deduced texture width does not match supplied width"),le(i===void 0||s.height===i,"Deduced texture height does not match supplied height"),s}async setCubeMapImageData(n){const{gl:r}=this,{width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,u=o||a,h=await Promise.all(Qs.FACES.map(f=>{const d=u[f];return Promise.all(Array.isArray(d)?d:[d])}));this.bind(),Qs.FACES.forEach((f,d)=>{h[d].length>1&&this.props.mipmaps!==!1&&U.warn(`${this.id} has mipmap and multiple LODs.`)(),h[d].forEach((_,v)=>{i&&s?r.texImage2D(f,v,l,i,s,0,l,c,_):r.texImage2D(f,v,l,l,c,_)})}),this.unbind()}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,{gl:u}=this,h=o||a;return this.bind(),h instanceof Promise?h.then(f=>this.setImageDataForFace(Object.assign({},n,{face:r,data:f,pixels:f}))):this.width||this.height?u.texImage2D(r,0,l,i,s,0,l,c,h):u.texImage2D(r,0,l,l,c,h),this}setImageData3D(n){const{level:r=0,dataFormat:i,format:s,type:o,width:a,height:l,depth:c=1,offset:u=0,data:h,parameters:f={}}=n;this.trackDeallocatedMemory("Texture"),this.gl.bindTexture(this.target,this.handle);const d=Wl(s);if(Vn(this.gl,f,()=>{ArrayBuffer.isView(h)&&this.gl.texImage3D(this.target,r,d.format,a,l,c,0,d.dataFormat,d.type,h),h instanceof Jn&&(this.gl.bindBuffer(35052,h.handle),this.gl.texImage3D(this.target,r,i,a,l,c,0,s,o,u))}),h&&h.byteLength)this.trackAllocatedMemory(h.byteLength,"Texture");else{const _=ay(this.props.format);this.trackAllocatedMemory(this.width*this.height*this.depth*_,"Texture")}return this.loaded=!0,this}_setSamplerParameters(n){if(!Ml(n)){jO(n),this.gl.bindTexture(this.target,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.target,s,o);break;default:this.gl.texParameteri(this.target,s,o);break}}this.gl.bindTexture(this.target,null)}}};T(Qs,"FACES",[34069,34070,34071,34072,34073,34074]);let Qt=Qs;function VO(t){switch(t.dimension){case"2d":return 3553;case"cube":return 34067;case"2d-array":return 35866;case"3d":return 32879;case"1d":case"cube-array":default:throw new Error(t.dimension)}}function jO(t){U.log(1,"texture sampler parameters",t)()}class $s extends kl{constructor(n,r){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");const i=r.handle===null;if(this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),!i){n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures();const s=this.gl.bindFramebuffer(36160,this.handle);for(let o=0;o<this.colorAttachments.length;++o){const a=this.colorAttachments[o],l=36064+o;a&&this._attachOne(l,a)}if(this.depthStencilAttachment&&this._attachOne(PO(this.depthStencilAttachment.props.format),this.depthStencilAttachment),r.check!==!1){const o=this.gl.checkFramebufferStatus(36160);if(o!==36053)throw new Error(`Framebuffer ${HO(o)}`)}this.gl.bindFramebuffer(36160,s)}}get texture(){return this.colorAttachments[0]}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}createDepthStencilTexture(n){return new Qt(this.device,{id:`${this.id}-depth-stencil`,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){if(this.handle===null)return this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this;n===void 0&&(n=this.gl.drawingBufferWidth),r===void 0&&(r=this.gl.drawingBufferHeight);for(const i of this.colorAttachments)i.texture.resize({width:n,height:r});return this.depthStencilAttachment&&this.depthStencilAttachment.texture.resize({width:n,height:r}),this}_attachOne(n,r){if(Array.isArray(r)){const[i,s=0,o=0]=r;return this._attachTexture(n,i,s,o),i}if(r instanceof Qt)return this._attachTexture(n,r,0,0),r;if(r instanceof Ti){const i=r;return this._attachTexture(n,i.texture,i.props.baseMipLevel,i.props.baseArrayLayer),r.texture}throw new Error("attach")}_attachTexture(n,r,i,s){const{gl:o}=this.device;switch(o.bindTexture(r.target,r.handle),r.target){case 35866:case 32879:o.framebufferTextureLayer(36160,n,r.target,s,i);break;case 34067:const a=WO(i);o.framebufferTexture2D(36160,n,a,r.handle,s);break;case 3553:o.framebufferTexture2D(36160,n,3553,r.handle,s);break;default:le(!1,"Illegal texture type")}o.bindTexture(r.target,null)}}function WO(t){return t<34069?t+34069:t}function HO(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class $O extends kp{constructor(n,r){super(r);T(this,"device");T(this,"presentationSize");T(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new $s(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}const XO={spector:U.get("spector")||U.get("inspect")},YO="https://spectorcdn.babylonjs.com/spector.bundle.js",KO=1;let se=null,uy=!1;async function qO(t){if(!globalThis.SPECTOR)try{await yw(YO)}catch(e){U.warn(String(e))}}function ZO(t){if(t={...XO,...t},!(t!=null&&t.spector)||(!se&&globalThis.SPECTOR&&(U.probe(KO,"SPECTOR found and initialized")(),se=new globalThis.SPECTOR.Spector,globalThis.luma&&(globalThis.luma.spector=se)),!se))return null;if(uy||(uy=!0,se.spyCanvases(),se==null||se.onCaptureStarted.add(e=>U.info("Spector capture started:",e)()),se==null||se.onCapture.add(e=>{U.info("Spector capture complete:",e)(),se==null||se.getResultUI(),se==null||se.resultView.display(),se==null||se.resultView.addCapture(e)})),t!=null&&t.canvas){if(typeof t.spector=="string"&&t.spector!==t.canvas.id)return se;se==null||se.startCapture(t==null?void 0:t.canvas,500),new Promise(e=>setTimeout(e,2e3)).then(e=>{U.info("Spector capture stopped after 2 seconds")(),se==null||se.stopCapture()})}return se}const QO="https://unpkg.com/webgl-debug@2.0.1/index.js";function aE(t){return t.luma=t.luma||{},t.luma}async function JO(){or()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await yw(QO))}function GO(t,e={}){return t?e.debug?tN(t,e):eN(t):null}function eN(t){const e=aE(t);return e.realContext?e.realContext:t}function tN(t,e){if(!globalThis.WebGLDebugUtils)return U.warn("webgl-debug not loaded")(),t;const n=aE(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...mi,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,nN.bind(null,e),rN.bind(null,e));for(const o in mi)!(o in r)&&typeof mi[o]=="number"&&(r[o]=mi[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function mh(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function nN(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;U.error(o)();debugger;if(t.throwOnError)throw new Error(o)}function rN(t,e,n){let r="";if(U.level>=1&&(r=mh(e,n),U.log(1,r)()),t.break&&t.break.length>0&&(r=r||mh(e,n),t.break.every(s=>r.indexOf(s)!==-1)))debugger;for(const i of n)if(i===void 0){if(r=r||mh(e,n),t.throwOnError)throw new Error(`Undefined argument: ${r}`);U.error(`Undefined argument: ${r}`)();debugger}}function iN(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[h,f]=i;n.push({message:f.trim(),type:hy(h),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:hy(s),lineNum:c,linePos:u})}return n}function hy(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class sN extends Ol{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return iN(n)}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return r==null?void 0:r.getTranslatedShaderSource(this.handle)}async _compile(n){n=(s=>s.startsWith("#version ")?s:`#version 100
${s}`)(n);const{gl:i}=this.device;if(i.shaderSource(this.handle,n),i.compileShader(this.handle),U.level===0){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}U.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),U.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}const oN=256,aN=1024,lN=16384,yh=6144,cN=[1,2,4,8];class uN extends Of{constructor(n,r){super(n,r);T(this,"device");T(this,"glParameters");this.device=n,nu(this.device.gl),this.setParameters(this.props.parameters),this.clear()}end(){wo(this.device.gl),this.props.framebuffer&&Br(this.device.gl,{framebuffer:null})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={};this.props.framebuffer&&(r.framebuffer=this.props.framebuffer),this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=cN.map(i=>!!(i&n.colorMask))),this.glParameters=r,Br(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColor!==!1&&(r|=lN,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=oN,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=aN,n.clearStencil=this.props.clearStencil),r!==0&&Vn(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){Vn(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int32Array:this.device.gl.clearBufferiv(yh,n,r);break;case Uint32Array:this.device.gl.clearBufferuiv(yh,n,r);break;case Float32Array:default:this.device.gl.clearBufferfv(yh,n,r);break}})}}const hN="Failed to deduce GL constant from typed array";function fN(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(hN)}}function Gf(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}const dN={offset:0,stride:0,type:5126,size:1,divisor:0,normalized:!1,integer:!1},pN={deprecatedProps:{instanced:"divisor",isInstanced:"divisor"}};class Xs{constructor(...e){T(this,"offset");T(this,"stride");T(this,"type");T(this,"size");T(this,"divisor");T(this,"normalized");T(this,"integer");T(this,"buffer");T(this,"index");e.forEach(n=>this._assign(n)),Object.freeze(this)}static getBytesPerElement(e){return Gf(e.type||5126).BYTES_PER_ELEMENT}static getBytesPerVertex(e){return le(e.size),Gf(e.type||5126).BYTES_PER_ELEMENT*e.size}static resolve(...e){return new Xs(dN,...e)}toString(){return JSON.stringify(this)}get BYTES_PER_ELEMENT(){return Xs.getBytesPerElement(this)}get BYTES_PER_VERTEX(){return Xs.getBytesPerVertex(this)}_assign(e={}){return e=PP("Accessor",e,pN),e.type!==void 0&&(this.type=e.type,(e.type===5124||e.type===5125)&&(this.integer=!0)),e.size!==void 0&&(this.size=e.size),e.offset!==void 0&&(this.offset=e.offset),e.stride!==void 0&&(this.stride=e.stride),e.normalize!==void 0&&(this.normalized=e.normalize),e.normalized!==void 0&&(this.normalized=e.normalized),e.integer!==void 0&&(this.integer=e.integer),e.divisor!==void 0&&(this.divisor=e.divisor),e.buffer!==void 0&&(this.buffer=e.buffer),e.index!==void 0&&(typeof e.index=="boolean"?this.index=e.index?1:0:this.index=e.index),e.instanced!==void 0&&(this.divisor=e.instanced?1:0),e.isInstanced!==void 0&&(this.divisor=e.isInstanced?1:0),this.offset===void 0&&delete this.offset,this.stride===void 0&&delete this.stride,this.type===void 0&&delete this.type,this.size===void 0&&delete this.size,this.divisor===void 0&&delete this.divisor,this.normalized===void 0&&delete this.normalized,this.integer===void 0&&delete this.integer,this.buffer===void 0&&delete this.buffer,this.index===void 0&&delete this.index,this}}function gN(t){return _N.includes(t)}const _N=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],lE={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function cE(t){const e=lE[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function mN(t){const e=lE[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function yN(t,e){const n={attributes:[],bindings:[]};n.attributes=vN(t,e);const r=EN(t,e);for(const a of r){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=wN(t,e);let s=0;for(const a of i)if(gN(a.type)){const{viewDimension:l,sampleType:c}=AN(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=TN(t,e);return o!=null&&o.length&&(n.varyings=o),n}function vN(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:c}=mN(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((i,s)=>i.location-s.location),n}function TN(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:c,components:u}=cE(a),h=new Xs({type:c,size:l*u}),f={location:i,name:o,accessor:h};n.push(f)}return n.sort((i,s)=>i.location-s.location),n}function wN(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=RN(o);let h=t.getUniformLocation(e,c);const f={location:h,name:c,size:a,type:l,isArray:u};if(n.push(f),f.size>1)for(let d=0;d<f.size;d++){const _=`${c}[${d}]`;h=t.getUniformLocation(e,_);const v={...f,name:_,location:h};n.push(v)}}return n}function EN(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),h=t.getActiveUniforms(e,a,35388);for(let f=0;f<o.uniformCount;++f){const d=t.getActiveUniform(e,a[f]);if(!d)throw new Error("activeInfo");o.uniforms.push({name:d.name,format:cE(l[f]).format,type:l[f],arrayLength:c[f],byteOffset:u[f],byteStride:h[f]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const SN={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function AN(t){const e=SN[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function RN(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function bN(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function CN(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"line-loop-webgl":return 2;case"triangle-list":return 4;case"triangle-strip":return 5;case"triangle-fan-webgl":return 6;default:throw new Error(t)}}function PN(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"line-loop-webgl":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;case"triangle-fan-webgl":return 4;default:throw new Error(t)}}const fy=4;class xN extends ji{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"vs");T(this,"fs");T(this,"introspectedLayout");T(this,"uniforms",{});T(this,"bindings",{});T(this,"varyings",null);T(this,"_uniformCount",0);T(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;switch(i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),U.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=yN(this.device.gl,this.handle),U.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=gP(this.introspectedLayout,r.shaderLayout),this.props.topology){case"triangle-fan-webgl":case"line-loop-webgl":U.warn(`Primitive topology ${this.props.topology} is deprecated and will be removed in v9.1`);break}}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||U.warn(`Unknown binding "${i}" in render pipeline "${this.id}", expected one of ${a}`)();continue}switch(s||U.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof Jn)&&!(s.buffer instanceof Jn))throw new Error("buffer value");break;case"texture":if(!(s instanceof Ti||s instanceof Qt||s instanceof $s))throw new Error("texture value");break;case"sampler":U.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var A;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,firstVertex:c=0,transformFeedback:u}=n,h=CN(s),f=!!o.indexBuffer,d=(A=o.indexBuffer)==null?void 0:A.glIndexType,_=Number(l)>0;if(this.linkStatus!=="success")return U.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable()||a===0)return U.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;if(a===0)return U.info(2,`RenderPipeline:${this.id}.draw() aborted - no vertices to draw`)(),!0;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const v=r;return NO(this.device,i,v.glParameters,()=>{f&&_?this.device.gl.drawElementsInstanced(h,a||0,d,c,l||0):f?this.device.gl.drawElements(h,a||0,d,c):_?this.device.gl.drawArraysInstanced(h,c,a||0,l||0):this.device.gl.drawArrays(h,c,a||0),u&&u.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=mw(n);Object.keys(r).forEach(i=>{U.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),U.time(fy,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),U.timeEnd(fy,`linkProgram for ${this.id}`)(),U.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}U.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),U.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}_reportLinkStatus(n){var r;switch(n){case"success":return;default:throw this.vs.compilationStatus==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`)):((r=this.fs)==null?void 0:r.compilationStatus)==="error"?(this.vs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`)):new Error(`Error during ${n}: ${this.device.gl.getProgramInfoLog(this.handle)}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const[,r]of Object.entries(this.bindings))r instanceof Qt&&(r.update(),n=n&&r.loaded);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof Jn?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof Ti||o instanceof Qt||o instanceof $s))throw new Error("texture");let c;if(o instanceof Ti)c=o.texture;else if(o instanceof Qt)c=o;else if(o instanceof $s&&o.colorAttachments[0]instanceof Ti)U.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(c.target,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&bN(this.device.gl,i,s,a)}}}class MN extends kf{constructor(n){super(n,{});T(this,"device");T(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":IN(this.device,r.options);break;case"copy-buffer-to-texture":ON(this.device,r.options);break;case"copy-texture-to-buffer":NN(this.device,r.options);break;case"copy-texture-to-texture":kN(this.device,r.options);break}}}function IN(t,e){const n=e.source,r=e.destination;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function ON(t,e){throw new Error("Not implemented")}function NN(t,e){const{source:n,mipLevel:r=0,aspect:i="all",width:s=e.source.width,height:o=e.source.height,depthOrArrayLayers:a=0,origin:l=[0,0],destination:c,byteOffset:u=0,bytesPerRow:h,rowsPerImage:f}=e;if(i!=="all")throw new Error("not supported");if(r!==0||a!==0||h||f)throw new Error("not implemented");const{framebuffer:d,destroyFramebuffer:_}=uE(n);let v;try{const A=c,p=s||d.width,g=o||d.height,m=Wl(d.texture.props.format),E=m.dataFormat,b=m.type;t.gl.bindBuffer(35051,A.handle),v=t.gl.bindFramebuffer(36160,d.handle),t.gl.readPixels(l[0],l[1],p,g,E,b,u)}finally{t.gl.bindBuffer(35051,null),v!==void 0&&t.gl.bindFramebuffer(36160,v),_&&d.destroy()}}function kN(t,e){const{source:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destination:o}=e;let{width:a=e.destination.width,height:l=e.destination.height}=e;const{framebuffer:c,destroyFramebuffer:u}=uE(n),[h,f]=i,[d,_,v]=s,A=t.gl.bindFramebuffer(36160,c.handle);let p=null,g;if(o instanceof Qt)p=o,a=Number.isFinite(a)?a:p.width,l=Number.isFinite(l)?l:p.height,p.bind(0),g=p.target;else throw new Error("invalid destination");switch(g){case 3553:case 34067:t.gl.copyTexSubImage2D(g,r,d,_,h,f,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(g,r,d,_,v,h,f,a,l);break}p&&p.unbind(),t.gl.bindFramebuffer(36160,A),u&&c.destroy()}function uE(t){if(t instanceof Tt){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class FN extends Nf{constructor(n,r){super(n,r);T(this,"device");T(this,"commandBuffer");this.device=n,this.commandBuffer=new MN(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}class Hp extends Ff{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"buffer",null);T(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return Rb()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:h}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,h||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=rE(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=Hp.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=DN(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!BN(i,this.bufferValue),a){const l=vP(r.constructor,o);TP({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function DN(t){return Array.isArray(t)?new Float32Array(t):t}function BN(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class UN extends Df{constructor(n,r){super(n,r);T(this,"device");T(this,"gl");T(this,"handle");T(this,"layout");T(this,"buffers",{});T(this,"unusedBuffers",{});T(this,"bindOnUse",!0);T(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(PN(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse||this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,U.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(dy(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof Jn)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(dy(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function dy(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class LN extends Bf{constructor(n,r){super(n,r);T(this,"device");T(this,"handle");T(this,"target",null);T(this,"_queryPending",!1);T(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}function hE(t){switch(t){case 6406:case 33326:case 6403:return 1;case 33328:case 33319:return 2;case 6407:case 34837:return 3;case 6408:case 34836:return 4;default:return le(!1),0}}function zN(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return le(!1),0}}function VN(t,e){var A,p;const{sourceX:n=0,sourceY:r=0,sourceFormat:i=6408,sourceAttachment:s=36064}=e||{};let{target:o=null,sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:h}=fE(t);le(u);const{gl:f,handle:d}=u;a=a||u.width,l=l||u.height;const _=s-36064;c=c||((p=(A=u.colorAttachments[_])==null?void 0:A.texture)==null?void 0:p.type)||5121,o=HN(o,c,i,a,l),c=c||fN(o);const v=f.bindFramebuffer(36160,d);return f.readPixels(n,r,a,l,i,c,o),f.bindFramebuffer(36160,v||null),h&&u.destroy(),o}function jN(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:h}=fE(t);le(u),a=a||u.width,l=l||u.height;const f=u;c=c||5121;let d=n;if(!d){const v=hE(s),A=zN(c),p=o+a*l*v*A;d=f.device.createBuffer({byteLength:p})}const _=t.device.createCommandEncoder();return _.copyTextureToBuffer({source:t,width:a,height:l,origin:[r,i],destination:d,byteOffset:o}),_.destroy(),h&&u.destroy(),d}function fE(t){return t instanceof kl?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:WN(t),deleteFramebuffer:!0}}function WN(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function HN(t,e,n,r,i){if(t)return t;e=e||5121;const s=Gf(e,{clamped:!1}),o=hE(n);return new s(r*i*o)}const $N=256,XN=1024,YN=16384,KN="clear: bad arguments";function qN(t,e){const{framebuffer:n=null,color:r=null,depth:i=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=YN,r!==!0&&(o.clearColor=r)),i&&(a|=$N,i!==!0&&(o.clearDepth=i)),s&&(a|=XN,i!==!0&&(o.clearStencil=i)),le(a!==0,KN);const l=t.gl;Vn(l,o,()=>{l.clear(a)})}const Es=1,gr=class gr extends Rr{constructor(n){var l,c;super({...n,id:n.id||$r("webgl-device")});T(this,"type","webgl");T(this,"handle");T(this,"features");T(this,"limits");T(this,"info");T(this,"canvasContext");T(this,"lost");T(this,"_resolveContextLost");T(this,"renderPass",null);T(this,"gl");T(this,"debug",!1);T(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});T(this,"_extensions",{});T(this,"_polyfilled",!1);T(this,"spectorJS");T(this,"_constants");const r=(l=n.gl)==null?void 0:l.device;if(r)throw new Error(`WebGL context already attached to device ${r.id}`);const i=((c=n.gl)==null?void 0:c.canvas)||n.canvas;this.canvasContext=new $O(this,{...n,canvas:i}),this.lost=new Promise(u=>{this._resolveContextLost=u});let s=n.gl||null;if(s||(s=uO(this.canvasContext.canvas,{...n,onContextLost:u=>{var h;return(h=this._resolveContextLost)==null?void 0:h.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})}})),!s)throw new Error("WebGL context creation failed");this.handle=s,this.gl=s,this.gl.device=this,this.gl._version=2,this.info=hO(this.gl,this._extensions),this.limits=new IO(this.gl),this.features=new MO(this.gl,this._extensions,this.props.disabledFeatures),this.props.initalizeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize();const{enable:o=!0,copyState:a=!1}=n;tE(this.gl,{enable:o,copyState:a,log:(...u)=>U.log(1,...u)()}),n.debug&&(this.gl=GO(this.gl,{...n,throwOnError:!0}),this.debug=!0,U.level=Math.max(U.level,1),U.warn("WebGL debug mode activated. Performance reduced.")()),n.spector&&(this.spectorJS=ZO({...this.props,canvas:this.handle.canvas}))}static isSupported(){return typeof WebGL2RenderingContext<"u"}static attach(n){if(n instanceof gr)return n;if((n==null?void 0:n.device)instanceof Rr)return n.device;if(!ZN(n))throw new Error("Invalid WebGL2RenderingContext");return new gr({gl:n})}static async create(n={}){var a;U.groupCollapsed(Es,"WebGLDevice created")();const r=[];n.debug&&r.push(JO()),n.spector&&r.push(qO()),typeof n.canvas=="string"&&r.push(kp.pageLoaded);const i=await Promise.allSettled(r);for(const l of i)l.status==="rejected"&&U.error(`Failed to initialize debug libraries ${l.reason}`)();if(U.probe(Es+1,"DOM is loaded")(),(a=n.gl)!=null&&a.device)return U.warn("reattaching existing device")(),gr.attach(n.gl);const s=new gr(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return U.probe(Es,o)(),U.table(Es,s.info)(),U.groupEnd(Es)(),s}destroy(){}get isLost(){return this.gl.isContextLost()}getSize(){return[this.gl.drawingBufferWidth,this.gl.drawingBufferHeight]}isTextureFormatSupported(n){return Wp(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return bO(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return CO(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._getBufferProps(n);return new Jn(this,r)}_createTexture(n){return new Qt(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Jf(this,n)}createShader(n){return new sN(this,n)}createFramebuffer(n){return new $s(this,n)}createVertexArray(n){return new Hp(this,n)}createTransformFeedback(n){return new UN(this,n)}createQuerySet(n){return new LN(this,n)}createRenderPipeline(n){return new xN(this,n)}beginRenderPass(n){return new uN(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n){return new FN(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return VN(n,r)}readPixelsToBufferWebGL(n,r){return jN(n,r)}setParametersWebGL(n){Br(this.gl,n)}getParametersWebGL(n){return eE(this.gl,n)}withParametersWebGL(n,r){return Vn(this.gl,n,r)}clearWebGL(n){qN(this,n)}resetWebGL(){U.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),rO(this.gl)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){nu(this.gl)}popState(){wo(this.gl)}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){r=r||this.gl2||this.gl;const i=Number(n);for(const s in r)if(r[s]===i)return`GL.${s}`;return String(n)}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&ek(s,r)&&U.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:QN(this,n,r);break;case Int32Array:JN(this,n,r);break;case Uint32Array:GN(this,n,r);break;default:le(!1)}}getExtension(n){return nr(this.gl,n,this._extensions),this._extensions}};T(gr,"type","webgl");let Ys=gr;function ZN(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}function QN(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break;default:le(!1)}}function JN(t,e,n){t.gl.vertexAttribI4iv(e,n)}function GN(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function ek(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var dE={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function h(y,w,R){return setTimeout(m(y,R),w)}function f(y,w,R){return Array.isArray(y)?(d(y,R[w],R),!0):!1}function d(y,w,R){var I;if(y)if(y.forEach)y.forEach(w,R);else if(y.length!==i)for(I=0;I<y.length;)w.call(R,y[I],I,y),I++;else for(I in y)y.hasOwnProperty(I)&&w.call(R,y[I],I,y)}function _(y,w,R){var I="DEPRECATED METHOD: "+w+`
`+R+` AT 
`;return function(){var D=new Error("get-stack-trace"),H=D&&D.stack?D.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Q=e.console&&(e.console.warn||e.console.log);return Q&&Q.call(e.console,I,H),y.apply(this,arguments)}}var v;typeof Object.assign!="function"?v=function(w){if(w===i||w===null)throw new TypeError("Cannot convert undefined or null to object");for(var R=Object(w),I=1;I<arguments.length;I++){var D=arguments[I];if(D!==i&&D!==null)for(var H in D)D.hasOwnProperty(H)&&(R[H]=D[H])}return R}:v=Object.assign;var A=_(function(w,R,I){for(var D=Object.keys(R),H=0;H<D.length;)(!I||I&&w[D[H]]===i)&&(w[D[H]]=R[D[H]]),H++;return w},"extend","Use `assign`."),p=_(function(w,R){return A(w,R,!0)},"merge","Use `assign`.");function g(y,w,R){var I=w.prototype,D;D=y.prototype=Object.create(I),D.constructor=y,D._super=I,R&&v(D,R)}function m(y,w){return function(){return y.apply(w,arguments)}}function E(y,w){return typeof y==a?y.apply(w&&w[0]||i,w):y}function b(y,w){return y===i?w:y}function x(y,w,R){d(k(w),function(I){y.addEventListener(I,R,!1)})}function O(y,w,R){d(k(w),function(I){y.removeEventListener(I,R,!1)})}function M(y,w){for(;y;){if(y==w)return!0;y=y.parentNode}return!1}function N(y,w){return y.indexOf(w)>-1}function k(y){return y.trim().split(/\s+/g)}function z(y,w,R){if(y.indexOf&&!R)return y.indexOf(w);for(var I=0;I<y.length;){if(R&&y[I][R]==w||!R&&y[I]===w)return I;I++}return-1}function L(y){return Array.prototype.slice.call(y,0)}function j(y,w,R){for(var I=[],D=[],H=0;H<y.length;){var Q=w?y[H][w]:y[H];z(D,Q)<0&&I.push(y[H]),D[H]=Q,H++}return R&&(w?I=I.sort(function(Oe,Xe){return Oe[w]>Xe[w]}):I=I.sort()),I}function X(y,w){for(var R,I,D=w[0].toUpperCase()+w.slice(1),H=0;H<s.length;){if(R=s[H],I=R?R+D:w,I in y)return I;H++}return i}var Z=1;function Je(){return Z++}function Ue(y){var w=y.ownerDocument||y;return w.defaultView||w.parentWindow||e}var W=/mobile|tablet|ip(ad|hone|od)|android/i,Y="ontouchstart"in e,q=X(e,"PointerEvent")!==i,K=Y&&W.test(navigator.userAgent),J="touch",he="pen",Le="mouse",Rt="kinect",rn=25,Ee=1,ar=2,Se=4,Ge=8,Ho=1,ns=2,rs=4,is=8,ss=16,Bt=ns|rs,lr=is|ss,Jp=Bt|lr,Gp=["x","y"],$o=["clientX","clientY"];function gt(y,w){var R=this;this.manager=y,this.callback=w,this.element=y.element,this.target=y.options.inputTarget,this.domHandler=function(I){E(y.options.enable,[y])&&R.handler(I)},this.init()}gt.prototype={handler:function(){},init:function(){this.evEl&&x(this.element,this.evEl,this.domHandler),this.evTarget&&x(this.target,this.evTarget,this.domHandler),this.evWin&&x(Ue(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(Ue(this.element),this.evWin,this.domHandler)}};function eS(y){var w,R=y.options.inputClass;return R?w=R:q?w=cu:K?w=Ko:Y?w=uu:w=Yo,new w(y,tS)}function tS(y,w,R){var I=R.pointers.length,D=R.changedPointers.length,H=w&Ee&&I-D===0,Q=w&(Se|Ge)&&I-D===0;R.isFirst=!!H,R.isFinal=!!Q,H&&(y.session={}),R.eventType=w,nS(y,R),y.emit("hammer.input",R),y.recognize(R),y.session.prevInput=R}function nS(y,w){var R=y.session,I=w.pointers,D=I.length;R.firstInput||(R.firstInput=eg(w)),D>1&&!R.firstMultiple?R.firstMultiple=eg(w):D===1&&(R.firstMultiple=!1);var H=R.firstInput,Q=R.firstMultiple,Pe=Q?Q.center:H.center,Oe=w.center=tg(I);w.timeStamp=u(),w.deltaTime=w.timeStamp-H.timeStamp,w.angle=lu(Pe,Oe),w.distance=Xo(Pe,Oe),rS(R,w),w.offsetDirection=rg(w.deltaX,w.deltaY);var Xe=ng(w.deltaTime,w.deltaX,w.deltaY);w.overallVelocityX=Xe.x,w.overallVelocityY=Xe.y,w.overallVelocity=c(Xe.x)>c(Xe.y)?Xe.x:Xe.y,w.scale=Q?oS(Q.pointers,I):1,w.rotation=Q?sS(Q.pointers,I):0,w.maxPointers=R.prevInput?w.pointers.length>R.prevInput.maxPointers?w.pointers.length:R.prevInput.maxPointers:w.pointers.length,iS(R,w);var Lt=y.element;M(w.srcEvent.target,Lt)&&(Lt=w.srcEvent.target),w.target=Lt}function rS(y,w){var R=w.center,I=y.offsetDelta||{},D=y.prevDelta||{},H=y.prevInput||{};(w.eventType===Ee||H.eventType===Se)&&(D=y.prevDelta={x:H.deltaX||0,y:H.deltaY||0},I=y.offsetDelta={x:R.x,y:R.y}),w.deltaX=D.x+(R.x-I.x),w.deltaY=D.y+(R.y-I.y)}function iS(y,w){var R=y.lastInterval||w,I=w.timeStamp-R.timeStamp,D,H,Q,Pe;if(w.eventType!=Ge&&(I>rn||R.velocity===i)){var Oe=w.deltaX-R.deltaX,Xe=w.deltaY-R.deltaY,Lt=ng(I,Oe,Xe);H=Lt.x,Q=Lt.y,D=c(Lt.x)>c(Lt.y)?Lt.x:Lt.y,Pe=rg(Oe,Xe),y.lastInterval=w}else D=R.velocity,H=R.velocityX,Q=R.velocityY,Pe=R.direction;w.velocity=D,w.velocityX=H,w.velocityY=Q,w.direction=Pe}function eg(y){for(var w=[],R=0;R<y.pointers.length;)w[R]={clientX:l(y.pointers[R].clientX),clientY:l(y.pointers[R].clientY)},R++;return{timeStamp:u(),pointers:w,center:tg(w),deltaX:y.deltaX,deltaY:y.deltaY}}function tg(y){var w=y.length;if(w===1)return{x:l(y[0].clientX),y:l(y[0].clientY)};for(var R=0,I=0,D=0;D<w;)R+=y[D].clientX,I+=y[D].clientY,D++;return{x:l(R/w),y:l(I/w)}}function ng(y,w,R){return{x:w/y||0,y:R/y||0}}function rg(y,w){return y===w?Ho:c(y)>=c(w)?y<0?ns:rs:w<0?is:ss}function Xo(y,w,R){R||(R=Gp);var I=w[R[0]]-y[R[0]],D=w[R[1]]-y[R[1]];return Math.sqrt(I*I+D*D)}function lu(y,w,R){R||(R=Gp);var I=w[R[0]]-y[R[0]],D=w[R[1]]-y[R[1]];return Math.atan2(D,I)*180/Math.PI}function sS(y,w){return lu(w[1],w[0],$o)+lu(y[1],y[0],$o)}function oS(y,w){return Xo(w[0],w[1],$o)/Xo(y[0],y[1],$o)}var aS={mousedown:Ee,mousemove:ar,mouseup:Se},lS="mousedown",cS="mousemove mouseup";function Yo(){this.evEl=lS,this.evWin=cS,this.pressed=!1,gt.apply(this,arguments)}g(Yo,gt,{handler:function(w){var R=aS[w.type];R&Ee&&w.button===0&&(this.pressed=!0),R&ar&&w.which!==1&&(R=Se),this.pressed&&(R&Se&&(this.pressed=!1),this.callback(this.manager,R,{pointers:[w],changedPointers:[w],pointerType:Le,srcEvent:w}))}});var uS={pointerdown:Ee,pointermove:ar,pointerup:Se,pointercancel:Ge,pointerout:Ge},hS={2:J,3:he,4:Le,5:Rt},ig="pointerdown",sg="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(ig="MSPointerDown",sg="MSPointerMove MSPointerUp MSPointerCancel");function cu(){this.evEl=ig,this.evWin=sg,gt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}g(cu,gt,{handler:function(w){var R=this.store,I=!1,D=w.type.toLowerCase().replace("ms",""),H=uS[D],Q=hS[w.pointerType]||w.pointerType,Pe=Q==J,Oe=z(R,w.pointerId,"pointerId");H&Ee&&(w.button===0||Pe)?Oe<0&&(R.push(w),Oe=R.length-1):H&(Se|Ge)&&(I=!0),!(Oe<0)&&(R[Oe]=w,this.callback(this.manager,H,{pointers:R,changedPointers:[w],pointerType:Q,srcEvent:w}),I&&R.splice(Oe,1))}});var fS={touchstart:Ee,touchmove:ar,touchend:Se,touchcancel:Ge},dS="touchstart",pS="touchstart touchmove touchend touchcancel";function og(){this.evTarget=dS,this.evWin=pS,this.started=!1,gt.apply(this,arguments)}g(og,gt,{handler:function(w){var R=fS[w.type];if(R===Ee&&(this.started=!0),!!this.started){var I=gS.call(this,w,R);R&(Se|Ge)&&I[0].length-I[1].length===0&&(this.started=!1),this.callback(this.manager,R,{pointers:I[0],changedPointers:I[1],pointerType:J,srcEvent:w})}}});function gS(y,w){var R=L(y.touches),I=L(y.changedTouches);return w&(Se|Ge)&&(R=j(R.concat(I),"identifier",!0)),[R,I]}var _S={touchstart:Ee,touchmove:ar,touchend:Se,touchcancel:Ge},mS="touchstart touchmove touchend touchcancel";function Ko(){this.evTarget=mS,this.targetIds={},gt.apply(this,arguments)}g(Ko,gt,{handler:function(w){var R=_S[w.type],I=yS.call(this,w,R);I&&this.callback(this.manager,R,{pointers:I[0],changedPointers:I[1],pointerType:J,srcEvent:w})}});function yS(y,w){var R=L(y.touches),I=this.targetIds;if(w&(Ee|ar)&&R.length===1)return I[R[0].identifier]=!0,[R,R];var D,H,Q=L(y.changedTouches),Pe=[],Oe=this.target;if(H=R.filter(function(Xe){return M(Xe.target,Oe)}),w===Ee)for(D=0;D<H.length;)I[H[D].identifier]=!0,D++;for(D=0;D<Q.length;)I[Q[D].identifier]&&Pe.push(Q[D]),w&(Se|Ge)&&delete I[Q[D].identifier],D++;if(Pe.length)return[j(H.concat(Pe),"identifier",!0),Pe]}var vS=2500,ag=25;function uu(){gt.apply(this,arguments);var y=m(this.handler,this);this.touch=new Ko(this.manager,y),this.mouse=new Yo(this.manager,y),this.primaryTouch=null,this.lastTouches=[]}g(uu,gt,{handler:function(w,R,I){var D=I.pointerType==J,H=I.pointerType==Le;if(!(H&&I.sourceCapabilities&&I.sourceCapabilities.firesTouchEvents)){if(D)TS.call(this,R,I);else if(H&&wS.call(this,I))return;this.callback(w,R,I)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function TS(y,w){y&Ee?(this.primaryTouch=w.changedPointers[0].identifier,lg.call(this,w)):y&(Se|Ge)&&lg.call(this,w)}function lg(y){var w=y.changedPointers[0];if(w.identifier===this.primaryTouch){var R={x:w.clientX,y:w.clientY};this.lastTouches.push(R);var I=this.lastTouches,D=function(){var H=I.indexOf(R);H>-1&&I.splice(H,1)};setTimeout(D,vS)}}function wS(y){for(var w=y.srcEvent.clientX,R=y.srcEvent.clientY,I=0;I<this.lastTouches.length;I++){var D=this.lastTouches[I],H=Math.abs(w-D.x),Q=Math.abs(R-D.y);if(H<=ag&&Q<=ag)return!0}return!1}var cg=X(o.style,"touchAction"),ug=cg!==i,hg="compute",fg="auto",hu="manipulation",cr="none",os="pan-x",as="pan-y",qo=SS();function fu(y,w){this.manager=y,this.set(w)}fu.prototype={set:function(y){y==hg&&(y=this.compute()),ug&&this.manager.element.style&&qo[y]&&(this.manager.element.style[cg]=y),this.actions=y.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var y=[];return d(this.manager.recognizers,function(w){E(w.options.enable,[w])&&(y=y.concat(w.getTouchAction()))}),ES(y.join(" "))},preventDefaults:function(y){var w=y.srcEvent,R=y.offsetDirection;if(this.manager.session.prevented){w.preventDefault();return}var I=this.actions,D=N(I,cr)&&!qo[cr],H=N(I,as)&&!qo[as],Q=N(I,os)&&!qo[os];if(D){var Pe=y.pointers.length===1,Oe=y.distance<2,Xe=y.deltaTime<250;if(Pe&&Oe&&Xe)return}if(!(Q&&H)&&(D||H&&R&Bt||Q&&R&lr))return this.preventSrc(w)},preventSrc:function(y){this.manager.session.prevented=!0,y.preventDefault()}};function ES(y){if(N(y,cr))return cr;var w=N(y,os),R=N(y,as);return w&&R?cr:w||R?w?os:as:N(y,hu)?hu:fg}function SS(){if(!ug)return!1;var y={},w=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(R){y[R]=w?e.CSS.supports("touch-action",R):!0}),y}var Zo=1,_t=2,Kr=4,Rn=8,sn=Rn,ls=16,Ut=32;function on(y){this.options=v({},this.defaults,y||{}),this.id=Je(),this.manager=null,this.options.enable=b(this.options.enable,!0),this.state=Zo,this.simultaneous={},this.requireFail=[]}on.prototype={defaults:{},set:function(y){return v(this.options,y),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(y){if(f(y,"recognizeWith",this))return this;var w=this.simultaneous;return y=Qo(y,this),w[y.id]||(w[y.id]=y,y.recognizeWith(this)),this},dropRecognizeWith:function(y){return f(y,"dropRecognizeWith",this)?this:(y=Qo(y,this),delete this.simultaneous[y.id],this)},requireFailure:function(y){if(f(y,"requireFailure",this))return this;var w=this.requireFail;return y=Qo(y,this),z(w,y)===-1&&(w.push(y),y.requireFailure(this)),this},dropRequireFailure:function(y){if(f(y,"dropRequireFailure",this))return this;y=Qo(y,this);var w=z(this.requireFail,y);return w>-1&&this.requireFail.splice(w,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(y){return!!this.simultaneous[y.id]},emit:function(y){var w=this,R=this.state;function I(D){w.manager.emit(D,y)}R<Rn&&I(w.options.event+dg(R)),I(w.options.event),y.additionalEvent&&I(y.additionalEvent),R>=Rn&&I(w.options.event+dg(R))},tryEmit:function(y){if(this.canEmit())return this.emit(y);this.state=Ut},canEmit:function(){for(var y=0;y<this.requireFail.length;){if(!(this.requireFail[y].state&(Ut|Zo)))return!1;y++}return!0},recognize:function(y){var w=v({},y);if(!E(this.options.enable,[this,w])){this.reset(),this.state=Ut;return}this.state&(sn|ls|Ut)&&(this.state=Zo),this.state=this.process(w),this.state&(_t|Kr|Rn|ls)&&this.tryEmit(w)},process:function(y){},getTouchAction:function(){},reset:function(){}};function dg(y){return y&ls?"cancel":y&Rn?"end":y&Kr?"move":y&_t?"start":""}function pg(y){return y==ss?"down":y==is?"up":y==ns?"left":y==rs?"right":""}function Qo(y,w){var R=w.manager;return R?R.get(y):y}function bt(){on.apply(this,arguments)}g(bt,on,{defaults:{pointers:1},attrTest:function(y){var w=this.options.pointers;return w===0||y.pointers.length===w},process:function(y){var w=this.state,R=y.eventType,I=w&(_t|Kr),D=this.attrTest(y);return I&&(R&Ge||!D)?w|ls:I||D?R&Se?w|Rn:w&_t?w|Kr:_t:Ut}});function Jo(){bt.apply(this,arguments),this.pX=null,this.pY=null}g(Jo,bt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Jp},getTouchAction:function(){var y=this.options.direction,w=[];return y&Bt&&w.push(as),y&lr&&w.push(os),w},directionTest:function(y){var w=this.options,R=!0,I=y.distance,D=y.direction,H=y.deltaX,Q=y.deltaY;return D&w.direction||(w.direction&Bt?(D=H===0?Ho:H<0?ns:rs,R=H!=this.pX,I=Math.abs(y.deltaX)):(D=Q===0?Ho:Q<0?is:ss,R=Q!=this.pY,I=Math.abs(y.deltaY))),y.direction=D,R&&I>w.threshold&&D&w.direction},attrTest:function(y){return bt.prototype.attrTest.call(this,y)&&(this.state&_t||!(this.state&_t)&&this.directionTest(y))},emit:function(y){this.pX=y.deltaX,this.pY=y.deltaY;var w=pg(y.direction);w&&(y.additionalEvent=this.options.event+w),this._super.emit.call(this,y)}});function du(){bt.apply(this,arguments)}g(du,bt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[cr]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.scale-1)>this.options.threshold||this.state&_t)},emit:function(y){if(y.scale!==1){var w=y.scale<1?"in":"out";y.additionalEvent=this.options.event+w}this._super.emit.call(this,y)}});function pu(){on.apply(this,arguments),this._timer=null,this._input=null}g(pu,on,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[fg]},process:function(y){var w=this.options,R=y.pointers.length===w.pointers,I=y.distance<w.threshold,D=y.deltaTime>w.time;if(this._input=y,!I||!R||y.eventType&(Se|Ge)&&!D)this.reset();else if(y.eventType&Ee)this.reset(),this._timer=h(function(){this.state=sn,this.tryEmit()},w.time,this);else if(y.eventType&Se)return sn;return Ut},reset:function(){clearTimeout(this._timer)},emit:function(y){this.state===sn&&(y&&y.eventType&Se?this.manager.emit(this.options.event+"up",y):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function gu(){bt.apply(this,arguments)}g(gu,bt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[cr]},attrTest:function(y){return this._super.attrTest.call(this,y)&&(Math.abs(y.rotation)>this.options.threshold||this.state&_t)}});function _u(){bt.apply(this,arguments)}g(_u,bt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Bt|lr,pointers:1},getTouchAction:function(){return Jo.prototype.getTouchAction.call(this)},attrTest:function(y){var w=this.options.direction,R;return w&(Bt|lr)?R=y.overallVelocity:w&Bt?R=y.overallVelocityX:w&lr&&(R=y.overallVelocityY),this._super.attrTest.call(this,y)&&w&y.offsetDirection&&y.distance>this.options.threshold&&y.maxPointers==this.options.pointers&&c(R)>this.options.velocity&&y.eventType&Se},emit:function(y){var w=pg(y.offsetDirection);w&&this.manager.emit(this.options.event+w,y),this.manager.emit(this.options.event,y)}});function Go(){on.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}g(Go,on,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[hu]},process:function(y){var w=this.options,R=y.pointers.length===w.pointers,I=y.distance<w.threshold,D=y.deltaTime<w.time;if(this.reset(),y.eventType&Ee&&this.count===0)return this.failTimeout();if(I&&D&&R){if(y.eventType!=Se)return this.failTimeout();var H=this.pTime?y.timeStamp-this.pTime<w.interval:!0,Q=!this.pCenter||Xo(this.pCenter,y.center)<w.posThreshold;this.pTime=y.timeStamp,this.pCenter=y.center,!Q||!H?this.count=1:this.count+=1,this._input=y;var Pe=this.count%w.taps;if(Pe===0)return this.hasRequireFailures()?(this._timer=h(function(){this.state=sn,this.tryEmit()},w.interval,this),_t):sn}return Ut},failTimeout:function(){return this._timer=h(function(){this.state=Ut},this.options.interval,this),Ut},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==sn&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function an(y,w){return w=w||{},w.recognizers=b(w.recognizers,an.defaults.preset),new mu(y,w)}an.VERSION="2.0.7",an.defaults={domEvents:!1,touchAction:hg,enable:!0,inputTarget:null,inputClass:null,preset:[[gu,{enable:!1}],[du,{enable:!1},["rotate"]],[_u,{direction:Bt}],[Jo,{direction:Bt},["swipe"]],[Go],[Go,{event:"doubletap",taps:2},["tap"]],[pu]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var AS=1,gg=2;function mu(y,w){this.options=v({},an.defaults,w||{}),this.options.inputTarget=this.options.inputTarget||y,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=y,this.input=eS(this),this.touchAction=new fu(this,this.options.touchAction),_g(this,!0),d(this.options.recognizers,function(R){var I=this.add(new R[0](R[1]));R[2]&&I.recognizeWith(R[2]),R[3]&&I.requireFailure(R[3])},this)}mu.prototype={set:function(y){return v(this.options,y),y.touchAction&&this.touchAction.update(),y.inputTarget&&(this.input.destroy(),this.input.target=y.inputTarget,this.input.init()),this},stop:function(y){this.session.stopped=y?gg:AS},recognize:function(y){var w=this.session;if(!w.stopped){this.touchAction.preventDefaults(y);var R,I=this.recognizers,D=w.curRecognizer;(!D||D&&D.state&sn)&&(D=w.curRecognizer=null);for(var H=0;H<I.length;)R=I[H],w.stopped!==gg&&(!D||R==D||R.canRecognizeWith(D))?R.recognize(y):R.reset(),!D&&R.state&(_t|Kr|Rn)&&(D=w.curRecognizer=R),H++}},get:function(y){if(y instanceof on)return y;for(var w=this.recognizers,R=0;R<w.length;R++)if(w[R].options.event==y)return w[R];return null},add:function(y){if(f(y,"add",this))return this;var w=this.get(y.options.event);return w&&this.remove(w),this.recognizers.push(y),y.manager=this,this.touchAction.update(),y},remove:function(y){if(f(y,"remove",this))return this;if(y=this.get(y),y){var w=this.recognizers,R=z(w,y);R!==-1&&(w.splice(R,1),this.touchAction.update())}return this},on:function(y,w){if(y!==i&&w!==i){var R=this.handlers;return d(k(y),function(I){R[I]=R[I]||[],R[I].push(w)}),this}},off:function(y,w){if(y!==i){var R=this.handlers;return d(k(y),function(I){w?R[I]&&R[I].splice(z(R[I],w),1):delete R[I]}),this}},emit:function(y,w){this.options.domEvents&&RS(y,w);var R=this.handlers[y]&&this.handlers[y].slice();if(!(!R||!R.length)){w.type=y,w.preventDefault=function(){w.srcEvent.preventDefault()};for(var I=0;I<R.length;)R[I](w),I++}},destroy:function(){this.element&&_g(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function _g(y,w){var R=y.element;if(R.style){var I;d(y.options.cssProps,function(D,H){I=X(R.style,H),w?(y.oldCssProps[I]=R.style[I],R.style[I]=D):R.style[I]=y.oldCssProps[I]||""}),w||(y.oldCssProps={})}}function RS(y,w){var R=n.createEvent("Event");R.initEvent(y,!0,!0),R.gesture=w,w.target.dispatchEvent(R)}v(an,{INPUT_START:Ee,INPUT_MOVE:ar,INPUT_END:Se,INPUT_CANCEL:Ge,STATE_POSSIBLE:Zo,STATE_BEGAN:_t,STATE_CHANGED:Kr,STATE_ENDED:Rn,STATE_RECOGNIZED:sn,STATE_CANCELLED:ls,STATE_FAILED:Ut,DIRECTION_NONE:Ho,DIRECTION_LEFT:ns,DIRECTION_RIGHT:rs,DIRECTION_UP:is,DIRECTION_DOWN:ss,DIRECTION_HORIZONTAL:Bt,DIRECTION_VERTICAL:lr,DIRECTION_ALL:Jp,Manager:mu,Input:gt,TouchAction:fu,TouchInput:Ko,MouseInput:Yo,PointerEventInput:cu,TouchMouseInput:uu,SingleTouchInput:og,Recognizer:on,AttrRecognizer:bt,Tap:Go,Pan:Jo,Swipe:_u,Pinch:du,Rotate:gu,Press:pu,on:x,off:O,each:d,merge:p,extend:A,assign:v,inherit:g,bindFn:m,prefixed:X});var bS=typeof e<"u"?e:typeof self<"u"?self:{};bS.Hammer=an,typeof i=="function"&&i.amd?i(function(){return an}):t.exports?t.exports=an:e[r]=an})(window,document,"Hammer")})(dE);var jo=dE.exports;const tk=bd(jo),Ht=xS({__proto__:null,default:tk},[jo]),pE=1,gE=2,ed=4,nk={mousedown:pE,mousemove:gE,mouseup:ed};function rk(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function ik(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(rk(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function sk(t){t.prototype.handler=function(n){let r=nk[n.type];r&pE&&n.button>=0&&(this.pressed=!0),r&gE&&n.which===0&&(r=ed),this.pressed&&(r&ed&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}ik(jo.PointerEventInput);sk(jo.MouseInput);const ok=jo.Manager;class iu{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const ak=Ht?[[Ht.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[Ht.Rotate,{enable:!1}],[Ht.Pinch,{enable:!1}],[Ht.Swipe,{enable:!1}],[Ht.Pan,{threshold:0,enable:!1}],[Ht.Press,{enable:!1}],[Ht.Tap,{event:"doubletap",taps:2,enable:!1}],[Ht.Tap,{event:"anytap",enable:!1}],[Ht.Tap,{enable:!1}]]:null,py={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},lk={doubletap:["tap"]},ck={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},$p={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},uk={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},gy={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},hk=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",wi=typeof window<"u"?window:global;let td=!1;try{const t={get passive(){return td=!0,!0}};wi.addEventListener("test",null,t),wi.removeEventListener("test",null)}catch{td=!1}const fk=hk.indexOf("firefox")!==-1,{WHEEL_EVENTS:dk}=$p,_y="wheel",my=4.000244140625,pk=40,gk=.25;class _k extends iu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;wi.WheelEvent&&(fk&&i.deltaMode===wi.WheelEvent.DOM_DELTA_PIXEL&&(s/=wi.devicePixelRatio),i.deltaMode===wi.WheelEvent.DOM_DELTA_LINE&&(s*=pk)),s!==0&&s%my===0&&(s=Math.floor(s/my)),i.shiftKey&&s&&(s=s*gk),this.callback({type:_y,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(dk),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,td?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===_y&&(this.options.enable=n)}}const{MOUSE_EVENTS:mk}=$p,yy="pointermove",vy="pointerover",Ty="pointerout",wy="pointerenter",Ey="pointerleave";class yk extends iu{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(mk),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===yy&&(this.enableMoveEvent=n),e===vy&&(this.enableOverEvent=n),e===Ty&&(this.enableOutEvent=n),e===wy&&(this.enableEnterEvent=n),e===Ey&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(vy,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(Ty,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(wy,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(Ey,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.which===0&&(this.pressed=!1),this.pressed||this._emit(yy,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:vk}=$p,Sy="keydown",Ay="keyup";class Tk extends iu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:Sy,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:Ay,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(vk),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===Sy&&(this.enableDownEvent=n),e===Ay&&(this.enableUpEvent=n)}}const Ry="contextmenu";class wk extends iu{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:Ry,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===Ry&&(this.options.enable=n)}}const nd=1,Hl=2,rd=4,Ek={pointerdown:nd,pointermove:Hl,pointerup:rd,mousedown:nd,mousemove:Hl,mouseup:rd},Sk=1,Ak=2,Rk=3,bk=0,Ck=1,Pk=2,xk=1,Mk=2,Ik=4;function Ok(t){const e=Ek[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r,which:i}=t.srcEvent;let s=!1,o=!1,a=!1;return e===rd||e===Hl&&!Number.isFinite(n)?(s=i===Sk,o=i===Ak,a=i===Rk):e===Hl?(s=!!(n&xk),o=!!(n&Ik),a=!!(n&Mk)):e===nd&&(s=r===bk,o=r===Ck,a=r===Pk),{leftButton:s,middleButton:o,rightButton:a}}function Nk(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const vh={srcElement:"root",priority:0};class kk{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=vh;typeof r=="string"||r&&r.addEventListener?l={...vh,srcElement:r}:r&&(l={...vh,...r});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let h=c.length-1;for(;h>=0&&!(c[h].priority>=u.priority);)h--;c.splice(h+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:h}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),h&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...Ok(e),...Nk(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const Fk={events:null,recognizers:null,recognizerOptions:{},Manager:ok,touchAction:"none",tabIndex:0};class Dk{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=ck[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...Fk,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||ak}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(py).forEach(i=>{const s=this.manager.get(i);s&&py[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new _k(e,this._onOtherEvent,{enable:!1}),this.moveInput=new yk(e,this._onOtherEvent,{enable:!1}),this.keyInput=new Tk(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new wk(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=lk[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,l=gy[e]||e;let c=a.get(l);c||(c=new kk(this),a.set(l,c),c.recognizerName=uk[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,r,i,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=gy[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Mn(){}const Bk=({isDragging:t})=>t?"grabbing":"grab",by={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Mn,onWebGLInitialized:Mn,onResize:Mn,onViewStateChange:Mn,onInteractionStateChange:Mn,onBeforeRender:Mn,onAfterRender:Mn,onLoad:Mn,onError:t=>ne.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:Bk,getTooltip:null,debug:!1,drawPickingColors:!1},gc=class gc{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Kc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=jf[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i.handler]||l.props[i.handler]),u=this.props[i.handler];let h=!1;c&&(h=c.call(l,a,r)),h||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={...by,...e},e=this.props,e.viewState&&e.initialViewState&&ne.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device?this.device=e.device:e.gl&&(e.gl instanceof WebGLRenderingContext&&ne.error("WebGL1 context not supported.")(),this.device=Ys.attach(e.gl));let n=this.device;n||(br.registerDevices([Ys]),n=br.createDevice({...e.deviceProps,canvas:this._createCanvas(e)}),n.then(r=>{this.device=r})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&qi.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ne.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ne.removed("onLayerClick","onClick")(),e.initialViewState&&!ut(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Fe(this.viewManager),this.viewManager.views}getViewports(e){return Fe(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Fe(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Fe(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new oI({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState||{}}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new Zf({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const c of s)a=c,l=((n=c.layer)==null?void 0:n.onHover(c,e.event))||l;l||((i=(r=this.props).onHover)==null||i.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Ys&&this.props.onWebGLInitialized(this.device.gl);const n=new Kw;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new Dk(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in jf)this.eventManager.on(o,this._onEvent);this.viewManager=new AI({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new SI(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new LI({deck:this,device:this.device}),this.deckRenderer=new jI(this.device),this.deckPicker=new KI(this.device),this.widgetManager=new QI({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new GI),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ne.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=br.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}};gc.defaultProps=by,gc.VERSION=t3;let $l=gc;function Uk(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return _w(t)}}const Lk=gw;function Ma(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function wr(t){return t.stride||t.size*t.bytesPerElement}function zk(t,e){return t.type===e.type&&t.size===e.size&&wr(t)===wr(e)&&(t.offset||0)===(e.offset||0)}function id(t,e){e.offset&&ne.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=wr(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function Vk(t,e){const n=id(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class jk{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=Uk(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*wr(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),qi.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=id(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:wr(r),attributes:i};if(this.doublePrecision){const o=Vk(r,n||{});i.push(Ma(e,{...r,...o.high}),Ma(`${e}64Low`,{...r,...o.low}))}else if(n){const o=id(r,n);i.push(Ma(e,{...r,...o}))}else i.push(Ma(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof de?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=Lk(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=wr(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=wr(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=oh(s,i)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?oh(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=qi.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?oh(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ne.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:n?de.INDEX:de.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const Cy=[],Py=[];function Wo(t,e=0,n=1/0){let r=Cy;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(Py.length=t.length,r=Py):r=Cy,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function _E(t){return t&&t[Symbol.asyncIterator]}function mE(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(h,{index:f,target:d})=>{if(!s){const p=f*l+c;for(let g=0;g<n;g++)d[g]=t[p+g];return d}const _=s[f],v=s[f+1]||u;let A;if(o){A=new Array(v-_);for(let p=_;p<v;p++){const g=p*l+c;d=new Array(n);for(let m=0;m<n;m++)d[m]=t[g+m];A[p-_]=d}}else if(l===n)A=t.subarray(_*n+c,v*n+c);else{A=new t.constructor((v-_)*n);let p=0;for(let g=_;g<v;g++){const m=g*l+c;for(let E=0;E<n;E++)A[p++]=t[m+E]}}return A}}const Wk=[],Za=[[0,1/0]];function Hk(t,e){if(t===Za||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const $k={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function yE(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...$k[n],...e,...t,type:n}}class vE extends jk{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Za}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!zk(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return yE(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=Hk(this.state.updateRanges,[r,i])}else this.state.updateRanges=Za}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=Wk}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Za),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const h=Number.isFinite(c)?this.getVertexOffset(c):0,f=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:h,endOffset:f})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Fe(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=mE(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(){this.state.layoutChanged=!1;const e=this.settings.shaderAttributes,n=super.getBufferLayout();if(!e)return n;for(const r in e){const i=super.getBufferLayout(r,e[r]);n.attributes.push(...i.attributes)}return n}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:h}=e,{accessor:f,transform:d}=a,_=l.binaryAccessor||(typeof f=="function"?f:s[f]);Fe(typeof _=="function",`accessor "${f}" is not a function`);let v=e.getVertexOffset(r);const{iterable:A,objectInfo:p}=Wo(n,r,i);for(const g of A){p.index++;let m=_(g,p);if(d&&(m=d.call(this,m)),h){const E=(p.index<h.length-1?h[p.index+1]:o)-h[p.index];if(m&&Array.isArray(m[0])){let b=v;for(const x of m)e._normalizeValue(x,c,b),b+=u}else m&&m.length>u?c.set(m,v):(e._normalizeValue(m,p.target,0),yI({target:c,source:p.target,start:v,count:E}));v+=E*u}else e._normalizeValue(m,c,v),v+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function Th(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let h=0;h<i;h++)n[r+c]=u[h]||0,c++}}function Xk({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return Th({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,h)=>r(u+a,h)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const h=i[u]*n,f=s[u]*n;Th({source:t.subarray(o,h),target:e,start:a,end:f,size:n,getData:l}),o=h,a=f}return a<e.length&&Th({source:[],target:e,start:a,size:n,getData:l}),e}function Yk(t){const{device:e,settings:n,value:r}=t,i=new vE(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function TE(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function wE(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function EE(t){t.push(t.shift())}function Kk(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function SE({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function AE({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,h=n.startIndices,f=s&&h,d=n.isConstant;if(!f&&e&&r>=i)return e;const _=n.value instanceof Float64Array?Float32Array:n.value.constructor,v=d?n.value:new _(n.getBuffer().readSyncWebGL(c,i*_.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!d){const m=o;o=(E,b)=>n.normalizeConstant(m(E,b))}const A=d?(m,E)=>o(v,E):(m,E)=>o(v.subarray(m+c,m+c+l),E),p=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),g=new Float32Array(i);return Xk({source:p,target:g,sourceStartIndices:s,targetStartIndices:h,size:l,getData:A}),(!e||e.byteLength<g.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:g.byteLength+u,usage:35050})),e.write(g,u),e}class RE{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new tu(r),this.attribute=n,this.attributeInTransition=Yk(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=Kk(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class qk extends RE{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=Qk(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;EE(s),s[0]=AE({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=SE({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;l.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform;s.setUniforms({time:i}),s.device.gl.bindBuffer(34962,null),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const Zk=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

uniform float time;
in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, time);
  gl_Position = vec4(0.0);
}
`;function Qk(t,e){const n=TE(e.size);return new eu(t,{vs:Zk,bufferLayout:[{name:"aFrom",format:wE(e.size)},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],defines:{ATTRIBUTE_TYPE:n},varyings:["vCurrent"]})}class Jk extends RE{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=nF(e),this.framebuffer=rF(e,this.texture),this.transform=tF(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=AE({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=SE({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]}),n.model.setUniforms({stiffness:s.stiffness,damping:s.damping}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),EE(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const Gk=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

uniform float stiffness;
uniform float damping;
in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE spring = delta * stiffness;
  ATTRIBUTE_TYPE damper = velocity * -1.0 * damping;
  return spring + damper + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,eF=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function tF(t,e){const n=TE(e.size),r=wE(e.size);return new eu(t,{vs:Gk,fs:eF,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function nF(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function rF(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const iF={interpolation:qk,spring:Jk};class sF{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=iF[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(ne.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const xy="attributeManager.invalidate",oF="attributeManager.updateStart",aF="attributeManager.updateEnd",lF="attribute.updateStart",cF="attribute.allocate",uF="attribute.updateEnd";class hF{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=Lo(MM),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new sF(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{instanced:1})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);We(xy,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);We(xy,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;We(oF,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],h=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&ne.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof h=="string"?o[h]:void 0,e.startIndices)||typeof h=="string"&&!o[h]&&u.setConstantValue(s[h])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&We(aF,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e,n={}){e||(e=this.getAttributes());const r=[];for(const i in e)n[i]||r.push(e[i].getBufferLayout());return r}_add(e,n={}){for(const r in e){const i=e[r];this.attributes[r]=this._createAttribute(r,i,n)}this._mapUpdateTriggersToAttributes()}_createAttribute(e,n,r){const i={...n,id:e,size:n.isIndexed&&1||n.size||1,divisor:r.instanced?1:n.divisor||0};return new vE(this.device,i)}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if(We(lF,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&We(cF,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,We(uF,n,r))}}class fF extends tu{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=To(n,r,o)}}const My=1e-5;function Iy(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function dF(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Iy(t[o],e[o],n[o],r,i);return s}return Iy(t,e,n,r,i)}function Oy(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class pF extends tu{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=dF(s,o,n,r,i);const l=Oy(a,n),c=Oy(a,o);l<My&&c<My&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const gF={interpolation:fF,spring:pF};class _F{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=yE(i),!i)return;const o=gF[i.type];if(!o){ne.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function mF(t){const e=t[Qn];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function yF(t,e){const n=bE({newProps:t,oldProps:e,propTypes:t[Qn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=TF(t,e);let i=!1;return r||(i=wF(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:EF(t,e),transitionsChanged:vF(t,e)}}function vF(t,e){if(!t.transitions)return!1;const n={},r=t[Qn];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&sd(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function bE({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=sd(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=sd(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function sd(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function TF(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function wF(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&Ny(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&Ny(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function EF(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function Ny(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},bE({oldProps:i,newProps:r,triggerName:n})}const SF="count(): argument not an object",AF="count(): argument not a container";function RF(t){if(!CF(t))throw new Error(SF);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(bF(t))return Object.keys(t).length;throw new Error(AF)}function bF(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function CF(t){return t!==null&&typeof t=="object"}function ky(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const PF={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},od={};function xF(t,e,n,r){if(n instanceof Tt)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...PF,...i,...r}});return od[s.id]=t,s}function MF(t,e){!e||!(e instanceof Tt)||od[e.id]===t&&(e.delete(),delete od[e.id])}const IF={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||ad(t)&&(t.length===3||t.length===4)},equal(t,e,n){return ut(t,e,1)}},accessor:{validate(t,e){const n=Xl(t);return n==="function"||n===Xl(e.value)},equal(t,e,n){return typeof e=="function"?!0:ut(t,e,1)}},array:{validate(t,e){return e.optional&&!t||ad(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?ut(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?ut(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:xF(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{MF(n.id,t)}}};function OF(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=NF(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function NF(t,e){switch(Xl(e)){case"object":return Ss(t,e);case"array":return Ss(t,{type:"array",value:e,compare:!1});case"boolean":return Ss(t,{type:"boolean",value:e});case"number":return Ss(t,{type:"number",value:e});case"function":return Ss(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function Ss(t,e){return"type"in e?{name:t,...IF[e.type],...e}:"value"in e?{name:t,type:Xl(e.value),...e}:{name:t,type:"object",value:e}}function ad(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Xl(t){return ad(t)?"array":t===null?"null":typeof t}function kF(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=ld(t.constructor,n),i=Object.create(r);i[jl]=t,i[Dr]={},i[zn]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const FF="_mergedDefaultProps";function ld(t,e){let n=FF;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=CE(t,n);return r||(t[n]=DF(t,e||[]))}function DF(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=ld(r),s=CE(t,"defaultProps")||{},o=OF(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[Qn],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[ch],o.deprecatedProps);for(const u of e){const h=ld(u.constructor);h&&(Object.assign(a,h),Object.assign(l,h[Qn]),Object.assign(c,h[ch]))}return BF(a,t),LF(a,l),UF(a,c),a[Qn]=l,a[ch]=c,e.length===0&&!Xp(t,"_propTypes")&&(t._propTypes=l),a}function BF(t,e){const n=VF(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function UF(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])Xp(this,s)||(this[s]=r);ne.deprecated(i,e[n].join("/"))()}})}function LF(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=zF(o))}t[Ii]=n,t[Dr]={},Object.defineProperties(t,r)}function zF(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||_E(e)?this[Dr][t]=e:this[zn][t]=e},get(){if(this[zn]){if(t in this[zn])return this[zn][t]||this[Ii][t];if(t in this[Dr]){const e=this[jl]&&this[jl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Ii][t]}}return this[Ii][t]}}}function Xp(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function CE(t,e){return Xp(t,e)&&t[e]}function VF(t){const e=t.componentName;return e||ne.warn(`${t.name}.componentName not specified`)(),e||t.name}let jF=0;const _c=class _c{constructor(...e){this.props=kF(this,e),this.id=this.props.id,this.count=jF++}clone(e){const{props:n}=this,r={};for(const i in n[Ii])i in n[zn]?r[i]=n[zn][i]:i in n[Dr]&&(r[i]=n[Dr][i]);return new this.constructor({...n,...r,...e})}};_c.componentName="Component",_c.defaultProps={};let cd=_c;const WF=Object.freeze({});class HF{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||WF}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[jl]||this.component;const n=e[zn]||{},r=e[Dr]||e,i=e[Ii]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(_E(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Qn];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class $F extends HF{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const XF="layer.changeFlag",YF="layer.initialize",KF="layer.update",qF="layer.finalize",ZF="layer.matched",Fy=2**24-1,QF=Object.freeze([]),JF=Lo(({oldViewport:t,viewport:e})=>t.equals(e));let $t=new Uint8ClampedArray(0);const GF={data:{type:"data",value:QF,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:Cl(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):Cl(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:ee.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},mc=class mc extends cd{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ri.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Fe(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=Yw(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=Vw(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Fe(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Fe(this.internalState);const r=this.internalState.viewport||this.context.viewport;return DM(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===ee.DEFAULT||e===ee.LNGLAT||e===ee.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Fe(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:RF(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=ky(e,{modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=ky(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!JF({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor($t.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>Fy&&ne.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),$t=qi.allocate($t,n,{size:4,copy:!0,maxCount:Math.max(n,Fy)});const i=Math.floor($t.length/4),s=[];for(let o=r;o<i;o++)this.encodePickingColor(o,s),$t[o*4+0]=s[0],$t[o*4+1]=s[1],$t[o*4+2]=s[2]}e.value=$t.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts()),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const c=n[l].getValue();for(const u in c){const h=c[u];h instanceof de?n[l].settings.isIndexed?e.setIndexBuffer(h):s[u]=h:h&&(o[u]=h)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==$t.buffer&&(r.value=$t.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Fe(!this.internalState),Fe(Number.isFinite(this.props.coordinateSystem)),We(YF,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new $F({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ne.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new _F(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){We(ZF,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if(We(KF,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){We(qF,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=this.props.opacity;r.opacity=Math.pow(a,1/2.2);try{if(n){const{isActive:u,isAttribute:h}=n.picking;this.setModuleParameters(n),this.setShaderModuleProps({picking:{isActive:u,isAttribute:h}})}const{getPolygonOffset:l}=this.props,c=l&&l(r)||[0,0];o.device.setParametersWebGL({polygonOffset:c});for(const u of this.getModels())u.setParameters(i);o.device.withParametersWebGL(i,()=>{const u={renderPass:e,moduleParameters:n,uniforms:r,parameters:i,context:o};for(const h of this.props.extensions)h.draw.call(this,u,h);this.draw(u)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&We(XF,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=yF(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){mF(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new hF(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e;this.setNeedsRedraw(),this._updateAttributes();const s=this.state.model;s==null||s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};o||(c.highlightedObjectColor=null),Array.isArray(l)&&(c.highlightColor=l),(n||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};mc.defaultProps=GF,mc.layerName="Layer";let Sn=mc;const eD="compositeLayer.renderLayers",qp=class qp extends Sn{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var O;const{opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:_,extensions:v,fetch:A,operation:p,_subLayerProps:g}=this.props,m={id:"",updateTriggers:{},opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:h,wrapLongitude:f,positionFormat:d,modelMatrix:_,extensions:v,fetch:A,operation:p},E=g&&e.id&&g[e.id],b=E&&E.updateTriggers,x=e.id||"sublayer";if(E){const M=this.props[Qn],N=e.type?e.type._propTypes:{};for(const k in E){const z=N[k]||M[k];z&&z.type==="accessor"&&(E[k]=this.getSubLayerAccessor(E[k]))}}Object.assign(m,e,E),m.id=`${this.props.id}-${x}`,m.updateTriggers={all:(O=this.props.updateTriggers)==null?void 0:O.all,...e.updateTriggers,...b};for(const M of v){const N=M.getSubLayerProps.call(this,M);N&&Object.assign(m,N,{updateTriggers:Object.assign(m.updateTriggers,N.updateTriggers)})}return m}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=Lp(s,Boolean),this.internalState.subLayers=r}We(eD,this,i,r);for(const s of r)s.parent=this}};qp.layerName="CompositeLayer";let Ji=qp;const yc=class yc{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&ut(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,r={updateTriggers:{}};for(const i in n)if(i in this.props){const s=n[i],o=this.props[i];r[i]=o,s&&s.type==="accessor"&&(r.updateTriggers[i]=this.props.updateTriggers[i],typeof o=="function"&&(r[i]=this.getSubLayerAccessor(o)))}return r}initializeState(e,n){}updateState(e,n){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,n){}finalizeState(e,n){}};yc.defaultProps={},yc.extensionName="LayerExtension";let ud=yc;const wh={bearing:0,pitch:0,position:[0,0,0]},tD={speed:1.2,curve:1.414};class Dy extends Qw{constructor(e={}){super({compare:["longitude","latitude","zoom","bearing","pitch","position"],extract:["width","height","longitude","latitude","zoom","bearing","pitch","position"],required:["width","height","latitude","longitude","zoom"]}),this.opts={...tD,...e}}interpolateProps(e,n,r){const i=G2(e,n,r,this.opts);for(const s in wh)i[s]=To(e[s]||wh[s],n[s]||wh[s],r);return i}getDuration(e,n){let{transitionDuration:r}=n;return r==="auto"&&(r=eM(e,n,this.opts)),r}}class PE{constructor(e){this.indexStarts=[0],this.vertexStarts=[0],this.vertexCount=0,this.instanceCount=0;const{attributes:n={}}=e;this.typedArrayManager=qi,this.attributes={},this._attributeDefs=n,this.opts=e,this.updateGeometry(e)}updateGeometry(e){Object.assign(this.opts,e);const{data:n,buffers:r={},getGeometry:i,geometryBuffer:s,positionFormat:o,dataChanged:a,normalize:l=!0}=this.opts;if(this.data=n,this.getGeometry=i,this.positionSize=s&&s.size||(o==="XY"?2:3),this.buffers=r,this.normalize=l,s&&(Fe(n.startIndices),this.getGeometry=this.getGeometryFromBuffer(s),l||(r.vertexPositions=s)),this.geometryBuffer=r.vertexPositions,Array.isArray(a))for(const c of a)this._rebuildGeometry(c);else this._rebuildGeometry()}updatePartialGeometry({startRow:e,endRow:n}){this._rebuildGeometry({startRow:e,endRow:n})}getGeometryFromBuffer(e){const n=e.value||e;return ArrayBuffer.isView(n)?mE(n,{size:this.positionSize,offset:e.offset,stride:e.stride,startIndices:this.data.startIndices}):null}_allocate(e,n){const{attributes:r,buffers:i,_attributeDefs:s,typedArrayManager:o}=this;for(const a in s)if(a in i)o.release(r[a]),r[a]=null;else{const l=s[a];l.copy=n,r[a]=o.allocate(r[a],e,l)}}_forEachGeometry(e,n,r){const{data:i,getGeometry:s}=this,{iterable:o,objectInfo:a}=Wo(i,n,r);for(const l of o){a.index++;const c=s?s(l,a):null;e(c,a.index)}}_rebuildGeometry(e){if(!this.data)return;let{indexStarts:n,vertexStarts:r,instanceCount:i}=this;const{data:s,geometryBuffer:o}=this,{startRow:a=0,endRow:l=1/0}=e||{},c={};if(e||(n=[0],r=[0]),this.normalize||!o)this._forEachGeometry((h,f)=>{const d=h&&this.normalizeGeometry(h);c[f]=d,r[f+1]=r[f]+(d?this.getGeometrySize(d):0)},a,l),i=r[r.length-1];else if(r=s.startIndices,i=r[s.length]||0,ArrayBuffer.isView(o))i=i||o.length/this.positionSize;else if(o instanceof de){const h=this.positionSize*4;i=i||o.byteLength/h}else if(o.buffer){const h=o.stride||this.positionSize*4;i=i||o.buffer.byteLength/h}else if(o.value){const h=o.value,f=o.stride/h.BYTES_PER_ELEMENT||this.positionSize;i=i||h.length/f}this._allocate(i,!!e),this.indexStarts=n,this.vertexStarts=r,this.instanceCount=i;const u={};this._forEachGeometry((h,f)=>{const d=c[f]||h;u.vertexStart=r[f],u.indexStart=n[f];const _=f<r.length-1?r[f+1]:i;u.geometrySize=_-r[f],u.geometryIndex=f,this.updateGeometryAttributes(d,u)},a,l),this.vertexCount=n[n.length-1]}}const nD=typeof window<"u"?V.useLayoutEffect:V.useEffect,rD=nD;function Yl(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const iD={position:"absolute",zIndex:-1};function xE(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>xE(n,e));if(su(t)){if(sD(t))return e.style=iD,V.cloneElement(t,e);if(oD(t))return V.cloneElement(t,e)}return t}function su(t){return t&&typeof t=="object"&&"type"in t||!1}function sD(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function oD(t){const e=t.type;return e&&e.deckGLViewProps}function hd(t){if(typeof t=="function")return V.createElement(Qi,{},t);if(Array.isArray(t))return t.map(hd);if(su(t)){if(t.type===V.Fragment)return hd(t.props.children);if(Yl(t.type,Qi))return t}return t}function aD({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return V.Children.forEach(hd(t),o=>{if(su(o)){const a=o.type;if(Yl(a,Sn)){const l=lD(a,o.props);i.push(l)}else r.push(o);if(Yl(a,Qi)&&a!==Qi&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function lD(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function cD({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,l=o;su(o)&&Yl(o.type,Qi)&&(a=o.props.id||s,l=o.props.children);const c=r.getViewport(a),u=r.getViewState(a);if(c){u.padding=c.padding;const{x:h,y:f,width:d,height:_}=c;l=xE(l,{x:h,y:f,width:d,height:_,viewport:c,viewState:u}),i[a]||(i[a]={viewport:c,children:[]}),i[a].children.push(l)}}return Object.keys(i).map(o=>{const{viewport:a,children:l}=i[o],{x:c,y:u,width:h,height:f}=a,d={position:"absolute",left:c,top:u,width:h,height:f},_=`view-${o}`,v=V.createElement("div",{key:_,id:_,style:d},...l);if(n){const A={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:p=>{p.viewId=o,e._onViewStateChange(p)}};return V.createElement(n,{key:_,value:A},v)}return v})}const uD={mixBlendMode:null};function hD({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in uD?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function fD(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function ME(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function dD(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const s=r.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():ME(t)}});return r}const IE=V.forwardRef((t,e)=>{const[n,r]=V.useState(0),s=V.useRef({control:null,version:n,forceUpdate:()=>r(b=>b+1)}).current,o=V.useRef(null),a=V.useRef(null),l=V.useMemo(()=>aD(t),[t.layers,t.views,t.children]);let c=!0;const u=b=>{var x;return c&&t.viewState?(s.viewStateUpdateRequested=b,null):(s.viewStateUpdateRequested=null,(x=t.onViewStateChange)==null?void 0:x.call(t,b))},h=b=>{var x;c?s.interactionStateUpdateRequested=b:(s.interactionStateUpdateRequested=null,(x=t.onInteractionStateChange)==null||x.call(t,b))},f=V.useMemo(()=>{const b={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:h};return delete b._customRender,s.deck&&s.deck.setProps(b),b},[t]);V.useEffect(()=>{const b=t.Deck||$l;return s.deck=dD(s,b,{...f,parent:o.current,canvas:a.current}),()=>{var x;return(x=s.deck)==null?void 0:x.finalize()}},[]),rD(()=>{ME(s);const{viewStateUpdateRequested:b,interactionStateUpdateRequested:x}=s;b&&u(b),x&&h(x)}),V.useImperativeHandle(e,()=>fD(s),[]);const d=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:_,width:v,height:A,id:p,style:g}=t,{containerStyle:m,canvasStyle:E}=V.useMemo(()=>hD({width:v,height:A,style:g}),[v,A,g]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===d||s.version!==n){s.lastRenderedViewports=d,s.version=n;const b=cD({children:l.children,deck:s.deck,ContextProvider:_}),x=V.createElement("canvas",{key:"canvas",id:p||"deckgl-overlay",ref:a,style:E});s.control=V.createElement("div",{id:`${p||"deckgl"}-wrapper`,ref:o,style:m},[x,b])}return c=!1,s.control});IE.defaultProps=$l.defaultProps;const pD=IE,gD=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,_D=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * opacity * vColor.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,mD=1024,yD=4,By=()=>{},Uy={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},vD={x:0,y:0,width:0,height:0};function TD(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function wD(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{data:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{data:t.canvas,width:s,height:o})}function Eo(t){return t&&(t.id||t.url)}function ED(t,e,n,r){const{width:i,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:r}),l=o.createCommandEncoder();return l.copyTextureToTexture({source:t,destination:a,width:i,height:s}),l.finish(),t.destroy(),a}function Ly(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=Eo(i);t[o]={...i,x:s,y:n}}}function SD({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=Eo(c);if(!n[u]){const{height:h,width:f}=c;r+f+e>o&&(Ly(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:c,xOffset:r}),r=r+f+e,s=Math.max(s,h)}}return a.length>0&&Ly(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:TD(s+i+e)}}function AD(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=Wo(t);for(const o of i){s.index++;const a=e(o,s),l=Eo(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[l]&&(!n[l]||a.url!==n[l].url)&&(r[l]={...a,source:o,sourceIndex:s.index})}return r}class RD{constructor(e,{onUpdate:n=By,onError:r=By}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._textureParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=yD,this._canvasWidth=mD,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?Eo(e):e;return this._mapping[n]||vD}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),s&&(this._textureParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(AD(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=SD({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._textureParameters||Uy})),this._texture.height!==this._canvasHeight&&(this._texture=ED(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Uy)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Cl(r.url,this._loadOptions).then(i=>{const s=Eo(r),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{data:h,width:f,height:d}=wD(n,i,c,u);this._texture.setSubImageData({data:h,x:a+(c-f)/2,y:l+(u-d)/2,width:f,height:d}),o.width=f,o.height=d,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const OE=[0,0,0,255],bD={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:OE},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},vc=class vc extends Sn{getShaders(){return super.getShaders({vs:gD,fs:_D,modules:[zo,Vo]})}initializeState(){this.state={iconManager:new RD(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:OE},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var d;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:h}=this.state;if(typeof o=="string")return;const f=o||this.internalState.isAsyncPropLoading("iconAtlas");h.setProps({loadOptions:n.loadOptions,autoPacking:!f,iconAtlas:o,iconMapping:f?a:null,textureParameters:u}),f?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&h.packIcons(l,c),i.extensionsChanged&&((d=this.state.model)==null||d.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){const u=this.state.model;u.setBindings({iconsTexture:c}),u.setUniforms(e),u.setUniforms({iconsTextureDim:[c.width,c.height],sizeUnits:kr[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Ft(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Zi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const n=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;n?n(e):ne.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}};vc.defaultProps=bD,vc.layerName="IconLayer";let fd=vc;const CD=`#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
radiusMinPixels, radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
lineWidthMinPixels, lineWidthMaxPixels
);
outerRadiusPixels += stroked * lineWidthPixels / 2.0;
float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
if (billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,PD=`#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
uniform bool filled;
uniform float stroked;
uniform bool antialiasing;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (stroked > 0.5) {
float isLine = antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (filled) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (!filled) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,zy=[0,0,0,255],xD={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:t=>t.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:zy},getLineColor:{type:"accessor",value:zy},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},Tc=class Tc extends Sn{getShaders(){return super.getShaders({vs:CD,fs:PD,modules:[zo,Vo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var n;super.updateState(e),e.changeFlags.extensionsChanged&&((n=this.state.model)==null||n.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{radiusUnits:n,radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,stroked:o,filled:a,billboard:l,antialiasing:c,lineWidthUnits:u,lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}=this.props,_=this.state.model;_.setUniforms(e),_.setUniforms({stroked:o?1:0,filled:a,billboard:l,antialiasing:c,radiusUnits:kr[n],radiusScale:r,radiusMinPixels:i,radiusMaxPixels:s,lineWidthUnits:kr[u],lineWidthScale:h,lineWidthMinPixels:f,lineWidthMaxPixels:d}),_.draw(this.context.renderPass)}_getModel(){const e=[-1,-1,0,1,-1,0,-1,1,0,1,1,0];return new Ft(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Zi({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array(e)}}}),isInstanced:!0})}};Tc.defaultProps=xD,Tc.layerName="ScatterplotLayer";let dd=Tc;const NE={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function kE(t,e,n={}){return MD(t,n)!==e?(OD(t,n),!0):!1}function MD(t,e={}){return Math.sign(ID(t,e))}const Vy={x:0,y:1,z:2};function ID(t,e={}){const{start:n=0,end:r=t.length,plane:i="xy"}=e,s=e.size||2;let o=0;const a=Vy[i[0]],l=Vy[i[1]];for(let c=n,u=r-s;c<r;c+=s)o+=(t[c+a]-t[u+a])*(t[c+l]+t[u+l]),u=c;return o/2}function OD(t,e){const{start:n=0,end:r=t.length,size:i=2}=e,s=(r-n)/i,o=Math.floor(s/2);for(let a=0;a<o;++a){const l=n+a*i,c=n+(s-1-a)*i;for(let u=0;u<i;++u){const h=t[l+u];t[l+u]=t[c+u],t[c+u]=h}}}function Ot(t,e){const n=e.length,r=t.length;if(r>0){let i=!0;for(let s=0;s<n;s++)if(t[r-n+s]!==e[s]){i=!1;break}if(i)return!1}for(let i=0;i<n;i++)t[r+i]=e[i];return!0}function pd(t,e){const n=e.length;for(let r=0;r<n;r++)t[r]=e[r]}function So(t,e,n,r,i=[]){const s=r+e*n;for(let o=0;o<n;o++)i[o]=t[s+o];return i}function gd(t,e,n,r,i=[]){let s,o;if(n&8)s=(r[3]-t[1])/(e[1]-t[1]),o=3;else if(n&4)s=(r[1]-t[1])/(e[1]-t[1]),o=1;else if(n&2)s=(r[2]-t[0])/(e[0]-t[0]),o=2;else if(n&1)s=(r[0]-t[0])/(e[0]-t[0]),o=0;else return null;for(let a=0;a<t.length;a++)i[a]=(o&1)===a?r[o]:s*(e[a]-t[a])+t[a];return i}function Qa(t,e){let n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}function FE(t,e){const{size:n=2,broken:r=!1,gridResolution:i=10,gridOffset:s=[0,0],startIndex:o=0,endIndex:a=t.length}=e||{},l=(a-o)/n;let c=[];const u=[c],h=So(t,0,n,o);let f,d;const _=BE(h,i,s,[]),v=[];Ot(c,h);for(let A=1;A<l;A++){for(f=So(t,A,n,o,f),d=Qa(f,_);d;){gd(h,f,d,_,v);const p=Qa(v,_);p&&(gd(h,v,p,_,v),d=p),Ot(c,v),pd(h,v),kD(_,i,d),r&&c.length>n&&(c=[],u.push(c),Ot(c,h)),d=Qa(f,_)}Ot(c,f),pd(h,f)}return r?u:u[0]}const jy=0,ND=1;function DE(t,e=null,n){if(!t.length)return[];const{size:r=2,gridResolution:i=10,gridOffset:s=[0,0],edgeTypes:o=!1}=n||{},a=[],l=[{pos:t,types:o?new Array(t.length/r).fill(ND):null,holes:e||[]}],c=[[],[]];let u=[];for(;l.length;){const{pos:h,types:f,holes:d}=l.shift();FD(h,r,d[0]||h.length,c),u=BE(c[0],i,s,u);const _=Qa(c[1],u);if(_){let v=Wy(h,f,r,0,d[0]||h.length,u,_);const A={pos:v[0].pos,types:v[0].types,holes:[]},p={pos:v[1].pos,types:v[1].types,holes:[]};l.push(A,p);for(let g=0;g<d.length;g++)v=Wy(h,f,r,d[g],d[g+1]||h.length,u,_),v[0]&&(A.holes.push(A.pos.length),A.pos=Ia(A.pos,v[0].pos),o&&(A.types=Ia(A.types,v[0].types))),v[1]&&(p.holes.push(p.pos.length),p.pos=Ia(p.pos,v[1].pos),o&&(p.types=Ia(p.types,v[1].types)))}else{const v={positions:h};o&&(v.edgeTypes=f),d.length&&(v.holeIndices=d),a.push(v)}}return a}function Wy(t,e,n,r,i,s,o){const a=(i-r)/n,l=[],c=[],u=[],h=[],f=[];let d,_,v;const A=So(t,a-1,n,r);let p=Math.sign(o&8?A[1]-s[3]:A[0]-s[2]),g=e&&e[a-1],m=0,E=0;for(let b=0;b<a;b++)d=So(t,b,n,r,d),_=Math.sign(o&8?d[1]-s[3]:d[0]-s[2]),v=e&&e[r/n+b],_&&p&&p!==_&&(gd(A,d,o,s,f),Ot(l,f)&&u.push(g),Ot(c,f)&&h.push(g)),_<=0?(Ot(l,d)&&u.push(v),m-=_):u.length&&(u[u.length-1]=jy),_>=0?(Ot(c,d)&&h.push(v),E+=_):h.length&&(h[h.length-1]=jy),pd(A,d),p=_,g=v;return[m?{pos:l,types:e&&u}:null,E?{pos:c,types:e&&h}:null]}function BE(t,e,n,r){const i=Math.floor((t[0]-n[0])/e)*e+n[0],s=Math.floor((t[1]-n[1])/e)*e+n[1];return r[0]=i,r[1]=s,r[2]=i+e,r[3]=s+e,r}function kD(t,e,n){n&8?(t[1]+=e,t[3]+=e):n&4?(t[1]-=e,t[3]-=e):n&2?(t[0]+=e,t[2]+=e):n&1&&(t[0]-=e,t[2]-=e)}function FD(t,e,n,r){let i=1/0,s=-1/0,o=1/0,a=-1/0;for(let l=0;l<n;l+=e){const c=t[l],u=t[l+1];i=c<i?c:i,s=c>s?c:s,o=u<o?u:o,a=u>a?u:a}return r[0][0]=i,r[0][1]=o,r[1][0]=s,r[1][1]=a,r}function Ia(t,e){for(let n=0;n<e.length;n++)t.push(e[n]);return t}const DD=85.051129;function BD(t,e){const{size:n=2,startIndex:r=0,endIndex:i=t.length,normalize:s=!0}=e||{},o=t.slice(r,i);UE(o,n,0,i-r);const a=FE(o,{size:n,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const l of a)LE(l,n);return a}function UD(t,e=null,n){const{size:r=2,normalize:i=!0,edgeTypes:s=!1}=n||{};e=e||[];const o=[],a=[];let l=0,c=0;for(let h=0;h<=e.length;h++){const f=e[h]||t.length,d=c,_=LD(t,r,l,f);for(let v=_;v<f;v++)o[c++]=t[v];for(let v=l;v<_;v++)o[c++]=t[v];UE(o,r,d,c),zD(o,r,d,c,n==null?void 0:n.maxLatitude),l=f,a[h]=c}a.pop();const u=DE(o,a,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(i)for(const h of u)LE(h.positions,r);return u}function LD(t,e,n,r){let i=-1,s=-1;for(let o=n+1;o<r;o+=e){const a=Math.abs(t[o]);a>i&&(i=a,s=o-1)}return s}function zD(t,e,n,r,i=DD){const s=t[n],o=t[r-e];if(Math.abs(s-o)>180){const a=So(t,0,e,n);a[0]+=Math.round((o-s)/360)*360,Ot(t,a),a[1]=Math.sign(a[1])*i,Ot(t,a),a[0]=s,Ot(t,a)}}function UE(t,e,n,r){let i=t[0],s;for(let o=n;o<r;o+=e){s=t[o];const a=s-i;(a>180||a<-180)&&(s-=Math.round(a/360)*360),t[o]=i=s}}function LE(t,e){let n;const r=t.length/e;for(let s=0;s<r&&(n=t[s*e],(n+180)%360===0);s++);const i=-Math.round(n/360)*360;if(i!==0)for(let s=0;s<r;s++)t[s*e]+=i}function VD(t,e,n,r){let i;if(Array.isArray(t[0])){const s=t.length*e;i=new Array(s);for(let o=0;o<t.length;o++)for(let a=0;a<e;a++)i[o*e+a]=t[o][a]||0}else i=t;return n?FE(i,{size:e,gridResolution:n}):r?BD(i,{size:e}):i}const jD=1,WD=2,Eh=4;class HD extends PE{constructor(e){super({...e,attributes:{positions:{size:3,padding:18,initialize:!0,type:e.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}})}get(e){return this.attributes[e]}getGeometryFromBuffer(e){return this.normalize?super.getGeometryFromBuffer(e):null}normalizeGeometry(e){return this.normalize?VD(e,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):e}getGeometrySize(e){if(Hy(e)){let r=0;for(const i of e)r+=this.getGeometrySize(i);return r}const n=this.getPathLength(e);return n<2?0:this.isClosed(e)?n<3?0:n+2:n}updateGeometryAttributes(e,n){if(n.geometrySize!==0)if(e&&Hy(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i}else this._updateSegmentTypes(e,n),this._updatePositions(e,n)}_updateSegmentTypes(e,n){const r=this.attributes.segmentTypes,i=e?this.isClosed(e):!1,{vertexStart:s,geometrySize:o}=n;r.fill(0,s,s+o),i?(r[s]=Eh,r[s+o-2]=Eh):(r[s]+=jD,r[s+o-2]+=WD),r[s+o-1]=Eh}_updatePositions(e,n){const{positions:r}=this.attributes;if(!r||!e)return;const{vertexStart:i,geometrySize:s}=n,o=new Array(3);for(let a=i,l=0;l<s;a++,l++)this.getPointOnPath(e,l,o),r[a*3]=o[0],r[a*3+1]=o[1],r[a*3+2]=o[2]}getPathLength(e){return e.length/this.positionSize}getPointOnPath(e,n,r=[]){const{positionSize:i}=this;n*i>=e.length&&(n+=1-e.length/i);const s=n*i;return r[0]=e[s],r[1]=e[s+1],r[2]=i===3&&e[s+2]||0,r}isClosed(e){if(!this.normalize)return!!this.opts.loop;const{positionSize:n}=this,r=e.length-n;return e[0]===e[r]&&e[1]===e[r+1]&&(n===2||e[2]===e[r+2])}}function Hy(t){return Array.isArray(t[0])}const $D=`#version 300 es
#define SHADER_NAME path-layer-vertex-shader
in vec2 positions;
in float instanceTypes;
in vec3 instanceStartPositions;
in vec3 instanceEndPositions;
in vec3 instanceLeftPositions;
in vec3 instanceRightPositions;
in vec3 instanceLeftPositions64Low;
in vec3 instanceStartPositions64Low;
in vec3 instanceEndPositions64Low;
in vec3 instanceRightPositions64Low;
in float instanceStrokeWidths;
in vec4 instanceColors;
in vec3 instancePickingColors;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;
uniform float opacity;
out vec4 vColor;
out vec2 vCornerOffset;
out float vMiterLength;
out vec2 vPathPosition;
out float vPathLength;
out float vJointType;
const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);
float flipIfTrue(bool flag) {
return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
vec2 width
) {
bool isEnd = positions.x > 0.0;
float sideOfPath = positions.y;
float isJoint = float(sideOfPath == 0.0);
vec3 deltaA3 = (currPoint - prevPoint);
vec3 deltaB3 = (nextPoint - currPoint);
mat3 rotationMatrix;
bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
if (needsRotation) {
deltaA3 = deltaA3 * rotationMatrix;
deltaB3 = deltaB3 * rotationMatrix;
}
vec2 deltaA = deltaA3.xy / width;
vec2 deltaB = deltaB3.xy / width;
float lenA = length(deltaA);
float lenB = length(deltaB);
vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);
vec2 perpA = vec2(-dirA.y, dirA.x);
vec2 perpB = vec2(-dirB.y, dirB.x);
vec2 tangent = dirA + dirB;
tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
vec2 miterVec = vec2(-tangent.y, tangent.x);
vec2 dir = isEnd ? dirA : dirB;
vec2 perp = isEnd ? perpA : perpB;
float L = isEnd ? lenA : lenB;
float sinHalfA = abs(dot(miterVec, perp));
float cosHalfA = abs(dot(dirA, miterVec));
float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
float cornerPosition = sideOfPath * turnDirection;
float miterSize = 1.0 / max(sinHalfA, EPSILON);
miterSize = mix(
min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
miterSize,
step(0.0, cornerPosition)
);
vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
* (sideOfPath + isJoint * turnDirection);
bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
bool isCap = isStartCap || isEndCap;
if (isCap) {
offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
vJointType = capType;
} else {
vJointType = jointType;
}
vPathLength = L;
vCornerOffset = offsetVec;
vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
vMiterLength = isCap ? isJoint : vMiterLength;
vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
vPathPosition = vec2(
dot(offsetFromStartOfPath, perp),
dot(offsetFromStartOfPath, dir)
);
geometry.uv = vPathPosition;
float isValid = step(instanceTypes, 3.5);
vec3 offset = vec3(offsetVec * width * isValid, 0.0);
if (needsRotation) {
offset = rotationMatrix * offset;
}
return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
if (position.w < EPSILON) {
float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
position = refPosition + (position - refPosition) * r;
}
}
void main() {
geometry.pickingColor = instancePickingColors;
vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
float isEnd = positions.x;
vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);
vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);
vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);
geometry.worldPosition = currPosition;
vec2 widthPixels = vec2(clamp(
project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
widthMinPixels, widthMaxPixels) / 2.0);
vec3 width;
if (billboard) {
vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);
clipLine(prevPositionScreen, currPositionScreen);
clipLine(nextPositionScreen, currPositionScreen);
clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));
width = vec3(widthPixels, 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(
prevPositionScreen.xyz / prevPositionScreen.w,
currPositionScreen.xyz / currPositionScreen.w,
nextPositionScreen.xyz / nextPositionScreen.w,
project_pixel_size_to_clipspace(width.xy)
);
DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
} else {
prevPosition = project_position(prevPosition, prevPosition64Low);
currPosition = project_position(currPosition, currPosition64Low);
nextPosition = project_position(nextPosition, nextPosition64Low);
width = vec3(project_pixel_size(widthPixels), 0.0);
DECKGL_FILTER_SIZE(width, geometry);
vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
geometry.position = vec4(currPosition + offset, 1.0);
gl_Position = project_common_position_to_clipspace(geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,XD=`#version 300 es
#define SHADER_NAME path-layer-fragment-shader
precision highp float;
uniform float miterLimit;
in vec4 vColor;
in vec2 vCornerOffset;
in float vMiterLength;
in vec2 vPathPosition;
in float vPathLength;
in float vJointType;
out vec4 fragColor;
void main(void) {
geometry.uv = vPathPosition;
if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
discard;
}
if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
discard;
}
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,zE=[0,0,0,255],YD={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:t=>t.path},getColor:{type:"accessor",value:zE},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},Sh={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},wc=class wc extends Sn{getShaders(){return super.getShaders({vs:$D,fs:XD,modules:[zo,Vo]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){this.getAttributeManager().addInstanced({vertexPositions:{size:3,vertexOffset:1,type:"float64",fp64:this.use64bitPositions(),transition:Sh,accessor:"getPath",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:"uint8",update:this.calculateSegmentTypes,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:Sh,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",accessor:"getColor",transition:Sh,defaultValue:zE},instancePickingColors:{size:4,type:"uint8",accessor:(r,{index:i,target:s})=>this.encodePickingColor(r&&r.__source?r.__source.index:i,s)}}),this.setState({pathTesselator:new HD({fp64:this.use64bitPositions()})})}updateState(e){var o;super.updateState(e);const{props:n,changeFlags:r}=e,i=this.getAttributeManager();if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPath)){const{pathTesselator:a}=this.state,l=n.data.attributes||{};a.updateGeometry({data:n.data,geometryBuffer:l.getPath,buffers:l,normalize:!n._pathType,loop:n._pathType==="loop",getGeometry:n.getPath,positionFormat:n.positionFormat,wrapLongitude:n.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:r.dataChanged}),this.setState({numInstances:a.instanceCount,startIndices:a.vertexStarts}),r.dataChanged||i.invalidateAll()}r.extensionsChanged&&((o=this.state.model)==null||o.destroy(),this.state.model=this._getModel(),i.invalidateAll())}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{jointRounded:n,capRounded:r,billboard:i,miterLimit:s,widthUnits:o,widthScale:a,widthMinPixels:l,widthMaxPixels:c}=this.props,u=this.state.model;u.setUniforms(e),u.setUniforms({jointType:Number(n),capType:Number(r),billboard:i,widthUnits:kr[o],widthScale:a,miterLimit:s,widthMinPixels:l,widthMaxPixels:c}),u.draw(this.context.renderPass)}_getModel(){const e=[0,1,2,1,4,2,1,3,4,3,5,4],n=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Ft(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Zi({topology:"triangle-list",attributes:{indices:new Uint16Array(e),positions:{value:new Float32Array(n),size:2}}}),isInstanced:!0})}calculatePositions(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateSegmentTypes(e){const{pathTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("segmentTypes")}};wc.defaultProps=YD,wc.layerName="PathLayer";let _d=wc;var Yp={exports:{}};Yp.exports=ou;Yp.exports.default=ou;function ou(t,e,n){n=n||2;var r=e&&e.length,i=r?e[0]*n:t.length,s=VE(t,0,i,n,!0),o=[];if(!s||s.next===s.prev)return o;var a,l,c,u,h,f,d;if(r&&(s=JD(t,e,s,n)),t.length>80*n){a=c=t[0],l=u=t[1];for(var _=n;_<i;_+=n)h=t[_],f=t[_+1],h<a&&(a=h),f<l&&(l=f),h>c&&(c=h),f>u&&(u=f);d=Math.max(c-a,u-l),d=d!==0?32767/d:0}return Ao(s,o,n,a,l,d,0),o}function VE(t,e,n,r,i){var s,o;if(i===vd(t,e,n,r)>0)for(s=e;s<n;s+=r)o=$y(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=$y(s,t[s],t[s+1],o);return o&&au(o,o.next)&&(bo(o),o=o.next),o}function Lr(t,e){if(!t)return t;e||(e=t);var n=t,r;do if(r=!1,!n.steiner&&(au(n,n.next)||ge(n.prev,n,n.next)===0)){if(bo(n),n=e=n.prev,n===n.next)break;r=!0}else n=n.next;while(r||n!==e);return e}function Ao(t,e,n,r,i,s,o){if(t){!o&&s&&rB(t,r,i,s);for(var a=t,l,c;t.prev!==t.next;){if(l=t.prev,c=t.next,s?qD(t,r,i,s):KD(t)){e.push(l.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),bo(t),t=c.next,a=c.next;continue}if(t=c,t===a){o?o===1?(t=ZD(Lr(t),e,n),Ao(t,e,n,r,i,s,2)):o===2&&QD(t,e,n,r,i,s):Ao(Lr(t),e,n,r,i,s,1);break}}}}function KD(t){var e=t.prev,n=t,r=t.next;if(ge(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,l=n.y,c=r.y,u=i<s?i<o?i:o:s<o?s:o,h=a<l?a<c?a:c:l<c?l:c,f=i>s?i>o?i:o:s>o?s:o,d=a>l?a>c?a:c:l>c?l:c,_=r.next;_!==e;){if(_.x>=u&&_.x<=f&&_.y>=h&&_.y<=d&&Ei(i,a,s,l,o,c,_.x,_.y)&&ge(_.prev,_,_.next)>=0)return!1;_=_.next}return!0}function qD(t,e,n,r){var i=t.prev,s=t,o=t.next;if(ge(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,c=o.x,u=i.y,h=s.y,f=o.y,d=a<l?a<c?a:c:l<c?l:c,_=u<h?u<f?u:f:h<f?h:f,v=a>l?a>c?a:c:l>c?l:c,A=u>h?u>f?u:f:h>f?h:f,p=md(d,_,e,n,r),g=md(v,A,e,n,r),m=t.prevZ,E=t.nextZ;m&&m.z>=p&&E&&E.z<=g;){if(m.x>=d&&m.x<=v&&m.y>=_&&m.y<=A&&m!==i&&m!==o&&Ei(a,u,l,h,c,f,m.x,m.y)&&ge(m.prev,m,m.next)>=0||(m=m.prevZ,E.x>=d&&E.x<=v&&E.y>=_&&E.y<=A&&E!==i&&E!==o&&Ei(a,u,l,h,c,f,E.x,E.y)&&ge(E.prev,E,E.next)>=0))return!1;E=E.nextZ}for(;m&&m.z>=p;){if(m.x>=d&&m.x<=v&&m.y>=_&&m.y<=A&&m!==i&&m!==o&&Ei(a,u,l,h,c,f,m.x,m.y)&&ge(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;E&&E.z<=g;){if(E.x>=d&&E.x<=v&&E.y>=_&&E.y<=A&&E!==i&&E!==o&&Ei(a,u,l,h,c,f,E.x,E.y)&&ge(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function ZD(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!au(i,s)&&jE(i,r,r.next,s)&&Ro(i,s)&&Ro(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),bo(r),bo(r.next),r=t=s),r=r.next}while(r!==t);return Lr(r)}function QD(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&oB(o,a)){var l=WE(o,a);o=Lr(o,o.next),l=Lr(l,l.next),Ao(o,e,n,r,i,s,0),Ao(l,e,n,r,i,s,0);return}a=a.next}o=o.next}while(o!==t)}function JD(t,e,n,r){var i=[],s,o,a,l,c;for(s=0,o=e.length;s<o;s++)a=e[s]*r,l=s<o-1?e[s+1]*r:t.length,c=VE(t,a,l,r,!1),c===c.next&&(c.steiner=!0),i.push(sB(c));for(i.sort(GD),s=0;s<i.length;s++)n=eB(i[s],n);return n}function GD(t,e){return t.x-e.x}function eB(t,e){var n=tB(t,e);if(!n)return e;var r=WE(n,t);return Lr(r,r.next),Lr(n,n.next)}function tB(t,e){var n=e,r=t.x,i=t.y,s=-1/0,o;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var a=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&a>s&&(s=a,o=n.x<n.next.x?n:n.next,a===r))return o}n=n.next}while(n!==e);if(!o)return null;var l=o,c=o.x,u=o.y,h=1/0,f;n=o;do r>=n.x&&n.x>=c&&r!==n.x&&Ei(i<u?r:s,i,c,u,i<u?s:r,i,n.x,n.y)&&(f=Math.abs(i-n.y)/(r-n.x),Ro(n,t)&&(f<h||f===h&&(n.x>o.x||n.x===o.x&&nB(o,n)))&&(o=n,h=f)),n=n.next;while(n!==l);return o}function nB(t,e){return ge(t.prev,t,e.prev)<0&&ge(e.next,t,t.next)<0}function rB(t,e,n,r){var i=t;do i.z===0&&(i.z=md(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,iB(i)}function iB(t){var e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ,!!r);e++);for(l=c;a>0||l>0&&r;)a!==0&&(l===0||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1);return t}function md(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t|e<<1}function sB(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Ei(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function oB(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!aB(t,e)&&(Ro(t,e)&&Ro(e,t)&&lB(t,e)&&(ge(t.prev,t,e.prev)||ge(t,e.prev,e))||au(t,e)&&ge(t.prev,t,t.next)>0&&ge(e.prev,e,e.next)>0)}function ge(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function au(t,e){return t.x===e.x&&t.y===e.y}function jE(t,e,n,r){var i=Na(ge(t,e,n)),s=Na(ge(t,e,r)),o=Na(ge(n,r,t)),a=Na(ge(n,r,e));return!!(i!==s&&o!==a||i===0&&Oa(t,n,e)||s===0&&Oa(t,r,e)||o===0&&Oa(n,t,r)||a===0&&Oa(n,e,r))}function Oa(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Na(t){return t>0?1:t<0?-1:0}function aB(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&jE(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function Ro(t,e){return ge(t.prev,t,t.next)<0?ge(t,e,t.next)>=0&&ge(t,t.prev,e)>=0:ge(t,e,t.prev)<0||ge(t,t.next,e)<0}function lB(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next;while(n!==t);return r}function WE(t,e){var n=new yd(t.i,t.x,t.y),r=new yd(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function $y(t,e,n,r){var i=new yd(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function bo(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function yd(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}ou.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(vd(t,0,s,n));if(i)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,u=a<l-1?e[a+1]*n:t.length;o-=Math.abs(vd(t,c,u,n))}var h=0;for(a=0;a<r.length;a+=3){var f=r[a]*n,d=r[a+1]*n,_=r[a+2]*n;h+=Math.abs((t[f]-t[_])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[_+1]-t[f+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)};function vd(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}ou.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};var cB=Yp.exports;const uB=bd(cB),ka=NE.CLOCKWISE,Xy=NE.COUNTER_CLOCKWISE,jn={isClosed:!0};function hB(t){if(t=t&&t.positions||t,!Array.isArray(t)&&!ArrayBuffer.isView(t))throw new Error("invalid polygon")}function Ns(t){return"positions"in t?t.positions:t}function Ja(t){return"holeIndices"in t?t.holeIndices:null}function fB(t){return Array.isArray(t[0])}function dB(t){return t.length>=1&&t[0].length>=2&&Number.isFinite(t[0][0])}function pB(t){const e=t[0],n=t[t.length-1];return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]}function gB(t,e,n,r){for(let i=0;i<e;i++)if(t[n+i]!==t[r-e+i])return!1;return!0}function Yy(t,e,n,r,i){let s=e;const o=n.length;for(let a=0;a<o;a++)for(let l=0;l<r;l++)t[s++]=n[a][l]||0;if(!pB(n))for(let a=0;a<r;a++)t[s++]=n[0][a]||0;return jn.start=e,jn.end=s,jn.size=r,kE(t,i,jn),s}function Ky(t,e,n,r,i=0,s,o){s=s||n.length;const a=s-i;if(a<=0)return e;let l=e;for(let c=0;c<a;c++)t[l++]=n[i+c];if(!gB(n,r,i,s))for(let c=0;c<r;c++)t[l++]=n[i+c];return jn.start=e,jn.end=l,jn.size=r,kE(t,o,jn),l}function HE(t,e){hB(t);const n=[],r=[];if("positions"in t){const{positions:i,holeIndices:s}=t;if(s){let o=0;for(let a=0;a<=s.length;a++)o=Ky(n,o,i,e,s[a-1],s[a],a===0?ka:Xy),r.push(o);return r.pop(),{positions:n,holeIndices:r}}t=i}if(!fB(t))return Ky(n,0,t,e,0,n.length,ka),n;if(!dB(t)){let i=0;for(const[s,o]of t.entries())i=Yy(n,i,o,e,s===0?ka:Xy),r.push(i);return r.pop(),{positions:n,holeIndices:r}}return Yy(n,0,t,e,ka),n}function Ah(t,e,n){const r=t.length/3;let i=0;for(let s=0;s<r;s++){const o=(s+1)%r;i+=t[s*3+e]*t[o*3+n],i-=t[o*3+e]*t[s*3+n]}return Math.abs(i/2)}function qy(t,e,n,r){const i=t.length/3;for(let s=0;s<i;s++){const o=s*3,a=t[o+0],l=t[o+1],c=t[o+2];t[o+e]=a,t[o+n]=l,t[o+r]=c}}function _B(t,e,n,r){let i=Ja(t);i&&(i=i.map(a=>a/e));let s=Ns(t);const o=r&&e===3;if(n){const a=s.length;s=s.slice();const l=[];for(let c=0;c<a;c+=e){l[0]=s[c],l[1]=s[c+1],o&&(l[2]=s[c+2]);const u=n(l);s[c]=u[0],s[c+1]=u[1],o&&(s[c+2]=u[2])}}if(o){const a=Ah(s,0,1),l=Ah(s,0,2),c=Ah(s,1,2);if(!a&&!l&&!c)return[];a>l&&a>c||(l>c?(n||(s=s.slice()),qy(s,0,2,1)):(n||(s=s.slice()),qy(s,2,0,1)))}return uB(s,i,e)}class mB extends PE{constructor(e){const{fp64:n,IndexType:r=Uint32Array}=e;super({...e,attributes:{positions:{size:3,type:n?Float64Array:Float32Array},vertexValid:{type:Uint16Array,size:1},indices:{type:r,size:1}}})}get(e){const{attributes:n}=this;return e==="indices"?n.indices&&n.indices.subarray(0,this.vertexCount):n[e]}updateGeometry(e){super.updateGeometry(e);const n=this.buffers.indices;if(n)this.vertexCount=(n.value||n).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}normalizeGeometry(e){if(this.normalize){const n=HE(e,this.positionSize);return this.opts.resolution?DE(Ns(n),Ja(n),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?UD(Ns(n),Ja(n),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):n}return e}getGeometrySize(e){if(Zy(e)){let n=0;for(const r of e)n+=this.getGeometrySize(r);return n}return Ns(e).length/this.positionSize}getGeometryFromBuffer(e){return this.normalize||!this.buffers.indices?super.getGeometryFromBuffer(e):null}updateGeometryAttributes(e,n){if(e&&Zy(e))for(const r of e){const i=this.getGeometrySize(r);n.geometrySize=i,this.updateGeometryAttributes(r,n),n.vertexStart+=i,n.indexStart=this.indexStarts[n.geometryIndex+1]}else{const r=e;this._updateIndices(r,n),this._updatePositions(r,n),this._updateVertexValid(r,n)}}_updateIndices(e,{geometryIndex:n,vertexStart:r,indexStart:i}){const{attributes:s,indexStarts:o,typedArrayManager:a}=this;let l=s.indices;if(!l||!e)return;let c=i;const u=_B(e,this.positionSize,this.opts.preproject,this.opts.full3d);l=a.allocate(l,i+u.length,{copy:!0});for(let h=0;h<u.length;h++)l[c++]=u[h]+r;o[n+1]=i+u.length,s.indices=l}_updatePositions(e,{vertexStart:n,geometrySize:r}){const{attributes:{positions:i},positionSize:s}=this;if(!i||!e)return;const o=Ns(e);for(let a=n,l=0;l<r;a++,l++){const c=o[l*s],u=o[l*s+1],h=s>2?o[l*s+2]:0;i[a*3]=c,i[a*3+1]=u,i[a*3+2]=h}}_updateVertexValid(e,{vertexStart:n,geometrySize:r}){const{positionSize:i}=this,s=this.attributes.vertexValid,o=e&&Ja(e);if(e&&e.edgeTypes?s.set(e.edgeTypes,n):s.fill(1,n,n+r),o)for(let a=0;a<o.length;a++)s[n+o[a]/i-1]=0;s[n+r-1]=0}}function Zy(t){return Array.isArray(t)&&t.length>0&&!Number.isFinite(t[0])}const $E=`uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;
out vec4 vColor;
struct PolygonProps {
vec4 fillColors;
vec4 lineColors;
vec3 positions;
vec3 positions64Low;
vec3 pickingColors;
vec3 normal;
float elevations;
};
vec3 project_offset_normal(vec3 vector) {
if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
return normalize(vector * project_uCommonUnitsPerWorldUnit);
}
return project_normal(vector);
}
void calculatePosition(PolygonProps props) {
vec3 pos = props.positions;
vec3 pos64Low = props.positions64Low;
vec3 normal = props.normal;
vec4 colors = isWireframe ? props.lineColors : props.fillColors;
geometry.worldPosition = props.positions;
geometry.pickingColor = props.pickingColors;
if (extruded) {
pos.z += props.elevations * elevationScale;
}
gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
if (extruded) {
#ifdef IS_SIDE_VERTEX
normal = project_offset_normal(normal);
#else
normal = project_normal(normal);
#endif
geometry.normal = normal;
vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, colors.a * opacity);
} else {
vColor = vec4(colors.rgb, colors.a * opacity);
}
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,yB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader
in vec3 vertexPositions;
in vec3 vertexPositions64Low;
in float elevations;
in vec4 fillColors;
in vec4 lineColors;
in vec3 pickingColors;
${$E}
void main(void) {
PolygonProps props;
props.positions = vertexPositions;
props.positions64Low = vertexPositions64Low;
props.elevations = elevations;
props.fillColors = fillColors;
props.lineColors = lineColors;
props.pickingColors = pickingColors;
props.normal = vec3(0.0, 0.0, 1.0);
calculatePosition(props);
}
`,vB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX
in vec2 positions;
in vec3 instancePositions;
in vec3 instanceNextPositions;
in vec3 instancePositions64Low;
in vec3 instanceNextPositions64Low;
in float instanceElevations;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
in float instanceVertexValid;
${$E}
void main(void) {
if(instanceVertexValid < 0.5){
gl_Position = vec4(0.);
return;
}
PolygonProps props;
vec3 pos;
vec3 pos64Low;
vec3 nextPos;
vec3 nextPos64Low;
#if RING_WINDING_ORDER_CW == 1
pos = instancePositions;
pos64Low = instancePositions64Low;
nextPos = instanceNextPositions;
nextPos64Low = instanceNextPositions64Low;
#else
pos = instanceNextPositions;
pos64Low = instanceNextPositions64Low;
nextPos = instancePositions;
nextPos64Low = instancePositions64Low;
#endif
props.positions = mix(pos, nextPos, positions.x);
props.positions64Low = mix(pos64Low, nextPos64Low, positions.x);
props.normal = vec3(
pos.y - nextPos.y + (pos64Low.y - nextPos64Low.y),
nextPos.x - pos.x + (nextPos64Low.x - pos64Low.x),
0.0);
props.elevations = instanceElevations * positions.y;
props.fillColors = instanceFillColors;
props.lineColors = instanceLineColors;
props.pickingColors = instancePickingColors;
calculatePosition(props);
}
`,TB=`#version 300 es
#define SHADER_NAME solid-polygon-layer-fragment-shader
precision highp float;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Kl=[0,0,0,255],wB={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:t=>t.polygon},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:Kl},getLineColor:{type:"accessor",value:Kl},material:!0},Fa={enter:(t,e)=>e.length?e.subarray(e.length-t.length):t},Ec=class Ec extends Sn{getShaders(e){return super.getShaders({vs:e==="top"?yB:vB,fs:TB,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[zo,S2,Vo]})}get wrapLongitude(){return!1}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["vertexPositions"])}initializeState(){const{viewport:e}=this.context;let{coordinateSystem:n}=this.props;const{_full3d:r}=this.props;e.isGeospatial&&n===ee.DEFAULT&&(n=ee.LNGLAT);let i;n===ee.LNGLAT&&(r?i=e.projectPosition.bind(e):i=e.projectFlat.bind(e)),this.setState({numInstances:0,polygonTesselator:new mB({preproject:i,fp64:this.use64bitPositions(),IndexType:Uint32Array})});const s=this.getAttributeManager(),o=!0;s.remove(["instancePickingColors"]),s.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:o},vertexPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:Fa,accessor:"getPolygon",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instancePositions:{vertexOffset:0,divisor:1},instanceNextPositions:{vertexOffset:1,divisor:1}}},instanceVertexValid:{size:1,type:"uint16",divisor:1,update:this.calculateVertexValid,noAlloc:o},elevations:{size:1,transition:Fa,accessor:"getElevation",shaderAttributes:{instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:"unorm8",transition:Fa,accessor:"getFillColor",defaultValue:Kl,shaderAttributes:{instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:"unorm8",transition:Fa,accessor:"getLineColor",defaultValue:Kl,shaderAttributes:{instanceLineColors:{divisor:1}}},pickingColors:{size:4,type:"uint8",accessor:(a,{index:l,target:c})=>this.encodePickingColor(a&&a.__source?a.__source.index:l,c),shaderAttributes:{instancePickingColors:{divisor:1}}}})}getPickingInfo(e){const n=super.getPickingInfo(e),{index:r}=n,i=this.props.data;return i[0]&&i[0].__source&&(n.object=i.find(s=>s.__source.index===r)),n}disablePickingIndex(e){const n=this.props.data;if(n[0]&&n[0].__source)for(let r=0;r<n.length;r++)n[r].__source.index===e&&this._disablePickingIndex(r);else super.disablePickingIndex(e)}draw({uniforms:e}){const{extruded:n,filled:r,wireframe:i,elevationScale:s}=this.props,{topModel:o,sideModel:a,wireframeModel:l,polygonTesselator:c}=this.state,u={...e,extruded:!!n,elevationScale:s};l&&i&&(l.setInstanceCount(c.instanceCount-1),l.setUniforms(u),l.draw(this.context.renderPass)),a&&r&&(a.setInstanceCount(c.instanceCount-1),a.setUniforms(u),a.draw(this.context.renderPass)),o&&r&&(o.setVertexCount(c.vertexCount),o.setUniforms(u),o.draw(this.context.renderPass))}updateState(e){var a;super.updateState(e),this.updateGeometry(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager();(i.extensionsChanged||n.filled!==r.filled||n.extruded!==r.extruded)&&((a=this.state.models)==null||a.forEach(l=>l.destroy()),this.setState(this._getModels()),s.invalidateAll())}updateGeometry({props:e,oldProps:n,changeFlags:r}){if(r.dataChanged||r.updateTriggersChanged&&(r.updateTriggersChanged.all||r.updateTriggersChanged.getPolygon)){const{polygonTesselator:s}=this.state,o=e.data.attributes||{};s.updateGeometry({data:e.data,normalize:e._normalize,geometryBuffer:o.getPolygon,buffers:o,getGeometry:e.getPolygon,positionFormat:e.positionFormat,wrapLongitude:e.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:r.dataChanged,full3d:e._full3d}),this.setState({numInstances:s.instanceCount,startIndices:s.vertexStarts}),r.dataChanged||this.getAttributeManager().invalidateAll()}}_getModels(){const{id:e,filled:n,extruded:r}=this.props;let i,s,o;const a=this.getAttributeManager().getBufferLayouts();if(n){const l=this.getShaders("top");l.defines.NON_INSTANCED_MODEL=1,i=new Ft(this.context.device,{...l,id:`${e}-top`,topology:"triangle-list",uniforms:{isWireframe:!1},bufferLayout:a,isIndexed:!0,userData:{excludeAttributes:{instanceVertexValid:!0}}})}return r&&(s=new Ft(this.context.device,{...this.getShaders("side"),id:`${e}-side`,bufferLayout:a,uniforms:{isWireframe:!1},geometry:new Zi({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,1,1,0,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}}),o=new Ft(this.context.device,{...this.getShaders("side"),id:`${e}-wireframe`,bufferLayout:a,uniforms:{isWireframe:!0},geometry:new Zi({topology:"line-strip",attributes:{positions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),isInstanced:1,userData:{excludeAttributes:{indices:!0}}})),{models:[s,o,i].filter(Boolean),topModel:i,sideModel:s,wireframeModel:o}}calculateIndices(e){const{polygonTesselator:n}=this.state;e.startIndices=n.indexStarts,e.value=n.get("indices")}calculatePositions(e){const{polygonTesselator:n}=this.state;e.startIndices=n.vertexStarts,e.value=n.get("positions")}calculateVertexValid(e){e.value=this.state.polygonTesselator.get("vertexValid")}};Ec.defaultProps=wB,Ec.layerName="SolidPolygonLayer";let Co=Ec;function EB({data:t,getIndex:e,dataRange:n,replace:r}){const{startRow:i=0,endRow:s=1/0}=n,o=t.length;let a=o,l=o;for(let f=0;f<o;f++){const d=e(t[f]);if(a>f&&d>=i&&(a=f),d>=s){l=f;break}}let c=a;const h=l-a!==r.length?t.slice(l):void 0;for(let f=0;f<r.length;f++)t[c++]=r[f];if(h){for(let f=0;f<h.length;f++)t[c++]=h[f];t.length=c}return{startRow:a,endRow:a+r.length}}const XE=[0,0,0,255],SB=[0,0,0,255],AB={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:t=>t.polygon},getFillColor:{type:"accessor",value:SB},getLineColor:{type:"accessor",value:XE},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},Sc=class Sc extends Ji{initializeState(){this.state={paths:[],pathsDiff:null},this.props.getLineDashArray&&ne.removed("getLineDashArray","PathStyleExtension")()}updateState({changeFlags:e}){const n=e.dataChanged||e.updateTriggersChanged&&(e.updateTriggersChanged.all||e.updateTriggersChanged.getPolygon);if(n&&Array.isArray(e.dataChanged)){const r=this.state.paths.slice(),i=e.dataChanged.map(s=>EB({data:r,getIndex:o=>o.__source.index,dataRange:s,replace:this._getPaths(s)}));this.setState({paths:r,pathsDiff:i})}else n&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:n,getPolygon:r,positionFormat:i,_normalize:s}=this.props,o=[],a=i==="XY"?2:3,{startRow:l,endRow:c}=e,{iterable:u,objectInfo:h}=Wo(n,l,c);for(const f of u){h.index++;let d=r(f,h);s&&(d=HE(d,a));const{holeIndices:_}=d,v=d.positions||d;if(_)for(let A=0;A<=_.length;A++){const p=v.slice(_[A-1]||0,_[A]||v.length);o.push(this.getSubLayerRow({path:p},f,h.index))}else o.push(this.getSubLayerRow({path:v},f,h.index))}return o}renderLayers(){const{data:e,_dataDiff:n,stroked:r,filled:i,extruded:s,wireframe:o,_normalize:a,_windingOrder:l,elevationScale:c,transitions:u,positionFormat:h}=this.props,{lineWidthUnits:f,lineWidthScale:d,lineWidthMinPixels:_,lineWidthMaxPixels:v,lineJointRounded:A,lineMiterLimit:p,lineDashJustified:g}=this.props,{getFillColor:m,getLineColor:E,getLineWidth:b,getLineDashArray:x,getElevation:O,getPolygon:M,updateTriggers:N,material:k}=this.props,{paths:z,pathsDiff:L}=this.state,j=this.getSubLayerClass("fill",Co),X=this.getSubLayerClass("stroke",_d),Z=this.shouldRenderSubLayer("fill",z)&&new j({_dataDiff:n,extruded:s,elevationScale:c,filled:i,wireframe:o,_normalize:a,_windingOrder:l,getElevation:O,getFillColor:m,getLineColor:s&&o?E:XE,material:k,transitions:u},this.getSubLayerProps({id:"fill",updateTriggers:N&&{getPolygon:N.getPolygon,getElevation:N.getElevation,getFillColor:N.getFillColor,lineColors:s&&o,getLineColor:N.getLineColor}}),{data:e,positionFormat:h,getPolygon:M}),Je=!s&&r&&this.shouldRenderSubLayer("stroke",z)&&new X({_dataDiff:L&&(()=>L),widthUnits:f,widthScale:d,widthMinPixels:_,widthMaxPixels:v,jointRounded:A,miterLimit:p,dashJustified:g,_pathType:"loop",transitions:u&&{getWidth:u.getLineWidth,getColor:u.getLineColor,getPath:u.getPolygon},getColor:this.getSubLayerAccessor(E),getWidth:this.getSubLayerAccessor(b),getDashArray:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"stroke",updateTriggers:N&&{getWidth:N.getLineWidth,getColor:N.getLineColor,getDashArray:N.getLineDashArray}}),{data:z,positionFormat:h,getPath:Ue=>Ue.path});return[!s&&Z,Je,s&&Z]}};Sc.layerName="PolygonLayer",Sc.defaultProps=AB;let ql=Sc;const RB=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf) {
float distance = alpha;
alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);
if (outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
color = mix(outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Rh=192/256,Qy=[],bB={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},Ac=class Ac extends fd{getShaders(){return{...super.getShaders(),fs:RB}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&ne.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,Rh*(1-i)):-1;if(e.uniforms={...e.uniforms,sdfBuffer:Rh,outlineBuffer:o,gamma:r,sdf:!!n,outlineColor:s},super.draw(e),n&&i){const{iconManager:a}=this.state,l=a.getTexture(),c=this.state.model;l&&(c.setUniforms({outlineBuffer:Rh}),c.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):Qy}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):Qy}};Ac.defaultProps=bB,Ac.layerName="MultiIconLayer";let Td=Ac;const Ks=1e20;class CB{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(i)),h=c+2*this.buffer,f=u+2*this.buffer,d=Math.max(h*f,0),_=new Uint8ClampedArray(d),v={data:_,width:h,height:f,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return v;const{ctx:A,buffer:p,gridInner:g,gridOuter:m}=this;A.clearRect(p,p,c,u),A.fillText(e,p,p+a);const E=A.getImageData(p,p,c,u);m.fill(Ks,0,d),g.fill(0,0,d);for(let b=0;b<u;b++)for(let x=0;x<c;x++){const O=E.data[4*(b*c+x)+3]/255;if(O===0)continue;const M=(b+p)*h+x+p;if(O===1)m[M]=0,g[M]=Ks;else{const N=.5-O;m[M]=N>0?N*N:0,g[M]=N<0?N*N:0}}Jy(m,0,0,h,f,h,this.f,this.v,this.z),Jy(g,p,p,c,u,h,this.f,this.v,this.z);for(let b=0;b<d;b++){const x=Math.sqrt(m[b])-Math.sqrt(g[b]);_[b]=Math.round(255-255*(x/this.radius+this.cutoff))}return v}}function Jy(t,e,n,r,i,s,o,a,l){for(let c=e;c<e+r;c++)Gy(t,n*s+c,s,i,o,a,l);for(let c=n;c<n+i;c++)Gy(t,c*s+e,1,r,o,a,l)}function Gy(t,e,n,r,i,s,o){s[0]=0,o[0]=-Ks,o[1]=Ks,i[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){i[a]=t[e+a*n];const u=a*a;do{const h=s[l];c=(i[a]-i[h]+u-h*h)/(a-h)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=Ks}for(let a=0,l=0;a<r;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=i[c]+u*u}}const PB=32,xB=[];function MB(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function IB({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+r*2;for(const h of t)if(!s[h]){const f=e(h);c+f+r*2>i&&(c=0,l++),s[h]={x:c+r,y:a+l*u+r,width:f,height:u,layoutWidth:f,layoutHeight:n},c+=f+r*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:MB(a+(l+1)*u)}}function YE(t,e,n,r){var s;let i=0;for(let o=e;o<n;o++){const a=t[o];i+=((s=r[a])==null?void 0:s.layoutWidth)||0}return i}function KE(t,e,n,r,i,s){let o=e,a=0;for(let l=e;l<n;l++){const c=YE(t,l,l+1,i);a+c>r&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function OB(t,e,n,r,i,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let h=YE(t,a,l,i);c+h>r&&(o<a&&(s.push(a),o=a,c=0),h>r&&(h=KE(t,a,l,r,i,s),o=s[s.length-1])),a=l,c+=h}return c}function NB(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?KE(t,i,s,n,r,o):OB(t,i,s,n,r,o),o}function kB(t,e,n,r,i,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=r[c];u?(a||(a=u.layoutHeight),i[l]=o+u.layoutWidth/2,o+=u.layoutWidth):(ne.warn(`Missing character: ${c} (${c.codePointAt(0)})`)(),i[l]=o,o+=PB)}s[0]=o,s[1]=a}function FB(t,e,n,r,i){var A;const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,h=[0,0],f=[0,0];let d=0,_=0,v=0;for(let p=0;p<=o;p++){const g=s[p];if((g===`
`||p===o)&&(v=p),v>_){const m=u?NB(s,n,r,i,_,v):xB;for(let E=0;E<=m.length;E++){const b=E===0?_:m[E-1],x=E<m.length?m[E]:v;kB(s,b,x,i,a,f);for(let O=b;O<x;O++){const M=s[O],N=((A=i[M])==null?void 0:A.layoutOffsetY)||0;l[O]=d+f[1]/2+N,c[O]=f[0]}d=d+f[1]*e,h[0]=Math.max(h[0],f[0])}_=v}g===`
`&&(a[_]=0,l[_]=0,c[_]=0,_++)}return h[1]=d,{x:a,y:l,rowWidth:c,size:h}}function DB({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=r?r/o:0,c=i[e]||Math.ceil((t.length-l)/a),u=s&&new Set,h=new Array(e);let f=t;if(a>1||l>0){const d=t.constructor;f=new d(c);for(let _=0;_<c;_++)f[_]=t[_*a+l]}for(let d=0;d<e;d++){const _=i[d],v=i[d+1]||c,A=f.subarray(_,v);h[d]=String.fromCodePoint.apply(null,A),u&&A.forEach(u.add,u)}if(u)for(const d of u)s.add(String.fromCodePoint(d));return{texts:h,characterCount:c}}class qE{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function BB(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Oi={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:BB(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},e0=1024,t0=.9,n0=1.2,ZE=3;let Zl=new qE(ZE);function UB(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=Zl.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function LB(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function r0(t,e,n,r){t.font=`${r} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function zB(t){ne.assert(Number.isFinite(t)&&t>=ZE,"Invalid cache limit"),Zl=new qE(t)}class VB{constructor(){this.props={...Oi}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*n0+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=UB(this._key,this.props.characterSet),r=Zl.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,Zl.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=e0);const h=u.getContext("2d",{willReadFrequently:!0});r0(h,r,s,i);const{mapping:f,canvasHeight:d,xOffset:_,yOffset:v}=IB({getFontWidth:A=>h.measureText(A).width,fontHeight:s*n0,buffer:o,characterSet:e,maxCanvasWidth:e0,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==d){const A=h.getImageData(0,0,u.width,u.height);u.height=d,h.putImageData(A,0,0)}if(r0(h,r,s,i),a){const A=new CB({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:r,fontWeight:`${i}`});for(const p of e){const{data:g,width:m,height:E,glyphTop:b}=A.draw(p);f[p].width=m,f[p].layoutOffsetY=s*t0-b;const x=h.createImageData(m,E);LB(g,x),h.putImageData(x,f[p].x,f[p].y)}}else for(const A of e)h.fillText(A,f[A].x,f[A].y+o+s*t0);return{xOffset:_,yOffset:v,mapping:f,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${n} ${r} ${i} ${o} ${a}`:`${e} ${n} ${r} ${i}`}}const jB=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
sizeMinPixels, sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,WB=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
uniform bool stroked;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,HB={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},Rc=class Rc extends Sn{getShaders(){return super.getShaders({vs:jB,fs:WB,modules:[zo,Vo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]);const c=this.state.model;c.setUniforms(e),c.setUniforms({billboard:n,stroked:!!a,padding:l,sizeUnits:kr[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o}),c.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,1,1,0,1];return new Ft(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new Zi({topology:"triangle-fan-webgl",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};Rc.defaultProps=HB,Rc.layerName="TextBackgroundLayer";let Ql=Rc;const i0={start:1,middle:0,end:-1},s0={top:1,center:0,bottom:-1},bh=[0,0,0,255],$B=1,XB={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:bh},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Oi.characterSet},fontFamily:Oi.fontFamily,fontWeight:Oi.fontWeight,lineHeight:$B,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:bh},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:bh},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},bc=class bc extends Ji{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[r,i]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,l=i0[typeof o=="function"?o(e,n):o],c=s0[typeof a=="function"?a(e,n):a];return[(l-1)*r/2,(c-1)*i/2,r,i]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:a,size:[l,c]}=this.transformParagraph(e,n),u=i0[typeof r=="function"?r(e,n):r],h=s0[typeof i=="function"?i(e,n):i],f=s.length,d=new Array(f*2);let _=0;for(let v=0;v<f;v++){const A=(1-u)*(l-a[v])/2;d[_++]=(u-1)*l/2+A+s[v],d[_++]=(h-1)*c/2+o[v]}return d}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new VB},this.props.maxWidth>0&&ne.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var l;const{data:e,characterSet:n}=this.props,r=(l=e.attributes)==null?void 0:l.getText;let{getText:i}=this.props,s=e.startIndices,o;const a=n==="auto"&&new Set;if(r&&s){const{texts:c,characterCount:u}=DB({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:a});o=u,i=(h,{index:f})=>c[f]}else{const{iterable:c,objectInfo:u}=Wo(e);s=[0],o=0;for(const h of c){u.index++;const f=Array.from(i(h,u)||"");a&&f.forEach(a.add,a),o+=f.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return FB(c,a,o,l*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:_,getBackgroundColor:v,getBorderColor:A,getBorderWidth:p,backgroundPadding:g,background:m,billboard:E,fontSettings:b,outlineWidth:x,outlineColor:O,sizeScale:M,sizeUnits:N,sizeMinPixels:k,sizeMaxPixels:z,transitions:L,updateTriggers:j}=this.props,X=this.getSubLayerClass("characters",Td),Z=this.getSubLayerClass("background",Ql);return[m&&new Z({getFillColor:v,getLineColor:A,getLineWidth:p,padding:g,getPosition:u,getSize:f,getAngle:d,getPixelOffset:_,billboard:E,sizeScale:M,sizeUnits:N,sizeMinPixels:k,sizeMaxPixels:z,transitions:L&&{getPosition:L.getPosition,getAngle:L.getAngle,getSize:L.getSize,getFillColor:L.getBackgroundColor,getLineColor:L.getBorderColor,getLineWidth:L.getBorderWidth,getPixelOffset:L.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:j.getPosition,getAngle:j.getAngle,getSize:j.getSize,getFillColor:j.getBackgroundColor,getLineColor:j.getBorderColor,getLineWidth:j.getBorderWidth,getPixelOffset:j.getPixelOffset,getBoundingRect:{getText:j.getText,getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new X({sdf:b.sdf,smoothing:Number.isFinite(b.smoothing)?b.smoothing:Oi.smoothing,outlineWidth:x/(b.radius||Oi.radius),outlineColor:O,iconAtlas:s,iconMapping:o,getPosition:u,getColor:h,getSize:f,getAngle:d,getPixelOffset:_,billboard:E,sizeScale:M*i,sizeUnits:N,sizeMinPixels:k*i,sizeMaxPixels:z*i,transitions:L&&{getPosition:L.getPosition,getAngle:L.getAngle,getColor:L.getColor,getSize:L.getSize,getPixelOffset:L.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:j.getText,getPosition:j.getPosition,getAngle:j.getAngle,getColor:j.getColor,getSize:j.getSize,getPixelOffset:j.getPixelOffset,getIconOffsets:{getTextAnchor:j.getTextAnchor,getAlignmentBaseline:j.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){zB(e)}};bc.defaultProps=XB,bc.layerName="TextLayer";let Jl=bc;const YB=`
#ifdef NON_INSTANCED_MODEL
in float collisionPriorities;
#else
in float instanceCollisionPriorities;
#endif
uniform sampler2D collision_texture;
uniform bool collision_sort;
uniform bool collision_enabled;
vec2 collision_getCoords(vec4 position) {
vec4 collision_clipspace = project_common_position_to_clipspace(position);
return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}
float collision_match(vec2 tex, vec3 pickingColor) {
vec4 collision_pickingColor = texture(collision_texture, tex);
float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
float e = 0.001;
return step(delta, e);
}
float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
if (!collision_enabled) {
return 1.0;
}
const int N = 2;
float accumulator = 0.0;
vec2 step = vec2(1.0 / project_uViewportSize);
const float floatN = float(N);
vec2 delta = -floatN * step;
for(int i = -N; i <= N; i++) {
delta.x = -step.x * floatN;
for(int j = -N; j <= N; j++) {
accumulator += collision_match(texCoords + delta, pickingColor);
delta.x += step.x;
}
delta.y += step.y;
}
float W = 2.0 * floatN + 1.0;
return pow(accumulator / (W * W), 2.2);
}
`,KB={"vs:#decl":`
float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
if (collision_sort) {
#ifdef NON_INSTANCED_MODEL
float collisionPriority = collisionPriorities;
#else
float collisionPriority = instanceCollisionPriorities;
#endif
position.z = -0.001 * collisionPriority * position.w;
}
if (collision_enabled) {
vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
vec2 collision_texCoords = collision_getCoords(collision_common_position);
collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
if (collision_fade < 0.0001) {
position = vec4(0.0, 0.0, 2.0, 1.0);
}
}
`,"vs:DECKGL_FILTER_COLOR":`
color.a *= collision_fade;
`},qB=(t,e)=>{if(!t||!("dummyCollisionMap"in t))return{};const{collisionFBO:n,drawToCollisionMap:r,dummyCollisionMap:i}=t;return{collision_sort:!!r,collision_texture:!r&&n?n.colorAttachments[0]:i}},ZB={name:"collision",dependencies:[Jc],vs:YB,inject:KB,getUniforms:qB};class QB extends Gc{renderCollisionMap(e,n){const i=[0,0,0,0],s=[1,1,e.width-2*1,e.height-2*1];this.render({...n,clearColor:i,scissorRect:s,target:e,pass:"collision"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}getModuleParameters(){return{drawToCollisionMap:!0,picking:{isActive:1,isAttribute:!1},lightSources:{}}}}const Ch=2;class JB{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;const{device:n}=e;this.dummyCollisionMap=n.createTexture({width:1,height:1}),this.collisionFilterPass=new QB(n,{id:"default-collision-filter"})}preRender({effects:e,layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o,isPicking:a,preRenderStats:l={}}){var A;const{device:c}=this.context;if(a)return;const u=n.filter(({props:{visible:p,collisionEnabled:g}})=>p&&g);if(u.length===0){this.channels={};return}const h=e==null?void 0:e.filter(p=>p.useInPicking&&l[p.id]),f=(A=l["mask-effect"])==null?void 0:A.didRender,d=this._groupByCollisionGroup(c,u),_=i[0],v=!this.lastViewport||!this.lastViewport.equals(_)||f;for(const p in d){const g=this.collisionFBOs[p],m=d[p],[E,b]=c.canvasContext.getPixelSize();g.resize({width:E/Ch,height:b/Ch}),this._render(m,{effects:h,layerFilter:r,onViewportActive:s,views:o,viewport:_,viewportChanged:v})}}_render(e,{effects:n,layerFilter:r,onViewportActive:i,views:s,viewport:o,viewportChanged:a}){const{collisionGroup:l}=e,c=this.channels[l];if(!c)return;const u=a||e===c||!ut(c.layers,e.layers,1)||e.layerBounds.some((h,f)=>!$i(h,c.layerBounds[f]))||e.allLayersLoaded!==c.allLayersLoaded||e.layers.some(h=>h.props.transitions);if(this.channels[l]=e,u){this.lastViewport=o;const h=this.collisionFBOs[l];this.collisionFilterPass.renderCollisionMap(h,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:n,layerFilter:r,viewports:o?[o]:[],onViewportActive:i,views:s,moduleParameters:{dummyCollisionMap:this.dummyCollisionMap,devicePixelRatio:h.device.canvasContext.getDevicePixelRatio()/Ch}})}}_groupByCollisionGroup(e,n){const r={};for(const i of n){const{collisionGroup:s}=i.props;let o=r[s];o||(o={collisionGroup:s,layers:[],layerBounds:[],allLayersLoaded:!0},r[s]=o),o.layers.push(i),o.layerBounds.push(i.getBounds()),i.isLoaded||(o.allLayersLoaded=!1)}for(const i of Object.keys(r))this.collisionFBOs[i]||this.createFBO(e,i),this.channels[i]||(this.channels[i]=r[i]);for(const i of Object.keys(this.collisionFBOs))r[i]||this.destroyFBO(i);return r}getModuleParameters(e){const{collisionGroup:n}=e.props,{collisionFBOs:r,dummyCollisionMap:i}=this;return{collisionFBO:r[n],dummyCollisionMap:i}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,n){const{width:r,height:i}=e.gl.canvas,s=e.createTexture({format:"rgba8unorm",width:r,height:i,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=e.createTexture({format:"depth16unorm",width:r,height:i,mipmaps:!1,dataFormat:6402,type:5125});this.collisionFBOs[n]=e.createFramebuffer({id:`collision-${n}`,width:r,height:i,colorAttachments:[s],depthStencilAttachment:o})}destroyFBO(e){var r,i;const n=this.collisionFBOs[e];(r=n.colorAttachments[0])==null||r.destroy(),(i=n.depthStencilAttachment)==null||i.destroy(),n.destroy(),delete this.collisionFBOs[e]}}const GB={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}},Cc=class Cc extends ud{getShaders(){return{modules:[ZB]}}draw({uniforms:e,context:n,moduleParameters:r}){const{collisionEnabled:i}=this.props,{collisionFBO:s,drawToCollisionMap:o}=r,a=i&&!!s;e.collision_enabled=a,o&&(this.props=this.clone(this.props.collisionTestProps).props)}initializeState(e,n){var i;if(this.getAttributeManager()===null)return;(i=this.context.deck)==null||i._addDefaultEffect(new JB),this.getAttributeManager().add({collisionPriorities:{size:1,accessor:"getCollisionPriority",shaderAttributes:{collisionPriorities:{divisor:0},instanceCollisionPriorities:{divisor:1}}}})}getNeedsPickingBuffer(){return this.props.collisionEnabled}};Cc.defaultProps=GB,Cc.extensionName="CollisionFilterExtension";let wd=Cc;const eU={...ql.defaultProps},Pc=class Pc extends Ji{indexToBounds(){return null}renderLayers(){const{elevationScale:e,extruded:n,wireframe:r,filled:i,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:c,lineJointRounded:u,lineMiterLimit:h,lineDashJustified:f,getElevation:d,getFillColor:_,getLineColor:v,getLineWidth:A}=this.props,{updateTriggers:p,material:g,transitions:m}=this.props,E=this.getSubLayerClass("cell",ql),{updateTriggers:b,...x}=this.indexToBounds()||{};return new E({filled:i,wireframe:r,extruded:n,elevationScale:e,stroked:s,lineWidthUnits:o,lineWidthScale:a,lineWidthMinPixels:l,lineWidthMaxPixels:c,lineJointRounded:u,lineMiterLimit:h,lineDashJustified:f,material:g,transitions:m,getElevation:d,getFillColor:_,getLineColor:v,getLineWidth:A},this.getSubLayerProps({id:"cell",updateTriggers:p&&{...b,getElevation:p.getElevation,getFillColor:p.getFillColor,getLineColor:p.getLineColor,getLineWidth:p.getLineWidth}}),x)}};Pc.layerName="GeoCellLayer",Pc.defaultProps=eU;let Ed=Pc;const Ph=512;function tU(t,e){let n=0,r=0,i=1<<t.length;const s=i/Ph;for(let o=0;o<t.length;o++){i>>=1;const a=parseInt(t[o]);a%2&&(n|=i),a>1&&(r|=i)}return[[n/s,Ph-r/s],[(n+e)/s,Ph-(r+e)/s]]}function nU(t,e=1){const[n,r]=tU(t,e),[i,s]=En(n),[o,a]=En(r);return[o,s,o,a,i,a,i,s,o,s]}const rU={getQuadkey:{type:"accessor",value:t=>t.quadkey}},xc=class xc extends Ed{indexToBounds(){const{data:e,extruded:n,getQuadkey:r}=this.props,i=n?.99:1;return{data:e,_normalize:!1,positionFormat:"XY",getPolygon:(s,o)=>nU(r(s,o),i),updateTriggers:{getPolygon:i}}}};xc.layerName="QuadkeyLayer",xc.defaultProps=rU;let Po=xc;const[o0,a0,l0,c0]=[0,1,2,3],Zp=class Zp extends Ql{getShaders(){const e=super.getShaders();let n=e.vs;return n=n.replaceAll("padding.","_padding."),n=n.replace("void main(void) {",`void main(void) {
  vec4 _padding = padding + instancePixelOffsets.xyxy * vec4(1.0, 1.0, -1.0, -1.0);`),{...e,vs:n}}};Zp.layerName="EnhancedTextBackgroundLayer";let Sd=Zp;const Qp=class Qp extends Jl{filterSubLayer({layer:e,renderPass:n}){const r=e.id.includes("primary-background");return n==="collision"?r:!r}};Qp.layerName="EnhancedTextLayer";let Ad=Qp;const iU={...Jl.defaultProps,getRadius:{type:"accessor",value:1},radiusScale:{type:"number",min:0,value:1}},Mc=class Mc extends Ji{calculatePixelOffset(e){const{getTextAnchor:n,getAlignmentBaseline:r,getRadius:i,getSecondaryText:s,radiusScale:o,secondarySizeScale:a,sizeScale:l}=this.props,c=n==="middle"?0:n==="start"?1:-1,u=r==="center"?0:r==="bottom"?1:-1,h=l/4,f=l*(1+1/4),d=.6*(1-u)*l;let _=e?d:0;n==="middle"&&r==="top"&&s&&(_-=d,_-=a,_+=l);const v=1+1/4;return typeof i=="function"?(A,p)=>{const g=(p?i(A,p):1)*o*v;return[c*(g+h),u*(g+f)+_]}:[c*(i*o*v+h),u*(i*o*v+f)+_]}calculateBackgroundPadding(){const{getTextAnchor:e,getAlignmentBaseline:n,sizeScale:r}=this.props,i=12*r,s=3*r,o=[0,0,0,0];return n==="top"?o[a0]=s:n==="bottom"?o[c0]=s:(o[a0]=.5*s,o[c0]=.5*s),e==="start"?o[o0]=i:e==="end"?o[l0]=i:(o[o0]=.5*i,o[l0]=.5*i),o}renderTextLayer(e,{updateTriggers:n={},...r}){const{data:i,characterSet:s,fontFamily:o,fontSettings:a,fontWeight:l,outlineColor:c,outlineWidth:u,sizeScale:h,radiusScale:f,getAlignmentBaseline:d,getColor:_,getPosition:v,getTextAnchor:A,updateTriggers:p}=this.props;return new Ad(this.getSubLayerProps({id:e,data:i,characterSet:s,fontFamily:o,fontSettings:a,fontWeight:l,outlineColor:c,outlineWidth:u,sizeScale:h,getAlignmentBaseline:d,getColor:_,getPosition:v,getTextAnchor:A,updateTriggers:{...p,...n,getPixelOffset:[p.getRadius,p.getTextAnchor,p.getAlignmentBaseline,f,h]}}),{getSize:1,_subLayerProps:{background:{type:Sd}}},r)}renderLayers(){const{getText:e,getSecondaryColor:n,getSecondaryText:r,secondaryOutlineColor:i,secondarySizeScale:s,updateTriggers:o}=this.props,a=this.calculatePixelOffset(!1),l=this.calculateBackgroundPadding();return[this.renderTextLayer(`${o.getText}-primary`,{backgroundPadding:l,getText:e,getPixelOffset:a,background:!0}),!!r&&this.renderTextLayer(`${o.getSecondaryText}-secondary`,{getText:r,getPixelOffset:this.calculatePixelOffset(!0),getAlignmentBaseline:"top",...n&&{getColor:n},...s&&{sizeScale:s},...i&&{outlineColor:i}})]}};Mc.layerName="PointLabelLayer",Mc.defaultProps=iU;let Rd=Mc;window.oldZoom=10;class QE extends Co{draw({uniforms:e}){const{topModel:n,sideModel:r,wireframeModel:i,polygonTesselator:s}=this.state,o=this.root.props.image;o&&(n&&n.setBindings({bitmapTexture:o}),r&&r.setBindings({bitmapTexture:o}),super.draw({uniforms:e}))}getShaders(e){const n=super.getShaders(e);return n.vs=n.vs.replace("out vec4 vColor;",`out vec4 vColor;
 out vec2 vUv;
 uniform sampler2D bitmapTexture;`),n.vs=n.vs.replace("if (extruded) {",`vec2 texCoord = mod(11.0 * pos.xy, 1.0);
vUv = vec2(0.0, 1.0) + vec2(1.0, -1.0) * texCoord;
vec4 bitmapColor = texture(bitmapTexture, vUv);
float luminance = dot(vec3(0.2126, 0.7152, 0.0722), bitmapColor.rgb);
if (extruded) { `),n.vs=n.vs.replace("props.elevations * elevationScale","props.elevations * elevationScale * (0.7 + 0.3 * luminance) * bitmapColor.a"),n.vs=n.vs.replace("DECKGL_FILTER_GL_POSITION(gl_Position, geometry);",`vec4 color = colors;
#ifdef IS_SIDE_VERTEX
color *= 0.3 * bitmapColor;
#else
color *= bitmapColor;
#endif`),n.vs=n.vs.replaceAll("colors.rgb","color.rgb"),n.vs=n.vs.replaceAll("colors.a","color.a"),n}}QE.defaultProps={...Co.defaultProps,image:{type:"image",value:null,async:!0}};Po.defaultProps._subLayerProps={cell:{_subLayerProps:{fill:{type:QE}}}};Po.defaultProps.image={type:"image",value:null,async:!0};const sU={longitude:-5,latitude:40,zoom:4,maxZoom:16,maxPitch:30,minPitch:30,pitch:30,bearing:0},u0={blendColorOperation:"add",blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one",blendAlphaOperation:"add",blendAlphaSrcFactor:"one-minus-dst-alpha",blendAlphaDstFactor:"one",depthTest:!1};function JE(t,e=1){const n=[];for(const r of t)for(const i of["0","1","2","3"])n.push({...r,quadkey:r.quadkey+i});return e>1?JE(n,e-1):n}const oU=JE([{quadkey:"300000000000"}],8);function h0(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}const aU=new zp(["bearing"]),f0="Filename (PLEASE ENTER FILE NAME NOT LINK!!!)",lU=new $w({color:[255,255,255],intensity:1}),cU=new tI({timestamp:Date.UTC(2019,7,1,22),color:[255,255,255],intensity:1}),GE=new Up({ambientLight:lU,dirLight:cU});GE.shadowColor=[0,0,0,.1];function uU({mapStyle:t="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json"}){const[e,n]=V.useState(sU),[r,i]=V.useState(null),s=V.useCallback(()=>{n(h=>({...h,bearing:h.bearing+20,transitionDuration:3e3,bearingInterpolator:aU}))},[]),o={data:"https://docs.google.com/spreadsheets/d/e/2PACX-1vRK42B3IICb5pF1Vvegeqg05QEbC1RhPDlxvT9rv041j52zZByn92jhOQUVqcwe2qrAcU1A6j8XER9q/pub?gid=0&single=true&output=csv",dataTransform:h=>h.data.filter(f=>f.Longitude&&f.Latitude),loaders:[Ap],loadOptions:{csv:{header:!0}},getPosition:h=>[h.Longitude,h.Latitude],getRadius:5},a=[new Rd({id:"point-label",...o,extensions:[new wd],getText:h=>h.Name,sizeScale:14,getAlignmentBaseline:"top",getColor:[222,222,222],outlineColor:[255,255,255],fontSettings:{fontSize:64,radius:24,sdf:!0},outlineWidth:1}),new dd({id:"point",...o,radiusUnits:"pixels",stroked:!0,radiusMinPixels:5,pickable:!0,autoHighlight:!0,onClick:h=>{const f=h.object;window.oldZoom=e.zoom,i(f),n(d=>({...d,longitude:f.Longitude,latitude:f.Latitude,zoom:11.5,bearing:d.bearing-30,transitionInterpolator:new Dy({curve:2}),transitionDuration:3e3,transitionEasing:h0,onTransitionEnd:s}))},lineWidthMinPixels:2,getFillColor:h=>h[f0]?[10,137,255]:[100,100,100],getLineColor:[255,255,255,255],parameters:u0}),r&&new Po({id:"amigo",data:oU,image:`pictures/${r[f0]}`,getQuadkey:h=>h.quadkey,coordinateSystem:ee.LNGLAT_OFFSETS,coordinateOrigin:[r.Longitude-.05,r.Latitude+.05],elevationScale:e.zoom>11?100:30,extruded:!0,filled:!0,getElevation:15,getFillColor:[205,235,255,180],opacity:.5,wireframe:!1,parameters:u0,pickable:!0,autoHighlight:!0,highlightColor:[255,255,255,40],transitions:{elevationScale:{type:"spring",stiffness:.1,damping:.15}}})];function l({layer:h,viewport:f}){return h.id.includes("point")?f.zoom<11||!r:h.id.includes("amigo")?f.zoom>7:!0}const c=()=>{n(h=>({...h,zoom:window.oldZoom,bearing:0,transitionInterpolator:new Dy({curve:2}),transitionDuration:2e3,transitionEasing:h0,onTransitionEnd:()=>i(null)}))},u=Math.round(Math.min(Math.max(0,(e.zoom-8)/4),1));return In.createElement(In.Fragment,null,In.createElement(pD,{layers:a,effects:[GE],viewState:e,layerFilter:l,controller:!0,onViewStateChange:h=>n(h.viewState)},In.createElement(TR,{reuseMaps:!0,mapStyle:t})),In.createElement("div",{onClick:c,style:{position:"absolute",color:"white",margin:"20px",padding:"20px",fontSize:"18px",borderRadius:"40px",background:"rgba(255, 255, 255, 0.3)",opacity:u,transition:"opacity 1s ease-in-out 0s",border:"1px solid #aaa",cursor:"pointer"}}," Back"),In.createElement("div",{style:{position:"absolute",right:0,color:"white",margin:"20px",padding:"20px",fontSize:"30px",borderRadius:"40px",background:"rgba(255, 255, 255, 0.3)",opacity:u,transition:"opacity 1s ease-in-out 0s",border:"1px solid #aaa"}},"Amigo: "+(r?r.Name:"")),In.createElement("img",{src:"artista.png",style:{pointerEvents:"none",position:"absolute",right:0,height:"500px",bottom:0}}))}function hU(t){AT(t).render(In.createElement(uU,null))}hU(document.getElementById("app"));export{dU as c,bd as g};
