"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[5114],{20633:(e,t,r)=>{r.d(t,{i:()=>ze});var i=r(86428),s=r(4999);const n="4.2.1",o={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};Object.keys(o);var a=r(94976);function l(e,t,r){(0,a.v)(e instanceof ArrayBuffer);const i=new TextDecoder("utf8"),s=new Uint8Array(e,t,r);return i.decode(s)}var c=r(53618),h=r(38925),u=r(10033),d=r(87597);const p={[u.Zf.DOUBLE]:Float64Array,[u.Zf.FLOAT]:Float32Array,[u.Zf.UNSIGNED_SHORT]:Uint16Array,[u.Zf.UNSIGNED_INT]:Uint32Array,[u.Zf.UNSIGNED_BYTE]:Uint8Array,[u.Zf.BYTE]:Int8Array,[u.Zf.SHORT]:Int16Array,[u.Zf.INT]:Int32Array},f={DOUBLE:u.Zf.DOUBLE,FLOAT:u.Zf.FLOAT,UNSIGNED_SHORT:u.Zf.UNSIGNED_SHORT,UNSIGNED_INT:u.Zf.UNSIGNED_INT,UNSIGNED_BYTE:u.Zf.UNSIGNED_BYTE,BYTE:u.Zf.BYTE,SHORT:u.Zf.SHORT,INT:u.Zf.INT},m="Failed to convert GL type";class y{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in p){if(p[t]===e)return t}throw new Error(m)}static fromName(e){const t=f[e];if(!t)throw new Error(m);return t}static getArrayType(e){switch(e){case u.Zf.UNSIGNED_SHORT_5_6_5:case u.Zf.UNSIGNED_SHORT_4_4_4_4:case u.Zf.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=p[e];if(!t)throw new Error(m);return t}}static getByteSize(e){return y.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(y.getArrayType(e))}static createTypedArray(e,t,r=0,i){void 0===i&&(i=(t.byteLength-r)/y.getByteSize(e));return new(y.getArrayType(e))(t,r,i)}}class T{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,t){this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t=u.GL.UNSIGNED_INT,r=1){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,i.byteOffset):i}getPropertyArray(e,t,r){const i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=y.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,r,i,s){const n=this.json[e];if(!n)return n;const o=this.getPropertyArray(e,t,r);if(1===r)return o[i];for(let a=0;a<r;++a)s[a]=o[r*i+a];return s}_getTypedArrayFromBinary(e,t,r,i,s){const n=this._cachedTypedArrays;let o=n[e];return o||(o=y.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,i*r),n[e]=o),o}_getTypedArrayFromArray(e,t,r){const i=this._cachedTypedArrays;let s=i[e];return s||(s=y.createTypedArray(t,r),i[e]=s),s}}const g={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},b={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}};const w=e=>void 0!==e;function S(e,t,r){if(!t)return null;let i=e.getExtension("3DTILES_batch_table_hierarchy");const s=t.HIERARCHY;return s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,i=s),i?function(e,t){let r,i,s;const n=e.instancesLength,o=e.classes;let a,l=e.classIds,c=e.parentCounts,h=e.parentIds,u=n;w(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,s=getBinaryAccessor(l),l=s.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,n));if(w(c))for(w(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,s=getBinaryAccessor(c),c=s.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,n)),a=new Uint16Array(n),u=0,r=0;r<n;++r)a[r]=u,u+=c[r];w(h)&&w(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,s=getBinaryAccessor(h),h=s.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,u));const d=o.length;for(r=0;r<d;++r){const e=o[r].length,i=o[r].instances,s=getBinaryProperties(e,i,t);o[r].instances=combine(s,i)}const p=new Array(d).fill(0),f=new Uint16Array(n);for(r=0;r<n;++r)i=l[r],f[r]=p[i],++p[i];const m={classes:o,classIds:l,classIndexes:f,parentCounts:c,parentIndexes:a,parentIds:h};return function(e){const t=e.classIds,r=t.length;for(let i=0;i<r;++i)P(e,i,stack)}(m),m}(i,r):null}function E(e,t,r){if(!e)return;const i=e.parentCounts;return e.parentIds?r(e,t):i>0?function(e,t,r){const i=e.classIds,s=e.parentCounts,n=e.parentIds,o=e.parentIndexes,a=i.length,l=scratchVisited;l.length=Math.max(l.length,a);const c=++marker,h=scratchStack;h.length=0,h.push(t);for(;h.length>0;){if(l[t=h.pop()]===c)continue;l[t]=c;const i=r(e,t);if(w(i))return i;const a=s[t],u=o[t];for(let e=0;e<a;++e){const r=n[u+e];r!==t&&h.push(r)}}return null}(e,t,r):function(e,t,r){let i=!0;for(;i;){const s=r(e,t);if(w(s))return s;const n=e.parentIds[t];i=n!==t,t=n}throw new Error("traverseHierarchySingleParent")}(e,t,r)}function P(e,t,r){const i=e.parentCounts,s=e.parentIds,n=e.parentIndexes,o=e.classIds.length;if(!w(s))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(-1===r.indexOf(t),"Circular dependency detected in the batch table hierarchy."),r.push(t);const a=w(i)?i[t]:1,l=w(i)?n[t]:t;for(let c=0;c<a;++c){const i=s[l+c];i!==t&&P(e,i,r)}r.pop(t)}function A(e){return null!=e}const I=(e,t)=>e,C={HIERARCHY:!0,extensions:!0,extras:!0};class O{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,t,r,i={}){(0,a.v)(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=this.json?.extensions||{},this._properties={};for(const s in this.json)C[s]||(this._properties[s]=this.json[s]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=S(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._hierarchy){return A(E(this._hierarchy,e,((e,r)=>{const i=e.classIds[r];return e.classes[i].name===t})))}return!1}isExactClass(e,t){return(0,a.v)("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),(0,a.v)("string"==typeof t,t),A(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=A(t)?t:[]).length=0;const r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._binaryProperties){const r=this._binaryProperties[t];if(A(r))return this._getBinaryProperty(r,e)}const r=this._properties[t];if(A(r))return I(r[e]);if(this._hierarchy){const r=this._getHierarchyProperty(e,t);if(A(r))return r}}setProperty(e,t,r){const i=this.featureCount;if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._binaryProperties){const i=this._binaryProperties[t];if(i)return void this._setBinaryProperty(i,e,r)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let s=this._properties[t];A(s)||(this._properties[t]=new Array(i),s=this._properties[t]),s[e]=I(r)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const r=this._properties[t],i=this._initializeBinaryProperty(t,r);i&&(e=e||{},e[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const r=t;(0,a.v)(this.binary,`Property ${e} requires a batch table binary.`),(0,a.v)(r.type,`Property ${e} requires a type.`);const i=function(e,t,r,i){const{componentType:s}=e;(0,a.v)(e.componentType);const n="string"==typeof s?y.fromName(s):s,o=g[e.type],l=_[e.type],c=b[e.type];return r+=e.byteOffset,{values:y.createTypedArray(n,t,r,o*i),type:n,size:o,unpacker:l,packer:c}}(r,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:i.values,componentCount:i.size,unpack:i.unpacker,pack:i.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const r=E(this._hierarchy,e,((e,r)=>{const i=e.classIds[r];return A(e.classes[i].instances[t])}));return A(r)}_getPropertyNamesInHierarchy(e,t){E(this._hierarchy,e,((e,r)=>{const i=e.classIds[r],s=e.classes[i].instances;for(const n in s)s.hasOwnProperty(n)&&-1===t.indexOf(n)&&t.push(n)}))}_getHierarchyProperty(e,t){return E(this._hierarchy,e,((e,r)=>{const i=e.classIds[r],s=e.classes[i],n=e.classIndexes[r],o=s.instances[t];return A(o)?A(o.typedArray)?this._getBinaryProperty(o,n):I(o[n]):null}))}_setHierarchyProperty(e,t,r,i){const s=E(this._hierarchy,t,((e,s)=>{const n=e.classIds[s],o=e.classes[n],l=e.classIndexes[s],c=o.instances[r];return!!A(c)&&((0,a.v)(s===t,`Inherited property "${r}" is read-only.`),A(c.typedArray)?this._setBinaryProperty(c,l,i):c[l]=I(i),!0)}));return A(s)}}function N(e,t,r=0){const i=new DataView(t);if(e.magic=i.getUint32(r,!0),r+=4,e.version=i.getUint32(r,!0),r+=4,e.byteLength=i.getUint32(r,!0),r+=4,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return r}const v="b3dm tile in legacy format.";function x(e,t,r){const i=new DataView(t);let s;e.header=e.header||{};let n=i.getUint32(r,!0);r+=4;let o=i.getUint32(r,!0);r+=4;let a=i.getUint32(r,!0);r+=4;let l=i.getUint32(r,!0);return r+=4,a>=570425344?(r-=8,s=n,a=o,l=0,n=0,o=0,console.warn(v)):l>=570425344&&(r-=4,s=a,a=n,l=o,n=0,o=0,console.warn(v)),e.header.featureTableJsonByteLength=n,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=l,e.header.batchLength=s,r}function M(e,t,r,i){return r=function(e,t,r){const{featureTableJsonByteLength:i,featureTableBinaryByteLength:s,batchLength:n}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:n||0},i&&i>0){const s=l(t,r,i);e.featureTableJson=JSON.parse(s)}return r+=i||0,e.featureTableBinary=new Uint8Array(t,r,s),r+=s||0,r}(e,t,r),r=function(e,t,r){const{batchTableJsonByteLength:i,batchTableBinaryByteLength:s}=e.header||{};if(i&&i>0){const n=l(t,r,i);e.batchTableJson=JSON.parse(n),r+=i,s&&s>0&&(e.batchTableBinary=new Uint8Array(t,r,s),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=s)}return r}(e,t,r),r}function L(e,t=[0,0,0]){const r=e>>11&31,i=e>>5&63,s=31&e;return t[0]=r<<3,t[1]=i<<2,t[2]=s<<3,t}function R(e,t,r){if(!(t||e&&e.batchIds&&r))return null;const{batchIds:i,isRGB565:s,pointCount:n=0}=e;if(i&&r){const e=new Uint8ClampedArray(3*n);for(let t=0;t<n;t++){const s=i[t],n=r.getProperty(s,"dimensions").map((e=>255*e));e[3*t]=n[0],e[3*t+1]=n[1],e[3*t+2]=n[2]}return{type:u.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(t&&s){const e=new Uint8ClampedArray(3*n);for(let r=0;r<n;r++){const i=L(t[r]);e[3*r]=i[0],e[3*r+1]=i[1],e[3*r+2]=i[2]}return{type:u.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*n?{type:u.GL.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:u.GL.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}var U=r(77422),D=r(54901);new U.I,new d.P,new U.I,new U.I,new Uint8Array(1);function B(e,t=255){return(0,D.qE)(e,0,t)/t*2-1}function V(e){return e<0?-1:1}function G(e,t,r,i){if(function(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}(i),e<0||e>r||t<0||t>r)throw new Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=B(e,r),i.y=B(t,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){const e=i.x;i.x=(1-Math.abs(i.y))*V(e),i.y=(1-Math.abs(e))*V(i.y)}return i.normalize()}function z(e,t,r){return G(e,t,255,r)}const q=new d.P;function F(e,t,r){return e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){const r=new d.P,i=new Float32Array(3*e.pointCount);for(let s=0;s<e.pointCount;s++)r.set(t[3*s],t[3*s+1],t[3*s+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(i,3*s);return i}(e,t)):{type:u.GL.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}async function H(e,t,r,i,s){r=M(e,t,r=x(e,t,r=N(e,t,r))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}(e);const{featureTable:n,batchTable:o}=function(e){const t=new T(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3);const i=function(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",u.GL.UNSIGNED_SHORT,1),e.batchIds)){const i=t.getGlobalProperty("BATCH_LENGTH");if(!i)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:s,batchTableBinary:n}=e;r=new O(s,n,i)}return r}(e,t);return{featureTable:t,batchTable:i}}(e);return await async function(e,t,r,i,s){let n,o,a;const l=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const u=t.getExtension("3DTILES_draco_point_compression");if(u){o=u.properties;const t=u.byteOffset,r=u.byteLength;if(!o||!Number.isFinite(t)||!r)throw new Error("Draco properties, byteOffset, and byteLength must be defined");n=(e.featureTableBinary||[]).slice(t,t+r),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!n)return!0;const p={buffer:n,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(e,t,r,i){if(!i)return;const s={...r,draco:{...r?.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];const n=await(0,h.N9)(t.buffer,c.Vl,s,i),o=n.attributes.POSITION&&n.attributes.POSITION.value,a=n.attributes.COLOR_0&&n.attributes.COLOR_0.value,l=n.attributes.NORMAL&&n.attributes.NORMAL.value,u=n.attributes.BATCH_ID&&n.attributes.BATCH_ID.value,p=o&&n.attributes.POSITION.value.quantization,f=l&&n.attributes.NORMAL.value.quantization;if(p){const t=n.POSITION.data.quantization,r=t.range;e.quantizedVolumeScale=new d.P(r,r,r),e.quantizedVolumeOffset=new d.P(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}f&&(e.octEncodedRange=(1<<n.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const m={};if(t.batchTableProperties)for(const c of Object.keys(t.batchTableProperties))n.attributes[c]&&n.attributes[c].value&&(m[c.toLowerCase()]=n.attributes[c].value);e.attributes={positions:o,colors:R(e,a,void 0),normals:l,batchIds:u,...m}}(e,p,i,s)}(e,n,0,i,s),function(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",u.GL.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const i=t.getPropertyArray("POSITION_QUANTIZED",u.GL.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",u.GL.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",u.GL.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=F(e,i,r)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(e,n,i),function(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let i=null;t.hasProperty("RGBA")?(i=t.getPropertyArray("RGBA",u.GL.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?i=t.getPropertyArray("RGB",u.GL.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(i=t.getPropertyArray("RGB565",u.GL.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=R(e,i,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",u.GL.UNSIGNED_BYTE,4))}(e,n,o),function(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",u.GL.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",u.GL.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){const r=new Float32Array(3*(e.pointsLength||0));for(let i=0;i<(e.pointsLength||0);i++)z(t[2*i],t[2*i+1],q),q.toArray(r,3*i);return{type:u.GL.FLOAT,size:2,value:r}}return{type:u.GL.FLOAT,size:2,value:t}}(e,r)}}(e,n),r}var k=r(78750),Z=r(59737),j=r(27885),$=r(10048);const W=0,Y=1;function Q(e,t,r,i){e.rotateYtoZ=!0;const s=(e.byteOffset||0)+(e.byteLength||0)-r;if(0===s)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=(0,$._m)(t,r,s),e.gltfByteOffset=0,e.gltfByteLength=s,r%4==0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function J(e,t,r,i){const s=r?.["3d-tiles"]||{};if(function(e,t){switch(t){case W:if(e.gltfArrayBuffer){const t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),r=(new TextDecoder).decode(t);e.gltfUrl=r.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Y:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),s.loadGLTF){if(!i)return;if(e.gltfUrl){const{fetch:t}=i,s=await t(e.gltfUrl,r);e.gltfArrayBuffer=await s.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const t=await(0,h.N9)(e.gltfArrayBuffer,k.B,r,i);e.gltf=(0,Z.R)(t),e.gpuMemoryUsageInBytes=(0,j.S3)(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}async function X(e,t,r,i,s){r=function(e,t,r,i){r=N(e,t,r),r=x(e,t,r),r=M(e,t,r),r=Q(e,t,r,i);const s=new T(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=s.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3),r}(e,t,r,i),await J(e,Y,i,s);const n=e?.gltf?.extensions;return n&&n.CESIUM_RTC&&(e.rtcCenter=n.CESIUM_RTC.center),r}var K=r(35567),ee=r(11633),te=r(31886),re=r(4912);async function ie(e,t,r,i,s){return r=function(e,t,r,i){if(r=N(e,t,r),1!==e.version)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);r=x(e,t,r);const s=new DataView(t);if(e.gltfFormat=s.getUint32(r,!0),r+=4,r=M(e,t,r),r=Q(e,t,r,i),!e?.header?.featureTableJsonByteLength||0===e.header.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const n=new T(e.featureTableJson,e.featureTableBinary),o=n.getGlobalProperty("INSTANCES_LENGTH");if(n.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=n.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=n.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3);new O(e.batchTableJson,e.batchTableBinary,o);return function(e,t,r,i){const s=new Array(i),n=new d.P,o=new d.P,a=new d.P,l=new d.P,c=new K.d,h=new ee.P,p=new d.P,f={},m=new te.k,y=[],T=[],g=[],_=[];for(let d=0;d<i;d++){let r;if(t.hasProperty("POSITION"))r=t.getProperty("POSITION",u.GL.FLOAT,3,d,n);else if(t.hasProperty("POSITION_QUANTIZED")){r=t.getProperty("POSITION_QUANTIZED",u.GL.UNSIGNED_SHORT,3,d,n);const e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",u.GL.FLOAT,3);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const i=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",u.GL.FLOAT,3);if(!i)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const s=65535;for(let t=0;t<3;t++)r[t]=r[t]/s*i[t]+e[t]}if(!r)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");n.copy(r),f.translation=n,e.normalUp=t.getProperty("NORMAL_UP",u.GL.FLOAT,3,d,y),e.normalRight=t.getProperty("NORMAL_RIGHT",u.GL.FLOAT,3,d,T);const i=!1;if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",u.GL.UNSIGNED_SHORT,2,d,y),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",u.GL.UNSIGNED_SHORT,2,d,T),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(re.C.WGS84.eastNorthUpToFixedFrame(n,m),m.getRotationMatrix3(c)):c.identity()}i&&(l.copy(o).cross(a).normalize(),c.setColumn(0,o),c.setColumn(1,a),c.setColumn(2,l)),h.fromMatrix3(c),f.rotation=h,p.set(1,1,1);const b=t.getProperty("SCALE",u.GL.FLOAT,1,d,g);Number.isFinite(b)&&p.multiplyByScalar(b);const w=t.getProperty("SCALE_NON_UNIFORM",u.GL.FLOAT,3,d,y);w&&p.scale(w),f.scale=p;let S=t.getProperty("BATCH_ID",u.GL.UNSIGNED_SHORT,1,d,_);void 0===S&&(S=d);const E=(new te.k).fromQuaternion(f.rotation);m.identity(),m.translate(f.translation),m.multiplyRight(E),m.scale(f.scale);const P=m.clone();s[d]={modelMatrix:P,batchId:S}}e.instances=s}(e,n,0,o),r}(e,t,r,i),await J(e,e.gltfFormat||0,i,s),r}async function se(e,t=0,r,i,s={shape:"tile3d"}){switch(s.byteOffset=t,s.type=function(e,t=0){const r=new DataView(e);return`${String.fromCharCode(r.getUint8(t+0))}${String.fromCharCode(r.getUint8(t+1))}${String.fromCharCode(r.getUint8(t+2))}${String.fromCharCode(r.getUint8(t+3))}`}(e,t),s.type){case o.COMPOSITE:return await async function(e,t,r,i,s,n){r=N(e,t,r);const o=new DataView(t);for(e.tilesLength=o.getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-r>12;){const o={shape:"tile3d"};e.tiles.push(o),r=await n(t,r,i,s,o)}return r}(s,e,t,r,i,se);case o.BATCHED_3D_MODEL:return await X(s,e,t,r,i);case o.GLTF:return await async function(e,t,r,i){if(e.rotateYtoZ=!0,e.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!i)return t.byteLength;const s=await(0,h.N9)(t,k.B,r,i);e.gltf=(0,Z.R)(s),e.gpuMemoryUsageInBytes=(0,j.S3)(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}(s,e,r,i);case o.INSTANCED_3D_MODEL:return await ie(s,e,t,r,i);case o.POINT_CLOUD:return await H(s,e,t,r,i);default:throw new Error(`3DTileLoader: unknown type ${s.type}`)}}async function ne(e,t,r,i){const s=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if("number"!=typeof s)return;const n=e.bufferViews[s],o=e.buffers[n.buffer];if(!i?.baseUrl)throw new Error("Url is not provided");if(!i.fetch)throw new Error("fetch is not provided");if(o.uri){const e=`${i?.baseUrl||""}/${o.uri}`,r=await i.fetch(e),s=await r.arrayBuffer();return void(t.explicitBitstream=new Uint8Array(s,n.byteOffset,n.byteLength))}const a=e.buffers.slice(0,n.buffer).reduce(((e,t)=>e+t.byteLength),0);t.explicitBitstream=new Uint8Array(r.slice(a,a+o.byteLength),n.byteOffset,n.byteLength)}function oe(e){const t=new DataView(e);return t.getUint32(0,!0)+2**32*t.getUint32(4,!0)}const ae={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:n,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(e,t,r){if(1952609651!==new Uint32Array(e.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(e.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const i=oe(e.slice(8,16)),s=new Uint8Array(e,24,i),n=new TextDecoder("utf8").decode(s),o=JSON.parse(n),a=oe(e.slice(16,24));let l=new ArrayBuffer(0);if(a&&(l=e.slice(24+i)),await ne(o,o.tileAvailability,l,r),Array.isArray(o.contentAvailability))for(const c of o.contentAvailability)await ne(o,c,l,r);else await ne(o,o.contentAvailability,l,r);return await ne(o,o.childSubtreeAvailability,l,r),o},options:{}};var le=r(327),ce=r(85335);globalThis.probe={};const he=new ce.t({id:"@probe.gl/log"});var ue=r(81456);function de(e){"X"===e&&(e="");const t=e.padEnd(16,"0");return ue.fromString(t,!0,16)}var pe=r(67733);const fe=180/Math.PI;function me(e,t,r){const i=1<<t;return[(e[0]+r[0])/i,(e[1]+r[1])/i]}function ye(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function Te(e){return[ye(e[0]),ye(e[1])]}function ge(e,[t,r]){switch(e){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw new Error("Invalid face")}}function _e([e,t,r]){const i=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*fe,i*fe]}function be(e,t,r,i){if(0===i){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const i=t[0];t[0]=t[1],t[1]=i}}function we(e){const t=function(e){if(e.indexOf("/")>0)return e;const t=de(e);return function(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<64;)t="0"+t;const r=t.lastIndexOf("1"),i=t.substring(0,3),s=t.substring(3,r),n=s.length/2,o=ue.fromString(i,!0,2).toString(10);let a="";if(0!==n)for(a=ue.fromString(s,!0,2).toString(4);a.length<n;)a="0"+a;return`${o}/${a}`}(t)}(e);return function(e){if(0===e.length)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),r=parseInt(t[0],10),i=t[1],s=i.length;let n=0;const o=[0,0];for(let a=s-1;a>=0;a--){n=s-a;const e=i[a];let t=0,r=0;"1"===e?r=1:"2"===e?(t=1,r=1):"3"===e&&(t=1);const l=Math.pow(2,n-1);be(l,o,t,r),o[0]+=l*t,o[1]+=l*r}if(r%2==1){const e=o[0];o[0]=o[1],o[1]=e}return{face:r,ij:o,level:n}}(t)}function Se(e){const{face:t,ij:r,level:i}=e,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(100*Math.pow(2,-i))),o=new Float64Array(4*n*2+2);let a=0,l=0;for(let c=0;c<4;c++){const e=s[c].slice(0),h=s[c+1],u=(h[0]-e[0])/n,d=(h[1]-e[1])/n;for(let s=0;s<n;s++){e[0]+=u,e[1]+=d;const s=_e(ge(t,Te(me(r,i,e))));Math.abs(s[1])>89.999&&(s[0]=l);const n=s[0]-l;s[0]+=n>180?-360:n<-180?360:0,o[a++]=s[0],o[a++]=s[1],l=s[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Ee(e){if(e.length%2!=0)throw new Error("Invalid corners");const t=[],r=[];for(let i=0;i<e.length;i+=2)t.push(e[i]),r.push(e[i+1]);return t.sort(((e,t)=>e-t)),r.sort(((e,t)=>e-t)),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function Pe(e,t){const r=t?.minimumHeight||0,i=t?.maximumHeight||0,s=function(e){let t;if(2===e.face||5===e.face){let r=null,i=0;for(let t=0;t<4;t++){const s=Se(we(`${e.face}/${t}`));null==r&&(r=new Float64Array(4*s.length)),r.set(s,i),i+=s.length}t=Ee(r)}else t=Ee(Se(e));return t}(we(e)),n=s.west,o=s.south,a=s.east,l=s.north,c=[];return c.push(new d.P(n,l,r)),c.push(new d.P(a,l,r)),c.push(new d.P(a,o,r)),c.push(new d.P(n,o,r)),c.push(new d.P(n,l,i)),c.push(new d.P(a,l,i)),c.push(new d.P(a,o,i)),c.push(new d.P(n,o,i)),c}function Ae(e){return function(e){const t=Te(me(e.ij,e.level,[.5,.5]));return _e(ge(e.face,t))}(we(e))}function Ie(e){const t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},i=Pe(t,r),s=Ae(t),n=s[0],o=s[1],a=re.C.WGS84.cartographicToCartesian([n,o,r.maximumHeight]),l=new d.P(a[0],a[1],a[2]);i.push(l);const c=(0,pe.ZZ)(i);return[...c.center,...c.halfAxes]}const Ce={QUADTREE:4,OCTREE:8};function Oe(e,t,r){if(e?.box){const i=function(e,t){const r=function(e){return e.and(e.not().add(1))}(e).shiftRightUnsigned(2);return e.add(ue.fromNumber(2*t+1-4).multiply(r))}(de(e.s2VolumeInfo.token),t),s=function(e){if(e.isZero())return"X";let t=e.countTrailingZeros();t=(t-t%4)/4;const r=t;t*=4;const i=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-r-i.length).join("0")+i}(i),n={...e.s2VolumeInfo};if(n.token=s,"OCTREE"===r){const t=e.s2VolumeInfo,r=t.maximumHeight-t.minimumHeight,i=r/2,s=t.minimumHeight+r/2;t.minimumHeight=s-i,t.maximumHeight=s+i}return{box:Ie(n),s2VolumeInfo:n}}}async function Ne(e){const{implicitOptions:t,parentData:r={mortonIndex:0,x:0,y:0,z:0},childIndex:i=0,s2VolumeBox:s,loaderOptions:n}=e;let{subtree:o,level:a=0,globalData:l={level:0,mortonIndex:0,x:0,y:0,z:0}}=e;const{subdivisionScheme:c,subtreeLevels:h,maximumLevel:u,contentUrlTemplate:d,subtreesUriTemplate:p,basePath:f}=t,m={children:[],lodMetricValue:0,contentUrl:""};if(!u)return he.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${d} won't be loaded...`),m;const y=a+l.level;if(y>u)return m;const T=Ce[c],g=Math.log2(T),_=1&i,b=i>>1&1,w=i>>2&1,S=(T**a-1)/(T-1);let E=Me(r.mortonIndex,i,g),P=S+E,A=Me(r.x,_,1),I=Me(r.y,b,1),C=Me(r.z,w,1),O=!1;a>=h&&(O=ve(o.childSubtreeAvailability,E));const N=Me(l.x,A,a),v=Me(l.y,I,a),x=Me(l.z,C,a);if(O){const e=Le(`${f}/${p}`,y,N,v,x);o=await(0,le.H)(e,ae,n),l={mortonIndex:E,x:A,y:I,z:C,level:a},E=0,P=0,A=0,I=0,C=0,a=0}if(!ve(o.tileAvailability,P))return m;ve(o.contentAvailability,P)&&(m.contentUrl=Le(d,y,N,v,x));const M=a+1,L={mortonIndex:E,x:A,y:I,z:C};for(let R=0;R<T;R++){const e=Oe(s,R,c),r=await Ne({subtree:o,implicitOptions:t,loaderOptions:n,parentData:L,childIndex:R,level:M,globalData:{...l},s2VolumeBox:e});if(r.contentUrl||r.children.length){const e=xe(r,y+1,{childTileX:A,childTileY:I,childTileZ:C},t,s);m.children.push(e)}}return m}function ve(e,t){let r;return Array.isArray(e)?(r=e[0],e.length>1&&he.once('Not supported extension "3DTILES_multiple_contents" has been detected')):r=e,"constant"in r?Boolean(r.constant):!!r.explicitBitstream&&function(e,t){const r=Math.floor(e/8),i=e%8;return 1==(t[r]>>i&1)}(t,r.explicitBitstream)}function xe(e,t,r,i,s){const{basePath:n,refine:o,getRefine:a,lodMetricType:l,getTileType:c,rootLodMetricValue:h,rootBoundingVolume:u}=i,d=e.contentUrl&&e.contentUrl.replace(`${n}/`,""),p=h/2**t,f=function(e,t,r){if(t.region){const{childTileX:i,childTileY:s,childTileZ:n}=r,[o,a,l,c,h,u]=t.region,d=2**e,p=(l-o)/d,f=(c-a)/d,m=(u-h)/d,[y,T]=[o+p*i,o+p*(i+1)],[g,_]=[a+f*s,a+f*(s+1)],[b,w]=[h+m*n,h+m*(n+1)];return{region:[y,g,T,_,b,w]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}(t,s?.box?{box:s.box}:u,r);return{children:e.children,contentUrl:e.contentUrl,content:{uri:d},id:e.contentUrl,refine:a(o),type:c(e),lodMetricType:l,lodMetricValue:p,geometricError:p,transform:e.transform,boundingVolume:f}}function Me(e,t,r){return(e<<r)+t}function Le(e,t,r,i,s){const n=function(e){const t={};for(const r in e)t[`{${r}}`]=e[r];return t}({level:t,x:r,y:i,z:s});return e.replace(/{level}|{x}|{y}|{z}/gi,(e=>n[e]))}function Re(e,t=""){if(!t)return s.WH.EMPTY;const r=t.split("?")[0].split(".").pop();switch(r){case"pnts":return s.WH.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return s.WH.SCENEGRAPH;default:return r||s.WH.EMPTY}}function Ue(e){switch(e){case"REPLACE":case"replace":return s.lH.REPLACE;case"ADD":case"add":return s.lH.ADD;default:return e}}function De(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const r=new URL(e,`${t}/`);return decodeURI(r.toString())}return e.startsWith("/")?e:i.hd(t,e)}function Be(e,t){if(!e)return null;let r;if(e.content){const i=e.content.uri||e.content?.url;void 0!==i&&(r=De(i,t))}return{...e,id:r,contentUrl:r,lodMetricType:s.ir.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Re(0,r),refine:Ue(e.refine)}}async function Ve(e,t,r,i,n){const{subdivisionScheme:o,maximumLevel:a,availableLevels:l,subtreeLevels:c,subtrees:{uri:h}}=i,u=De(Le(h,0,0,0,0),r),d=await(0,le.H)(u,ae,n),p=e.content?.uri,f=p?De(p,r):"",m=t?.root?.refine,y=e.geometricError,T=e.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(T){const t={box:Ie(T),s2VolumeInfo:T};e.boundingVolume=t}const g=e.boundingVolume,_={contentUrlTemplate:f,subtreesUriTemplate:h,subdivisionScheme:o,subtreeLevels:c,maximumLevel:Number.isFinite(l)?l-1:a,refine:m,basePath:r,lodMetricType:s.ir.GEOMETRIC_ERROR,rootLodMetricValue:y,rootBoundingVolume:g,getTileType:Re,getRefine:Ue};return await async function(e,t,r,i,n){if(!e)return null;const{children:o,contentUrl:a}=await Ne({subtree:r,implicitOptions:i,loaderOptions:n});let l,c=null;a&&(l=a,c={uri:a.replace(`${t}/`,"")});const h={...e,id:l,contentUrl:l,lodMetricType:s.ir.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Re(0,l),refine:Ue(e.refine),content:c||e.content,children:o};return h}(e,r,d,_,n)}function Ge(e){return e?.extensions?.["3DTILES_implicit_tiling"]||e?.implicitTiling}const ze={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:n,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e,t={},r){const n=t["3d-tiles"]||{};let o;o="auto"===n.isTileset?r?.url&&-1!==r.url.indexOf(".json"):n.isTileset;return o?async function(e,t,r){const n=JSON.parse((new TextDecoder).decode(e)),o=r?.url||"",a=function(e){return i.pD(e)}(o),l=await async function(e,t,r){let i=null;const s=Ge(e.root);i=s&&e.root?await Ve(e.root,e,t,s,r):Be(e.root,t);const n=[];for(n.push(i);n.length>0;){const i=n.pop()||{},s=i.children||[],o=[];for(const a of s){const i=Ge(a);let s;s=i?await Ve(a,e,t,i,r):Be(a,t),s&&(o.push(s),n.push(s))}i.children=o}return i}(n,a,t||{}),c={...n,shape:"tileset3d",loader:ze,url:o,queryString:r?.queryString||"",basePath:a,root:l||n.root,type:s.yy.TILES3D,lodMetricType:s.ir.GEOMETRIC_ERROR,lodMetricValue:n.root?.geometricError||0};return c}(e,t,r):async function(e,t,r){const i={content:{shape:"tile3d",featureIds:null}},s=0;return await se(e,s,t,r,i.content),i.content}(e,t,r)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}}},10033:(e,t,r)=>{r.d(t,{GL:()=>s,Zf:()=>i});const i={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},s={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...i}},4999:(e,t,r)=>{r.d(t,{MY:()=>l,TP:()=>i,WH:()=>n,ir:()=>a,lH:()=>s,yy:()=>o});const i={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var s,n,o,a;!function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"}(s||(s={})),function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"}(n||(n={})),function(e){e.I3S="I3S",e.TILES3D="TILES3D"}(o||(o={})),function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"}(a||(a={}));const l={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0}},67410:(e,t,r)=>{r.d(t,{Q:()=>Se});var i=r(31886),s=r(87597),n=r(4912),o=r(97983),a=r(86428),l=r(78331);class c{item;previous;next;constructor(e,t,r){this.item=e,this.previous=t,this.next=r}}class h{head=null;tail=null;_length=0;get length(){return this._length}add(e){const t=new c(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}class u{_list;_sentinel;_trimTiles;constructor(){this._list=new h,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,r){t._cacheNode||(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){const i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,r&&r(e,t))}unloadTiles(e,t){const r=this._trimTiles;this._trimTiles=!1;const i=this._list,s=1024*e.maximumMemoryUsage*1024,n=this._sentinel;let o=i.head;for(;o!==n&&(e.gpuMemoryUsageInBytes>s||r);){const r=o.item;o=o.next,this.unloadTile(e,r,t)}}trim(){this._trimTiles=!0}}var d=r(94976);var p=r(67733);const f=new s.P,m=new s.P,y=new p.R2([new p.Zc,new p.Zc,new p.Zc,new p.Zc,new p.Zc,new p.Zc]);function T(e,t){const{cameraDirection:r,cameraUp:i,height:o}=e,{metersPerUnit:a}=e.distanceScales,l=_(e,e.center),c=n.C.WGS84.eastNorthUpToFixedFrame(l),h=e.unprojectPosition(e.cameraPosition),u=n.C.WGS84.cartographicToCartesian(h,new s.P),d=new s.P(c.transformAsVector(new s.P(r).scale(a))).normalize(),p=new s.P(c.transformAsVector(new s.P(i).scale(a))).normalize();!function(e){const t=e.getFrustumPlanes(),r=g(t.near,e.cameraPosition),i=_(e,r),s=_(e,e.cameraPosition,m);let n=0;y.planes[n++].fromPointNormal(i,f.copy(i).subtract(s));for(const o in t){if("near"===o)continue;const s=_(e,g(t[o],r,m),m);y.planes[n++].fromPointNormal(s,f.copy(i).subtract(s))}}(e);const T=e.constructor,{longitude:b,latitude:w,width:S,bearing:E,zoom:P}=e;return{camera:{position:u,direction:d,up:p},viewport:e,topDownViewport:new T({longitude:b,latitude:w,height:o,width:S,bearing:E,zoom:P,pitch:0}),height:o,cullingVolume:y,frameNumber:t,sseDenominator:1.15}}function g(e,t,r=new s.P){const i=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-i).add(t),r}function _(e,t,r=new s.P){const i=e.unprojectPosition(t);return n.C.WGS84.cartographicToCartesian(i,r)}const b=6356752.314245179,w=new s.P;function S(e,t){if(e instanceof p.CB){const{halfAxes:r}=e,i=function(e){e.getColumn(0,w);const t=e.getColumn(1),r=e.getColumn(2),i=w.add(t).add(r);return i.len()}(r);return Math.log2(b/(i+t[2]))}if(e instanceof p.ie){const{radius:r}=e;return Math.log2(b/(r+t[2]))}if(e.width&&e.height){const{width:t,height:r}=e;return(Math.log2(6378137/t)+Math.log2(6378137/r))/2}return 1}function E(e,t,r){n.C.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],w);const i=Math.sqrt(Math.pow(w[0]-r[0],2)+Math.pow(w[1]-r[1],2)+Math.pow(w[2]-r[2],2));return Math.log2(b/(i+t[2]))}var P=r(327),A=r(4999),I=r(54901),C=r(11633),O=r(35567);function N(e){return null!=e}const v=new s.P,x=new s.P,M=new s.P,L=new s.P,R=new s.P,U=new s.P,D=new s.P,B=new s.P;function V(e,t,r){if((0,d.v)(e,"3D Tile: boundingVolume must be defined"),e.box)return z(e.box,t,r);if(e.region)return function(e){const[t,r,o,a,l,c]=e,h=n.C.WGS84.cartographicToCartesian([(0,I.uj)(t),(0,I.uj)(a),l],M),u=n.C.WGS84.cartographicToCartesian([(0,I.uj)(o),(0,I.uj)(r),c],L),d=(new s.P).addVectors(h,u).multiplyByScalar(.5);return n.C.WGS84.cartesianToCartographic(d,R),n.C.WGS84.cartographicToCartesian([(0,I.uj)(o),R[1],R[2]],U),n.C.WGS84.cartographicToCartesian([R[0],(0,I.uj)(a),R[2]],D),n.C.WGS84.cartographicToCartesian([R[0],R[1],c],B),z([...d,...U.subtract(d),...D.subtract(d),...B.subtract(d)],new i.k)}(e.region);if(e.sphere)return function(e,t,r){const i=new s.P(e[0],e[1],e[2]);t.transform(i,i);const n=t.getScale(x),o=Math.max(Math.max(n[0],n[1]),n[2]),a=e[3]*o;if(N(r))return r.center=i,r.radius=a,r;return new p.ie(i,a)}(e.sphere,t,r);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function G(e,t){if(e.box)return function(e){const t=q(),{halfAxes:r}=e,i=new s.P(r.getColumn(0)),n=new s.P(r.getColumn(1)),o=new s.P(r.getColumn(2));for(let s=0;s<2;s++){for(let r=0;r<2;r++){for(let r=0;r<2;r++)v.copy(e.center),v.add(i),v.add(n),v.add(o),F(t,v),o.negate();n.negate()}i.negate()}return t}(t);if(e.region){const[t,r,i,s,n,o]=e.region;return[[(0,I.uj)(t),(0,I.uj)(r),n],[(0,I.uj)(i),(0,I.uj)(s),o]]}if(e.sphere)return function(e){const t=q(),{center:r,radius:i}=e,o=n.C.WGS84.scaleToGeodeticSurface(r,v);let a;a=o?n.C.WGS84.geodeticSurfaceNormal(o):new s.P(0,0,1);let l=new s.P(a[2],-a[1],0);l.len()>0?l.normalize():l=new s.P(0,1,0);const c=l.clone().cross(a);for(const s of[l,c,a]){x.copy(s).scale(i);for(let e=0;e<2;e++)v.copy(r),v.add(x),F(t,v),x.negate()}return t}(t);throw new Error("Unkown boundingVolume type")}function z(e,t,r){const i=new s.P(e[0],e[1],e[2]);t.transform(i,i);let n=[];if(10===e.length){const t=e.slice(3,6),r=new C.P;r.fromArray(e,6);const i=new s.P([1,0,0]),o=new s.P([0,1,0]),a=new s.P([0,0,1]);i.transformByQuaternion(r),i.scale(t[0]),o.transformByQuaternion(r),o.scale(t[1]),a.transformByQuaternion(r),a.scale(t[2]),n=[...i.toArray(),...o.toArray(),...a.toArray()]}else n=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const o=t.transformAsVector(n.slice(0,3)),a=t.transformAsVector(n.slice(3,6)),l=t.transformAsVector(n.slice(6,9)),c=new O.d([o[0],o[1],o[2],a[0],a[1],a[2],l[0],l[1],l[2]]);return N(r)?(r.center=i,r.halfAxes=c,r):new p.CB(i,c)}function q(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function F(e,t){n.C.WGS84.cartesianToCartographic(t,v),e[0][0]=Math.min(e[0][0],v[0]),e[0][1]=Math.min(e[0][1],v[1]),e[0][2]=Math.min(e[0][2],v[2]),e[1][0]=Math.max(e[1][0],v[0]),e[1][1]=Math.max(e[1][1],v[1]),e[1][2]=Math.max(e[1][2],v[2])}new s.P,new s.P,new i.k,new s.P,new s.P,new s.P;function H(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const r=e.dynamicScreenSpaceErrorComputedDensity,i=e.dynamicScreenSpaceErrorFactor,s=function(e,t){const r=e*t;return 1-Math.exp(-r*r)}(t,r)*i;return s}return 0}const k=new s.P,Z=new s.P,j=new s.P,$=new s.P,W=new s.P,Y=new i.k,Q=new i.k;function J(e,t){const{topDownViewport:r}=t,i=e.header.mbs[1],s=e.header.mbs[0],o=e.header.mbs[2],a=e.header.mbs[3],l=[...e.boundingVolume.center],c=r.unprojectPosition(r.cameraPosition);n.C.WGS84.cartographicToCartesian(c,k),Z.copy(k).subtract(l).normalize(),n.C.WGS84.eastNorthUpToFixedFrame(l,Y),Q.copy(Y).invert(),j.copy(k).transform(Q);const h=Math.sqrt(j[0]*j[0]+j[1]*j[1]),u=h*h/j[2];$.copy([j[0],j[1],u]);const d=$.transform(Y).subtract(l).normalize(),p=Z.cross(d).normalize().scale(a).add(l),f=n.C.WGS84.cartesianToCartographic(p),m=r.project([s,i,o]),y=r.project(f);return W.copy(m).subtract(y).magnitude()}class X{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return(0,d.v)(e<this._array.length),this._array[e]}set(e,t){(0,d.v)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){(0,d.v)(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){(0,d.v)(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const K={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class ee{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=(new Date).getTime();updateDebounceTime=1e3;_traversalStack=new X;_emptyTraversalStack=new X;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...K,...e}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){const e=r.pop();let i=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),i=this.updateAndPushChildren(e,t,r,e.hasRenderContent?e._selectionDepth+1:e._selectionDepth));const s=e.parent,n=Boolean(!s||s._shouldRefine),o=!i;e.hasRenderContent?e.refine===A.lH.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===A.lH.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=i&&n}const i=(new Date).getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const r=e.children;for(const i of r)this.updateTile(i,t)}updateAndPushChildren(e,t,r,i){const{loadSiblings:s,skipLevelOfDetail:n}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const a=e.refine===A.lH.REPLACE&&e.hasRenderContent&&!n;let l=!1,c=!0;for(const h of o)if(h._selectionDepth=i,h.isVisibleAndInRequestVolume?(r.find(h)&&r.delete(h),r.push(h),l=!0):(a||s)&&(this.loadTile(h,t),this.touchTile(h,t)),a){let e;if(e=!!h._inRequestVolume&&(h.hasRenderContent?h.contentAvailable:this.executeEmptyTraversal(h,t)),c=c&&e,!c)return!1}return l||(c=!1),c}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t,r=!1,i=!1){return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:!(!i&&!e.isVisibleAndInRequestVolume)&&this.shouldRefine(e,t,r))}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,r=!1){let i=e._screenSpaceError;return r&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const r=[];if(this.options.viewportTraversersMap)for(const i in this.options.viewportTraversersMap){this.options.viewportTraversersMap[i]===t.viewport.id&&r.push(i)}else r.push(t.viewport.id);e.updateVisibility(t,r)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let r=!1;for(const i of e.children)i.updateVisibility(t),r=r||i.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0;const i=this._emptyTraversalStack;for(i.push(e);i.length>0;){const e=i.pop(),s=!e.hasRenderContent&&this.canTraverse(e,t,!1,!1),n=!e.hasRenderContent&&0===e.children.length;if(s||e.contentAvailable||n||(r=!1),this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t)),s){const t=e.children;for(const e of t)i.push(e)}}return r}}const te=new s.P;class re{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=A.TP.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new i.k;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new ee({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new i.k;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,t,r,i=""){this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===A.TP.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===A.TP.UNLOADED}get contentExpired(){return this.contentState===A.TP.EXPIRED}get contentFailed(){return this.contentState===A.TP.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=G(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case A.yy.I3S:return J(this,e);case A.yy.TILES3D:return function(e,t,r){const i=e.tileset,s=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,n=r?s:e.lodMetricValue;if(0===n)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:c}=i.options;let h=n*a*(c||1)/(o*l);return h-=H(i,o),h}(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,r=this.refine===A.lH.ADD||t;if(r&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===A.TP.UNLOADED)return-1;const i=this.parent,s=i&&(!r||0===this._screenSpaceError||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError,n=e.root?e.root._screenSpaceError:0;return Math.max(n-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=A.TP.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=A.TP.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,r={...this.tileset.loadOptions,[t.id]:{...this.tileset.loadOptions[t.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)}};return this.content=await(0,P.H)(e,t,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=A.TP.READY,this._onContentLoaded(),!0}catch(t){throw this.contentState=A.TP.FAILED,t}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=A.TP.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const r=this.parent,i=r?r._visibilityPlaneMask:p.R2.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const e=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(e)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==p.R2.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:r}=e,{boundingVolume:i}=this;return r.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return te.subVectors(t.center,e.position),e.direction.dot(te)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=A.TP.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new i.k(e.transform):new i.k;const t=this.parent,r=this.tileset,s=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new i.k(s).multiplyRight(this.transform);const n=t&&t._initialTransform?t._initialTransform.clone():new i.k;this._initialTransform=new i.k(n).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=A.TP.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=p.R2.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||A.lH.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=V(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=V(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=V(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new i.k){const t=e.clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){return"i3s"===e?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t}}class ie extends ee{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const r=e.children.length>0;if(e.hasTilesetContent&&r){const r=e.children[0];return this.updateTileVisibility(r,t),void(e._visible=r._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))return void(e._visible=!1);const i=e.refine===A.lH.REPLACE,s=e._optimChildrenWithinParent===A.MY.USE_OPTIMIZATION;i&&s&&r&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}meetsScreenSpaceErrorEarly(e,t){const{parent:r}=e;return!(!r||r.hasTilesetContent||r.refine!==A.lH.ADD)&&!this.shouldRefine(e,t,!0)}}class se{frameNumberMap=new Map;register(e,t){const r=this.frameNumberMap.get(e)||new Map,i=r.get(t)||0;r.set(t,i+1),this.frameNumberMap.set(e,r)}deregister(e,t){const r=this.frameNumberMap.get(e);if(!r)return;const i=r.get(t)||1;r.set(t,i-1)}isZero(e,t){return 0===(this.frameNumberMap.get(e)?.get(t)||0)}}const ne="REQUESTED",oe="COMPLETED",ae="ERROR";class le{_statusMap;pendingTilesRegister=new se;constructor(){this._statusMap={}}add(e,t,r,i){if(!this._statusMap[t]){const{frameNumber:s,viewport:{id:n}}=i;this._statusMap[t]={request:e,callback:r,key:t,frameState:i,status:ne},this.pendingTilesRegister.register(n,s),e().then((e=>{this._statusMap[t].status=oe;const{frameNumber:r,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,r),this._statusMap[t].callback(e,i)})).catch((e=>{this._statusMap[t].status=ae;const{frameNumber:i,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,i),r(e)}))}}update(e,t){if(this._statusMap[e]){const{frameNumber:r,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,r);const{frameNumber:s,viewport:{id:n}}=t;this.pendingTilesRegister.register(n,s),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class ce extends ee{_tileManager;constructor(e){super(e),this._tileManager=new le}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";const r=2*J(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const r=e.header.children||[],i=e.children,s=e.tileset;for(const n of r){const r=`${n.id}-${t.viewport.id}`,o=i&&i.find((e=>e.id===r));if(o)o&&this.updateTile(o,t);else{let i=()=>this._loadTile(n.id,s);this._tileManager.find(r)?this._tileManager.update(r,t):(s.tileset.nodePages&&(i=()=>s.tileset.nodePagesTile.formTileFromNodePages(n.id)),this._tileManager.add(i,r,(t=>this._onTileLoad(t,e,r)),t))}}return!1}async _loadTile(e,t){const{loader:r}=t,i=t.getTileUrl(`${t.url}/nodes/${e}`),s={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await(0,P.H)(i,r,s)}_onTileLoad(e,t,r){const i=new re(t.tileset,e,t,r);t.children.push(i);const s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}const he={description:"",ellipsoid:n.C.WGS84,modelMatrix:new i.k,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ue="Tiles In Tileset(s)",de="Tiles In Memory",pe="Tiles In View",fe="Tiles To Render",me="Tiles Loaded",ye="Tiles Loading",Te="Tiles Unloaded",ge="Failed Tile Loads",_e="Points/Vertices",be="Tile Memory Use",we="Maximum Screen Space Error";class Se{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new u;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,t){this.options={...he,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||a.pD(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new l.A({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=1024*this.options.maximumMemoryUsage*1024,this._cacheOverflowBytes=1024*this.options.memoryCacheOverflow*1024,this.stats=new o.A({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let t=e;return this.queryParams.length&&(t=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),t}hasExtension(e){return Boolean(this._extensionsUsed.indexOf(e)>-1)}update(e=null){this.tilesetInitializationPromise.then((()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)}))}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise((e=>{setTimeout((()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null}),this.options.debounceTime)}))),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const r=[];for(const i of t){const e=i.id;this._needTraverse(e)?r.push(e):this.traverseCounter--}for(const i of t){const e=i.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null)),!r.includes(e))continue;const t=T(i,this._frameNumber);this._traverser.traverse(this.roots[e],t,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const r=this.frameStateData[t],i=Object.values(this._traverser.selectedTiles),[s,n]=function(e,t,r){if(0===r||e.length<=r)return[e,[]];const i=[],{longitude:s,latitude:n}=t.viewport;for(const[c,h]of e.entries()){const[e,t]=h.header.mbs,r=Math.abs(s-e),o=Math.abs(n-t),a=Math.sqrt(o*o+r*r);i.push([c,a])}const o=i.sort(((e,t)=>e[1]-t[1])),a=[];for(let c=0;c<r;c++)a.push(e[o[c][0]]);const l=[];for(let c=r;c<o.length;c++)l.push(e[o[c][0]]);return[a,l]}(i,e,this.options.maximumTilesSelected);r.selectedTiles=s;for(const o of n)o.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const r=new Set(e.map((e=>e.id))),i=new Set(t.map((e=>e.id)));let s=e.filter((e=>!i.has(e.id))).length>0;return s=s||t.filter((e=>!r.has(e.id))).length>0,s}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)))}_updateStats(){let e=0,t=0;for(const r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?t+=r.content.pointCount:t+=r.content.vertexCount);this.stats.get(pe).count=this.selectedTiles.length,this.stats.get(fe).count=e,this.stats.get(_e).count=t,this.stats.get(we).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===A.yy.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===A.yy.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===A.yy.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:t,xmax:r,ymin:i,ymax:o,zmin:a,zmax:l}=e;return this.cartographicCenter=new s.P(t+(r-t)/2,i+(o-i)/2,a+(l-a)/2),this.cartesianCenter=new s.P,n.C.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=E(e,this.cartographicCenter,this.cartesianCenter))}const t=this.tileset.store?.extent;if(t){const[e,r,i,o]=t;return this.cartographicCenter=new s.P(e+(i-e)/2,r+(o-r)/2,0),this.cartesianCenter=new s.P,n.C.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=function(e,t,r){const[i,s,n,o]=e;return E({xmin:i,xmax:n,ymin:s,ymax:o,zmin:0,zmax:0},t,r)}(t,this.cartographicCenter,this.cartesianCenter))}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new s.P,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new s.P,void(this.zoom=1);0!==t[0]||0!==t[1]||0!==t[2]?(this.cartographicCenter=new s.P,n.C.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new s.P(0,0,-n.C.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=S(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ue),this.stats.get(ye),this.stats.get(de),this.stats.get(pe),this.stats.get(fe),this.stats.get(me),this.stats.get(Te),this.stats.get(ge),this.stats.get(_e),this.stats.get(be,"memory"),this.stats.get(we)}_initializeTileHeaders(e,t){const r=new re(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===A.yy.TILES3D){const e=[];for(e.push(r);e.length>0;){const t=e.pop();this.stats.get(ue).incrementCount();const r=t.header.children||[];for(const i of r){const r=new re(this,i,t);if(r.contentUrl?.includes("?session=")){const e=new URL(r.contentUrl).searchParams.get("session");e&&(this._queryParams.session=e)}t.children.push(r),r.depth=t.depth+1,e.push(r)}}}return r}_initializeTraverser(){let e;switch(this.type){case A.yy.TILES3D:e=ie;break;case A.yy.I3S:e=ce;break;default:e=ee}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(r){this._onTileLoadError(e,r instanceof Error?r:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(ge).incrementCount();const r=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${r}`),this.options.onTileError(e,r,i)}_onTileLoad(e,t){if(t){if(this.type===A.yy.I3S){const e=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(ue).reset(),this.stats.get(ue).addCount(e)}e&&e.content&&function(e,t){(0,d.v)(e),(0,d.v)(t);const{rtcCenter:r,gltfUpAxis:o}=t,{computedTransform:a,boundingVolume:{center:l}}=e;let c=new i.k(a);switch(r&&c.translate(r),o){case"Z":default:break;case"Y":const e=(new i.k).rotateX(Math.PI/2);c=c.multiplyRight(e);break;case"X":const t=(new i.k).rotateY(-Math.PI/2);c=c.multiplyRight(t)}t.isQuantized&&c.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const h=new s.P(l);t.cartesianModelMatrix=c,t.cartesianOrigin=h;const u=n.C.WGS84.cartesianToCartographic(h,new s.P),p=n.C.WGS84.eastNorthUpToFixedFrame(h).invert();t.cartographicModelMatrix=p.multiplyRight(c),t.cartographicOrigin=u,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===A.yy.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===A.yy.TILES3D){const{extensionsRemoved:t=[]}=e.content?.gltf||{};t.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),t.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),t.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(ye).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(ye).decrementCount()}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)))}_updateCacheStats(e){this.stats.get(me).incrementCount(),this.stats.get(de).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(be).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(de).decrementCount(),this.stats.get(Te).incrementCount(),this.stats.get(be).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,r=[];for(r.push(t);r.length>0;){e=r.pop();for(const t of e.children)r.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),r=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...r}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}},77422:(e,t,r)=>{r.d(t,{I:()=>l});var i=r(54272),s=r(54901),n=r(73731),o=r(83588),a=r(68225);class l extends i.M{constructor(e=0,t=0){super(2),(0,s.cy)(e)&&1===arguments.length?this.copy(e):(s.$W.debug&&((0,n.ws)(e),(0,n.ws)(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return s.$W.debug&&((0,n.ws)(e.x),(0,n.ws)(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return(0,o.Z0)(this,this,e),this.check()}transformAsVector(e){return(0,a.B$)(this,this,e),this.check()}transformByMatrix3(e){return(0,o.ei)(this,this,e),this.check()}transformByMatrix2x3(e){return(0,o.l0)(this,this,e),this.check()}transformByMatrix2(e){return(0,o.ZF)(this,this,e),this.check()}}},4912:(e,t,r)=>{r.d(t,{C:()=>M});var i=r(87597),s=r(72734),n=r(4990),o=r(82859),a=r(31886),l=r(54901);const c=6378137,h=6378137,u=6356752.314245179;Math.max(c,h,u);function d(e){return e}new i.P;function p(e,t=[],r=d){return"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):"x"in e?(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}function f(e,t,r=d){return"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):"x"in t?(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}const m=new i.P,y={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},T={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},g={east:new i.P,north:new i.P,up:new i.P,west:new i.P,south:new i.P,down:new i.P},_=new i.P,b=new i.P,w=new i.P;function S(e,t,r,i,s,o){const a=y[t]&&y[t][r];let c,h,u;(0,n.v)(a&&(!i||i===a));const d=m.copy(s);if((0,l.aI)(d.x,0,1e-14)&&(0,l.aI)(d.y,0,1e-14)){const e=Math.sign(d.z);c=_.fromArray(T[t]),"east"!==t&&"west"!==t&&c.scale(e),h=b.fromArray(T[r]),"east"!==r&&"west"!==r&&h.scale(e),u=w.fromArray(T[i]),"east"!==i&&"west"!==i&&u.scale(e)}else{const{up:s,east:n,north:o}=g;n.set(-d.y,d.x,0).normalize(),e.geodeticSurfaceNormal(d,s),o.copy(s).cross(n);const{down:a,west:l,south:p}=g;a.copy(s).scale(-1),l.copy(n).scale(-1),p.copy(o).scale(-1),c=g[t],h=g[r],u=g[i]}return o[0]=c.x,o[1]=c.y,o[2]=c.z,o[3]=0,o[4]=h.x,o[5]=h.y,o[6]=h.z,o[7]=0,o[8]=u.x,o[9]=u.y,o[10]=u.z,o[11]=0,o[12]=d.x,o[13]=d.y,o[14]=d.z,o[15]=1,o}const E=new i.P,P=new i.P,A=new i.P;const I=new i.P,C=new i.P,O=new i.P,N=new i.P,v=new i.P,x=new i.P;class M{constructor(e=0,t=0,r=0){this.centerToleranceSquared=s.Ix,(0,n.v)(e>=0),(0,n.v)(t>=0),(0,n.v)(r>=0),this.radii=new i.P(e,t,r),this.radiiSquared=new i.P(e*e,t*t,r*r),this.radiiToTheFourth=new i.P(e*e*e*e,t*t*t*t,r*r*r*r),this.oneOverRadii=new i.P(0===e?0:1/e,0===t?0:1/t,0===r?0:1/r),this.oneOverRadiiSquared=new i.P(0===e?0:1/(e*e),0===t?0:1/(t*t),0===r?0:1/(r*r)),this.minimumRadius=Math.min(e,t,r),this.maximumRadius=Math.max(e,t,r),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const r=C,i=O,[,,s]=e;this.geodeticSurfaceNormalCartographic(e,r),i.copy(this.radiiSquared).scale(r);const n=Math.sqrt(r.dot(i));return i.scale(1/n),r.scale(s),i.add(r),i.to(t)}cartesianToCartographic(e,t=[0,0,0]){x.from(e);const r=this.scaleToGeodeticSurface(x,N);if(!r)return;const i=this.geodeticSurfaceNormal(r,C),s=v;s.copy(x).subtract(r);const n=Math.atan2(i.y,i.x),a=Math.asin(i.z),c=Math.sign(o.Om(s,x))*o.Bw(s);return f([n,a,c],t,l.$W._cartographicRadians?d:l.xW)}eastNorthUpToFixedFrame(e,t=new a.k){return S(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,r,i,s=new a.k){return S(this,e,t,r,i,s)}geocentricSurfaceNormal(e,t=[0,0,0]){return I.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const r=function(e,t=[]){return p(e,t,l.$W._cartographicRadians?d:l.eh)}(e),i=r[0],s=r[1],n=Math.cos(s);return I.set(n*Math.cos(i),n*Math.sin(i),Math.sin(s)).normalize(),I.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return I.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return function(e,t,r=[]){const{oneOverRadii:i,oneOverRadiiSquared:n,centerToleranceSquared:o}=t;E.from(e);const a=E.x,l=E.y,c=E.z,h=i.x,u=i.y,d=i.z,p=a*a*h*h,f=l*l*u*u,m=c*c*d*d,y=p+f+m,T=Math.sqrt(1/y);if(!Number.isFinite(T))return;const g=P;if(g.copy(e).scale(T),y<o)return g.to(r);const _=n.x,b=n.y,w=n.z,S=A;S.set(g.x*_*2,g.y*b*2,g.z*w*2);let I,C,O,N,v=(1-T)*E.len()/(.5*S.len()),x=0;do{v-=x,I=1/(1+v*_),C=1/(1+v*b),O=1/(1+v*w);const e=I*I,t=C*C,r=O*O;N=p*e+f*t+m*r-1,x=N/(-2*(p*(e*I)*_+f*(t*C)*b+m*(r*O)*w))}while(Math.abs(N)>s.IU);return E.scale([I,C,O]).to(r)}(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){N.from(e);const r=N.x,i=N.y,s=N.z,n=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*n.x+i*i*n.y+s*s*n.z);return N.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return N.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return N.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,r=[0,0,0]){(0,n.v)((0,l.aI)(this.radii.x,this.radii.y,s.Pq)),(0,n.v)(this.radii.z>0),N.from(e);const i=N.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return N.set(0,0,i).to(r)}}M.WGS84=new M(c,h,u)}}]);