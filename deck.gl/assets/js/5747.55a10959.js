"use strict";(self.webpackChunkproject_website=self.webpackChunkproject_website||[]).push([[5747],{20633:(e,t,i)=>{i.d(t,{i:()=>ze});var r=i(86428),n=i(4999);const s="4.2.1",o={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};Object.keys(o);var a=i(94976);function l(e,t,i){(0,a.v)(e instanceof ArrayBuffer);const r=new TextDecoder("utf8"),n=new Uint8Array(e,t,i);return r.decode(n)}var c=i(53618),h=i(38925),u=i(10033),d=i(87597);const p={[u.Zf.DOUBLE]:Float64Array,[u.Zf.FLOAT]:Float32Array,[u.Zf.UNSIGNED_SHORT]:Uint16Array,[u.Zf.UNSIGNED_INT]:Uint32Array,[u.Zf.UNSIGNED_BYTE]:Uint8Array,[u.Zf.BYTE]:Int8Array,[u.Zf.SHORT]:Int16Array,[u.Zf.INT]:Int32Array},f={DOUBLE:u.Zf.DOUBLE,FLOAT:u.Zf.FLOAT,UNSIGNED_SHORT:u.Zf.UNSIGNED_SHORT,UNSIGNED_INT:u.Zf.UNSIGNED_INT,UNSIGNED_BYTE:u.Zf.UNSIGNED_BYTE,BYTE:u.Zf.BYTE,SHORT:u.Zf.SHORT,INT:u.Zf.INT},m="Failed to convert GL type";class g{static fromTypedArray(e){e=ArrayBuffer.isView(e)?e.constructor:e;for(const t in p){if(p[t]===e)return t}throw new Error(m)}static fromName(e){const t=f[e];if(!t)throw new Error(m);return t}static getArrayType(e){switch(e){case u.Zf.UNSIGNED_SHORT_5_6_5:case u.Zf.UNSIGNED_SHORT_4_4_4_4:case u.Zf.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:const t=p[e];if(!t)throw new Error(m);return t}}static getByteSize(e){return g.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return Boolean(g.getArrayType(e))}static createTypedArray(e,t,i=0,r){void 0===r&&(r=(t.byteLength-i)/g.getByteSize(e));return new(g.getArrayType(e))(t,i,r)}}class y{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,t){this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return Boolean(this.json[e])}getGlobalProperty(e,t=u.GL.UNSIGNED_INT,i=1){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?this._getTypedArrayFromBinary(e,t,i,1,r.byteOffset):r}getPropertyArray(e,t,i){const r=this.json[e];return r&&Number.isFinite(r.byteOffset)?("componentType"in r&&(t=g.fromName(r.componentType)),this._getTypedArrayFromBinary(e,t,i,this.featuresLength,r.byteOffset)):this._getTypedArrayFromArray(e,t,r)}getProperty(e,t,i,r,n){const s=this.json[e];if(!s)return s;const o=this.getPropertyArray(e,t,i);if(1===i)return o[r];for(let a=0;a<i;++a)n[a]=o[i*r+a];return n}_getTypedArrayFromBinary(e,t,i,r,n){const s=this._cachedTypedArrays;let o=s[e];return o||(o=g.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+n,r*i),s[e]=o),o}_getTypedArrayFromArray(e,t,i){const r=this._cachedTypedArrays;let n=r[e];return n||(n=g.createTypedArray(t,i),r[e]=n),n}}const T={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},b={SCALAR:(e,t,i)=>{t[i]=e},VEC2:(e,t,i)=>{t[2*i+0]=e[0],t[2*i+1]=e[1]},VEC3:(e,t,i)=>{t[3*i+0]=e[0],t[3*i+1]=e[1],t[3*i+2]=e[2]},VEC4:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT2:(e,t,i)=>{t[4*i+0]=e[0],t[4*i+1]=e[1],t[4*i+2]=e[2],t[4*i+3]=e[3]},MAT3:(e,t,i)=>{t[9*i+0]=e[0],t[9*i+1]=e[1],t[9*i+2]=e[2],t[9*i+3]=e[3],t[9*i+4]=e[4],t[9*i+5]=e[5],t[9*i+6]=e[6],t[9*i+7]=e[7],t[9*i+8]=e[8],t[9*i+9]=e[9]},MAT4:(e,t,i)=>{t[16*i+0]=e[0],t[16*i+1]=e[1],t[16*i+2]=e[2],t[16*i+3]=e[3],t[16*i+4]=e[4],t[16*i+5]=e[5],t[16*i+6]=e[6],t[16*i+7]=e[7],t[16*i+8]=e[8],t[16*i+9]=e[9],t[16*i+10]=e[10],t[16*i+11]=e[11],t[16*i+12]=e[12],t[16*i+13]=e[13],t[16*i+14]=e[14],t[16*i+15]=e[15]}};const w=e=>void 0!==e;function S(e,t,i){if(!t)return null;let r=e.getExtension("3DTILES_batch_table_hierarchy");const n=t.HIERARCHY;return n&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=n,r=n),r?function(e,t){let i,r,n;const s=e.instancesLength,o=e.classes;let a,l=e.classIds,c=e.parentCounts,h=e.parentIds,u=s;w(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,n=getBinaryAccessor(l),l=n.createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,s));if(w(c))for(w(c.byteOffset)&&(c.componentType=defaultValue(c.componentType,GL.UNSIGNED_SHORT),c.type=AttributeType.SCALAR,n=getBinaryAccessor(c),c=n.createArrayBufferView(t.buffer,t.byteOffset+c.byteOffset,s)),a=new Uint16Array(s),u=0,i=0;i<s;++i)a[i]=u,u+=c[i];w(h)&&w(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,n=getBinaryAccessor(h),h=n.createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,u));const d=o.length;for(i=0;i<d;++i){const e=o[i].length,r=o[i].instances,n=getBinaryProperties(e,r,t);o[i].instances=combine(n,r)}const p=new Array(d).fill(0),f=new Uint16Array(s);for(i=0;i<s;++i)r=l[i],f[i]=p[r],++p[r];const m={classes:o,classIds:l,classIndexes:f,parentCounts:c,parentIndexes:a,parentIds:h};return function(e){const t=e.classIds,i=t.length;for(let r=0;r<i;++r)P(e,r,stack)}(m),m}(r,i):null}function E(e,t,i){if(!e)return;const r=e.parentCounts;return e.parentIds?i(e,t):r>0?function(e,t,i){const r=e.classIds,n=e.parentCounts,s=e.parentIds,o=e.parentIndexes,a=r.length,l=scratchVisited;l.length=Math.max(l.length,a);const c=++marker,h=scratchStack;h.length=0,h.push(t);for(;h.length>0;){if(l[t=h.pop()]===c)continue;l[t]=c;const r=i(e,t);if(w(r))return r;const a=n[t],u=o[t];for(let e=0;e<a;++e){const i=s[u+e];i!==t&&h.push(i)}}return null}(e,t,i):function(e,t,i){let r=!0;for(;r;){const n=i(e,t);if(w(n))return n;const s=e.parentIds[t];r=s!==t,t=s}throw new Error("traverseHierarchySingleParent")}(e,t,i)}function P(e,t,i){const r=e.parentCounts,n=e.parentIds,s=e.parentIndexes,o=e.classIds.length;if(!w(n))return;assert(t<o,`Parent index ${t} exceeds the total number of instances: ${o}`),assert(-1===i.indexOf(t),"Circular dependency detected in the batch table hierarchy."),i.push(t);const a=w(r)?r[t]:1,l=w(r)?s[t]:t;for(let c=0;c<a;++c){const r=n[l+c];r!==t&&P(e,r,i)}i.pop(t)}function C(e){return null!=e}const v=(e,t)=>e,A={HIERARCHY:!0,extensions:!0,extras:!0};class I{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,t,i,r={}){(0,a.v)(i>=0),this.json=e||{},this.binary=t,this.featureCount=i,this._extensions=this.json?.extensions||{},this._properties={};for(const n in this.json)A[n]||(this._properties[n]=this.json[n]);this._binaryProperties=this._initializeBinaryProperties(),r["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=S(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._hierarchy){return C(E(this._hierarchy,e,((e,i)=>{const r=e.classIds[i];return e.classes[r].name===t})))}return!1}isExactClass(e,t){return(0,a.v)("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){const t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),(0,a.v)("string"==typeof t,t),C(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=C(t)?t:[]).length=0;const i=Object.keys(this._properties);return t.push(...i),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._binaryProperties){const i=this._binaryProperties[t];if(C(i))return this._getBinaryProperty(i,e)}const i=this._properties[t];if(C(i))return v(i[e]);if(this._hierarchy){const i=this._getHierarchyProperty(e,t);if(C(i))return i}}setProperty(e,t,i){const r=this.featureCount;if(this._checkBatchId(e),(0,a.v)("string"==typeof t,t),this._binaryProperties){const r=this._binaryProperties[t];if(r)return void this._setBinaryProperty(r,e,i)}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,i))return;let n=this._properties[t];C(n)||(this._properties[t]=new Array(r),n=this._properties[t]),n[e]=v(i)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw new Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,i){e.pack(i,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(const t in this._properties){const i=this._properties[t],r=this._initializeBinaryProperty(t,i);r&&(e=e||{},e[t]=r)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){const i=t;(0,a.v)(this.binary,`Property ${e} requires a batch table binary.`),(0,a.v)(i.type,`Property ${e} requires a type.`);const r=function(e,t,i,r){const{componentType:n}=e;(0,a.v)(e.componentType);const s="string"==typeof n?g.fromName(n):n,o=T[e.type],l=_[e.type],c=b[e.type];return i+=e.byteOffset,{values:g.createTypedArray(s,t,i,o*r),type:s,size:o,unpacker:l,packer:c}}(i,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;const i=E(this._hierarchy,e,((e,i)=>{const r=e.classIds[i];return C(e.classes[r].instances[t])}));return C(i)}_getPropertyNamesInHierarchy(e,t){E(this._hierarchy,e,((e,i)=>{const r=e.classIds[i],n=e.classes[r].instances;for(const s in n)n.hasOwnProperty(s)&&-1===t.indexOf(s)&&t.push(s)}))}_getHierarchyProperty(e,t){return E(this._hierarchy,e,((e,i)=>{const r=e.classIds[i],n=e.classes[r],s=e.classIndexes[i],o=n.instances[t];return C(o)?C(o.typedArray)?this._getBinaryProperty(o,s):v(o[s]):null}))}_setHierarchyProperty(e,t,i,r){const n=E(this._hierarchy,t,((e,n)=>{const s=e.classIds[n],o=e.classes[s],l=e.classIndexes[n],c=o.instances[i];return!!C(c)&&((0,a.v)(n===t,`Inherited property "${i}" is read-only.`),C(c.typedArray)?this._setBinaryProperty(c,l,r):c[l]=v(r),!0)}));return C(n)}}function L(e,t,i=0){const r=new DataView(t);if(e.magic=r.getUint32(i,!0),i+=4,e.version=r.getUint32(i,!0),i+=4,e.byteLength=r.getUint32(i,!0),i+=4,1!==e.version)throw new Error(`3D Tile Version ${e.version} not supported`);return i}const N="b3dm tile in legacy format.";function O(e,t,i){const r=new DataView(t);let n;e.header=e.header||{};let s=r.getUint32(i,!0);i+=4;let o=r.getUint32(i,!0);i+=4;let a=r.getUint32(i,!0);i+=4;let l=r.getUint32(i,!0);return i+=4,a>=570425344?(i-=8,n=s,a=o,l=0,s=0,o=0,console.warn(N)):l>=570425344&&(i-=4,n=a,a=s,l=o,s=0,o=0,console.warn(N)),e.header.featureTableJsonByteLength=s,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=l,e.header.batchLength=n,i}function x(e,t,i,r){return i=function(e,t,i){const{featureTableJsonByteLength:r,featureTableBinaryByteLength:n,batchLength:s}=e.header||{};if(e.featureTableJson={BATCH_LENGTH:s||0},r&&r>0){const n=l(t,i,r);e.featureTableJson=JSON.parse(n)}return i+=r||0,e.featureTableBinary=new Uint8Array(t,i,n),i+=n||0,i}(e,t,i),i=function(e,t,i){const{batchTableJsonByteLength:r,batchTableBinaryByteLength:n}=e.header||{};if(r&&r>0){const s=l(t,i,r);e.batchTableJson=JSON.parse(s),i+=r,n&&n>0&&(e.batchTableBinary=new Uint8Array(t,i,n),e.batchTableBinary=new Uint8Array(e.batchTableBinary),i+=n)}return i}(e,t,i),i}function M(e,t=[0,0,0]){const i=e>>11&31,r=e>>5&63,n=31&e;return t[0]=i<<3,t[1]=r<<2,t[2]=n<<3,t}function U(e,t,i){if(!(t||e&&e.batchIds&&i))return null;const{batchIds:r,isRGB565:n,pointCount:s=0}=e;if(r&&i){const e=new Uint8ClampedArray(3*s);for(let t=0;t<s;t++){const n=r[t],s=i.getProperty(n,"dimensions").map((e=>255*e));e[3*t]=s[0],e[3*t+1]=s[1],e[3*t+2]=s[2]}return{type:u.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(t&&n){const e=new Uint8ClampedArray(3*s);for(let i=0;i<s;i++){const r=M(t[i]);e[3*i]=r[0],e[3*i+1]=r[1],e[3*i+2]=r[2]}return{type:u.GL.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*s?{type:u.GL.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:u.GL.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}var R=i(77422),D=i(54901);new R.I,new d.P,new R.I,new R.I,new Uint8Array(1);function B(e,t=255){return(0,D.qE)(e,0,t)/t*2-1}function V(e){return e<0?-1:1}function G(e,t,i,r){if(function(e,t){if(!e)throw new Error(`math.gl assertion failed. ${t}`)}(r),e<0||e>i||t<0||t>i)throw new Error(`x and y must be unsigned normalized integers between 0 and ${i}`);if(r.x=B(e,i),r.y=B(t,i),r.z=1-(Math.abs(r.x)+Math.abs(r.y)),r.z<0){const e=r.x;r.x=(1-Math.abs(r.y))*V(e),r.y=(1-Math.abs(e))*V(r.y)}return r.normalize()}function z(e,t,i){return G(e,t,255,i)}const q=new d.P;function F(e,t,i){return e.isQuantized?i["3d-tiles"]&&i["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){const i=new d.P,r=new Float32Array(3*e.pointCount);for(let n=0;n<e.pointCount;n++)i.set(t[3*n],t[3*n+1],t[3*n+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(r,3*n);return r}(e,t)):{type:u.GL.UNSIGNED_SHORT,value:t,size:3,normalized:!0}:t}async function H(e,t,i,r,n){i=x(e,t,i=O(e,t,i=L(e,t,i))),function(e){e.attributes={positions:null,colors:null,normals:null,batchIds:null},e.isQuantized=!1,e.isTranslucent=!1,e.isRGB565=!1,e.isOctEncoded16P=!1}(e);const{featureTable:s,batchTable:o}=function(e){const t=new y(e.featureTableJson,e.featureTableBinary),i=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(i))throw new Error("POINTS_LENGTH must be defined");t.featuresLength=i,e.featuresLength=i,e.pointsLength=i,e.pointCount=i,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3);const r=function(e,t){let i=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",u.GL.UNSIGNED_SHORT,1),e.batchIds)){const r=t.getGlobalProperty("BATCH_LENGTH");if(!r)throw new Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");const{batchTableJson:n,batchTableBinary:s}=e;i=new I(n,s,r)}return i}(e,t);return{featureTable:t,batchTable:r}}(e);return await async function(e,t,i,r,n){let s,o,a;const l=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);const u=t.getExtension("3DTILES_draco_point_compression");if(u){o=u.properties;const t=u.byteOffset,i=u.byteLength;if(!o||!Number.isFinite(t)||!i)throw new Error("Draco properties, byteOffset, and byteLength must be defined");s=(e.featureTableBinary||[]).slice(t,t+i),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!s)return!0;const p={buffer:s,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await async function(e,t,i,r){if(!r)return;const n={...i,draco:{...i?.draco,extraAttributes:t.batchTableProperties||{}}};delete n["3d-tiles"];const s=await(0,h.N9)(t.buffer,c.Vl,n,r),o=s.attributes.POSITION&&s.attributes.POSITION.value,a=s.attributes.COLOR_0&&s.attributes.COLOR_0.value,l=s.attributes.NORMAL&&s.attributes.NORMAL.value,u=s.attributes.BATCH_ID&&s.attributes.BATCH_ID.value,p=o&&s.attributes.POSITION.value.quantization,f=l&&s.attributes.NORMAL.value.quantization;if(p){const t=s.POSITION.data.quantization,i=t.range;e.quantizedVolumeScale=new d.P(i,i,i),e.quantizedVolumeOffset=new d.P(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}f&&(e.octEncodedRange=(1<<s.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);const m={};if(t.batchTableProperties)for(const c of Object.keys(t.batchTableProperties))s.attributes[c]&&s.attributes[c].value&&(m[c.toLowerCase()]=s.attributes[c].value);e.attributes={positions:o,colors:U(e,a,void 0),normals:l,batchIds:u,...m}}(e,p,r,n)}(e,s,0,r,n),function(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions)if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",u.GL.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){const r=t.getPropertyArray("POSITION_QUANTIZED",u.GL.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",u.GL.FLOAT,3),!e.quantizedVolumeScale)throw new Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",u.GL.FLOAT,3),!e.quantizedVolumeOffset)throw new Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=F(e,r,i)}if(!e.attributes.positions)throw new Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(e,s,r),function(e,t,i){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let r=null;t.hasProperty("RGBA")?(r=t.getPropertyArray("RGBA",u.GL.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?r=t.getPropertyArray("RGB",u.GL.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(r=t.getPropertyArray("RGB565",u.GL.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=U(e,r,i)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",u.GL.UNSIGNED_BYTE,4))}(e,s,o),function(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let i=null;t.hasProperty("NORMAL")?i=t.getPropertyArray("NORMAL",u.GL.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(i=t.getPropertyArray("NORMAL_OCT16P",u.GL.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){const i=new Float32Array(3*(e.pointsLength||0));for(let r=0;r<(e.pointsLength||0);r++)z(t[2*r],t[2*r+1],q),q.toArray(i,3*r);return{type:u.GL.FLOAT,size:2,value:i}}return{type:u.GL.FLOAT,size:2,value:t}}(e,i)}}(e,s),i}var k=i(78750),Z=i(59737),j=i(27885),$=i(10048);const W=0,Y=1;function Q(e,t,i,r){e.rotateYtoZ=!0;const n=(e.byteOffset||0)+(e.byteLength||0)-i;if(0===n)throw new Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=r?.["3d-tiles"]&&r["3d-tiles"].assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=(0,$._m)(t,i,n),e.gltfByteOffset=0,e.gltfByteLength=n,i%4==0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function J(e,t,i,r){const n=i?.["3d-tiles"]||{};if(function(e,t){switch(t){case W:if(e.gltfArrayBuffer){const t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset),i=(new TextDecoder).decode(t);e.gltfUrl=i.replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case Y:break;default:throw new Error("b3dm: Illegal glTF format field")}}(e,t),n.loadGLTF){if(!r)return;if(e.gltfUrl){const{fetch:t}=r,n=await t(e.gltfUrl,i);e.gltfArrayBuffer=await n.arrayBuffer(),e.gltfByteOffset=0}if(e.gltfArrayBuffer){const t=await(0,h.N9)(e.gltfArrayBuffer,k.B,i,r);e.gltf=(0,Z.R)(t),e.gpuMemoryUsageInBytes=(0,j.S3)(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength}}}async function X(e,t,i,r,n){i=function(e,t,i,r){i=L(e,t,i),i=O(e,t,i),i=x(e,t,i),i=Q(e,t,i,r);const n=new y(e.featureTableJson,e.featureTableBinary);return e.rtcCenter=n.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3),i}(e,t,i,r),await J(e,Y,r,n);const s=e?.gltf?.extensions;return s&&s.CESIUM_RTC&&(e.rtcCenter=s.CESIUM_RTC.center),i}var K=i(35567),ee=i(11633),te=i(31886),ie=i(4912);async function re(e,t,i,r,n){return i=function(e,t,i,r){if(i=L(e,t,i),1!==e.version)throw new Error(`Instanced 3D Model version ${e.version} is not supported`);i=O(e,t,i);const n=new DataView(t);if(e.gltfFormat=n.getUint32(i,!0),i+=4,i=x(e,t,i),i=Q(e,t,i,r),!e?.header?.featureTableJsonByteLength||0===e.header.featureTableJsonByteLength)throw new Error("i3dm parser: featureTableJsonByteLength is zero.");const s=new y(e.featureTableJson,e.featureTableBinary),o=s.getGlobalProperty("INSTANCES_LENGTH");if(s.featuresLength=o,!Number.isFinite(o))throw new Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=s.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=s.getGlobalProperty("RTC_CENTER",u.GL.FLOAT,3);new I(e.batchTableJson,e.batchTableBinary,o);return function(e,t,i,r){const n=new Array(r),s=new d.P,o=new d.P,a=new d.P,l=new d.P,c=new K.d,h=new ee.P,p=new d.P,f={},m=new te.k,g=[],y=[],T=[],_=[];for(let d=0;d<r;d++){let i;if(t.hasProperty("POSITION"))i=t.getProperty("POSITION",u.GL.FLOAT,3,d,s);else if(t.hasProperty("POSITION_QUANTIZED")){i=t.getProperty("POSITION_QUANTIZED",u.GL.UNSIGNED_SHORT,3,d,s);const e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",u.GL.FLOAT,3);if(!e)throw new Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");const r=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",u.GL.FLOAT,3);if(!r)throw new Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");const n=65535;for(let t=0;t<3;t++)i[t]=i[t]/n*r[t]+e[t]}if(!i)throw new Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");s.copy(i),f.translation=s,e.normalUp=t.getProperty("NORMAL_UP",u.GL.FLOAT,3,d,g),e.normalRight=t.getProperty("NORMAL_RIGHT",u.GL.FLOAT,3,d,y);const r=!1;if(e.normalUp){if(!e.normalRight)throw new Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",u.GL.UNSIGNED_SHORT,2,d,g),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",u.GL.UNSIGNED_SHORT,2,d,y),e.octNormalUp){if(!e.octNormalRight)throw new Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw new Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(ie.C.WGS84.eastNorthUpToFixedFrame(s,m),m.getRotationMatrix3(c)):c.identity()}r&&(l.copy(o).cross(a).normalize(),c.setColumn(0,o),c.setColumn(1,a),c.setColumn(2,l)),h.fromMatrix3(c),f.rotation=h,p.set(1,1,1);const b=t.getProperty("SCALE",u.GL.FLOAT,1,d,T);Number.isFinite(b)&&p.multiplyByScalar(b);const w=t.getProperty("SCALE_NON_UNIFORM",u.GL.FLOAT,3,d,g);w&&p.scale(w),f.scale=p;let S=t.getProperty("BATCH_ID",u.GL.UNSIGNED_SHORT,1,d,_);void 0===S&&(S=d);const E=(new te.k).fromQuaternion(f.rotation);m.identity(),m.translate(f.translation),m.multiplyRight(E),m.scale(f.scale);const P=m.clone();n[d]={modelMatrix:P,batchId:S}}e.instances=n}(e,s,0,o),i}(e,t,i,r),await J(e,e.gltfFormat||0,r,n),i}async function ne(e,t=0,i,r,n={shape:"tile3d"}){switch(n.byteOffset=t,n.type=function(e,t=0){const i=new DataView(e);return`${String.fromCharCode(i.getUint8(t+0))}${String.fromCharCode(i.getUint8(t+1))}${String.fromCharCode(i.getUint8(t+2))}${String.fromCharCode(i.getUint8(t+3))}`}(e,t),n.type){case o.COMPOSITE:return await async function(e,t,i,r,n,s){i=L(e,t,i);const o=new DataView(t);for(e.tilesLength=o.getUint32(i,!0),i+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-i>12;){const o={shape:"tile3d"};e.tiles.push(o),i=await s(t,i,r,n,o)}return i}(n,e,t,i,r,ne);case o.BATCHED_3D_MODEL:return await X(n,e,t,i,r);case o.GLTF:return await async function(e,t,i,r){if(e.rotateYtoZ=!0,e.gltfUpAxis=i?.["3d-tiles"]?.assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",i?.["3d-tiles"]?.loadGLTF){if(!r)return t.byteLength;const n=await(0,h.N9)(t,k.B,i,r);e.gltf=(0,Z.R)(n),e.gpuMemoryUsageInBytes=(0,j.S3)(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}(n,e,i,r);case o.INSTANCED_3D_MODEL:return await re(n,e,t,i,r);case o.POINT_CLOUD:return await H(n,e,t,i,r);default:throw new Error(`3DTileLoader: unknown type ${n.type}`)}}async function se(e,t,i,r){const n=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if("number"!=typeof n)return;const s=e.bufferViews[n],o=e.buffers[s.buffer];if(!r?.baseUrl)throw new Error("Url is not provided");if(!r.fetch)throw new Error("fetch is not provided");if(o.uri){const e=`${r?.baseUrl||""}/${o.uri}`,i=await r.fetch(e),n=await i.arrayBuffer();return void(t.explicitBitstream=new Uint8Array(n,s.byteOffset,s.byteLength))}const a=e.buffers.slice(0,s.buffer).reduce(((e,t)=>e+t.byteLength),0);t.explicitBitstream=new Uint8Array(i.slice(a,a+o.byteLength),s.byteOffset,s.byteLength)}function oe(e){const t=new DataView(e);return t.getUint32(0,!0)+2**32*t.getUint32(4,!0)}const ae={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:s,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(e,t,i){if(1952609651!==new Uint32Array(e.slice(0,4))[0])throw new Error("Wrong subtree file magic number");if(1!==new Uint32Array(e.slice(4,8))[0])throw new Error("Wrong subtree file verson, must be 1");const r=oe(e.slice(8,16)),n=new Uint8Array(e,24,r),s=new TextDecoder("utf8").decode(n),o=JSON.parse(s),a=oe(e.slice(16,24));let l=new ArrayBuffer(0);if(a&&(l=e.slice(24+r)),await se(o,o.tileAvailability,l,i),Array.isArray(o.contentAvailability))for(const c of o.contentAvailability)await se(o,c,l,i);else await se(o,o.contentAvailability,l,i);return await se(o,o.childSubtreeAvailability,l,i),o},options:{}};var le=i(327),ce=i(85335);globalThis.probe={};const he=new ce.t({id:"@probe.gl/log"});var ue=i(81456);function de(e){"X"===e&&(e="");const t=e.padEnd(16,"0");return ue.fromString(t,!0,16)}var pe=i(67733);const fe=180/Math.PI;function me(e,t,i){const r=1<<t;return[(e[0]+i[0])/r,(e[1]+i[1])/r]}function ge(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function ye(e){return[ge(e[0]),ge(e[1])]}function Te(e,[t,i]){switch(e){case 0:return[1,t,i];case 1:return[-t,1,i];case 2:return[-t,-i,1];case 3:return[-1,-i,-t];case 4:return[i,-1,-t];case 5:return[i,t,-1];default:throw new Error("Invalid face")}}function _e([e,t,i]){const r=Math.atan2(i,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*fe,r*fe]}function be(e,t,i,r){if(0===r){1===i&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}function we(e){const t=function(e){if(e.indexOf("/")>0)return e;const t=de(e);return function(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<64;)t="0"+t;const i=t.lastIndexOf("1"),r=t.substring(0,3),n=t.substring(3,i),s=n.length/2,o=ue.fromString(r,!0,2).toString(10);let a="";if(0!==s)for(a=ue.fromString(n,!0,2).toString(4);a.length<s;)a="0"+a;return`${o}/${a}`}(t)}(e);return function(e){if(0===e.length)throw new Error(`Invalid Hilbert quad key ${e}`);const t=e.split("/"),i=parseInt(t[0],10),r=t[1],n=r.length;let s=0;const o=[0,0];for(let a=n-1;a>=0;a--){s=n-a;const e=r[a];let t=0,i=0;"1"===e?i=1:"2"===e?(t=1,i=1):"3"===e&&(t=1);const l=Math.pow(2,s-1);be(l,o,t,i),o[0]+=l*t,o[1]+=l*i}if(i%2==1){const e=o[0];o[0]=o[1],o[1]=e}return{face:i,ij:o,level:s}}(t)}function Se(e){const{face:t,ij:i,level:r}=e,n=[[0,0],[0,1],[1,1],[1,0],[0,0]],s=Math.max(1,Math.ceil(100*Math.pow(2,-r))),o=new Float64Array(4*s*2+2);let a=0,l=0;for(let c=0;c<4;c++){const e=n[c].slice(0),h=n[c+1],u=(h[0]-e[0])/s,d=(h[1]-e[1])/s;for(let n=0;n<s;n++){e[0]+=u,e[1]+=d;const n=_e(Te(t,ye(me(i,r,e))));Math.abs(n[1])>89.999&&(n[0]=l);const s=n[0]-l;n[0]+=s>180?-360:s<-180?360:0,o[a++]=n[0],o[a++]=n[1],l=n[0]}}return o[a++]=o[0],o[a++]=o[1],o}function Ee(e){if(e.length%2!=0)throw new Error("Invalid corners");const t=[],i=[];for(let r=0;r<e.length;r+=2)t.push(e[r]),i.push(e[r+1]);return t.sort(((e,t)=>e-t)),i.sort(((e,t)=>e-t)),{west:t[0],east:t[t.length-1],north:i[i.length-1],south:i[0]}}function Pe(e,t){const i=t?.minimumHeight||0,r=t?.maximumHeight||0,n=function(e){let t;if(2===e.face||5===e.face){let i=null,r=0;for(let t=0;t<4;t++){const n=Se(we(`${e.face}/${t}`));null==i&&(i=new Float64Array(4*n.length)),i.set(n,r),r+=n.length}t=Ee(i)}else t=Ee(Se(e));return t}(we(e)),s=n.west,o=n.south,a=n.east,l=n.north,c=[];return c.push(new d.P(s,l,i)),c.push(new d.P(a,l,i)),c.push(new d.P(a,o,i)),c.push(new d.P(s,o,i)),c.push(new d.P(s,l,r)),c.push(new d.P(a,l,r)),c.push(new d.P(a,o,r)),c.push(new d.P(s,o,r)),c}function Ce(e){return function(e){const t=ye(me(e.ij,e.level,[.5,.5]));return _e(Te(e.face,t))}(we(e))}function ve(e){const t=e.token,i={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},r=Pe(t,i),n=Ce(t),s=n[0],o=n[1],a=ie.C.WGS84.cartographicToCartesian([s,o,i.maximumHeight]),l=new d.P(a[0],a[1],a[2]);r.push(l);const c=(0,pe.ZZ)(r);return[...c.center,...c.halfAxes]}const Ae={QUADTREE:4,OCTREE:8};function Ie(e,t,i){if(e?.box){const r=function(e,t){const i=function(e){return e.and(e.not().add(1))}(e).shiftRightUnsigned(2);return e.add(ue.fromNumber(2*t+1-4).multiply(i))}(de(e.s2VolumeInfo.token),t),n=function(e){if(e.isZero())return"X";let t=e.countTrailingZeros();t=(t-t%4)/4;const i=t;t*=4;const r=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-i-r.length).join("0")+r}(r),s={...e.s2VolumeInfo};if(s.token=n,"OCTREE"===i){const t=e.s2VolumeInfo,i=t.maximumHeight-t.minimumHeight,r=i/2,n=t.minimumHeight+i/2;t.minimumHeight=n-r,t.maximumHeight=n+r}return{box:ve(s),s2VolumeInfo:s}}}async function Le(e){const{implicitOptions:t,parentData:i={mortonIndex:0,x:0,y:0,z:0},childIndex:r=0,s2VolumeBox:n,loaderOptions:s}=e;let{subtree:o,level:a=0,globalData:l={level:0,mortonIndex:0,x:0,y:0,z:0}}=e;const{subdivisionScheme:c,subtreeLevels:h,maximumLevel:u,contentUrlTemplate:d,subtreesUriTemplate:p,basePath:f}=t,m={children:[],lodMetricValue:0,contentUrl:""};if(!u)return he.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${d} won't be loaded...`),m;const g=a+l.level;if(g>u)return m;const y=Ae[c],T=Math.log2(y),_=1&r,b=r>>1&1,w=r>>2&1,S=(y**a-1)/(y-1);let E=xe(i.mortonIndex,r,T),P=S+E,C=xe(i.x,_,1),v=xe(i.y,b,1),A=xe(i.z,w,1),I=!1;a>=h&&(I=Ne(o.childSubtreeAvailability,E));const L=xe(l.x,C,a),N=xe(l.y,v,a),O=xe(l.z,A,a);if(I){const e=Me(`${f}/${p}`,g,L,N,O);o=await(0,le.H)(e,ae,s),l={mortonIndex:E,x:C,y:v,z:A,level:a},E=0,P=0,C=0,v=0,A=0,a=0}if(!Ne(o.tileAvailability,P))return m;Ne(o.contentAvailability,P)&&(m.contentUrl=Me(d,g,L,N,O));const x=a+1,M={mortonIndex:E,x:C,y:v,z:A};for(let U=0;U<y;U++){const e=Ie(n,U,c),i=await Le({subtree:o,implicitOptions:t,loaderOptions:s,parentData:M,childIndex:U,level:x,globalData:{...l},s2VolumeBox:e});if(i.contentUrl||i.children.length){const e=Oe(i,g+1,{childTileX:C,childTileY:v,childTileZ:A},t,n);m.children.push(e)}}return m}function Ne(e,t){let i;return Array.isArray(e)?(i=e[0],e.length>1&&he.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=e,"constant"in i?Boolean(i.constant):!!i.explicitBitstream&&function(e,t){const i=Math.floor(e/8),r=e%8;return 1==(t[i]>>r&1)}(t,i.explicitBitstream)}function Oe(e,t,i,r,n){const{basePath:s,refine:o,getRefine:a,lodMetricType:l,getTileType:c,rootLodMetricValue:h,rootBoundingVolume:u}=r,d=e.contentUrl&&e.contentUrl.replace(`${s}/`,""),p=h/2**t,f=function(e,t,i){if(t.region){const{childTileX:r,childTileY:n,childTileZ:s}=i,[o,a,l,c,h,u]=t.region,d=2**e,p=(l-o)/d,f=(c-a)/d,m=(u-h)/d,[g,y]=[o+p*r,o+p*(r+1)],[T,_]=[a+f*n,a+f*(n+1)],[b,w]=[h+m*s,h+m*(s+1)];return{region:[g,T,y,_,b,w]}}if(t.box)return t;throw new Error(`Unsupported bounding volume type ${JSON.stringify(t)}`)}(t,n?.box?{box:n.box}:u,i);return{children:e.children,contentUrl:e.contentUrl,content:{uri:d},id:e.contentUrl,refine:a(o),type:c(e),lodMetricType:l,lodMetricValue:p,geometricError:p,transform:e.transform,boundingVolume:f}}function xe(e,t,i){return(e<<i)+t}function Me(e,t,i,r,n){const s=function(e){const t={};for(const i in e)t[`{${i}}`]=e[i];return t}({level:t,x:i,y:r,z:n});return e.replace(/{level}|{x}|{y}|{z}/gi,(e=>s[e]))}function Ue(e,t=""){if(!t)return n.WH.EMPTY;const i=t.split("?")[0].split(".").pop();switch(i){case"pnts":return n.WH.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return n.WH.SCENEGRAPH;default:return i||n.WH.EMPTY}}function Re(e){switch(e){case"REPLACE":case"replace":return n.lH.REPLACE;case"ADD":case"add":return n.lH.ADD;default:return e}}function De(e,t){if(/^[a-z][0-9a-z+.-]*:/i.test(t)){const i=new URL(e,`${t}/`);return decodeURI(i.toString())}return e.startsWith("/")?e:r.hd(t,e)}function Be(e,t){if(!e)return null;let i;if(e.content){const r=e.content.uri||e.content?.url;void 0!==r&&(i=De(r,t))}return{...e,id:i,contentUrl:i,lodMetricType:n.ir.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Ue(0,i),refine:Re(e.refine)}}async function Ve(e,t,i,r,s){const{subdivisionScheme:o,maximumLevel:a,availableLevels:l,subtreeLevels:c,subtrees:{uri:h}}=r,u=De(Me(h,0,0,0,0),i),d=await(0,le.H)(u,ae,s),p=e.content?.uri,f=p?De(p,i):"",m=t?.root?.refine,g=e.geometricError,y=e.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];if(y){const t={box:ve(y),s2VolumeInfo:y};e.boundingVolume=t}const T=e.boundingVolume,_={contentUrlTemplate:f,subtreesUriTemplate:h,subdivisionScheme:o,subtreeLevels:c,maximumLevel:Number.isFinite(l)?l-1:a,refine:m,basePath:i,lodMetricType:n.ir.GEOMETRIC_ERROR,rootLodMetricValue:g,rootBoundingVolume:T,getTileType:Ue,getRefine:Re};return await async function(e,t,i,r,s){if(!e)return null;const{children:o,contentUrl:a}=await Le({subtree:i,implicitOptions:r,loaderOptions:s});let l,c=null;a&&(l=a,c={uri:a.replace(`${t}/`,"")});const h={...e,id:l,contentUrl:l,lodMetricType:n.ir.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:Ue(0,l),refine:Re(e.refine),content:c||e.content,children:o};return h}(e,i,d,_,s)}function Ge(e){return e?.extensions?.["3DTILES_implicit_tiling"]||e?.implicitTiling}const ze={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:s,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:async function(e,t={},i){const s=t["3d-tiles"]||{};let o;o="auto"===s.isTileset?i?.url&&-1!==i.url.indexOf(".json"):s.isTileset;return o?async function(e,t,i){const s=JSON.parse((new TextDecoder).decode(e)),o=i?.url||"",a=function(e){return r.pD(e)}(o),l=await async function(e,t,i){let r=null;const n=Ge(e.root);r=n&&e.root?await Ve(e.root,e,t,n,i):Be(e.root,t);const s=[];for(s.push(r);s.length>0;){const r=s.pop()||{},n=r.children||[],o=[];for(const a of n){const r=Ge(a);let n;n=r?await Ve(a,e,t,r,i):Be(a,t),n&&(o.push(n),s.push(n))}r.children=o}return r}(s,a,t||{}),c={...s,shape:"tileset3d",loader:ze,url:o,queryString:i?.queryString||"",basePath:a,root:l||s.root,type:n.yy.TILES3D,lodMetricType:n.ir.GEOMETRIC_ERROR,lodMetricValue:s.root?.geometricError||0};return c}(e,t,i):async function(e,t,i){const r={content:{shape:"tile3d",featureIds:null}},n=0;return await ne(e,n,t,i,r.content),r.content}(e,t,i)},options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}}},10033:(e,t,i)=>{i.d(t,{GL:()=>n,Zf:()=>r});const r={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},n={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...r}},4999:(e,t,i)=>{i.d(t,{MY:()=>l,TP:()=>r,WH:()=>s,ir:()=>a,lH:()=>n,yy:()=>o});const r={UNLOADED:0,LOADING:1,PROCESSING:2,READY:3,EXPIRED:4,FAILED:5};var n,s,o,a;!function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"}(n||(n={})),function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"}(s||(s={})),function(e){e.I3S="I3S",e.TILES3D="TILES3D"}(o||(o={})),function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"}(a||(a={}));const l={NOT_COMPUTED:-1,USE_OPTIMIZATION:1,SKIP_OPTIMIZATION:0}},67410:(e,t,i)=>{i.d(t,{Q:()=>Se});var r=i(31886),n=i(87597),s=i(4912),o=i(97983),a=i(86428),l=i(78331);class c{item;previous;next;constructor(e,t,i){this.item=e,this.previous=t,this.next=i}}class h{head=null;tail=null;_length=0;get length(){return this._length}add(e){const t=new c(e,this.tail,null);return this.tail?(this.tail.next=t,this.tail=t):(this.head=t,this.tail=t),++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){const i=e.next;e.next=t,this.tail===e?this.tail=t:i.previous=t,t.next=i,t.previous=e,++this._length}}class u{_list;_sentinel;_trimTiles;constructor(){this._list=new h,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){const t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,i){t._cacheNode||(t._cacheNode=this._list.add(t),i&&i(e,t))}unloadTile(e,t,i){const r=t._cacheNode;r&&(this._list.remove(r),t._cacheNode=null,i&&i(e,t))}unloadTiles(e,t){const i=this._trimTiles;this._trimTiles=!1;const r=this._list,n=1024*e.maximumMemoryUsage*1024,s=this._sentinel;let o=r.head;for(;o!==s&&(e.gpuMemoryUsageInBytes>n||i);){const i=o.item;o=o.next,this.unloadTile(e,i,t)}}trim(){this._trimTiles=!0}}var d=i(94976);var p=i(67733);const f=new n.P,m=new n.P,g=new p.R2([new p.Zc,new p.Zc,new p.Zc,new p.Zc,new p.Zc,new p.Zc]);function y(e,t){const{cameraDirection:i,cameraUp:r,height:o}=e,{metersPerUnit:a}=e.distanceScales,l=_(e,e.center),c=s.C.WGS84.eastNorthUpToFixedFrame(l),h=e.unprojectPosition(e.cameraPosition),u=s.C.WGS84.cartographicToCartesian(h,new n.P),d=new n.P(c.transformAsVector(new n.P(i).scale(a))).normalize(),p=new n.P(c.transformAsVector(new n.P(r).scale(a))).normalize();!function(e){const t=e.getFrustumPlanes(),i=T(t.near,e.cameraPosition),r=_(e,i),n=_(e,e.cameraPosition,m);let s=0;g.planes[s++].fromPointNormal(r,f.copy(r).subtract(n));for(const o in t){if("near"===o)continue;const n=_(e,T(t[o],i,m),m);g.planes[s++].fromPointNormal(n,f.copy(r).subtract(n))}}(e);const y=e.constructor,{longitude:b,latitude:w,width:S,bearing:E,zoom:P}=e;return{camera:{position:u,direction:d,up:p},viewport:e,topDownViewport:new y({longitude:b,latitude:w,height:o,width:S,bearing:E,zoom:P,pitch:0}),height:o,cullingVolume:g,frameNumber:t,sseDenominator:1.15}}function T(e,t,i=new n.P){const r=e.normal.dot(t);return i.copy(e.normal).scale(e.distance-r).add(t),i}function _(e,t,i=new n.P){const r=e.unprojectPosition(t);return s.C.WGS84.cartographicToCartesian(r,i)}const b=6356752.314245179,w=new n.P;function S(e,t){if(e instanceof p.CB){const{halfAxes:i}=e,r=function(e){e.getColumn(0,w);const t=e.getColumn(1),i=e.getColumn(2),r=w.add(t).add(i);return r.len()}(i);return Math.log2(b/(r+t[2]))}if(e instanceof p.ie){const{radius:i}=e;return Math.log2(b/(i+t[2]))}if(e.width&&e.height){const{width:t,height:i}=e;return(Math.log2(6378137/t)+Math.log2(6378137/i))/2}return 1}function E(e,t,i){s.C.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],w);const r=Math.sqrt(Math.pow(w[0]-i[0],2)+Math.pow(w[1]-i[1],2)+Math.pow(w[2]-i[2],2));return Math.log2(b/(r+t[2]))}var P=i(327),C=i(4999),v=i(54901),A=i(11633),I=i(35567);function L(e){return null!=e}const N=new n.P,O=new n.P,x=new n.P,M=new n.P,U=new n.P,R=new n.P,D=new n.P,B=new n.P;function V(e,t,i){if((0,d.v)(e,"3D Tile: boundingVolume must be defined"),e.box)return z(e.box,t,i);if(e.region)return function(e){const[t,i,o,a,l,c]=e,h=s.C.WGS84.cartographicToCartesian([(0,v.uj)(t),(0,v.uj)(a),l],x),u=s.C.WGS84.cartographicToCartesian([(0,v.uj)(o),(0,v.uj)(i),c],M),d=(new n.P).addVectors(h,u).multiplyByScalar(.5);return s.C.WGS84.cartesianToCartographic(d,U),s.C.WGS84.cartographicToCartesian([(0,v.uj)(o),U[1],U[2]],R),s.C.WGS84.cartographicToCartesian([U[0],(0,v.uj)(a),U[2]],D),s.C.WGS84.cartographicToCartesian([U[0],U[1],c],B),z([...d,...R.subtract(d),...D.subtract(d),...B.subtract(d)],new r.k)}(e.region);if(e.sphere)return function(e,t,i){const r=new n.P(e[0],e[1],e[2]);t.transform(r,r);const s=t.getScale(O),o=Math.max(Math.max(s[0],s[1]),s[2]),a=e[3]*o;if(L(i))return i.center=r,i.radius=a,i;return new p.ie(r,a)}(e.sphere,t,i);throw new Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function G(e,t){if(e.box)return function(e){const t=q(),{halfAxes:i}=e,r=new n.P(i.getColumn(0)),s=new n.P(i.getColumn(1)),o=new n.P(i.getColumn(2));for(let n=0;n<2;n++){for(let i=0;i<2;i++){for(let i=0;i<2;i++)N.copy(e.center),N.add(r),N.add(s),N.add(o),F(t,N),o.negate();s.negate()}r.negate()}return t}(t);if(e.region){const[t,i,r,n,s,o]=e.region;return[[(0,v.uj)(t),(0,v.uj)(i),s],[(0,v.uj)(r),(0,v.uj)(n),o]]}if(e.sphere)return function(e){const t=q(),{center:i,radius:r}=e,o=s.C.WGS84.scaleToGeodeticSurface(i,N);let a;a=o?s.C.WGS84.geodeticSurfaceNormal(o):new n.P(0,0,1);let l=new n.P(a[2],-a[1],0);l.len()>0?l.normalize():l=new n.P(0,1,0);const c=l.clone().cross(a);for(const n of[l,c,a]){O.copy(n).scale(r);for(let e=0;e<2;e++)N.copy(i),N.add(O),F(t,N),O.negate()}return t}(t);throw new Error("Unkown boundingVolume type")}function z(e,t,i){const r=new n.P(e[0],e[1],e[2]);t.transform(r,r);let s=[];if(10===e.length){const t=e.slice(3,6),i=new A.P;i.fromArray(e,6);const r=new n.P([1,0,0]),o=new n.P([0,1,0]),a=new n.P([0,0,1]);r.transformByQuaternion(i),r.scale(t[0]),o.transformByQuaternion(i),o.scale(t[1]),a.transformByQuaternion(i),a.scale(t[2]),s=[...r.toArray(),...o.toArray(),...a.toArray()]}else s=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];const o=t.transformAsVector(s.slice(0,3)),a=t.transformAsVector(s.slice(3,6)),l=t.transformAsVector(s.slice(6,9)),c=new I.d([o[0],o[1],o[2],a[0],a[1],a[2],l[0],l[1],l[2]]);return L(i)?(i.center=r,i.halfAxes=c,i):new p.CB(r,c)}function q(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function F(e,t){s.C.WGS84.cartesianToCartographic(t,N),e[0][0]=Math.min(e[0][0],N[0]),e[0][1]=Math.min(e[0][1],N[1]),e[0][2]=Math.min(e[0][2],N[2]),e[1][0]=Math.max(e[1][0],N[0]),e[1][1]=Math.max(e[1][1],N[1]),e[1][2]=Math.max(e[1][2],N[2])}new n.P,new n.P,new r.k,new n.P,new n.P,new n.P;function H(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){const i=e.dynamicScreenSpaceErrorComputedDensity,r=e.dynamicScreenSpaceErrorFactor,n=function(e,t){const i=e*t;return 1-Math.exp(-i*i)}(t,i)*r;return n}return 0}const k=new n.P,Z=new n.P,j=new n.P,$=new n.P,W=new n.P,Y=new r.k,Q=new r.k;function J(e,t){const{topDownViewport:i}=t,r=e.header.mbs[1],n=e.header.mbs[0],o=e.header.mbs[2],a=e.header.mbs[3],l=[...e.boundingVolume.center],c=i.unprojectPosition(i.cameraPosition);s.C.WGS84.cartographicToCartesian(c,k),Z.copy(k).subtract(l).normalize(),s.C.WGS84.eastNorthUpToFixedFrame(l,Y),Q.copy(Y).invert(),j.copy(k).transform(Q);const h=Math.sqrt(j[0]*j[0]+j[1]*j[1]),u=h*h/j[2];$.copy([j[0],j[1],u]);const d=$.transform(Y).subtract(l).normalize(),p=Z.cross(d).normalize().scale(a).add(l),f=s.C.WGS84.cartesianToCartographic(p),m=i.project([n,r,o]),g=i.project(f);return W.copy(m).subtract(g).magnitude()}class X{_map=new Map;_array;_length;constructor(e=0){this._array=new Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return(0,d.v)(e<this._array.length),this._array[e]}set(e,t){(0,d.v)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){const t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){const t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){const e=this._array[--this.length];return this._map.delete(e),e}reserve(e){(0,d.v)(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){(0,d.v)(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}const K={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class ee{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=(new Date).getTime();updateDebounceTime=1e3;_traversalStack=new X;_emptyTraversalStack=new X;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...K,...e}}traverse(e,t,i){this.root=e,this.options={...this.options,...i},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){const i=this._traversalStack;for(e._selectionDepth=1,i.push(e);i.length>0;){const e=i.pop();let r=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),r=this.updateAndPushChildren(e,t,i,e.hasRenderContent?e._selectionDepth+1:e._selectionDepth));const n=e.parent,s=Boolean(!n||n._shouldRefine),o=!r;e.hasRenderContent?e.refine===C.lH.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===C.lH.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=r&&s}const r=(new Date).getTime();(this.traversalFinished(t)||r-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=r,this.options.onTraversalEnd(t))}updateChildTiles(e,t){const i=e.children;for(const r of i)this.updateTile(r,t)}updateAndPushChildren(e,t,i,r){const{loadSiblings:n,skipLevelOfDetail:s}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));const a=e.refine===C.lH.REPLACE&&e.hasRenderContent&&!s;let l=!1,c=!0;for(const h of o)if(h._selectionDepth=r,h.isVisibleAndInRequestVolume?(i.find(h)&&i.delete(h),i.push(h),l=!0):(a||n)&&(this.loadTile(h,t),this.touchTile(h,t)),a){let e;if(e=!!h._inRequestVolume&&(h.hasRenderContent?h.contentAvailable:this.executeEmptyTraversal(h,t)),c=c&&e,!c)return!1}return l||(c=!1),c}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t,i=!1,r=!1){return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:!(!r&&!e.isVisibleAndInRequestVolume)&&this.shouldRefine(e,t,i))}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,i=!1){let r=e._screenSpaceError;return i&&(r=e.getScreenSpaceError(t,!0)),r>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){const i=[];if(this.options.viewportTraversersMap)for(const r in this.options.viewportTraversersMap){this.options.viewportTraversersMap[r]===t.viewport.id&&i.push(r)}else i.push(t.viewport.id);e.updateVisibility(t,i)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let i=!1;for(const r of e.children)r.updateVisibility(t),i=i||r.isVisibleAndInRequestVolume;return i}executeEmptyTraversal(e,t){let i=!0;const r=this._emptyTraversalStack;for(r.push(e);r.length>0;){const e=r.pop(),n=!e.hasRenderContent&&this.canTraverse(e,t,!1,!1),s=!e.hasRenderContent&&0===e.children.length;if(n||e.contentAvailable||s||(i=!1),this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t)),n){const t=e.children;for(const e of t)r.push(e)}}return i}}const te=new n.P;class ie{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=C.TP.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new r.k;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new ee({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new r.k;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,t,i,r=""){this.header=t,this.tileset=e,this.id=r||t.id,this.url=t.url,this.parent=i,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===C.TP.READY||this.hasEmptyContent}get contentAvailable(){return Boolean(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===C.TP.UNLOADED}get contentExpired(){return this.contentState===C.TP.EXPIRED}get contentFailed(){return this.contentState===C.TP.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=G(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case C.yy.I3S:return J(this,e);case C.yy.TILES3D:return function(e,t,i){const r=e.tileset,n=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,s=i?n:e.lodMetricValue;if(0===s)return 0;const o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:c}=r.options;let h=s*a*(c||1)/(o*l);return h-=H(r,o),h}(this,e,t);default:throw new Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){const e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,i=this.refine===C.lH.ADD||t;if(i&&!this.isVisible&&void 0!==this._visible)return-1;if(this.tileset._frameNumber-this._touchedFrame>=1)return-1;if(this.contentState===C.TP.UNLOADED)return-1;const r=this.parent,n=r&&(!i||0===this._screenSpaceError||r.hasTilesetContent)?r._screenSpaceError:this._screenSpaceError,s=e.root?e.root._screenSpaceError:0;return Math.max(s-n,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=C.TP.LOADING;const e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=C.TP.UNLOADED,!1;try{const e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,i={...this.tileset.loadOptions,[t.id]:{...this.tileset.loadOptions[t.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)}};return this.content=await(0,P.H)(e,t,i),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=C.TP.READY,this._onContentLoaded(),!0}catch(t){throw this.contentState=C.TP.FAILED,t}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=C.TP.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;const i=this.parent,r=i?i._visibilityPlaneMask:p.R2.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){const e=i?i.computedTransform:this.tileset.modelMatrix;this._updateTransform(e)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,r),this._visible=this._visibilityPlaneMask!==p.R2.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){const{cullingVolume:i}=e,{boundingVolume:r}=this;return i.computeVisibilityWithPlaneMask(r,t)}contentVisibility(){return!0}distanceToTile(e){const t=this.boundingVolume;return Math.sqrt(Math.max(t.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){const t=this.boundingVolume;return te.subVectors(t.center,e.position),e.direction.dot(te)}insideViewerRequestVolume(e){const t=this._viewerRequestVolume;return!t||t.distanceSquaredTo(e.camera.position)<=0}updateExpiration(){if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){const e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=C.TP.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new r.k(e.transform):new r.k;const t=this.parent,i=this.tileset,n=t&&t.computedTransform?t.computedTransform.clone():i.modelMatrix.clone();this.computedTransform=new r.k(n).multiplyRight(this.transform);const s=t&&t._initialTransform?t._initialTransform.clone():new r.k;this._initialTransform=new r.k(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=C.TP.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=p.R2.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||C.lH.REPLACE}_isTileset(){return-1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=V(e.boundingVolume,this.computedTransform,this.boundingVolume);const t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=V(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=V(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new r.k){const t=e.clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){return"i3s"===e?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"};var t}}class re extends ee{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;const i=e.children.length>0;if(e.hasTilesetContent&&i){const i=e.children[0];return this.updateTileVisibility(i,t),void(e._visible=i._visible)}if(this.meetsScreenSpaceErrorEarly(e,t))return void(e._visible=!1);const r=e.refine===C.lH.REPLACE,n=e._optimChildrenWithinParent===C.MY.USE_OPTIMIZATION;r&&n&&i&&!this.anyChildrenVisible(e,t)&&(e._visible=!1)}meetsScreenSpaceErrorEarly(e,t){const{parent:i}=e;return!(!i||i.hasTilesetContent||i.refine!==C.lH.ADD)&&!this.shouldRefine(e,t,!0)}}class ne{frameNumberMap=new Map;register(e,t){const i=this.frameNumberMap.get(e)||new Map,r=i.get(t)||0;i.set(t,r+1),this.frameNumberMap.set(e,i)}deregister(e,t){const i=this.frameNumberMap.get(e);if(!i)return;const r=i.get(t)||1;i.set(t,r-1)}isZero(e,t){return 0===(this.frameNumberMap.get(e)?.get(t)||0)}}const se="REQUESTED",oe="COMPLETED",ae="ERROR";class le{_statusMap;pendingTilesRegister=new ne;constructor(){this._statusMap={}}add(e,t,i,r){if(!this._statusMap[t]){const{frameNumber:n,viewport:{id:s}}=r;this._statusMap[t]={request:e,callback:i,key:t,frameState:r,status:se},this.pendingTilesRegister.register(s,n),e().then((e=>{this._statusMap[t].status=oe;const{frameNumber:i,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,i),this._statusMap[t].callback(e,r)})).catch((e=>{this._statusMap[t].status=ae;const{frameNumber:r,viewport:{id:n}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(n,r),i(e)}))}}update(e,t){if(this._statusMap[e]){const{frameNumber:i,viewport:{id:r}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(r,i);const{frameNumber:n,viewport:{id:s}}=t;this.pendingTilesRegister.register(s,n),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class ce extends ee{_tileManager;constructor(e){super(e),this._tileManager=new le}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";const i=2*J(e,t);return i<2?"OUT":!e.header.children||i<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){const i=e.header.children||[],r=e.children,n=e.tileset;for(const s of i){const i=`${s.id}-${t.viewport.id}`,o=r&&r.find((e=>e.id===i));if(o)o&&this.updateTile(o,t);else{let r=()=>this._loadTile(s.id,n);this._tileManager.find(i)?this._tileManager.update(i,t):(n.tileset.nodePages&&(r=()=>n.tileset.nodePagesTile.formTileFromNodePages(s.id)),this._tileManager.add(r,i,(t=>this._onTileLoad(t,e,i)),t))}}return!1}async _loadTile(e,t){const{loader:i}=t,r=t.getTileUrl(`${t.url}/nodes/${e}`),n={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await(0,P.H)(r,i,n)}_onTileLoad(e,t,i){const r=new ie(t.tileset,e,t,i);t.children.push(r);const n=this._tileManager.find(r.id).frameState;this.updateTile(r,n),this._frameNumber===n.frameNumber&&(this.traversalFinished(n)||(new Date).getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(r,n)}}const he={description:"",ellipsoid:s.C.WGS84,modelMatrix:new r.k,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ue="Tiles In Tileset(s)",de="Tiles In Memory",pe="Tiles In View",fe="Tiles To Render",me="Tiles Loaded",ge="Tiles Loading",ye="Tiles Unloaded",Te="Failed Tile Loads",_e="Points/Vertices",be="Tile Memory Use",we="Maximum Screen Space Error";class Se{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new u;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,t){this.options={...he,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||a.pD(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new l.A({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=1024*this.options.maximumMemoryUsage*1024,this._cacheOverflowBytes=1024*this.options.memoryCacheOverflow*1024,this.stats=new o.A({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let t=e;return this.queryParams.length&&(t=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),t}hasExtension(e){return Boolean(this._extensionsUsed.indexOf(e)>-1)}update(e=null){this.tilesetInitializationPromise.then((()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)}))}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise((e=>{setTimeout((()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null}),this.options.debounceTime)}))),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles)return;if(this.traverseCounter>0)return;const t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;const i=[];for(const r of t){const e=r.id;this._needTraverse(e)?i.push(e):this.traverseCounter--}for(const r of t){const e=r.id;if(this.roots[e]||(this.roots[e]=this._initializeTileHeaders(this.tileset,null)),!i.includes(e))continue;const t=y(r,this._frameNumber);this._traverser.traverse(this.roots[e],t,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){const t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});const i=this.frameStateData[t],r=Object.values(this._traverser.selectedTiles),[n,s]=function(e,t,i){if(0===i||e.length<=i)return[e,[]];const r=[],{longitude:n,latitude:s}=t.viewport;for(const[c,h]of e.entries()){const[e,t]=h.header.mbs,i=Math.abs(n-e),o=Math.abs(s-t),a=Math.sqrt(o*o+i*i);r.push([c,a])}const o=r.sort(((e,t)=>e[1]-t[1])),a=[];for(let c=0;c<i;c++)a.push(e[o[c][0]]);const l=[];for(let c=i;c<o.length;c++)l.push(e[o[c][0]]);return[a,l]}(r,e,this.options.maximumTilesSelected);i.selectedTiles=n;for(const o of s)o.unselect();i._requestedTiles=Object.values(this._traverser.requestedTiles),i._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,this.traverseCounter>0||this._updateTiles()}_updateTiles(){this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[];for(const e in this.frameStateData){const t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles);for(const e of this.selectedTiles)this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;const i=new Set(e.map((e=>e.id))),r=new Set(t.map((e=>e.id)));let n=e.filter((e=>!r.has(e.id))).length>0;return n=n||t.filter((e=>!i.has(e.id))).length>0,n}_loadTiles(){for(const e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,((e,t)=>e._unloadTile(t)))}_updateStats(){let e=0,t=0;for(const i of this.selectedTiles)i.contentAvailable&&i.content&&(e++,i.content.pointCount?t+=i.content.pointCount:t+=i.content.vertexCount);this.stats.get(pe).count=this.selectedTiles.length,this.stats.get(fe).count=e,this.stats.get(_e).count=t,this.stats.get(we).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===C.yy.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===C.yy.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===C.yy.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){const e=this.tileset.fullExtent;if(e){const{xmin:t,xmax:i,ymin:r,ymax:o,zmin:a,zmax:l}=e;return this.cartographicCenter=new n.P(t+(i-t)/2,r+(o-r)/2,a+(l-a)/2),this.cartesianCenter=new n.P,s.C.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=E(e,this.cartographicCenter,this.cartesianCenter))}const t=this.tileset.store?.extent;if(t){const[e,i,r,o]=t;return this.cartographicCenter=new n.P(e+(r-e)/2,i+(o-i)/2,0),this.cartesianCenter=new n.P,s.C.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),void(this.zoom=function(e,t,i){const[r,n,s,o]=e;return E({xmin:r,xmax:s,ymin:n,ymax:o,zmin:0,zmax:0},t,i)}(t,this.cartographicCenter,this.cartesianCenter))}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new n.P,this.zoom=1}calculateViewPropsTiles3D(){const e=this.root,{center:t}=e.boundingVolume;if(!t)return console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new n.P,void(this.zoom=1);0!==t[0]||0!==t[1]||0!==t[2]?(this.cartographicCenter=new n.P,s.C.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new n.P(0,0,-s.C.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=S(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ue),this.stats.get(ge),this.stats.get(de),this.stats.get(pe),this.stats.get(fe),this.stats.get(me),this.stats.get(ye),this.stats.get(Te),this.stats.get(_e),this.stats.get(be,"memory"),this.stats.get(we)}_initializeTileHeaders(e,t){const i=new ie(this,e.root,t);if(t&&(t.children.push(i),i.depth=t.depth+1),this.type===C.yy.TILES3D){const e=[];for(e.push(i);e.length>0;){const t=e.pop();this.stats.get(ue).incrementCount();const i=t.header.children||[];for(const r of i){const i=new ie(this,r,t);if(i.contentUrl?.includes("?session=")){const e=new URL(i.contentUrl).searchParams.get("session");e&&(this._queryParams.session=e)}t.children.push(i),i.depth=t.depth+1,e.push(i)}}}return i}_initializeTraverser(){let e;switch(this.type){case C.yy.TILES3D:e=re;break;case C.yy.I3S:e=ce;break;default:e=ee}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(i){this._onTileLoadError(e,i instanceof Error?i:new Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(Te).incrementCount();const i=t.message||t.toString(),r=e.url;console.error(`A 3D tile failed to load: ${e.url} ${i}`),this.options.onTileError(e,i,r)}_onTileLoad(e,t){if(t){if(this.type===C.yy.I3S){const e=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(ue).reset(),this.stats.get(ue).addCount(e)}e&&e.content&&function(e,t){(0,d.v)(e),(0,d.v)(t);const{rtcCenter:i,gltfUpAxis:o}=t,{computedTransform:a,boundingVolume:{center:l}}=e;let c=new r.k(a);switch(i&&c.translate(i),o){case"Z":default:break;case"Y":const e=(new r.k).rotateX(Math.PI/2);c=c.multiplyRight(e);break;case"X":const t=(new r.k).rotateY(-Math.PI/2);c=c.multiplyRight(t)}t.isQuantized&&c.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);const h=new n.P(l);t.cartesianModelMatrix=c,t.cartesianOrigin=h;const u=s.C.WGS84.cartesianToCartographic(h,new n.P),p=s.C.WGS84.eastNorthUpToFixedFrame(h).invert();t.cartographicModelMatrix=p.multiplyRight(c),t.cartographicOrigin=u,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===C.yy.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===C.yy.TILES3D){const{extensionsRemoved:t=[]}=e.content?.gltf||{};t.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),t.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),t.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(ge).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(ge).decrementCount()}_addTileToCache(e){this._cache.add(this,e,(t=>t._updateCacheStats(e)))}_updateCacheStats(e){this.stats.get(me).incrementCount(),this.stats.get(de).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(be).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(de).decrementCount(),this.stats.get(ye).incrementCount(),this.stats.get(be).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){const e=[];for(this.root&&e.push(this.root);e.length>0;){const t=e.pop();for(const i of t.children)e.push(i);this._destroyTile(t)}this.root=null}_destroySubtree(e){const t=e,i=[];for(i.push(t);i.length>0;){e=i.pop();for(const t of e.children)i.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){const t=new URLSearchParams(e.queryString),i=Object.fromEntries(t.entries());this._queryParams={...this._queryParams,...i}}if(this.asset=e.asset,!this.asset)throw new Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw new Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}},72404:(e,t,i)=>{i.d(t,{w:()=>s});var r=i(10513);var n=i(38846);const s={name:"phongMaterial",dependencies:[r.x],source:"struct phongMaterialUniforms {\n  ambient: f32,\n  diffuse: f32,\n  shininess: f32,\n  specularColor: vec3<f32>,\n};\n\n@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;\n\nfn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {\n  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);\n  var lambertian: f32 = dot(light_direction, normal_worldspace);\n  var specular: f32 = 0.0;\n  if (lambertian > 0.0) {\n    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);\n    specular = pow(specular_angle, material.shininess);\n  }\n  lambertian = max(lambertian, 0.0);\n  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;\n}\n\nfn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {\n  var lightColor: vec3<f32> = surfaceColor;\n\n  if (lighting.enabled == 0) {\n    return lightColor;\n  }\n\n  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);\n  lightColor = material.ambient * surfaceColor * lighting.ambientColor;\n\n  if (lighting.lightType == 0) {\n    let pointLight: PointLight  = lighting_getPointLight(0);\n    let light_position_worldspace: vec3<f32> = pointLight.position;\n    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  } else if (lighting.lightType == 1) {\n    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  \n  return lightColor;\n  /*\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.pointLightCount) {\n      break;\n    }\n    PointLight pointLight = lighting.pointLight[i];\n    vec3 light_position_worldspace = pointLight.position;\n    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);\n    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n  }\n\n  for (int i = 0; i < MAX_LIGHTS; i++) {\n    if (i >= lighting.directionalLightCount) {\n      break;\n    }\n    DirectionalLight directionalLight = lighting.directionalLight[i];\n    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n  }\n  */\n}\n\nfn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{\n  var lightColor = vec3<f32>(0, 0, 0);\n  let surfaceColor = vec3<f32>(0, 0, 0);\n\n  if (lighting.enabled == 0) {\n    let view_direction = normalize(cameraPosition - position_worldspace);\n\n    switch (lighting.lightType) {\n      case 0, default: {\n        let pointLight: PointLight = lighting_getPointLight(0);\n        let light_position_worldspace: vec3<f32> = pointLight.position;\n        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);\n        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);\n      }\n      case 1: {\n        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);\n        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);\n      }\n    }\n  }\n  return lightColor;\n}\n",vs:n.X,fs:n.l,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){const t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map((e=>e/255))),{...s.defaultUniforms,...t}}}},77422:(e,t,i)=>{i.d(t,{I:()=>l});var r=i(54272),n=i(54901),s=i(73731),o=i(83588),a=i(68225);class l extends r.M{constructor(e=0,t=0){super(2),(0,n.cy)(e)&&1===arguments.length?this.copy(e):(n.$W.debug&&((0,s.ws)(e),(0,s.ws)(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return n.$W.debug&&((0,s.ws)(e.x),(0,s.ws)(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return(0,o.Z0)(this,this,e),this.check()}transformAsVector(e){return(0,a.B$)(this,this,e),this.check()}transformByMatrix3(e){return(0,o.ei)(this,this,e),this.check()}transformByMatrix2x3(e){return(0,o.l0)(this,this,e),this.check()}transformByMatrix2(e){return(0,o.ZF)(this,this,e),this.check()}}},4912:(e,t,i)=>{i.d(t,{C:()=>x});var r=i(87597),n=i(72734),s=i(4990),o=i(82859),a=i(31886),l=i(54901);const c=6378137,h=6378137,u=6356752.314245179;Math.max(c,h,u);function d(e){return e}new r.P;function p(e,t=[],i=d){return"longitude"in e?(t[0]=i(e.longitude),t[1]=i(e.latitude),t[2]=e.height):"x"in e?(t[0]=i(e.x),t[1]=i(e.y),t[2]=e.z):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}function f(e,t,i=d){return"longitude"in t?(t.longitude=i(e[0]),t.latitude=i(e[1]),t.height=e[2]):"x"in t?(t.x=i(e[0]),t.y=i(e[1]),t.z=e[2]):(t[0]=i(e[0]),t[1]=i(e[1]),t[2]=e[2]),t}const m=new r.P,g={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},y={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},T={east:new r.P,north:new r.P,up:new r.P,west:new r.P,south:new r.P,down:new r.P},_=new r.P,b=new r.P,w=new r.P;function S(e,t,i,r,n,o){const a=g[t]&&g[t][i];let c,h,u;(0,s.v)(a&&(!r||r===a));const d=m.copy(n);if((0,l.aI)(d.x,0,1e-14)&&(0,l.aI)(d.y,0,1e-14)){const e=Math.sign(d.z);c=_.fromArray(y[t]),"east"!==t&&"west"!==t&&c.scale(e),h=b.fromArray(y[i]),"east"!==i&&"west"!==i&&h.scale(e),u=w.fromArray(y[r]),"east"!==r&&"west"!==r&&u.scale(e)}else{const{up:n,east:s,north:o}=T;s.set(-d.y,d.x,0).normalize(),e.geodeticSurfaceNormal(d,n),o.copy(n).cross(s);const{down:a,west:l,south:p}=T;a.copy(n).scale(-1),l.copy(s).scale(-1),p.copy(o).scale(-1),c=T[t],h=T[i],u=T[r]}return o[0]=c.x,o[1]=c.y,o[2]=c.z,o[3]=0,o[4]=h.x,o[5]=h.y,o[6]=h.z,o[7]=0,o[8]=u.x,o[9]=u.y,o[10]=u.z,o[11]=0,o[12]=d.x,o[13]=d.y,o[14]=d.z,o[15]=1,o}const E=new r.P,P=new r.P,C=new r.P;const v=new r.P,A=new r.P,I=new r.P,L=new r.P,N=new r.P,O=new r.P;class x{constructor(e=0,t=0,i=0){this.centerToleranceSquared=n.Ix,(0,s.v)(e>=0),(0,s.v)(t>=0),(0,s.v)(i>=0),this.radii=new r.P(e,t,i),this.radiiSquared=new r.P(e*e,t*t,i*i),this.radiiToTheFourth=new r.P(e*e*e*e,t*t*t*t,i*i*i*i),this.oneOverRadii=new r.P(0===e?0:1/e,0===t?0:1/t,0===i?0:1/i),this.oneOverRadiiSquared=new r.P(0===e?0:1/(e*e),0===t?0:1/(t*t),0===i?0:1/(i*i)),this.minimumRadius=Math.min(e,t,i),this.maximumRadius=Math.max(e,t,i),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||Boolean(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){const i=A,r=I,[,,n]=e;this.geodeticSurfaceNormalCartographic(e,i),r.copy(this.radiiSquared).scale(i);const s=Math.sqrt(i.dot(r));return r.scale(1/s),i.scale(n),r.add(i),r.to(t)}cartesianToCartographic(e,t=[0,0,0]){O.from(e);const i=this.scaleToGeodeticSurface(O,L);if(!i)return;const r=this.geodeticSurfaceNormal(i,A),n=N;n.copy(O).subtract(i);const s=Math.atan2(r.y,r.x),a=Math.asin(r.z),c=Math.sign(o.Om(n,O))*o.Bw(n);return f([s,a,c],t,l.$W._cartographicRadians?d:l.xW)}eastNorthUpToFixedFrame(e,t=new a.k){return S(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,i,r,n=new a.k){return S(this,e,t,i,r,n)}geocentricSurfaceNormal(e,t=[0,0,0]){return v.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){const i=function(e,t=[]){return p(e,t,l.$W._cartographicRadians?d:l.eh)}(e),r=i[0],n=i[1],s=Math.cos(n);return v.set(s*Math.cos(r),s*Math.sin(r),Math.sin(n)).normalize(),v.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return v.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return function(e,t,i=[]){const{oneOverRadii:r,oneOverRadiiSquared:s,centerToleranceSquared:o}=t;E.from(e);const a=E.x,l=E.y,c=E.z,h=r.x,u=r.y,d=r.z,p=a*a*h*h,f=l*l*u*u,m=c*c*d*d,g=p+f+m,y=Math.sqrt(1/g);if(!Number.isFinite(y))return;const T=P;if(T.copy(e).scale(y),g<o)return T.to(i);const _=s.x,b=s.y,w=s.z,S=C;S.set(T.x*_*2,T.y*b*2,T.z*w*2);let v,A,I,L,N=(1-y)*E.len()/(.5*S.len()),O=0;do{N-=O,v=1/(1+N*_),A=1/(1+N*b),I=1/(1+N*w);const e=v*v,t=A*A,i=I*I;L=p*e+f*t+m*i-1,O=L/(-2*(p*(e*v)*_+f*(t*A)*b+m*(i*I)*w))}while(Math.abs(L)>n.IU);return E.scale([v,A,I]).to(i)}(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){L.from(e);const i=L.x,r=L.y,n=L.z,s=this.oneOverRadiiSquared,o=1/Math.sqrt(i*i*s.x+r*r*s.y+n*n*s.z);return L.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return L.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return L.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,i=[0,0,0]){(0,s.v)((0,l.aI)(this.radii.x,this.radii.y,n.Pq)),(0,s.v)(this.radii.z>0),L.from(e);const r=L.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(r)>=this.radii.z-t))return L.set(0,0,r).to(i)}}x.WGS84=new x(c,h,u)}}]);