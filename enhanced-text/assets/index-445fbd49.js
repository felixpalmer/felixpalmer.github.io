var $E=Object.defineProperty;var XE=(t,e,n)=>e in t?$E(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var d=(t,e,n)=>(XE(t,typeof e!="symbol"?e+"":e,n),n);function YE(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var Z4=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function v0(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var T0={exports:{}},J={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var So=Symbol.for("react.element"),KE=Symbol.for("react.portal"),qE=Symbol.for("react.fragment"),ZE=Symbol.for("react.strict_mode"),QE=Symbol.for("react.profiler"),JE=Symbol.for("react.provider"),GE=Symbol.for("react.context"),eS=Symbol.for("react.forward_ref"),tS=Symbol.for("react.suspense"),nS=Symbol.for("react.memo"),rS=Symbol.for("react.lazy"),fg=Symbol.iterator;function iS(t){return t===null||typeof t!="object"?null:(t=fg&&t[fg]||t["@@iterator"],typeof t=="function"?t:null)}var w0={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},E0=Object.assign,S0={};function qi(t,e,n){this.props=t,this.context=e,this.refs=S0,this.updater=n||w0}qi.prototype.isReactComponent={};qi.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};qi.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function b0(){}b0.prototype=qi.prototype;function md(t,e,n){this.props=t,this.context=e,this.refs=S0,this.updater=n||w0}var yd=md.prototype=new b0;yd.constructor=md;E0(yd,qi.prototype);yd.isPureReactComponent=!0;var hg=Array.isArray,A0=Object.prototype.hasOwnProperty,vd={current:null},R0={key:!0,ref:!0,__self:!0,__source:!0};function C0(t,e,n){var r,i={},s=null,o=null;if(e!=null)for(r in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(s=""+e.key),e)A0.call(e,r)&&!R0.hasOwnProperty(r)&&(i[r]=e[r]);var a=arguments.length-2;if(a===1)i.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];i.children=l}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)i[r]===void 0&&(i[r]=a[r]);return{$$typeof:So,type:t,key:s,ref:o,props:i,_owner:vd.current}}function sS(t,e){return{$$typeof:So,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function Td(t){return typeof t=="object"&&t!==null&&t.$$typeof===So}function oS(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var dg=/\/+/g;function uu(t,e){return typeof t=="object"&&t!==null&&t.key!=null?oS(""+t.key):e.toString(36)}function Oa(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var o=!1;if(t===null)o=!0;else switch(s){case"string":case"number":o=!0;break;case"object":switch(t.$$typeof){case So:case KE:o=!0}}if(o)return o=t,i=i(o),t=r===""?"."+uu(o,0):r,hg(i)?(n="",t!=null&&(n=t.replace(dg,"$&/")+"/"),Oa(i,e,n,"",function(c){return c})):i!=null&&(Td(i)&&(i=sS(i,n+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(dg,"$&/")+"/")+t)),e.push(i)),1;if(o=0,r=r===""?".":r+":",hg(t))for(var a=0;a<t.length;a++){s=t[a];var l=r+uu(s,a);o+=Oa(s,e,n,l,i)}else if(l=iS(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=r+uu(s,a++),o+=Oa(s,e,n,l,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function Yo(t,e,n){if(t==null)return t;var r=[],i=0;return Oa(t,r,"","",function(s){return e.call(n,s,i++)}),r}function aS(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var Ge={current:null},Fa={transition:null},lS={ReactCurrentDispatcher:Ge,ReactCurrentBatchConfig:Fa,ReactCurrentOwner:vd};function x0(){throw Error("act(...) is not supported in production builds of React.")}J.Children={map:Yo,forEach:function(t,e,n){Yo(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Yo(t,function(){e++}),e},toArray:function(t){return Yo(t,function(e){return e})||[]},only:function(t){if(!Td(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};J.Component=qi;J.Fragment=qE;J.Profiler=QE;J.PureComponent=md;J.StrictMode=ZE;J.Suspense=tS;J.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=lS;J.act=x0;J.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=E0({},t.props),i=t.key,s=t.ref,o=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,o=vd.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)A0.call(e,l)&&!R0.hasOwnProperty(l)&&(r[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)r.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];r.children=a}return{$$typeof:So,type:t.type,key:i,ref:s,props:r,_owner:o}};J.createContext=function(t){return t={$$typeof:GE,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:JE,_context:t},t.Consumer=t};J.createElement=C0;J.createFactory=function(t){var e=C0.bind(null,t);return e.type=t,e};J.createRef=function(){return{current:null}};J.forwardRef=function(t){return{$$typeof:eS,render:t}};J.isValidElement=Td;J.lazy=function(t){return{$$typeof:rS,_payload:{_status:-1,_result:t},_init:aS}};J.memo=function(t,e){return{$$typeof:nS,type:t,compare:e===void 0?null:e}};J.startTransition=function(t){var e=Fa.transition;Fa.transition={};try{t()}finally{Fa.transition=e}};J.unstable_act=x0;J.useCallback=function(t,e){return Ge.current.useCallback(t,e)};J.useContext=function(t){return Ge.current.useContext(t)};J.useDebugValue=function(){};J.useDeferredValue=function(t){return Ge.current.useDeferredValue(t)};J.useEffect=function(t,e){return Ge.current.useEffect(t,e)};J.useId=function(){return Ge.current.useId()};J.useImperativeHandle=function(t,e,n){return Ge.current.useImperativeHandle(t,e,n)};J.useInsertionEffect=function(t,e){return Ge.current.useInsertionEffect(t,e)};J.useLayoutEffect=function(t,e){return Ge.current.useLayoutEffect(t,e)};J.useMemo=function(t,e){return Ge.current.useMemo(t,e)};J.useReducer=function(t,e,n){return Ge.current.useReducer(t,e,n)};J.useRef=function(t){return Ge.current.useRef(t)};J.useState=function(t){return Ge.current.useState(t)};J.useSyncExternalStore=function(t,e,n){return Ge.current.useSyncExternalStore(t,e,n)};J.useTransition=function(){return Ge.current.useTransition()};J.version="18.3.1";T0.exports=J;var W=T0.exports;const Sf=v0(W);var P0={exports:{}},_t={},M0={exports:{}},I0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(j,Y){var q=j.length;j.push(Y);e:for(;0<q;){var K=q-1>>>1,G=j[K];if(0<i(G,Y))j[K]=Y,j[q]=G,q=K;else break e}}function n(j){return j.length===0?null:j[0]}function r(j){if(j.length===0)return null;var Y=j[0],q=j.pop();if(q!==Y){j[0]=q;e:for(var K=0,G=j.length,fe=G>>>1;K<fe;){var ze=2*(K+1)-1,Ct=j[ze],an=ze+1,Se=j[an];if(0>i(Ct,q))an<G&&0>i(Se,Ct)?(j[K]=Se,j[an]=q,K=an):(j[K]=Ct,j[ze]=q,K=ze);else if(an<G&&0>i(Se,q))j[K]=Se,j[an]=q,K=an;else break e}}return Y}function i(j,Y){var q=j.sortIndex-Y.sortIndex;return q!==0?q:j.id-Y.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var o=Date,a=o.now();t.unstable_now=function(){return o.now()-a}}var l=[],c=[],u=1,f=null,h=3,_=!1,v=!1,E=!1,b=typeof setTimeout=="function"?setTimeout:null,g=typeof clearTimeout=="function"?clearTimeout:null,p=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function y(j){for(var Y=n(c);Y!==null;){if(Y.callback===null)r(c);else if(Y.startTime<=j)r(c),Y.sortIndex=Y.expirationTime,e(l,Y);else break;Y=n(c)}}function S(j){if(E=!1,y(j),!v)if(n(l)!==null)v=!0,Ce(R);else{var Y=n(c);Y!==null&&we(S,Y.startTime-j)}}function R(j,Y){v=!1,E&&(E=!1,g(M),M=-1),_=!0;var q=h;try{for(y(Y),f=n(l);f!==null&&(!(f.expirationTime>Y)||j&&!F());){var K=f.callback;if(typeof K=="function"){f.callback=null,h=f.priorityLevel;var G=K(f.expirationTime<=Y);Y=t.unstable_now(),typeof G=="function"?f.callback=G:f===n(l)&&r(l),y(Y)}else r(l);f=n(l)}if(f!==null)var fe=!0;else{var ze=n(c);ze!==null&&we(S,ze.startTime-Y),fe=!1}return fe}finally{f=null,h=q,_=!1}}var P=!1,O=null,M=-1,k=5,D=-1;function F(){return!(t.unstable_now()-D<k)}function B(){if(O!==null){var j=t.unstable_now();D=j;var Y=!0;try{Y=O(!0,j)}finally{Y?V():(P=!1,O=null)}}else P=!1}var V;if(typeof p=="function")V=function(){p(B)};else if(typeof MessageChannel<"u"){var H=new MessageChannel,Z=H.port2;H.port1.onmessage=B,V=function(){Z.postMessage(null)}}else V=function(){b(B,0)};function Ce(j){O=j,P||(P=!0,V())}function we(j,Y){M=b(function(){j(t.unstable_now())},Y)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(j){j.callback=null},t.unstable_continueExecution=function(){v||_||(v=!0,Ce(R))},t.unstable_forceFrameRate=function(j){0>j||125<j?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<j?Math.floor(1e3/j):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(j){switch(h){case 1:case 2:case 3:var Y=3;break;default:Y=h}var q=h;h=Y;try{return j()}finally{h=q}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(j,Y){switch(j){case 1:case 2:case 3:case 4:case 5:break;default:j=3}var q=h;h=j;try{return Y()}finally{h=q}},t.unstable_scheduleCallback=function(j,Y,q){var K=t.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?K+q:K):q=K,j){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=q+G,j={id:u++,callback:Y,priorityLevel:j,startTime:q,expirationTime:G,sortIndex:-1},q>K?(j.sortIndex=q,e(c,j),n(l)===null&&j===n(c)&&(E?(g(M),M=-1):E=!0,we(S,q-K))):(j.sortIndex=G,e(l,j),v||_||(v=!0,Ce(R))),j},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(j){var Y=h;return function(){var q=h;h=Y;try{return j.apply(this,arguments)}finally{h=q}}}})(I0);M0.exports=I0;var cS=M0.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var uS=W,gt=cS;function L(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var N0=new Set,qs={};function Nr(t,e){xi(t,e),xi(t+"Capture",e)}function xi(t,e){for(qs[t]=e,t=0;t<e.length;t++)N0.add(e[t])}var yn=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),bf=Object.prototype.hasOwnProperty,fS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,pg={},gg={};function hS(t){return bf.call(gg,t)?!0:bf.call(pg,t)?!1:fS.test(t)?gg[t]=!0:(pg[t]=!0,!1)}function dS(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function pS(t,e,n,r){if(e===null||typeof e>"u"||dS(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function et(t,e,n,r,i,s,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=o}var Le={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Le[t]=new et(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Le[e]=new et(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Le[t]=new et(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Le[t]=new et(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Le[t]=new et(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Le[t]=new et(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Le[t]=new et(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Le[t]=new et(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Le[t]=new et(t,5,!1,t.toLowerCase(),null,!1,!1)});var wd=/[\-:]([a-z])/g;function Ed(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(wd,Ed);Le[e]=new et(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(wd,Ed);Le[e]=new et(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(wd,Ed);Le[e]=new et(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Le[t]=new et(t,1,!1,t.toLowerCase(),null,!1,!1)});Le.xlinkHref=new et("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Le[t]=new et(t,1,!1,t.toLowerCase(),null,!0,!0)});function Sd(t,e,n,r){var i=Le.hasOwnProperty(e)?Le[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(pS(e,n,i,r)&&(n=null),r||i===null?hS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var Sn=uS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ko=Symbol.for("react.element"),Gr=Symbol.for("react.portal"),ei=Symbol.for("react.fragment"),bd=Symbol.for("react.strict_mode"),Af=Symbol.for("react.profiler"),k0=Symbol.for("react.provider"),O0=Symbol.for("react.context"),Ad=Symbol.for("react.forward_ref"),Rf=Symbol.for("react.suspense"),Cf=Symbol.for("react.suspense_list"),Rd=Symbol.for("react.memo"),In=Symbol.for("react.lazy"),F0=Symbol.for("react.offscreen"),_g=Symbol.iterator;function os(t){return t===null||typeof t!="object"?null:(t=_g&&t[_g]||t["@@iterator"],typeof t=="function"?t:null)}var me=Object.assign,fu;function vs(t){if(fu===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);fu=e&&e[1]||""}return`
`+fu+t}var hu=!1;function du(t,e){if(!t||hu)return"";hu=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var r=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){r=c}t.call(e.prototype)}else{try{throw Error()}catch(c){r=c}t()}}catch(c){if(c&&r&&typeof c.stack=="string"){for(var i=c.stack.split(`
`),s=r.stack.split(`
`),o=i.length-1,a=s.length-1;1<=o&&0<=a&&i[o]!==s[a];)a--;for(;1<=o&&0<=a;o--,a--)if(i[o]!==s[a]){if(o!==1||a!==1)do if(o--,a--,0>a||i[o]!==s[a]){var l=`
`+i[o].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=o&&0<=a);break}}}finally{hu=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?vs(t):""}function gS(t){switch(t.tag){case 5:return vs(t.type);case 16:return vs("Lazy");case 13:return vs("Suspense");case 19:return vs("SuspenseList");case 0:case 2:case 15:return t=du(t.type,!1),t;case 11:return t=du(t.type.render,!1),t;case 1:return t=du(t.type,!0),t;default:return""}}function xf(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ei:return"Fragment";case Gr:return"Portal";case Af:return"Profiler";case bd:return"StrictMode";case Rf:return"Suspense";case Cf:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case O0:return(t.displayName||"Context")+".Consumer";case k0:return(t._context.displayName||"Context")+".Provider";case Ad:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Rd:return e=t.displayName||null,e!==null?e:xf(t.type)||"Memo";case In:e=t._payload,t=t._init;try{return xf(t(e))}catch{}}return null}function _S(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xf(e);case 8:return e===bd?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Qn(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function D0(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function mS(t){var e=D0(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){r=""+o,s.call(this,o)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(o){r=""+o},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function qo(t){t._valueTracker||(t._valueTracker=mS(t))}function B0(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=D0(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function Qa(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Pf(t,e){var n=e.checked;return me({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function mg(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Qn(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function U0(t,e){e=e.checked,e!=null&&Sd(t,"checked",e,!1)}function Mf(t,e){U0(t,e);var n=Qn(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?If(t,e.type,n):e.hasOwnProperty("defaultValue")&&If(t,e.type,Qn(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function yg(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function If(t,e,n){(e!=="number"||Qa(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ts=Array.isArray;function mi(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Qn(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Nf(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(L(91));return me({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function vg(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(L(92));if(Ts(n)){if(1<n.length)throw Error(L(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Qn(n)}}function L0(t,e){var n=Qn(e.value),r=Qn(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Tg(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function z0(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function kf(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?z0(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Zo,V0=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Zo=Zo||document.createElement("div"),Zo.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Zo.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Zs(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var Ps={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yS=["Webkit","ms","Moz","O"];Object.keys(Ps).forEach(function(t){yS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),Ps[e]=Ps[t]})});function j0(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||Ps.hasOwnProperty(t)&&Ps[t]?(""+e).trim():e+"px"}function H0(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=j0(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var vS=me({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Of(t,e){if(e){if(vS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(L(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(L(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(L(61))}if(e.style!=null&&typeof e.style!="object")throw Error(L(62))}}function Ff(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Df=null;function Cd(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Bf=null,yi=null,vi=null;function wg(t){if(t=Ro(t)){if(typeof Bf!="function")throw Error(L(280));var e=t.stateNode;e&&(e=Oc(e),Bf(t.stateNode,t.type,e))}}function W0(t){yi?vi?vi.push(t):vi=[t]:yi=t}function $0(){if(yi){var t=yi,e=vi;if(vi=yi=null,wg(t),e)for(t=0;t<e.length;t++)wg(e[t])}}function X0(t,e){return t(e)}function Y0(){}var pu=!1;function K0(t,e,n){if(pu)return t(e,n);pu=!0;try{return X0(t,e,n)}finally{pu=!1,(yi!==null||vi!==null)&&(Y0(),$0())}}function Qs(t,e){var n=t.stateNode;if(n===null)return null;var r=Oc(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(L(231,e,typeof n));return n}var Uf=!1;if(yn)try{var as={};Object.defineProperty(as,"passive",{get:function(){Uf=!0}}),window.addEventListener("test",as,as),window.removeEventListener("test",as,as)}catch{Uf=!1}function TS(t,e,n,r,i,s,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var Ms=!1,Ja=null,Ga=!1,Lf=null,wS={onError:function(t){Ms=!0,Ja=t}};function ES(t,e,n,r,i,s,o,a,l){Ms=!1,Ja=null,TS.apply(wS,arguments)}function SS(t,e,n,r,i,s,o,a,l){if(ES.apply(this,arguments),Ms){if(Ms){var c=Ja;Ms=!1,Ja=null}else throw Error(L(198));Ga||(Ga=!0,Lf=c)}}function kr(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function q0(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Eg(t){if(kr(t)!==t)throw Error(L(188))}function bS(t){var e=t.alternate;if(!e){if(e=kr(t),e===null)throw Error(L(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Eg(i),t;if(s===r)return Eg(i),e;s=s.sibling}throw Error(L(188))}if(n.return!==r.return)n=i,r=s;else{for(var o=!1,a=i.child;a;){if(a===n){o=!0,n=i,r=s;break}if(a===r){o=!0,r=i,n=s;break}a=a.sibling}if(!o){for(a=s.child;a;){if(a===n){o=!0,n=s,r=i;break}if(a===r){o=!0,r=s,n=i;break}a=a.sibling}if(!o)throw Error(L(189))}}if(n.alternate!==r)throw Error(L(190))}if(n.tag!==3)throw Error(L(188));return n.stateNode.current===n?t:e}function Z0(t){return t=bS(t),t!==null?Q0(t):null}function Q0(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Q0(t);if(e!==null)return e;t=t.sibling}return null}var J0=gt.unstable_scheduleCallback,Sg=gt.unstable_cancelCallback,AS=gt.unstable_shouldYield,RS=gt.unstable_requestPaint,Ee=gt.unstable_now,CS=gt.unstable_getCurrentPriorityLevel,xd=gt.unstable_ImmediatePriority,G0=gt.unstable_UserBlockingPriority,el=gt.unstable_NormalPriority,xS=gt.unstable_LowPriority,ev=gt.unstable_IdlePriority,Mc=null,tn=null;function PS(t){if(tn&&typeof tn.onCommitFiberRoot=="function")try{tn.onCommitFiberRoot(Mc,t,void 0,(t.current.flags&128)===128)}catch{}}var Bt=Math.clz32?Math.clz32:NS,MS=Math.log,IS=Math.LN2;function NS(t){return t>>>=0,t===0?32:31-(MS(t)/IS|0)|0}var Qo=64,Jo=4194304;function ws(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function tl(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,o=n&268435455;if(o!==0){var a=o&~i;a!==0?r=ws(a):(s&=o,s!==0&&(r=ws(s)))}else o=n&~i,o!==0?r=ws(o):s!==0&&(r=ws(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Bt(e),i=1<<n,r|=t[n],e&=~i;return r}function kS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function OS(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var o=31-Bt(s),a=1<<o,l=i[o];l===-1?(!(a&n)||a&r)&&(i[o]=kS(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function zf(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function tv(){var t=Qo;return Qo<<=1,!(Qo&4194240)&&(Qo=64),t}function gu(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function bo(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Bt(e),t[e]=n}function FS(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-Bt(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Pd(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Bt(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var re=0;function nv(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var rv,Md,iv,sv,ov,Vf=!1,Go=[],jn=null,Hn=null,Wn=null,Js=new Map,Gs=new Map,Dn=[],DS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function bg(t,e){switch(t){case"focusin":case"focusout":jn=null;break;case"dragenter":case"dragleave":Hn=null;break;case"mouseover":case"mouseout":Wn=null;break;case"pointerover":case"pointerout":Js.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Gs.delete(e.pointerId)}}function ls(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=Ro(e),e!==null&&Md(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function BS(t,e,n,r,i){switch(e){case"focusin":return jn=ls(jn,t,e,n,r,i),!0;case"dragenter":return Hn=ls(Hn,t,e,n,r,i),!0;case"mouseover":return Wn=ls(Wn,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Js.set(s,ls(Js.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Gs.set(s,ls(Gs.get(s)||null,t,e,n,r,i)),!0}return!1}function av(t){var e=dr(t.target);if(e!==null){var n=kr(e);if(n!==null){if(e=n.tag,e===13){if(e=q0(n),e!==null){t.blockedOn=e,ov(t.priority,function(){iv(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Da(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=jf(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Df=r,n.target.dispatchEvent(r),Df=null}else return e=Ro(n),e!==null&&Md(e),t.blockedOn=n,!1;e.shift()}return!0}function Ag(t,e,n){Da(t)&&n.delete(e)}function US(){Vf=!1,jn!==null&&Da(jn)&&(jn=null),Hn!==null&&Da(Hn)&&(Hn=null),Wn!==null&&Da(Wn)&&(Wn=null),Js.forEach(Ag),Gs.forEach(Ag)}function cs(t,e){t.blockedOn===e&&(t.blockedOn=null,Vf||(Vf=!0,gt.unstable_scheduleCallback(gt.unstable_NormalPriority,US)))}function eo(t){function e(i){return cs(i,t)}if(0<Go.length){cs(Go[0],t);for(var n=1;n<Go.length;n++){var r=Go[n];r.blockedOn===t&&(r.blockedOn=null)}}for(jn!==null&&cs(jn,t),Hn!==null&&cs(Hn,t),Wn!==null&&cs(Wn,t),Js.forEach(e),Gs.forEach(e),n=0;n<Dn.length;n++)r=Dn[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Dn.length&&(n=Dn[0],n.blockedOn===null);)av(n),n.blockedOn===null&&Dn.shift()}var Ti=Sn.ReactCurrentBatchConfig,nl=!0;function LS(t,e,n,r){var i=re,s=Ti.transition;Ti.transition=null;try{re=1,Id(t,e,n,r)}finally{re=i,Ti.transition=s}}function zS(t,e,n,r){var i=re,s=Ti.transition;Ti.transition=null;try{re=4,Id(t,e,n,r)}finally{re=i,Ti.transition=s}}function Id(t,e,n,r){if(nl){var i=jf(t,e,n,r);if(i===null)Au(t,e,r,rl,n),bg(t,r);else if(BS(i,t,e,n,r))r.stopPropagation();else if(bg(t,r),e&4&&-1<DS.indexOf(t)){for(;i!==null;){var s=Ro(i);if(s!==null&&rv(s),s=jf(t,e,n,r),s===null&&Au(t,e,r,rl,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else Au(t,e,r,null,n)}}var rl=null;function jf(t,e,n,r){if(rl=null,t=Cd(r),t=dr(t),t!==null)if(e=kr(t),e===null)t=null;else if(n=e.tag,n===13){if(t=q0(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return rl=t,null}function lv(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(CS()){case xd:return 1;case G0:return 4;case el:case xS:return 16;case ev:return 536870912;default:return 16}default:return 16}}var Un=null,Nd=null,Ba=null;function cv(){if(Ba)return Ba;var t,e=Nd,n=e.length,r,i="value"in Un?Un.value:Un.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var o=n-t;for(r=1;r<=o&&e[n-r]===i[s-r];r++);return Ba=i.slice(t,1<r?1-r:void 0)}function Ua(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function ea(){return!0}function Rg(){return!1}function mt(t){function e(n,r,i,s,o){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=o,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?ea:Rg,this.isPropagationStopped=Rg,this}return me(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=ea)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=ea)},persist:function(){},isPersistent:ea}),e}var Zi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},kd=mt(Zi),Ao=me({},Zi,{view:0,detail:0}),VS=mt(Ao),_u,mu,us,Ic=me({},Ao,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Od,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==us&&(us&&t.type==="mousemove"?(_u=t.screenX-us.screenX,mu=t.screenY-us.screenY):mu=_u=0,us=t),_u)},movementY:function(t){return"movementY"in t?t.movementY:mu}}),Cg=mt(Ic),jS=me({},Ic,{dataTransfer:0}),HS=mt(jS),WS=me({},Ao,{relatedTarget:0}),yu=mt(WS),$S=me({},Zi,{animationName:0,elapsedTime:0,pseudoElement:0}),XS=mt($S),YS=me({},Zi,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),KS=mt(YS),qS=me({},Zi,{data:0}),xg=mt(qS),ZS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},JS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=JS[t])?!!e[t]:!1}function Od(){return GS}var eb=me({},Ao,{key:function(t){if(t.key){var e=ZS[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Ua(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?QS[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Od,charCode:function(t){return t.type==="keypress"?Ua(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ua(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),tb=mt(eb),nb=me({},Ic,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Pg=mt(nb),rb=me({},Ao,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Od}),ib=mt(rb),sb=me({},Zi,{propertyName:0,elapsedTime:0,pseudoElement:0}),ob=mt(sb),ab=me({},Ic,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),lb=mt(ab),cb=[9,13,27,32],Fd=yn&&"CompositionEvent"in window,Is=null;yn&&"documentMode"in document&&(Is=document.documentMode);var ub=yn&&"TextEvent"in window&&!Is,uv=yn&&(!Fd||Is&&8<Is&&11>=Is),Mg=String.fromCharCode(32),Ig=!1;function fv(t,e){switch(t){case"keyup":return cb.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hv(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ti=!1;function fb(t,e){switch(t){case"compositionend":return hv(e);case"keypress":return e.which!==32?null:(Ig=!0,Mg);case"textInput":return t=e.data,t===Mg&&Ig?null:t;default:return null}}function hb(t,e){if(ti)return t==="compositionend"||!Fd&&fv(t,e)?(t=cv(),Ba=Nd=Un=null,ti=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uv&&e.locale!=="ko"?null:e.data;default:return null}}var db={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ng(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!db[t.type]:e==="textarea"}function dv(t,e,n,r){W0(r),e=il(e,"onChange"),0<e.length&&(n=new kd("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ns=null,to=null;function pb(t){bv(t,0)}function Nc(t){var e=ii(t);if(B0(e))return t}function gb(t,e){if(t==="change")return e}var pv=!1;if(yn){var vu;if(yn){var Tu="oninput"in document;if(!Tu){var kg=document.createElement("div");kg.setAttribute("oninput","return;"),Tu=typeof kg.oninput=="function"}vu=Tu}else vu=!1;pv=vu&&(!document.documentMode||9<document.documentMode)}function Og(){Ns&&(Ns.detachEvent("onpropertychange",gv),to=Ns=null)}function gv(t){if(t.propertyName==="value"&&Nc(to)){var e=[];dv(e,to,t,Cd(t)),K0(pb,e)}}function _b(t,e,n){t==="focusin"?(Og(),Ns=e,to=n,Ns.attachEvent("onpropertychange",gv)):t==="focusout"&&Og()}function mb(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Nc(to)}function yb(t,e){if(t==="click")return Nc(e)}function vb(t,e){if(t==="input"||t==="change")return Nc(e)}function Tb(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Lt=typeof Object.is=="function"?Object.is:Tb;function no(t,e){if(Lt(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!bf.call(e,i)||!Lt(t[i],e[i]))return!1}return!0}function Fg(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Dg(t,e){var n=Fg(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Fg(n)}}function _v(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?_v(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function mv(){for(var t=window,e=Qa();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=Qa(t.document)}return e}function Dd(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function wb(t){var e=mv(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&_v(n.ownerDocument.documentElement,n)){if(r!==null&&Dd(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=Dg(n,s);var o=Dg(n,r);i&&o&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==o.node||t.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Eb=yn&&"documentMode"in document&&11>=document.documentMode,ni=null,Hf=null,ks=null,Wf=!1;function Bg(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Wf||ni==null||ni!==Qa(r)||(r=ni,"selectionStart"in r&&Dd(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),ks&&no(ks,r)||(ks=r,r=il(Hf,"onSelect"),0<r.length&&(e=new kd("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ni)))}function ta(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var ri={animationend:ta("Animation","AnimationEnd"),animationiteration:ta("Animation","AnimationIteration"),animationstart:ta("Animation","AnimationStart"),transitionend:ta("Transition","TransitionEnd")},wu={},yv={};yn&&(yv=document.createElement("div").style,"AnimationEvent"in window||(delete ri.animationend.animation,delete ri.animationiteration.animation,delete ri.animationstart.animation),"TransitionEvent"in window||delete ri.transitionend.transition);function kc(t){if(wu[t])return wu[t];if(!ri[t])return t;var e=ri[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in yv)return wu[t]=e[n];return t}var vv=kc("animationend"),Tv=kc("animationiteration"),wv=kc("animationstart"),Ev=kc("transitionend"),Sv=new Map,Ug="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function er(t,e){Sv.set(t,e),Nr(e,[t])}for(var Eu=0;Eu<Ug.length;Eu++){var Su=Ug[Eu],Sb=Su.toLowerCase(),bb=Su[0].toUpperCase()+Su.slice(1);er(Sb,"on"+bb)}er(vv,"onAnimationEnd");er(Tv,"onAnimationIteration");er(wv,"onAnimationStart");er("dblclick","onDoubleClick");er("focusin","onFocus");er("focusout","onBlur");er(Ev,"onTransitionEnd");xi("onMouseEnter",["mouseout","mouseover"]);xi("onMouseLeave",["mouseout","mouseover"]);xi("onPointerEnter",["pointerout","pointerover"]);xi("onPointerLeave",["pointerout","pointerover"]);Nr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Nr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Nr("onBeforeInput",["compositionend","keypress","textInput","paste"]);Nr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Nr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Nr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Es="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ab=new Set("cancel close invalid load scroll toggle".split(" ").concat(Es));function Lg(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,SS(r,e,void 0,t),t.currentTarget=null}function bv(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var o=r.length-1;0<=o;o--){var a=r[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;Lg(i,a,c),s=l}else for(o=0;o<r.length;o++){if(a=r[o],l=a.instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;Lg(i,a,c),s=l}}}if(Ga)throw t=Lf,Ga=!1,Lf=null,t}function ce(t,e){var n=e[qf];n===void 0&&(n=e[qf]=new Set);var r=t+"__bubble";n.has(r)||(Av(e,t,2,!1),n.add(r))}function bu(t,e,n){var r=0;e&&(r|=4),Av(n,t,r,e)}var na="_reactListening"+Math.random().toString(36).slice(2);function ro(t){if(!t[na]){t[na]=!0,N0.forEach(function(n){n!=="selectionchange"&&(Ab.has(n)||bu(n,!1,t),bu(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[na]||(e[na]=!0,bu("selectionchange",!1,e))}}function Av(t,e,n,r){switch(lv(e)){case 1:var i=LS;break;case 4:i=zS;break;default:i=Id}n=i.bind(null,e,n,t),i=void 0,!Uf||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function Au(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var o=r.tag;if(o===3||o===4){var a=r.stateNode.containerInfo;if(a===i||a.nodeType===8&&a.parentNode===i)break;if(o===4)for(o=r.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===i||l.nodeType===8&&l.parentNode===i))return;o=o.return}for(;a!==null;){if(o=dr(a),o===null)return;if(l=o.tag,l===5||l===6){r=s=o;continue e}a=a.parentNode}}r=r.return}K0(function(){var c=s,u=Cd(n),f=[];e:{var h=Sv.get(t);if(h!==void 0){var _=kd,v=t;switch(t){case"keypress":if(Ua(n)===0)break e;case"keydown":case"keyup":_=tb;break;case"focusin":v="focus",_=yu;break;case"focusout":v="blur",_=yu;break;case"beforeblur":case"afterblur":_=yu;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":_=Cg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":_=HS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":_=ib;break;case vv:case Tv:case wv:_=XS;break;case Ev:_=ob;break;case"scroll":_=VS;break;case"wheel":_=lb;break;case"copy":case"cut":case"paste":_=KS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":_=Pg}var E=(e&4)!==0,b=!E&&t==="scroll",g=E?h!==null?h+"Capture":null:h;E=[];for(var p=c,y;p!==null;){y=p;var S=y.stateNode;if(y.tag===5&&S!==null&&(y=S,g!==null&&(S=Qs(p,g),S!=null&&E.push(io(p,S,y)))),b)break;p=p.return}0<E.length&&(h=new _(h,v,null,n,u),f.push({event:h,listeners:E}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",_=t==="mouseout"||t==="pointerout",h&&n!==Df&&(v=n.relatedTarget||n.fromElement)&&(dr(v)||v[vn]))break e;if((_||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,_?(v=n.relatedTarget||n.toElement,_=c,v=v?dr(v):null,v!==null&&(b=kr(v),v!==b||v.tag!==5&&v.tag!==6)&&(v=null)):(_=null,v=c),_!==v)){if(E=Cg,S="onMouseLeave",g="onMouseEnter",p="mouse",(t==="pointerout"||t==="pointerover")&&(E=Pg,S="onPointerLeave",g="onPointerEnter",p="pointer"),b=_==null?h:ii(_),y=v==null?h:ii(v),h=new E(S,p+"leave",_,n,u),h.target=b,h.relatedTarget=y,S=null,dr(u)===c&&(E=new E(g,p+"enter",v,n,u),E.target=y,E.relatedTarget=b,S=E),b=S,_&&v)t:{for(E=_,g=v,p=0,y=E;y;y=zr(y))p++;for(y=0,S=g;S;S=zr(S))y++;for(;0<p-y;)E=zr(E),p--;for(;0<y-p;)g=zr(g),y--;for(;p--;){if(E===g||g!==null&&E===g.alternate)break t;E=zr(E),g=zr(g)}E=null}else E=null;_!==null&&zg(f,h,_,E,!1),v!==null&&b!==null&&zg(f,b,v,E,!0)}}e:{if(h=c?ii(c):window,_=h.nodeName&&h.nodeName.toLowerCase(),_==="select"||_==="input"&&h.type==="file")var R=gb;else if(Ng(h))if(pv)R=vb;else{R=mb;var P=_b}else(_=h.nodeName)&&_.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(R=yb);if(R&&(R=R(t,c))){dv(f,R,n,u);break e}P&&P(t,h,c),t==="focusout"&&(P=h._wrapperState)&&P.controlled&&h.type==="number"&&If(h,"number",h.value)}switch(P=c?ii(c):window,t){case"focusin":(Ng(P)||P.contentEditable==="true")&&(ni=P,Hf=c,ks=null);break;case"focusout":ks=Hf=ni=null;break;case"mousedown":Wf=!0;break;case"contextmenu":case"mouseup":case"dragend":Wf=!1,Bg(f,n,u);break;case"selectionchange":if(Eb)break;case"keydown":case"keyup":Bg(f,n,u)}var O;if(Fd)e:{switch(t){case"compositionstart":var M="onCompositionStart";break e;case"compositionend":M="onCompositionEnd";break e;case"compositionupdate":M="onCompositionUpdate";break e}M=void 0}else ti?fv(t,n)&&(M="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(M="onCompositionStart");M&&(uv&&n.locale!=="ko"&&(ti||M!=="onCompositionStart"?M==="onCompositionEnd"&&ti&&(O=cv()):(Un=u,Nd="value"in Un?Un.value:Un.textContent,ti=!0)),P=il(c,M),0<P.length&&(M=new xg(M,t,null,n,u),f.push({event:M,listeners:P}),O?M.data=O:(O=hv(n),O!==null&&(M.data=O)))),(O=ub?fb(t,n):hb(t,n))&&(c=il(c,"onBeforeInput"),0<c.length&&(u=new xg("onBeforeInput","beforeinput",null,n,u),f.push({event:u,listeners:c}),u.data=O))}bv(f,e)})}function io(t,e,n){return{instance:t,listener:e,currentTarget:n}}function il(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=Qs(t,n),s!=null&&r.unshift(io(t,s,i)),s=Qs(t,e),s!=null&&r.push(io(t,s,i))),t=t.return}return r}function zr(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function zg(t,e,n,r,i){for(var s=e._reactName,o=[];n!==null&&n!==r;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===r)break;a.tag===5&&c!==null&&(a=c,i?(l=Qs(n,s),l!=null&&o.unshift(io(n,l,a))):i||(l=Qs(n,s),l!=null&&o.push(io(n,l,a)))),n=n.return}o.length!==0&&t.push({event:e,listeners:o})}var Rb=/\r\n?/g,Cb=/\u0000|\uFFFD/g;function Vg(t){return(typeof t=="string"?t:""+t).replace(Rb,`
`).replace(Cb,"")}function ra(t,e,n){if(e=Vg(e),Vg(t)!==e&&n)throw Error(L(425))}function sl(){}var $f=null,Xf=null;function Yf(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Kf=typeof setTimeout=="function"?setTimeout:void 0,xb=typeof clearTimeout=="function"?clearTimeout:void 0,jg=typeof Promise=="function"?Promise:void 0,Pb=typeof queueMicrotask=="function"?queueMicrotask:typeof jg<"u"?function(t){return jg.resolve(null).then(t).catch(Mb)}:Kf;function Mb(t){setTimeout(function(){throw t})}function Ru(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),eo(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);eo(e)}function $n(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function Hg(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var Qi=Math.random().toString(36).slice(2),Qt="__reactFiber$"+Qi,so="__reactProps$"+Qi,vn="__reactContainer$"+Qi,qf="__reactEvents$"+Qi,Ib="__reactListeners$"+Qi,Nb="__reactHandles$"+Qi;function dr(t){var e=t[Qt];if(e)return e;for(var n=t.parentNode;n;){if(e=n[vn]||n[Qt]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=Hg(t);t!==null;){if(n=t[Qt])return n;t=Hg(t)}return e}t=n,n=t.parentNode}return null}function Ro(t){return t=t[Qt]||t[vn],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ii(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(L(33))}function Oc(t){return t[so]||null}var Zf=[],si=-1;function tr(t){return{current:t}}function ue(t){0>si||(t.current=Zf[si],Zf[si]=null,si--)}function le(t,e){si++,Zf[si]=t.current,t.current=e}var Jn={},Ke=tr(Jn),st=tr(!1),Rr=Jn;function Pi(t,e){var n=t.type.contextTypes;if(!n)return Jn;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function ot(t){return t=t.childContextTypes,t!=null}function ol(){ue(st),ue(Ke)}function Wg(t,e,n){if(Ke.current!==Jn)throw Error(L(168));le(Ke,e),le(st,n)}function Rv(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(L(108,_S(t)||"Unknown",i));return me({},n,r)}function al(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Jn,Rr=Ke.current,le(Ke,t),le(st,st.current),!0}function $g(t,e,n){var r=t.stateNode;if(!r)throw Error(L(169));n?(t=Rv(t,e,Rr),r.__reactInternalMemoizedMergedChildContext=t,ue(st),ue(Ke),le(Ke,t)):ue(st),le(st,n)}var hn=null,Fc=!1,Cu=!1;function Cv(t){hn===null?hn=[t]:hn.push(t)}function kb(t){Fc=!0,Cv(t)}function nr(){if(!Cu&&hn!==null){Cu=!0;var t=0,e=re;try{var n=hn;for(re=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}hn=null,Fc=!1}catch(i){throw hn!==null&&(hn=hn.slice(t+1)),J0(xd,nr),i}finally{re=e,Cu=!1}}return null}var oi=[],ai=0,ll=null,cl=0,Tt=[],wt=0,Cr=null,pn=1,gn="";function lr(t,e){oi[ai++]=cl,oi[ai++]=ll,ll=t,cl=e}function xv(t,e,n){Tt[wt++]=pn,Tt[wt++]=gn,Tt[wt++]=Cr,Cr=t;var r=pn;t=gn;var i=32-Bt(r)-1;r&=~(1<<i),n+=1;var s=32-Bt(e)+i;if(30<s){var o=i-i%5;s=(r&(1<<o)-1).toString(32),r>>=o,i-=o,pn=1<<32-Bt(e)+i|n<<i|r,gn=s+t}else pn=1<<s|n<<i|r,gn=t}function Bd(t){t.return!==null&&(lr(t,1),xv(t,1,0))}function Ud(t){for(;t===ll;)ll=oi[--ai],oi[ai]=null,cl=oi[--ai],oi[ai]=null;for(;t===Cr;)Cr=Tt[--wt],Tt[wt]=null,gn=Tt[--wt],Tt[wt]=null,pn=Tt[--wt],Tt[wt]=null}var pt=null,ft=null,he=!1,Ot=null;function Pv(t,e){var n=Et(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Xg(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,pt=t,ft=$n(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,pt=t,ft=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Cr!==null?{id:pn,overflow:gn}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Et(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,pt=t,ft=null,!0):!1;default:return!1}}function Qf(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Jf(t){if(he){var e=ft;if(e){var n=e;if(!Xg(t,e)){if(Qf(t))throw Error(L(418));e=$n(n.nextSibling);var r=pt;e&&Xg(t,e)?Pv(r,n):(t.flags=t.flags&-4097|2,he=!1,pt=t)}}else{if(Qf(t))throw Error(L(418));t.flags=t.flags&-4097|2,he=!1,pt=t}}}function Yg(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;pt=t}function ia(t){if(t!==pt)return!1;if(!he)return Yg(t),he=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Yf(t.type,t.memoizedProps)),e&&(e=ft)){if(Qf(t))throw Mv(),Error(L(418));for(;e;)Pv(t,e),e=$n(e.nextSibling)}if(Yg(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(L(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ft=$n(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ft=null}}else ft=pt?$n(t.stateNode.nextSibling):null;return!0}function Mv(){for(var t=ft;t;)t=$n(t.nextSibling)}function Mi(){ft=pt=null,he=!1}function Ld(t){Ot===null?Ot=[t]:Ot.push(t)}var Ob=Sn.ReactCurrentBatchConfig;function fs(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(L(309));var r=n.stateNode}if(!r)throw Error(L(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(o){var a=i.refs;o===null?delete a[s]:a[s]=o},e._stringRef=s,e)}if(typeof t!="string")throw Error(L(284));if(!n._owner)throw Error(L(290,t))}return t}function sa(t,e){throw t=Object.prototype.toString.call(e),Error(L(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function Kg(t){var e=t._init;return e(t._payload)}function Iv(t){function e(g,p){if(t){var y=g.deletions;y===null?(g.deletions=[p],g.flags|=16):y.push(p)}}function n(g,p){if(!t)return null;for(;p!==null;)e(g,p),p=p.sibling;return null}function r(g,p){for(g=new Map;p!==null;)p.key!==null?g.set(p.key,p):g.set(p.index,p),p=p.sibling;return g}function i(g,p){return g=qn(g,p),g.index=0,g.sibling=null,g}function s(g,p,y){return g.index=y,t?(y=g.alternate,y!==null?(y=y.index,y<p?(g.flags|=2,p):y):(g.flags|=2,p)):(g.flags|=1048576,p)}function o(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,p,y,S){return p===null||p.tag!==6?(p=Ou(y,g.mode,S),p.return=g,p):(p=i(p,y),p.return=g,p)}function l(g,p,y,S){var R=y.type;return R===ei?u(g,p,y.props.children,S,y.key):p!==null&&(p.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===In&&Kg(R)===p.type)?(S=i(p,y.props),S.ref=fs(g,p,y),S.return=g,S):(S=$a(y.type,y.key,y.props,null,g.mode,S),S.ref=fs(g,p,y),S.return=g,S)}function c(g,p,y,S){return p===null||p.tag!==4||p.stateNode.containerInfo!==y.containerInfo||p.stateNode.implementation!==y.implementation?(p=Fu(y,g.mode,S),p.return=g,p):(p=i(p,y.children||[]),p.return=g,p)}function u(g,p,y,S,R){return p===null||p.tag!==7?(p=vr(y,g.mode,S,R),p.return=g,p):(p=i(p,y),p.return=g,p)}function f(g,p,y){if(typeof p=="string"&&p!==""||typeof p=="number")return p=Ou(""+p,g.mode,y),p.return=g,p;if(typeof p=="object"&&p!==null){switch(p.$$typeof){case Ko:return y=$a(p.type,p.key,p.props,null,g.mode,y),y.ref=fs(g,null,p),y.return=g,y;case Gr:return p=Fu(p,g.mode,y),p.return=g,p;case In:var S=p._init;return f(g,S(p._payload),y)}if(Ts(p)||os(p))return p=vr(p,g.mode,y,null),p.return=g,p;sa(g,p)}return null}function h(g,p,y,S){var R=p!==null?p.key:null;if(typeof y=="string"&&y!==""||typeof y=="number")return R!==null?null:a(g,p,""+y,S);if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Ko:return y.key===R?l(g,p,y,S):null;case Gr:return y.key===R?c(g,p,y,S):null;case In:return R=y._init,h(g,p,R(y._payload),S)}if(Ts(y)||os(y))return R!==null?null:u(g,p,y,S,null);sa(g,y)}return null}function _(g,p,y,S,R){if(typeof S=="string"&&S!==""||typeof S=="number")return g=g.get(y)||null,a(p,g,""+S,R);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case Ko:return g=g.get(S.key===null?y:S.key)||null,l(p,g,S,R);case Gr:return g=g.get(S.key===null?y:S.key)||null,c(p,g,S,R);case In:var P=S._init;return _(g,p,y,P(S._payload),R)}if(Ts(S)||os(S))return g=g.get(y)||null,u(p,g,S,R,null);sa(p,S)}return null}function v(g,p,y,S){for(var R=null,P=null,O=p,M=p=0,k=null;O!==null&&M<y.length;M++){O.index>M?(k=O,O=null):k=O.sibling;var D=h(g,O,y[M],S);if(D===null){O===null&&(O=k);break}t&&O&&D.alternate===null&&e(g,O),p=s(D,p,M),P===null?R=D:P.sibling=D,P=D,O=k}if(M===y.length)return n(g,O),he&&lr(g,M),R;if(O===null){for(;M<y.length;M++)O=f(g,y[M],S),O!==null&&(p=s(O,p,M),P===null?R=O:P.sibling=O,P=O);return he&&lr(g,M),R}for(O=r(g,O);M<y.length;M++)k=_(O,g,M,y[M],S),k!==null&&(t&&k.alternate!==null&&O.delete(k.key===null?M:k.key),p=s(k,p,M),P===null?R=k:P.sibling=k,P=k);return t&&O.forEach(function(F){return e(g,F)}),he&&lr(g,M),R}function E(g,p,y,S){var R=os(y);if(typeof R!="function")throw Error(L(150));if(y=R.call(y),y==null)throw Error(L(151));for(var P=R=null,O=p,M=p=0,k=null,D=y.next();O!==null&&!D.done;M++,D=y.next()){O.index>M?(k=O,O=null):k=O.sibling;var F=h(g,O,D.value,S);if(F===null){O===null&&(O=k);break}t&&O&&F.alternate===null&&e(g,O),p=s(F,p,M),P===null?R=F:P.sibling=F,P=F,O=k}if(D.done)return n(g,O),he&&lr(g,M),R;if(O===null){for(;!D.done;M++,D=y.next())D=f(g,D.value,S),D!==null&&(p=s(D,p,M),P===null?R=D:P.sibling=D,P=D);return he&&lr(g,M),R}for(O=r(g,O);!D.done;M++,D=y.next())D=_(O,g,M,D.value,S),D!==null&&(t&&D.alternate!==null&&O.delete(D.key===null?M:D.key),p=s(D,p,M),P===null?R=D:P.sibling=D,P=D);return t&&O.forEach(function(B){return e(g,B)}),he&&lr(g,M),R}function b(g,p,y,S){if(typeof y=="object"&&y!==null&&y.type===ei&&y.key===null&&(y=y.props.children),typeof y=="object"&&y!==null){switch(y.$$typeof){case Ko:e:{for(var R=y.key,P=p;P!==null;){if(P.key===R){if(R=y.type,R===ei){if(P.tag===7){n(g,P.sibling),p=i(P,y.props.children),p.return=g,g=p;break e}}else if(P.elementType===R||typeof R=="object"&&R!==null&&R.$$typeof===In&&Kg(R)===P.type){n(g,P.sibling),p=i(P,y.props),p.ref=fs(g,P,y),p.return=g,g=p;break e}n(g,P);break}else e(g,P);P=P.sibling}y.type===ei?(p=vr(y.props.children,g.mode,S,y.key),p.return=g,g=p):(S=$a(y.type,y.key,y.props,null,g.mode,S),S.ref=fs(g,p,y),S.return=g,g=S)}return o(g);case Gr:e:{for(P=y.key;p!==null;){if(p.key===P)if(p.tag===4&&p.stateNode.containerInfo===y.containerInfo&&p.stateNode.implementation===y.implementation){n(g,p.sibling),p=i(p,y.children||[]),p.return=g,g=p;break e}else{n(g,p);break}else e(g,p);p=p.sibling}p=Fu(y,g.mode,S),p.return=g,g=p}return o(g);case In:return P=y._init,b(g,p,P(y._payload),S)}if(Ts(y))return v(g,p,y,S);if(os(y))return E(g,p,y,S);sa(g,y)}return typeof y=="string"&&y!==""||typeof y=="number"?(y=""+y,p!==null&&p.tag===6?(n(g,p.sibling),p=i(p,y),p.return=g,g=p):(n(g,p),p=Ou(y,g.mode,S),p.return=g,g=p),o(g)):n(g,p)}return b}var Ii=Iv(!0),Nv=Iv(!1),ul=tr(null),fl=null,li=null,zd=null;function Vd(){zd=li=fl=null}function jd(t){var e=ul.current;ue(ul),t._currentValue=e}function Gf(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function wi(t,e){fl=t,zd=li=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(rt=!0),t.firstContext=null)}function At(t){var e=t._currentValue;if(zd!==t)if(t={context:t,memoizedValue:e,next:null},li===null){if(fl===null)throw Error(L(308));li=t,fl.dependencies={lanes:0,firstContext:t}}else li=li.next=t;return e}var pr=null;function Hd(t){pr===null?pr=[t]:pr.push(t)}function kv(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,Hd(e)):(n.next=i.next,i.next=n),e.interleaved=n,Tn(t,r)}function Tn(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Nn=!1;function Wd(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ov(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function mn(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Xn(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,ee&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Tn(t,n)}return i=r.interleaved,i===null?(e.next=e,Hd(r)):(e.next=i.next,i.next=e),r.interleaved=e,Tn(t,n)}function La(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Pd(t,n)}}function qg(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=o:s=s.next=o,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function hl(t,e,n,r){var i=t.updateQueue;Nn=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(a!==null){i.shared.pending=null;var l=a,c=l.next;l.next=null,o===null?s=c:o.next=c,o=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==o&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(s!==null){var f=i.baseState;o=0,u=c=l=null,a=s;do{var h=a.lane,_=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:_,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var v=t,E=a;switch(h=e,_=n,E.tag){case 1:if(v=E.payload,typeof v=="function"){f=v.call(_,f,h);break e}f=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=E.payload,h=typeof v=="function"?v.call(_,f,h):v,h==null)break e;f=me({},f,h);break e;case 2:Nn=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=i.effects,h===null?i.effects=[a]:h.push(a))}else _={eventTime:_,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=_,l=f):u=u.next=_,o|=h;if(a=a.next,a===null){if(a=i.shared.pending,a===null)break;h=a,a=h.next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}while(1);if(u===null&&(l=f),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);Pr|=o,t.lanes=o,t.memoizedState=f}}function Zg(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(L(191,i));i.call(r)}}}var Co={},nn=tr(Co),oo=tr(Co),ao=tr(Co);function gr(t){if(t===Co)throw Error(L(174));return t}function $d(t,e){switch(le(ao,e),le(oo,t),le(nn,Co),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:kf(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=kf(e,t)}ue(nn),le(nn,e)}function Ni(){ue(nn),ue(oo),ue(ao)}function Fv(t){gr(ao.current);var e=gr(nn.current),n=kf(e,t.type);e!==n&&(le(oo,t),le(nn,n))}function Xd(t){oo.current===t&&(ue(nn),ue(oo))}var pe=tr(0);function dl(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xu=[];function Yd(){for(var t=0;t<xu.length;t++)xu[t]._workInProgressVersionPrimary=null;xu.length=0}var za=Sn.ReactCurrentDispatcher,Pu=Sn.ReactCurrentBatchConfig,xr=0,_e=null,xe=null,Ne=null,pl=!1,Os=!1,lo=0,Fb=0;function Ve(){throw Error(L(321))}function Kd(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Lt(t[n],e[n]))return!1;return!0}function qd(t,e,n,r,i,s){if(xr=s,_e=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,za.current=t===null||t.memoizedState===null?Lb:zb,t=n(r,i),Os){s=0;do{if(Os=!1,lo=0,25<=s)throw Error(L(301));s+=1,Ne=xe=null,e.updateQueue=null,za.current=Vb,t=n(r,i)}while(Os)}if(za.current=gl,e=xe!==null&&xe.next!==null,xr=0,Ne=xe=_e=null,pl=!1,e)throw Error(L(300));return t}function Zd(){var t=lo!==0;return lo=0,t}function Zt(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ne===null?_e.memoizedState=Ne=t:Ne=Ne.next=t,Ne}function Rt(){if(xe===null){var t=_e.alternate;t=t!==null?t.memoizedState:null}else t=xe.next;var e=Ne===null?_e.memoizedState:Ne.next;if(e!==null)Ne=e,xe=t;else{if(t===null)throw Error(L(310));xe=t,t={memoizedState:xe.memoizedState,baseState:xe.baseState,baseQueue:xe.baseQueue,queue:xe.queue,next:null},Ne===null?_e.memoizedState=Ne=t:Ne=Ne.next=t}return Ne}function co(t,e){return typeof e=="function"?e(t):e}function Mu(t){var e=Rt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var r=xe,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var o=i.next;i.next=s.next,s.next=o}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var a=o=null,l=null,c=s;do{var u=c.lane;if((xr&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),r=c.hasEagerState?c.eagerState:t(r,c.action);else{var f={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=f,o=r):l=l.next=f,_e.lanes|=u,Pr|=u}c=c.next}while(c!==null&&c!==s);l===null?o=r:l.next=a,Lt(r,e.memoizedState)||(rt=!0),e.memoizedState=r,e.baseState=o,e.baseQueue=l,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,_e.lanes|=s,Pr|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Iu(t){var e=Rt(),n=e.queue;if(n===null)throw Error(L(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var o=i=i.next;do s=t(s,o.action),o=o.next;while(o!==i);Lt(s,e.memoizedState)||(rt=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function Dv(){}function Bv(t,e){var n=_e,r=Rt(),i=e(),s=!Lt(r.memoizedState,i);if(s&&(r.memoizedState=i,rt=!0),r=r.queue,Qd(zv.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ne!==null&&Ne.memoizedState.tag&1){if(n.flags|=2048,uo(9,Lv.bind(null,n,r,i,e),void 0,null),ke===null)throw Error(L(349));xr&30||Uv(n,e,i)}return i}function Uv(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function Lv(t,e,n,r){e.value=n,e.getSnapshot=r,Vv(e)&&jv(t)}function zv(t,e,n){return n(function(){Vv(e)&&jv(t)})}function Vv(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Lt(t,n)}catch{return!0}}function jv(t){var e=Tn(t,1);e!==null&&Ut(e,t,1,-1)}function Qg(t){var e=Zt();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:co,lastRenderedState:t},e.queue=t,t=t.dispatch=Ub.bind(null,_e,t),[e.memoizedState,t]}function uo(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=_e.updateQueue,e===null?(e={lastEffect:null,stores:null},_e.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function Hv(){return Rt().memoizedState}function Va(t,e,n,r){var i=Zt();_e.flags|=t,i.memoizedState=uo(1|e,n,void 0,r===void 0?null:r)}function Dc(t,e,n,r){var i=Rt();r=r===void 0?null:r;var s=void 0;if(xe!==null){var o=xe.memoizedState;if(s=o.destroy,r!==null&&Kd(r,o.deps)){i.memoizedState=uo(e,n,s,r);return}}_e.flags|=t,i.memoizedState=uo(1|e,n,s,r)}function Jg(t,e){return Va(8390656,8,t,e)}function Qd(t,e){return Dc(2048,8,t,e)}function Wv(t,e){return Dc(4,2,t,e)}function $v(t,e){return Dc(4,4,t,e)}function Xv(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Yv(t,e,n){return n=n!=null?n.concat([t]):null,Dc(4,4,Xv.bind(null,e,t),n)}function Jd(){}function Kv(t,e){var n=Rt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Kd(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function qv(t,e){var n=Rt();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Kd(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function Zv(t,e,n){return xr&21?(Lt(n,e)||(n=tv(),_e.lanes|=n,Pr|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,rt=!0),t.memoizedState=n)}function Db(t,e){var n=re;re=n!==0&&4>n?n:4,t(!0);var r=Pu.transition;Pu.transition={};try{t(!1),e()}finally{re=n,Pu.transition=r}}function Qv(){return Rt().memoizedState}function Bb(t,e,n){var r=Kn(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},Jv(t))Gv(e,n);else if(n=kv(t,e,n,r),n!==null){var i=Je();Ut(n,t,r,i),eT(n,e,r)}}function Ub(t,e,n){var r=Kn(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(Jv(t))Gv(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var o=e.lastRenderedState,a=s(o,n);if(i.hasEagerState=!0,i.eagerState=a,Lt(a,o)){var l=e.interleaved;l===null?(i.next=i,Hd(e)):(i.next=l.next,l.next=i),e.interleaved=i;return}}catch{}finally{}n=kv(t,e,i,r),n!==null&&(i=Je(),Ut(n,t,r,i),eT(n,e,r))}}function Jv(t){var e=t.alternate;return t===_e||e!==null&&e===_e}function Gv(t,e){Os=pl=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function eT(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Pd(t,n)}}var gl={readContext:At,useCallback:Ve,useContext:Ve,useEffect:Ve,useImperativeHandle:Ve,useInsertionEffect:Ve,useLayoutEffect:Ve,useMemo:Ve,useReducer:Ve,useRef:Ve,useState:Ve,useDebugValue:Ve,useDeferredValue:Ve,useTransition:Ve,useMutableSource:Ve,useSyncExternalStore:Ve,useId:Ve,unstable_isNewReconciler:!1},Lb={readContext:At,useCallback:function(t,e){return Zt().memoizedState=[t,e===void 0?null:e],t},useContext:At,useEffect:Jg,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Va(4194308,4,Xv.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Va(4194308,4,t,e)},useInsertionEffect:function(t,e){return Va(4,2,t,e)},useMemo:function(t,e){var n=Zt();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Zt();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=Bb.bind(null,_e,t),[r.memoizedState,t]},useRef:function(t){var e=Zt();return t={current:t},e.memoizedState=t},useState:Qg,useDebugValue:Jd,useDeferredValue:function(t){return Zt().memoizedState=t},useTransition:function(){var t=Qg(!1),e=t[0];return t=Db.bind(null,t[1]),Zt().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=_e,i=Zt();if(he){if(n===void 0)throw Error(L(407));n=n()}else{if(n=e(),ke===null)throw Error(L(349));xr&30||Uv(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Jg(zv.bind(null,r,s,t),[t]),r.flags|=2048,uo(9,Lv.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Zt(),e=ke.identifierPrefix;if(he){var n=gn,r=pn;n=(r&~(1<<32-Bt(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=lo++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=Fb++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},zb={readContext:At,useCallback:Kv,useContext:At,useEffect:Qd,useImperativeHandle:Yv,useInsertionEffect:Wv,useLayoutEffect:$v,useMemo:qv,useReducer:Mu,useRef:Hv,useState:function(){return Mu(co)},useDebugValue:Jd,useDeferredValue:function(t){var e=Rt();return Zv(e,xe.memoizedState,t)},useTransition:function(){var t=Mu(co)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:Dv,useSyncExternalStore:Bv,useId:Qv,unstable_isNewReconciler:!1},Vb={readContext:At,useCallback:Kv,useContext:At,useEffect:Qd,useImperativeHandle:Yv,useInsertionEffect:Wv,useLayoutEffect:$v,useMemo:qv,useReducer:Iu,useRef:Hv,useState:function(){return Iu(co)},useDebugValue:Jd,useDeferredValue:function(t){var e=Rt();return xe===null?e.memoizedState=t:Zv(e,xe.memoizedState,t)},useTransition:function(){var t=Iu(co)[0],e=Rt().memoizedState;return[t,e]},useMutableSource:Dv,useSyncExternalStore:Bv,useId:Qv,unstable_isNewReconciler:!1};function Nt(t,e){if(t&&t.defaultProps){e=me({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function eh(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:me({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Bc={isMounted:function(t){return(t=t._reactInternals)?kr(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=Je(),i=Kn(t),s=mn(r,i);s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,i),e!==null&&(Ut(e,t,i,r),La(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=Je(),i=Kn(t),s=mn(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=Xn(t,s,i),e!==null&&(Ut(e,t,i,r),La(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=Je(),r=Kn(t),i=mn(n,r);i.tag=2,e!=null&&(i.callback=e),e=Xn(t,i,r),e!==null&&(Ut(e,t,r,n),La(e,t,r))}};function Gg(t,e,n,r,i,s,o){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,o):e.prototype&&e.prototype.isPureReactComponent?!no(n,r)||!no(i,s):!0}function tT(t,e,n){var r=!1,i=Jn,s=e.contextType;return typeof s=="object"&&s!==null?s=At(s):(i=ot(e)?Rr:Ke.current,r=e.contextTypes,s=(r=r!=null)?Pi(t,i):Jn),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Bc,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function e_(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Bc.enqueueReplaceState(e,e.state,null)}function th(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Wd(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=At(s):(s=ot(e)?Rr:Ke.current,i.context=Pi(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(eh(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Bc.enqueueReplaceState(i,i.state,null),hl(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function ki(t,e){try{var n="",r=e;do n+=gS(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Nu(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function nh(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var jb=typeof WeakMap=="function"?WeakMap:Map;function nT(t,e,n){n=mn(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){ml||(ml=!0,hh=r),nh(t,e)},n}function rT(t,e,n){n=mn(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){nh(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){nh(t,e),typeof r!="function"&&(Yn===null?Yn=new Set([this]):Yn.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),n}function t_(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new jb;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=nA.bind(null,t,e,n),e.then(t,t))}function n_(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function r_(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=mn(-1,1),e.tag=2,Xn(n,e,1))),n.lanes|=1),t)}var Hb=Sn.ReactCurrentOwner,rt=!1;function Ze(t,e,n,r){e.child=t===null?Nv(e,null,n,r):Ii(e,t.child,n,r)}function i_(t,e,n,r,i){n=n.render;var s=e.ref;return wi(e,i),r=qd(t,e,n,r,s,i),n=Zd(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,wn(t,e,i)):(he&&n&&Bd(e),e.flags|=1,Ze(t,e,r,i),e.child)}function s_(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!op(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,iT(t,e,s,r,i)):(t=$a(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var o=s.memoizedProps;if(n=n.compare,n=n!==null?n:no,n(o,r)&&t.ref===e.ref)return wn(t,e,i)}return e.flags|=1,t=qn(s,r),t.ref=e.ref,t.return=e,e.child=t}function iT(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(no(s,r)&&t.ref===e.ref)if(rt=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(rt=!0);else return e.lanes=t.lanes,wn(t,e,i)}return rh(t,e,n,r,i)}function sT(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},le(ui,ct),ct|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,le(ui,ct),ct|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,le(ui,ct),ct|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,le(ui,ct),ct|=r;return Ze(t,e,i,n),e.child}function oT(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function rh(t,e,n,r,i){var s=ot(n)?Rr:Ke.current;return s=Pi(e,s),wi(e,i),n=qd(t,e,n,r,s,i),r=Zd(),t!==null&&!rt?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,wn(t,e,i)):(he&&r&&Bd(e),e.flags|=1,Ze(t,e,n,i),e.child)}function o_(t,e,n,r,i){if(ot(n)){var s=!0;al(e)}else s=!1;if(wi(e,i),e.stateNode===null)ja(t,e),tT(e,n,r),th(e,n,r,i),r=!0;else if(t===null){var o=e.stateNode,a=e.memoizedProps;o.props=a;var l=o.context,c=n.contextType;typeof c=="object"&&c!==null?c=At(c):(c=ot(n)?Rr:Ke.current,c=Pi(e,c));var u=n.getDerivedStateFromProps,f=typeof u=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==r||l!==c)&&e_(e,o,r,c),Nn=!1;var h=e.memoizedState;o.state=h,hl(e,r,o,i),l=e.memoizedState,a!==r||h!==l||st.current||Nn?(typeof u=="function"&&(eh(e,n,u,r),l=e.memoizedState),(a=Nn||Gg(e,n,a,r,h,l,c))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=l),o.props=r,o.state=l,o.context=c,r=a):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{o=e.stateNode,Ov(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Nt(e.type,a),o.props=c,f=e.pendingProps,h=o.context,l=n.contextType,typeof l=="object"&&l!==null?l=At(l):(l=ot(n)?Rr:Ke.current,l=Pi(e,l));var _=n.getDerivedStateFromProps;(u=typeof _=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(a!==f||h!==l)&&e_(e,o,r,l),Nn=!1,h=e.memoizedState,o.state=h,hl(e,r,o,i);var v=e.memoizedState;a!==f||h!==v||st.current||Nn?(typeof _=="function"&&(eh(e,n,_,r),v=e.memoizedState),(c=Nn||Gg(e,n,c,r,h,v,l)||!1)?(u||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(r,v,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(r,v,l)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=v),o.props=r,o.state=v,o.context=l,r=c):(typeof o.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return ih(t,e,n,r,s,i)}function ih(t,e,n,r,i,s){oT(t,e);var o=(e.flags&128)!==0;if(!r&&!o)return i&&$g(e,n,!1),wn(t,e,s);r=e.stateNode,Hb.current=e;var a=o&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&o?(e.child=Ii(e,t.child,null,s),e.child=Ii(e,null,a,s)):Ze(t,e,a,s),e.memoizedState=r.state,i&&$g(e,n,!0),e.child}function aT(t){var e=t.stateNode;e.pendingContext?Wg(t,e.pendingContext,e.pendingContext!==e.context):e.context&&Wg(t,e.context,!1),$d(t,e.containerInfo)}function a_(t,e,n,r,i){return Mi(),Ld(i),e.flags|=256,Ze(t,e,n,r),e.child}var sh={dehydrated:null,treeContext:null,retryLane:0};function oh(t){return{baseLanes:t,cachePool:null,transitions:null}}function lT(t,e,n){var r=e.pendingProps,i=pe.current,s=!1,o=(e.flags&128)!==0,a;if((a=o)||(a=t!==null&&t.memoizedState===null?!1:(i&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),le(pe,i&1),t===null)return Jf(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=r.children,t=r.fallback,s?(r=e.mode,s=e.child,o={mode:"hidden",children:o},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=o):s=zc(o,r,0,null),t=vr(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=oh(n),e.memoizedState=sh,t):Gd(e,o));if(i=t.memoizedState,i!==null&&(a=i.dehydrated,a!==null))return Wb(t,e,o,r,a,i,n);if(s){s=r.fallback,o=e.mode,i=t.child,a=i.sibling;var l={mode:"hidden",children:r.children};return!(o&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=l,e.deletions=null):(r=qn(i,l),r.subtreeFlags=i.subtreeFlags&14680064),a!==null?s=qn(a,s):(s=vr(s,o,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,o=t.child.memoizedState,o=o===null?oh(n):{baseLanes:o.baseLanes|n,cachePool:null,transitions:o.transitions},s.memoizedState=o,s.childLanes=t.childLanes&~n,e.memoizedState=sh,r}return s=t.child,t=s.sibling,r=qn(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Gd(t,e){return e=zc({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function oa(t,e,n,r){return r!==null&&Ld(r),Ii(e,t.child,null,n),t=Gd(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function Wb(t,e,n,r,i,s,o){if(n)return e.flags&256?(e.flags&=-257,r=Nu(Error(L(422))),oa(t,e,o,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=zc({mode:"visible",children:r.children},i,0,null),s=vr(s,i,o,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Ii(e,t.child,null,o),e.child.memoizedState=oh(o),e.memoizedState=sh,s);if(!(e.mode&1))return oa(t,e,o,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var a=r.dgst;return r=a,s=Error(L(419)),r=Nu(s,r,void 0),oa(t,e,o,r)}if(a=(o&t.childLanes)!==0,rt||a){if(r=ke,r!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|o)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,Tn(t,i),Ut(r,t,i,-1))}return sp(),r=Nu(Error(L(421))),oa(t,e,o,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=rA.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,ft=$n(i.nextSibling),pt=e,he=!0,Ot=null,t!==null&&(Tt[wt++]=pn,Tt[wt++]=gn,Tt[wt++]=Cr,pn=t.id,gn=t.overflow,Cr=e),e=Gd(e,r.children),e.flags|=4096,e)}function l_(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Gf(t.return,e,n)}function ku(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function cT(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(Ze(t,e,r.children,n),r=pe.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&l_(t,n,e);else if(t.tag===19)l_(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(le(pe,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&dl(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),ku(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&dl(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}ku(e,!0,n,null,s);break;case"together":ku(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function ja(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function wn(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Pr|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(L(153));if(e.child!==null){for(t=e.child,n=qn(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=qn(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $b(t,e,n){switch(e.tag){case 3:aT(e),Mi();break;case 5:Fv(e);break;case 1:ot(e.type)&&al(e);break;case 4:$d(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;le(ul,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(le(pe,pe.current&1),e.flags|=128,null):n&e.child.childLanes?lT(t,e,n):(le(pe,pe.current&1),t=wn(t,e,n),t!==null?t.sibling:null);le(pe,pe.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return cT(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),le(pe,pe.current),r)break;return null;case 22:case 23:return e.lanes=0,sT(t,e,n)}return wn(t,e,n)}var uT,ah,fT,hT;uT=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};ah=function(){};fT=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,gr(nn.current);var s=null;switch(n){case"input":i=Pf(t,i),r=Pf(t,r),s=[];break;case"select":i=me({},i,{value:void 0}),r=me({},r,{value:void 0}),s=[];break;case"textarea":i=Nf(t,i),r=Nf(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=sl)}Of(n,r);var o;n=null;for(c in i)if(!r.hasOwnProperty(c)&&i.hasOwnProperty(c)&&i[c]!=null)if(c==="style"){var a=i[c];for(o in a)a.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(qs.hasOwnProperty(c)?s||(s=[]):(s=s||[]).push(c,null));for(c in r){var l=r[c];if(a=i!=null?i[c]:void 0,r.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(o in a)!a.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in l)l.hasOwnProperty(o)&&a[o]!==l[o]&&(n||(n={}),n[o]=l[o])}else n||(s||(s=[]),s.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&(qs.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ce("scroll",t),s||a===l||(s=[])):(s=s||[]).push(c,l))}n&&(s=s||[]).push("style",n);var c=s;(e.updateQueue=c)&&(e.flags|=4)}};hT=function(t,e,n,r){n!==r&&(e.flags|=4)};function hs(t,e){if(!he)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function je(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function Xb(t,e,n){var r=e.pendingProps;switch(Ud(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return je(e),null;case 1:return ot(e.type)&&ol(),je(e),null;case 3:return r=e.stateNode,Ni(),ue(st),ue(Ke),Yd(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ia(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ot!==null&&(gh(Ot),Ot=null))),ah(t,e),je(e),null;case 5:Xd(e);var i=gr(ao.current);if(n=e.type,t!==null&&e.stateNode!=null)fT(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(L(166));return je(e),null}if(t=gr(nn.current),ia(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[Qt]=e,r[so]=s,t=(e.mode&1)!==0,n){case"dialog":ce("cancel",r),ce("close",r);break;case"iframe":case"object":case"embed":ce("load",r);break;case"video":case"audio":for(i=0;i<Es.length;i++)ce(Es[i],r);break;case"source":ce("error",r);break;case"img":case"image":case"link":ce("error",r),ce("load",r);break;case"details":ce("toggle",r);break;case"input":mg(r,s),ce("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},ce("invalid",r);break;case"textarea":vg(r,s),ce("invalid",r)}Of(n,s),i=null;for(var o in s)if(s.hasOwnProperty(o)){var a=s[o];o==="children"?typeof a=="string"?r.textContent!==a&&(s.suppressHydrationWarning!==!0&&ra(r.textContent,a,t),i=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&ra(r.textContent,a,t),i=["children",""+a]):qs.hasOwnProperty(o)&&a!=null&&o==="onScroll"&&ce("scroll",r)}switch(n){case"input":qo(r),yg(r,s,!0);break;case"textarea":qo(r),Tg(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=sl)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=z0(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=o.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=o.createElement(n,{is:r.is}):(t=o.createElement(n),n==="select"&&(o=t,r.multiple?o.multiple=!0:r.size&&(o.size=r.size))):t=o.createElementNS(t,n),t[Qt]=e,t[so]=r,uT(t,e,!1,!1),e.stateNode=t;e:{switch(o=Ff(n,r),n){case"dialog":ce("cancel",t),ce("close",t),i=r;break;case"iframe":case"object":case"embed":ce("load",t),i=r;break;case"video":case"audio":for(i=0;i<Es.length;i++)ce(Es[i],t);i=r;break;case"source":ce("error",t),i=r;break;case"img":case"image":case"link":ce("error",t),ce("load",t),i=r;break;case"details":ce("toggle",t),i=r;break;case"input":mg(t,r),i=Pf(t,r),ce("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=me({},r,{value:void 0}),ce("invalid",t);break;case"textarea":vg(t,r),i=Nf(t,r),ce("invalid",t);break;default:i=r}Of(n,i),a=i;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?H0(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&V0(t,l)):s==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Zs(t,l):typeof l=="number"&&Zs(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(qs.hasOwnProperty(s)?l!=null&&s==="onScroll"&&ce("scroll",t):l!=null&&Sd(t,s,l,o))}switch(n){case"input":qo(t),yg(t,r,!1);break;case"textarea":qo(t),Tg(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Qn(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?mi(t,!!r.multiple,s,!1):r.defaultValue!=null&&mi(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=sl)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return je(e),null;case 6:if(t&&e.stateNode!=null)hT(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(L(166));if(n=gr(ao.current),gr(nn.current),ia(e)){if(r=e.stateNode,n=e.memoizedProps,r[Qt]=e,(s=r.nodeValue!==n)&&(t=pt,t!==null))switch(t.tag){case 3:ra(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&ra(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[Qt]=e,e.stateNode=r}return je(e),null;case 13:if(ue(pe),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(he&&ft!==null&&e.mode&1&&!(e.flags&128))Mv(),Mi(),e.flags|=98560,s=!1;else if(s=ia(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(L(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(L(317));s[Qt]=e}else Mi(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;je(e),s=!1}else Ot!==null&&(gh(Ot),Ot=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||pe.current&1?Pe===0&&(Pe=3):sp())),e.updateQueue!==null&&(e.flags|=4),je(e),null);case 4:return Ni(),ah(t,e),t===null&&ro(e.stateNode.containerInfo),je(e),null;case 10:return jd(e.type._context),je(e),null;case 17:return ot(e.type)&&ol(),je(e),null;case 19:if(ue(pe),s=e.memoizedState,s===null)return je(e),null;if(r=(e.flags&128)!==0,o=s.rendering,o===null)if(r)hs(s,!1);else{if(Pe!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(o=dl(t),o!==null){for(e.flags|=128,hs(s,!1),r=o.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,o=s.alternate,o===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,t=o.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return le(pe,pe.current&1|2),e.child}t=t.sibling}s.tail!==null&&Ee()>Oi&&(e.flags|=128,r=!0,hs(s,!1),e.lanes=4194304)}else{if(!r)if(t=dl(o),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),hs(s,!0),s.tail===null&&s.tailMode==="hidden"&&!o.alternate&&!he)return je(e),null}else 2*Ee()-s.renderingStartTime>Oi&&n!==1073741824&&(e.flags|=128,r=!0,hs(s,!1),e.lanes=4194304);s.isBackwards?(o.sibling=e.child,e.child=o):(n=s.last,n!==null?n.sibling=o:e.child=o,s.last=o)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Ee(),e.sibling=null,n=pe.current,le(pe,r?n&1|2:n&1),e):(je(e),null);case 22:case 23:return ip(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ct&1073741824&&(je(e),e.subtreeFlags&6&&(e.flags|=8192)):je(e),null;case 24:return null;case 25:return null}throw Error(L(156,e.tag))}function Yb(t,e){switch(Ud(e),e.tag){case 1:return ot(e.type)&&ol(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ni(),ue(st),ue(Ke),Yd(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return Xd(e),null;case 13:if(ue(pe),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(L(340));Mi()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ue(pe),null;case 4:return Ni(),null;case 10:return jd(e.type._context),null;case 22:case 23:return ip(),null;case 24:return null;default:return null}}var aa=!1,Xe=!1,Kb=typeof WeakSet=="function"?WeakSet:Set,X=null;function ci(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){Te(t,e,r)}else n.current=null}function lh(t,e,n){try{n()}catch(r){Te(t,e,r)}}var c_=!1;function qb(t,e){if($f=nl,t=mv(),Dd(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var o=0,a=-1,l=-1,c=0,u=0,f=t,h=null;t:for(;;){for(var _;f!==n||i!==0&&f.nodeType!==3||(a=o+i),f!==s||r!==0&&f.nodeType!==3||(l=o+r),f.nodeType===3&&(o+=f.nodeValue.length),(_=f.firstChild)!==null;)h=f,f=_;for(;;){if(f===t)break t;if(h===n&&++c===i&&(a=o),h===s&&++u===r&&(l=o),(_=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=_}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(Xf={focusedElem:t,selectionRange:n},nl=!1,X=e;X!==null;)if(e=X,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,X=t;else for(;X!==null;){e=X;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var E=v.memoizedProps,b=v.memoizedState,g=e.stateNode,p=g.getSnapshotBeforeUpdate(e.elementType===e.type?E:Nt(e.type,E),b);g.__reactInternalSnapshotBeforeUpdate=p}break;case 3:var y=e.stateNode.containerInfo;y.nodeType===1?y.textContent="":y.nodeType===9&&y.documentElement&&y.removeChild(y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(L(163))}}catch(S){Te(e,e.return,S)}if(t=e.sibling,t!==null){t.return=e.return,X=t;break}X=e.return}return v=c_,c_=!1,v}function Fs(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&lh(e,n,s)}i=i.next}while(i!==r)}}function Uc(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function ch(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function dT(t){var e=t.alternate;e!==null&&(t.alternate=null,dT(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[Qt],delete e[so],delete e[qf],delete e[Ib],delete e[Nb])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function pT(t){return t.tag===5||t.tag===3||t.tag===4}function u_(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||pT(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function uh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=sl));else if(r!==4&&(t=t.child,t!==null))for(uh(t,e,n),t=t.sibling;t!==null;)uh(t,e,n),t=t.sibling}function fh(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(fh(t,e,n),t=t.sibling;t!==null;)fh(t,e,n),t=t.sibling}var Be=null,kt=!1;function Rn(t,e,n){for(n=n.child;n!==null;)gT(t,e,n),n=n.sibling}function gT(t,e,n){if(tn&&typeof tn.onCommitFiberUnmount=="function")try{tn.onCommitFiberUnmount(Mc,n)}catch{}switch(n.tag){case 5:Xe||ci(n,e);case 6:var r=Be,i=kt;Be=null,Rn(t,e,n),Be=r,kt=i,Be!==null&&(kt?(t=Be,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Be.removeChild(n.stateNode));break;case 18:Be!==null&&(kt?(t=Be,n=n.stateNode,t.nodeType===8?Ru(t.parentNode,n):t.nodeType===1&&Ru(t,n),eo(t)):Ru(Be,n.stateNode));break;case 4:r=Be,i=kt,Be=n.stateNode.containerInfo,kt=!0,Rn(t,e,n),Be=r,kt=i;break;case 0:case 11:case 14:case 15:if(!Xe&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,o=s.destroy;s=s.tag,o!==void 0&&(s&2||s&4)&&lh(n,e,o),i=i.next}while(i!==r)}Rn(t,e,n);break;case 1:if(!Xe&&(ci(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){Te(n,e,a)}Rn(t,e,n);break;case 21:Rn(t,e,n);break;case 22:n.mode&1?(Xe=(r=Xe)||n.memoizedState!==null,Rn(t,e,n),Xe=r):Rn(t,e,n);break;default:Rn(t,e,n)}}function f_(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new Kb),e.forEach(function(r){var i=iA.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function Pt(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,o=e,a=o;e:for(;a!==null;){switch(a.tag){case 5:Be=a.stateNode,kt=!1;break e;case 3:Be=a.stateNode.containerInfo,kt=!0;break e;case 4:Be=a.stateNode.containerInfo,kt=!0;break e}a=a.return}if(Be===null)throw Error(L(160));gT(s,o,i),Be=null,kt=!1;var l=i.alternate;l!==null&&(l.return=null),i.return=null}catch(c){Te(i,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)_T(e,t),e=e.sibling}function _T(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Pt(e,t),Wt(t),r&4){try{Fs(3,t,t.return),Uc(3,t)}catch(E){Te(t,t.return,E)}try{Fs(5,t,t.return)}catch(E){Te(t,t.return,E)}}break;case 1:Pt(e,t),Wt(t),r&512&&n!==null&&ci(n,n.return);break;case 5:if(Pt(e,t),Wt(t),r&512&&n!==null&&ci(n,n.return),t.flags&32){var i=t.stateNode;try{Zs(i,"")}catch(E){Te(t,t.return,E)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,o=n!==null?n.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&U0(i,s),Ff(a,o);var c=Ff(a,s);for(o=0;o<l.length;o+=2){var u=l[o],f=l[o+1];u==="style"?H0(i,f):u==="dangerouslySetInnerHTML"?V0(i,f):u==="children"?Zs(i,f):Sd(i,u,f,c)}switch(a){case"input":Mf(i,s);break;case"textarea":L0(i,s);break;case"select":var h=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var _=s.value;_!=null?mi(i,!!s.multiple,_,!1):h!==!!s.multiple&&(s.defaultValue!=null?mi(i,!!s.multiple,s.defaultValue,!0):mi(i,!!s.multiple,s.multiple?[]:"",!1))}i[so]=s}catch(E){Te(t,t.return,E)}}break;case 6:if(Pt(e,t),Wt(t),r&4){if(t.stateNode===null)throw Error(L(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(E){Te(t,t.return,E)}}break;case 3:if(Pt(e,t),Wt(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{eo(e.containerInfo)}catch(E){Te(t,t.return,E)}break;case 4:Pt(e,t),Wt(t);break;case 13:Pt(e,t),Wt(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(np=Ee())),r&4&&f_(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(Xe=(c=Xe)||u,Pt(e,t),Xe=c):Pt(e,t),Wt(t),r&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(X=t,u=t.child;u!==null;){for(f=X=u;X!==null;){switch(h=X,_=h.child,h.tag){case 0:case 11:case 14:case 15:Fs(4,h,h.return);break;case 1:ci(h,h.return);var v=h.stateNode;if(typeof v.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(E){Te(r,n,E)}}break;case 5:ci(h,h.return);break;case 22:if(h.memoizedState!==null){d_(f);continue}}_!==null?(_.return=h,X=_):d_(f)}u=u.sibling}e:for(u=null,f=t;;){if(f.tag===5){if(u===null){u=f;try{i=f.stateNode,c?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=j0("display",o))}catch(E){Te(t,t.return,E)}}}else if(f.tag===6){if(u===null)try{f.stateNode.nodeValue=c?"":f.memoizedProps}catch(E){Te(t,t.return,E)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===t)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===t)break e;for(;f.sibling===null;){if(f.return===null||f.return===t)break e;u===f&&(u=null),f=f.return}u===f&&(u=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Pt(e,t),Wt(t),r&4&&f_(t);break;case 21:break;default:Pt(e,t),Wt(t)}}function Wt(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(pT(n)){var r=n;break e}n=n.return}throw Error(L(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Zs(i,""),r.flags&=-33);var s=u_(t);fh(t,s,i);break;case 3:case 4:var o=r.stateNode.containerInfo,a=u_(t);uh(t,a,o);break;default:throw Error(L(161))}}catch(l){Te(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function Zb(t,e,n){X=t,mT(t)}function mT(t,e,n){for(var r=(t.mode&1)!==0;X!==null;){var i=X,s=i.child;if(i.tag===22&&r){var o=i.memoizedState!==null||aa;if(!o){var a=i.alternate,l=a!==null&&a.memoizedState!==null||Xe;a=aa;var c=Xe;if(aa=o,(Xe=l)&&!c)for(X=i;X!==null;)o=X,l=o.child,o.tag===22&&o.memoizedState!==null?p_(i):l!==null?(l.return=o,X=l):p_(i);for(;s!==null;)X=s,mT(s),s=s.sibling;X=i,aa=a,Xe=c}h_(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,X=s):h_(t)}}function h_(t){for(;X!==null;){var e=X;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Xe||Uc(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!Xe)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:Nt(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Zg(e,s,r);break;case 3:var o=e.updateQueue;if(o!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Zg(e,o,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var f=u.dehydrated;f!==null&&eo(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(L(163))}Xe||e.flags&512&&ch(e)}catch(h){Te(e,e.return,h)}}if(e===t){X=null;break}if(n=e.sibling,n!==null){n.return=e.return,X=n;break}X=e.return}}function d_(t){for(;X!==null;){var e=X;if(e===t){X=null;break}var n=e.sibling;if(n!==null){n.return=e.return,X=n;break}X=e.return}}function p_(t){for(;X!==null;){var e=X;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Uc(4,e)}catch(l){Te(e,n,l)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(l){Te(e,i,l)}}var s=e.return;try{ch(e)}catch(l){Te(e,s,l)}break;case 5:var o=e.return;try{ch(e)}catch(l){Te(e,o,l)}}}catch(l){Te(e,e.return,l)}if(e===t){X=null;break}var a=e.sibling;if(a!==null){a.return=e.return,X=a;break}X=e.return}}var Qb=Math.ceil,_l=Sn.ReactCurrentDispatcher,ep=Sn.ReactCurrentOwner,St=Sn.ReactCurrentBatchConfig,ee=0,ke=null,Re=null,Ue=0,ct=0,ui=tr(0),Pe=0,fo=null,Pr=0,Lc=0,tp=0,Ds=null,nt=null,np=0,Oi=1/0,fn=null,ml=!1,hh=null,Yn=null,la=!1,Ln=null,yl=0,Bs=0,dh=null,Ha=-1,Wa=0;function Je(){return ee&6?Ee():Ha!==-1?Ha:Ha=Ee()}function Kn(t){return t.mode&1?ee&2&&Ue!==0?Ue&-Ue:Ob.transition!==null?(Wa===0&&(Wa=tv()),Wa):(t=re,t!==0||(t=window.event,t=t===void 0?16:lv(t.type)),t):1}function Ut(t,e,n,r){if(50<Bs)throw Bs=0,dh=null,Error(L(185));bo(t,n,r),(!(ee&2)||t!==ke)&&(t===ke&&(!(ee&2)&&(Lc|=n),Pe===4&&Bn(t,Ue)),at(t,r),n===1&&ee===0&&!(e.mode&1)&&(Oi=Ee()+500,Fc&&nr()))}function at(t,e){var n=t.callbackNode;OS(t,e);var r=tl(t,t===ke?Ue:0);if(r===0)n!==null&&Sg(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Sg(n),e===1)t.tag===0?kb(g_.bind(null,t)):Cv(g_.bind(null,t)),Pb(function(){!(ee&6)&&nr()}),n=null;else{switch(nv(r)){case 1:n=xd;break;case 4:n=G0;break;case 16:n=el;break;case 536870912:n=ev;break;default:n=el}n=AT(n,yT.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function yT(t,e){if(Ha=-1,Wa=0,ee&6)throw Error(L(327));var n=t.callbackNode;if(Ei()&&t.callbackNode!==n)return null;var r=tl(t,t===ke?Ue:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=vl(t,r);else{e=r;var i=ee;ee|=2;var s=TT();(ke!==t||Ue!==e)&&(fn=null,Oi=Ee()+500,yr(t,e));do try{eA();break}catch(a){vT(t,a)}while(1);Vd(),_l.current=s,ee=i,Re!==null?e=0:(ke=null,Ue=0,e=Pe)}if(e!==0){if(e===2&&(i=zf(t),i!==0&&(r=i,e=ph(t,i))),e===1)throw n=fo,yr(t,0),Bn(t,r),at(t,Ee()),n;if(e===6)Bn(t,r);else{if(i=t.current.alternate,!(r&30)&&!Jb(i)&&(e=vl(t,r),e===2&&(s=zf(t),s!==0&&(r=s,e=ph(t,s))),e===1))throw n=fo,yr(t,0),Bn(t,r),at(t,Ee()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(L(345));case 2:cr(t,nt,fn);break;case 3:if(Bn(t,r),(r&130023424)===r&&(e=np+500-Ee(),10<e)){if(tl(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){Je(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=Kf(cr.bind(null,t,nt,fn),e);break}cr(t,nt,fn);break;case 4:if(Bn(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var o=31-Bt(r);s=1<<o,o=e[o],o>i&&(i=o),r&=~s}if(r=i,r=Ee()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Qb(r/1960))-r,10<r){t.timeoutHandle=Kf(cr.bind(null,t,nt,fn),r);break}cr(t,nt,fn);break;case 5:cr(t,nt,fn);break;default:throw Error(L(329))}}}return at(t,Ee()),t.callbackNode===n?yT.bind(null,t):null}function ph(t,e){var n=Ds;return t.current.memoizedState.isDehydrated&&(yr(t,e).flags|=256),t=vl(t,e),t!==2&&(e=nt,nt=n,e!==null&&gh(e)),t}function gh(t){nt===null?nt=t:nt.push.apply(nt,t)}function Jb(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!Lt(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Bn(t,e){for(e&=~tp,e&=~Lc,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Bt(e),r=1<<n;t[n]=-1,e&=~r}}function g_(t){if(ee&6)throw Error(L(327));Ei();var e=tl(t,0);if(!(e&1))return at(t,Ee()),null;var n=vl(t,e);if(t.tag!==0&&n===2){var r=zf(t);r!==0&&(e=r,n=ph(t,r))}if(n===1)throw n=fo,yr(t,0),Bn(t,e),at(t,Ee()),n;if(n===6)throw Error(L(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,cr(t,nt,fn),at(t,Ee()),null}function rp(t,e){var n=ee;ee|=1;try{return t(e)}finally{ee=n,ee===0&&(Oi=Ee()+500,Fc&&nr())}}function Mr(t){Ln!==null&&Ln.tag===0&&!(ee&6)&&Ei();var e=ee;ee|=1;var n=St.transition,r=re;try{if(St.transition=null,re=1,t)return t()}finally{re=r,St.transition=n,ee=e,!(ee&6)&&nr()}}function ip(){ct=ui.current,ue(ui)}function yr(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xb(n)),Re!==null)for(n=Re.return;n!==null;){var r=n;switch(Ud(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&ol();break;case 3:Ni(),ue(st),ue(Ke),Yd();break;case 5:Xd(r);break;case 4:Ni();break;case 13:ue(pe);break;case 19:ue(pe);break;case 10:jd(r.type._context);break;case 22:case 23:ip()}n=n.return}if(ke=t,Re=t=qn(t.current,null),Ue=ct=e,Pe=0,fo=null,tp=Lc=Pr=0,nt=Ds=null,pr!==null){for(e=0;e<pr.length;e++)if(n=pr[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var o=s.next;s.next=i,r.next=o}n.pending=r}pr=null}return t}function vT(t,e){do{var n=Re;try{if(Vd(),za.current=gl,pl){for(var r=_e.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}pl=!1}if(xr=0,Ne=xe=_e=null,Os=!1,lo=0,ep.current=null,n===null||n.return===null){Pe=1,fo=e,Re=null;break}e:{var s=t,o=n.return,a=n,l=e;if(e=Ue,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,f=u.tag;if(!(u.mode&1)&&(f===0||f===11||f===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var _=n_(o);if(_!==null){_.flags&=-257,r_(_,o,a,s,e),_.mode&1&&t_(s,c,e),e=_,l=c;var v=e.updateQueue;if(v===null){var E=new Set;E.add(l),e.updateQueue=E}else v.add(l);break e}else{if(!(e&1)){t_(s,c,e),sp();break e}l=Error(L(426))}}else if(he&&a.mode&1){var b=n_(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),r_(b,o,a,s,e),Ld(ki(l,a));break e}}s=l=ki(l,a),Pe!==4&&(Pe=2),Ds===null?Ds=[s]:Ds.push(s),s=o;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=nT(s,l,e);qg(s,g);break e;case 1:a=l;var p=s.type,y=s.stateNode;if(!(s.flags&128)&&(typeof p.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Yn===null||!Yn.has(y)))){s.flags|=65536,e&=-e,s.lanes|=e;var S=rT(s,a,e);qg(s,S);break e}}s=s.return}while(s!==null)}ET(n)}catch(R){e=R,Re===n&&n!==null&&(Re=n=n.return);continue}break}while(1)}function TT(){var t=_l.current;return _l.current=gl,t===null?gl:t}function sp(){(Pe===0||Pe===3||Pe===2)&&(Pe=4),ke===null||!(Pr&268435455)&&!(Lc&268435455)||Bn(ke,Ue)}function vl(t,e){var n=ee;ee|=2;var r=TT();(ke!==t||Ue!==e)&&(fn=null,yr(t,e));do try{Gb();break}catch(i){vT(t,i)}while(1);if(Vd(),ee=n,_l.current=r,Re!==null)throw Error(L(261));return ke=null,Ue=0,Pe}function Gb(){for(;Re!==null;)wT(Re)}function eA(){for(;Re!==null&&!AS();)wT(Re)}function wT(t){var e=bT(t.alternate,t,ct);t.memoizedProps=t.pendingProps,e===null?ET(t):Re=e,ep.current=null}function ET(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=Yb(n,e),n!==null){n.flags&=32767,Re=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Pe=6,Re=null;return}}else if(n=Xb(n,e,ct),n!==null){Re=n;return}if(e=e.sibling,e!==null){Re=e;return}Re=e=t}while(e!==null);Pe===0&&(Pe=5)}function cr(t,e,n){var r=re,i=St.transition;try{St.transition=null,re=1,tA(t,e,n,r)}finally{St.transition=i,re=r}return null}function tA(t,e,n,r){do Ei();while(Ln!==null);if(ee&6)throw Error(L(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(L(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(FS(t,s),t===ke&&(Re=ke=null,Ue=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||la||(la=!0,AT(el,function(){return Ei(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=St.transition,St.transition=null;var o=re;re=1;var a=ee;ee|=4,ep.current=null,qb(t,n),_T(n,t),wb(Xf),nl=!!$f,Xf=$f=null,t.current=n,Zb(n),RS(),ee=a,re=o,St.transition=s}else t.current=n;if(la&&(la=!1,Ln=t,yl=i),s=t.pendingLanes,s===0&&(Yn=null),PS(n.stateNode),at(t,Ee()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(ml)throw ml=!1,t=hh,hh=null,t;return yl&1&&t.tag!==0&&Ei(),s=t.pendingLanes,s&1?t===dh?Bs++:(Bs=0,dh=t):Bs=0,nr(),null}function Ei(){if(Ln!==null){var t=nv(yl),e=St.transition,n=re;try{if(St.transition=null,re=16>t?16:t,Ln===null)var r=!1;else{if(t=Ln,Ln=null,yl=0,ee&6)throw Error(L(331));var i=ee;for(ee|=4,X=t.current;X!==null;){var s=X,o=s.child;if(X.flags&16){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(X=c;X!==null;){var u=X;switch(u.tag){case 0:case 11:case 15:Fs(8,u,s)}var f=u.child;if(f!==null)f.return=u,X=f;else for(;X!==null;){u=X;var h=u.sibling,_=u.return;if(dT(u),u===c){X=null;break}if(h!==null){h.return=_,X=h;break}X=_}}}var v=s.alternate;if(v!==null){var E=v.child;if(E!==null){v.child=null;do{var b=E.sibling;E.sibling=null,E=b}while(E!==null)}}X=s}}if(s.subtreeFlags&2064&&o!==null)o.return=s,X=o;else e:for(;X!==null;){if(s=X,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Fs(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,X=g;break e}X=s.return}}var p=t.current;for(X=p;X!==null;){o=X;var y=o.child;if(o.subtreeFlags&2064&&y!==null)y.return=o,X=y;else e:for(o=p;X!==null;){if(a=X,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Uc(9,a)}}catch(R){Te(a,a.return,R)}if(a===o){X=null;break e}var S=a.sibling;if(S!==null){S.return=a.return,X=S;break e}X=a.return}}if(ee=i,nr(),tn&&typeof tn.onPostCommitFiberRoot=="function")try{tn.onPostCommitFiberRoot(Mc,t)}catch{}r=!0}return r}finally{re=n,St.transition=e}}return!1}function __(t,e,n){e=ki(n,e),e=nT(t,e,1),t=Xn(t,e,1),e=Je(),t!==null&&(bo(t,1,e),at(t,e))}function Te(t,e,n){if(t.tag===3)__(t,t,n);else for(;e!==null;){if(e.tag===3){__(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Yn===null||!Yn.has(r))){t=ki(n,t),t=rT(e,t,1),e=Xn(e,t,1),t=Je(),e!==null&&(bo(e,1,t),at(e,t));break}}e=e.return}}function nA(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=Je(),t.pingedLanes|=t.suspendedLanes&n,ke===t&&(Ue&n)===n&&(Pe===4||Pe===3&&(Ue&130023424)===Ue&&500>Ee()-np?yr(t,0):tp|=n),at(t,e)}function ST(t,e){e===0&&(t.mode&1?(e=Jo,Jo<<=1,!(Jo&130023424)&&(Jo=4194304)):e=1);var n=Je();t=Tn(t,e),t!==null&&(bo(t,e,n),at(t,n))}function rA(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),ST(t,n)}function iA(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(L(314))}r!==null&&r.delete(e),ST(t,n)}var bT;bT=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||st.current)rt=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return rt=!1,$b(t,e,n);rt=!!(t.flags&131072)}else rt=!1,he&&e.flags&1048576&&xv(e,cl,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;ja(t,e),t=e.pendingProps;var i=Pi(e,Ke.current);wi(e,n),i=qd(null,e,r,t,i,n);var s=Zd();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ot(r)?(s=!0,al(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Wd(e),i.updater=Bc,e.stateNode=i,i._reactInternals=e,th(e,r,t,n),e=ih(null,e,r,!0,s,n)):(e.tag=0,he&&s&&Bd(e),Ze(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(ja(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=oA(r),t=Nt(r,t),i){case 0:e=rh(null,e,r,t,n);break e;case 1:e=o_(null,e,r,t,n);break e;case 11:e=i_(null,e,r,t,n);break e;case 14:e=s_(null,e,r,Nt(r.type,t),n);break e}throw Error(L(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),rh(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),o_(t,e,r,i,n);case 3:e:{if(aT(e),t===null)throw Error(L(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Ov(t,e),hl(e,r,null,n);var o=e.memoizedState;if(r=o.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=ki(Error(L(423)),e),e=a_(t,e,r,n,i);break e}else if(r!==i){i=ki(Error(L(424)),e),e=a_(t,e,r,n,i);break e}else for(ft=$n(e.stateNode.containerInfo.firstChild),pt=e,he=!0,Ot=null,n=Nv(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Mi(),r===i){e=wn(t,e,n);break e}Ze(t,e,r,n)}e=e.child}return e;case 5:return Fv(e),t===null&&Jf(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,o=i.children,Yf(r,i)?o=null:s!==null&&Yf(r,s)&&(e.flags|=32),oT(t,e),Ze(t,e,o,n),e.child;case 6:return t===null&&Jf(e),null;case 13:return lT(t,e,n);case 4:return $d(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Ii(e,null,r,n):Ze(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),i_(t,e,r,i,n);case 7:return Ze(t,e,e.pendingProps,n),e.child;case 8:return Ze(t,e,e.pendingProps.children,n),e.child;case 12:return Ze(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,o=i.value,le(ul,r._currentValue),r._currentValue=o,s!==null)if(Lt(s.value,o)){if(s.children===i.children&&!st.current){e=wn(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){o=s.child;for(var l=a.firstContext;l!==null;){if(l.context===r){if(s.tag===1){l=mn(-1,n&-n),l.tag=2;var c=s.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}s.lanes|=n,l=s.alternate,l!==null&&(l.lanes|=n),Gf(s.return,n,e),a.lanes|=n;break}l=l.next}}else if(s.tag===10)o=s.type===e.type?null:s.child;else if(s.tag===18){if(o=s.return,o===null)throw Error(L(341));o.lanes|=n,a=o.alternate,a!==null&&(a.lanes|=n),Gf(o,n,e),o=s.sibling}else o=s.child;if(o!==null)o.return=s;else for(o=s;o!==null;){if(o===e){o=null;break}if(s=o.sibling,s!==null){s.return=o.return,o=s;break}o=o.return}s=o}Ze(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,wi(e,n),i=At(i),r=r(i),e.flags|=1,Ze(t,e,r,n),e.child;case 14:return r=e.type,i=Nt(r,e.pendingProps),i=Nt(r.type,i),s_(t,e,r,i,n);case 15:return iT(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Nt(r,i),ja(t,e),e.tag=1,ot(r)?(t=!0,al(e)):t=!1,wi(e,n),tT(e,r,i),th(e,r,i,n),ih(null,e,r,!0,t,n);case 19:return cT(t,e,n);case 22:return sT(t,e,n)}throw Error(L(156,e.tag))};function AT(t,e){return J0(t,e)}function sA(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Et(t,e,n,r){return new sA(t,e,n,r)}function op(t){return t=t.prototype,!(!t||!t.isReactComponent)}function oA(t){if(typeof t=="function")return op(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Ad)return 11;if(t===Rd)return 14}return 2}function qn(t,e){var n=t.alternate;return n===null?(n=Et(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function $a(t,e,n,r,i,s){var o=2;if(r=t,typeof t=="function")op(t)&&(o=1);else if(typeof t=="string")o=5;else e:switch(t){case ei:return vr(n.children,i,s,e);case bd:o=8,i|=8;break;case Af:return t=Et(12,n,e,i|2),t.elementType=Af,t.lanes=s,t;case Rf:return t=Et(13,n,e,i),t.elementType=Rf,t.lanes=s,t;case Cf:return t=Et(19,n,e,i),t.elementType=Cf,t.lanes=s,t;case F0:return zc(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case k0:o=10;break e;case O0:o=9;break e;case Ad:o=11;break e;case Rd:o=14;break e;case In:o=16,r=null;break e}throw Error(L(130,t==null?t:typeof t,""))}return e=Et(o,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function vr(t,e,n,r){return t=Et(7,t,r,e),t.lanes=n,t}function zc(t,e,n,r){return t=Et(22,t,r,e),t.elementType=F0,t.lanes=n,t.stateNode={isHidden:!1},t}function Ou(t,e,n){return t=Et(6,t,null,e),t.lanes=n,t}function Fu(t,e,n){return e=Et(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function aA(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gu(0),this.expirationTimes=gu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gu(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function ap(t,e,n,r,i,s,o,a,l){return t=new aA(t,e,n,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Et(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wd(s),t}function lA(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Gr,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function RT(t){if(!t)return Jn;t=t._reactInternals;e:{if(kr(t)!==t||t.tag!==1)throw Error(L(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ot(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(L(171))}if(t.tag===1){var n=t.type;if(ot(n))return Rv(t,n,e)}return e}function CT(t,e,n,r,i,s,o,a,l){return t=ap(n,r,!0,t,i,s,o,a,l),t.context=RT(null),n=t.current,r=Je(),i=Kn(n),s=mn(r,i),s.callback=e??null,Xn(n,s,i),t.current.lanes=i,bo(t,i,r),at(t,r),t}function Vc(t,e,n,r){var i=e.current,s=Je(),o=Kn(i);return n=RT(n),e.context===null?e.context=n:e.pendingContext=n,e=mn(s,o),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Xn(i,e,o),t!==null&&(Ut(t,i,o,s),La(t,i,o)),o}function Tl(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function m_(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function lp(t,e){m_(t,e),(t=t.alternate)&&m_(t,e)}function cA(){return null}var xT=typeof reportError=="function"?reportError:function(t){console.error(t)};function cp(t){this._internalRoot=t}jc.prototype.render=cp.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(L(409));Vc(t,e,null,null)};jc.prototype.unmount=cp.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Mr(function(){Vc(null,t,null,null)}),e[vn]=null}};function jc(t){this._internalRoot=t}jc.prototype.unstable_scheduleHydration=function(t){if(t){var e=sv();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Dn.length&&e!==0&&e<Dn[n].priority;n++);Dn.splice(n,0,t),n===0&&av(t)}};function up(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Hc(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function y_(){}function uA(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var c=Tl(o);s.call(c)}}var o=CT(e,r,t,0,null,!1,!1,"",y_);return t._reactRootContainer=o,t[vn]=o.current,ro(t.nodeType===8?t.parentNode:t),Mr(),o}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var a=r;r=function(){var c=Tl(l);a.call(c)}}var l=ap(t,0,!1,null,null,!1,!1,"",y_);return t._reactRootContainer=l,t[vn]=l.current,ro(t.nodeType===8?t.parentNode:t),Mr(function(){Vc(e,l,n,r)}),l}function Wc(t,e,n,r,i){var s=n._reactRootContainer;if(s){var o=s;if(typeof i=="function"){var a=i;i=function(){var l=Tl(o);a.call(l)}}Vc(e,o,t,i)}else o=uA(n,e,t,i,r);return Tl(o)}rv=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=ws(e.pendingLanes);n!==0&&(Pd(e,n|1),at(e,Ee()),!(ee&6)&&(Oi=Ee()+500,nr()))}break;case 13:Mr(function(){var r=Tn(t,1);if(r!==null){var i=Je();Ut(r,t,1,i)}}),lp(t,1)}};Md=function(t){if(t.tag===13){var e=Tn(t,134217728);if(e!==null){var n=Je();Ut(e,t,134217728,n)}lp(t,134217728)}};iv=function(t){if(t.tag===13){var e=Kn(t),n=Tn(t,e);if(n!==null){var r=Je();Ut(n,t,e,r)}lp(t,e)}};sv=function(){return re};ov=function(t,e){var n=re;try{return re=t,e()}finally{re=n}};Bf=function(t,e,n){switch(e){case"input":if(Mf(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=Oc(r);if(!i)throw Error(L(90));B0(r),Mf(r,i)}}}break;case"textarea":L0(t,n);break;case"select":e=n.value,e!=null&&mi(t,!!n.multiple,e,!1)}};X0=rp;Y0=Mr;var fA={usingClientEntryPoint:!1,Events:[Ro,ii,Oc,W0,$0,rp]},ds={findFiberByHostInstance:dr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hA={bundleType:ds.bundleType,version:ds.version,rendererPackageName:ds.rendererPackageName,rendererConfig:ds.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Sn.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Z0(t),t===null?null:t.stateNode},findFiberByHostInstance:ds.findFiberByHostInstance||cA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ca=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ca.isDisabled&&ca.supportsFiber)try{Mc=ca.inject(hA),tn=ca}catch{}}_t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fA;_t.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!up(e))throw Error(L(200));return lA(t,e,null,n)};_t.createRoot=function(t,e){if(!up(t))throw Error(L(299));var n=!1,r="",i=xT;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=ap(t,1,!1,null,null,n,!1,r,i),t[vn]=e.current,ro(t.nodeType===8?t.parentNode:t),new cp(e)};_t.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(L(188)):(t=Object.keys(t).join(","),Error(L(268,t)));return t=Z0(e),t=t===null?null:t.stateNode,t};_t.flushSync=function(t){return Mr(t)};_t.hydrate=function(t,e,n){if(!Hc(e))throw Error(L(200));return Wc(null,t,e,!0,n)};_t.hydrateRoot=function(t,e,n){if(!up(t))throw Error(L(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",o=xT;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(o=n.onRecoverableError)),e=CT(e,null,t,1,n??null,i,!1,s,o),t[vn]=e.current,ro(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new jc(e)};_t.render=function(t,e,n){if(!Hc(e))throw Error(L(200));return Wc(null,t,e,!1,n)};_t.unmountComponentAtNode=function(t){if(!Hc(t))throw Error(L(40));return t._reactRootContainer?(Mr(function(){Wc(null,null,t,!1,function(){t._reactRootContainer=null,t[vn]=null})}),!0):!1};_t.unstable_batchedUpdates=rp;_t.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!Hc(n))throw Error(L(200));if(t==null||t._reactInternals===void 0)throw Error(L(38));return Wc(t,e,n,!1,r)};_t.version="18.3.1-next-f1338f8080-20240426";function PT(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(PT)}catch(t){console.error(t)}}PT(),P0.exports=_t;var fp=P0.exports,MT,v_=fp;MT=v_.createRoot,v_.hydrateRoot;const dA="modulepreload",pA=function(t){return"/"+t},T_={},gA=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=pA(s),s in T_)return;T_[s]=!0;const o=s.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!r)for(let u=i.length-1;u>=0;u--){const f=i[u];if(f.href===s&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${a}`))return;const c=document.createElement("link");if(c.rel=o?"stylesheet":dA,o||(c.as="script",c.crossOrigin=""),c.href=s,document.head.appendChild(c),o)return new Promise((u,f)=>{c.addEventListener("load",u),c.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s})},_A=W.createContext(null);function mA(t,e){const n=Array.isArray(t)?t[0]:t?t.x:0,r=Array.isArray(t)?t[1]:t?t.y:0,i=Array.isArray(e)?e[0]:e?e.x:0,s=Array.isArray(e)?e[1]:e?e.y:0;return n===i&&r===s}function dn(t,e){if(t===e)return!0;if(!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!dn(t[n],e[n]))return!1;return!0}else if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(const i of n)if(!e.hasOwnProperty(i)||!dn(t[i],e[i]))return!1;return!0}return!1}function yA(t){const e=t.clone();return e.pixelsToGLUnits=t.pixelsToGLUnits,e}function w_(t,e){if(!t.getProjection)return;const n=t.getProjection(),r=e.getProjection();dn(n,r)||e.setProjection(n)}function E_(t){return{longitude:t.center.lng,latitude:t.center.lat,zoom:t.zoom,pitch:t.pitch,bearing:t.bearing,padding:t.padding}}function S_(t,e){const n=e.viewState||e;let r=!1;if("longitude"in n&&"latitude"in n){const i=t.center;t.center=new i.constructor(n.longitude,n.latitude),r=r||i!==t.center}if("zoom"in n){const i=t.zoom;t.zoom=n.zoom,r=r||i!==t.zoom}if("bearing"in n){const i=t.bearing;t.bearing=n.bearing,r=r||i!==t.bearing}if("pitch"in n){const i=t.pitch;t.pitch=n.pitch,r=r||i!==t.pitch}return n.padding&&!t.isPaddingEqual(n.padding)&&(r=!0,t.padding=n.padding),r}const vA=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function b_(t){if(!t)return null;if(typeof t=="string"||("toJS"in t&&(t=t.toJS()),!t.layers))return t;const e={};for(const r of t.layers)e[r.id]=r;const n=t.layers.map(r=>{let i=null;"interactive"in r&&(i=Object.assign({},r),delete i.interactive);const s=e[r.ref];if(s){i=i||Object.assign({},r),delete i.ref;for(const o of vA)o in s&&(i[o]=s[o])}return i||r});return{...t,layers:n}}const A_={version:8,sources:{},layers:[]},R_={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},Du={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},C_={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},TA=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],wA=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Fi{constructor(e,n,r){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=i=>{const s=this.props[C_[i.type]];s?s(i):i.type==="error"&&console.error(i.error)},this._onPointerEvent=i=>{(i.type==="mousemove"||i.type==="mouseout")&&this._updateHover(i);const s=this.props[R_[i.type]];s&&(this.props.interactiveLayerIds&&i.type!=="mouseover"&&i.type!=="mouseout"&&(i.features=this._hoveredFeatures||this._queryRenderedFeatures(i.point)),s(i),delete i.features)},this._onCameraEvent=i=>{if(!this._internalUpdate){const s=this.props[Du[i.type]];s&&s(i)}i.type in this._deferredEvents&&(this._deferredEvents[i.type]=!1)},this._MapClass=e,this.props=n,this._initialize(r)}get map(){return this._map}get transform(){return this._renderTransform}setProps(e){const n=this.props;this.props=e;const r=this._updateSettings(e,n);r&&this._createShadowTransform(this._map);const i=this._updateSize(e),s=this._updateViewState(e,!0);this._updateStyle(e,n),this._updateStyleComponents(e,n),this._updateHandlers(e,n),(r||i||s&&!this._map.isMoving())&&this.redraw()}static reuse(e,n){const r=Fi.savedMaps.pop();if(!r)return null;const i=r.map,s=i.getContainer();for(n.className=s.className;s.childNodes.length>0;)n.appendChild(s.childNodes[0]);i._container=n;const o=i._resizeObserver;o&&(o.disconnect(),o.observe(n)),r.setProps({...e,styleDiffing:!1}),i.resize();const{initialViewState:a}=e;return a&&(a.bounds?i.fitBounds(a.bounds,{...a.fitBoundsOptions,duration:0}):r._updateViewState(a,!1)),i.isStyleLoaded()?i.fire("load"):i.once("styledata",()=>i.fire("load")),i._update(),r}_initialize(e){const{props:n}=this,{mapStyle:r=A_}=n,i={...n,...n.initialViewState,accessToken:n.mapboxAccessToken||EA()||null,container:e,style:b_(r)},s=i.initialViewState||i.viewState||i;if(Object.assign(i,{center:[s.longitude||0,s.latitude||0],zoom:s.zoom||0,pitch:s.pitch||0,bearing:s.bearing||0}),n.gl){const u=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=u,n.gl)}const o=new this._MapClass(i);s.padding&&o.setPadding(s.padding),n.cursor&&(o.getCanvas().style.cursor=n.cursor),this._createShadowTransform(o);const a=o._render;o._render=u=>{this._inRender=!0,a.call(o,u),this._inRender=!1};const l=o._renderTaskQueue.run;o._renderTaskQueue.run=u=>{l.call(o._renderTaskQueue,u),this._onBeforeRepaint()},o.on("render",()=>this._onAfterRepaint());const c=o.fire;o.fire=this._fireEvent.bind(this,c),o.on("resize",()=>{this._renderTransform.resize(o.transform.width,o.transform.height)}),o.on("styledata",()=>{this._updateStyleComponents(this.props,{}),w_(o.transform,this._renderTransform)}),o.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const u in R_)o.on(u,this._onPointerEvent);for(const u in Du)o.on(u,this._onCameraEvent);for(const u in C_)o.on(u,this._onEvent);this._map=o}recycle(){const n=this.map.getContainer().querySelector("[mapboxgl-children]");n==null||n.remove(),Fi.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const e=this._map;!this._inRender&&e.style&&(e._frame&&(e._frame.cancel(),e._frame=null),e._render())}_createShadowTransform(e){const n=yA(e.transform);e.painter.transform=n,this._renderTransform=n}_updateSize(e){const{viewState:n}=e;if(n){const r=this._map;if(n.width!==r.transform.width||n.height!==r.transform.height)return r.resize(),!0}return!1}_updateViewState(e,n){if(this._internalUpdate)return!1;const r=this._map,i=this._renderTransform,{zoom:s,pitch:o,bearing:a}=i,l=r.isMoving();l&&(i.cameraElevationReference="sea");const c=S_(i,{...E_(r.transform),...e});if(l&&(i.cameraElevationReference="ground"),c&&n){const u=this._deferredEvents;u.move=!0,u.zoom||(u.zoom=s!==i.zoom),u.rotate||(u.rotate=a!==i.bearing),u.pitch||(u.pitch=o!==i.pitch)}return l||S_(r.transform,e),c}_updateSettings(e,n){const r=this._map;let i=!1;for(const s of TA)if(s in e&&!dn(e[s],n[s])){i=!0;const o=r[`set${s[0].toUpperCase()}${s.slice(1)}`];o==null||o.call(r,e[s])}return i}_updateStyle(e,n){if(e.cursor!==n.cursor&&(this._map.getCanvas().style.cursor=e.cursor||""),e.mapStyle!==n.mapStyle){const{mapStyle:r=A_,styleDiffing:i=!0}=e,s={diff:i};return"localIdeographFontFamily"in e&&(s.localIdeographFontFamily=e.localIdeographFontFamily),this._map.setStyle(b_(r),s),!0}return!1}_updateStyleComponents(e,n){const r=this._map;let i=!1;return r.isStyleLoaded()&&("light"in e&&r.setLight&&!dn(e.light,n.light)&&(i=!0,r.setLight(e.light)),"fog"in e&&r.setFog&&!dn(e.fog,n.fog)&&(i=!0,r.setFog(e.fog)),"terrain"in e&&r.setTerrain&&!dn(e.terrain,n.terrain)&&(!e.terrain||r.getSource(e.terrain.source))&&(i=!0,r.setTerrain(e.terrain))),i}_updateHandlers(e,n){var r,i;const s=this._map;let o=!1;for(const a of wA){const l=(r=e[a])!==null&&r!==void 0?r:!0,c=(i=n[a])!==null&&i!==void 0?i:!0;dn(l,c)||(o=!0,l?s[a].enable(l):s[a].disable())}return o}_queryRenderedFeatures(e){const n=this._map,r=n.transform,{interactiveLayerIds:i=[]}=this.props;try{return n.transform=this._renderTransform,n.queryRenderedFeatures(e,{layers:i.filter(n.getLayer.bind(n))})}catch{return[]}finally{n.transform=r}}_updateHover(e){var n;const{props:r}=this;if(r.interactiveLayerIds&&(r.onMouseMove||r.onMouseEnter||r.onMouseLeave)){const s=e.type,o=((n=this._hoveredFeatures)===null||n===void 0?void 0:n.length)>0,a=this._queryRenderedFeatures(e.point),l=a.length>0;!l&&o&&(e.type="mouseleave",this._onPointerEvent(e)),this._hoveredFeatures=a,l&&!o&&(e.type="mouseenter",this._onPointerEvent(e)),e.type=s}else this._hoveredFeatures=null}_fireEvent(e,n,r){const i=this._map,s=i.transform,o=typeof n=="string"?n:n.type;return o==="move"&&this._updateViewState(this.props,!1),o in Du&&(typeof n=="object"&&(n.viewState=E_(s)),this._map.isMoving())?(i.transform=this._renderTransform,e.call(i,n,r),i.transform=s,i):(e.call(i,n,r),i)}_onBeforeRepaint(){const e=this._map;this._internalUpdate=!0;for(const r in this._deferredEvents)this._deferredEvents[r]&&e.fire(r);this._internalUpdate=!1;const n=this._map.transform;e.transform=this._renderTransform,this._onAfterRepaint=()=>{w_(this._renderTransform,n),e.transform=n}}}Fi.savedMaps=[];function EA(){let t=null;if(typeof location<"u"){const e=/access_token=([^&\/]*)/.exec(location.search);t=e&&e[1]}try{t=t||{}.MapboxAccessToken}catch{}try{t=t||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return t}const SA=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function bA(t){if(!t)return null;const e=t.map,n={getMap:()=>e,getCenter:()=>t.transform.center,getZoom:()=>t.transform.zoom,getBearing:()=>t.transform.bearing,getPitch:()=>t.transform.pitch,getPadding:()=>t.transform.padding,getBounds:()=>t.transform.getBounds(),project:r=>{const i=e.transform;e.transform=t.transform;const s=e.project(r);return e.transform=i,s},unproject:r=>{const i=e.transform;e.transform=t.transform;const s=e.unproject(r);return e.transform=i,s},queryTerrainElevation:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryTerrainElevation(r,i);return e.transform=s,o},queryRenderedFeatures:(r,i)=>{const s=e.transform;e.transform=t.transform;const o=e.queryRenderedFeatures(r,i);return e.transform=s,o}};for(const r of AA(e))!(r in n)&&!SA.includes(r)&&(n[r]=e[r].bind(e));return n}function AA(t){const e=new Set;let n=t;for(;n;){for(const r of Object.getOwnPropertyNames(n))r[0]!=="_"&&typeof t[r]=="function"&&r!=="fire"&&r!=="setEventedParent"&&e.add(r);n=Object.getPrototypeOf(n)}return Array.from(e)}const RA=typeof document<"u"?W.useLayoutEffect:W.useEffect,CA=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function xA(t,e){for(const r of CA)r in e&&(t[r]=e[r]);const{RTLTextPlugin:n="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"}=e;n&&t.getRTLTextPluginStatus&&t.getRTLTextPluginStatus()==="unavailable"&&t.setRTLTextPlugin(n,r=>{r&&console.error(r)},!0)}const $c=W.createContext(null);function PA(t,e,n){const r=W.useContext(_A),[i,s]=W.useState(null),o=W.useRef(),{current:a}=W.useRef({mapLib:null,map:null});W.useEffect(()=>{const u=t.mapLib;let f=!0,h;return Promise.resolve(u||n).then(_=>{if(!f)return;if(!_)throw new Error("Invalid mapLib");const v="Map"in _?_:_.default;if(!v.Map)throw new Error("Invalid mapLib");if(xA(v,t),!v.supported||v.supported(t))t.reuseMaps&&(h=Fi.reuse(t,o.current)),h||(h=new Fi(v.Map,t,o.current)),a.map=bA(h),a.mapLib=v,s(h),r==null||r.onMapMount(a.map,t.id);else throw new Error("Map is not supported by this browser")}).catch(_=>{const{onError:v}=t;v?v({type:"error",target:null,originalEvent:null,error:_}):console.error(_)}),()=>{f=!1,h&&(r==null||r.onMapUnmount(t.id),t.reuseMaps?h.recycle():h.destroy())}},[]),RA(()=>{i&&i.setProps(t)}),W.useImperativeHandle(e,()=>a.map,[i]);const l=W.useMemo(()=>({position:"relative",width:"100%",height:"100%",...t.style}),[t.style]),c={height:"100%"};return W.createElement("div",{id:t.id,ref:o,style:l},i&&W.createElement($c.Provider,{value:a},W.createElement("div",{"mapboxgl-children":"",style:c},t.children)))}const MA=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function Or(t,e){if(!t||!e)return;const n=t.style;for(const r in e){const i=e[r];Number.isFinite(i)&&!MA.test(r)?n[r]=`${i}px`:n[r]=i}}function IA(t,e){const{map:n,mapLib:r}=W.useContext($c),i=W.useRef({props:t});i.current.props=t;const s=W.useMemo(()=>{let E=!1;W.Children.forEach(t.children,p=>{p&&(E=!0)});const b={...t,element:E?document.createElement("div"):null},g=new r.Marker(b);return g.setLngLat([t.longitude,t.latitude]),g.getElement().addEventListener("click",p=>{var y,S;(S=(y=i.current.props).onClick)===null||S===void 0||S.call(y,{type:"click",target:g,originalEvent:p})}),g.on("dragstart",p=>{var y,S;const R=p;R.lngLat=s.getLngLat(),(S=(y=i.current.props).onDragStart)===null||S===void 0||S.call(y,R)}),g.on("drag",p=>{var y,S;const R=p;R.lngLat=s.getLngLat(),(S=(y=i.current.props).onDrag)===null||S===void 0||S.call(y,R)}),g.on("dragend",p=>{var y,S;const R=p;R.lngLat=s.getLngLat(),(S=(y=i.current.props).onDragEnd)===null||S===void 0||S.call(y,R)}),g},[]);W.useEffect(()=>(s.addTo(n.getMap()),()=>{s.remove()}),[]);const{longitude:o,latitude:a,offset:l,style:c,draggable:u=!1,popup:f=null,rotation:h=0,rotationAlignment:_="auto",pitchAlignment:v="auto"}=t;return W.useEffect(()=>{Or(s.getElement(),c)},[c]),W.useImperativeHandle(e,()=>s,[]),(s.getLngLat().lng!==o||s.getLngLat().lat!==a)&&s.setLngLat([o,a]),l&&!mA(s.getOffset(),l)&&s.setOffset(l),s.isDraggable()!==u&&s.setDraggable(u),s.getRotation()!==h&&s.setRotation(h),s.getRotationAlignment()!==_&&s.setRotationAlignment(_),s.getPitchAlignment()!==v&&s.setPitchAlignment(v),s.getPopup()!==f&&s.setPopup(f),fp.createPortal(t.children,s.getElement())}W.memo(W.forwardRef(IA));function x_(t){return new Set(t?t.trim().split(/\s+/):[])}function NA(t,e){const{map:n,mapLib:r}=W.useContext($c),i=W.useMemo(()=>document.createElement("div"),[]),s=W.useRef({props:t});s.current.props=t;const o=W.useMemo(()=>{const a={...t},l=new r.Popup(a);return l.setLngLat([t.longitude,t.latitude]),l.once("open",c=>{var u,f;(f=(u=s.current.props).onOpen)===null||f===void 0||f.call(u,c)}),l},[]);if(W.useEffect(()=>{const a=l=>{var c,u;(u=(c=s.current.props).onClose)===null||u===void 0||u.call(c,l)};return o.on("close",a),o.setDOMContent(i).addTo(n.getMap()),()=>{o.off("close",a),o.isOpen()&&o.remove()}},[]),W.useEffect(()=>{Or(o.getElement(),t.style)},[t.style]),W.useImperativeHandle(e,()=>o,[]),o.isOpen()&&((o.getLngLat().lng!==t.longitude||o.getLngLat().lat!==t.latitude)&&o.setLngLat([t.longitude,t.latitude]),t.offset&&!dn(o.options.offset,t.offset)&&o.setOffset(t.offset),(o.options.anchor!==t.anchor||o.options.maxWidth!==t.maxWidth)&&(o.options.anchor=t.anchor,o.setMaxWidth(t.maxWidth)),o.options.className!==t.className)){const a=x_(o.options.className),l=x_(t.className);for(const c of a)l.has(c)||o.removeClassName(c);for(const c of l)a.has(c)||o.addClassName(c);o.options.className=t.className}return fp.createPortal(t.children,i)}W.memo(W.forwardRef(NA));function xo(t,e,n,r){const i=W.useContext($c),s=W.useMemo(()=>t(i),[]);return W.useEffect(()=>{const o=r||n||e,a=typeof e=="function"&&typeof n=="function"?e:null,l=typeof n=="function"?n:typeof e=="function"?e:null,{map:c}=i;return c.hasControl(s)||(c.addControl(s,o==null?void 0:o.position),a&&a(i)),()=>{l&&l(i),c.hasControl(s)&&c.removeControl(s)}},[]),s}function kA(t){const e=xo(({mapLib:n})=>new n.AttributionControl(t),{position:t.position});return W.useEffect(()=>{Or(e._container,t.style)},[t.style]),null}W.memo(kA);function OA(t){const e=xo(({mapLib:n})=>new n.FullscreenControl({container:t.containerId&&document.getElementById(t.containerId)}),{position:t.position});return W.useEffect(()=>{Or(e._controlContainer,t.style)},[t.style]),null}W.memo(OA);function FA(t,e){const n=W.useRef({props:t}),r=xo(({mapLib:i})=>{const s=new i.GeolocateControl(t),o=s._setupUI;return s._setupUI=a=>{s._container.hasChildNodes()||o(a)},s.on("geolocate",a=>{var l,c;(c=(l=n.current.props).onGeolocate)===null||c===void 0||c.call(l,a)}),s.on("error",a=>{var l,c;(c=(l=n.current.props).onError)===null||c===void 0||c.call(l,a)}),s.on("outofmaxbounds",a=>{var l,c;(c=(l=n.current.props).onOutOfMaxBounds)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationstart",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationStart)===null||c===void 0||c.call(l,a)}),s.on("trackuserlocationend",a=>{var l,c;(c=(l=n.current.props).onTrackUserLocationEnd)===null||c===void 0||c.call(l,a)}),s},{position:t.position});return n.current.props=t,W.useImperativeHandle(e,()=>r,[]),W.useEffect(()=>{Or(r._container,t.style)},[t.style]),null}W.memo(W.forwardRef(FA));function DA(t){const e=xo(({mapLib:n})=>new n.NavigationControl(t),{position:t.position});return W.useEffect(()=>{Or(e._container,t.style)},[t.style]),null}W.memo(DA);function BA(t){const e=xo(({mapLib:s})=>new s.ScaleControl(t),{position:t.position}),n=W.useRef(t),r=n.current;n.current=t;const{style:i}=t;return t.maxWidth!==void 0&&t.maxWidth!==r.maxWidth&&(e.options.maxWidth=t.maxWidth),t.unit!==void 0&&t.unit!==r.unit&&e.setUnit(t.unit),W.useEffect(()=>{Or(e._container,i)},[i]),null}W.memo(BA);const UA=gA(()=>import("./maplibre-gl-fa032e2e.js").then(t=>t.m),[]),LA=(()=>W.forwardRef(function(e,n){return PA(e,n,UA)}))();function wl(t,e){if(!t)throw new Error(e||"loader assertion failed.")}const hp=!!(typeof process!="object"||String(process)!=="[object process]"||process.browser),P_=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);P_&&parseFloat(P_[1]);const ua=globalThis,Vr=globalThis.process||{},zA=globalThis.navigator||{};function IT(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function Fr(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||IT()}function VA(t){return!t&&!Fr()?"Node":IT(t)?"Electron":(t||zA.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown"}const NT="4.0.7";function jA(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}let HA=class{constructor(e,n,r="sessionStorage"){this.storage=jA(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}};function WA(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function $A(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var El;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(El||(El={}));const XA=10;function M_(t){return typeof t!="string"?t:(t=t.toUpperCase(),El[t]||El.WHITE)}function YA(t,e,n){return!Fr&&typeof t=="string"&&(e&&(t=`\x1B[${M_(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${M_(n)+XA}m${t}\x1B[49m`)),t}function KA(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function dp(t,e){if(!t)throw new Error(e||"Assertion failed")}function jr(){var e,n,r;let t;if(Fr()&&ua.performance)t=(n=(e=ua==null?void 0:ua.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Vr){const i=(r=Vr==null?void 0:Vr.hrtime)==null?void 0:r.call(Vr);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Hr={debug:Fr()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},qA={enabled:!0,level:0};function Wr(){}const I_={},N_={once:!0};let Po=class{constructor({id:e}={id:""}){this.VERSION=NT,this._startTs=jr(),this._deltaTs=jr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new HA(`__probe-${this.id}__`,qA),this.timeStamp(`${this.id} started`),KA(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((jr()-this._startTs).toPrecision(10))}getDelta(){return Number((jr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Hr.warn,arguments,N_)}error(e){return this._getLogFunction(0,e,Hr.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Hr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Hr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Hr.debug||Hr.info,arguments,N_)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Wr,r&&[r],{tag:QA(n)}):Wr}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Wr)}group(e,n,r={collapsed:!1}){const i=k_({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Wr)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=kT(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=k_({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,dp(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=jr();const o=s.tag||s.message;if(s.once&&o)if(!I_[o])I_[o]=jr();else return Wr;return n=ZA(this.id,s.message,s),r.bind(console,n,...s.args)}return Wr}};Po.VERSION=NT;function kT(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return dp(Number.isFinite(e)&&e>=0),e}function k_(t){const{logLevel:e,message:n}=t;t.logLevel=kT(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return dp(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function ZA(t,e,n){if(typeof e=="string"){const r=n.time?$A(WA(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=YA(e,n.color,n.background)}return e}function QA(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}function JA(t,e){return OT(t||{},e)}function OT(t,e,n=0){if(n>3)return e;const r={...t};for(const[i,s]of Object.entries(e))s&&typeof s=="object"&&!Array.isArray(s)?r[i]=OT(r[i]||{},e[i],n+1):r[i]=e[i];return r}const GA="latest";function eR(){var t;return(t=globalThis._loadersgl_)!=null&&t.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.1"),globalThis._loadersgl_.version}const tR=eR();function Gn(t,e){if(!t)throw new Error(e||"loaders.gl assertion failed.")}const Tr=typeof process!="object"||String(process)!=="[object process]"||process.browser,nR=typeof window<"u"&&typeof window.orientation<"u",O_=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version);O_&&parseFloat(O_[1]);class rR{constructor(e,n){d(this,"name");d(this,"workerThread");d(this,"isRunning",!0);d(this,"result");d(this,"_resolve",()=>{});d(this,"_reject",()=>{});this.name=e,this.workerThread=n,this.result=new Promise((r,i)=>{this._resolve=r,this._reject=i})}postMessage(e,n){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:n})}done(e){Gn(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Gn(this.isRunning),this.isRunning=!1,this._reject(e)}}class Bu{terminate(){}}const Uu=new Map;function iR(t){Gn(t.source&&!t.url||!t.source&&t.url);let e=Uu.get(t.source||t.url);return e||(t.url&&(e=sR(t.url),Uu.set(t.url,e)),t.source&&(e=FT(t.source),Uu.set(t.source,e))),Gn(e),e}function sR(t){if(!t.startsWith("http"))return t;const e=oR(t);return FT(e)}function FT(t){const e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function oR(t){return`try {
  importScripts('${t}');
} catch (error) {
  console.error(error);
  throw error;
}`}function DT(t,e=!0,n){const r=n||new Set;if(t){if(F_(t))r.add(t);else if(F_(t.buffer))r.add(t.buffer);else if(!ArrayBuffer.isView(t)){if(e&&typeof t=="object")for(const i in t)DT(t[i],e,r)}}return n===void 0?Array.from(r):[]}function F_(t){return t?t instanceof ArrayBuffer||typeof MessagePort<"u"&&t instanceof MessagePort||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas:!1}const Lu=()=>{};class _h{constructor(e){d(this,"name");d(this,"source");d(this,"url");d(this,"terminated",!1);d(this,"worker");d(this,"onMessage");d(this,"onError");d(this,"_loadableURL","");const{name:n,source:r,url:i}=e;Gn(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Lu,this.onError=s=>console.log(s),this.worker=Tr?this._createBrowserWorker():this._createNodeWorker()}static isSupported(){return typeof Worker<"u"&&Tr||typeof Bu<"u"&&!Tr}destroy(){this.onMessage=Lu,this.onError=Lu,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,n){n=n||DT(e),this.worker.postMessage(e,n)}_getErrorFromErrorEvent(e){let n="Failed to load ";return n+=`worker ${this.name} from ${this.url}. `,e.message&&(n+=`${e.message} in `),e.lineno&&(n+=`:${e.lineno}:${e.colno}`),new Error(n)}_createBrowserWorker(){this._loadableURL=iR({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=n=>{n.data?this.onMessage(n.data):this.onError(new Error("No data received"))},e.onerror=n=>{this.onError(this._getErrorFromErrorEvent(n)),this.terminated=!0},e.onmessageerror=n=>console.error(n),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Bu(r,{eval:!1})}else if(this.source)e=new Bu(this.source,{eval:!0});else throw new Error("no worker");return e.on("message",n=>{this.onMessage(n)}),e.on("error",n=>{this.onError(n)}),e.on("exit",n=>{}),e}}class aR{constructor(e){d(this,"name","unnamed");d(this,"source");d(this,"url");d(this,"maxConcurrency",1);d(this,"maxMobileConcurrency",1);d(this,"onDebug",()=>{});d(this,"reuseWorkers",!0);d(this,"props",{});d(this,"jobQueue",[]);d(this,"idleQueue",[]);d(this,"count",0);d(this,"isDestroyed",!1);this.source=e.source,this.url=e.url,this.setProps(e)}static isSupported(){return _h.isSupported()}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},e.name!==void 0&&(this.name=e.name),e.maxConcurrency!==void 0&&(this.maxConcurrency=e.maxConcurrency),e.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=e.maxMobileConcurrency),e.reuseWorkers!==void 0&&(this.reuseWorkers=e.reuseWorkers),e.onDebug!==void 0&&(this.onDebug=e.onDebug)}async startJob(e,n=(i,s,o)=>i.done(o),r=(i,s)=>i.error(s)){const i=new Promise(s=>(this.jobQueue.push({name:e,onMessage:n,onError:r,onStart:s}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const n=this.jobQueue.shift();if(n){this.onDebug({message:"Starting job",name:n.name,workerThread:e,backlog:this.jobQueue.length});const r=new rR(n.name,e);e.onMessage=i=>n.onMessage(r,i.type,i.payload),e.onError=i=>n.onError(r,i),n.onStart(r);try{await r.result}catch(i){console.error(`Worker exception: ${i}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Tr||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new _h({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return nR?this.maxMobileConcurrency:this.maxConcurrency}}const lR={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}},On=class On{constructor(e){d(this,"props");d(this,"workerPools",new Map);this.props={...lR},this.setProps(e),this.workerPools=new Map}static isSupported(){return _h.isSupported()}static getWorkerFarm(e={}){return On._workerFarm=On._workerFarm||new On({}),On._workerFarm.setProps(e),On._workerFarm}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const n of this.workerPools.values())n.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:n,source:r,url:i}=e;let s=this.workerPools.get(n);return s||(s=new aR({name:n,source:r,url:i}),s.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}};d(On,"_workerFarm");let Sl=On;function cR(t,e={}){const n=e[t.id]||{},r=Tr?`${t.id}-worker.js`:`${t.id}-worker-node.js`;let i=n.workerUrl;if(!i&&t.id==="compression"&&(i=e.workerUrl),e._workerType==="test"&&(Tr?i=`modules/${t.module}/dist/${r}`:i=`modules/${t.module}/src/workers/${t.id}-worker-node.ts`),!i){let s=t.version;s==="latest"&&(s=GA);const o=s?`@${s}`:"";i=`https://unpkg.com/@loaders.gl/${t.module}${o}/dist/${r}`}return Gn(i),i}function uR(t,e=tR){Gn(t,"no worker provided");const n=t.version;return!(!e||!n)}function fR(t,e){return!Sl.isSupported()||!Tr&&!(e!=null&&e._nodeWorkers)?!1:t.worker&&(e==null?void 0:e.worker)}async function hR(t,e,n,r,i){const s=t.id,o=cR(t,n),l=Sl.getWorkerFarm(n).getWorkerPool({name:s,url:o});n=JSON.parse(JSON.stringify(n)),r=JSON.parse(JSON.stringify(r||{}));const c=await l.startJob("process-on-worker",dR.bind(null,i));return c.postMessage("process",{input:e,options:n,context:r}),await(await c.result).result}async function dR(t,e,n,r){switch(n){case"done":e.done(r);break;case"error":e.error(new Error(r.error));break;case"process":const{id:i,input:s,options:o}=r;try{const a=await t(s,o);e.postMessage("done",{id:i,result:a})}catch(a){const l=a instanceof Error?a.message:"unknown error";e.postMessage("error",{id:i,error:l})}break;default:console.warn(`parse-with-worker unknown message ${n}`)}}function pR(t,e,n){if(n=n||t.byteLength,t.byteLength<n||e.byteLength<n)return!1;const r=new Uint8Array(t),i=new Uint8Array(e);for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}function gR(...t){return _R(t)}function _R(t){const e=t.map(s=>s instanceof ArrayBuffer?new Uint8Array(s):s),n=e.reduce((s,o)=>s+o.byteLength,0),r=new Uint8Array(n);let i=0;for(const s of e)r.set(s,i),i+=s.byteLength;return r.buffer}async function mR(t){const e=[];for await(const n of t)e.push(n);return gR(...e)}function D_(){let t;if(typeof window<"u"&&window.performance)t=window.performance.now();else if(typeof process<"u"&&process.hrtime){const e=process.hrtime();t=e[0]*1e3+e[1]/1e6}else t=Date.now();return t}class B_{constructor(e,n){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=n,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=D_(),this._timerPending=!0,this}timeEnd(){return this._timerPending?(this.addTime(D_()-this._startTime),this._timerPending=!1,this._checkSampling(),this):this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class Xc{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,n="count"){return this._getOrCreate({name:e,type:n})}get size(){return Object.keys(this.stats).length}reset(){for(const e of Object.values(this.stats))e.reset();return this}forEach(e){for(const n of Object.values(this.stats))e(n)}getTable(){const e={};return this.forEach(n=>{e[n.name]={time:n.time||0,count:n.count||0,average:n.getAverageTime()||0,hz:n.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(n=>this._getOrCreate(n))}_getOrCreate(e){const{name:n,type:r}=e;let i=this.stats[n];return i||(e instanceof B_?i=e:i=new B_(n,r),this.stats[n]=i),i}}let yR="";const U_={};function vR(t){for(const e in U_)if(t.startsWith(e)){const n=U_[e];t=t.replace(e,n)}return!t.startsWith("http://")&&!t.startsWith("https://")&&(t=`${yR}${t}`),t}function TR(t){return t&&typeof t=="object"&&t.isBuffer}function BT(t){if(TR(t))return t;if(t instanceof ArrayBuffer)return t;if(ArrayBuffer.isView(t))return t.byteOffset===0&&t.byteLength===t.buffer.byteLength?t.buffer:t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength);if(typeof t=="string"){const e=t;return new TextEncoder().encode(e).buffer}if(t&&typeof t=="object"&&t._toArrayBuffer)return t._toArrayBuffer();throw new Error("toArrayBuffer")}function UT(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(e+1):""}function wR(t){const e=t?t.lastIndexOf("/"):-1;return e>=0?t.substr(0,e):""}const ER=t=>typeof t=="boolean",Us=t=>typeof t=="function",Mo=t=>t!==null&&typeof t=="object",L_=t=>Mo(t)&&t.constructor==={}.constructor,SR=t=>!!t&&typeof t[Symbol.iterator]=="function",bR=t=>t&&typeof t[Symbol.asyncIterator]=="function",Dr=t=>typeof Response<"u"&&t instanceof Response||t&&t.arrayBuffer&&t.text&&t.json,Br=t=>typeof Blob<"u"&&t instanceof Blob,AR=t=>t&&typeof t=="object"&&t.isBuffer,RR=t=>typeof ReadableStream<"u"&&t instanceof ReadableStream||Mo(t)&&Us(t.tee)&&Us(t.cancel)&&Us(t.getReader),CR=t=>Mo(t)&&Us(t.read)&&Us(t.pipe)&&ER(t.readable),LT=t=>RR(t)||CR(t);class xR extends Error{constructor(n,r){super(n);d(this,"reason");d(this,"url");d(this,"response");this.reason=r.reason,this.url=r.url,this.response=r.response}}const PR=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,MR=/^([-\w.]+\/[-\w.+]+)/;function z_(t,e){return t.toLowerCase()===e.toLowerCase()}function IR(t){const e=MR.exec(t);return e?e[1]:t}function V_(t){const e=PR.exec(t);return e?e[1]:""}const zT=/\?.*/;function NR(t){const e=t.match(zT);return e&&e[0]}function pp(t){return t.replace(zT,"")}function kR(t){if(t.length<50)return t;const e=t.slice(t.length-15);return`${t.substr(0,32)}...${e}`}function Yc(t){return Dr(t)?t.url:Br(t)?t.name||"":typeof t=="string"?t:""}function gp(t){if(Dr(t)){const e=t,n=e.headers.get("content-type")||"",r=pp(e.url);return IR(n)||V_(r)}return Br(t)?t.type||"":typeof t=="string"?V_(t):""}function OR(t){return Dr(t)?t.headers["content-length"]||-1:Br(t)?t.size:typeof t=="string"?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1}async function VT(t){if(Dr(t))return t;const e={},n=OR(t);n>=0&&(e["content-length"]=String(n));const r=Yc(t),i=gp(t);i&&(e["content-type"]=i);const s=await BR(t);s&&(e["x-first-bytes"]=s),typeof t=="string"&&(t=new TextEncoder().encode(t));const o=new Response(t,{headers:e});return Object.defineProperty(o,"url",{value:r}),o}async function FR(t){if(!t.ok)throw await DR(t)}async function DR(t){const e=kR(t.url);let n=`Failed to fetch resource (${t.status}) ${t.statusText}: ${e}`;n=n.length>100?`${n.slice(0,100)}...`:n;const r={reason:t.statusText,url:t.url,response:t};try{const i=t.headers.get("Content-Type");r.reason=i!=null&&i.includes("application/json")?await t.json():t.text()}catch{}return new xR(n,r)}async function BR(t){if(typeof t=="string")return`data:,${t.slice(0,5)}`;if(t instanceof Blob){const n=t.slice(0,5);return await new Promise(r=>{const i=new FileReader;i.onload=s=>{var o;return r((o=s==null?void 0:s.target)==null?void 0:o.result)},i.readAsDataURL(n)})}if(t instanceof ArrayBuffer){const n=t.slice(0,5);return`data:base64,${UR(n)}`}return null}function UR(t){let e="";const n=new Uint8Array(t);for(let r=0;r<n.byteLength;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function LR(t){return!zR(t)&&!VR(t)}function zR(t){return t.startsWith("http:")||t.startsWith("https:")}function VR(t){return t.startsWith("data:")}async function j_(t,e){var n,r;if(typeof t=="string"){const i=vR(t);return LR(i)&&(n=globalThis.loaders)!=null&&n.fetchNode?(r=globalThis.loaders)==null?void 0:r.fetchNode(i,e):await fetch(i,e)}return await VT(t)}const H_=new Po({id:"loaders.gl"});class jR{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class HR{constructor(){d(this,"console");this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}const jT={fetch:null,mimeType:void 0,nothrow:!1,log:new HR,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:hp,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},WR={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function HT(){globalThis.loaders=globalThis.loaders||{};const{loaders:t}=globalThis;return t._state||(t._state={}),t._state}function WT(){const t=HT();return t.globalOptions=t.globalOptions||{...jT},t.globalOptions}function $R(t,e,n,r){return n=n||[],n=Array.isArray(n)?n:[n],XR(t,n),KR(e,t,r)}function XR(t,e){W_(t,null,jT,WR,e);for(const n of e){const r=t&&t[n.id]||{},i=n.options&&n.options[n.id]||{},s=n.deprecatedOptions&&n.deprecatedOptions[n.id]||{};W_(r,n.id,i,s,e)}}function W_(t,e,n,r,i){const s=e||"Top level",o=e?`${e}.`:"";for(const a in t){const l=!e&&Mo(t[a]),c=a==="baseUri"&&!e,u=a==="workerUrl"&&e;if(!(a in n)&&!c&&!u){if(a in r)H_.warn(`${s} loader option '${o}${a}' no longer supported, use '${r[a]}'`)();else if(!l){const f=YR(a,i);H_.warn(`${s} loader option '${o}${a}' not recognized. ${f}`)()}}}}function YR(t,e){const n=t.toLowerCase();let r="";for(const i of e)for(const s in i.options){if(t===s)return`Did you mean '${i.id}.${s}'?`;const o=s.toLowerCase();(n.startsWith(o)||o.startsWith(n))&&(r=r||`Did you mean '${i.id}.${s}'?`)}return r}function KR(t,e,n){const i={...t.options||{}};return qR(i,n),i.log===null&&(i.log=new jR),$_(i,WT()),$_(i,e),i}function $_(t,e){for(const n in e)if(n in e){const r=e[n];L_(r)&&L_(t[n])?t[n]={...t[n],...e[n]}:t[n]=e[n]}}function qR(t,e){e&&!("baseUri"in t)&&(t.baseUri=e)}function _p(t){return t?(Array.isArray(t)&&(t=t[0]),Array.isArray(t==null?void 0:t.extensions)):!1}function mp(t){wl(t,"null loader"),wl(_p(t),"invalid loader");let e;return Array.isArray(t)&&(e=t[1],t=t[0],t={...t,options:{...t.options,...e}}),(t!=null&&t.parseTextSync||t!=null&&t.parseText)&&(t.text=!0),t.text||(t.binary=!0),t}const $T=()=>{const t=HT();return t.loaderRegistry=t.loaderRegistry||[],t.loaderRegistry};function ZR(t){const e=$T();t=Array.isArray(t)?t:[t];for(const n of t){const r=mp(n);e.find(i=>r===i)||e.unshift(r)}}function QR(){return $T()}const JR=new Po({id:"loaders.gl"}),GR=/\.([^.]+)$/;async function e3(t,e=[],n,r){if(!XT(t))return null;let i=X_(t,e,{...n,nothrow:!0},r);if(i)return i;if(Br(t)&&(t=await t.slice(0,10).arrayBuffer(),i=X_(t,e,n,r)),!i&&!(n!=null&&n.nothrow))throw new Error(YT(t));return i}function X_(t,e=[],n,r){if(!XT(t))return null;if(e&&!Array.isArray(e))return mp(e);let i=[];e&&(i=i.concat(e)),n!=null&&n.ignoreRegisteredLoaders||i.push(...QR()),n3(i);const s=t3(t,i,n,r);if(!s&&!(n!=null&&n.nothrow))throw new Error(YT(t));return s}function t3(t,e,n,r){const i=Yc(t),s=gp(t),o=pp(i)||(r==null?void 0:r.url);let a=null,l="";return n!=null&&n.mimeType&&(a=zu(e,n==null?void 0:n.mimeType),l=`match forced by supplied MIME type ${n==null?void 0:n.mimeType}`),a=a||r3(e,o),l=l||(a?`matched url ${o}`:""),a=a||zu(e,s),l=l||(a?`matched MIME type ${s}`:""),a=a||s3(e,t),l=l||(a?`matched initial data ${KT(t)}`:""),n!=null&&n.fallbackMimeType&&(a=a||zu(e,n==null?void 0:n.fallbackMimeType),l=l||(a?`matched fallback MIME type ${s}`:"")),l&&JR.log(1,`selectLoader selected ${a==null?void 0:a.name}: ${l}.`),a}function XT(t){return!(t instanceof Response&&t.status===204)}function YT(t){const e=Yc(t),n=gp(t);let r="No valid loader found (";r+=e?`${UT(e)}, `:"no url provided, ",r+=`MIME type: ${n?`"${n}"`:"not provided"}, `;const i=t?KT(t):"";return r+=i?` first bytes: "${i}"`:"first bytes: not available",r+=")",r}function n3(t){for(const e of t)mp(e)}function r3(t,e){const n=e&&GR.exec(e),r=n&&n[1];return r?i3(t,r):null}function i3(t,e){e=e.toLowerCase();for(const n of t)for(const r of n.extensions)if(r.toLowerCase()===e)return n;return null}function zu(t,e){var n;for(const r of t)if((n=r.mimeTypes)!=null&&n.some(i=>z_(e,i))||z_(e,`application/x.${r.id}`))return r;return null}function s3(t,e){if(!e)return null;for(const n of t)if(typeof e=="string"){if(o3(e,n))return n}else if(ArrayBuffer.isView(e)){if(Y_(e.buffer,e.byteOffset,n))return n}else if(e instanceof ArrayBuffer&&Y_(e,0,n))return n;return null}function o3(t,e){return e.testText?e.testText(t):(Array.isArray(e.tests)?e.tests:[e.tests]).some(r=>t.startsWith(r))}function Y_(t,e,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some(i=>a3(t,e,n,i))}function a3(t,e,n,r){if(r instanceof ArrayBuffer)return pR(r,t,r.byteLength);switch(typeof r){case"function":return r(t);case"string":const i=mh(t,e,r.length);return r===i;default:return!1}}function KT(t,e=5){return typeof t=="string"?t.slice(0,e):ArrayBuffer.isView(t)?mh(t.buffer,t.byteOffset,e):t instanceof ArrayBuffer?mh(t,0,e):""}function mh(t,e,n){if(t.byteLength<e+n)return"";const r=new DataView(t);let i="";for(let s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(e+s));return i}const l3=256*1024;function*c3(t,e){const n=(e==null?void 0:e.chunkSize)||l3;let r=0;const i=new TextEncoder;for(;r<t.length;){const s=Math.min(t.length-r,n),o=t.slice(r,r+s);r+=s,yield i.encode(o)}}const u3=256*1024;function*f3(t,e={}){const{chunkSize:n=u3}=e;let r=0;for(;r<t.byteLength;){const i=Math.min(t.byteLength-r,n),s=new ArrayBuffer(i),o=new Uint8Array(t,r,i);new Uint8Array(s).set(o),r+=i,yield s}}const h3=1024*1024;async function*d3(t,e){const n=(e==null?void 0:e.chunkSize)||h3;let r=0;for(;r<t.size;){const i=r+n,s=await t.slice(r,i).arrayBuffer();r=i,yield s}}function K_(t,e){return hp?p3(t,e):g3(t)}async function*p3(t,e){const n=t.getReader();let r;try{for(;;){const i=r||n.read();e!=null&&e._streamReadAhead&&(r=n.read());const{done:s,value:o}=await i;if(s)return;yield BT(o)}}catch{n.releaseLock()}}async function*g3(t,e){for await(const n of t)yield BT(n)}function _3(t,e){if(typeof t=="string")return c3(t,e);if(t instanceof ArrayBuffer)return f3(t,e);if(Br(t))return d3(t,e);if(LT(t))return K_(t,e);if(Dr(t))return K_(t.body,e);throw new Error("makeIterator")}const qT="Cannot convert supplied data type";function m3(t,e,n){if(e.text&&typeof t=="string")return t;if(AR(t)&&(t=t.buffer),t instanceof ArrayBuffer){const r=t;return e.text&&!e.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(t)){if(e.text&&!e.binary)return new TextDecoder("utf8").decode(t);let r=t.buffer;const i=t.byteLength||t.length;return(t.byteOffset!==0||i!==r.byteLength)&&(r=r.slice(t.byteOffset,t.byteOffset+i)),r}throw new Error(qT)}async function y3(t,e,n){const r=t instanceof ArrayBuffer||ArrayBuffer.isView(t);if(typeof t=="string"||r)return m3(t,e);if(Br(t)&&(t=await VT(t)),Dr(t)){const i=t;return await FR(i),e.binary?await i.arrayBuffer():await i.text()}if(LT(t)&&(t=_3(t,n)),SR(t)||bR(t))return mR(t);throw new Error(qT)}function ZT(t,e){const n=WT(),r=t||n;return typeof r.fetch=="function"?r.fetch:Mo(r.fetch)?i=>j_(i,r.fetch):e!=null&&e.fetch?e==null?void 0:e.fetch:j_}function v3(t,e,n){if(n)return n;const r={fetch:ZT(e,t),...t};if(r.url){const i=pp(r.url);r.baseUrl=i,r.queryString=NR(r.url),r.filename=UT(i),r.baseUrl=wR(i)}return Array.isArray(r.loaders)||(r.loaders=null),r}function T3(t,e){if(t&&!Array.isArray(t))return t;let n;if(t&&(n=Array.isArray(t)?t:[t]),e&&e.loaders){const r=Array.isArray(e.loaders)?e.loaders:[e.loaders];n=n?[...n,...r]:r}return n&&n.length?n:void 0}async function bl(t,e,n,r){e&&!Array.isArray(e)&&!_p(e)&&(r=void 0,n=e,e=void 0),t=await t,n=n||{};const i=Yc(t),o=T3(e,r),a=await e3(t,o,n);return a?(n=$R(n,a,o,i),r=v3({url:i,_parse:bl,loaders:o},n,r||null),await w3(a,t,n,r)):null}async function w3(t,e,n,r){if(uR(t),n=JA(t.options,n),Dr(e)){const s=e,{ok:o,redirected:a,status:l,statusText:c,type:u,url:f}=s,h=Object.fromEntries(s.headers.entries());r.response={headers:h,ok:o,redirected:a,status:l,statusText:c,type:u,url:f}}e=await y3(e,t,n);const i=t;if(i.parseTextSync&&typeof e=="string")return i.parseTextSync(e,n,r);if(fR(t,n))return await hR(t,e,n,r,bl);if(i.parseText&&typeof e=="string")return await i.parseText(e,n,r);if(i.parse)return await i.parse(e,n,r);throw Gn(!i.parseSync),new Error(`${t.id} loader - no parser found and worker is disabled`)}async function Al(t,e,n,r){let i,s;!Array.isArray(e)&&!_p(e)?(i=[],s=e):(i=e,s=n);const o=ZT(s);let a=t;return typeof t=="string"&&(a=await o(t)),Br(t)&&(a=await o(t)),Array.isArray(i)?await bl(a,i,s):await bl(a,i,s)}const E3="4.2.1";var y0;const S3=(y0=globalThis.loaders)==null?void 0:y0.parseImageNode,yh=typeof Image<"u",vh=typeof ImageBitmap<"u",b3=!!S3,Th=hp?!0:b3;function A3(t){switch(t){case"auto":return vh||yh||Th;case"imagebitmap":return vh;case"image":return yh;case"data":return Th;default:throw new Error(`@loaders.gl/images: image ${t} not supported in this environment`)}}function R3(){if(vh)return"imagebitmap";if(yh)return"image";if(Th)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}function C3(t){const e=P3(t);if(!e)throw new Error("Not an image");return e}function x3(t){switch(C3(t)){case"data":return t;case"image":case"imagebitmap":const e=document.createElement("canvas"),n=e.getContext("2d");if(!n)throw new Error("getImageData");return e.width=t.width,e.height=t.height,n.drawImage(t,0,0),n.getImageData(0,0,t.width,t.height);default:throw new Error("getImageData")}}function P3(t){return typeof ImageBitmap<"u"&&t instanceof ImageBitmap?"imagebitmap":typeof Image<"u"&&t instanceof Image?"image":t&&typeof t=="object"&&t.data&&t.width&&t.height?"data":null}const M3=/^data:image\/svg\+xml/,I3=/\.svg((\?|#).*)?$/;function yp(t){return t&&(M3.test(t)||I3.test(t))}function N3(t,e){if(yp(e)){let r=new TextDecoder().decode(t);try{typeof unescape=="function"&&typeof encodeURIComponent=="function"&&(r=unescape(encodeURIComponent(r)))}catch(s){throw new Error(s.message)}return`data:image/svg+xml;base64,${btoa(r)}`}return QT(t,e)}function QT(t,e){if(yp(e))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(t)])}async function JT(t,e,n){const r=N3(t,n),i=self.URL||self.webkitURL,s=typeof r!="string"&&i.createObjectURL(r);try{return await k3(s||r,e)}finally{s&&i.revokeObjectURL(s)}}async function k3(t,e){const n=new Image;return n.src=t,e.image&&e.image.decode&&n.decode?(await n.decode(),n):await new Promise((r,i)=>{try{n.onload=()=>r(n),n.onerror=s=>{const o=s instanceof Error?s.message:"error";i(new Error(o))}}catch(s){i(s)}})}const O3={};let q_=!0;async function F3(t,e,n){let r;yp(n)?r=await JT(t,e,n):r=QT(t,n);const i=e&&e.imagebitmap;return await D3(r,i)}async function D3(t,e=null){if((B3(e)||!q_)&&(e=null),e)try{return await createImageBitmap(t,e)}catch(n){console.warn(n),q_=!1}return await createImageBitmap(t)}function B3(t){for(const e in t||O3)return!1;return!0}function U3(t){return!j3(t,"ftyp",4)||!(t[8]&96)?null:L3(t)}function L3(t){switch(z3(t,8,12).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}function z3(t,e,n){return String.fromCharCode(...t.slice(e,n))}function V3(t){return[...t].map(e=>e.charCodeAt(0))}function j3(t,e,n=0){const r=V3(e);for(let i=0;i<r.length;++i)if(r[i]!==t[i+n])return!1;return!0}const Jt=!1,Ls=!0;function GT(t){const e=Io(t);return W3(e)||Y3(e)||$3(e)||X3(e)||H3(e)}function H3(t){const e=new Uint8Array(t instanceof DataView?t.buffer:t),n=U3(e);return n?{mimeType:n.mimeType,width:0,height:0}:null}function W3(t){const e=Io(t);return e.byteLength>=24&&e.getUint32(0,Jt)===2303741511?{mimeType:"image/png",width:e.getUint32(16,Jt),height:e.getUint32(20,Jt)}:null}function $3(t){const e=Io(t);return e.byteLength>=10&&e.getUint32(0,Jt)===1195984440?{mimeType:"image/gif",width:e.getUint16(6,Ls),height:e.getUint16(8,Ls)}:null}function X3(t){const e=Io(t);return e.byteLength>=14&&e.getUint16(0,Jt)===16973&&e.getUint32(2,Ls)===e.byteLength?{mimeType:"image/bmp",width:e.getUint32(18,Ls),height:e.getUint32(22,Ls)}:null}function Y3(t){const e=Io(t);if(!(e.byteLength>=3&&e.getUint16(0,Jt)===65496&&e.getUint8(2)===255))return null;const{tableMarkers:r,sofMarkers:i}=K3();let s=2;for(;s+9<e.byteLength;){const o=e.getUint16(s,Jt);if(i.has(o))return{mimeType:"image/jpeg",height:e.getUint16(s+5,Jt),width:e.getUint16(s+7,Jt)};if(!r.has(o))return null;s+=2,s+=e.getUint16(s,Jt)}return null}function K3(){const t=new Set([65499,65476,65484,65501,65534]);for(let n=65504;n<65520;++n)t.add(n);return{tableMarkers:t,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}function Io(t){if(t instanceof DataView)return t;if(ArrayBuffer.isView(t))return new DataView(t.buffer);if(t instanceof ArrayBuffer)return new DataView(t);throw new Error("toDataView")}async function q3(t,e){var i;const{mimeType:n}=GT(t)||{},r=(i=globalThis.loaders)==null?void 0:i.parseImageNode;return wl(r),await r(t,n)}async function Z3(t,e,n){e=e||{};const i=(e.image||{}).type||"auto",{url:s}=n||{},o=Q3(i);let a;switch(o){case"imagebitmap":a=await F3(t,e,s);break;case"image":a=await JT(t,e,s);break;case"data":a=await q3(t);break;default:wl(!1)}return i==="data"&&(a=x3(a)),a}function Q3(t){switch(t){case"auto":case"data":return R3();default:return A3(t),t}}const J3=["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],G3=["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],eC={image:{type:"auto",decode:!0}},tC={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:E3,mimeTypes:G3,extensions:J3,parse:Z3,tests:[t=>!!GT(new DataView(t))],options:eC},nC=new Po({id:"deck"}),ne=nC;let wh={};function rC(t){wh=t}function $e(t,e,n,r){ne.level>0&&wh[t]&&wh[t].call(null,e,n,r)}function iC(t){const e=t[0],n=t[t.length-1];return e==="{"&&n==="}"||e==="["&&n==="]"}const sC={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:iC,parseTextSync:JSON.parse};function oC(){const t="9.1.0-alpha.0",e=globalThis.deck&&globalThis.deck.VERSION;if(e&&e!==t)throw new Error(`deck.gl - multiple versions detected: ${e} vs ${t}`);return e||(ne.log(1,`deck.gl ${t}`)(),globalThis.deck={...globalThis.deck,VERSION:t,version:t,log:ne,_registerLoggers:rC},ZR([sC,[tC,{imagebitmap:{premultiplyAlpha:"none"}}]])),t}const aC=oC();function vp(t,e){if(!t)throw new Error(e||"shadertools: assertion failed.")}const Vu={number:{type:"number",validate(t,e){return Number.isFinite(t)&&typeof e=="object"&&(e.max===void 0||t<=e.max)&&(e.min===void 0||t>=e.min)}},array:{type:"array",validate(t,e){return Array.isArray(t)||ArrayBuffer.isView(t)}}};function lC(t){const e={};for(const[n,r]of Object.entries(t))e[n]=cC(r);return e}function cC(t){let e=Z_(t);if(e!=="object")return{value:t,...Vu[e],type:e};if(typeof t=="object")return t?t.type!==void 0?{...t,...Vu[t.type],type:t.type}:t.value===void 0?{type:"object",value:t}:(e=Z_(t.value),{...t,...Vu[e],type:e}):{type:"object",value:null};throw new Error("props")}function Z_(t){return Array.isArray(t)||ArrayBuffer.isView(t)?"array":typeof t}const uC=`#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fC=`#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`,hC={vertex:uC,fragment:fC},Q_=/void\s+main\s*\([^)]*\)\s*\{\n?/,J_=/}\n?[^{}]*$/,ju=[],Xa="__LUMA_INJECT_DECLARATIONS__";function dC(t){const e={vertex:{},fragment:{}};for(const n in t){let r=t[n];const i=pC(n);typeof r=="string"&&(r={order:0,injection:r}),e[i][n]=r}return e}function pC(t){const e=t.slice(0,2);switch(e){case"vs":return"vertex";case"fs":return"fragment";default:throw new Error(e)}}function Rl(t,e,n,r=!1){const i=e==="vertex";for(const s in n){const o=n[s];o.sort((l,c)=>l.order-c.order),ju.length=o.length;for(let l=0,c=o.length;l<c;++l)ju[l]=o[l].injection;const a=`${ju.join(`
`)}
`;switch(s){case"vs:#decl":i&&(t=t.replace(Xa,a));break;case"vs:#main-start":i&&(t=t.replace(Q_,l=>l+a));break;case"vs:#main-end":i&&(t=t.replace(J_,l=>a+l));break;case"fs:#decl":i||(t=t.replace(Xa,a));break;case"fs:#main-start":i||(t=t.replace(Q_,l=>l+a));break;case"fs:#main-end":i||(t=t.replace(J_,l=>a+l));break;default:t=t.replace(s,l=>l+a)}}return t=t.replace(Xa,""),r&&(t=t.replace(/\}\s*$/,s=>s+hC[e])),t}function Cl(t){t.map(e=>gC(e))}function gC(t){if(t.instance)return;Cl(t.dependencies||[]);const{propTypes:e={},deprecations:n=[],inject:r={}}=t,i={normalizedInjections:dC(r),parsedDeprecations:_C(n)};e&&(i.propValidators=lC(e)),t.instance=i;let s={};e&&(s=Object.entries(e).reduce((o,[a,l])=>{const c=l==null?void 0:l.value;return c&&(o[a]=c),o},{})),t.defaultUniforms={...t.defaultUniforms,...s}}function ew(t,e,n){var r;(r=t.deprecations)==null||r.forEach(i=>{var s;(s=i.regex)!=null&&s.test(e)&&(i.deprecated?n.deprecated(i.old,i.new)():n.removed(i.old,i.new)())})}function _C(t){return t.forEach(e=>{switch(e.type){case"function":e.regex=new RegExp(`\\b${e.old}\\(`);break;default:e.regex=new RegExp(`${e.type} ${e.old};`)}}),t}function Tp(t){Cl(t);const e={},n={};tw({modules:t,level:0,moduleMap:e,moduleDepth:n});const r=Object.keys(n).sort((i,s)=>n[s]-n[i]).map(i=>e[i]);return Cl(r),r}function tw(t){const{modules:e,level:n,moduleMap:r,moduleDepth:i}=t;if(n>=5)throw new Error("Possible loop in shader dependency graph");for(const s of e)r[s.name]=s,(i[s.name]===void 0||i[s.name]<n)&&(i[s.name]=n);for(const s of e)s.dependencies&&tw({modules:s.dependencies,level:n+1,moduleMap:r,moduleDepth:i})}function mC(t){switch(t==null?void 0:t.gpu.toLowerCase()){case"apple":return`#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`#define AMD_GPU
`;default:return`#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}function yC(t,e){var r;if(Number(((r=t.match(/^#version[ \t]+(\d+)/m))==null?void 0:r[1])||100)!==300)throw new Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(e){case"vertex":return t=G_(t,vC),t;case"fragment":return t=G_(t,TC),t;default:throw new Error(e)}}const nw=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,`#version 300 es
`],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],vC=[...nw,[Eh("attribute"),"in $1"],[Eh("varying"),"out $1"]],TC=[...nw,[Eh("varying"),"in $1"]];function G_(t,e){for(const[n,r]of e)t=t.replace(n,r);return t}function Eh(t){return new RegExp(`\\b${t}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function rw(t,e){let n="";for(const r in t){const i=t[r];if(n+=`void ${i.signature} {
`,i.header&&(n+=`  ${i.header}`),e[r]){const s=e[r];s.sort((o,a)=>o.order-a.order);for(const o of s)n+=`  ${o.injection}
`}i.footer&&(n+=`  ${i.footer}`),n+=`}
`}return n}function iw(t){const e={vertex:{},fragment:{}};for(const n of t){let r,i;typeof n!="string"?(r=n,i=r.hook):(r={},i=n),i=i.trim();const[s,o]=i.split(":"),a=i.replace(/\(.+/,""),l=Object.assign(r,{signature:o});switch(s){case"vs":e.vertex[a]=l;break;case"fs":e.fragment[a]=l;break;default:throw new Error(s)}}return e}function wC(t,e){return{name:EC(t,e),language:"glsl",version:SC(t)}}function EC(t,e="unnamed"){const r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(t);return r?r[1]:e}function SC(t){let e=100;const n=t.match(/[^\s]+/g);if(n&&n.length>=2&&n[0]==="#version"){const r=parseInt(n[1],10);Number.isFinite(r)&&(e=r)}if(e!==100&&e!==300)throw new Error(`Invalid GLSL version ${e}`);return e}const sw=`

${Xa}
`,bC=`precision highp float;
`;function AC(t){const e=Tp(t.modules||[]);return{source:CC(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:e}),getUniforms:ow(e)}}function RC(t){const{vs:e,fs:n}=t,r=Tp(t.modules||[]);return{vs:em(t.platformInfo,{...t,source:e,stage:"vertex",modules:r}),fs:em(t.platformInfo,{...t,source:n,stage:"fragment",modules:r}),getUniforms:ow(r)}}function CC(t,e){var E;const{source:n,stage:r,modules:i,hookFunctions:s=[],inject:o={},log:a}=e;vp(typeof n=="string","shader source must be a string");const l=n;let c="";const u=iw(s),f={},h={},_={};for(const b in o){const g=typeof o[b]=="string"?{injection:o[b],order:0}:o[b],p=/^(v|f)s:(#)?([\w-]+)$/.exec(b);if(p){const y=p[2],S=p[3];y?S==="decl"?h[b]=[g]:_[b]=[g]:f[b]=[g]}else _[b]=[g]}const v=i;for(const b of v){a&&ew(b,l,a);const g=aw(b,"wgsl");c+=g;const p=((E=b.injections)==null?void 0:E[r])||{};for(const y in p){const S=/^(v|f)s:#([\w-]+)$/.exec(y);if(S){const P=S[2]==="decl"?h:_;P[y]=P[y]||[],P[y].push(p[y])}else f[y]=f[y]||[],f[y].push(p[y])}}return c+=sw,c=Rl(c,r,h),c+=rw(u[r],f),c+=l,c=Rl(c,r,_),c}function em(t,e){var O;const{id:n,source:r,stage:i,language:s="glsl",modules:o,defines:a={},hookFunctions:l=[],inject:c={},prologue:u=!0,log:f}=e;vp(typeof r=="string","shader source must be a string");const h=s==="glsl"?wC(r).version:-1,_=t.shaderLanguageVersion,v=h===100?"#version 100":"#version 300 es",b=r.split(`
`).slice(1).join(`
`),g={};o.forEach(M=>{Object.assign(g,M.defines)}),Object.assign(g,a);let p="";switch(s){case"wgsl":break;case"glsl":p=u?`${v}

// ----- PROLOGUE -------------------------
${xC({id:n,source:r,stage:i})}
${`#define SHADER_TYPE_${i.toUpperCase()}`}

${mC(t)}
${i==="fragment"?bC:""}

// ----- APPLICATION DEFINES -------------------------

${PC(g)}

`:`${v}
`;break}const y=iw(l),S={},R={},P={};for(const M in c){const k=typeof c[M]=="string"?{injection:c[M],order:0}:c[M],D=/^(v|f)s:(#)?([\w-]+)$/.exec(M);if(D){const F=D[2],B=D[3];F?B==="decl"?R[M]=[k]:P[M]=[k]:S[M]=[k]}else P[M]=[k]}for(const M of o){f&&ew(M,b,f);const k=aw(M,i);p+=k;const D=((O=M.instance)==null?void 0:O.normalizedInjections[i])||{};for(const F in D){const B=/^(v|f)s:#([\w-]+)$/.exec(F);if(B){const H=B[2]==="decl"?R:P;H[F]=H[F]||[],H[F].push(D[F])}else S[F]=S[F]||[],S[F].push(D[F])}}return p+="// ----- MAIN SHADER SOURCE -------------------------",p+=sw,p=Rl(p,i,R),p+=rw(y[i],S),p+=b,p=Rl(p,i,P),s==="glsl"&&h!==_&&(p=yC(p,i)),p.trim()}function ow(t){return function(n){var i;const r={};for(const s of t){const o=(i=s.getUniforms)==null?void 0:i.call(s,n,r);Object.assign(r,o)}return r}}function xC(t){const{id:e,source:n,stage:r}=t;return e&&n.indexOf("SHADER_NAME")===-1?`
#define SHADER_NAME ${e}_${r}`:""}function PC(t={}){let e="";for(const n in t){const r=t[n];(r||Number.isFinite(r))&&(e+=`#define ${n.toUpperCase()} ${t[n]}
`)}return e}function aw(t,e){let n;switch(e){case"vertex":n=t.vs||"";break;case"fragment":n=t.fs||"";break;case"wgsl":n=t.source||"";break;default:vp(!1)}if(!t.name)throw new Error("Shader module must have a name");const r=t.name.toUpperCase().replace(/[^0-9a-z]/gi,"_");let i=`// ----- MODULE ${t.name} ---------------

`;return e!=="wgsl"&&(i+=`#define MODULE_${r}
`),i+=`${n}
`,i}const MC=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,IC=/^\s*\#\s*endif\s*$/;function NC(t,e){var o;const n=t.split(`
`),r=[];let i=!0,s=null;for(const a of n){const l=a.match(MC),c=a.match(IC);l?(s=l[1],i=!!((o=e==null?void 0:e.defines)!=null&&o[s])):c?i=!0:i&&r.push(a)}return r.join(`
`)}const hr=class hr{constructor(){d(this,"_hookFunctions",[]);d(this,"_defaultModules",[])}static getDefaultShaderAssembler(){return hr.defaultShaderAssembler=hr.defaultShaderAssembler||new hr,hr.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(n=>n.name===(typeof e=="string"?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){const n=typeof e=="string"?e:e.name;this._defaultModules=this._defaultModules.filter(r=>r.name!==n)}addShaderHook(e,n){n&&(e=Object.assign(n,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){const n=this._getModuleList(e.modules),r=this._hookFunctions,{source:i,getUniforms:s}=AC({...e,source:e.source,modules:n,hookFunctions:r});return{source:e.platformInfo.shaderLanguage==="wgsl"?NC(i):i,getUniforms:s,modules:n}}assembleGLSLShaderPair(e){const n=this._getModuleList(e.modules),r=this._hookFunctions;return{...RC({...e,vs:e.vs,fs:e.fs,modules:n,hookFunctions:r}),modules:n}}_getModuleList(e=[]){const n=new Array(this._defaultModules.length+e.length),r={};let i=0;for(let s=0,o=this._defaultModules.length;s<o;++s){const a=this._defaultModules[s],l=a.name;n[i++]=a,r[l]=!0}for(let s=0,o=e.length;s<o;++s){const a=e[s],l=a.name;r[l]||(n[i++]=a,r[l]=!0)}return n.length=i,Cl(n),n}};d(hr,"defaultShaderAssembler");let xl=hr;const kC=`out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,OC=`#version 300 es
${kC}`;function FC(t){const{input:e,inputChannels:n,output:r}=t||{};if(!e)return OC;if(!n)throw new Error("inputChannels");const i=DC(n),s=BC(e,n);return`#version 300 es
in ${i} ${e};
out vec4 ${r};
void main() {
  ${r} = ${s};
}`}function DC(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`invalid channels: ${t}`)}}function BC(t,e){switch(e){case 1:return`vec4(${t}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${t}, 0.0, 1.0)`;case 3:return`vec4(${t}, 1.0)`;case 4:return t;default:throw new Error(`invalid channels: ${e}`)}}class UC{constructor(){d(this,"stats",new Map)}getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new Xc({id:e})),this.stats.get(e)}}const lw=new UC,z=new Po({id:"luma.gl"}),Hu={};function wp(t="id"){Hu[t]=Hu[t]||1;const e=Hu[t]++;return`${t}-${e}`}var Ef;let oe=(Ef=class{constructor(e,n,r){d(this,"id");d(this,"props");d(this,"userData",{});d(this,"_device");d(this,"destroyed",!1);d(this,"allocatedBytes",0);d(this,"_attachedResources",new Set);if(!e)throw new Error("no device");this._device=e,this.props=LC(n,r);const i=this.props.id!=="undefined"?this.props.id:wp(this[Symbol.toStringTag]);this.props.id=i,this.id=i,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(const e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get(`${n}s Active`).decrementCount()}trackAllocatedMemory(e,n=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${n} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){const n=this._device.statsManager.getStats("Resource Counts");n.get("GPU Memory").subtractCount(this.allocatedBytes),n.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const e=this._device.statsManager.getStats("Resource Counts"),n=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${n}s Created`).incrementCount(),e.get(`${n}s Active`).incrementCount()}},d(Ef,"defaultProps",{id:"undefined",handle:void 0,userData:void 0}),Ef);function LC(t,e){const n={...e};for(const r in t)t[r]!==void 0&&(n[r]=t[r]);return n}const Fe=class Fe extends oe{constructor(n,r){const i={...r};(r.usage||0)&Fe.INDEX&&!r.indexType&&(r.data instanceof Uint32Array?i.indexType="uint32":r.data instanceof Uint16Array&&(i.indexType="uint16")),delete i.data;super(n,i,Fe.defaultProps);d(this,"usage");d(this,"indexType");d(this,"updateTimestamp");d(this,"debugData",new ArrayBuffer(0));this.usage=i.usage||0,this.indexType=i.indexType,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Buffer"}clone(n){return this.device.createBuffer({...this.props,...n})}readSyncWebGL(n,r){throw new Error("not implemented")}_setDebugData(n,r,i){const s=ArrayBuffer.isView(n)?n.buffer:n,o=Math.min(n?n.byteLength:i,Fe.DEBUG_DATA_MAX_LENGTH);s===null?this.debugData=new ArrayBuffer(o):r===0&&i===s.byteLength?this.debugData=s.slice(0,o):this.debugData=s.slice(r,r+o)}};d(Fe,"defaultProps",{...oe.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1}),d(Fe,"MAP_READ",1),d(Fe,"MAP_WRITE",2),d(Fe,"COPY_SRC",4),d(Fe,"COPY_DST",8),d(Fe,"INDEX",16),d(Fe,"VERTEX",32),d(Fe,"UNIFORM",64),d(Fe,"STORAGE",128),d(Fe,"INDIRECT",256),d(Fe,"QUERY_RESOLVE",512),d(Fe,"DEBUG_DATA_MAX_LENGTH",32);let ge=Fe;function cw(t){const e=tm[t],n=zC(e),r=t.includes("norm"),i=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:tm[t],byteLength:n,integer:i,signed:s,normalized:r}}function zC(t){return VC[t]}const tm={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},VC={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},He="texture-compression-bc",ie="texture-compression-astc",$t="texture-compression-etc2",jC="texture-compression-etc1-webgl",fa="texture-compression-pvrtc-webgl",Wu="texture-compression-atc-webgl",ha="float32-renderable-webgl",$u="float16-renderable-webgl",HC="rgb9e5ufloat_renderable-webgl",Xu="snorm8-renderable-webgl",ps="norm16-renderable-webgl",Yu="snorm16-renderable-webgl",da="float32-filterable",nm="float16-filterable-webgl",WC={r8unorm:{bpp:1,c:1},r8snorm:{bpp:1,c:1,render:Xu},r8uint:{bpp:1,c:1},r8sint:{bpp:1,c:1},rg8unorm:{bpp:2,c:2},rg8snorm:{bpp:2,c:2,render:Xu},rg8uint:{bpp:2,c:2},rg8sint:{bpp:2,c:2},r16uint:{bpp:2,c:1},r16sint:{bpp:2,c:1},r16float:{bpp:2,c:1,render:$u,filter:"float16-filterable-webgl"},"r16unorm-webgl":{b:2,c:1,f:ps},"r16snorm-webgl":{b:2,c:1,f:Yu},"rgba4unorm-webgl":{channels:"rgba",bpp:2,bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bpp:2,bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bpp:2,bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{bpp:3,c:3,wgpu:!1},"rgb8snorm-webgl":{bpp:3,c:3,wgpu:!1},rgba8unorm:{c:2,bpp:4,bitsPerChannel:[8,8,8,8]},"rgba8unorm-srgb":{c:4,bpp:4,bitsPerChannel:[8,8,8,8]},rgba8snorm:{bpp:4,c:4,bitsPerChannel:[8,8,8,8],render:Xu},rgba8uint:{c:4,bpp:4,bitsPerChannel:[8,8,8,8]},rgba8sint:{c:4,bpp:4,bitsPerChannel:[8,8,8,8]},bgra8unorm:{bpp:4,c:4},"bgra8unorm-srgb":{bpp:4,c:4},rg16uint:{c:1,bpp:4},rg16sint:{c:2,bpp:4},rg16float:{c:2,bpp:4,render:$u,filter:nm},"rg16unorm-webgl":{b:2,c:2,render:ps},"rg16snorm-webgl":{b:2,c:2,render:Yu},r32uint:{c:1,bpp:4},r32sint:{c:1,bpp:4},r32float:{c:1,bpp:4,render:ha,filter:da},rgb9e5ufloat:{channels:"rgb",packed:!0,c:3,bpp:4,p:1,render:HC},rg11b10ufloat:{channels:"rgb",c:3,bpp:4,bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:ha},rgb10a2unorm:{channels:"rgba",c:4,bpp:4,bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",c:4,bpp:4,bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{b:2,c:3,f:ps},"rgb16snorm-webgl":{b:2,c:3,f:ps},rg32uint:{bpp:8,c:2,bitsPerChannel:[32,32,0,0]},rg32sint:{bpp:8,c:2,bitsPerChannel:[32,32,0,0]},rg32float:{bpp:8,c:2,bitsPerChannel:[32,32,0,0],render:!1,filter:da},rgba16uint:{bpp:8,c:4},rgba16sint:{bpp:8,c:4},rgba16float:{bpp:8,c:4,render:$u,filter:nm},"rgba16unorm-webgl":{b:2,c:4,render:ps},"rgba16snorm-webgl":{b:2,c:4,render:Yu},"rgb32float-webgl":{render:ha,filter:da},rgba32uint:{bpp:16,c:4},rgba32sint:{bpp:16,c:4},rgba32float:{bpp:16,c:4,render:ha,filter:da},stencil8:{attachment:"stencil",c:1,bpp:1,components:1,bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",c:1,bpp:2,components:1,bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",c:1,bpp:3,components:1,bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",c:1,bpp:4,components:1,bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bpp:4,c:2,p:1,components:2,bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",components:2,c:2,bpp:5,bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:He},"bc1-rgb-unorm-srgb-webgl":{f:He},"bc1-rgba-unorm":{f:He},"bc1-rgba-unorm-srgb":{f:He},"bc2-rgba-unorm":{f:He},"bc2-rgba-unorm-srgb":{f:He},"bc3-rgba-unorm":{f:He},"bc3-rgba-unorm-srgb":{f:He},"bc4-r-unorm":{f:He},"bc4-r-snorm":{f:He},"bc5-rg-unorm":{f:He},"bc5-rg-snorm":{f:He},"bc6h-rgb-ufloat":{f:He},"bc6h-rgb-float":{f:He},"bc7-rgba-unorm":{f:He},"bc7-rgba-unorm-srgb":{f:He},"etc2-rgb8unorm":{f:$t},"etc2-rgb8unorm-srgb":{f:$t},"etc2-rgb8a1unorm":{f:$t},"etc2-rgb8a1unorm-srgb":{f:$t},"etc2-rgba8unorm":{f:$t},"etc2-rgba8unorm-srgb":{f:$t},"eac-r11unorm":{f:$t},"eac-r11snorm":{f:$t},"eac-rg11unorm":{f:$t},"eac-rg11snorm":{f:$t},"astc-4x4-unorm":{f:ie},"astc-4x4-unorm-srgb":{f:ie},"astc-5x4-unorm":{f:ie},"astc-5x4-unorm-srgb":{f:ie},"astc-5x5-unorm":{f:ie},"astc-5x5-unorm-srgb":{f:ie},"astc-6x5-unorm":{f:ie},"astc-6x5-unorm-srgb":{f:ie},"astc-6x6-unorm":{f:ie},"astc-6x6-unorm-srgb":{f:ie},"astc-8x5-unorm":{f:ie},"astc-8x5-unorm-srgb":{f:ie},"astc-8x6-unorm":{f:ie},"astc-8x6-unorm-srgb":{f:ie},"astc-8x8-unorm":{f:ie},"astc-8x8-unorm-srgb":{f:ie},"astc-10x5-unorm":{f:ie},"astc-10x5-unorm-srgb":{f:ie},"astc-10x6-unorm":{f:ie},"astc-10x6-unorm-srgb":{f:ie},"astc-10x8-unorm":{f:ie},"astc-10x8-unorm-srgb":{f:ie},"astc-10x10-unorm":{f:ie},"astc-10x10-unorm-srgb":{f:ie},"astc-12x10-unorm":{f:ie},"astc-12x10-unorm-srgb":{f:ie},"astc-12x12-unorm":{f:ie},"astc-12x12-unorm-srgb":{f:ie},"pvrtc-rgb4unorm-webgl":{f:fa},"pvrtc-rgba4unorm-webgl":{f:fa},"pvrtc-rbg2unorm-webgl":{f:fa},"pvrtc-rgba2unorm-webgl":{f:fa},"etc1-rbg-unorm-webgl":{f:jC},"atc-rgb-unorm-webgl":{f:Wu},"atc-rgba-unorm-webgl":{f:Wu},"atc-rgbai-unorm-webgl":{f:Wu}},$C=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],XC=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function uw(t){return $C.some(e=>t.startsWith(e))}function fw(t){if(uw(t))return YC(t);const e=XC.exec(t);if(!e)return KC(t);const[,n,r,i,s,o]=e,a=`${i}${r}`,l=cw(a),c=l.byteLength*8,u=n.length,f=[c,u>=2?c:0,u>=3?c:0,u>=4?c:0],h={format:t,channels:n,components:u,bitsPerChannel:f,bytesPerPixel:l.byteLength*n.length,dataType:l.dataType,integer:l.integer,signed:l.signed,normalized:l.normalized};return o==="-webgl"&&(h.webgl=!0),s==="-srgb"&&(h.srgb=!0),h}function YC(t){const e={channels:"rgb",components:3,bytesPerPixel:1,srgb:!1,compressed:!0},n=qC(t);return n&&(e.blockWidth=n.blockWidth,e.blockHeight=n.blockHeight),e}function KC(t){var r;const e=WC[t];if(!e)throw new Error(`Unknown format ${t}`);const n={...e,channels:e.channels||"",components:e.components||((r=e.channels)==null?void 0:r.length)||1,bytesPerPixel:e.bytesPerPixel||1,srgb:!1};return e.packed&&(n.packed=e.packed),n}function qC(t){const n=/.*-(\d+)x(\d+)-.*/.exec(t);if(n){const[,r,i]=n;return{blockWidth:Number(r),blockHeight:Number(i)}}return null}class ZC{}class QC{constructor(e=[],n){d(this,"features");d(this,"disabledFeatures");this.features=new Set(e),this.disabledFeatures=n||{}}*[Symbol.iterator](){yield*this.features}has(e){var n;return!((n=this.disabledFeatures)!=null&&n[e])&&this.features.has(e)}}const sc=class sc{constructor(e){d(this,"id");d(this,"props");d(this,"userData",{});d(this,"statsManager",lw);d(this,"timestamp",0);d(this,"_lumaData",{});this.props={...sc.defaultProps,...e},this.id=this.props.id||wp(this[Symbol.toStringTag].toLowerCase())}get[Symbol.toStringTag](){return"Device"}isTextureFormatCompressed(e){return uw(e)}loseDevice(){return!1}error(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw new Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw new Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,n){throw new Error("not implemented")}readPixelsToBufferWebGL(e,n){throw new Error("not implemented")}setParametersWebGL(e){throw new Error("not implemented")}getParametersWebGL(e){throw new Error("not implemented")}withParametersWebGL(e,n){throw new Error("not implemented")}clearWebGL(e){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});const n={...e};return(e.usage||0)&ge.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?n.indexType="uint32":e.data instanceof Uint16Array?n.indexType="uint16":z.warn("indices buffer content must be of integer type")()),n}};d(sc,"defaultProps",{id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>z.error(e.message),_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:z.get("debug")||void 0,debugShaders:z.get("debug-shaders")||void 0,debugFramebuffers:!!z.get("debug-framebuffers"),debugWebGL:!!z.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0});let wr=sc;const JC=Fr()&&typeof document<"u",GC=()=>JC&&document.readyState==="complete",ex="set luma.log.level=1 (or higher) to trace rendering",rm="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.",Fn=class Fn{constructor(){d(this,"stats",lw);d(this,"log",z);d(this,"VERSION","9.1.0-alpha.19");d(this,"spector");d(this,"preregisteredAdapters",new Map);if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw z.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),z.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),new Error("luma.gl - multiple versions detected: see console log");z.error("This version of luma.gl has already been initialized")()}z.log(1,`${this.VERSION} - ${ex}`)(),globalThis.luma=this}registerAdapters(e){for(const n of e)this.preregisteredAdapters.set(n.type,n)}getSupportedAdapters(e=[]){const n=this.getAdapterMap(e);return Array.from(n).map(([,r])=>r).filter(r=>{var i;return(i=r.isSupported)==null?void 0:i.call(r)}).map(r=>r.type)}getBestAvailableAdapter(e=[]){var r,i,s,o;const n=this.getAdapterMap(e);return(i=(r=n.get("webgpu"))==null?void 0:r.isSupported)!=null&&i.call(r)?"webgpu":(o=(s=n.get("webgl"))==null?void 0:s.isSupported)!=null&&o.call(s)?"webgl":null}setDefaultDeviceProps(e){Object.assign(Fn.defaultProps,e)}async createDevice(e={}){var a;e={...Fn.defaultProps,...e},e.waitForPageLoad&&await Fn.pageLoaded;const n=this.getAdapterMap(e.adapters);let r=e.type||"";r==="best-available"&&(r=this.getBestAvailableAdapter(e.adapters)||r);const s=(this.getAdapterMap(e.adapters)||n).get(r),o=await((a=s==null?void 0:s.create)==null?void 0:a.call(s,e));if(o)return o;throw new Error(rm)}async attachDevice(e){var o;const n=this.getAdapterMap(e.adapters);let r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await Fn.pageLoaded,e.handle===null&&(r="unknown");const i=n.get(r),s=await((o=i==null?void 0:i.attach)==null?void 0:o.call(i,null));if(s)return s;throw new Error(rm)}enforceWebGL2(e=!0,n=[]){var s;const i=this.getAdapterMap(n).get("webgl");i||z.warn("enforceWebGL2: webgl adapter not found")(),(s=i==null?void 0:i.enforceWebGL2)==null||s.call(i,e)}getAdapterMap(e=[]){const n=new Map(this.preregisteredAdapters);for(const r of e)n.set(r.type,r);return n}registerDevices(e){z.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead");for(const n of e){const r=n.adapter;r&&this.preregisteredAdapters.set(r.type,r)}}};d(Fn,"defaultProps",{...wr.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0}),d(Fn,"pageLoaded",tx().then(()=>{z.probe(2,"DOM is loaded")()}));let Sh=Fn;const bh=new Sh;function tx(){return GC()||typeof window>"u"?Promise.resolve():new Promise(t=>{window.addEventListener("load",()=>t())})}class nx{}const oc=class oc{constructor(e){d(this,"id");d(this,"props");d(this,"canvas");d(this,"htmlCanvas");d(this,"offscreenCanvas");d(this,"type");d(this,"width",1);d(this,"height",1);d(this,"resizeObserver");d(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});if(this.props={...oc.defaultProps,...e},e=this.props,!Fr()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)typeof e.canvas=="string"?this.canvas=ix(e.canvas):this.canvas=e.canvas;else{const n=sx(e),r=rx((e==null?void 0:e.container)||null);r.insertBefore(n,r.firstChild),this.canvas=n,e!=null&&e.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(n=>{for(const r of n)r.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return typeof OffscreenCanvas<"u"&&this.canvas instanceof OffscreenCanvas||(e=e===void 0?this.props.useDevicePixels:e,!e||e<=0)?1:e===!0?typeof window<"u"&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const e=this.getDevicePixelRatio(),n=this.canvas;return n.parentElement?[n.clientWidth*e,n.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[e,n]=this.getPixelSize();return e/n}cssToDeviceRatio(){try{const[e]=this.getDrawingBufferSize(),{clientWidth:n}=this._canvasSizeInfo;return n?e/n:1}catch{return 1}}cssToDevicePixels(e,n=!0){const r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return ox(e,r,i,s,n)}setDevicePixelRatio(e,n={}){if(!this.htmlCanvas)return;let r="width"in n?n.width:this.htmlCanvas.clientWidth,i="height"in n?n.height:this.htmlCanvas.clientHeight;(!r||!i)&&(z.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);const s=this._canvasSizeInfo;if(s.clientWidth!==r||s.clientHeight!==i||s.devicePixelRatio!==e){let o=e;const a=Math.floor(r*o),l=Math.floor(i*o);if(this.htmlCanvas.width=a,this.htmlCanvas.height=l,this.device.gl){const[u,f]=this.getDrawingBufferSize();(u!==a||f!==l)&&(o=Math.min(u/r,f/i),this.htmlCanvas.width=Math.floor(r*o),this.htmlCanvas.height=Math.floor(i*o),z.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){const e=this.device.gl;if(!e)throw new Error("canvas size");return[e.drawingBufferWidth,e.drawingBufferHeight]}_setAutoCreatedCanvasId(e){var n;((n=this.htmlCanvas)==null?void 0:n.id)==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}};d(oc,"defaultProps",{canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"});let Ah=oc;function rx(t){if(typeof t=="string"){const e=document.getElementById(t);if(!e)throw new Error(`${t} is not an HTML element`);return e}else if(t)return t;return document.body}function ix(t){const e=document.getElementById(t);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}function sx(t){const{width:e,height:n}=t,r=document.createElement("canvas");return r.id="lumagl-auto-created-canvas",r.width=e||1,r.height=n||1,r.style.width=Number.isFinite(e)?`${e}px`:"100%",r.style.height=Number.isFinite(n)?`${n}px`:"100%",r}function ox(t,e,n,r,i){const s=t,o=im(s[0],e,n);let a=sm(s[1],e,r,i),l=im(s[0]+1,e,n);const c=l===n-1?l:l-1;l=sm(s[1]+1,e,r,i);let u;return i?(l=l===0?l:l+1,u=a,a=l):u=l===r-1?l:l-1,{x:o,y:a,width:Math.max(c-o+1,1),height:Math.max(u-a+1,1)}}function im(t,e,n){return Math.min(Math.round(t*e),n-1)}function sm(t,e,n,r){return r?Math.max(0,n-1-Math.round(t*e)):Math.min(Math.round(t*e),n-1)}const De=class De extends oe{constructor(n,r){r=De.normalizeProps(n,r);super(n,r,De.defaultProps);d(this,"dimension");d(this,"format");d(this,"width");d(this,"height");d(this,"depth");d(this,"mipLevels");d(this,"updateTimestamp");if(this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.props.width===void 0||this.props.height===void 0){const i=De.getTextureDataSize(this.props.data);this.width=(i==null?void 0:i.width)||1,this.height=(i==null?void 0:i.height)||1}this.props.mipmaps&&this.props.mipLevels===void 0&&(this.props.mipLevels="pyramid"),this.mipLevels=this.props.mipLevels==="pyramid"?De.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=n.incrementTimestamp()}get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}clone(n){return this.device.createTexture({...this.props,...n})}static isExternalImage(n){return typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement||typeof VideoFrame<"u"&&n instanceof VideoFrame||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas}static getExternalImageSize(n){if(typeof ImageData<"u"&&n instanceof ImageData||typeof ImageBitmap<"u"&&n instanceof ImageBitmap||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas)return{width:n.width,height:n.height};if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)return{width:n.naturalWidth,height:n.naturalHeight};if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)return{width:n.videoWidth,height:n.videoHeight};if(typeof VideoFrame<"u"&&n instanceof VideoFrame)return{width:n.displayWidth,height:n.displayHeight};throw new Error("Unknown image type")}static isTextureLevelData(n){const r=n==null?void 0:n.data;return ArrayBuffer.isView(r)}static getTextureDataSize(n){if(!n||ArrayBuffer.isView(n))return null;if(Array.isArray(n))return De.getTextureDataSize(n[0]);if(De.isExternalImage(n))return De.getExternalImageSize(n);if(n&&typeof n=="object"&&n.constructor===Object){const i=Object.values(n)[0];return{width:i.width,height:i.height}}throw new Error("texture size deduction failed")}static normalizeTextureData(n,r){let i;return ArrayBuffer.isView(n)?i=[{data:n,width:r.width,height:r.height}]:Array.isArray(n)?i=n:i=[n],i}static getMipLevelCount(n,r){return Math.floor(Math.log2(Math.max(n,r)))+1}static getCubeFaceDepth(n){switch(n){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw new Error(n)}}static normalizeProps(n,r){var l,c;const i={...r},s=((c=(l=n==null?void 0:n.props)==null?void 0:l._resourceDefaults)==null?void 0:c.texture)||{};Object.assign(i,s);const{width:o,height:a}=i;return typeof o=="number"&&(i.width=Math.max(1,Math.ceil(o))),typeof a=="number"&&(i.height=Math.max(1,Math.ceil(a))),i}};d(De,"COPY_SRC",1),d(De,"COPY_DST",2),d(De,"TEXTURE",4),d(De,"STORAGE",8),d(De,"RENDER_ATTACHMENT",16),d(De,"CubeFaces",["+X","-X","+Y","-Y","+Z","-Z"]),d(De,"defaultProps",{...oe.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0}),d(De,"defaultCopyExternalImageOptions",{image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1});let ve=De;const ac=class ac extends oe{get[Symbol.toStringTag](){return"TextureView"}constructor(e,n){super(e,n,ac.defaultProps)}};d(ac,"defaultProps",{...oe.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0});let Pl=ac;function ax(t,e,n){let r="";const i=e.split(/\r?\n/),s=t.slice().sort((o,a)=>o.lineNum-a.lineNum);switch((n==null?void 0:n.showSourceCode)||"no"){case"all":let o=0;for(let a=1;a<=i.length;a++)for(r+=hw(i[a-1],a,n);s.length>o&&s[o].lineNum===a;){const l=s[o++];r+=om(l,i,l.lineNum,{...n,inlineSource:!1})}return r;case"issues":case"no":for(const a of t)r+=om(a,i,a.lineNum,{inlineSource:(n==null?void 0:n.showSourceCode)!=="no"});return r}}function om(t,e,n,r){if(r!=null&&r.inlineSource){const s=lx(e,n),o=t.linePos>0?`${" ".repeat(t.linePos+5)}^^^
`:"";return`
${s}${o}${t.type.toUpperCase()}: ${t.message}

`}const i=t.type==="error"?"red":"#8B4000";return r!=null&&r.html?`<div class='luma-compiler-log-error' style="color:${i};"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function lx(t,e,n){let r="";for(let i=e-2;i<=e;i++){const s=t[i-1];s!==void 0&&(r+=hw(s,e,n))}return r}function hw(t,e,n){const r=n!=null&&n.html?ux(t):t;return`${cx(String(e),4)}: ${r}${n!=null&&n.html?"<br/>":`
`}`}function cx(t,e){let n="";for(let r=t.length;r<e;++r)n+=" ";return n+t}function ux(t){return t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;")}const lc=class lc extends oe{constructor(n,r){r={...r,debugShaders:r.debugShaders||n.props.debugShaders||"errors"};super(n,{id:fx(r),...r},lc.defaultProps);d(this,"stage");d(this,"source");d(this,"compilationStatus","pending");this.stage=this.props.stage,this.source=this.props.source}get[Symbol.toStringTag](){return"Shader"}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){const n=this.props.debugShaders;switch(n){case"never":return;case"errors":if(this.compilationStatus==="success")return;break}const r=await this.getCompilationInfo();n==="warnings"&&(r==null?void 0:r.length)===0||this._displayShaderLog(r)}_displayShaderLog(n){var c;if(typeof document>"u"||!(document!=null&&document.createElement))return;const r=dw(this.source),i=`${this.stage} ${r}`;let s=ax(n,this.source,{showSourceCode:"all",html:!0});const o=this.getTranslatedSource();o&&(s+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${o}</pre></code>`);const a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${i}</h1><br /><br />
<code style="user-select:text;"><pre>
${s}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a),(c=document.getElementsByClassName("luma-compiler-log-error")[0])==null||c.scrollIntoView(),a.onclick=()=>{const u=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(u)}}};d(lc,"defaultProps",{...oe.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0});let Ml=lc;function fx(t){return dw(t.source)||t.id||wp(`unnamed ${t.stage}-shader`)}function dw(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}const $s=class $s extends oe{get[Symbol.toStringTag](){return"Sampler"}constructor(e,n){n=$s.normalizeProps(e,n),super(e,n,$s.defaultProps)}static normalizeProps(e,n){var s,o;const r=((o=(s=e==null?void 0:e.props)==null?void 0:s._resourceDefaults)==null?void 0:o.sampler)||{};return{...n,...r}}};d($s,"defaultProps",{...oe.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1});let Il=$s;const cc=class cc extends oe{constructor(n,r={}){super(n,r,cc.defaultProps);d(this,"width");d(this,"height");this.width=this.props.width,this.height=this.props.height}get[Symbol.toStringTag](){return"Framebuffer"}clone(n){const r=this.colorAttachments.map(s=>s.texture.clone(n)),i=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(n);return this.device.createFramebuffer({...this.props,colorAttachments:r,depthStencilAttachment:i})}resize(n){let r=!n;if(n){const[i,s]=Array.isArray(n)?n:[n.width,n.height];r=r||s!==this.height||i!==this.width,this.width=i,this.height=s}r&&(z.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(this.props.colorAttachments.length===0&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((r,i)=>{if(typeof r=="string"){const s=this.createColorTexture(r,i);return this.attachResource(s),s.view}return r instanceof ve?r.view:r});const n=this.props.depthStencilAttachment;if(n)if(typeof n=="string"){const r=this.createDepthStencilTexture(n);this.attachResource(r),this.depthStencilAttachment=r.view}else n instanceof ve?this.depthStencilAttachment=n.view:this.depthStencilAttachment=n}createColorTexture(n,r){return this.device.createTexture({id:`${this.id}-color-attachment-${r}`,usage:ve.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(n){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:ve.RENDER_ATTACHMENT,format:n,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(n,r){for(let i=0;i<this.colorAttachments.length;++i)if(this.colorAttachments[i]){const s=this.colorAttachments[i].texture.clone({width:n,height:r});this.destroyAttachedResource(this.colorAttachments[i]),this.colorAttachments[i]=s.view,this.attachResource(s.view)}if(this.depthStencilAttachment){const i=this.depthStencilAttachment.texture.clone({width:n,height:r});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=i.view,this.attachResource(i)}this.updateAttachments()}};d(cc,"defaultProps",{...oe.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null});let Nl=cc;const uc=class uc extends oe{constructor(n,r){super(n,r,uc.defaultProps);d(this,"shaderLayout");d(this,"bufferLayout");d(this,"linkStatus","pending");d(this,"hash","");this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}get[Symbol.toStringTag](){return"RenderPipeline"}setUniformsWebGL(n){throw new Error("Use uniform blocks")}};d(uc,"defaultProps",{...oe.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}});let Di=uc;const It=class It extends oe{get[Symbol.toStringTag](){return"RenderPass"}constructor(e,n){n=It.normalizeProps(e,n),super(e,n,It.defaultProps)}static normalizeProps(e,n){var s;return{...(s=e.props._resourceDefaults)==null?void 0:s.renderPass,...n}}};d(It,"defaultClearColor",[0,0,0,1]),d(It,"defaultClearDepth",1),d(It,"defaultClearStencil",0),d(It,"defaultProps",{...oe.defaultProps,framebuffer:null,parameters:void 0,clearColor:It.defaultClearColor,clearColors:void 0,clearDepth:It.defaultClearDepth,clearStencil:It.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0});let Rh=It;const fc=class fc extends oe{constructor(n,r){super(n,r,fc.defaultProps);d(this,"hash","");d(this,"shaderLayout");this.shaderLayout=r.shaderLayout}get[Symbol.toStringTag](){return"ComputePipeline"}};d(fc,"defaultProps",{...oe.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0});let kl=fc;const hc=class hc extends oe{get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,n){super(e,n,hc.defaultProps)}};d(hc,"defaultProps",{...oe.defaultProps,measureExecutionTime:void 0});let Ch=hc;const dc=class dc extends oe{get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,n){super(e,n,dc.defaultProps)}};d(dc,"defaultProps",{...oe.defaultProps});let xh=dc;function hx(t){const[e,n]=px[t],r=e==="i32"||e==="u32",i=e!=="u32",s=gx[e]*n,o=dx(e,n);return{dataType:e,components:n,defaultVertexFormat:o,byteLength:s,integer:r,signed:i}}function dx(t,e){let n;switch(t){case"f32":n="float32";break;case"i32":n="sint32";break;case"u32":n="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}return e===1?n:`${n}x${e}`}const px={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},gx={f32:4,f16:2,i32:4,u32:4};function pw(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[n,r]=t.split("x"),i=n,s=r?parseInt(r):1,o=cw(i),a={type:i,components:s,byteLength:o.byteLength*s,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function gw(t,e){const n={};for(const r of t.attributes){const i=mx(t,e,r.name);i&&(n[r.name]=i)}return n}function _x(t,e,n=16){const r=gw(t,e),i=new Array(n).fill(null);for(const s of Object.values(r))i[s.location]=s;return i}function mx(t,e,n){const r=yx(t,n),i=vx(e,n);if(!r)return null;const s=hx(r.type),o=(i==null?void 0:i.vertexFormat)||s.defaultVertexFormat,a=pw(o);return{attributeName:(i==null?void 0:i.attributeName)||r.name,bufferName:(i==null?void 0:i.bufferName)||r.name,location:r.location,shaderType:r.type,shaderDataType:s.dataType,shaderComponents:s.components,vertexFormat:o,bufferDataType:a.type,bufferComponents:a.components,normalized:a.normalized,integer:s.integer,stepMode:(i==null?void 0:i.stepMode)||r.stepMode||"vertex",byteOffset:(i==null?void 0:i.byteOffset)||0,byteStride:(i==null?void 0:i.byteStride)||0}}function yx(t,e){const n=t.attributes.find(r=>r.name===e);return n||z.warn(`shader layout attribute "${e}" not present in shader`),n||null}function vx(t,e){Tx(t);let n=wx(t,e);return n||(n=Ex(t,e),n)?n:(z.warn(`layout for attribute "${e}" not present in buffer layout`),null)}function Tx(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&z.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function wx(t,e){for(const n of t)if(n.format&&n.name===e)return{attributeName:n.name,bufferName:e,stepMode:n.stepMode,vertexFormat:n.format,byteOffset:0,byteStride:n.byteStride||0};return null}function Ex(t,e){var n;for(const r of t){let i=r.byteStride;if(typeof r.byteStride!="number")for(const o of r.attributes||[]){const a=pw(o.format);i+=a.byteLength}const s=(n=r.attributes)==null?void 0:n.find(o=>o.attribute===e);if(s)return{attributeName:s.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:s.format,byteOffset:s.byteOffset,byteStride:i}}return null}const pc=class pc extends oe{constructor(n,r){super(n,r,pc.defaultProps);d(this,"maxVertexAttributes");d(this,"attributeInfos");d(this,"indexBuffer",null);d(this,"attributes");this.maxVertexAttributes=n.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null);const{shaderLayout:i,bufferLayout:s}=r.renderPipeline||{};if(!i||!s)throw new Error("VertexArray");this.attributeInfos=_x(i,s,this.maxVertexAttributes)}get[Symbol.toStringTag](){return"VertexArray"}setConstantWebGL(n,r){throw new Error("constant attributes not supported")}};d(pc,"defaultProps",{...oe.defaultProps,renderPipeline:null});let Ph=pc;const gc=class gc extends oe{get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,n){super(e,n,gc.defaultProps)}};d(gc,"defaultProps",{...oe.defaultProps,layout:void 0,buffers:{}});let Mh=gc;const _c=class _c extends oe{get[Symbol.toStringTag](){return"QuerySet"}constructor(e,n){super(e,n,_c.defaultProps)}};d(_c,"defaultProps",{...oe.defaultProps,type:void 0,count:void 0});let Ih=_c;const Sx={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function bx(t){return Sx[t]}function Ax(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let pa;function _w(t){return(!pa||pa.byteLength<t)&&(pa=new ArrayBuffer(t)),pa}function Rx(t,e){const n=_w(t.BYTES_PER_ELEMENT*e);return new t(n,0,e)}function Cx(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function Ol(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":Cx(t)}const am=1024;class xx{constructor(e){d(this,"layout",{});d(this,"byteLength");let n=0;for(const[i,s]of Object.entries(e)){const o=bx(s),{type:a,components:l}=o;n=Ax(n,l);const c=n;n+=l,this.layout[i]={type:a,size:l,offset:c}}n+=(4-n%4)%4;const r=n*4;this.byteLength=Math.max(r,am)}getData(e){const n=Math.max(this.byteLength,am),r=_w(n),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(const[s,o]of Object.entries(e)){const a=this.layout[s];if(!a){z.warn(`Supplied uniform value ${s} not present in uniform block layout`)();continue}const{type:l,size:c,offset:u}=a,f=i[l];if(c===1){if(typeof o!="number"&&typeof o!="boolean"){z.warn(`Supplied value for single component uniform ${s} is not a number: ${o}`)();continue}f[u]=Number(o)}else{if(!Ol(o)){z.warn(`Supplied value for multi component / array uniform ${s} is not a numeric array: ${o}`)();continue}f.set(o,u)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}function Px(t,e,n=16){if(t!==e)return!1;const r=t,i=e;if(!Ol(r))return!1;if(Ol(i)&&r.length===i.length){for(let s=0;s<r.length;++s)if(i[s]!==r[s])return!1}return!0}function Mx(t){return Ol(t)?t.slice():t}class Ix{constructor(e){d(this,"name");d(this,"uniforms",{});d(this,"modifiedUniforms",{});d(this,"modified",!0);d(this,"bindingLayout",{});d(this,"needsRedraw","initialized");var n;if(this.name=(e==null?void 0:e.name)||"unnamed",e!=null&&e.name&&(e!=null&&e.shaderLayout)){const r=(n=e==null?void 0:e.shaderLayout.bindings)==null?void 0:n.find(s=>s.type==="uniform"&&s.name===(e==null?void 0:e.name));if(!r)throw new Error(e==null?void 0:e.name);const i=r;for(const s of i.uniforms||[])this.bindingLayout[s.name]=s}}setUniforms(e){for(const[n,r]of Object.entries(e))this._setUniform(n,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${n}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,n){Px(this.uniforms[e],n)||(this.uniforms[e]=Mx(n),this.modifiedUniforms[e]=!0,this.modified=!0)}}class Nx{constructor(e){d(this,"uniformBlocks",new Map);d(this,"uniformBufferLayouts",new Map);d(this,"uniformBuffers",new Map);for(const[n,r]of Object.entries(e)){const i=n,s=new xx(r.uniformTypes||{});this.uniformBufferLayouts.set(i,s);const o=new Ix({name:n});o.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(i,o)}}destroy(){for(const e of this.uniformBuffers.values())e.destroy()}setUniforms(e){var n;for(const[r,i]of Object.entries(e))(n=this.uniformBlocks.get(r))==null||n.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){var n;return((n=this.uniformBufferLayouts.get(e))==null?void 0:n.byteLength)||0}getUniformBufferData(e){var r,i;const n=((r=this.uniformBlocks.get(e))==null?void 0:r.getAllUniforms())||{};return(i=this.uniformBufferLayouts.get(e))==null?void 0:i.getData(n)}createUniformBuffer(e,n,r){r&&this.setUniforms(r);const i=this.getUniformBufferByteLength(n),s=e.createBuffer({usage:ge.UNIFORM|ge.COPY_DST,byteLength:i}),o=this.getUniformBufferData(n);return s.write(o),s}getManagedUniformBuffer(e,n){if(!this.uniformBuffers.get(n)){const r=this.getUniformBufferByteLength(n),i=e.createBuffer({usage:ge.UNIFORM|ge.COPY_DST,byteLength:r});this.uniformBuffers.set(n,i)}return this.uniformBuffers.get(n)}updateUniformBuffers(){let e=!1;for(const n of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(n);e||(e=r)}return e&&z.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){var s;const n=this.uniformBlocks.get(e);let r=this.uniformBuffers.get(e),i=!1;if(r&&(n!=null&&n.needsRedraw)){i||(i=n.needsRedraw);const o=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r==null||r.write(o);const a=(s=this.uniformBlocks.get(e))==null?void 0:s.getAllUniforms();z.log(4,`Writing to uniform buffer ${String(e)}`,o,a)()}return i}}function mw(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function yw(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function kx(t,e,n){if(!e||e>4)throw new Error(`size ${e}`);const r=e;let i=mw(t);if(i==="uint8"&&n&&r===1)return"unorm8-webgl";if(i==="uint8"&&n&&r===3)return"unorm8x3-webgl";if(i==="uint8"||i==="sint8"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}if(i==="uint16"||i==="sint16"){if(r===1||r===3)throw new Error(`size: ${e}`);return n&&(i=i.replace("int","norm")),`${i}x${r}`}return r===1?i:`${i}x${r}`}class Ku{constructor(e){d(this,"bufferLayouts");this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(n=>n.name===e)||null}getAttributeNamesForBuffer(e){var n;return e.attributes?(n=e.attributes)==null?void 0:n.map(r=>r.attribute):[e.name]}mergeBufferLayouts(e,n){const r=[...e];for(const i of n){const s=r.findIndex(o=>o.name===i.name);s<0?r.push(i):r[s]=i}return r}}class Ox{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class bn{constructor(){}get isAstNode(){return!0}get astNodeType(){return""}evaluate(e){throw new Error("Cannot evaluate node")}evaluateString(e){return this.evaluate(e).toString()}search(e){}searchBlock(e,n){if(e){n(Fl.instance);for(const r of e)r instanceof Array?this.searchBlock(r,n):r.search(n);n(Dl.instance)}}}class Fl extends bn{}Fl.instance=new Fl;class Dl extends bn{}Dl.instance=new Dl;class de extends bn{constructor(){super()}}class Nh extends de{constructor(e,n,r,i,s,o){super(),this.calls=new Set,this.name=e,this.args=n,this.returnType=r,this.body=i,this.startLine=s,this.endLine=o}get astNodeType(){return"function"}search(e){this.searchBlock(this.body,e)}}class Fx extends de{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class Dx extends de{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class Bx extends de{constructor(e){super(),this.body=e}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class Ux extends de{constructor(e,n,r,i){super(),this.init=e,this.condition=n,this.increment=r,this.body=i}get astNodeType(){return"for"}search(e){var n,r,i;(n=this.init)===null||n===void 0||n.search(e),(r=this.condition)===null||r===void 0||r.search(e),(i=this.increment)===null||i===void 0||i.search(e),this.searchBlock(this.body,e)}}class fr extends de{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"var"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class vw extends de{constructor(e,n,r){super(),this.name=e,this.type=n,this.value=r}get astNodeType(){return"override"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class kh extends de{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"let"}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}class lm extends de{constructor(e,n,r,i,s){super(),this.name=e,this.type=n,this.storage=r,this.access=i,this.value=s}get astNodeType(){return"const"}evaluate(e){return this.value.evaluate(e)}search(e){var n;e(this),(n=this.value)===null||n===void 0||n.search(e)}}var Bi;(function(t){t.increment="++",t.decrement="--"})(Bi||(Bi={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for IncrementOperator");return t[r]}t.parse=e})(Bi||(Bi={}));class Lx extends de{constructor(e,n){super(),this.operator=e,this.variable=n}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}var ho;(function(t){t.assign="=",t.addAssign="+=",t.subtractAssin="-=",t.multiplyAssign="*=",t.divideAssign="/=",t.moduloAssign="%=",t.andAssign="&=",t.orAssign="|=",t.xorAssign="^=",t.shiftLeftAssign="<<=",t.shiftRightAssign=">>="})(ho||(ho={}));(function(t){function e(n){const r=n;if(r=="parse")throw new Error("Invalid value for AssignOperator");return r}t.parse=e})(ho||(ho={}));class zx extends de{constructor(e,n,r){super(),this.operator=e,this.variable=n,this.value=r}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class Tw extends de{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"call"}search(e){for(const n of this.args)n.search(e);e(this)}}class Vx extends de{constructor(e,n){super(),this.body=e,this.continuing=n}get astNodeType(){return"loop"}}class jx extends de{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"body"}}class Hx extends de{constructor(e,n,r,i){super(),this.condition=e,this.body=n,this.elseif=r,this.else=i}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class Wx extends de{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var n;(n=this.value)===null||n===void 0||n.search(e)}}class $x extends de{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class Xx extends de{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class Yx extends de{constructor(e,n){super(),this.severity=e,this.rule=n}get astNodeType(){return"diagnostic"}}class ww extends de{constructor(e,n){super(),this.name=e,this.type=n}get astNodeType(){return"alias"}}class Kx extends de{constructor(){super()}get astNodeType(){return"discard"}}class qx extends de{constructor(){super()}get astNodeType(){return"break"}}class Zx extends de{constructor(){super()}get astNodeType(){return"continue"}}class Ur extends de{constructor(e){super(),this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}}class ur extends Ur{constructor(e,n,r,i){super(e),this.members=n,this.startLine=r,this.endLine=i}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let n=0;n<this.members.length;n++)if(this.members[n].name==e)return n;return-1}}class Ew extends Ur{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"template"}}class Qx extends Ur{constructor(e,n,r,i){super(e),this.storage=n,this.type=r,this.access=i}get astNodeType(){return"pointer"}}class Sw extends Ur{constructor(e,n,r,i){super(e),this.attributes=n,this.format=r,this.count=i}get astNodeType(){return"array"}get isArray(){return!0}}class Ss extends Ur{constructor(e,n,r){super(e),this.format=n,this.access=r}get astNodeType(){return"sampler"}}class zt extends bn{constructor(){super()}}class cm extends zt{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}evaluateString(){return this.value}}class fi extends zt{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"createExpr"}search(e){e(this);for(const n of this.args)n.search(e)}}class bw extends zt{constructor(e,n){super(),this.name=e,this.args=n}get astNodeType(){return"callExpr"}evaluate(e){switch(this.name){case"abs":return Math.abs(this.args[0].evaluate(e));case"acos":return Math.acos(this.args[0].evaluate(e));case"acosh":return Math.acosh(this.args[0].evaluate(e));case"asin":return Math.asin(this.args[0].evaluate(e));case"asinh":return Math.asinh(this.args[0].evaluate(e));case"atan":return Math.atan(this.args[0].evaluate(e));case"atan2":return Math.atan2(this.args[0].evaluate(e),this.args[1].evaluate(e));case"atanh":return Math.atanh(this.args[0].evaluate(e));case"ceil":return Math.ceil(this.args[0].evaluate(e));case"clamp":return Math.min(Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e)),this.args[2].evaluate(e));case"cos":return Math.cos(this.args[0].evaluate(e));case"degrees":return this.args[0].evaluate(e)*180/Math.PI;case"distance":return Math.sqrt(Math.pow(this.args[0].evaluate(e)-this.args[1].evaluate(e),2));case"dot":case"exp":return Math.exp(this.args[0].evaluate(e));case"exp2":return Math.pow(2,this.args[0].evaluate(e));case"floor":return Math.floor(this.args[0].evaluate(e));case"fma":return this.args[0].evaluate(e)*this.args[1].evaluate(e)+this.args[2].evaluate(e);case"fract":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"inverseSqrt":return 1/Math.sqrt(this.args[0].evaluate(e));case"log":return Math.log(this.args[0].evaluate(e));case"log2":return Math.log2(this.args[0].evaluate(e));case"max":return Math.max(this.args[0].evaluate(e),this.args[1].evaluate(e));case"min":return Math.min(this.args[0].evaluate(e),this.args[1].evaluate(e));case"mix":return this.args[0].evaluate(e)*(1-this.args[2].evaluate(e))+this.args[1].evaluate(e)*this.args[2].evaluate(e);case"modf":return this.args[0].evaluate(e)-Math.floor(this.args[0].evaluate(e));case"pow":return Math.pow(this.args[0].evaluate(e),this.args[1].evaluate(e));case"radians":return this.args[0].evaluate(e)*Math.PI/180;case"round":return Math.round(this.args[0].evaluate(e));case"sign":return Math.sign(this.args[0].evaluate(e));case"sin":return Math.sin(this.args[0].evaluate(e));case"sinh":return Math.sinh(this.args[0].evaluate(e));case"saturate":return Math.min(Math.max(this.args[0].evaluate(e),0),1);case"smoothstep":return this.args[0].evaluate(e)*this.args[0].evaluate(e)*(3-2*this.args[0].evaluate(e));case"sqrt":return Math.sqrt(this.args[0].evaluate(e));case"step":return this.args[0].evaluate(e)<this.args[1].evaluate(e)?0:1;case"tan":return Math.tan(this.args[0].evaluate(e));case"tanh":return Math.tanh(this.args[0].evaluate(e));case"trunc":return Math.trunc(this.args[0].evaluate(e));default:throw new Error("Non const function: "+this.name)}}search(e){for(const n of this.args)n.search(e);e(this)}}class Oh extends zt{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}evaluate(e){const n=e.constants.get(this.name);if(!n)throw new Error("Cannot evaluate node");return n.evaluate(e)}}class um extends zt{constructor(e,n){super(),this.name=e,this.initializer=n}get astNodeType(){return"constExpr"}evaluate(e){var n,r;if(this.initializer instanceof fi){const i=(n=this.postfix)===null||n===void 0?void 0:n.evaluateString(e),s=(r=this.initializer.type)===null||r===void 0?void 0:r.name,o=e.structs.get(s),a=o==null?void 0:o.getMemberIndex(i);if(a!=-1)return this.initializer.args[a].evaluate(e);console.log(a)}return this.initializer.evaluate(e)}search(e){this.initializer.search(e)}}class fm extends zt{constructor(e){super(),this.value=e}get astNodeType(){return"literalExpr"}evaluate(){return this.value}}class Jx extends zt{constructor(e,n){super(),this.type=e,this.value=n}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class Gx extends zt{constructor(e,n){super(),this.type=e,this.args=n}get astNodeType(){return"typecastExpr"}evaluate(e){return this.args[0].evaluate(e)}search(e){this.searchBlock(this.args,e)}}class hm extends zt{constructor(e){super(),this.contents=e}get astNodeType(){return"groupExpr"}evaluate(e){return this.contents[0].evaluate(e)}search(e){this.searchBlock(this.contents,e)}}class e2 extends zt{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class Aw extends zt{constructor(){super()}}class t2 extends Aw{constructor(e,n){super(),this.operator=e,this.right=n}get astNodeType(){return"unaryOp"}evaluate(e){switch(this.operator){case"+":return this.right.evaluate(e);case"-":return-this.right.evaluate(e);case"!":return this.right.evaluate(e)?0:1;case"~":return~this.right.evaluate(e);default:throw new Error("Unknown unary operator: "+this.operator)}}search(e){this.right.search(e)}}class Xt extends Aw{constructor(e,n,r){super(),this.operator=e,this.left=n,this.right=r}get astNodeType(){return"binaryOp"}evaluate(e){switch(this.operator){case"+":return this.left.evaluate(e)+this.right.evaluate(e);case"-":return this.left.evaluate(e)-this.right.evaluate(e);case"*":return this.left.evaluate(e)*this.right.evaluate(e);case"/":return this.left.evaluate(e)/this.right.evaluate(e);case"%":return this.left.evaluate(e)%this.right.evaluate(e);case"==":return this.left.evaluate(e)==this.right.evaluate(e)?1:0;case"!=":return this.left.evaluate(e)!=this.right.evaluate(e)?1:0;case"<":return this.left.evaluate(e)<this.right.evaluate(e)?1:0;case">":return this.left.evaluate(e)>this.right.evaluate(e)?1:0;case"<=":return this.left.evaluate(e)<=this.right.evaluate(e)?1:0;case">=":return this.left.evaluate(e)>=this.right.evaluate(e)?1:0;case"&&":return this.left.evaluate(e)&&this.right.evaluate(e)?1:0;case"||":return this.left.evaluate(e)||this.right.evaluate(e)?1:0;default:throw new Error(`Unknown operator ${this.operator}`)}}search(e){this.left.search(e),this.right.search(e)}}class Rw extends bn{constructor(){super()}}class n2 extends Rw{constructor(e,n){super(),this.selector=e,this.body=n}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class r2 extends Rw{constructor(e){super(),this.body=e}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class i2 extends bn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"argument"}}class s2 extends bn{constructor(e,n){super(),this.condition=e,this.body=n}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class o2 extends bn{constructor(e,n,r){super(),this.name=e,this.type=n,this.attributes=r}get astNodeType(){return"member"}}let a2=class extends bn{constructor(e,n){super(),this.name=e,this.value=n}get astNodeType(){return"attribute"}};var I,C;(function(t){t[t.token=0]="token",t[t.keyword=1]="keyword",t[t.reserved=2]="reserved"})(C||(C={}));class x{constructor(e,n,r){this.name=e,this.type=n,this.rule=r}toString(){return this.name}}class w{}I=w;w.none=new x("",C.reserved,"");w.eof=new x("EOF",C.token,"");w.reserved={asm:new x("asm",C.reserved,"asm"),bf16:new x("bf16",C.reserved,"bf16"),do:new x("do",C.reserved,"do"),enum:new x("enum",C.reserved,"enum"),f16:new x("f16",C.reserved,"f16"),f64:new x("f64",C.reserved,"f64"),handle:new x("handle",C.reserved,"handle"),i8:new x("i8",C.reserved,"i8"),i16:new x("i16",C.reserved,"i16"),i64:new x("i64",C.reserved,"i64"),mat:new x("mat",C.reserved,"mat"),premerge:new x("premerge",C.reserved,"premerge"),regardless:new x("regardless",C.reserved,"regardless"),typedef:new x("typedef",C.reserved,"typedef"),u8:new x("u8",C.reserved,"u8"),u16:new x("u16",C.reserved,"u16"),u64:new x("u64",C.reserved,"u64"),unless:new x("unless",C.reserved,"unless"),using:new x("using",C.reserved,"using"),vec:new x("vec",C.reserved,"vec"),void:new x("void",C.reserved,"void")};w.keywords={array:new x("array",C.keyword,"array"),atomic:new x("atomic",C.keyword,"atomic"),bool:new x("bool",C.keyword,"bool"),f32:new x("f32",C.keyword,"f32"),i32:new x("i32",C.keyword,"i32"),mat2x2:new x("mat2x2",C.keyword,"mat2x2"),mat2x3:new x("mat2x3",C.keyword,"mat2x3"),mat2x4:new x("mat2x4",C.keyword,"mat2x4"),mat3x2:new x("mat3x2",C.keyword,"mat3x2"),mat3x3:new x("mat3x3",C.keyword,"mat3x3"),mat3x4:new x("mat3x4",C.keyword,"mat3x4"),mat4x2:new x("mat4x2",C.keyword,"mat4x2"),mat4x3:new x("mat4x3",C.keyword,"mat4x3"),mat4x4:new x("mat4x4",C.keyword,"mat4x4"),ptr:new x("ptr",C.keyword,"ptr"),sampler:new x("sampler",C.keyword,"sampler"),sampler_comparison:new x("sampler_comparison",C.keyword,"sampler_comparison"),struct:new x("struct",C.keyword,"struct"),texture_1d:new x("texture_1d",C.keyword,"texture_1d"),texture_2d:new x("texture_2d",C.keyword,"texture_2d"),texture_2d_array:new x("texture_2d_array",C.keyword,"texture_2d_array"),texture_3d:new x("texture_3d",C.keyword,"texture_3d"),texture_cube:new x("texture_cube",C.keyword,"texture_cube"),texture_cube_array:new x("texture_cube_array",C.keyword,"texture_cube_array"),texture_multisampled_2d:new x("texture_multisampled_2d",C.keyword,"texture_multisampled_2d"),texture_storage_1d:new x("texture_storage_1d",C.keyword,"texture_storage_1d"),texture_storage_2d:new x("texture_storage_2d",C.keyword,"texture_storage_2d"),texture_storage_2d_array:new x("texture_storage_2d_array",C.keyword,"texture_storage_2d_array"),texture_storage_3d:new x("texture_storage_3d",C.keyword,"texture_storage_3d"),texture_depth_2d:new x("texture_depth_2d",C.keyword,"texture_depth_2d"),texture_depth_2d_array:new x("texture_depth_2d_array",C.keyword,"texture_depth_2d_array"),texture_depth_cube:new x("texture_depth_cube",C.keyword,"texture_depth_cube"),texture_depth_cube_array:new x("texture_depth_cube_array",C.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new x("texture_depth_multisampled_2d",C.keyword,"texture_depth_multisampled_2d"),texture_external:new x("texture_external",C.keyword,"texture_external"),u32:new x("u32",C.keyword,"u32"),vec2:new x("vec2",C.keyword,"vec2"),vec3:new x("vec3",C.keyword,"vec3"),vec4:new x("vec4",C.keyword,"vec4"),bitcast:new x("bitcast",C.keyword,"bitcast"),block:new x("block",C.keyword,"block"),break:new x("break",C.keyword,"break"),case:new x("case",C.keyword,"case"),continue:new x("continue",C.keyword,"continue"),continuing:new x("continuing",C.keyword,"continuing"),default:new x("default",C.keyword,"default"),diagnostic:new x("diagnostic",C.keyword,"diagnostic"),discard:new x("discard",C.keyword,"discard"),else:new x("else",C.keyword,"else"),enable:new x("enable",C.keyword,"enable"),fallthrough:new x("fallthrough",C.keyword,"fallthrough"),false:new x("false",C.keyword,"false"),fn:new x("fn",C.keyword,"fn"),for:new x("for",C.keyword,"for"),function:new x("function",C.keyword,"function"),if:new x("if",C.keyword,"if"),let:new x("let",C.keyword,"let"),const:new x("const",C.keyword,"const"),loop:new x("loop",C.keyword,"loop"),while:new x("while",C.keyword,"while"),private:new x("private",C.keyword,"private"),read:new x("read",C.keyword,"read"),read_write:new x("read_write",C.keyword,"read_write"),return:new x("return",C.keyword,"return"),requires:new x("requires",C.keyword,"requires"),storage:new x("storage",C.keyword,"storage"),switch:new x("switch",C.keyword,"switch"),true:new x("true",C.keyword,"true"),alias:new x("alias",C.keyword,"alias"),type:new x("type",C.keyword,"type"),uniform:new x("uniform",C.keyword,"uniform"),var:new x("var",C.keyword,"var"),override:new x("override",C.keyword,"override"),workgroup:new x("workgroup",C.keyword,"workgroup"),write:new x("write",C.keyword,"write"),r8unorm:new x("r8unorm",C.keyword,"r8unorm"),r8snorm:new x("r8snorm",C.keyword,"r8snorm"),r8uint:new x("r8uint",C.keyword,"r8uint"),r8sint:new x("r8sint",C.keyword,"r8sint"),r16uint:new x("r16uint",C.keyword,"r16uint"),r16sint:new x("r16sint",C.keyword,"r16sint"),r16float:new x("r16float",C.keyword,"r16float"),rg8unorm:new x("rg8unorm",C.keyword,"rg8unorm"),rg8snorm:new x("rg8snorm",C.keyword,"rg8snorm"),rg8uint:new x("rg8uint",C.keyword,"rg8uint"),rg8sint:new x("rg8sint",C.keyword,"rg8sint"),r32uint:new x("r32uint",C.keyword,"r32uint"),r32sint:new x("r32sint",C.keyword,"r32sint"),r32float:new x("r32float",C.keyword,"r32float"),rg16uint:new x("rg16uint",C.keyword,"rg16uint"),rg16sint:new x("rg16sint",C.keyword,"rg16sint"),rg16float:new x("rg16float",C.keyword,"rg16float"),rgba8unorm:new x("rgba8unorm",C.keyword,"rgba8unorm"),rgba8unorm_srgb:new x("rgba8unorm_srgb",C.keyword,"rgba8unorm_srgb"),rgba8snorm:new x("rgba8snorm",C.keyword,"rgba8snorm"),rgba8uint:new x("rgba8uint",C.keyword,"rgba8uint"),rgba8sint:new x("rgba8sint",C.keyword,"rgba8sint"),bgra8unorm:new x("bgra8unorm",C.keyword,"bgra8unorm"),bgra8unorm_srgb:new x("bgra8unorm_srgb",C.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new x("rgb10a2unorm",C.keyword,"rgb10a2unorm"),rg11b10float:new x("rg11b10float",C.keyword,"rg11b10float"),rg32uint:new x("rg32uint",C.keyword,"rg32uint"),rg32sint:new x("rg32sint",C.keyword,"rg32sint"),rg32float:new x("rg32float",C.keyword,"rg32float"),rgba16uint:new x("rgba16uint",C.keyword,"rgba16uint"),rgba16sint:new x("rgba16sint",C.keyword,"rgba16sint"),rgba16float:new x("rgba16float",C.keyword,"rgba16float"),rgba32uint:new x("rgba32uint",C.keyword,"rgba32uint"),rgba32sint:new x("rgba32sint",C.keyword,"rgba32sint"),rgba32float:new x("rgba32float",C.keyword,"rgba32float"),static_assert:new x("static_assert",C.keyword,"static_assert")};w.tokens={decimal_float_literal:new x("decimal_float_literal",C.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?f?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+f?)|([0-9]+f)/),hex_float_literal:new x("hex_float_literal",C.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+f?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+f?))/),int_literal:new x("int_literal",C.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new x("uint_literal",C.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),ident:new x("ident",C.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new x("and",C.token,"&"),and_and:new x("and_and",C.token,"&&"),arrow:new x("arrow ",C.token,"->"),attr:new x("attr",C.token,"@"),forward_slash:new x("forward_slash",C.token,"/"),bang:new x("bang",C.token,"!"),bracket_left:new x("bracket_left",C.token,"["),bracket_right:new x("bracket_right",C.token,"]"),brace_left:new x("brace_left",C.token,"{"),brace_right:new x("brace_right",C.token,"}"),colon:new x("colon",C.token,":"),comma:new x("comma",C.token,","),equal:new x("equal",C.token,"="),equal_equal:new x("equal_equal",C.token,"=="),not_equal:new x("not_equal",C.token,"!="),greater_than:new x("greater_than",C.token,">"),greater_than_equal:new x("greater_than_equal",C.token,">="),shift_right:new x("shift_right",C.token,">>"),less_than:new x("less_than",C.token,"<"),less_than_equal:new x("less_than_equal",C.token,"<="),shift_left:new x("shift_left",C.token,"<<"),modulo:new x("modulo",C.token,"%"),minus:new x("minus",C.token,"-"),minus_minus:new x("minus_minus",C.token,"--"),period:new x("period",C.token,"."),plus:new x("plus",C.token,"+"),plus_plus:new x("plus_plus",C.token,"++"),or:new x("or",C.token,"|"),or_or:new x("or_or",C.token,"||"),paren_left:new x("paren_left",C.token,"("),paren_right:new x("paren_right",C.token,")"),semicolon:new x("semicolon",C.token,";"),star:new x("star",C.token,"*"),tilde:new x("tilde",C.token,"~"),underscore:new x("underscore",C.token,"_"),xor:new x("xor",C.token,"^"),plus_equal:new x("plus_equal",C.token,"+="),minus_equal:new x("minus_equal",C.token,"-="),times_equal:new x("times_equal",C.token,"*="),division_equal:new x("division_equal",C.token,"/="),modulo_equal:new x("modulo_equal",C.token,"%="),and_equal:new x("and_equal",C.token,"&="),or_equal:new x("or_equal",C.token,"|="),xor_equal:new x("xor_equal",C.token,"^="),shift_right_equal:new x("shift_right_equal",C.token,">>="),shift_left_equal:new x("shift_left_equal",C.token,"<<=")};w.simpleTokens={"@":I.tokens.attr,"{":I.tokens.brace_left,"}":I.tokens.brace_right,":":I.tokens.colon,",":I.tokens.comma,"(":I.tokens.paren_left,")":I.tokens.paren_right,";":I.tokens.semicolon};w.literalTokens={"&":I.tokens.and,"&&":I.tokens.and_and,"->":I.tokens.arrow,"/":I.tokens.forward_slash,"!":I.tokens.bang,"[":I.tokens.bracket_left,"]":I.tokens.bracket_right,"=":I.tokens.equal,"==":I.tokens.equal_equal,"!=":I.tokens.not_equal,">":I.tokens.greater_than,">=":I.tokens.greater_than_equal,">>":I.tokens.shift_right,"<":I.tokens.less_than,"<=":I.tokens.less_than_equal,"<<":I.tokens.shift_left,"%":I.tokens.modulo,"-":I.tokens.minus,"--":I.tokens.minus_minus,".":I.tokens.period,"+":I.tokens.plus,"++":I.tokens.plus_plus,"|":I.tokens.or,"||":I.tokens.or_or,"*":I.tokens.star,"~":I.tokens.tilde,_:I.tokens.underscore,"^":I.tokens.xor,"+=":I.tokens.plus_equal,"-=":I.tokens.minus_equal,"*=":I.tokens.times_equal,"/=":I.tokens.division_equal,"%=":I.tokens.modulo_equal,"&=":I.tokens.and_equal,"|=":I.tokens.or_equal,"^=":I.tokens.xor_equal,">>=":I.tokens.shift_right_equal,"<<=":I.tokens.shift_left_equal};w.regexTokens={decimal_float_literal:I.tokens.decimal_float_literal,hex_float_literal:I.tokens.hex_float_literal,int_literal:I.tokens.int_literal,uint_literal:I.tokens.uint_literal,ident:I.tokens.ident};w.storage_class=[I.keywords.function,I.keywords.private,I.keywords.workgroup,I.keywords.uniform,I.keywords.storage];w.access_mode=[I.keywords.read,I.keywords.write,I.keywords.read_write];w.sampler_type=[I.keywords.sampler,I.keywords.sampler_comparison];w.sampled_texture_type=[I.keywords.texture_1d,I.keywords.texture_2d,I.keywords.texture_2d_array,I.keywords.texture_3d,I.keywords.texture_cube,I.keywords.texture_cube_array];w.multisampled_texture_type=[I.keywords.texture_multisampled_2d];w.storage_texture_type=[I.keywords.texture_storage_1d,I.keywords.texture_storage_2d,I.keywords.texture_storage_2d_array,I.keywords.texture_storage_3d];w.depth_texture_type=[I.keywords.texture_depth_2d,I.keywords.texture_depth_2d_array,I.keywords.texture_depth_cube,I.keywords.texture_depth_cube_array,I.keywords.texture_depth_multisampled_2d];w.texture_external_type=[I.keywords.texture_external];w.any_texture_type=[...I.sampled_texture_type,...I.multisampled_texture_type,...I.storage_texture_type,...I.depth_texture_type,...I.texture_external_type];w.texel_format=[I.keywords.r8unorm,I.keywords.r8snorm,I.keywords.r8uint,I.keywords.r8sint,I.keywords.r16uint,I.keywords.r16sint,I.keywords.r16float,I.keywords.rg8unorm,I.keywords.rg8snorm,I.keywords.rg8uint,I.keywords.rg8sint,I.keywords.r32uint,I.keywords.r32sint,I.keywords.r32float,I.keywords.rg16uint,I.keywords.rg16sint,I.keywords.rg16float,I.keywords.rgba8unorm,I.keywords.rgba8unorm_srgb,I.keywords.rgba8snorm,I.keywords.rgba8uint,I.keywords.rgba8sint,I.keywords.bgra8unorm,I.keywords.bgra8unorm_srgb,I.keywords.rgb10a2unorm,I.keywords.rg11b10float,I.keywords.rg32uint,I.keywords.rg32sint,I.keywords.rg32float,I.keywords.rgba16uint,I.keywords.rgba16sint,I.keywords.rgba16float,I.keywords.rgba32uint,I.keywords.rgba32sint,I.keywords.rgba32float];w.const_literal=[I.tokens.int_literal,I.tokens.uint_literal,I.tokens.decimal_float_literal,I.tokens.hex_float_literal,I.keywords.true,I.keywords.false];w.literal_or_ident=[I.tokens.ident,I.tokens.int_literal,I.tokens.uint_literal,I.tokens.decimal_float_literal,I.tokens.hex_float_literal];w.element_count_expression=[I.tokens.int_literal,I.tokens.uint_literal,I.tokens.ident];w.template_types=[I.keywords.vec2,I.keywords.vec3,I.keywords.vec4,I.keywords.mat2x2,I.keywords.mat2x3,I.keywords.mat2x4,I.keywords.mat3x2,I.keywords.mat3x3,I.keywords.mat3x4,I.keywords.mat4x2,I.keywords.mat4x3,I.keywords.mat4x4,I.keywords.atomic,I.keywords.bitcast,...I.any_texture_type];w.attribute_name=[I.tokens.ident,I.keywords.block,I.keywords.diagnostic];w.assignment_operators=[I.tokens.equal,I.tokens.plus_equal,I.tokens.minus_equal,I.tokens.times_equal,I.tokens.division_equal,I.tokens.modulo_equal,I.tokens.and_equal,I.tokens.or_equal,I.tokens.xor_equal,I.tokens.shift_right_equal,I.tokens.shift_left_equal];w.increment_operators=[I.tokens.plus_plus,I.tokens.minus_minus];class dm{constructor(e,n,r){this.type=e,this.lexeme=n,this.line=r}toString(){return this.lexeme}isTemplateType(){return w.template_types.indexOf(this.type)!=-1}isArrayType(){return this.type==w.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class l2{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=e??""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new dm(w.eof,"",this._line)),this._tokens}scanToken(){let e=this._advance();if(e==`
`)return this._line++,!0;if(this._isWhitespace(e))return!0;if(e=="/"){if(this._peekAhead()=="/"){for(;e!=`
`;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}else if(this._peekAhead()=="*"){this._advance();let o=1;for(;o>0;){if(this._isAtEnd())return!0;if(e=this._advance(),e==`
`)this._line++;else if(e=="*"){if(this._peekAhead()=="/"&&(this._advance(),o--,o==0))return!0}else e=="/"&&this._peekAhead()=="*"&&(this._advance(),o++)}return!0}}const n=w.simpleTokens[e];if(n)return this._addToken(n),!0;let r=w.none;const i=this._isAlpha(e),s=e==="_";if(this._isAlphaNumeric(e)){let o=this._peekAhead();for(;this._isAlphaNumeric(o);)e+=this._advance(),o=this._peekAhead()}if(i){const o=w.keywords[e];if(o)return this._addToken(o),!0}if(i||s)return this._addToken(w.tokens.ident),!0;for(;;){let o=this._findType(e);const a=this._peekAhead();if(e==">"&&(a==">"||a=="=")){let l=!1,c=this._tokens.length-1;for(let u=0;u<5&&c>=0&&w.assignment_operators.indexOf(this._tokens[c].type)===-1;++u,--c)if(this._tokens[c].type===w.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(l=!0);break}if(l)return this._addToken(o),!0}if(o===w.none){let l=e,c=0;const u=2;for(let f=0;f<u;++f)if(l+=this._peekAhead(f),o=this._findType(l),o!==w.none){c=f;break}if(o===w.none)return r===w.none?!1:(this._current--,this._addToken(r),!0);e=l,this._current+=c+1}if(r=o,this._isAtEnd())break;e+=this._advance()}return r===w.none?!1:(this._addToken(r),!0)}_findType(e){for(const r in w.regexTokens){const i=w.regexTokens[r];if(this._match(e,i.rule))return i}const n=w.literalTokens[e];return n||w.none}_match(e,n){const r=n.exec(e);return r&&r.index==0&&r[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"}_isAlphaNumeric(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e=="_"||e>="0"&&e<="9"}_isWhitespace(e){return e==" "||e=="	"||e=="\r"}_advance(e=0){let n=this._source[this._current];return e=e||0,e++,this._current+=e,n}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){const n=this._source.substring(this._start,this._current);this._tokens.push(new dm(e,n,this._line))}}class c2{constructor(){this._tokens=[],this._current=0,this._currentLine=0,this._context=new Ox,this._deferArrayCountEval=[]}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;const n=[];for(;!this._isAtEnd();){const r=this._global_decl_or_directive();if(!r)break;n.push(r)}if(this._deferArrayCountEval.length>0){for(const r of this._deferArrayCountEval){const i=r.arrayType,s=r.countNode;if(s instanceof Oh){const a=s.name,l=this._context.constants.get(a);if(l)try{const c=l.evaluate(this._context);i.count=c}catch{}}}this._deferArrayCountEval.length=0}return n}_initialize(e){if(e)if(typeof e=="string"){const n=new l2(e);this._tokens=n.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_error(e,n){return{token:e,message:n,toString:function(){return`${n}`}}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==w.eof}_match(e){if(e instanceof x)return this._check(e)?(this._advance(),!0):!1;for(let n=0,r=e.length;n<r;++n){const i=e[n];if(this._check(i))return this._advance(),!0}return!1}_consume(e,n){if(this._check(e))return this._advance();throw this._error(this._peek(),n)}_check(e){if(this._isAtEnd())return!1;const n=this._peek();if(e instanceof Array){const r=n.type;return e.indexOf(r)!=-1}return n.type==e}_advance(){var e,n;return this._currentLine=(n=(e=this._peek())===null||e===void 0?void 0:e.line)!==null&&n!==void 0?n:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._match(w.keywords.alias)){const n=this._type_alias();return this._consume(w.tokens.semicolon,"Expected ';'"),n}if(this._match(w.keywords.diagnostic)){const n=this._diagnostic();return this._consume(w.tokens.semicolon,"Expected ';'"),n}if(this._match(w.keywords.requires)){const n=this._requires_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),n}if(this._match(w.keywords.enable)){const n=this._enable_directive();return this._consume(w.tokens.semicolon,"Expected ';'"),n}const e=this._attribute();if(this._check(w.keywords.var)){const n=this._global_variable_decl();return n!=null&&(n.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),n}if(this._check(w.keywords.override)){const n=this._override_variable_decl();return n!=null&&(n.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),n}if(this._check(w.keywords.let)){const n=this._global_let_decl();return n!=null&&(n.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),n}if(this._check(w.keywords.const)){const n=this._global_const_decl();return n!=null&&(n.attributes=e),this._consume(w.tokens.semicolon,"Expected ';'."),n}if(this._check(w.keywords.struct)){const n=this._struct_decl();return n!=null&&(n.attributes=e),n}if(this._check(w.keywords.fn)){const n=this._function_decl();return n!=null&&(n.attributes=e),n}return null}_function_decl(){if(!this._match(w.keywords.fn))return null;const e=this._currentLine,n=this._consume(w.tokens.ident,"Expected function name.").toString();this._consume(w.tokens.paren_left,"Expected '(' for function arguments.");const r=[];if(!this._check(w.tokens.paren_right))do{if(this._check(w.tokens.paren_right))break;const a=this._attribute(),l=this._consume(w.tokens.ident,"Expected argument name.").toString();this._consume(w.tokens.colon,"Expected ':' for argument type.");const c=this._attribute(),u=this._type_decl();u!=null&&(u.attributes=c,r.push(new i2(l,u,a)))}while(this._match(w.tokens.comma));this._consume(w.tokens.paren_right,"Expected ')' after function arguments.");let i=null;if(this._match(w.tokens.arrow)){const a=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=a)}const s=this._compound_statement(),o=this._currentLine;return new Nh(n,r,i,s,e,o)}_compound_statement(){const e=[];for(this._consume(w.tokens.brace_left,"Expected '{' for block.");!this._check(w.tokens.brace_right);){const n=this._statement();n!==null&&e.push(n)}return this._consume(w.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(w.tokens.semicolon)&&!this._isAtEnd(););if(this._check(w.tokens.attr)&&this._attribute(),this._check(w.keywords.if))return this._if_statement();if(this._check(w.keywords.switch))return this._switch_statement();if(this._check(w.keywords.loop))return this._loop_statement();if(this._check(w.keywords.for))return this._for_statement();if(this._check(w.keywords.while))return this._while_statement();if(this._check(w.keywords.continuing))return this._continuing_statement();if(this._check(w.keywords.static_assert))return this._static_assert_statement();if(this._check(w.tokens.brace_left))return this._compound_statement();let e=null;return this._check(w.keywords.return)?e=this._return_statement():this._check([w.keywords.var,w.keywords.let,w.keywords.const])?e=this._variable_statement():this._match(w.keywords.discard)?e=new Kx:this._match(w.keywords.break)?e=new qx:this._match(w.keywords.continue)?e=new Zx:e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement(),e!=null&&this._consume(w.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(w.keywords.static_assert))return null;const e=this._optional_paren_expression();return new Fx(e)}_while_statement(){if(!this._match(w.keywords.while))return null;const e=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute();const n=this._compound_statement();return new Dx(e,n)}_continuing_statement(){if(!this._match(w.keywords.continuing))return null;const e=this._compound_statement();return new Bx(e)}_for_statement(){if(!this._match(w.keywords.for))return null;this._consume(w.tokens.paren_left,"Expected '('.");const e=this._check(w.tokens.semicolon)?null:this._for_init();this._consume(w.tokens.semicolon,"Expected ';'.");const n=this._check(w.tokens.semicolon)?null:this._short_circuit_or_expression();this._consume(w.tokens.semicolon,"Expected ';'.");const r=this._check(w.tokens.paren_right)?null:this._for_increment();this._consume(w.tokens.paren_right,"Expected ')'."),this._check(w.tokens.attr)&&this._attribute();const i=this._compound_statement();return new Ux(e,n,r,i)}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(w.keywords.var)){const e=this._variable_decl();if(e===null)throw this._error(this._peek(),"Variable declaration expected.");let n=null;return this._match(w.tokens.equal)&&(n=this._short_circuit_or_expression()),new fr(e.name,e.type,e.storage,e.access,n)}if(this._match(w.keywords.let)){const e=this._consume(w.tokens.ident,"Expected name for let.").toString();let n=null;if(this._match(w.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(w.tokens.equal,"Expected '=' for let.");const r=this._short_circuit_or_expression();return new kh(e,n,null,null,r)}if(this._match(w.keywords.const)){const e=this._consume(w.tokens.ident,"Expected name for const.").toString();let n=null;if(this._match(w.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}this._consume(w.tokens.equal,"Expected '=' for const.");const r=this._short_circuit_or_expression();return new lm(e,n,null,null,r)}return null}_increment_decrement_statement(){const e=this._current,n=this._unary_expression();if(n==null)return null;if(!this._check(w.increment_operators))return this._current=e,null;const r=this._consume(w.increment_operators,"Expected increment operator");return new Lx(r.type===w.tokens.plus_plus?Bi.increment:Bi.decrement,n)}_assignment_statement(){let e=null;if(this._check(w.tokens.brace_right))return null;let n=this._match(w.tokens.underscore);if(n||(e=this._unary_expression()),!n&&e==null)return null;const r=this._consume(w.assignment_operators,"Expected assignment operator."),i=this._short_circuit_or_expression();return new zx(ho.parse(r.lexeme),e,i)}_func_call_statement(){if(!this._check(w.tokens.ident))return null;const e=this._current,n=this._consume(w.tokens.ident,"Expected function name."),r=this._argument_expression_list();return r===null?(this._current=e,null):new Tw(n.lexeme,r)}_loop_statement(){if(!this._match(w.keywords.loop))return null;this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for loop.");const e=[];let n=this._statement();for(;n!==null;){if(Array.isArray(n))for(let i of n)e.push(i);else e.push(n);n=this._statement()}let r=null;return this._match(w.keywords.continuing)&&(r=this._compound_statement()),this._consume(w.tokens.brace_right,"Expected '}' for loop."),new Vx(e,r)}_switch_statement(){if(!this._match(w.keywords.switch))return null;const e=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Expected '{' for switch.");const n=this._switch_body();if(n==null||n.length==0)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(w.tokens.brace_right,"Expected '}' for switch."),new jx(e,n)}_switch_body(){const e=[];if(this._match(w.keywords.case)){const n=this._case_selectors();this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch case.");const r=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch case."),e.push(new n2(n,r))}if(this._match(w.keywords.default)){this._match(w.tokens.colon),this._check(w.tokens.attr)&&this._attribute(),this._consume(w.tokens.brace_left,"Exected '{' for switch default.");const n=this._case_body();this._consume(w.tokens.brace_right,"Exected '}' for switch default."),e.push(new r2(n))}if(this._check([w.keywords.default,w.keywords.case])){const n=this._switch_body();e.push(n[0])}return e}_case_selectors(){const e=[this._shift_expression()];for(;this._match(w.tokens.comma);)e.push(this._shift_expression());return e}_case_body(){if(this._match(w.keywords.fallthrough))return this._consume(w.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(e==null)return[];e instanceof Array||(e=[e]);const n=this._case_body();return n.length==0?e:[...e,n[0]]}_if_statement(){if(!this._match(w.keywords.if))return null;const e=this._optional_paren_expression();this._check(w.tokens.attr)&&this._attribute();const n=this._compound_statement();let r=[];this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let i=null;return this._match(w.keywords.else)&&(this._check(w.tokens.attr)&&this._attribute(),i=this._compound_statement()),new Hx(e,n,r,i)}_match_elseif(){return this._tokens[this._current].type===w.keywords.else&&this._tokens[this._current+1].type===w.keywords.if?(this._advance(),this._advance(),!0):!1}_elseif_statement(e=[]){const n=this._optional_paren_expression(),r=this._compound_statement();return e.push(new s2(n,r)),this._match_elseif()&&(this._check(w.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(w.keywords.return))return null;const e=this._short_circuit_or_expression();return new Wx(e)}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(w.tokens.or_or);)e=new Xt(this._previous().toString(),e,this._short_circuit_and_expr());return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(w.tokens.and_and);)e=new Xt(this._previous().toString(),e,this._inclusive_or_expression());return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(w.tokens.or);)e=new Xt(this._previous().toString(),e,this._exclusive_or_expression());return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(w.tokens.xor);)e=new Xt(this._previous().toString(),e,this._and_expression());return e}_and_expression(){let e=this._equality_expression();for(;this._match(w.tokens.and);)e=new Xt(this._previous().toString(),e,this._equality_expression());return e}_equality_expression(){const e=this._relational_expression();return this._match([w.tokens.equal_equal,w.tokens.not_equal])?new Xt(this._previous().toString(),e,this._relational_expression()):e}_relational_expression(){let e=this._shift_expression();for(;this._match([w.tokens.less_than,w.tokens.greater_than,w.tokens.less_than_equal,w.tokens.greater_than_equal]);)e=new Xt(this._previous().toString(),e,this._shift_expression());return e}_shift_expression(){let e=this._additive_expression();for(;this._match([w.tokens.shift_left,w.tokens.shift_right]);)e=new Xt(this._previous().toString(),e,this._additive_expression());return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([w.tokens.plus,w.tokens.minus]);)e=new Xt(this._previous().toString(),e,this._multiplicative_expression());return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([w.tokens.star,w.tokens.forward_slash,w.tokens.modulo]);)e=new Xt(this._previous().toString(),e,this._unary_expression());return e}_unary_expression(){return this._match([w.tokens.minus,w.tokens.bang,w.tokens.tilde,w.tokens.star,w.tokens.and])?new t2(this._previous().toString(),this._unary_expression()):this._singular_expression()}_singular_expression(){const e=this._primary_expression(),n=this._postfix_expression();return n&&(e.postfix=n),e}_postfix_expression(){if(this._match(w.tokens.bracket_left)){const e=this._short_circuit_or_expression();this._consume(w.tokens.bracket_right,"Expected ']'.");const n=new e2(e),r=this._postfix_expression();return r&&(n.postfix=r),n}if(this._match(w.tokens.period)){const e=this._consume(w.tokens.ident,"Expected member name."),n=this._postfix_expression(),r=new cm(e.lexeme);return n&&(r.postfix=n),r}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_primary_expression(){if(this._match(w.tokens.ident)){const r=this._previous().toString();if(this._check(w.tokens.paren_left)){const i=this._argument_expression_list(),s=this._getStruct(r);return s!=null?new fi(s,i):new bw(r,i)}if(this._context.constants.has(r)){const i=this._context.constants.get(r);return new um(r,i.value)}return new Oh(r)}if(this._match(w.const_literal))return new fm(parseFloat(this._previous().toString()));if(this._check(w.tokens.paren_left))return this._paren_expression();if(this._match(w.keywords.bitcast)){this._consume(w.tokens.less_than,"Expected '<'.");const r=this._type_decl();this._consume(w.tokens.greater_than,"Expected '>'.");const i=this._paren_expression();return new Jx(r,i)}const e=this._type_decl(),n=this._argument_expression_list();return new Gx(e,n)}_argument_expression_list(){if(!this._match(w.tokens.paren_left))return null;const e=[];do{if(this._check(w.tokens.paren_right))break;const n=this._short_circuit_or_expression();e.push(n)}while(this._match(w.tokens.comma));return this._consume(w.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(w.tokens.paren_left);const e=this._short_circuit_or_expression();return this._match(w.tokens.paren_right),new hm([e])}_paren_expression(){this._consume(w.tokens.paren_left,"Expected '('.");const e=this._short_circuit_or_expression();return this._consume(w.tokens.paren_right,"Expected ')'."),new hm([e])}_struct_decl(){if(!this._match(w.keywords.struct))return null;const e=this._currentLine,n=this._consume(w.tokens.ident,"Expected name for struct.").toString();this._consume(w.tokens.brace_left,"Expected '{' for struct body.");const r=[];for(;!this._check(w.tokens.brace_right);){const o=this._attribute(),a=this._consume(w.tokens.ident,"Expected variable name.").toString();this._consume(w.tokens.colon,"Expected ':' for struct member type.");const l=this._attribute(),c=this._type_decl();c!=null&&(c.attributes=l),this._check(w.tokens.brace_right)?this._match(w.tokens.comma):this._consume(w.tokens.comma,"Expected ',' for struct member."),r.push(new o2(a,c,o))}this._consume(w.tokens.brace_right,"Expected '}' after struct body.");const i=this._currentLine,s=new ur(n,r,e,i);return this._context.structs.set(n,s),s}_global_variable_decl(){const e=this._variable_decl();return e&&this._match(w.tokens.equal)&&(e.value=this._const_expression()),e}_override_variable_decl(){const e=this._override_decl();return e&&this._match(w.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){if(!this._match(w.keywords.const))return null;const e=this._consume(w.tokens.ident,"Expected variable name");let n=null;if(this._match(w.tokens.colon)){const s=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=s)}let r=null;if(this._match(w.tokens.equal)){const s=this._short_circuit_or_expression();if(s instanceof fi)r=s;else if(s instanceof um&&s.initializer instanceof fi)r=s.initializer;else try{const o=s.evaluate(this._context);r=new fm(o)}catch{r=s}}const i=new lm(e.toString(),n,"","",r);return this._context.constants.set(i.name,i),i}_global_let_decl(){if(!this._match(w.keywords.let))return null;const e=this._consume(w.tokens.ident,"Expected variable name");let n=null;if(this._match(w.tokens.colon)){const i=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=i)}let r=null;return this._match(w.tokens.equal)&&(r=this._const_expression()),new kh(e.toString(),n,"","",r)}_const_expression(){if(this._match(w.const_literal))return new cm(this._previous().toString());const e=this._type_decl();this._consume(w.tokens.paren_left,"Expected '('.");let n=[];for(;!this._check(w.tokens.paren_right)&&(n.push(this._const_expression()),!!this._check(w.tokens.comma));)this._advance();return this._consume(w.tokens.paren_right,"Expected ')'."),new fi(e,n)}_variable_decl(){if(!this._match(w.keywords.var))return null;let e="",n="";this._match(w.tokens.less_than)&&(e=this._consume(w.storage_class,"Expected storage_class.").toString(),this._match(w.tokens.comma)&&(n=this._consume(w.access_mode,"Expected access_mode.").toString()),this._consume(w.tokens.greater_than,"Expected '>'."));const r=this._consume(w.tokens.ident,"Expected variable name");let i=null;if(this._match(w.tokens.colon)){const s=this._attribute();i=this._type_decl(),i!=null&&(i.attributes=s)}return new fr(r.toString(),i,e,n,null)}_override_decl(){if(!this._match(w.keywords.override))return null;const e=this._consume(w.tokens.ident,"Expected variable name");let n=null;if(this._match(w.tokens.colon)){const r=this._attribute();n=this._type_decl(),n!=null&&(n.attributes=r)}return new vw(e.toString(),n,null)}_diagnostic(){this._consume(w.tokens.paren_left,"Expected '('");const e=this._consume(w.tokens.ident,"Expected severity control name.");this._consume(w.tokens.comma,"Expected ','");const n=this._consume(w.tokens.ident,"Expected diagnostic rule name.");return this._consume(w.tokens.paren_right,"Expected ')'"),new Yx(e.toString(),n.toString())}_enable_directive(){const e=this._consume(w.tokens.ident,"identity expected.");return new $x(e.toString())}_requires_directive(){const e=[this._consume(w.tokens.ident,"identity expected.").toString()];for(;this._match(w.tokens.comma);){const n=this._consume(w.tokens.ident,"identity expected.");e.push(n.toString())}return new Xx(e)}_type_alias(){const e=this._consume(w.tokens.ident,"identity expected.");this._consume(w.tokens.equal,"Expected '=' for type alias.");let n=this._type_decl();if(n===null)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(n.name)&&(n=this._context.aliases.get(n.name).type);const r=new ww(e.toString(),n);return this._context.aliases.set(r.name,r),r}_type_decl(){if(this._check([w.tokens.ident,...w.texel_format,w.keywords.bool,w.keywords.f32,w.keywords.i32,w.keywords.u32])){const r=this._advance(),i=r.toString();return this._context.structs.has(i)?this._context.structs.get(i):this._context.aliases.has(i)?this._context.aliases.get(i).type:new Ur(r.toString())}let e=this._texture_sampler_types();if(e)return e;if(this._check(w.template_types)){let r=this._advance().toString(),i=null,s=null;return this._match(w.tokens.less_than)&&(i=this._type_decl(),s=null,this._match(w.tokens.comma)&&(s=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for type.")),new Ew(r,i,s)}if(this._match(w.keywords.ptr)){let r=this._previous().toString();this._consume(w.tokens.less_than,"Expected '<' for pointer.");const i=this._consume(w.storage_class,"Expected storage_class for pointer");this._consume(w.tokens.comma,"Expected ',' for pointer.");const s=this._type_decl();let o=null;return this._match(w.tokens.comma)&&(o=this._consume(w.access_mode,"Expected access_mode for pointer").toString()),this._consume(w.tokens.greater_than,"Expected '>' for pointer."),new Qx(r,i.toString(),s,o)}const n=this._attribute();if(this._match(w.keywords.array)){let r=null,i=-1;const s=this._previous();let o=null;if(this._match(w.tokens.less_than)){r=this._type_decl(),this._context.aliases.has(r.name)&&(r=this._context.aliases.get(r.name).type);let l="";if(this._match(w.tokens.comma)){o=this._shift_expression();try{l=o.evaluate(this._context).toString(),o=null}catch{l="1"}}this._consume(w.tokens.greater_than,"Expected '>' for array."),i=l?parseInt(l):0}const a=new Sw(s.toString(),n,r,i);return o&&this._deferArrayCountEval.push({arrayType:a,countNode:o}),a}return null}_texture_sampler_types(){if(this._match(w.sampler_type))return new Ss(this._previous().toString(),null,null);if(this._match(w.depth_texture_type))return new Ss(this._previous().toString(),null,null);if(this._match(w.sampled_texture_type)||this._match(w.multisampled_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const n=this._type_decl();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),new Ss(e.toString(),n,null)}if(this._match(w.storage_texture_type)){const e=this._previous();this._consume(w.tokens.less_than,"Expected '<' for sampler type.");const n=this._consume(w.texel_format,"Invalid texel format.").toString();this._consume(w.tokens.comma,"Expected ',' after texel format.");const r=this._consume(w.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(w.tokens.greater_than,"Expected '>' for sampler type."),new Ss(e.toString(),n,r)}return null}_attribute(){let e=[];for(;this._match(w.tokens.attr);){const n=this._consume(w.attribute_name,"Expected attribute name"),r=new a2(n.toString(),null);if(this._match(w.tokens.paren_left)){if(r.value=this._consume(w.literal_or_ident,"Expected attribute value").toString(),this._check(w.tokens.comma)){this._advance();do{const i=this._consume(w.literal_or_ident,"Expected attribute value").toString();r.value instanceof Array||(r.value=[r.value]),r.value.push(i)}while(this._match(w.tokens.comma))}this._consume(w.tokens.paren_right,"Expected ')'")}e.push(r)}return e.length==0?null:e}}class Si{constructor(e,n){this.name=e,this.attributes=n,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}}class pm{constructor(e,n,r){this.name=e,this.type=n,this.attributes=r,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ga extends Si{constructor(e,n){super(e,n),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class qu extends Si{constructor(e,n){super(e,n),this.count=0,this.stride=0}get isArray(){return!0}}class gm extends Si{constructor(e,n,r,i){super(e,r),this.format=n,this.access=i}get isTemplate(){return!0}}var kn;(function(t){t[t.Uniform=0]="Uniform",t[t.Storage=1]="Storage",t[t.Texture=2]="Texture",t[t.Sampler=3]="Sampler",t[t.StorageTexture=4]="StorageTexture"})(kn||(kn={}));class _a{constructor(e,n,r,i,s,o,a){this.name=e,this.type=n,this.group=r,this.binding=i,this.attributes=s,this.resourceType=o,this.access=a}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray?this.type.format:this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class u2{constructor(e,n){this.name=e,this.type=n}}class ma{constructor(e,n){this.align=e,this.size=n}}class f2{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i,this.interpolation=null}}class _m{constructor(e,n,r,i){this.name=e,this.type=n,this.locationType=r,this.location=i}}class h2{constructor(e,n=null){this.stage=null,this.inputs=[],this.outputs=[],this.resources=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=n}}class d2{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}class p2{constructor(e,n,r,i){this.name=e,this.type=n,this.attributes=r,this.id=i}}class g2{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class _n{constructor(e){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new d2,this.functions=[],this._types=new Map,this._functions=new Map,e&&this.update(e)}_isStorageTexture(e){return e.name=="texture_storage_1d"||e.name=="texture_storage_2d"||e.name=="texture_storage_2d_array"||e.name=="texture_storage_3d"}update(e){const r=new c2().parse(e);for(const i of r)i instanceof Nh&&this._functions.set(i.name,new g2(i));for(const i of r)if(i instanceof ur){const s=this._getTypeInfo(i,null);s instanceof ga&&this.structs.push(s)}for(const i of r){if(i instanceof ww){this.aliases.push(this._getAliasInfo(i));continue}if(i instanceof vw){const s=i,o=this._getAttributeNum(s.attributes,"id",0),a=s.type!=null?this._getTypeInfo(s.type,s.attributes):null;this.overrides.push(new p2(s.name,a,s.attributes,o));continue}if(this._isUniformVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new _a(s.name,l,o,a,s.attributes,kn.Uniform,s.access);this.uniforms.push(c);continue}if(this._isStorageVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new _a(s.name,l,o,a,s.attributes,c?kn.StorageTexture:kn.Storage,s.access);this.storage.push(u);continue}if(this._isTextureVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=this._isStorageTexture(l),u=new _a(s.name,l,o,a,s.attributes,c?kn.StorageTexture:kn.Texture,s.access);c?this.storage.push(u):this.textures.push(u);continue}if(this._isSamplerVar(i)){const s=i,o=this._getAttributeNum(s.attributes,"group",0),a=this._getAttributeNum(s.attributes,"binding",0),l=this._getTypeInfo(s.type,s.attributes),c=new _a(s.name,l,o,a,s.attributes,kn.Sampler,s.access);this.samplers.push(c);continue}if(i instanceof Nh){const s=this._getAttribute(i,"vertex"),o=this._getAttribute(i,"fragment"),a=this._getAttribute(i,"compute"),l=s||o||a,c=new h2(i.name,l==null?void 0:l.name);c.startLine=i.startLine,c.endLine=i.endLine,this.functions.push(c),this._functions.get(i.name).info=c,l&&(this._functions.get(i.name).inUse=!0,c.inUse=!0,c.resources=this._findResources(i,!!l),c.inputs=this._getInputs(i.args),c.outputs=this._getOutputs(i.returnType),this.entry[l.name].push(c));continue}}for(const i of this._functions.values())i.info&&(i.info.inUse=i.inUse,this._addCalls(i.node,i.info.calls));for(const i of this.uniforms)this._markStructsInUse(i.type);for(const i of this.storage)this._markStructsInUse(i.type)}_markStructsInUse(e){if(e.isStruct){e.inUse=!0;for(const n of e.members)this._markStructsInUse(n.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)this._markStructsInUse(e.format);else{const n=this._getAlias(e.name);n&&this._markStructsInUse(n)}}_addCalls(e,n){var r;for(const i of e.calls){const s=(r=this._functions.get(i.name))===null||r===void 0?void 0:r.info;s&&n.add(s)}}findResource(e,n){for(const r of this.uniforms)if(r.group==e&&r.binding==n)return r;for(const r of this.storage)if(r.group==e&&r.binding==n)return r;for(const r of this.textures)if(r.group==e&&r.binding==n)return r;for(const r of this.samplers)if(r.group==e&&r.binding==n)return r;return null}_findResource(e){for(const n of this.uniforms)if(n.name==e)return n;for(const n of this.storage)if(n.name==e)return n;for(const n of this.textures)if(n.name==e)return n;for(const n of this.samplers)if(n.name==e)return n;return null}_markStructsFromAST(e){const n=this._getTypeInfo(e,null);this._markStructsInUse(n)}_findResources(e,n){const r=[],i=this,s=[];return e.search(o=>{if(o instanceof Fl)s.push({});else if(o instanceof Dl)s.pop();else if(o instanceof fr){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof fi){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type)}else if(o instanceof kh){const a=o;n&&a.type!==null&&this._markStructsFromAST(a.type),s.length>0&&(s[s.length-1][a.name]=a)}else if(o instanceof Oh){const a=o;if(s.length>0&&s[s.length-1][a.name])return;const l=i._findResource(a.name);l&&r.push(l)}else if(o instanceof bw){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}else if(o instanceof Tw){const a=o,l=i._functions.get(a.name);l&&(n&&(l.inUse=!0),e.calls.add(l.node),l.resources===null&&(l.resources=i._findResources(l.node,n)),r.push(...l.resources))}}),[...new Map(r.map(o=>[o.name,o])).values()]}getBindGroups(){const e=[];function n(r,i){r>=e.length&&(e.length=r+1),e[r]===void 0&&(e[r]=[]),i>=e[r].length&&(e[r].length=i+1)}for(const r of this.uniforms){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.storage){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.textures){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}for(const r of this.samplers){n(r.group,r.binding);const i=e[r.group];i[r.binding]=r}return e}_getOutputs(e,n=void 0){if(n===void 0&&(n=[]),e instanceof ur)this._getStructOutputs(e,n);else{const r=this._getOutputInfo(e);r!==null&&n.push(r)}return n}_getStructOutputs(e,n){for(const r of e.members)if(r.type instanceof ur)this._getStructOutputs(r.type,n);else{const i=this._getAttribute(r,"location")||this._getAttribute(r,"builtin");if(i!==null){const s=this._getTypeInfo(r.type,r.type.attributes),o=this._parseInt(i.value),a=new _m(r.name,s,i.name,o);n.push(a)}}}_getOutputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getTypeInfo(e,e.attributes),i=this._parseInt(n.value);return new _m("",r,n.name,i)}return null}_getInputs(e,n=void 0){n===void 0&&(n=[]);for(const r of e)if(r.type instanceof ur)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}return n}_getStructInputs(e,n){for(const r of e.members)if(r.type instanceof ur)this._getStructInputs(r.type,n);else{const i=this._getInputInfo(r);i!==null&&n.push(i)}}_getInputInfo(e){const n=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(n!==null){const r=this._getAttribute(e,"interpolation"),i=this._getTypeInfo(e.type,e.attributes),s=this._parseInt(n.value),o=new f2(e.name,i,n.name,s);return r!==null&&(o.interpolation=this._parseString(r.value)),o}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);const n=parseInt(e);return isNaN(n)?e:n}_getAlias(e){for(const n of this.aliases)if(n.name==e)return n.type;return null}_getAliasInfo(e){return new u2(e.name,this._getTypeInfo(e.type,null))}_getTypeInfo(e,n){if(this._types.has(e))return this._types.get(e);if(e instanceof Sw){const i=e,s=this._getTypeInfo(i.format,i.attributes),o=new qu(i.name,n);return o.format=s,o.count=i.count,this._types.set(e,o),this._updateTypeInfo(o),o}if(e instanceof ur){const i=e,s=new ga(i.name,n);s.startLine=i.startLine,s.endLine=i.endLine;for(const o of i.members){const a=this._getTypeInfo(o.type,o.attributes);s.members.push(new pm(o.name,a,o.attributes))}return this._types.set(e,s),this._updateTypeInfo(s),s}if(e instanceof Ss){const i=e,s=i.format instanceof Ur,o=i.format?s?this._getTypeInfo(i.format,null):new Si(i.format,null):null,a=new gm(i.name,o,n,i.access);return this._types.set(e,a),this._updateTypeInfo(a),a}if(e instanceof Ew){const i=e,s=i.format?this._getTypeInfo(i.format,null):null,o=new gm(i.name,s,n,i.access);return this._types.set(e,o),this._updateTypeInfo(o),o}const r=new Si(e.name,n);return this._types.set(e,r),this._updateTypeInfo(r),r}_updateTypeInfo(e){var n,r;const i=this._getTypeSize(e);if(e.size=(n=i==null?void 0:i.size)!==null&&n!==void 0?n:0,e instanceof qu){const s=this._getTypeSize(e.format);e.stride=(r=s==null?void 0:s.size)!==null&&r!==void 0?r:0,this._updateTypeInfo(e.format)}e instanceof ga&&this._updateStructInfo(e)}_updateStructInfo(e){var n;let r=0,i=0,s=0,o=0;for(let a=0,l=e.members.length;a<l;++a){const c=e.members[a],u=this._getTypeSize(c);if(!u)continue;(n=this._getAlias(c.type.name))!==null&&n!==void 0||c.type;const f=u.align,h=u.size;r=this._roundUp(f,r+i),i=h,s=r,o=Math.max(o,f),c.offset=r,c.size=h,this._updateTypeInfo(c.type)}e.size=this._roundUp(o,s+i),e.align=o}_getTypeSize(e){var n;if(e==null)return null;const r=this._getAttributeNum(e.attributes,"size",0),i=this._getAttributeNum(e.attributes,"align",0);if(e instanceof pm&&(e=e.type),e instanceof Si){const s=this._getAlias(e.name);s!==null&&(e=s)}{const s=_n._typeInfo[e.name];if(s!==void 0){const o=e.format==="f16"?2:1;return new ma(Math.max(i,s.align/o),Math.max(r,s.size/o))}}{const s=_n._typeInfo[e.name.substring(0,e.name.length-1)];if(s){const o=e.name[e.name.length-1]==="h"?2:1;return new ma(Math.max(i,s.align/o),Math.max(r,s.size/o))}}if(e instanceof qu){let s=e,o=8,a=8;const l=this._getTypeSize(s.format);l!==null&&(a=l.size,o=l.align);const c=s.count,u=this._getAttributeNum((n=e==null?void 0:e.attributes)!==null&&n!==void 0?n:null,"stride",this._roundUp(o,a));return a=c*u,r&&(a=r),new ma(Math.max(i,o),Math.max(r,a))}if(e instanceof ga){let s=0,o=0,a=0,l=0,c=0;for(const u of e.members){const f=this._getTypeSize(u.type);f!==null&&(s=Math.max(f.align,s),a=this._roundUp(f.align,a+l),l=f.size,c=a)}return o=this._roundUp(s,c+l),new ma(Math.max(i,s),Math.max(r,o))}return null}_isUniformVar(e){return e instanceof fr&&e.storage=="uniform"}_isStorageVar(e){return e instanceof fr&&e.storage=="storage"}_isTextureVar(e){return e instanceof fr&&e.type!==null&&_n._textureTypes.indexOf(e.type.name)!=-1}_isSamplerVar(e){return e instanceof fr&&e.type!==null&&_n._samplerTypes.indexOf(e.type.name)!=-1}_getAttribute(e,n){const r=e;if(!r||!r.attributes)return null;const i=r.attributes;for(let s of i)if(s.name==n)return s;return null}_getAttributeNum(e,n,r){if(e===null)return r;for(let i of e)if(i.name==n){let s=i!==null&&i.value!==null?i.value:r;return s instanceof Array&&(s=s[0]),typeof s=="number"?s:typeof s=="string"?parseInt(s):r}return r}_roundUp(e,n){return Math.ceil(n/e)*e}}_n._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}};_n._textureTypes=w.any_texture_type.map(t=>t.name);_n._samplerTypes=w.sampler_type.map(t=>t.name);function _2(t){var s;const e={attributes:[],bindings:[]};let n;try{n=m2(t)}catch(o){return z.error(o.message)(),e}for(const o of n.uniforms){const a=[];for(const l of((s=o.type)==null?void 0:s.members)||[])a.push({name:l.name,type:mm(l.type)});e.bindings.push({type:"uniform",name:o.name,location:o.binding,group:o.group,members:a})}const r=n.entry.vertex[0],i=(r==null?void 0:r.inputs.length)||0;for(let o=0;o<i;o++){const a=r.inputs[o];if(a.locationType==="location"){const l=mm(a.type);e.attributes.push({name:a.name,location:Number(a.location),type:l})}}return e}function mm(t){return t.format?`${t.name}<${t.format.name}>`:t.name}function m2(t){try{return new _n(t)}catch(e){if(e instanceof Error)throw e;let n="WGSL parse error";throw typeof e=="object"&&(e!=null&&e.message)&&(n+=`: ${e.message} `),typeof e=="object"&&(e!=null&&e.token)&&(n+=e.token.line||""),new Error(n,{cause:e})}}const y2={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1};globalThis.mathgl=globalThis.mathgl||{config:{...y2}};const ht=globalThis.mathgl.config;function v2(t,{precision:e=ht.precision}={}){return t=T2(t),`${parseFloat(t.toPrecision(e))}`}function Ui(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}function zn(t,e,n){return E2(t,r=>Math.max(e,Math.min(n,r)))}function Bl(t,e,n){return Ui(t)?t.map((r,i)=>Bl(r,e[i],n)):n*e+(1-n)*t}function Li(t,e,n){const r=ht.EPSILON;n&&(ht.EPSILON=n);try{if(t===e)return!0;if(Ui(t)&&Ui(e)){if(t.length!==e.length)return!1;for(let i=0;i<t.length;++i)if(!Li(t[i],e[i]))return!1;return!0}return t&&t.equals?t.equals(e):e&&e.equals?e.equals(t):typeof t=="number"&&typeof e=="number"?Math.abs(t-e)<=ht.EPSILON*Math.max(1,Math.abs(t),Math.abs(e)):!1}finally{ht.EPSILON=r}}function T2(t){return Math.round(t/ht.EPSILON)*ht.EPSILON}function w2(t){return t.clone?t.clone():new Array(t.length)}function E2(t,e,n){if(Ui(t)){const r=t;n=n||w2(r);for(let i=0;i<n.length&&i<r.length;++i){const s=typeof t=="number"?t:t[i];n[i]=e(s,i,n)}return n}return e(t)}class Cw extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,n=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+n];return this.check()}toArray(e=[],n=0){for(let r=0;r<this.ELEMENTS;++r)e[n+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Ui(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(ht)}formatString(e){let n="";for(let r=0;r<this.ELEMENTS;++r)n+=(r>0?", ":"")+v2(this[r],e);return`${e.printTypes?this.constructor.name:""}[${n}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(!Li(this[n],e[n]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let n=0;n<this.ELEMENTS;++n)if(this[n]!==e[n])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,n,r){if(r===void 0)return this.lerp(this,e,n);for(let i=0;i<this.ELEMENTS;++i){const s=e[i],o=typeof n=="number"?n:n[i];this[i]=s+r*(o-s)}return this.check()}min(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.min(e[n],this[n]);return this.check()}max(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=Math.max(e[n],this[n]);return this.check()}clamp(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),n[r]);return this.check()}add(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]+=n[r];return this.check()}subtract(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]-=n[r];return this.check()}scale(e){if(typeof e=="number")for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;else for(let n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}multiplyByScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}check(){if(ht.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let n=0;n<this.ELEMENTS;++n)e=e&&Number.isFinite(this[n]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]=e;return this.check()}addScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let n=0;n<this.ELEMENTS;++n)this[n]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,n){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),n);return this.check()}get elements(){return this}}function S2(t,e){if(t.length!==e)return!1;for(let n=0;n<t.length;++n)if(!Number.isFinite(t[n]))return!1;return!0}function ut(t){if(!Number.isFinite(t))throw new Error(`Invalid number ${JSON.stringify(t)}`);return t}function Zu(t,e,n=""){if(ht.debug&&!S2(t,e))throw new Error(`math.gl: ${n} some fields set to invalid numbers'`);return t}function ym(t,e){if(!t)throw new Error(`math.gl assertion ${e}`)}class b2 extends Cw{get x(){return this[0]}set x(e){this[0]=ut(e)}get y(){return this[1]}set y(e){this[1]=ut(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let n=0;n<this.ELEMENTS;++n)e+=this[n]*this[n];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let n=0;for(let r=0;r<this.ELEMENTS;++r){const i=this[r]-e[r];n+=i*i}return ut(n)}dot(e){let n=0;for(let r=0;r<this.ELEMENTS;++r)n+=this[r]*e[r];return ut(n)}normalize(){const e=this.magnitude();if(e!==0)for(let n=0;n<this.ELEMENTS;++n)this[n]/=e;return this.check()}multiply(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]*=n[r];return this.check()}divide(...e){for(const n of e)for(let r=0;r<this.ELEMENTS;++r)this[r]/=n[r];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return ym(e>=0&&e<this.ELEMENTS,"index is out of range"),ut(this[e])}setComponent(e,n){return ym(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=n,this.check()}addVectors(e,n){return this.copy(e).add(n)}subVectors(e,n){return this.copy(e).subtract(n)}multiplyVectors(e,n){return this.copy(e).multiply(n)}addScaledVector(e,n){return this.add(new this.constructor(e).multiplyScalar(n))}}const Ya=1e-6;let zi=typeof Float32Array<"u"?Float32Array:Array;function A2(){const t=new zi(2);return zi!=Float32Array&&(t[0]=0,t[1]=0),t}function vm(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function R2(t,e){return t[0]=-e[0],t[1]=-e[1],t}function xw(t,e,n,r){const i=e[0],s=e[1];return t[0]=i+r*(n[0]-i),t[1]=s+r*(n[1]-s),t}function C2(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t}(function(){const t=A2();return function(e,n,r,i,s,o){let a,l;for(n||(n=2),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],s(t,t,o),e[a]=t[0],e[a+1]=t[1];return e}})();function x2(t,e,n){const r=e[0],i=e[1],s=n[3]*r+n[7]*i||1;return t[0]=(n[0]*r+n[4]*i)/s,t[1]=(n[1]*r+n[5]*i)/s,t}function Pw(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s||1;return t[0]=(n[0]*r+n[4]*i+n[8]*s)/o,t[1]=(n[1]*r+n[5]*i+n[9]*s)/o,t[2]=(n[2]*r+n[6]*i+n[10]*s)/o,t}function P2(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i,t[1]=n[1]*r+n[3]*i,t[2]=e[2],t}function M2(){const t=new zi(3);return zi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function I2(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function N2(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function k2(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function O2(t,e,n){const r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],l=n[2];return t[0]=i*l-s*a,t[1]=s*o-r*l,t[2]=r*a-i*o,t}function Mw(t,e,n){const r=e[0],i=e[1],s=e[2];let o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}function F2(t,e,n){const r=e[0],i=e[1],s=e[2];return t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8],t}function D2(t,e,n){const r=n[0],i=n[1],s=n[2],o=n[3],a=e[0],l=e[1],c=e[2];let u=i*c-s*l,f=s*a-r*c,h=r*l-i*a,_=i*h-s*f,v=s*u-r*h,E=r*f-i*u;const b=o*2;return u*=b,f*=b,h*=b,_*=2,v*=2,E*=2,t[0]=a+u+_,t[1]=l+f+v,t[2]=c+h+E,t}function B2(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function U2(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function L2(t,e,n,r){const i=[],s=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],t[0]=s[0]+n[0],t[1]=s[1]+n[1],t[2]=s[2]+n[2],t}function z2(t,e){const n=t[0],r=t[1],i=t[2],s=e[0],o=e[1],a=e[2],l=Math.sqrt((n*n+r*r+i*i)*(s*s+o*o+a*a)),c=l&&k2(t,e)/l;return Math.acos(Math.min(Math.max(c,-1),1))}const V2=I2;(function(){const t=M2();return function(e,n,r,i,s,o){let a,l;for(n||(n=3),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2];return e}})();const Qu=[0,0,0];let ya;class sn extends b2{static get ZERO(){return ya||(ya=new sn(0,0,0),Object.freeze(ya)),ya}constructor(e=0,n=0,r=0){super(-0,-0,-0),arguments.length===1&&Ui(e)?this.copy(e):(ht.debug&&(ut(e),ut(n),ut(r)),this[0]=e,this[1]=n,this[2]=r)}set(e,n,r){return this[0]=e,this[1]=n,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return ht.debug&&(ut(e.x),ut(e.y),ut(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=ut(e)}angle(e){return z2(this,e)}cross(e){return O2(this,this,e),this.check()}rotateX({radians:e,origin:n=Qu}){return B2(this,this,n,e),this.check()}rotateY({radians:e,origin:n=Qu}){return U2(this,this,n,e),this.check()}rotateZ({radians:e,origin:n=Qu}){return L2(this,this,n,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return Mw(this,this,e),this.check()}transformAsVector(e){return Pw(this,this,e),this.check()}transformByMatrix3(e){return F2(this,this,e),this.check()}transformByMatrix2(e){return P2(this,this,e),this.check()}transformByQuaternion(e){return D2(this,this,e),this.check()}}class j2 extends Cw{toString(){let e="[";if(ht.printRowMajor){e+="row-major:";for(let n=0;n<this.RANK;++n)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+n]}`}else{e+="column-major:";for(let n=0;n<this.ELEMENTS;++n)e+=` ${this[n]}`}return e+="]",e}getElementIndex(e,n){return n*this.RANK+e}getElement(e,n){return this[n*this.RANK+e]}setElement(e,n,r){return this[n*this.RANK+e]=ut(r),this}getColumn(e,n=new Array(this.RANK).fill(-0)){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)n[i]=this[r+i];return n}setColumn(e,n){const r=e*this.RANK;for(let i=0;i<this.RANK;++i)this[r+i]=n[i];return this}}function H2(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function W2(t,e){if(t===e){const n=e[1],r=e[2],i=e[3],s=e[6],o=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=s,t[11]=e[14],t[12]=i,t[13]=o,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Fh(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],f=e[9],h=e[10],_=e[11],v=e[12],E=e[13],b=e[14],g=e[15],p=n*a-r*o,y=n*l-i*o,S=n*c-s*o,R=r*l-i*a,P=r*c-s*a,O=i*c-s*l,M=u*E-f*v,k=u*b-h*v,D=u*g-_*v,F=f*b-h*E,B=f*g-_*E,V=h*g-_*b;let H=p*V-y*B+S*F+R*D-P*k+O*M;return H?(H=1/H,t[0]=(a*V-l*B+c*F)*H,t[1]=(i*B-r*V-s*F)*H,t[2]=(E*O-b*P+g*R)*H,t[3]=(h*P-f*O-_*R)*H,t[4]=(l*D-o*V-c*k)*H,t[5]=(n*V-i*D+s*k)*H,t[6]=(b*S-v*O-g*y)*H,t[7]=(u*O-h*S+_*y)*H,t[8]=(o*B-a*D+c*M)*H,t[9]=(r*D-n*B-s*M)*H,t[10]=(v*P-E*S+g*p)*H,t[11]=(f*S-u*P-_*p)*H,t[12]=(a*k-o*F-l*M)*H,t[13]=(n*F-r*k+i*M)*H,t[14]=(E*y-v*R-b*p)*H,t[15]=(u*R-f*y+h*p)*H,t):null}function $2(t){const e=t[0],n=t[1],r=t[2],i=t[3],s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],f=t[10],h=t[11],_=t[12],v=t[13],E=t[14],b=t[15],g=e*o-n*s,p=e*a-r*s,y=n*a-r*o,S=c*v-u*_,R=c*E-f*_,P=u*E-f*v,O=e*P-n*R+r*S,M=s*P-o*R+a*S,k=c*y-u*p+f*g,D=_*y-v*p+E*g;return l*O-i*M+b*k-h*D}function Er(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],l=e[5],c=e[6],u=e[7],f=e[8],h=e[9],_=e[10],v=e[11],E=e[12],b=e[13],g=e[14],p=e[15];let y=n[0],S=n[1],R=n[2],P=n[3];return t[0]=y*r+S*a+R*f+P*E,t[1]=y*i+S*l+R*h+P*b,t[2]=y*s+S*c+R*_+P*g,t[3]=y*o+S*u+R*v+P*p,y=n[4],S=n[5],R=n[6],P=n[7],t[4]=y*r+S*a+R*f+P*E,t[5]=y*i+S*l+R*h+P*b,t[6]=y*s+S*c+R*_+P*g,t[7]=y*o+S*u+R*v+P*p,y=n[8],S=n[9],R=n[10],P=n[11],t[8]=y*r+S*a+R*f+P*E,t[9]=y*i+S*l+R*h+P*b,t[10]=y*s+S*c+R*_+P*g,t[11]=y*o+S*u+R*v+P*p,y=n[12],S=n[13],R=n[14],P=n[15],t[12]=y*r+S*a+R*f+P*E,t[13]=y*i+S*l+R*h+P*b,t[14]=y*s+S*c+R*_+P*g,t[15]=y*o+S*u+R*v+P*p,t}function Ul(t,e,n){const r=n[0],i=n[1],s=n[2];let o,a,l,c,u,f,h,_,v,E,b,g;return e===t?(t[12]=e[0]*r+e[4]*i+e[8]*s+e[12],t[13]=e[1]*r+e[5]*i+e[9]*s+e[13],t[14]=e[2]*r+e[6]*i+e[10]*s+e[14],t[15]=e[3]*r+e[7]*i+e[11]*s+e[15]):(o=e[0],a=e[1],l=e[2],c=e[3],u=e[4],f=e[5],h=e[6],_=e[7],v=e[8],E=e[9],b=e[10],g=e[11],t[0]=o,t[1]=a,t[2]=l,t[3]=c,t[4]=u,t[5]=f,t[6]=h,t[7]=_,t[8]=v,t[9]=E,t[10]=b,t[11]=g,t[12]=o*r+u*i+v*s+e[12],t[13]=a*r+f*i+E*s+e[13],t[14]=l*r+h*i+b*s+e[14],t[15]=c*r+_*i+g*s+e[15]),t}function Ep(t,e,n){const r=n[0],i=n[1],s=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*s,t[9]=e[9]*s,t[10]=e[10]*s,t[11]=e[11]*s,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function X2(t,e,n,r){let i=r[0],s=r[1],o=r[2],a=Math.sqrt(i*i+s*s+o*o),l,c,u,f,h,_,v,E,b,g,p,y,S,R,P,O,M,k,D,F,B,V,H,Z;return a<Ya?null:(a=1/a,i*=a,s*=a,o*=a,c=Math.sin(n),l=Math.cos(n),u=1-l,f=e[0],h=e[1],_=e[2],v=e[3],E=e[4],b=e[5],g=e[6],p=e[7],y=e[8],S=e[9],R=e[10],P=e[11],O=i*i*u+l,M=s*i*u+o*c,k=o*i*u-s*c,D=i*s*u-o*c,F=s*s*u+l,B=o*s*u+i*c,V=i*o*u+s*c,H=s*o*u-i*c,Z=o*o*u+l,t[0]=f*O+E*M+y*k,t[1]=h*O+b*M+S*k,t[2]=_*O+g*M+R*k,t[3]=v*O+p*M+P*k,t[4]=f*D+E*F+y*B,t[5]=h*D+b*F+S*B,t[6]=_*D+g*F+R*B,t[7]=v*D+p*F+P*B,t[8]=f*V+E*H+y*Z,t[9]=h*V+b*H+S*Z,t[10]=_*V+g*H+R*Z,t[11]=v*V+p*H+P*Z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Iw(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[4],o=e[5],a=e[6],l=e[7],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=s*i+c*r,t[5]=o*i+u*r,t[6]=a*i+f*r,t[7]=l*i+h*r,t[8]=c*i-s*r,t[9]=u*i-o*r,t[10]=f*i-a*r,t[11]=h*i-l*r,t}function Y2(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[8],u=e[9],f=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i-c*r,t[1]=o*i-u*r,t[2]=a*i-f*r,t[3]=l*i-h*r,t[8]=s*r+c*i,t[9]=o*r+u*i,t[10]=a*r+f*i,t[11]=l*r+h*i,t}function Nw(t,e,n){const r=Math.sin(n),i=Math.cos(n),s=e[0],o=e[1],a=e[2],l=e[3],c=e[4],u=e[5],f=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=s*i+c*r,t[1]=o*i+u*r,t[2]=a*i+f*r,t[3]=l*i+h*r,t[4]=c*i-s*r,t[5]=u*i-o*r,t[6]=f*i-a*r,t[7]=h*i-l*r,t}function K2(t,e){const n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,l=i+i,c=n*o,u=r*o,f=r*a,h=i*o,_=i*a,v=i*l,E=s*o,b=s*a,g=s*l;return t[0]=1-f-v,t[1]=u+g,t[2]=h-b,t[3]=0,t[4]=u-g,t[5]=1-c-v,t[6]=_+E,t[7]=0,t[8]=h+b,t[9]=_-E,t[10]=1-c-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function q2(t,e,n,r,i,s,o){const a=1/(n-e),l=1/(i-r),c=1/(s-o);return t[0]=s*2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s*2*l,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+r)*l,t[10]=(o+s)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*s*2*c,t[15]=0,t}function Z2(t,e,n,r,i){const s=1/Math.tan(e/2);if(t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,i!=null&&i!==1/0){const o=1/(r-i);t[10]=(i+r)*o,t[14]=2*i*r*o}else t[10]=-1,t[14]=-2*r;return t}const Q2=Z2;function J2(t,e,n,r,i,s,o){const a=1/(e-n),l=1/(r-i),c=1/(s-o);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*l,t[14]=(o+s)*c,t[15]=1,t}const G2=J2;function eP(t,e,n,r){let i,s,o,a,l,c,u,f,h,_;const v=e[0],E=e[1],b=e[2],g=r[0],p=r[1],y=r[2],S=n[0],R=n[1],P=n[2];return Math.abs(v-S)<Ya&&Math.abs(E-R)<Ya&&Math.abs(b-P)<Ya?H2(t):(f=v-S,h=E-R,_=b-P,i=1/Math.sqrt(f*f+h*h+_*_),f*=i,h*=i,_*=i,s=p*_-y*h,o=y*f-g*_,a=g*h-p*f,i=Math.sqrt(s*s+o*o+a*a),i?(i=1/i,s*=i,o*=i,a*=i):(s=0,o=0,a=0),l=h*a-_*o,c=_*s-f*a,u=f*o-h*s,i=Math.sqrt(l*l+c*c+u*u),i?(i=1/i,l*=i,c*=i,u*=i):(l=0,c=0,u=0),t[0]=s,t[1]=l,t[2]=f,t[3]=0,t[4]=o,t[5]=c,t[6]=h,t[7]=0,t[8]=a,t[9]=u,t[10]=_,t[11]=0,t[12]=-(s*v+o*E+a*b),t[13]=-(l*v+c*E+u*b),t[14]=-(f*v+h*E+_*b),t[15]=1,t)}function tP(){const t=new zi(4);return zi!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function nP(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function No(t,e,n){const r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}(function(){const t=tP();return function(e,n,r,i,s,o){let a,l;for(n||(n=4),r||(r=0),i?l=Math.min(i*n+r,e.length):l=e.length,a=r;a<l;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],s(t,t,o),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}})();var Dh;(function(t){t[t.COL0ROW0=0]="COL0ROW0",t[t.COL0ROW1=1]="COL0ROW1",t[t.COL0ROW2=2]="COL0ROW2",t[t.COL0ROW3=3]="COL0ROW3",t[t.COL1ROW0=4]="COL1ROW0",t[t.COL1ROW1=5]="COL1ROW1",t[t.COL1ROW2=6]="COL1ROW2",t[t.COL1ROW3=7]="COL1ROW3",t[t.COL2ROW0=8]="COL2ROW0",t[t.COL2ROW1=9]="COL2ROW1",t[t.COL2ROW2=10]="COL2ROW2",t[t.COL2ROW3=11]="COL2ROW3",t[t.COL3ROW0=12]="COL3ROW0",t[t.COL3ROW1=13]="COL3ROW1",t[t.COL3ROW2=14]="COL3ROW2",t[t.COL3ROW3=15]="COL3ROW3"})(Dh||(Dh={}));const rP=45*Math.PI/180,iP=1,Ju=.1,Gu=500,sP=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class on extends j2{static get IDENTITY(){return aP()}static get ZERO(){return oP()}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Dh}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),arguments.length===1&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,n,r,i,s,o,a,l,c,u,f,h,_,v,E,b){return this[0]=e,this[1]=n,this[2]=r,this[3]=i,this[4]=s,this[5]=o,this[6]=a,this[7]=l,this[8]=c,this[9]=u,this[10]=f,this[11]=h,this[12]=_,this[13]=v,this[14]=E,this[15]=b,this.check()}setRowMajor(e,n,r,i,s,o,a,l,c,u,f,h,_,v,E,b){return this[0]=e,this[1]=s,this[2]=c,this[3]=_,this[4]=n,this[5]=o,this[6]=u,this[7]=v,this[8]=r,this[9]=a,this[10]=f,this[11]=E,this[12]=i,this[13]=l,this[14]=h,this[15]=b,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(sP)}fromObject(e){return this.check()}fromQuaternion(e){return K2(this,e),this.check()}frustum(e){const{left:n,right:r,bottom:i,top:s,near:o=Ju,far:a=Gu}=e;return a===1/0?lP(this,n,r,i,s,o):q2(this,n,r,i,s,o,a),this.check()}lookAt(e){const{eye:n,center:r=[0,0,0],up:i=[0,1,0]}=e;return eP(this,n,r,i),this.check()}ortho(e){const{left:n,right:r,bottom:i,top:s,near:o=Ju,far:a=Gu}=e;return G2(this,n,r,i,s,o,a),this.check()}orthographic(e){const{fovy:n=rP,aspect:r=iP,focalDistance:i=1,near:s=Ju,far:o=Gu}=e;Tm(n);const a=n/2,l=i*Math.tan(a),c=l*r;return this.ortho({left:-c,right:c,bottom:-l,top:l,near:s,far:o})}perspective(e){const{fovy:n=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return Tm(n),Q2(this,n,r,i,s),this.check()}determinant(){return $2(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*o,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,n){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],n=n||[-0,-0,-0];const r=this.getScale(n),i=1/r[0],s=1/r[1],o=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*o,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*o,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*o,e}transpose(){return W2(this,this),this.check()}invert(){return Fh(this,this),this.check()}multiplyLeft(e){return Er(this,e,this),this.check()}multiplyRight(e){return Er(this,this,e),this.check()}rotateX(e){return Iw(this,this,e),this.check()}rotateY(e){return Y2(this,this,e),this.check()}rotateZ(e){return Nw(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,n){return X2(this,this,e,n),this.check()}scale(e){return Ep(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return Ul(this,this,e),this.check()}transform(e,n){return e.length===4?(n=No(n||[-0,-0,-0,-0],e,this),Zu(n,4),n):this.transformAsPoint(e,n)}transformAsPoint(e,n){const{length:r}=e;let i;switch(r){case 2:i=C2(n||[-0,-0],e,this);break;case 3:i=Mw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Zu(i,e.length),i}transformAsVector(e,n){let r;switch(e.length){case 2:r=x2(n||[-0,-0],e,this);break;case 3:r=Pw(n||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Zu(r,e.length),r}transformPoint(e,n){return this.transformAsPoint(e,n)}transformVector(e,n){return this.transformAsPoint(e,n)}transformDirection(e,n){return this.transformAsVector(e,n)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,n,r){return this.identity().translate([e,n,r])}}let va,Ta;function oP(){return va||(va=new on([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),Object.freeze(va)),va}function aP(){return Ta||(Ta=new on,Object.freeze(Ta)),Ta}function Tm(t){if(t>Math.PI*2)throw Error("expected radians")}function lP(t,e,n,r,i,s){const o=2*s/(n-e),a=2*s/(i-r),l=(n+e)/(n-e),c=(i+r)/(i-r),u=-1,f=-1,h=-2*s;return t[0]=o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=l,t[9]=c,t[10]=u,t[11]=f,t[12]=0,t[13]=0,t[14]=h,t[15]=0,t}function kw(t,e=[],n=0){const r=Math.fround(t),i=t-r;return e[n]=r,e[n+1]=i,e}function cP(t){return t-Math.fround(t)}function uP(t){const e=new Float32Array(32);for(let n=0;n<4;++n)for(let r=0;r<4;++r){const i=n*4+r;kw(t[r*4+n],e,i*2)}return e}const fP=`#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,hP={name:"fp32",vs:fP},dP=[0,1,1,1],pP=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,gP=`uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,wm={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:dP},vs:pP,fs:gP,getUniforms:_P};function _P(t={},e){const n={};if(t.highlightedObjectColor!==void 0)if(t.highlightedObjectColor===null)n.isHighlightActive=!1;else{n.isHighlightActive=!0;const r=t.highlightedObjectColor.slice(0,3);n.highlightedObjectColor=r}if(t.highlightColor){const r=Array.from(t.highlightColor,i=>i/255);Number.isFinite(r[3])||(r[3]=1),n.highlightColor=r}return t.isActive!==void 0&&(n.isActive=!!t.isActive,n.isAttribute=!!t.isAttribute),t.useFloatColors!==void 0&&(n.useFloatColors=!!t.useFloatColors),n}const mP=`uniform float ONE;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * ONE - (t - a);
  float a_lo = a * ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * ONE;
  float err = b - (sum - a) * ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * ONE - a) * ONE;
  float err = (a - (s - v) * ONE) * ONE * ONE * ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * ONE + 2.0 * a_fp64.x *
    a_fp64.y * ONE * ONE) + a_fp64.y * a_fp64.y * ONE * ONE * ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,yP={ONE:1};function vP(){return yP}const TP={name:"fp64-arithmetic",vs:mP,getUniforms:vP,fp64ify:kw,fp64LowPart:cP,fp64ifyMatrix4:uP},Em=`uniform layerUniforms {
  uniform float opacity;
} layer;
`,wP={name:"layer",vs:Em,fs:Em,uniformTypes:{opacity:"f32"}},Ow="#define SMOOTH_EDGE_RADIUS 0.5",EP=`
${Ow}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,SP=`
${Ow}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,Fw={name:"geometry",vs:EP,fs:SP},te={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(te,"IDENTITY",{get:()=>(ne.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});const Gt={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},Ll={common:0,meters:1,pixels:2},Bh={click:{handler:"onClick"},panstart:{handler:"onDragStart"},panmove:{handler:"onDrag"},panend:{handler:"onDragEnd"}},bP=Object.keys(te).map(t=>`const int COORDINATE_SYSTEM_${t} = ${te[t]};`).join(""),AP=Object.keys(Gt).map(t=>`const int PROJECTION_MODE_${t} = ${Gt[t]};`).join(""),RP=Object.keys(Ll).map(t=>`const int UNIT_${t.toUpperCase()} = ${Ll[t]};`).join(""),CP=`${bP}
${AP}
${RP}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`;function xP(t,e){if(t===e)return!0;if(Array.isArray(t)){const n=t.length;if(!e||e.length!==n)return!1;for(let r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}return!1}function ko(t){let e={},n;return r=>{for(const i in r)if(!xP(r[i],e[i])){n=t(r),e=r;break}return n}}const Sm=[0,0,0,0],PP=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],Dw=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],MP=[0,0,0],Bw=[0,0,0],IP=ko(kP);function Uw(t,e,n=Bw){n.length<3&&(n=[n[0],n[1],0]);let r=n,i,s=!0;switch(e===te.LNGLAT_OFFSETS||e===te.METER_OFFSETS?i=n:i=t.isGeospatial?[Math.fround(t.longitude),Math.fround(t.latitude),0]:null,t.projectionMode){case Gt.WEB_MERCATOR:(e===te.LNGLAT||e===te.CARTESIAN)&&(i=[0,0,0],s=!1);break;case Gt.WEB_MERCATOR_AUTO_OFFSET:e===te.LNGLAT?r=i:e===te.CARTESIAN&&(r=[Math.fround(t.center[0]),Math.fround(t.center[1]),0],i=t.unprojectPosition(r),r[0]-=n[0],r[1]-=n[1],r[2]-=n[2]);break;case Gt.IDENTITY:r=t.position.map(Math.fround),r[2]=r[2]||0;break;case Gt.GLOBE:s=!1,i=null;break;default:s=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:r,offsetMode:s}}function NP(t,e,n){const{viewMatrixUncentered:r,projectionMatrix:i}=t;let{viewMatrix:s,viewProjectionMatrix:o}=t,a=Sm,l=Sm,c=t.cameraPosition;const{geospatialOrigin:u,shaderCoordinateOrigin:f,offsetMode:h}=Uw(t,e,n);return h&&(l=t.projectPosition(u||f),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,a=No([],l,o),s=r||s,o=Er([],i,s),o=Er([],o,PP)),{viewMatrix:s,viewProjectionMatrix:o,projectionCenter:a,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:f,geospatialOrigin:u}}function Lw({viewport:t,devicePixelRatio:e=1,modelMatrix:n=null,coordinateSystem:r=te.DEFAULT,coordinateOrigin:i=Bw,autoWrapLongitude:s=!1}){r===te.DEFAULT&&(r=t.isGeospatial?te.LNGLAT:te.CARTESIAN);const o=IP({viewport:t,devicePixelRatio:e,coordinateSystem:r,coordinateOrigin:i});return o.wrapLongitude=s,o.modelMatrix=n||Dw,o}function kP({viewport:t,devicePixelRatio:e,coordinateSystem:n,coordinateOrigin:r}){const{projectionCenter:i,viewProjectionMatrix:s,originCommon:o,cameraPosCommon:a,shaderCoordinateOrigin:l,geospatialOrigin:c}=NP(t,n,r),u=t.getDistanceScales(),f=[t.width*e,t.height*e],h=No([],[0,0,-t.focalDistance,1],t.projectionMatrix)[3]||1,_={coordinateSystem:n,projectionMode:t.projectionMode,coordinateOrigin:l,commonOrigin:o.slice(0,3),center:i,pseudoMeters:!!t._pseudoMeters,viewportSize:f,devicePixelRatio:e,focalDistance:h,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:MP,scale:t.scale,wrapLongitude:!1,viewProjectionMatrix:s,modelMatrix:Dw,cameraPosition:a};if(c){const v=t.getDistanceScales(c);switch(n){case te.METER_OFFSETS:_.commonUnitsPerWorldUnit=v.unitsPerMeter,_.commonUnitsPerWorldUnit2=v.unitsPerMeter2;break;case te.LNGLAT:case te.LNGLAT_OFFSETS:t._pseudoMeters||(_.commonUnitsPerMeter=v.unitsPerMeter),_.commonUnitsPerWorldUnit=v.unitsPerDegree,_.commonUnitsPerWorldUnit2=v.unitsPerDegree2;break;case te.CARTESIAN:_.commonUnitsPerWorldUnit=[1,1,v.unitsPerMeter[2]],_.commonUnitsPerWorldUnit2=[0,0,v.unitsPerMeter2[2]];break}}return _}const OP={};function FP(t=OP){return"viewport"in t?Lw(t):{}}const Kc={name:"project",dependencies:[hP,Fw],vs:CP,getUniforms:FP,uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},DP=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,zw={name:"project32",dependencies:[Kc],vs:DP};function BP(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bi(t,e){const n=No([],e,t);return nP(n,n,1/n[3]),n}function bm(t,e){const n=t%e;return n<0?e+n:n}function Uh(t,e,n){return t<e?e:t>n?n:t}function UP(t){return Math.log(t)*Math.LOG2E}const Sp=Math.log2||UP;function En(t,e){if(!t)throw new Error(e||"@math.gl/web-mercator: assertion failed.")}const Dt=Math.PI,Vw=Dt/4,bt=Dt/180,Lh=180/Dt,Vi=512,zl=4003e4,wa=85.051129,LP=1.5;function zP(t){return Sp(t)}function Vl(t){const[e,n]=t;En(Number.isFinite(e)),En(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");const r=e*bt,i=n*bt,s=Vi*(r+Dt)/(2*Dt),o=Vi*(Dt+Math.log(Math.tan(Vw+i*.5)))/(2*Dt);return[s,o]}function ji(t){const[e,n]=t,r=e/Vi*(2*Dt)-Dt,i=2*(Math.atan(Math.exp(n/Vi*(2*Dt)-Dt))-Vw);return[r*Lh,i*Lh]}function VP(t){const{latitude:e}=t;En(Number.isFinite(e));const n=Math.cos(e*bt);return zP(zl*n)-9}function ef(t){const e=Math.cos(t*bt);return Vi/zl/e}function zh(t){const{latitude:e,longitude:n,highPrecision:r=!1}=t;En(Number.isFinite(e)&&Number.isFinite(n));const i=Vi,s=Math.cos(e*bt),o=i/360,a=o/s,l=i/zl/s,c={unitsPerMeter:[l,l,l],metersPerUnit:[1/l,1/l,1/l],unitsPerDegree:[o,a,l],degreesPerUnit:[1/o,1/a,1/l]};if(r){const u=bt*Math.tan(e*bt)/s,f=o*u/2,h=i/zl*u,_=h/a*l;c.unitsPerDegree2=[0,f,h],c.unitsPerMeter2=[_,0,_]}return c}function jw(t,e){const[n,r,i]=t,[s,o,a]=e,{unitsPerMeter:l,unitsPerMeter2:c}=zh({longitude:n,latitude:r,highPrecision:!0}),u=Vl(t);u[0]+=s*(l[0]+c[0]*o),u[1]+=o*(l[1]+c[1]*o);const f=ji(u),h=(i||0)+(a||0);return Number.isFinite(i)||Number.isFinite(a)?[f[0],f[1],h]:f}function jP(t){const{height:e,pitch:n,bearing:r,altitude:i,scale:s,center:o}=t,a=BP();Ul(a,a,[0,0,-i]),Iw(a,a,-n*bt),Nw(a,a,r*bt);const l=s/e;return Ep(a,a,[l,l,l]),o&&Ul(a,a,N2([],o)),a}function HP(t){const{width:e,height:n,altitude:r,pitch:i=0,offset:s,center:o,scale:a,nearZMultiplier:l=1,farZMultiplier:c=1}=t;let{fovy:u=jl(LP)}=t;r!==void 0&&(u=jl(r));const f=u*bt,h=i*bt,_=Hw(u);let v=_;o&&(v+=o[2]*a/Math.cos(h)/n);const E=f*(.5+(s?s[1]:0)/n),b=Math.sin(E)*v/Math.sin(Uh(Math.PI/2-h-E,.01,Math.PI-.01)),g=Math.sin(h)*b+v,p=v*10,y=Math.min(g*c,p);return{fov:f,aspect:e/n,focalDistance:_,near:l,far:y}}function jl(t){return 2*Math.atan(.5/t)*Lh}function Hw(t){return .5/Math.tan(.5*t*bt)}function Ww(t,e){const[n,r,i=0]=t;return En(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(i)),bi(e,[n,r,i,1])}function bp(t,e,n=0){const[r,i,s]=t;if(En(Number.isFinite(r)&&Number.isFinite(i),"invalid pixel coordinate"),Number.isFinite(s))return bi(e,[r,i,s,1]);const o=bi(e,[r,i,0,1]),a=bi(e,[r,i,1,1]),l=o[2],c=a[2],u=l===c?0:((n||0)-l)/(c-l);return xw([],o,a,u)}function WP(t){const{width:e,height:n,bounds:r,minExtent:i=0,maxZoom:s=24,offset:o=[0,0]}=t,[[a,l],[c,u]]=r,f=$P(t.padding),h=Vl([a,Uh(u,-wa,wa)]),_=Vl([c,Uh(l,-wa,wa)]),v=[Math.max(Math.abs(_[0]-h[0]),i),Math.max(Math.abs(_[1]-h[1]),i)],E=[e-f.left-f.right-Math.abs(o[0])*2,n-f.top-f.bottom-Math.abs(o[1])*2];En(E[0]>0&&E[1]>0);const b=E[0]/v[0],g=E[1]/v[1],p=(f.right-f.left)/2/b,y=(f.top-f.bottom)/2/g,S=[(_[0]+h[0])/2+p,(_[1]+h[1])/2+y],R=ji(S),P=Math.min(s,Sp(Math.abs(Math.min(b,g))));return En(Number.isFinite(P)),{longitude:R[0],latitude:R[1],zoom:P}}function $P(t=0){return typeof t=="number"?{top:t,bottom:t,left:t,right:t}:(En(Number.isFinite(t.top)&&Number.isFinite(t.bottom)&&Number.isFinite(t.left)&&Number.isFinite(t.right)),t)}const Am=Math.PI/180;function XP(t,e=0){const{width:n,height:r,unproject:i}=t,s={targetZ:e},o=i([0,r],s),a=i([n,r],s);let l,c;const u=t.fovy?.5*t.fovy*Am:Math.atan(.5/t.altitude),f=(90-t.pitch)*Am;return u>f-.01?(l=Rm(t,0,e),c=Rm(t,n,e)):(l=i([0,0],s),c=i([n,0],s)),[o,a,c,l]}function Rm(t,e,n){const{pixelUnprojectionMatrix:r}=t,i=bi(r,[e,0,1,1]),s=bi(r,[e,t.height,1,1]),a=(n*t.distanceScales.unitsPerMeter[2]-i[2])/(s[2]-i[2]),l=xw([],i,s,a),c=ji(l);return c.push(n),c}const Cm=512;function YP(t){const{width:e,height:n,pitch:r=0}=t;let{longitude:i,latitude:s,zoom:o,bearing:a=0}=t;(i<-180||i>180)&&(i=bm(i+180,360)-180),(a<-180||a>180)&&(a=bm(a+180,360)-180);const l=Sp(n/Cm);if(o<=l)o=l,s=0;else{const c=n/2/Math.pow(2,o),u=ji([0,c])[1];if(s<u)s=u;else{const f=ji([0,Cm-c])[1];s>f&&(s=f)}}return{width:e,height:n,longitude:i,latitude:s,zoom:o,pitch:r,bearing:a}}const $w=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,KP=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,qP=`
${$w}
${KP}
`,ZP=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,QP=`
${$w}
${ZP}
`,JP=ko(rM),GP=ko(iM),eM=[0,0,0,1],tM=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0];function nM(t,e){const[n,r,i]=t,s=bp([n,r,i],e);return Number.isFinite(i)?s:[s[0],s[1],0]}function rM({viewport:t,center:e}){return new on(t.viewProjectionMatrix).invert().transform(e)}function iM({viewport:t,shadowMatrices:e}){const n=[],r=t.pixelUnprojectionMatrix,i=t.isGeospatial?void 0:1,s=[[0,0,i],[t.width,0,i],[0,t.height,i],[t.width,t.height,i],[0,0,-1],[t.width,0,-1],[0,t.height,-1],[t.width,t.height,-1]].map(o=>nM(o,r));for(const o of e){const a=o.clone().translate(new sn(t.center).negate()),l=s.map(u=>a.transform(u)),c=new on().ortho({left:Math.min(...l.map(u=>u[0])),right:Math.max(...l.map(u=>u[0])),bottom:Math.min(...l.map(u=>u[1])),top:Math.max(...l.map(u=>u[1])),near:Math.min(...l.map(u=>-u[2])),far:Math.max(...l.map(u=>-u[2]))});n.push(c.multiplyRight(o))}return n}function sM(t){const{shadowEnabled:e=!0}=t;if(!e||!t.shadowMatrices||!t.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};const n=Kc.getUniforms(t),r=JP({viewport:t.viewport,center:n.center}),i=[],s=GP({shadowMatrices:t.shadowMatrices,viewport:t.viewport}).slice();for(let a=0;a<t.shadowMatrices.length;a++){const l=s[a],c=l.clone().translate(new sn(t.viewport.center).negate());n.coordinateSystem===te.LNGLAT&&n.projectionMode===Gt.WEB_MERCATOR?(s[a]=c,i[a]=r):(s[a]=l.clone().multiplyRight(tM),i[a]=c.transform(r))}const o={drawShadowMap:!!t.drawToShadowMap,useShadowMap:t.shadowMaps?t.shadowMaps.length>0:!1,color:t.shadowColor||eM,lightId:t.shadowLightId||0,lightCount:t.shadowMatrices.length,shadow_uShadowMap0:t.dummyShadowMap,shadow_uShadowMap1:t.dummyShadowMap};for(let a=0;a<s.length;a++)o[`viewProjectionMatrix${a}`]=s[a],o[`projectCenter${a}`]=i[a];for(let a=0;a<2;a++)o[`shadow_uShadowMap${a}`]=t.shadowMaps&&t.shadowMaps[a]||t.dummyShadowMap;return o}const xm={name:"shadow",dependencies:[Kc],vs:qP,fs:QP,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:(t={},e={})=>"viewport"in t&&(t.drawToShadowMap||t.shadowMaps&&t.shadowMaps.length>0)?sM(t):{},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},Xw={...wm,defaultUniforms:{...wm.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},oM=[Fw],aM=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"];function lM(){const t=xl.getDefaultShaderAssembler();for(const e of oM)t.addDefaultModule(e);for(const e of aM)t.addShaderHook(e);return t}const cM=[255,255,255],uM=1;let fM=0;class Yw{constructor(e={}){this.type="ambient";const{color:n=cM}=e,{intensity:r=uM}=e;this.id=e.id||`ambient-${fM++}`,this.color=n,this.intensity=r}}const hM=[255,255,255],dM=1,pM=[0,0,-1];let gM=0;class Hl{constructor(e={}){this.type="directional";const{color:n=hM}=e,{intensity:r=dM}=e,{direction:i=pM}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${gM++}`,this.color=n,this.intensity=r,this.type="directional",this.direction=new sn(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}class _M{constructor(e,n={id:"pass"}){const{id:r}=n;this.id=r,this.device=e,this.props={...n}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class qc extends _M{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){const[n,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(i?[0,0,0,0]:!1),o=i?1:!1,a=i?0:!1,l=e.colorMask??15,c={viewport:[0,0,n,r]};e.colorMask&&(c.colorMask=l),e.scissorRect&&(c.scissorRect=e.scissorRect);const u=this.device.beginRenderPass({framebuffer:e.target,parameters:c,clearColor:s,clearDepth:o,clearStencil:a});try{return this._drawLayers(u,e)}finally{u.end()}}_drawLayers(e,n){const{target:r,moduleParameters:i,viewports:s,views:o,onViewportActive:a,clearStack:l=!0}=n;n.pass=n.pass||"unknown",l&&(this._lastRenderIndex=-1);const c=[];for(const u of s){const f=o&&o[u.id];a==null||a(u);const h=this._getDrawLayerParams(u,n),_=u.subViewports||[u];for(const v of _){const E=this._drawLayersInViewport(e,{target:r,moduleParameters:i,viewport:v,view:f,pass:n.pass,layers:n.layers},h);c.push(E)}}return c}_getDrawLayerParams(e,{layers:n,pass:r,isPicking:i=!1,layerFilter:s,cullRect:o,effects:a,moduleParameters:l},c=!1){var v;const u=[],f=Kw(this._lastRenderIndex+1),h={layer:n[0],viewport:e,isPicking:i,renderPass:r,cullRect:o},_={};for(let E=0;E<n.length;E++){const b=n[E],g=this._shouldDrawLayer(b,h,s,_),p={shouldDrawLayer:g};g&&!c&&(p.layerRenderIndex=f(b,g),p.moduleParameters=this._getModuleParameters(b,a,r,l),p.layerParameters={...(v=b.context.deck)==null?void 0:v.props.parameters,...this.getLayerParameters(b,E,e)}),u[E]=p}return u}_drawLayersInViewport(e,{layers:n,moduleParameters:r,pass:i,target:s,viewport:o,view:a},l){const c=mM(this.device,{moduleParameters:r,target:s,viewport:o});if(a&&a.props.clear){const f=a.props.clear===!0?{color:!0,depth:!0}:a.props.clear;this.device.withParametersWebGL({scissorTest:!0,scissor:c},()=>this.device.clearWebGL(f))}const u={totalCount:n.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:c});for(let f=0;f<n.length;f++){const h=n[f],{shouldDrawLayer:_,layerRenderIndex:v,moduleParameters:E,layerParameters:b}=l[f];if(_&&h.props.pickable&&u.pickableCount++,h.isComposite&&u.compositeCount++,h.isDrawable&&_){u.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,v),E.viewport=o,h.context.renderPass=e;try{h._drawLayer({renderPass:e,moduleParameters:E,uniforms:{layerIndex:v},parameters:b})}catch(g){h.raiseError(g,`drawing ${h} to ${i}`)}}}return u}shouldDrawLayer(e){return!0}getModuleParameters(e,n){return null}getLayerParameters(e,n,r){return e.props.parameters}_shouldDrawLayer(e,n,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;n.layer=e;let o=e.parent;for(;o;){if(!o.props.visible||!o.filterSubLayer(n))return!1;n.layer=o,o=o.parent}if(r){const a=n.layer.id;if(a in i||(i[a]=r(n)),!i[a])return!1}return e.activateViewport(n.viewport),!0}_getModuleParameters(e,n,r,i){var a,l;const s=this.device.canvasContext.cssToDeviceRatio(),o=Object.assign(Object.create(((a=e.internalState)==null?void 0:a.propsInTransition)||e.props),{autoWrapLongitude:e.wrapLongitude,viewport:e.context.viewport,mousePosition:e.context.mousePosition,picking:{isActive:0},devicePixelRatio:s});if(n)for(const c of n)Object.assign(o,(l=c.getModuleParameters)==null?void 0:l.call(c,e));return Object.assign(o,this.getModuleParameters(e,n),i)}}function Kw(t=0,e={}){const n={},r=(i,s)=>{const o=i.props._offset,a=i.id,l=i.parent&&i.parent.id;let c;if(l&&!(l in e)&&r(i.parent,!1),l in n){const u=n[l]=n[l]||Kw(e[l],e);c=u(i,s),n[a]=u}else Number.isFinite(o)?(c=o+(e[l]||0),n[a]=null):c=t;return s&&c>=t&&(t=c+1),e[a]=c,c};return r}function mM(t,{moduleParameters:e,target:n,viewport:r}){const i=e&&e.devicePixelRatio||t.canvasContext.cssToDeviceRatio(),[,s]=t.canvasContext.getDrawingBufferSize(),o=n?n.height:s,a=r;return[a.x*i,o-(a.y+a.height)*i,a.width*i,a.height*i]}class yM extends qc{constructor(e,n){super(e,n);const r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){const n=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,o=i.height*r,a=[1,1,1,1];(s!==n.width||o!==n.height)&&n.resize({width:s,height:o}),super.render({...e,clearColor:a,target:n,pass:"shadow"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}shouldDrawLayer(e){return e.props.shadowEnabled!==!1}getModuleParameters(){return{drawToShadowMap:!0}}}const vM={color:[255,255,255],intensity:1},Pm=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],TM=[0,0,0,200/255];class Ap{constructor(e={}){this.id="lighting-effect",this.shadowColor=TM,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;const{device:n,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(n),r._addDefaultShaderModule(xm),this.dummyShadowMap=n.createTexture({width:1,height:1}))}setProps(e){this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[];for(const n in e){const r=e[n];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r);break}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(n=>n.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let o=0;o<this.shadowPasses.length;o++)this.shadowPasses[o].render({layers:e,layerFilter:n,viewports:r,onViewportActive:i,views:s,moduleParameters:{shadowLightId:o,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}})}}getModuleParameters(e){const n=this.shadow?{shadowMaps:this.shadowPasses.map(r=>r.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{};return n.lightSources={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(r=>r.getProjectedLight({layer:e})),pointLights:this.pointLights.map(r=>r.getProjectedLight({layer:e}))},n}cleanup(e){for(const n of this.shadowPasses)n.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(xm))}_calculateMatrices(){const e=[];for(const n of this.directionalLights){const r=new on().lookAt({eye:new sn(n.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let n=0;n<this.directionalLights.length;n++){const r=new yM(e);this.shadowPasses[n]=r}}_applyDefaultLights(){const{ambientLight:e,pointLights:n,directionalLights:r}=this;!e&&n.length===0&&r.length===0&&(this.ambientLight=new Yw(vM),this.directionalLights.push(new Hl(Pm[0]),new Hl(Pm[1])))}}class wM{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,n,{size:r=1,type:i,padding:s=0,copy:o=!1,initialize:a=!1,maxCount:l}){const c=i||e&&e.constructor||Float32Array,u=n*r+s;if(ArrayBuffer.isView(e)){if(u<=e.length)return e;if(u*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new c(e.buffer,0,u)}let f=1/0;l&&(f=l*r+s);const h=this._allocate(c,u,a,f);return e&&o?h.set(e):a||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,n,r,i){let s=Math.max(Math.ceil(n*this.opts.overAlloc),1);s>i&&(s=i);const o=this._pool,a=e.BYTES_PER_ELEMENT*s,l=o.findIndex(c=>c.byteLength>=a);if(l>=0){const c=new e(o.splice(l,1)[0],0,s);return r&&c.fill(0),c}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;const n=this._pool,{buffer:r}=e,{byteLength:i}=r,s=n.findIndex(o=>o.byteLength>=i);s<0?n.push(r):(s>0||n.length<this.opts.poolSize)&&n.splice(s,0,r),n.length>this.opts.poolSize&&n.shift()}}const po=new wM;function bs(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function EM(t){return[t[12],t[13],t[14]]}function SM(t){return{left:$r(t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]),right:$r(t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]),bottom:$r(t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]),top:$r(t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]),near:$r(t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]),far:$r(t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14])}}const Mm=new sn;function $r(t,e,n,r){Mm.set(t,e,n);const i=Mm.len();return{distance:r/i,normal:new sn(-t/i,-e/i,-n/i)}}function bM(t){return t-Math.fround(t)}let gs;function tf(t,e){const{size:n=1,startIndex:r=0}=e,i=e.endIndex!==void 0?e.endIndex:t.length,s=(i-r)/n;gs=po.allocate(gs,s,{type:Float32Array,size:n*2});let o=r,a=0;for(;o<i;){for(let l=0;l<n;l++){const c=t[o++];gs[a+l]=c,gs[a+l+n]=bM(c)}a+=n*2}return gs.subarray(0,s*n*2)}function AM(t){let e=null,n=!1;for(const r of t)r&&(e?(n||(e=[[e[0][0],e[0][1]],[e[1][0],e[1][1]]],n=!0),e[0][0]=Math.min(e[0][0],r[0][0]),e[0][1]=Math.min(e[0][1],r[0][1]),e[1][0]=Math.max(e[1][0],r[1][0]),e[1][1]=Math.max(e[1][1],r[1][1])):e=r);return e}const RM=Math.PI/180,CM=bs(),Im=[0,0,0],xM={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};function PM({width:t,height:e,orthographic:n,fovyRadians:r,focalDistance:i,padding:s,near:o,far:a}){const l=t/e,c=n?new on().orthographic({fovy:r,aspect:l,focalDistance:i,near:o,far:a}):new on().perspective({fovy:r,aspect:l,near:o,far:a});if(s){const{left:u=0,right:f=0,top:h=0,bottom:_=0}=s,v=zn((u+t-f)/2,0,t)-t/2,E=zn((h+e-_)/2,0,e)-e/2;c[8]-=v*2/t,c[9]+=E*2/e}return c}const mc=class mc{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||xM,this.focalDistance=e.focalDistance||1,this.position=e.position||Im,this.modelMatrix=e.modelMatrix||null;const{longitude:n,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(n),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?Gt.WEB_MERCATOR:Gt.WEB_MERCATOR_AUTO_OFFSET:Gt.IDENTITY}equals(e){return e instanceof mc?this===e?!0:e.width===this.width&&e.height===this.height&&e.scale===this.scale&&Li(e.projectionMatrix,this.projectionMatrix)&&Li(e.viewMatrix,this.viewMatrix):!1}project(e,{topLeft:n=!0}={}){const r=this.projectPosition(e),i=Ww(r,this.pixelProjectionMatrix),[s,o]=i,a=n?o:this.height-o;return e.length===2?[s,a]:[s,a,i[2]]}unproject(e,{topLeft:n=!0,targetZ:r}={}){const[i,s,o]=e,a=n?s:this.height-s,l=r&&r*this.distanceScales.unitsPerMeter[2],c=bp([i,a,o],this.pixelUnprojectionMatrix,l),[u,f,h]=this.unprojectPosition(c);return Number.isFinite(o)?[u,f,h]:Number.isFinite(r)?[u,f,r]:[u,f]}projectPosition(e){const[n,r]=this.projectFlat(e),i=(e[2]||0)*this.distanceScales.unitsPerMeter[2];return[n,r,i]}unprojectPosition(e){const[n,r]=this.unprojectFlat(e),i=(e[2]||0)*this.distanceScales.metersPerUnit[2];return[n,r,i]}projectFlat(e){if(this.isGeospatial){const n=Vl(e);return n[1]=zn(n[1],-318,830),n}return e}unprojectFlat(e){return this.isGeospatial?ji(e):e}getBounds(e={}){const n={targetZ:e.z||0},r=this.unproject([0,0],n),i=this.unproject([this.width,0],n),s=this.unproject([0,this.height],n),o=this.unproject([this.width,this.height],n);return[Math.min(r[0],i[0],s[0],o[0]),Math.min(r[1],i[1],s[1],o[1]),Math.max(r[0],i[0],s[0],o[0]),Math.max(r[1],i[1],s[1],o[1])]}getDistanceScales(e){return e&&this.isGeospatial?zh({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:n,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&n<this.y+this.height&&this.y<n+i}getFrustumPlanes(){return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,SM(this.viewProjectionMatrix)),this._frustumPlanes)}panByPosition(e,n){return null}_initProps(e){const n=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=VP({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||zh({latitude:r,longitude:n}));const i=Math.pow(2,this.zoom);this.scale=i;const{position:s,modelMatrix:o}=e;let a=Im;if(s&&(a=o?new on(o).transformAsVector(s,[]):s),this.isGeospatial){const l=this.projectPosition([n,r,0]);this.center=new sn(a).scale(this.distanceScales.unitsPerMeter).add(l)}else this.center=this.projectPosition(a)}_initMatrices(e){const{viewMatrix:n=CM,projectionMatrix:r=null,orthographic:i=!1,fovyRadians:s,fovy:o=75,near:a=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=n,this.viewMatrix=new on().multiplyRight(n).translate(new sn(this.center).negate()),this.projectionMatrix=r||PM({width:this.width,height:this.height,orthographic:i,fovyRadians:s||o*RM,focalDistance:u,padding:c,near:a,far:l});const f=bs();Er(f,f,this.projectionMatrix),Er(f,f,this.viewMatrix),this.viewProjectionMatrix=f,this.viewMatrixInverse=Fh([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=EM(this.viewMatrixInverse);const h=bs(),_=bs();Ep(h,h,[this.width/2,-this.height/2,1]),Ul(h,h,[1,-1,0]),Er(_,h,this.viewProjectionMatrix),this.pixelProjectionMatrix=_,this.pixelUnprojectionMatrix=Fh(bs(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||ne.warn("Pixel project matrix not invertible")()}};mc.displayName="Viewport";let Wl=mc;const Xs=class Xs extends Wl{constructor(e={}){const{latitude:n=0,longitude:r=0,zoom:i=0,pitch:s=0,bearing:o=0,nearZMultiplier:a=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:f=!1,projectionMatrix:h,repeat:_=!1,worldOffset:v=0,position:E,padding:b,legacyMeterSizes:g=!1}=e;let{width:p,height:y,altitude:S=1.5}=e;const R=Math.pow(2,i);p=p||1,y=y||1;let P,O=null;if(h)S=h[5]/2,P=jl(S);else{e.fovy?(P=e.fovy,S=Hw(P)):P=jl(S);let k;if(b){const{top:D=0,bottom:F=0}=b;k=[0,zn((D+y-F)/2,0,y)-y/2]}O=HP({width:p,height:y,scale:R,center:E&&[0,0,E[2]*ef(n)],offset:k,pitch:s,fovy:P,nearZMultiplier:a,farZMultiplier:l}),Number.isFinite(c)&&(O.near=c),Number.isFinite(u)&&(O.far=u)}let M=jP({height:y,pitch:s,bearing:o,scale:R,altitude:S});v&&(M=new on().translate([512*v,0,0]).multiplyLeft(M)),super({...e,width:p,height:y,viewMatrix:M,longitude:r,latitude:n,zoom:i,...O,fovy:P,focalDistance:S}),this.latitude=n,this.longitude=r,this.zoom=i,this.pitch=s,this.bearing=o,this.altitude=S,this.fovy=P,this.orthographic=f,this._subViewports=_?[]:null,this._pseudoMeters=g,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){const e=this.getBounds(),n=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let i=n;i<=r;i++){const s=i?new Xs({...this,worldOffset:i}):this;this._subViewports.push(s)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);const[n,r]=this.projectFlat(e),i=(e[2]||0)*ef(e[1]);return[n,r,i]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);const[n,r]=this.unprojectFlat(e),i=(e[2]||0)/ef(r);return[n,r,i]}addMetersToLngLat(e,n){return jw(e,n)}panByPosition(e,n){const r=bp(n,this.pixelUnprojectionMatrix),i=this.projectFlat(e),s=vm([],i,R2([],r)),o=vm([],this.center,s),[a,l]=this.unprojectFlat(o);return{longitude:a,latitude:l}}getBounds(e={}){const n=XP(this,e.z||0);return[Math.min(n[0][0],n[1][0],n[2][0],n[3][0]),Math.min(n[0][1],n[1][1],n[2][1],n[3][1]),Math.max(n[0][0],n[1][0],n[2][0],n[3][0]),Math.max(n[0][1],n[1][1],n[2][1],n[3][1])]}fitBounds(e,n={}){const{width:r,height:i}=this,{longitude:s,latitude:o,zoom:a}=WP({width:r,height:i,bounds:e,...n});return new Xs({width:r,height:i,longitude:s,latitude:o,zoom:a})}};Xs.displayName="WebMercatorViewport";let $l=Xs;const Nm=[0,0,0];function nf(t,e,n=!1){const r=e.projectPosition(t);if(n&&e instanceof $l){const[i,s,o=0]=t,a=e.getDistanceScales([i,s]);r[2]=o*a.unitsPerMeter[2]}return r}function MM(t){const{viewport:e,modelMatrix:n,coordinateOrigin:r}=t;let{coordinateSystem:i,fromCoordinateSystem:s,fromCoordinateOrigin:o}=t;return i===te.DEFAULT&&(i=e.isGeospatial?te.LNGLAT:te.CARTESIAN),s===void 0&&(s=i),o===void 0&&(o=r),{viewport:e,coordinateSystem:i,coordinateOrigin:r,modelMatrix:n,fromCoordinateSystem:s,fromCoordinateOrigin:o}}function qw(t,{viewport:e,modelMatrix:n,coordinateSystem:r,coordinateOrigin:i,offsetMode:s}){let[o,a,l=0]=t;switch(n&&([o,a,l]=No([],[o,a,l,1],n)),r){case te.LNGLAT:return nf([o,a,l],e,s);case te.LNGLAT_OFFSETS:return nf([o+i[0],a+i[1],l+(i[2]||0)],e,s);case te.METER_OFFSETS:return nf(jw(i,[o,a,l]),e,s);case te.CARTESIAN:default:return e.isGeospatial?[o+i[0],a+i[1],l+i[2]]:e.projectPosition([o,a,l])}}function Zw(t,e){const{viewport:n,coordinateSystem:r,coordinateOrigin:i,modelMatrix:s,fromCoordinateSystem:o,fromCoordinateOrigin:a}=MM(e),{autoOffset:l=!0}=e,{geospatialOrigin:c=Nm,shaderCoordinateOrigin:u=Nm,offsetMode:f=!1}=l?Uw(n,r,i):{},h=qw(t,{viewport:n,modelMatrix:s,coordinateSystem:o,coordinateOrigin:a,offsetMode:f});if(f){const _=n.projectPosition(c||u);V2(h,h,_)}return h}const IM=[255,255,255],NM=1,kM=[1,0,0],OM=[0,0,1];let FM=0;class DM{constructor(e={}){this.type="point";const{color:n=IM}=e,{intensity:r=NM}=e,{position:i=OM}=e;this.id=e.id||`point-${FM++}`,this.color=n,this.intensity=r,this.type="point",this.position=i,this.attenuation=BM(e),this.projectedLight={...this}}getProjectedLight({layer:e}){const{projectedLight:n}=this,r=e.context.viewport,{coordinateSystem:i,coordinateOrigin:s}=e.props,o=Zw(this.position,{viewport:r,coordinateSystem:i,coordinateOrigin:s,fromCoordinateSystem:r.isGeospatial?te.LNGLAT:te.CARTESIAN,fromCoordinateOrigin:[0,0,0]});return n.color=this.color,n.intensity=this.intensity,n.position=o,n}}function BM(t){return t.attenuation?t.attenuation:kM}class UM extends DM{getProjectedLight({layer:e}){const{projectedLight:n}=this,r=e.context.viewport,{coordinateSystem:i,coordinateOrigin:s,modelMatrix:o}=e.props,{cameraPosition:a}=Lw({viewport:r,modelMatrix:o,coordinateSystem:i,coordinateOrigin:s});return n.color=this.color,n.intensity=this.intensity,n.position=a,n}}let LM=1,zM=1;class Qw{constructor(){d(this,"time",0);d(this,"channels",new Map);d(this,"animations",new Map);d(this,"playing",!1);d(this,"lastEngineTime",-1)}addChannel(e){const{delay:n=0,duration:r=Number.POSITIVE_INFINITY,rate:i=1,repeat:s=1}=e,o=LM++,a={time:0,delay:n,duration:r,rate:i,repeat:s};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){this.channels.delete(e);for(const[n,r]of this.animations)r.channel===e&&this.detachAnimation(n)}isFinished(e){const n=this.channels.get(e);return n===void 0?!1:this.time>=n.delay+n.duration*n.repeat}getTime(e){if(e===void 0)return this.time;const n=this.channels.get(e);return n===void 0?-1:n.time}setTime(e){this.time=Math.max(0,e);const n=this.channels.values();for(const i of n)this._setChannelTime(i,this.time);const r=this.animations.values();for(const i of r){const{animation:s,channel:o}=i;s.setTime(this.getTime(o))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,n){const r=zM++;return this.animations.set(r,{animation:e,channel:n}),e.setTime(this.getTime(n)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(this.lastEngineTime===-1&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,n){const r=n-e.delay,i=e.duration*e.repeat;r>=i?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}function VM(t){return typeof window<"u"&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function jM(t){return typeof window<"u"&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}let HM=0;const WM={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:t=>console.error(t),stats:bh.stats.get(`animation-loop-${HM++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class $M{constructor(e){d(this,"device",null);d(this,"canvas",null);d(this,"props");d(this,"animationProps",null);d(this,"timeline",null);d(this,"stats");d(this,"cpuTime");d(this,"gpuTime");d(this,"frameRate");d(this,"display");d(this,"needsRedraw","initialized");d(this,"_initialized",!1);d(this,"_running",!1);d(this,"_animationFrameId",null);d(this,"_nextFramePromise",null);d(this,"_resolveNextFrame",null);d(this,"_cpuStartTime",0);d(this,"_error",null);if(this.props={...WM,...e},e=this.props,!e.device)throw new Error("No device provided");const{useDevicePixels:n=!0}=this.props;this.stats=e.stats||new Xc({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:n}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){var r,i;if(this.props.onError(e),this._error=Error(),((i=(r=this.device)==null?void 0:r.canvasContext)==null?void 0:i.canvas)instanceof HTMLCanvasElement){const s=document.createElement("h1");s.innerHTML=e.message,s.style.position="absolute",s.style.top="20%",s.style.left="10px",s.style.color="black",s.style.backgroundColor="red",document.body.appendChild(s)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;return this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),this._running?(e!==!1&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this):null}catch(e){const n=e instanceof Error?e:new Error("Unknown error");throw this.props.onError(n),n}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){var e;return(e=this.device)!=null&&e.isLost||this._error?this:(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers(),this)}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw new Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){this._running&&(this._animationFrameId=VM(this._animationFrame.bind(this)))}_cancelAnimationFrame(){this._animationFrameId!==null&&(jM(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){var n;if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),(n=this.device)==null||n.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){var n,r;const e=(r=(n=this.device)==null?void 0:n.canvasContext)==null?void 0:r.canvas;if(!this.device||!e)throw new Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw new Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;const{width:e,height:n,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||n!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=n,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){var e;if(this.device=await this.props.device,!this.device)throw new Error("No device provided");this.canvas=((e=this.device.canvasContext)==null?void 0:e.canvas)||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){const e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";const n=document.createElement("div");n.style.position="absolute",n.style.left="10px",n.style.bottom="10px",n.style.width="300px",n.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(n);const r=this.props.onAddHTML(n);r&&(n.innerHTML=r)}}_getSizeAndAspect(){var s,o,a,l;if(!this.device)return{width:1,height:1,aspect:1};const[e,n]=((o=(s=this.device)==null?void 0:s.canvasContext)==null?void 0:o.getPixelSize())||[1,1];let r=1;const i=(l=(a=this.device)==null?void 0:a.canvasContext)==null?void 0:l.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&n>0&&(r=e/n),{width:e,height:n,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){var e,n;this.props.autoResizeDrawingBuffer&&((n=(e=this.device)==null?void 0:e.canvasContext)==null||n.resize({useDevicePixels:this.props.useDevicePixels}))}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}const rf={};function Rp(t="id"){rf[t]=rf[t]||1;const e=rf[t]++;return`${t}-${e}`}class km{constructor(e){d(this,"id");d(this,"userData",{});d(this,"topology");d(this,"bufferLayout",[]);d(this,"vertexCount");d(this,"indices");d(this,"attributes");if(this.id=e.id||Rp("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&ge.INDEX))throw new Error("Index buffer must have INDEX usage")}destroy(){var e;(e=this.indices)==null||e.destroy();for(const n of Object.values(this.attributes))n.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}function XM(t,e){if(e instanceof km)return e;const n=YM(t,e),{attributes:r,bufferLayout:i}=KM(t,e);return new km({topology:e.topology||"triangle-list",bufferLayout:i,vertexCount:e.vertexCount,indices:n,attributes:r})}function YM(t,e){if(!e.indices)return;const n=e.indices.value;return t.createBuffer({usage:ge.INDEX,data:n})}function KM(t,e){const n=[],r={};for(const[s,o]of Object.entries(e.attributes)){let a=s;switch(s){case"POSITION":a="positions";break;case"NORMAL":a="normals";break;case"TEXCOORD_0":a="texCoords";break;case"COLOR_0":a="colors";break}if(o){r[a]=t.createBuffer({data:o.value,id:`${s}-buffer`});const{value:l,size:c,normalized:u}=o;n.push({name:a,format:kx(l,c,u)})}}const i=e._calculateVertexCount(e.attributes,e.indices);return{attributes:r,bufferLayout:n,vertexCount:i}}const yc=class yc{constructor(e){d(this,"device");d(this,"destroyPolicy");d(this,"_hashCounter",0);d(this,"_hashes",{});d(this,"_renderPipelineCache",{});d(this,"_computePipelineCache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new yc(e),e._lumaData.defaultPipelineFactory}createRenderPipeline(e){const n={...Di.defaultProps,...e},r=this._hashRenderPipeline(n);if(!this._renderPipelineCache[r]){const i=this.device.createRenderPipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._renderPipelineCache[r]={pipeline:i,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){const n={...kl.defaultProps,...e},r=this._hashComputePipeline(n);if(!this._computePipelineCache[r]){const i=this.device.createComputePipeline({...n,id:n.id?`${n.id}-cached`:void 0});i.hash=r,this._computePipelineCache[r]={pipeline:i,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){const n=e.hash,r=e instanceof kl?this._computePipelineCache:this._renderPipelineCache;r[n].useCount--,r[n].useCount===0&&this.destroyPolicy==="unused"&&(r[n].pipeline.destroy(),delete r[n])}_hashComputePipeline(e){return`${this._getHash(e.shader.source)}`}_hashRenderPipeline(e){const n=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i="-",s=this._getHash(JSON.stringify(e.bufferLayout));switch(this.device.type){case"webgl":return`${n}/${r}V${i}BL${s}`;default:const o=this._getHash(JSON.stringify(e.parameters));return`${n}/${r}V${i}T${e.topology}P${o}BL${s}`}}_getHash(e){return this._hashes[e]===void 0&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}};d(yc,"defaultProps",{...Di.defaultProps});let Vh=yc;const vc=class vc{constructor(e){d(this,"device");d(this,"destroyPolicy");d(this,"_cache",{});this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}static getDefaultShaderFactory(e){var n;return(n=e._lumaData).defaultShaderFactory||(n.defaultShaderFactory=new vc(e)),e._lumaData.defaultShaderFactory}createShader(e){const n=this._hashShader(e);let r=this._cache[n];if(!r){const i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[n]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){const n=this._hashShader(e),r=this._cache[n];r&&(r.useCount--,r.useCount===0&&this.destroyPolicy==="unused"&&(delete this._cache[n],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}};d(vc,"defaultProps",{...Ml.defaultProps});let jh=vc;function qM(t,e){var i;const n={},r="Values";if(t.attributes.length===0&&!((i=t.varyings)!=null&&i.length))return{"No attributes or varyings":{[r]:"N/A"}};for(const s of t.attributes)if(s){const o=`${s.location} ${s.name}: ${s.type}`;n[`in ${o}`]={[r]:s.stepMode||"vertex"}}for(const s of t.varyings||[]){const o=`${s.location} ${s.name}`;n[`out ${o}`]={[r]:JSON.stringify(s)}}return n}let Ie=null,or=null;function ZM(t,{id:e,minimap:n,opaque:r,top:i="0",left:s="0",rgbaScale:o=1}){Ie||(Ie=document.createElement("canvas"),Ie.id=e,Ie.title=e,Ie.style.zIndex="100",Ie.style.position="absolute",Ie.style.top=i,Ie.style.left=s,Ie.style.border="blue 5px solid",Ie.style.transform="scaleY(-1)",document.body.appendChild(Ie),or=Ie.getContext("2d")),(Ie.width!==t.width||Ie.height!==t.height)&&(Ie.width=t.width/2,Ie.height=t.height/2,Ie.style.width="400px",Ie.style.height="400px");const a=t.device.readPixelsToArrayWebGL(t),l=or==null?void 0:or.createImageData(t.width,t.height);if(l){for(let u=0;u<a.length;u+=4)l.data[0+u+0]=a[u+0]*o,l.data[0+u+1]=a[u+1]*o,l.data[0+u+2]=a[u+2]*o,l.data[0+u+3]=r?255:a[u+3]*o;or==null||or.putImageData(l,0,0)}}function Hh(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!Hh(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!Hh(t[s],e[s],n-1))return!1;return!0}return!1}function QM(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function JM(t){return Array.isArray(t)?t.length===0||typeof t[0]=="number":!1}function Jw(t){return QM(t)||JM(t)}function GM(t){return Jw(t)||typeof t=="number"||typeof t=="boolean"}function Gw(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];GM(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}class eI{constructor(e){d(this,"modules");d(this,"moduleUniforms");d(this,"moduleBindings");const n=Tp(Object.values(e).filter(r=>r.dependencies));for(const r of n)e[r.name]=r;z.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={};for(const[r,i]of Object.entries(e))this._addModule(i),i.name&&r!==i.name&&z.warn(`Module name: ${r} vs ${i.name}`)()}destroy(){}setProps(e){var n;for(const r of Object.keys(e)){const i=r,s=e[i]||{},o=this.modules[i];if(!o){z.warn(`Module ${r} not found`)();continue}const a=this.moduleUniforms[i],l=this.moduleBindings[i],c=((n=o.getUniforms)==null?void 0:n.call(o,s,a))||s,{uniforms:u,bindings:f}=Gw(c);this.moduleUniforms[i]={...a,...u},this.moduleBindings[i]={...l,...f}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){const e={};for(const n of Object.values(this.moduleBindings))Object.assign(e,n);return e}getDebugTable(){var n;const e={};for(const[r,i]of Object.entries(this.moduleUniforms))for(const[s,o]of Object.entries(i))e[`${r}.${s}`]={type:(n=this.modules[r].uniformTypes)==null?void 0:n[s],value:String(o)};return e}_addModule(e){const n=e.name;this.moduleUniforms[n]=e.defaultUniforms||{},this.moduleBindings[n]={}}}let tI="";async function nI(t,e){const n=new Image;return n.crossOrigin=(e==null?void 0:e.crossOrigin)||"anonymous",n.src=t.startsWith("http")?t:tI+t,await n.decode(),e?await createImageBitmap(n,e):await createImageBitmap(n)}class Om{constructor(e,n){d(this,"device");d(this,"texture");d(this,"sampler");d(this,"view");d(this,"ready");d(this,"isReady",!1);d(this,"destroyed",!1);d(this,"resolveReady",()=>{});d(this,"rejectReady",()=>{});this.device=e,typeof(n==null?void 0:n.data)=="string"&&n.dimension==="2d"&&(n={...n,data:nI(n.data)}),this.ready=new Promise((r,i)=>{this.resolveReady=()=>{this.isReady=!0,r()},this.rejectReady=i}),this.initAsync(n)}async initAsync(e){let n,r;const i=e.data,s=await e1(i).then(n,r);if(this.destroyed)return;const o={...e,data:s};this.texture=this.device.createTexture(o),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw new Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){const n=this.texture;this.texture=n.clone(e),n.destroy()}return!0}}async function e1(t){if(t=await t,Array.isArray(t))return await Promise.all(t.map(e1));if(t&&typeof t=="object"&&t.constructor===Object){const e=t,n=await Promise.all(Object.values(e)),r=Object.keys(e),i={};for(let s=0;s<r.length;s++)i[r[s]]=n[s];return i}return t}const Xr=2,rI=1e4,Tc=class Tc{constructor(e,n){d(this,"device");d(this,"id");d(this,"source");d(this,"vs");d(this,"fs");d(this,"pipelineFactory");d(this,"shaderFactory");d(this,"userData",{});d(this,"parameters");d(this,"topology");d(this,"bufferLayout");d(this,"isInstanced");d(this,"instanceCount",0);d(this,"vertexCount");d(this,"indexBuffer",null);d(this,"bufferAttributes",{});d(this,"constantAttributes",{});d(this,"bindings",{});d(this,"uniforms",{});d(this,"vertexArray");d(this,"transformFeedback",null);d(this,"pipeline");d(this,"shaderInputs");d(this,"_uniformStore");d(this,"_attributeInfos",{});d(this,"_gpuGeometry",null);d(this,"_getModuleUniforms");d(this,"props");d(this,"_pipelineNeedsUpdate","newly created");d(this,"_needsRedraw","initializing");d(this,"_destroyed",!1);d(this,"_lastDrawTimestamp",-1);d(this,"_lastLogTime",0);d(this,"_logOpen",!1);d(this,"_drawCount",0);var a,l,c,u;this.props={...Tc.defaultProps,...n},n=this.props,this.id=n.id||Rp("model"),this.device=e,Object.assign(this.userData,n.userData);const r=Object.fromEntries(((a=this.props.modules)==null?void 0:a.map(f=>[f.name,f]))||[]);this.setShaderInputs(n.shaderInputs||new eI(r));const i=sI(e),s=(((l=this.props.modules)==null?void 0:l.length)>0?this.props.modules:(c=this.shaderInputs)==null?void 0:c.getModules())||[];if(this.device.type==="webgpu"&&this.props.source){(u=this.props).shaderLayout||(u.shaderLayout=_2(this.props.source));const{source:f,getUniforms:h}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:i,...this.props,modules:s});this.source=f,this._getModuleUniforms=h}else{const{vs:f,fs:h,getUniforms:_}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:i,...this.props,modules:s});this.vs=f,this.fs=h,this._getModuleUniforms=_}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,n.geometry&&this.setGeometry(n.geometry),this.pipelineFactory=n.pipelineFactory||Vh.getDefaultPipelineFactory(this.device),this.shaderFactory=n.shaderFactory||jh.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in n&&(this.isInstanced=n.isInstanced),n.instanceCount&&this.setInstanceCount(n.instanceCount),n.vertexCount&&this.setVertexCount(n.vertexCount),n.indexBuffer&&this.setIndexBuffer(n.indexBuffer),n.attributes&&this.setAttributes(n.attributes),n.constantAttributes&&this.setConstantAttributes(n.constantAttributes),n.bindings&&this.setBindings(n.bindings),n.uniforms&&this.setUniforms(n.uniforms),n.moduleSettings&&this.updateModuleSettings(n.moduleSettings),n.transformFeedback&&(this.transformFeedback=n.transformFeedback),Object.seal(this)}destroy(){var e;this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),(e=this._gpuGeometry)==null||e.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");const e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||(this._needsRedraw=e)}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){this.predraw();let n;try{this._logDrawCallStart(),this.pipeline=this._updatePipeline();const r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),Wh(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);const{indexBuffer:i}=this.vertexArray,s=i?i.byteLength/(i.indexType==="uint32"?4:2):void 0;n=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{this._logDrawCallEnd()}return this._logFramebuffer(e),n?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",n}setGeometry(e){var r;(r=this._gpuGeometry)==null||r.destroy();const n=e&&XM(this.device,e);if(n){this.setTopology(n.topology||"triangle-list");const i=new Ku(this.bufferLayout);this.bufferLayout=i.mergeBufferLayouts(n.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(n)}this._gpuGeometry=n}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){const n=new Ku(this.bufferLayout);this.bufferLayout=this._gpuGeometry?n.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){Hh(e,this.parameters,2)||(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,this.isInstanced===void 0&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){this.shaderInputs=e,this._uniformStore=new Nx(this.shaderInputs.modules);for(const[n,r]of Object.entries(this.shaderInputs.modules))if(iI(r)){const i=this._uniformStore.getManagedUniformBuffer(this.device,n);this.bindings[`${n}Uniforms`]=i}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,n){const r=(n==null?void 0:n.disableWarnings)??this.props.disableWarnings;e.indices&&z.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();const i=new Ku(this.bufferLayout);for(const[s,o]of Object.entries(e)){const a=i.getBufferLayout(s);if(!a){r||z.warn(`Model(${this.id}): Missing layout for buffer "${s}".`)();continue}const l=i.getAttributeNamesForBuffer(a);let c=!1;for(const u of l){const f=this._attributeInfos[u];f&&(this.vertexArray.setBuffer(f.location,o),c=!0)}!c&&!r&&z.warn(`Model(${this.id}): Ignoring buffer "${o.id}" for unknown attribute "${s}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,n){for(const[r,i]of Object.entries(e)){const s=this._attributeInfos[r];s?this.vertexArray.setConstantWebGL(s.location,i):((n==null?void 0:n.disableWarnings)??this.props.disableWarnings)||z.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){Wh(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettings(e){const{bindings:n,uniforms:r}=Gw(this._getModuleUniforms(e));Object.assign(this.bindings,n),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_getBindings(){return Object.entries(this.bindings).reduce((e,[n,r])=>(r instanceof Om?r.isReady&&(e[n]=r.texture):e[n]=r,e),{})}_getBindingsUpdateTimestamp(){let e=0;for(const n of Object.values(this.bindings))n instanceof Pl?e=Math.max(e,n.texture.updateTimestamp):n instanceof ge||n instanceof ve?e=Math.max(e,n.updateTimestamp):n instanceof Om?e=n.texture?Math.max(e,n.texture.updateTimestamp):1/0:n instanceof Il||(e=Math.max(e,n.buffer.updateTimestamp));return e}_setGeometryAttributes(e){const n={...e.attributes};for(const[r]of Object.entries(n))!this.pipeline.shaderLayout.attributes.find(i=>i.name===r)&&r!=="positions"&&delete n[r];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(n,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||(this._pipelineNeedsUpdate=e),this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,n=null;this.pipeline&&(z.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,n=this.pipeline.fs),this._pipelineNeedsUpdate=!1;const r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders});let i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=gw(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),n&&this.shaderFactory.release(n)}return this.pipeline}_logDrawCallStart(){const e=z.level>3?0:rI;z.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,z.group(Xr,`>>> DRAWING MODEL ${this.id}`,{collapsed:z.level<=2})())}_logDrawCallEnd(){if(this._logOpen){const e=qM(this.pipeline.shaderLayout,this.id);z.table(Xr,e)();const n=this.shaderInputs.getDebugTable();for(const[i,s]of Object.entries(this.uniforms))n[i]={value:s};z.table(Xr,n)();const r=this._getAttributeDebugTable();z.table(Xr,this._attributeInfos)(),z.table(Xr,r)(),z.groupEnd(Xr)(),this._logOpen=!1}}_logFramebuffer(e){const n=this.device.props.debugFramebuffers;if(this._drawCount++,!n)return;const r=e.props.framebuffer;r&&ZM(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){const e={};for(const[n,r]of Object.entries(this._attributeInfos)){const i=this.vertexArray.attributes[r.location];e[r.location]={name:n,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){const{indexBuffer:n}=this.vertexArray,r=n.indexType==="uint32"?new Uint32Array(n.debugData):new Uint16Array(n.debugData);e.indices={name:"indices",type:n.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,n){const r=yw(n);return(e instanceof ge?new r(e.debugData):e).toString()}};d(Tc,"defaultProps",{...Di.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:xl.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0});let Hi=Tc;function iI(t){return!!(t.uniformTypes&&!Wh(t.uniformTypes))}function sI(t){return{type:t.type,shaderLanguage:t.info.shadingLanguage,shaderLanguageVersion:t.info.shadingLanguageVersion,gpu:t.info.gpu,features:t.features}}function Wh(t){for(const e in t)return!1;return!0}const Ys=class Ys{constructor(e,n=Ys.defaultProps){d(this,"device");d(this,"model");d(this,"transformFeedback");if(!Ys.isSupported(e))throw new Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new Hi(this.device,{id:n.id||"buffer-transform-model",fs:n.fs||FC(),topology:n.topology||"point-list",varyings:n.outputs||n.varyings,...n}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:n.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}static isSupported(e){var n;return((n=e==null?void 0:e.info)==null?void 0:n.type)==="webgl"}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e!=null&&e.inputBuffers&&this.model.setAttributes(e.inputBuffers),e!=null&&e.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);const n=this.device.beginRenderPass(e);this.model.draw(n),n.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){const n=this.getBuffer(e);if(!n)throw new Error("BufferTransform#getBuffer");if(n instanceof ge)return n.readAsync();const{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=n;return r.readAsync(i,s)}};d(Ys,"defaultProps",{...Hi.defaultProps,outputs:void 0,feedbackBuffers:void 0});let go=Ys;class t1{constructor(e){d(this,"id");d(this,"topology");d(this,"vertexCount");d(this,"indices");d(this,"attributes");d(this,"userData",{});const{attributes:n={},indices:r=null,vertexCount:i=null}=e;this.id=e.id||Rp("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={};for(const[s,o]of Object.entries(n)){const a=ArrayBuffer.isView(o)?{value:o}:o;if(!ArrayBuffer.isView(a.value))throw new Error(`${this._print(s)}: must be typed array or object with value as typed array`);if((s==="POSITION"||s==="positions")&&!a.size&&(a.size=3),s==="indices"){if(this.indices)throw new Error("Multiple indices detected");this.indices=a}else this.attributes[s]=a}this.indices&&this.indices.isIndexed!==void 0&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,n){return this}_calculateVertexCount(e,n){if(n)return n.value.length;let r=1/0;for(const i of Object.values(e)){const{value:s,size:o,constant:a}=i;!a&&s&&o!==void 0&&o>=1&&(r=Math.min(r,s.length/o))}return r}}const oI={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class n1 extends qc{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,pickingFBO:o,deviceRect:{x:a,y:l,width:c,height:u},cullRect:f,effects:h,pass:_="picking",pickZ:v,moduleParameters:E}){this.pickZ=v;const b=this._resetColorEncoder(v),g=[a,l,c,u],p=super.render({target:o,layers:e,layerFilter:n,views:r,viewports:i,onViewportActive:s,cullRect:f,effects:h==null?void 0:h.filter(S=>S.useInPicking),pass:_,isPicking:!0,moduleParameters:E,clearColor:[0,0,0,0],colorMask:15,scissorRect:g});return this._colorEncoderState=null,{decodePickingColor:b&&lI.bind(null,b),stats:p}}shouldDrawLayer(e){const{pickable:n,operation:r}=e.props;return n&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getModuleParameters(){return{picking:{isActive:1,isAttribute:this.pickZ},lightSources:{enabled:!1}}}getLayerParameters(e,n,r){const i={depthMask:!0,depthTest:!0,depthRange:[0,1],...e.props.parameters},{pickable:s,operation:o}=e.props;return!this._colorEncoderState||o.includes("terrain")?i.blend=!1:s&&o.includes("draw")&&(Object.assign(i,oI),i.blend=!0,i.blendColor=aI(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function aI(t,e,n){const{byLayer:r,byAlpha:i}=t;let s,o=r.get(e);return o?(o.viewports.push(n),s=o.a):(s=r.size+1,s<=255?(o={a:s,layer:e,viewports:[n]},r.set(e,o),i[s]=o):(ne.warn("Too many pickable layers, only picking the first 255")(),s=0)),[0,0,0,s/255]}function lI(t,e){const n=t.byAlpha[e[3]];return n&&{pickedLayer:n.layer,pickedViewports:n.viewports,pickedObjectIndex:n.layer.decodePickingColor(e)}}const Jr={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},Xl=Symbol.for("component"),Zn=Symbol.for("propTypes"),sf=Symbol.for("deprecatedProps"),Ai=Symbol.for("asyncPropDefaults"),Ir=Symbol.for("asyncPropOriginal"),Vn=Symbol.for("asyncPropResolved");function Cp(t,e=()=>!0){return Array.isArray(t)?r1(t,e,[]):e(t)?[t]:[]}function r1(t,e,n){let r=-1;for(;++r<t.length;){const i=t[r];Array.isArray(i)?r1(i,e,n):e(i)&&n.push(i)}return n}function cI({target:t,source:e,start:n=0,count:r=1}){const i=e.length,s=r*i;let o=0;for(let a=n;o<i;o++)t[a++]=e[o];for(;o<s;)o<s-o?(t.copyWithin(n+o,n,n+o),o*=2):(t.copyWithin(n+o,n,n+s-o),o=s);return t}class uI{constructor(e,n,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(n)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,n){if(e===this._data&&!n)return;this._data=e;const r=++this._loadCount;let i=e;typeof e=="string"&&(i=Al(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=s)}).catch(s=>{this._loadCount===r&&(this.isLoaded=!0,this._error=s||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e);for(const s of this._subscribers)s.onChange(this.getData())}}class fI{constructor(e){var n;this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:(n=e.device)==null?void 0:n.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return e.startsWith(this.protocol)?!0:e in this._resources}add({resourceId:e,data:n,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(n,r):(s=new uI(e,n,this._context),this._resources[e]=s),s.persistent=i}remove(e){const n=this._resources[e];n&&(n.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){const n=this._consumers[e];if(n){for(const r in n){const i=n[r],s=this._resources[i.resourceId];s&&s.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:n,consumerId:r,requestId:i="default"}){const{_resources:s,protocol:o}=this;e.startsWith(o)&&(e=e.replace(o,""),s[e]||this.add({resourceId:e,data:null,persistent:!1}));const a=s[e];if(this._track(r,i,a,n),a)return a.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(const e in this._resources)this._resources[e].delete()}_track(e,n,r,i){const s=this._consumers,o=s[e]=s[e]||{};let a=o[n];const l=a&&a.resourceId&&this._resources[a.resourceId];l&&(l.unsubscribe(a),this.prune()),r&&(a?(a.onChange=i,a.resourceId=r.id):a={onChange:i,resourceId:r.id},o[n]=a,r.subscribe(a))}_prune(){this._pruneRequest=null;for(const e of Object.keys(this._resources)){const n=this._resources[e];!n.persistent&&!n.inUse()&&(n.delete(),delete this._resources[e])}}}const hI="layerManager.setLayers",dI="layerManager.activateViewport";class pI{constructor(e,n){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{$e(dI,this,a),a&&(this.context.viewport=a)};const{deck:r,stats:i,viewport:s,timeline:o}=n||{};this.layers=[],this.resourceManager=new fI({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e==null?void 0:e.gl,deck:r,shaderAssembler:lM(),defaultShaderModules:[wP],renderPass:void 0,stats:i||new Xc({id:"deck.gl"}),viewport:s||new Wl({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:o||new Qw,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){this.resourceManager.finalize();for(const e of this.layers)this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);for(const r of this.layers){const i=r.getNeedsRedraw(e);n=n||i}return n}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(n=>e.find(r=>n.id.indexOf(r)===0)):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,n){$e(hI,this,n,e),this._lastRenderedLayers=e;const r=Cp(e,Boolean);for(const i of r)i.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){const e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){const{defaultShaderModules:n}=this.context;n.find(r=>r.name===e.name)||(n.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){const{defaultShaderModules:n}=this.context,r=n.findIndex(i=>i.name===e.name);r>=0&&(n.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,n,r){r.raiseError(n,`${e} of ${r}`)}_updateLayers(e,n){const r={};for(const o of e)r[o.id]?ne.warn(`Multiple old layers with same id ${o.id}`)():r[o.id]=o;if(this._defaultShaderModulesChanged){for(const o of e)o.setNeedsUpdate(),o.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}const i=[];this._updateSublayersRecursively(n,r,i),this._finalizeOldLayers(r);let s=!1;for(const o of i)if(o.hasUniformTransition()){s=`Uniform transition in ${o}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,n,r){for(const i of e){i.context=this.context;const s=n[i.id];s===null&&ne.warn(`Multiple new layers with same id ${i.id}`)(),n[i.id]=null;let o=null;try{this._debug&&s!==i&&i.validateProps(),s?(this._transferLayerState(s,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),o=i.isComposite?i.getSubLayers():null}catch(a){this._handleError("matching",a,i)}o&&this._updateSublayersRecursively(o,n,r)}}_finalizeOldLayers(e){for(const n in e){const r=e[n];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=Jr.INITIALIZED}catch(n){this._handleError("initialization",n,e)}}_transferLayerState(e,n){n._transferState(e),n.lifecycle=Jr.MATCHED,n!==e&&(e.lifecycle=Jr.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(n){this._handleError("update",n,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=Jr.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=Jr.FINALIZED}catch(n){this._handleError("finalization",n,e)}}}function dt(t,e,n){if(t===e)return!0;if(!n||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(!dt(t[r],e[r],n-1))return!1;return!0}if(Array.isArray(e))return!1;if(typeof t=="object"&&typeof e=="object"){const r=Object.keys(t),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!e.hasOwnProperty(s)||!dt(t[s],e[s],n-1))return!1;return!0}return!1}class gI{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(const e in this.controllers){const n=this.controllers[e];n&&n.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(const e in this.controllers){const n=this.controllers[e];n&&n.updateTransition()}}getViewports(e){return e?this._viewports.filter(n=>n.containsPixel(e)):this._viewports}getViews(){const e={};return this.views.forEach(n=>{e[n.id]=n}),e}getView(e){return this.views.find(n=>n.id===e)}getViewState(e){const n=typeof e=="string"?this.getView(e):e,r=n&&this.viewState[n.getViewStateId()]||this.viewState;return n?n.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,n){const r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){const o=r[s];if(o.containsPixel(i)){const a=e.slice();return a[0]-=o.x,a[1]-=o.y,o.unproject(a,n)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,n){(e!==this.width||n!==this.height)&&(this.width=e,this.height=n,this.setNeedsUpdate("Size changed"))}_setViews(e){e=Cp(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(!dt(e,this.viewState,3)&&this.setNeedsUpdate("viewState changed"),this.viewState=e):ne.warn("missing `viewState` or `initialViewState`")()}_createController(e,n){const r=n.type;return new r({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:s=>{var o;return(o=this.getView(e.id))==null?void 0:o.makeViewport({viewState:s,width:this.width,height:this.height})}})}_updateController(e,n,r,i){const s=e.controller;if(s&&r){const o={...n,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return(!i||i.constructor!==s.type)&&(i=this._createController(e,o)),i&&i.setProps(o),i}return null}_rebuildViewports(){const{views:e}=this,n=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){const s=e[i],o=this.getViewState(s),a=s.makeViewport({viewState:o,width:this.width,height:this.height});let l=n[s.id];const c=!!s.controller;c&&!l&&(r=!0),(r||!c)&&l&&(l.finalize(),l=null),this.controllers[s.id]=this._updateController(s,o,a,l),a&&this._viewports.unshift(a)}for(const i in n){const s=n[i];s&&!this.controllers[i]&&s.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,n){return e.length!==n.length?!0:e.some((r,i)=>!e[i].equals(n[i]))}}const _I=/([0-9]+\.?[0-9]*)(%|px)/;function Cn(t){switch(typeof t){case"number":return{position:t,relative:!1};case"string":const e=_I.exec(t);if(e&&e.length>=3){const n=e[2]==="%",r=parseFloat(e[1]);return{position:n?r/100:r,relative:n}}default:throw new Error(`Could not parse position string ${t}`)}}function xn(t,e){return t.relative?Math.round(t.position*e):t.position}class Wi{constructor(e){const{id:n,x:r=0,y:i=0,width:s="100%",height:o="100%",padding:a=null}=e;this.id=n||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=Cn(r),this._y=Cn(i),this._width=Cn(s),this._height=Cn(o),this._padding=a&&{left:Cn(a.left||0),right:Cn(a.right||0),top:Cn(a.top||0),bottom:Cn(a.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e?!0:this.ViewportType===e.ViewportType&&dt(this.props,e.props,2)}makeViewport({width:e,height:n,viewState:r}){r=this.filterViewState(r);const i=this.getDimensions({width:e,height:n});return!i.height||!i.width?null:new this.ViewportType({...r,...this.props,...i})}getViewStateId(){const{viewState:e}=this.props;return typeof e=="string"?e:(e==null?void 0:e.id)||this.id}filterViewState(e){if(this.props.viewState&&typeof this.props.viewState=="object"){if(!this.props.viewState.id)return this.props.viewState;const n={...e};for(const r in this.props.viewState)r!=="id"&&(n[r]=this.props.viewState[r]);return n}return e}getDimensions({width:e,height:n}){const r={x:xn(this._x,e),y:xn(this._y,n),width:xn(this._width,e),height:xn(this._height,n)};return this._padding&&(r.padding={left:xn(this._padding.left,e),top:xn(this._padding.top,n),right:xn(this._padding.right,e),bottom:xn(this._padding.bottom,n)}),r}get controller(){const e=this.props.controller;return e?e===!0?{type:this.ControllerType}:typeof e=="function"?{type:e}:{type:this.ControllerType,...e}:null}}class Zc{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){var n,r;this.cancel(),this.settings=e,this._inProgress=!0,(r=(n=this.settings).onStart)==null||r.call(n,this)}end(){var e,n;this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,(n=(e=this.settings).onEnd)==null||n.call(e,this))}cancel(){var e,n;this._inProgress&&((n=(e=this.settings).onInterrupt)==null||n.call(e,this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){var e,n;if(!this._inProgress)return!1;if(this._handle===null){const{_timeline:r,settings:i}=this;this._handle=r.addChannel({delay:r.getTime(),duration:i.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),(n=(e=this.settings).onUpdate)==null||n.call(e,this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}const Fm=()=>{},$h={BREAK:1,SNAP_TO_END:2,IGNORE:3},mI=t=>t,yI=$h.BREAK;class vI{constructor(e){this._onTransitionUpdate=n=>{const{time:r,settings:{interpolator:i,startProps:s,endProps:o,duration:a,easing:l}}=n,c=l(r/a),u=i.interpolateProps(s,o,c);this.propsInTransition=this.getControllerState({...this.props,...u}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new Zc(e.timeline),this.onViewStateChange=e.onViewStateChange||Fm,this.onStateChange=e.onStateChange||Fm}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let n=!1;const r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){const{interruption:s,endProps:o}=this.transition.settings;i={...r,...s===$h.SNAP_TO_END?o:this.propsInTransition||r}}this._triggerTransition(i,e),n=!0}else this.transition.cancel();return n}updateTransition(){this.transition.update()}_isTransitionEnabled(e){const{transitionDuration:n,transitionInterpolator:r}=e;return(n>0||n==="auto")&&!!r}_isUpdateDueToCurrentTransition(e){return this.transition.inProgress&&this.propsInTransition?this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition):!1}_shouldIgnoreViewportChange(e,n){return this.transition.inProgress?this.transition.settings.interruption===$h.IGNORE||this._isUpdateDueToCurrentTransition(n):this._isTransitionEnabled(n)?n.transitionInterpolator.arePropsEqual(e,n):!0}_triggerTransition(e,n){const r=this.getControllerState(e),i=this.getControllerState(n).shortestPathFrom(r),s=n.transitionInterpolator,o=s.getDuration?s.getDuration(e,n):n.transitionDuration;if(o===0)return;const a=s.initializeProps(e,i);this.propsInTransition={};const l={duration:o,easing:n.transitionEasing||mI,interpolator:s,interruption:n.transitionInterruption||yI,startProps:a.start,endProps:a.end,onStart:n.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(n.onTransitionInterrupt),onEnd:this._onTransitionEnd(n.onTransitionEnd)};this.transition.start(l),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return n=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e==null||e(n)}}}function Ye(t,e){if(!t)throw new Error(e||"deck.gl: assertion failed.")}class TI{constructor(e){const{compare:n,extract:r,required:i}=e;this._propsToCompare=n,this._propsToExtract=r||n,this._requiredProps=i}arePropsEqual(e,n){for(const r of this._propsToCompare)if(!(r in e)||!(r in n)||!Li(e[r],n[r]))return!1;return!0}initializeProps(e,n){const r={},i={};for(const s of this._propsToExtract)(s in e||s in n)&&(r[s]=e[s],i[s]=n[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,n){return n.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(n=>{const r=e[n];Ye(Number.isFinite(r)||Array.isArray(r),`${n} is required for transition`)})}}const wI=["longitude","latitude","zoom","bearing","pitch"],EI=["longitude","latitude","zoom"];class i1 extends TI{constructor(e={}){const n=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(n)?{compare:n,required:n}:n||{compare:wI,required:EI},super(r.transitionProps),this.opts=r}initializeProps(e,n){const r=super.initializeProps(e,n),{makeViewport:i,around:s}=this.opts;if(i&&s){const o=i(e),a=i(n),l=o.unproject(s);r.start.around=s,Object.assign(r.end,{around:a.project(l),aroundPosition:l,width:n.width,height:n.height})}return r}interpolateProps(e,n,r){const i={};for(const s of this._propsToExtract)i[s]=Bl(e[s]||0,n[s]||0,r);if(n.aroundPosition&&this.opts.makeViewport){const s=this.opts.makeViewport({...n,...i});Object.assign(i,s.panByPosition(n.aroundPosition,Bl(e.around,n.around,r)))}return i}}const Pn={transitionDuration:0},SI=300,Ea=t=>1-(1-t)*(1-t),Yr={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],TRIPLE_PAN:["tripanstart","tripanmove","tripanend"],DOUBLE_TAP:["doubletap"],KEYBOARD:["keydown"]},ar={};class bI{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new vI({...e,getControllerState:n=>new this.ControllerState(n),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){var e;for(const n in this._events)this._events[n]&&((e=this.eventManager)==null||e.off(n,this.handleEvent));this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;const n=this._eventStartBlocked;switch(e.type){case"panstart":return n?!1:this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return n?!1:this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"tripanstart":return n?!1:this._onTriplePanStart(e);case"tripanmove":return this._onTriplePan(e);case"tripanend":return this._onTriplePanEnd(e);case"doubletap":return this._onDoubleTap(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){const{x:n,y:r}=this.props,{offsetCenter:i}=e;return[i.x-n,i.y-r]}isPointInBounds(e,n){const{width:r,height:i}=this.props;if(n&&n.handled)return!1;const s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&n&&n.stopPropagation(),s}isFunctionKeyPressed(e){const{srcEvent:n}=e;return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){const n=setTimeout(()=>{this._eventStartBlocked===n&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=n}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);const{inertia:n}=e;this.inertia=Number.isFinite(n)?n:n===!0?SI:0;const{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:o=!0,touchZoom:a=!0,touchRotate:l=!1,keyboard:c=!0}=e,u=!!this.onViewStateChange;this.toggleEvents(Yr.WHEEL,u&&r),this.toggleEvents(Yr.PAN,u),this.toggleEvents(Yr.PINCH,u&&(a||l)),this.toggleEvents(Yr.TRIPLE_PAN,u&&l),this.toggleEvents(Yr.DOUBLE_TAP,u&&o),this.toggleEvents(Yr.KEYBOARD,u&&c),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=o,this.touchZoom=a,this.touchRotate=l,this.keyboard=c}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,n){this.eventManager&&e.forEach(r=>{this._events[r]!==n&&(this._events[r]=n,n?this.eventManager.on(r,this.handleEvent):this.eventManager.off(r,this.handleEvent))})}updateViewport(e,n=null,r={}){const i={...e.getViewportProps(),...n},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){const o=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:o,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||this.dragMode==="pan")&&(r=!r);const i=this.controllerState[r?"panStart":"rotateStart"]({pos:n});return this._panMove=r,this.updateViewport(i,Pn,{isDragging:!0}),!0}_onPan(e){return this.isDragging()?this._panMove?this._onPanMove(e):this._onPanRotate(e):!1}_onPanEnd(e){return this.isDragging()?this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e):!1}_onPanMove(e){if(!this.dragPan)return!1;const n=this.getCenter(e),r=this.controllerState.pan({pos:n});return this.updateViewport(r,Pn,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){const{inertia:n}=this;if(this.dragPan&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Ea},{isDragging:!1,isPanning:!0})}else{const r=this.controllerState.panEnd();this.updateViewport(r,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;const n=this.getCenter(e),r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Pn,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){const{inertia:n}=this;if(this.dragRotate&&n&&e.velocity){const r=this.getCenter(e),i=[r[0]+e.velocityX*n/2,r[1]+e.velocityY*n/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Ea},{isDragging:!1,isRotating:!0})}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;e.srcEvent.preventDefault();const{speed:r=.01,smooth:i=!1}=this.scrollZoom===!0?{}:this.scrollZoom,{delta:s}=e;let o=2/(1+Math.exp(-Math.abs(s*r)));s<0&&o!==0&&(o=1/o);const a=this.controllerState.zoom({pos:n,scale:o});return this.updateViewport(a,{...this._getTransitionProps({around:n}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onTriplePanStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.rotateStart({pos:n});return this.updateViewport(r,Pn,{isDragging:!0}),!0}_onTriplePan(e){if(!this.touchRotate||!this.isDragging())return!1;const n=this.getCenter(e);n[0]-=e.deltaX;const r=this.controllerState.rotate({pos:n});return this.updateViewport(r,Pn,{isDragging:!0,isRotating:!0}),!0}_onTriplePanEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this;if(this.touchRotate&&n&&e.velocityY){const r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*n/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:n,transitionEasing:Ea},{isDragging:!1,isRotating:!0}),this.blockEvents(n)}else{const r=this.controllerState.rotateEnd();this.updateViewport(r,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.controllerState.zoomStart({pos:n}).rotateStart({pos:n});return ar._startPinchRotation=e.rotation,ar._lastPinchEvent=e,this.updateViewport(r,Pn,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let n=this.controllerState;if(this.touchZoom){const{scale:r}=e,i=this.getCenter(e);n=n.zoom({pos:i,scale:r})}if(this.touchRotate){const{rotation:r}=e;n=n.rotate({deltaAngleX:ar._startPinchRotation-r})}return this.updateViewport(n,Pn,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),ar._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;const{inertia:n}=this,{_lastPinchEvent:r}=ar;if(this.touchZoom&&n&&r&&e.scale!==r.scale){const i=this.getCenter(e);let s=this.controllerState.rotateEnd();const o=Math.log2(e.scale),a=(o-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),l=Math.pow(2,o+a*n/2);s=s.zoom({pos:i,scale:l}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:n,transitionEasing:Ea},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(n)}else{const i=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(i,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return ar._startPinchRotation=null,ar._lastPinchEvent=null,!0}_onDoubleTap(e){if(!this.doubleClickZoom)return!1;const n=this.getCenter(e);if(!this.isPointInBounds(n,e))return!1;const r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:n,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:n}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){if(!this.keyboard)return!1;const n=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:i,rotateSpeedX:s,rotateSpeedY:o}=this.keyboard===!0?{}:this.keyboard,{controllerState:a}=this;let l;const c={};switch(e.srcEvent.code){case"Minus":l=n?a.zoomOut(r).zoomOut(r):a.zoomOut(r),c.isZooming=!0;break;case"Equal":l=n?a.zoomIn(r).zoomIn(r):a.zoomIn(r),c.isZooming=!0;break;case"ArrowLeft":n?(l=a.rotateLeft(s),c.isRotating=!0):(l=a.moveLeft(i),c.isPanning=!0);break;case"ArrowRight":n?(l=a.rotateRight(s),c.isRotating=!0):(l=a.moveRight(i),c.isPanning=!0);break;case"ArrowUp":n?(l=a.rotateUp(o),c.isRotating=!0):(l=a.moveUp(i),c.isPanning=!0);break;case"ArrowDown":n?(l=a.rotateDown(o),c.isRotating=!0):(l=a.moveDown(i),c.isPanning=!0);break;default:return!1}return this.updateViewport(l,this._getTransitionProps(),c),!0}_getTransitionProps(e){const{transition:n}=this;return!n||!n.transitionInterpolator?Pn:e?{...n,transitionInterpolator:new i1({...e,...n.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:n}}class AI{constructor(e,n){this._viewportProps=this.applyConstraints(e),this._state=n}getViewportProps(){return this._viewportProps}getState(){return this._state}}const Dm=5,RI=1.2;class CI extends AI{constructor(e){const{width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a=0,pitch:l=0,altitude:c=1.5,position:u=[0,0,0],maxZoom:f=20,minZoom:h=0,maxPitch:_=60,minPitch:v=0,startPanLngLat:E,startZoomLngLat:b,startRotatePos:g,startBearing:p,startPitch:y,startZoom:S,normalize:R=!0}=e;Ye(Number.isFinite(s)),Ye(Number.isFinite(i)),Ye(Number.isFinite(o)),super({width:n,height:r,latitude:i,longitude:s,zoom:o,bearing:a,pitch:l,altitude:c,maxZoom:f,minZoom:h,maxPitch:_,minPitch:v,normalize:R,position:u},{startPanLngLat:E,startZoomLngLat:b,startRotatePos:g,startBearing:p,startPitch:y,startZoom:S}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:n}){const r=this.getState().startPanLngLat||this._unproject(n);if(!r)return this;const s=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(s)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:n=0,deltaAngleY:r=0}){const{startRotatePos:i,startBearing:s,startPitch:o}=this.getState();if(!i||s===void 0||o===void 0)return this;let a;return e?a=this._getNewRotation(e,i,o,s):a={bearing:s+n,pitch:o+r},this._getUpdatedState(a)}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:n,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(n)||this._unproject(e)),!s)return this;const{maxZoom:o,minZoom:a}=this.getViewportProps();let l=i+Math.log2(r);l=zn(l,a,o);const c=this.makeViewport({...this.getViewportProps(),zoom:l});return this._getUpdatedState({zoom:l,...c.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){const n=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-n.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-n.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){const{maxZoom:n,minZoom:r,zoom:i}=e;e.zoom=zn(i,r,n);const{maxPitch:s,minPitch:o,pitch:a}=e;e.pitch=zn(a,o,s);const{normalize:l=!0}=e;return l&&Object.assign(e,YP(e)),e}_zoomFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.zoom({pos:[n/2,r/2],scale:e})}_panFromCenter(e){const{width:n,height:r}=this.getViewportProps();return this.pan({startPos:[n/2,r/2],pos:[n/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){const n=this.makeViewport(this.getViewportProps());return e&&n.unproject(e)}_getNewRotation(e,n,r,i){const s=e[0]-n[0],o=e[1]-n[1],a=e[1],l=n[1],{width:c,height:u}=this.getViewportProps(),f=s/c;let h=0;o>0?Math.abs(u-l)>Dm&&(h=o/(l-u)*RI):o<0&&l>Dm&&(h=1-a/l),h=zn(h,-1,1);const{minPitch:_,maxPitch:v}=this.getViewportProps(),E=i+180*f;let b=r;return h>0?b=r+h*(v-r):h<0&&(b=r-h*(_-r)),{pitch:b,bearing:E}}}class xI extends bI{constructor(){super(...arguments),this.ControllerState=CI,this.transition={transitionDuration:300,transitionInterpolator:new i1({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];const n=this.props;super.setProps(e),(!n||n.height!==e.height)&&this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}const Wp=class Wp extends Wi{constructor(e={}){super(e)}get ViewportType(){return $l}get ControllerType(){return xI}};Wp.displayName="MapView";let Yl=Wp;const PI=new Ap;function MI(t,e){const n=t.order??1/0,r=e.order??1/0;return n-r}class II{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){const n=this._defaultEffects;if(!n.find(r=>r.id===e.id)){const r=n.findIndex(i=>MI(i,e)>0);r<0?n.push(e):n.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&(dt(e.effects,this.effects,1)||this._setEffects(e.effects))}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}getEffects(){return this._resolvedEffects}_setEffects(e){const n={};for(const i of this.effects)n[i.id]=i;const r=[];for(const i of e){const s=n[i.id];let o=i;s&&s!==i?s.setProps?(s.setProps(i.props),o=s):s.cleanup(this._context):s||i.setup(this._context),r.push(o),delete n[i.id]}for(const i in n)n[i].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(i=>i instanceof Ap)||this._resolvedEffects.push(PI),this._needsRedraw="effects changed"}finalize(){for(const e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class NI extends qc{shouldDrawLayer(e){const{operation:n}=e.props;return n.includes("draw")||n.includes("terrain")}}const kI="deckRenderer.renderLayers";class OI{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new NI(e),this.pickLayersPass=new n1(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;const n=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);const i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);const s=n.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,$e(kI,this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){const n=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),n}finalize(){const{renderBuffers:e}=this;for(const n of e)n.delete();e.length=0}_preRender(e,n){this.lastPostProcessEffect=null,n.preRenderStats=n.preRenderStats||{};for(const r of e)n.preRenderStats[r.id]=r.preRender(n),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){const{renderBuffers:e}=this,n=this.device.canvasContext.getDrawingBufferSize();e.length===0&&[0,1].map(r=>{const i=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${r}`,colorAttachments:[i]}))});for(const r of e)r.resize(n)}_postRender(e,n){const{renderBuffers:r}=this,i={...n,inputBuffer:r[0],swapBuffer:r[1]};for(const s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?n.target:void 0;const o=s.postRender(i);i.inputBuffer=o,i.swapBuffer=o===r[0]?r[1]:r[0]}}}const FI={pickedColor:null,pickedObjectIndex:-1};function DI({pickedColors:t,decodePickingColor:e,deviceX:n,deviceY:r,deviceRadius:i,deviceRect:s}){const{x:o,y:a,width:l,height:c}=s;let u=i*i,f=-1,h=0;for(let _=0;_<c;_++){const v=_+a-r,E=v*v;if(E>u)h+=4*l;else for(let b=0;b<l;b++){if(t[h+3]-1>=0){const p=b+o-n,y=p*p+E;y<=u&&(u=y,f=h)}h+=4}}if(f>=0){const _=t.slice(f,f+4),v=e(_);if(v){const E=Math.floor(f/4/l),b=f/4-E*l;return{...v,pickedColor:_,pickedX:o+b,pickedY:a+E}}ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}return FI}function BI({pickedColors:t,decodePickingColor:e}){const n=new Map;if(t){for(let r=0;r<t.length;r+=4)if(t[r+3]-1>=0){const s=t.slice(r,r+4),o=s.join(",");if(!n.has(o)){const a=e(s);a?n.set(o,{...a,color:s}):ne.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(n.values())}function s1({pickInfo:t,viewports:e,pixelRatio:n,x:r,y:i,z:s}){let o=e[0];e.length>1&&(o=LI((t==null?void 0:t.pickedViewports)||e,{x:r,y:i}));let a;if(o){const l=[r-o.x,i-o.y];s!==void 0&&(l[2]=s),a=o.unproject(l)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:i,pixel:[r,i],coordinate:a,devicePixel:t&&"pickedX"in t?[t.pickedX,t.pickedY]:void 0,pixelRatio:n}}function UI(t){const{pickInfo:e,lastPickedInfo:n,mode:r,layers:i}=t,{pickedColor:s,pickedLayer:o,pickedObjectIndex:a}=e,l=o?[o]:[];if(r==="hover"){const f=n.index,h=n.layerId,_=o?o.props.id:null;if(_!==h||a!==f){if(_!==h){const v=i.find(E=>E.props.id===h);v&&l.unshift(v)}n.layerId=_,n.index=a,n.info=null}}const c=s1(t),u=new Map;return u.set(null,c),l.forEach(f=>{let h={...c};f===o&&(h.color=s,h.index=a,h.picked=!0),h=o1({layer:f,info:h,mode:r});const _=h.layer;f===o&&r==="hover"&&(n.info=h),u.set(_.id,h),r==="hover"&&_.updateAutoHighlight(h)}),u}function o1({layer:t,info:e,mode:n}){for(;t&&e;){const r=e.layer||null;e.sourceLayer=r,e.layer=t,e=t.getPickingInfo({info:e,mode:n,sourceLayer:r}),t=t.parent}return e}function LI(t,e){for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.containsPixel(e))return r}return t[0]}class zI{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new n1(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:n,layers:r,viewports:i},s=this.lastPickedInfo.info){const o=s&&s.layer&&s.layer.id,a=s&&s.viewport&&s.viewport.id,l=o?r.find(h=>h.id===o):null,c=a&&i.find(h=>h.id===a)||i[0],u=c&&c.unproject([e-c.x,n-c.y]);return{...s,...{x:e,y:n,viewport:c,coordinate:u,layer:l}}}_resizeBuffer(){var n,r;if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){const i=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=i}const{canvas:e}=this.device.getCanvasContext();(n=this.pickingFBO)==null||n.resize({width:e.width,height:e.height}),(r=this.depthFBO)==null||r.resize({width:e.width,height:e.height})}_getPickable(e){if(this._pickable===!1)return null;const n=e.filter(r=>this.pickLayersPass.shouldDrawLayer(r)&&!r.isComposite);return n.length?n:null}_pickClosestObject({layers:e,views:n,viewports:r,x:i,y:s,radius:o=0,depth:a=1,mode:l="query",unproject3D:c,onViewportActive:u,effects:f}){const h=this.device.canvasContext.cssToDeviceRatio(),_=this._getPickable(e);if(!_||r.length===0)return{result:[],emptyInfo:s1({viewports:r,x:i,y:s,pixelRatio:h})};this._resizeBuffer();const v=this.device.canvasContext.cssToDevicePixels([i,s],!0),E=[v.x+Math.floor(v.width/2),v.y+Math.floor(v.height/2)],b=Math.round(o*h),{width:g,height:p}=this.pickingFBO,y=this._getPickingRect({deviceX:E[0],deviceY:E[1],deviceRadius:b,deviceWidth:g,deviceHeight:p}),S={x:i-o,y:s-o,width:o*2+1,height:o*2+1};let R;const P=[],O=new Set;for(let M=0;M<a;M++){let k;if(y){const F=this._drawAndSample({layers:_,views:n,viewports:r,onViewportActive:u,deviceRect:y,cullRect:S,effects:f,pass:`picking:${l}`});k=DI({...F,deviceX:E[0],deviceY:E[1],deviceRadius:b,deviceRect:y})}else k={pickedColor:null,pickedObjectIndex:-1};let D;if(k.pickedLayer&&c&&this.depthFBO){const{pickedColors:F}=this._drawAndSample({layers:[k.pickedLayer],views:n,viewports:r,onViewportActive:u,deviceRect:{x:k.pickedX,y:k.pickedY,width:1,height:1},cullRect:S,effects:f,pass:`picking:${l}:z`},!0);F[3]&&(D=F[0])}k.pickedLayer&&M+1<a&&(O.add(k.pickedLayer),k.pickedLayer.disablePickingIndex(k.pickedObjectIndex)),R=UI({pickInfo:k,lastPickedInfo:this.lastPickedInfo,mode:l,layers:_,viewports:r,x:i,y:s,z:D,pixelRatio:h});for(const F of R.values())F.layer&&P.push(F);if(!k.pickedColor)break}for(const M of O)M.restorePickingColors();return{result:P,emptyInfo:R.get(null)}}_pickVisibleObjects({layers:e,views:n,viewports:r,x:i,y:s,width:o=1,height:a=1,mode:l="query",maxObjects:c=null,onViewportActive:u,effects:f}){const h=this._getPickable(e);if(!h||r.length===0)return[];this._resizeBuffer();const _=this.device.canvasContext.cssToDeviceRatio(),v=this.device.canvasContext.cssToDevicePixels([i,s],!0),E=v.x,b=v.y+v.height,g=this.device.canvasContext.cssToDevicePixels([i+o,s+a],!0),p=g.x+g.width,y=g.y,S={x:E,y,width:p-E,height:b-y},R=this._drawAndSample({layers:h,views:n,viewports:r,onViewportActive:u,deviceRect:S,cullRect:{x:i,y:s,width:o,height:a},effects:f,pass:`picking:${l}`}),P=BI(R),O=new Map,M=[],k=Number.isFinite(c);for(let D=0;D<P.length&&!(k&&M.length>=c);D++){const F=P[D];let B={color:F.pickedColor,layer:null,index:F.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:_};B=o1({layer:F.pickedLayer,info:B,mode:l});const V=B.layer.id;O.has(V)||O.set(V,new Set);const H=O.get(V),Z=B.object??B.index;H.has(Z)||(H.add(Z),M.push(B))}return M}_drawAndSample({layers:e,views:n,viewports:r,onViewportActive:i,deviceRect:s,cullRect:o,effects:a,pass:l},c=!1){const u=c?this.depthFBO:this.pickingFBO,f={layers:e,layerFilter:this.layerFilter,views:n,viewports:r,onViewportActive:i,pickingFBO:u,deviceRect:s,cullRect:o,effects:a,pass:l,pickZ:c,preRenderStats:{}};for(const p of a)p.useInPicking&&(f.preRenderStats[p.id]=p.preRender(f));const{decodePickingColor:h}=this.pickLayersPass.render(f),{x:_,y:v,width:E,height:b}=s,g=new(c?Float32Array:Uint8Array)(E*b*4);return this.device.readPixelsToArrayWebGL(u,{sourceX:_,sourceY:v,sourceWidth:E,sourceHeight:b,target:g}),{pickedColors:g,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:n,deviceRadius:r,deviceWidth:i,deviceHeight:s}){const o=Math.max(0,e-r),a=Math.max(0,n-r),l=Math.min(i,e+r+1)-o,c=Math.min(s,n+r+1)-a;return l<=0||c<=0?null:{x:o,y:a,width:l,height:c}}}const VI={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},jI="top-left",Bm="__root";class HI{constructor({deck:e,parentElement:n}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=n}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!dt(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(const e of this.getWidgets())this._remove(e);this.defaultWidgets.length=0,this.resolvedWidgets.length=0;for(const e in this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(n=>n.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){const n={};for(const r of this.resolvedWidgets)n[r.id]=r;this.resolvedWidgets.length=0;for(const r of this.defaultWidgets)n[r.id]=null,this.resolvedWidgets.push(r);for(let r of e){const i=n[r.id];i?i.viewId!==r.viewId||i.placement!==r.placement?(this._remove(i),this._add(r)):r!==i&&(i.setProps(r.props),r=i):this._add(r),n[r.id]=null,this.resolvedWidgets.push(r)}for(const r in n){const i=n[r];i&&this._remove(i)}this.widgets=e}_add(e){const{viewId:n=null,placement:r=jI}=e,i=e.onAdd({deck:this.deck,viewId:n});i&&this._getContainer(n,r).append(i),e._element=i}_remove(e){e.onRemove(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,n){var o;const r=e||Bm;let i=this.containers[r];i||(i=document.createElement("div"),i.style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",(o=this.parentElement)==null||o.append(i),this.containers[r]=i);let s=i.querySelector(`.${n}`);return s||(s=document.createElement("div"),s.className=n,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,VI[n]),i.append(s)),s}_updateContainers(){const e=this.deck.width,n=this.deck.height;for(const r in this.containers){const i=this.lastViewports[r]||null,s=r===Bm||i,o=this.containers[r];s?(o.style.display="block",o.style.left=`${i?i.x:0}px`,o.style.top=`${i?i.y:0}px`,o.style.width=`${i?i.width:e}px`,o.style.height=`${i?i.height:n}px`):o.style.display="none"}}onRedraw({viewports:e,layers:n}){var s,o;const r=e.reduce((a,l)=>(a[l.id]=l,a),{}),{lastViewports:i}=this;for(const a of this.getWidgets()){const{viewId:l}=a;if(l){const c=r[l];c&&(a.onViewportChange&&!c.equals(i[l])&&a.onViewportChange(c),(s=a.onRedraw)==null||s.call(a,{viewports:[c],layers:n}))}else{if(a.onViewportChange)for(const c of e)c.equals(i[c.id])||a.onViewportChange(c);(o=a.onRedraw)==null||o.call(a,{viewports:e,layers:n})}}this.lastViewports=r,this._updateContainers()}onHover(e,n){var r,i;for(const s of this.getWidgets()){const{viewId:o}=s;(!o||o===((r=e.viewport)==null?void 0:r.id))&&((i=s.onHover)==null||i.call(s,e,n))}}onEvent(e,n){var i,s;const r=Bh[n.type];if(r)for(const o of this.getWidgets()){const{viewId:a}=o;(!a||a===((i=e.viewport)==null?void 0:i.id))&&((s=o[r.handler])==null||s.call(o,e,n))}}}const WI={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class $I{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){const n=document.createElement("div");return n.className="deck-tooltip",Object.assign(n.style,WI),this.deck=e,this.element=n,n}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){var n;this.isVisible&&e.id===((n=this.lastViewport)==null?void 0:n.id)&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){const{deck:n}=this,r=n&&n.props.getTooltip;if(!r)return;const i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,n,r){const i=this.element;if(i){if(typeof e=="string")i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${n}px, ${r}px)`,e&&typeof e=="object"&&"style"in e&&Object.assign(i.style,e.style)}}}var hi;(function(t){t[t.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",t[t.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",t[t.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_COLOR=768]="SRC_COLOR",t[t.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",t[t.SRC_ALPHA=770]="SRC_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",t[t.DST_ALPHA=772]="DST_ALPHA",t[t.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",t[t.DST_COLOR=774]="DST_COLOR",t[t.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=32769]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t.FUNC_ADD=32774]="FUNC_ADD",t[t.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",t[t.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",t[t.BLEND_EQUATION=32777]="BLEND_EQUATION",t[t.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",t[t.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",t[t.BLEND_DST_RGB=32968]="BLEND_DST_RGB",t[t.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",t[t.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",t[t.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",t[t.BLEND_COLOR=32773]="BLEND_COLOR",t[t.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",t[t.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t.LINE_WIDTH=2849]="LINE_WIDTH",t[t.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",t[t.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",t[t.CULL_FACE_MODE=2885]="CULL_FACE_MODE",t[t.FRONT_FACE=2886]="FRONT_FACE",t[t.DEPTH_RANGE=2928]="DEPTH_RANGE",t[t.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",t[t.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",t[t.DEPTH_FUNC=2932]="DEPTH_FUNC",t[t.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",t[t.STENCIL_FUNC=2962]="STENCIL_FUNC",t[t.STENCIL_FAIL=2964]="STENCIL_FAIL",t[t.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",t[t.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",t[t.STENCIL_REF=2967]="STENCIL_REF",t[t.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",t[t.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",t[t.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",t[t.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",t[t.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",t[t.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",t[t.VIEWPORT=2978]="VIEWPORT",t[t.SCISSOR_BOX=3088]="SCISSOR_BOX",t[t.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",t[t.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",t[t.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",t[t.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",t[t.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",t[t.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",t[t.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",t[t.RED_BITS=3410]="RED_BITS",t[t.GREEN_BITS=3411]="GREEN_BITS",t[t.BLUE_BITS=3412]="BLUE_BITS",t[t.ALPHA_BITS=3413]="ALPHA_BITS",t[t.DEPTH_BITS=3414]="DEPTH_BITS",t[t.STENCIL_BITS=3415]="STENCIL_BITS",t[t.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",t[t.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",t[t.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",t[t.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",t[t.SAMPLES=32937]="SAMPLES",t[t.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",t[t.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",t[t.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",t[t.VENDOR=7936]="VENDOR",t[t.RENDERER=7937]="RENDERER",t[t.VERSION=7938]="VERSION",t[t.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",t[t.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",t[t.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",t[t.STATIC_DRAW=35044]="STATIC_DRAW",t[t.STREAM_DRAW=35040]="STREAM_DRAW",t[t.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.BUFFER_SIZE=34660]="BUFFER_SIZE",t[t.BUFFER_USAGE=34661]="BUFFER_USAGE",t[t.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",t[t.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t.CULL_FACE=2884]="CULL_FACE",t[t.FRONT=1028]="FRONT",t[t.BACK=1029]="BACK",t[t.FRONT_AND_BACK=1032]="FRONT_AND_BACK",t[t.BLEND=3042]="BLEND",t[t.DEPTH_TEST=2929]="DEPTH_TEST",t[t.DITHER=3024]="DITHER",t[t.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",t[t.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",t[t.SCISSOR_TEST=3089]="SCISSOR_TEST",t[t.STENCIL_TEST=2960]="STENCIL_TEST",t[t.NO_ERROR=0]="NO_ERROR",t[t.INVALID_ENUM=1280]="INVALID_ENUM",t[t.INVALID_VALUE=1281]="INVALID_VALUE",t[t.INVALID_OPERATION=1282]="INVALID_OPERATION",t[t.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",t[t.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",t[t.CW=2304]="CW",t[t.CCW=2305]="CCW",t[t.DONT_CARE=4352]="DONT_CARE",t[t.FASTEST=4353]="FASTEST",t[t.NICEST=4354]="NICEST",t[t.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",t[t.BYTE=5120]="BYTE",t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.SHORT=5122]="SHORT",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.INT=5124]="INT",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.FLOAT=5126]="FLOAT",t[t.DOUBLE=5130]="DOUBLE",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.ALPHA=6406]="ALPHA",t[t.RGB=6407]="RGB",t[t.RGBA=6408]="RGBA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",t[t.VERTEX_SHADER=35633]="VERTEX_SHADER",t[t.COMPILE_STATUS=35713]="COMPILE_STATUS",t[t.DELETE_STATUS=35712]="DELETE_STATUS",t[t.LINK_STATUS=35714]="LINK_STATUS",t[t.VALIDATE_STATUS=35715]="VALIDATE_STATUS",t[t.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",t[t.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",t[t.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",t[t.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",t[t.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",t[t.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t.SHADER_TYPE=35663]="SHADER_TYPE",t[t.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",t[t.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",t[t.NEVER=512]="NEVER",t[t.LESS=513]="LESS",t[t.EQUAL=514]="EQUAL",t[t.LEQUAL=515]="LEQUAL",t[t.GREATER=516]="GREATER",t[t.NOTEQUAL=517]="NOTEQUAL",t[t.GEQUAL=518]="GEQUAL",t[t.ALWAYS=519]="ALWAYS",t[t.KEEP=7680]="KEEP",t[t.REPLACE=7681]="REPLACE",t[t.INCR=7682]="INCR",t[t.DECR=7683]="DECR",t[t.INVERT=5386]="INVERT",t[t.INCR_WRAP=34055]="INCR_WRAP",t[t.DECR_WRAP=34056]="DECR_WRAP",t[t.NEAREST=9728]="NEAREST",t[t.LINEAR=9729]="LINEAR",t[t.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",t[t.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",t[t.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",t[t.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",t[t.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",t[t.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",t[t.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",t[t.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE=5890]="TEXTURE",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t.TEXTURE0=33984]="TEXTURE0",t[t.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",t[t.REPEAT=10497]="REPEAT",t[t.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t[t.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",t[t.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",t[t.FLOAT_VEC2=35664]="FLOAT_VEC2",t[t.FLOAT_VEC3=35665]="FLOAT_VEC3",t[t.FLOAT_VEC4=35666]="FLOAT_VEC4",t[t.INT_VEC2=35667]="INT_VEC2",t[t.INT_VEC3=35668]="INT_VEC3",t[t.INT_VEC4=35669]="INT_VEC4",t[t.BOOL=35670]="BOOL",t[t.BOOL_VEC2=35671]="BOOL_VEC2",t[t.BOOL_VEC3=35672]="BOOL_VEC3",t[t.BOOL_VEC4=35673]="BOOL_VEC4",t[t.FLOAT_MAT2=35674]="FLOAT_MAT2",t[t.FLOAT_MAT3=35675]="FLOAT_MAT3",t[t.FLOAT_MAT4=35676]="FLOAT_MAT4",t[t.SAMPLER_2D=35678]="SAMPLER_2D",t[t.SAMPLER_CUBE=35680]="SAMPLER_CUBE",t[t.LOW_FLOAT=36336]="LOW_FLOAT",t[t.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",t[t.HIGH_FLOAT=36338]="HIGH_FLOAT",t[t.LOW_INT=36339]="LOW_INT",t[t.MEDIUM_INT=36340]="MEDIUM_INT",t[t.HIGH_INT=36341]="HIGH_INT",t[t.FRAMEBUFFER=36160]="FRAMEBUFFER",t[t.RENDERBUFFER=36161]="RENDERBUFFER",t[t.RGBA4=32854]="RGBA4",t[t.RGB5_A1=32855]="RGB5_A1",t[t.RGB565=36194]="RGB565",t[t.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",t[t.STENCIL_INDEX=6401]="STENCIL_INDEX",t[t.STENCIL_INDEX8=36168]="STENCIL_INDEX8",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t[t.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",t[t.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",t[t.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",t[t.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",t[t.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",t[t.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",t[t.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",t[t.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",t[t.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",t[t.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",t[t.NONE=0]="NONE",t[t.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",t[t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",t[t.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",t[t.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",t[t.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",t[t.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",t[t.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",t[t.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t.READ_BUFFER=3074]="READ_BUFFER",t[t.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",t[t.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",t[t.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",t[t.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",t[t.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",t[t.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",t[t.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",t[t.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",t[t.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",t[t.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",t[t.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",t[t.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",t[t.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",t[t.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",t[t.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",t[t.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",t[t.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",t[t.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",t[t.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",t[t.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",t[t.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",t[t.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",t[t.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",t[t.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",t[t.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",t[t.RED=6403]="RED",t[t.RGB8=32849]="RGB8",t[t.RGBA8=32856]="RGBA8",t[t.RGB10_A2=32857]="RGB10_A2",t[t.TEXTURE_3D=32879]="TEXTURE_3D",t[t.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",t[t.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",t[t.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",t[t.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",t[t.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",t[t.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",t[t.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",t[t.SRGB=35904]="SRGB",t[t.SRGB8=35905]="SRGB8",t[t.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",t[t.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",t[t.RGBA32F=34836]="RGBA32F",t[t.RGB32F=34837]="RGB32F",t[t.RGBA16F=34842]="RGBA16F",t[t.RGB16F=34843]="RGB16F",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",t[t.R11F_G11F_B10F=35898]="R11F_G11F_B10F",t[t.RGB9_E5=35901]="RGB9_E5",t[t.RGBA32UI=36208]="RGBA32UI",t[t.RGB32UI=36209]="RGB32UI",t[t.RGBA16UI=36214]="RGBA16UI",t[t.RGB16UI=36215]="RGB16UI",t[t.RGBA8UI=36220]="RGBA8UI",t[t.RGB8UI=36221]="RGB8UI",t[t.RGBA32I=36226]="RGBA32I",t[t.RGB32I=36227]="RGB32I",t[t.RGBA16I=36232]="RGBA16I",t[t.RGB16I=36233]="RGB16I",t[t.RGBA8I=36238]="RGBA8I",t[t.RGB8I=36239]="RGB8I",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.R8=33321]="R8",t[t.RG8=33323]="RG8",t[t.R16F=33325]="R16F",t[t.R32F=33326]="R32F",t[t.RG16F=33327]="RG16F",t[t.RG32F=33328]="RG32F",t[t.R8I=33329]="R8I",t[t.R8UI=33330]="R8UI",t[t.R16I=33331]="R16I",t[t.R16UI=33332]="R16UI",t[t.R32I=33333]="R32I",t[t.R32UI=33334]="R32UI",t[t.RG8I=33335]="RG8I",t[t.RG8UI=33336]="RG8UI",t[t.RG16I=33337]="RG16I",t[t.RG16UI=33338]="RG16UI",t[t.RG32I=33339]="RG32I",t[t.RG32UI=33340]="RG32UI",t[t.R8_SNORM=36756]="R8_SNORM",t[t.RG8_SNORM=36757]="RG8_SNORM",t[t.RGB8_SNORM=36758]="RGB8_SNORM",t[t.RGBA8_SNORM=36759]="RGBA8_SNORM",t[t.RGB10_A2UI=36975]="RGB10_A2UI",t[t.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",t[t.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.HALF_FLOAT=5131]="HALF_FLOAT",t[t.RG=33319]="RG",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",t[t.CURRENT_QUERY=34917]="CURRENT_QUERY",t[t.QUERY_RESULT=34918]="QUERY_RESULT",t[t.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",t[t.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",t[t.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",t[t.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",t[t.DRAW_BUFFER0=34853]="DRAW_BUFFER0",t[t.DRAW_BUFFER1=34854]="DRAW_BUFFER1",t[t.DRAW_BUFFER2=34855]="DRAW_BUFFER2",t[t.DRAW_BUFFER3=34856]="DRAW_BUFFER3",t[t.DRAW_BUFFER4=34857]="DRAW_BUFFER4",t[t.DRAW_BUFFER5=34858]="DRAW_BUFFER5",t[t.DRAW_BUFFER6=34859]="DRAW_BUFFER6",t[t.DRAW_BUFFER7=34860]="DRAW_BUFFER7",t[t.DRAW_BUFFER8=34861]="DRAW_BUFFER8",t[t.DRAW_BUFFER9=34862]="DRAW_BUFFER9",t[t.DRAW_BUFFER10=34863]="DRAW_BUFFER10",t[t.DRAW_BUFFER11=34864]="DRAW_BUFFER11",t[t.DRAW_BUFFER12=34865]="DRAW_BUFFER12",t[t.DRAW_BUFFER13=34866]="DRAW_BUFFER13",t[t.DRAW_BUFFER14=34867]="DRAW_BUFFER14",t[t.DRAW_BUFFER15=34868]="DRAW_BUFFER15",t[t.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",t[t.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",t[t.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",t[t.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",t[t.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",t[t.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",t[t.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",t[t.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",t[t.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",t[t.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",t[t.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",t[t.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",t[t.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",t[t.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",t[t.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",t[t.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",t[t.SAMPLER_3D=35679]="SAMPLER_3D",t[t.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",t[t.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",t[t.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",t[t.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",t[t.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",t[t.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",t[t.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",t[t.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",t[t.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",t[t.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",t[t.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",t[t.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",t[t.MAX_SAMPLES=36183]="MAX_SAMPLES",t[t.SAMPLER_BINDING=35097]="SAMPLER_BINDING",t[t.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",t[t.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",t[t.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",t[t.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",t[t.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",t[t.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",t[t.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",t[t.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",t[t.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",t[t.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",t[t.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",t[t.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",t[t.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",t[t.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",t[t.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",t[t.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",t[t.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",t[t.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",t[t.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",t[t.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",t[t.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",t[t.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",t[t.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",t[t.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",t[t.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",t[t.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",t[t.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",t[t.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",t[t.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",t[t.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",t[t.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",t[t.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",t[t.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",t[t.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",t[t.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",t[t.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",t[t.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",t[t.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",t[t.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",t[t.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",t[t.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",t[t.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",t[t.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",t[t.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",t[t.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",t[t.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t[t.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",t[t.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",t[t.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",t[t.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",t[t.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",t[t.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",t[t.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",t[t.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",t[t.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",t[t.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",t[t.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",t[t.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",t[t.UNIFORM_TYPE=35383]="UNIFORM_TYPE",t[t.UNIFORM_SIZE=35384]="UNIFORM_SIZE",t[t.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",t[t.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",t[t.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",t[t.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",t[t.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",t[t.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",t[t.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",t[t.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",t[t.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",t[t.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",t[t.OBJECT_TYPE=37138]="OBJECT_TYPE",t[t.SYNC_CONDITION=37139]="SYNC_CONDITION",t[t.SYNC_STATUS=37140]="SYNC_STATUS",t[t.SYNC_FLAGS=37141]="SYNC_FLAGS",t[t.SYNC_FENCE=37142]="SYNC_FENCE",t[t.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",t[t.UNSIGNALED=37144]="UNSIGNALED",t[t.SIGNALED=37145]="SIGNALED",t[t.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",t[t.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",t[t.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",t[t.WAIT_FAILED=37149]="WAIT_FAILED",t[t.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",t[t.COLOR=6144]="COLOR",t[t.DEPTH=6145]="DEPTH",t[t.STENCIL=6146]="STENCIL",t[t.MIN=32775]="MIN",t[t.MAX=32776]="MAX",t[t.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",t[t.STREAM_READ=35041]="STREAM_READ",t[t.STREAM_COPY=35042]="STREAM_COPY",t[t.STATIC_READ=35045]="STATIC_READ",t[t.STATIC_COPY=35046]="STATIC_COPY",t[t.DYNAMIC_READ=35049]="DYNAMIC_READ",t[t.DYNAMIC_COPY=35050]="DYNAMIC_COPY",t[t.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",t[t.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",t[t.INVALID_INDEX=4294967295]="INVALID_INDEX",t[t.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",t[t.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",t[t.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",t[t.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",t[t.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",t[t.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",t[t.R16_EXT=33322]="R16_EXT",t[t.RG16_EXT=33324]="RG16_EXT",t[t.RGB16_EXT=32852]="RGB16_EXT",t[t.RGBA16_EXT=32859]="RGBA16_EXT",t[t.R16_SNORM_EXT=36760]="R16_SNORM_EXT",t[t.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",t[t.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",t[t.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",t[t.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",t[t.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",t[t.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",t[t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",t[t.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",t[t.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",t[t.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",t[t.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",t[t.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",t[t.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",t[t.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",t[t.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",t[t.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",t[t.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",t[t.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",t[t.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",t[t.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",t[t.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",t[t.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",t[t.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",t[t.LINE_WEBGL=6913]="LINE_WEBGL",t[t.FILL_WEBGL=6914]="FILL_WEBGL",t[t.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",t[t.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",t[t.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",t[t.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",t[t.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",t[t.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",t[t.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",t[t.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",t[t.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",t[t.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",t[t.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",t[t.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",t[t.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",t[t.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",t[t.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",t[t.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",t[t.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",t[t.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",t[t.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",t[t.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",t[t.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",t[t.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",t[t.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",t[t.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"})(hi||(hi={}));const xp={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:4294967295,36005:4294967295,2962:519,2967:0,2963:4294967295,34816:519,36003:0,36004:4294967295,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},Ae=(t,e,n)=>e?t.enable(n):t.disable(n),Um=(t,e,n)=>t.hint(n,e),lt=(t,e,n)=>t.pixelStorei(n,e),Lm=(t,e,n)=>{const r=n===36006?36009:36008;return t.bindFramebuffer(r,e)},_s=(t,e,n)=>{const i={34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[n];t.bindBuffer(i,e)};function of(t){return Array.isArray(t)||ArrayBuffer.isView(t)&&!(t instanceof DataView)}const XI={3042:Ae,32773:(t,e)=>t.blendColor(...e),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(t,e)=>t.clearColor(...e),3107:(t,e)=>t.colorMask(...e),2884:Ae,2885:(t,e)=>t.cullFace(e),2929:Ae,2931:(t,e)=>t.clearDepth(e),2932:(t,e)=>t.depthFunc(e),2928:(t,e)=>t.depthRange(...e),2930:(t,e)=>t.depthMask(e),3024:Ae,35723:Um,35725:(t,e)=>t.useProgram(e),36007:(t,e)=>t.bindRenderbuffer(36161,e),36389:(t,e)=>{var n;return(n=t.bindTransformFeedback)==null?void 0:n.call(t,36386,e)},34229:(t,e)=>t.bindVertexArray(e),36006:Lm,36010:Lm,34964:_s,36662:_s,36663:_s,35053:_s,35055:_s,2886:(t,e)=>t.frontFace(e),33170:Um,2849:(t,e)=>t.lineWidth(e),32823:Ae,32824:"polygonOffset",10752:"polygonOffset",35977:Ae,32926:Ae,32928:Ae,32938:"sampleCoverage",32939:"sampleCoverage",3089:Ae,3088:(t,e)=>t.scissor(...e),2960:Ae,2961:(t,e)=>t.clearStencil(e),2968:(t,e)=>t.stencilMaskSeparate(1028,e),36005:(t,e)=>t.stencilMaskSeparate(1029,e),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(t,e)=>t.viewport(...e),34383:Ae,10754:Ae,12288:Ae,12289:Ae,12290:Ae,12291:Ae,12292:Ae,12293:Ae,12294:Ae,12295:Ae,3333:lt,3317:lt,37440:lt,37441:lt,37443:lt,3330:lt,3332:lt,3331:lt,3314:lt,32878:lt,3316:lt,3315:lt,32877:lt,framebuffer:(t,e)=>{const n=e&&"handle"in e?e.handle:e;return t.bindFramebuffer(36160,n)},blend:(t,e)=>e?t.enable(3042):t.disable(3042),blendColor:(t,e)=>t.blendColor(...e),blendEquation:(t,e)=>{const n=typeof e=="number"?[e,e]:e;t.blendEquationSeparate(...n)},blendFunc:(t,e)=>{const n=(e==null?void 0:e.length)===2?[...e,...e]:e;t.blendFuncSeparate(...n)},clearColor:(t,e)=>t.clearColor(...e),clearDepth:(t,e)=>t.clearDepth(e),clearStencil:(t,e)=>t.clearStencil(e),colorMask:(t,e)=>t.colorMask(...e),cull:(t,e)=>e?t.enable(2884):t.disable(2884),cullFace:(t,e)=>t.cullFace(e),depthTest:(t,e)=>e?t.enable(2929):t.disable(2929),depthFunc:(t,e)=>t.depthFunc(e),depthMask:(t,e)=>t.depthMask(e),depthRange:(t,e)=>t.depthRange(...e),dither:(t,e)=>e?t.enable(3024):t.disable(3024),derivativeHint:(t,e)=>{t.hint(35723,e)},frontFace:(t,e)=>t.frontFace(e),mipmapHint:(t,e)=>t.hint(33170,e),lineWidth:(t,e)=>t.lineWidth(e),polygonOffsetFill:(t,e)=>e?t.enable(32823):t.disable(32823),polygonOffset:(t,e)=>t.polygonOffset(...e),sampleCoverage:(t,e)=>t.sampleCoverage(e[0],e[1]||!1),scissorTest:(t,e)=>e?t.enable(3089):t.disable(3089),scissor:(t,e)=>t.scissor(...e),stencilTest:(t,e)=>e?t.enable(2960):t.disable(2960),stencilMask:(t,e)=>{e=of(e)?e:[e,e];const[n,r]=e;t.stencilMaskSeparate(1028,n),t.stencilMaskSeparate(1029,r)},stencilFunc:(t,e)=>{e=of(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilFuncSeparate(1028,n,r,i),t.stencilFuncSeparate(1029,s,o,a)},stencilOp:(t,e)=>{e=of(e)&&e.length===3?[...e,...e]:e;const[n,r,i,s,o,a]=e;t.stencilOpSeparate(1028,n,r,i),t.stencilOpSeparate(1029,s,o,a)},viewport:(t,e)=>t.viewport(...e)};function ye(t,e,n){return e[t]!==void 0?e[t]:n[t]}const YI={blendEquation:(t,e,n)=>t.blendEquationSeparate(ye(32777,e,n),ye(34877,e,n)),blendFunc:(t,e,n)=>t.blendFuncSeparate(ye(32969,e,n),ye(32968,e,n),ye(32971,e,n),ye(32970,e,n)),polygonOffset:(t,e,n)=>t.polygonOffset(ye(32824,e,n),ye(10752,e,n)),sampleCoverage:(t,e,n)=>t.sampleCoverage(ye(32938,e,n),ye(32939,e,n)),stencilFuncFront:(t,e,n)=>t.stencilFuncSeparate(1028,ye(2962,e,n),ye(2967,e,n),ye(2963,e,n)),stencilFuncBack:(t,e,n)=>t.stencilFuncSeparate(1029,ye(34816,e,n),ye(36003,e,n),ye(36004,e,n)),stencilOpFront:(t,e,n)=>t.stencilOpSeparate(1028,ye(2964,e,n),ye(2965,e,n),ye(2966,e,n)),stencilOpBack:(t,e,n)=>t.stencilOpSeparate(1029,ye(34817,e,n),ye(34818,e,n),ye(34819,e,n))},zm={enable:(t,e)=>t({[e]:!0}),disable:(t,e)=>t({[e]:!1}),pixelStorei:(t,e,n)=>t({[e]:n}),hint:(t,e,n)=>t({[e]:n}),useProgram:(t,e)=>t({35725:e}),bindRenderbuffer:(t,e,n)=>t({36007:n}),bindTransformFeedback:(t,e,n)=>t({36389:n}),bindVertexArray:(t,e)=>t({34229:e}),bindFramebuffer:(t,e,n)=>{switch(e){case 36160:return t({36006:n,36010:n});case 36009:return t({36006:n});case 36008:return t({36010:n});default:return null}},bindBuffer:(t,e,n)=>{const r={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[e];return r?t({[r]:n}):{valueChanged:!0}},blendColor:(t,e,n,r,i)=>t({32773:new Float32Array([e,n,r,i])}),blendEquation:(t,e)=>t({32777:e,34877:e}),blendEquationSeparate:(t,e,n)=>t({32777:e,34877:n}),blendFunc:(t,e,n)=>t({32969:e,32968:n,32971:e,32970:n}),blendFuncSeparate:(t,e,n,r,i)=>t({32969:e,32968:n,32971:r,32970:i}),clearColor:(t,e,n,r,i)=>t({3106:new Float32Array([e,n,r,i])}),clearDepth:(t,e)=>t({2931:e}),clearStencil:(t,e)=>t({2961:e}),colorMask:(t,e,n,r,i)=>t({3107:[e,n,r,i]}),cullFace:(t,e)=>t({2885:e}),depthFunc:(t,e)=>t({2932:e}),depthRange:(t,e,n)=>t({2928:new Float32Array([e,n])}),depthMask:(t,e)=>t({2930:e}),frontFace:(t,e)=>t({2886:e}),lineWidth:(t,e)=>t({2849:e}),polygonOffset:(t,e,n)=>t({32824:e,10752:n}),sampleCoverage:(t,e,n)=>t({32938:e,32939:n}),scissor:(t,e,n,r,i)=>t({3088:new Int32Array([e,n,r,i])}),stencilMask:(t,e)=>t({2968:e,36005:e}),stencilMaskSeparate:(t,e,n)=>t({[e===1028?2968:36005]:n}),stencilFunc:(t,e,n,r)=>t({2962:e,2967:n,2963:r,34816:e,36003:n,36004:r}),stencilFuncSeparate:(t,e,n,r,i)=>t({[e===1028?2962:34816]:n,[e===1028?2967:36003]:r,[e===1028?2963:36004]:i}),stencilOp:(t,e,n,r)=>t({2964:e,2965:n,2966:r,34817:e,34818:n,34819:r}),stencilOpSeparate:(t,e,n,r,i)=>t({[e===1028?2964:34817]:n,[e===1028?2965:34818]:r,[e===1028?2966:34819]:i}),viewport:(t,e,n,r,i)=>t({2978:[e,n,r,i]})},Yt=(t,e)=>t.isEnabled(e),Vm={3042:Yt,2884:Yt,2929:Yt,3024:Yt,32823:Yt,32926:Yt,32928:Yt,3089:Yt,2960:Yt,35977:Yt},KI=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function Ji(t,e){if(ZI(e))return;const n={};for(const i in e){const s=Number(i),o=XI[i];o&&(typeof o=="string"?n[o]=!0:o(t,e[i],s))}const r=t.state&&t.state.cache;if(r)for(const i in n){const s=YI[i];s(t,e,r)}}function a1(t,e=xp){if(typeof e=="number"){const i=e,s=Vm[i];return s?s(t,i):t.getParameter(i)}const n=Array.isArray(e)?e:Object.keys(e),r={};for(const i of n){const s=Vm[i];r[i]=s?s(t,Number(i)):t.getParameter(Number(i))}return r}function qI(t){Ji(t,xp)}function ZI(t){for(const e in t)return!1;return!0}function QI(t,e){if(t===e)return!0;const n=Array.isArray(t)||ArrayBuffer.isView(t),r=Array.isArray(e)||ArrayBuffer.isView(e);if(n&&r&&t.length===e.length){for(let i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}return!1}class Sr{constructor(e,n){d(this,"gl");d(this,"program",null);d(this,"stateStack",[]);d(this,"enable",!0);d(this,"cache",null);d(this,"log");d(this,"initialized",!1);this.gl=e,this.log=(n==null?void 0:n.log)||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}static get(e){return e.state}push(e={}){this.stateStack.push({})}pop(){const e=this.stateStack[this.stateStack.length-1];Ji(this.gl,e),this.stateStack.pop()}trackState(e,n){if(this.cache=n.copyState?a1(e):Object.assign({},xp),this.initialized)throw new Error("WebGLStateTracker");this.initialized=!0,this.gl.state=this,GI(e);for(const r in zm){const i=zm[r];JI(e,r,i)}jm(e,"getParameter"),jm(e,"isEnabled")}_updateCache(e){let n=!1,r;const i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(const s in e){const o=e[s],a=this.cache[s];QI(o,a)||(n=!0,r=a,i&&!(s in i)&&(i[s]=a),this.cache[s]=o)}return{valueChanged:n,oldValue:r}}}function jm(t,e){const n=t[e].bind(t);t[e]=function(i){if(i===void 0||KI.has(i))return n(i);const s=Sr.get(t);return i in s.cache||(s.cache[i]=n(i)),s.enable?s.cache[i]:n(i)},Object.defineProperty(t[e],"name",{value:`${e}-from-cache`,configurable:!1})}function JI(t,e,n){if(!t[e])return;const r=t[e].bind(t);t[e]=function(...s){const o=Sr.get(t),{valueChanged:a,oldValue:l}=n(o._updateCache,...s);return a&&r(...s),l},Object.defineProperty(t[e],"name",{value:`${e}-to-cache`,configurable:!1})}function GI(t){const e=t.useProgram.bind(t);t.useProgram=function(r){const i=Sr.get(t);i.program!==r&&(e(r),i.program=r)}}function eN(t,e,n){let r="";const i={preserveDrawingBuffer:!0,...n};let s=null;if(s||(s=t.getContext("webgl2",i)),i.failIfMajorPerformanceCaveat&&(r||(r="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow.")),!s&&!n.failIfMajorPerformanceCaveat&&(i.failIfMajorPerformanceCaveat=!1,s=t.getContext("webgl2",i),s.luma||(s.luma={}),s.luma.softwareRenderer=!0),s||(s=t.getContext("webgl",{}),s&&(s=null,r||(r="Your browser only supports WebGL1"))),!s)throw r||(r="Your browser does not support WebGL"),new Error(`Failed to create WebGL context: ${r}`);const{onContextLost:o,onContextRestored:a}=e;return t.addEventListener("webglcontextlost",l=>o(l),!1),t.addEventListener("webglcontextrestored",l=>a(l),!1),s.luma||(s.luma={}),s}function $i(t,e,n){return n[e]===void 0&&(n[e]=t.getExtension(e)||null),n[e]}function tN(t,e){const n=t.getParameter(7936),r=t.getParameter(7937);$i(t,"WEBGL_debug_renderer_info",e);const i=e.WEBGL_debug_renderer_info,s=t.getParameter(i?i.UNMASKED_VENDOR_WEBGL:7936),o=t.getParameter(i?i.UNMASKED_RENDERER_WEBGL:7937),a=s||n,l=o||r,c=t.getParameter(7938),u=l1(a,l),f=nN(a,l),h=rN(a,l);return{type:"webgl",gpu:u,gpuType:h,gpuBackend:f,vendor:a,renderer:l,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}function l1(t,e){return/NVIDIA/i.exec(t)||/NVIDIA/i.exec(e)?"nvidia":/INTEL/i.exec(t)||/INTEL/i.exec(e)?"intel":/Apple/i.exec(t)||/Apple/i.exec(e)?"apple":/AMD/i.exec(t)||/AMD/i.exec(e)||/ATI/i.exec(t)||/ATI/i.exec(e)?"amd":/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e)?"software":"unknown"}function nN(t,e){return/Metal/i.exec(t)||/Metal/i.exec(e)?"metal":/ANGLE/i.exec(t)||/ANGLE/i.exec(e)?"opengl":"unknown"}function rN(t,e){if(/SwiftShader/i.exec(t)||/SwiftShader/i.exec(e))return"cpu";switch(l1(t,e)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}function c1(t){switch(t){case"uint8":return 5121;case"sint8":return 5120;case"unorm8":return 5121;case"snorm8":return 5120;case"uint16":return 5123;case"sint16":return 5122;case"unorm16":return 5123;case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw new Error(String(t))}const We="texture-compression-bc",se="texture-compression-astc",Kt="texture-compression-etc2",iN="texture-compression-etc1-webgl",Sa="texture-compression-pvrtc-webgl",af="texture-compression-atc-webgl",ba="float32-renderable-webgl",lf="float16-renderable-webgl",sN="rgb9e5ufloat_renderable-webgl",cf="snorm8-renderable-webgl",ms="norm16-renderable-webgl",uf="snorm16-renderable-webgl",Aa="float32-filterable",Hm="float16-filterable-webgl",As="WEBGL_compressed_texture_s3tc",Rs="WEBGL_compressed_texture_s3tc_srgb",di="EXT_texture_compression_rgtc",pi="EXT_texture_compression_bptc",oN="WEBGL_compressed_texture_etc",aN="WEBGL_compressed_texture_astc",lN="WEBGL_compressed_texture_etc1",cN="WEBGL_compressed_texture_pvrtc",uN="WEBGL_compressed_texture_atc",Wm="EXT_texture_norm16",$m="EXT_render_snorm",fN="EXT_color_buffer_float",Pp={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat_renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[$m],"norm16-renderable-webgl":[Wm],"snorm16-renderable-webgl":[Wm,$m],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[As,Rs,di,pi],"texture-compression-bc5-webgl":[di],"texture-compression-bc7-webgl":[pi],"texture-compression-etc2":[oN],"texture-compression-astc":[aN],"texture-compression-etc1-webgl":[lN],"texture-compression-pvrtc-webgl":[cN],"texture-compression-atc-webgl":[uN]};function hN(t){return t in Pp}function zs(t,e,n){return(Pp[e]||[]).every(i=>$i(t,i,n))}const Oo={r8unorm:{gl:33321,b:1,c:1,rb:!0},r8snorm:{gl:36756,b:1,c:1,render:cf},r8uint:{gl:33330,b:1,c:1,rb:!0},r8sint:{gl:33329,b:1,c:1,rb:!0},rg8unorm:{gl:33323,b:2,c:2,rb:!0},rg8snorm:{gl:36757,b:2,c:2,render:cf},rg8uint:{gl:33336,b:2,c:2,rb:!0},rg8sint:{gl:33335,b:2,c:2,rb:!0},r16uint:{gl:33332,b:2,c:1,rb:!0},r16sint:{gl:33331,b:2,c:1,rb:!0},r16float:{gl:33325,b:2,c:1,render:lf,filter:"float16-filterable-webgl",rb:!0},"r16unorm-webgl":{gl:33322,b:2,c:1,f:ms,rb:!0},"r16snorm-webgl":{gl:36760,b:2,c:1,f:uf},"rgba4unorm-webgl":{gl:32854,b:2,c:4,wgpu:!1,rb:!0},"rgb565unorm-webgl":{gl:36194,b:2,c:4,wgpu:!1,rb:!0},"rgb5a1unorm-webgl":{gl:32855,b:2,c:4,wgpu:!1,rb:!0},"rgb8unorm-webgl":{gl:32849,b:3,c:3,wgpu:!1},"rgb8snorm-webgl":{gl:36758,b:3,c:3,wgpu:!1},rgba8unorm:{gl:32856,b:4,c:2,bpp:4},"rgba8unorm-srgb":{gl:35907,b:4,c:4,bpp:4},rgba8snorm:{gl:36759,b:4,c:4,render:cf},rgba8uint:{gl:36220,b:4,c:4,bpp:4},rgba8sint:{gl:36238,b:4,c:4,bpp:4},bgra8unorm:{b:4,c:4},"bgra8unorm-srgb":{b:4,c:4},rg16uint:{gl:33338,b:4,c:1,bpp:4},rg16sint:{gl:33337,b:4,c:2,bpp:4},rg16float:{gl:33327,bpp:4,b:4,c:2,render:lf,filter:Hm,rb:!0},"rg16unorm-webgl":{gl:33324,b:2,c:2,render:ms},"rg16snorm-webgl":{gl:36761,b:2,c:2,render:uf},r32uint:{gl:33334,b:4,c:1,bpp:4,rb:!0},r32sint:{gl:33333,b:4,c:1,bpp:4,rb:!0},r32float:{gl:33326,bpp:4,b:4,c:1,render:ba,filter:Aa},rgb9e5ufloat:{gl:35901,b:4,c:3,p:1,render:sN},rg11b10ufloat:{gl:35898,b:4,c:3,p:1,render:ba,rb:!0},rgb10a2unorm:{gl:32857,b:4,c:4,p:1,rb:!0},"rgb10a2uint-webgl":{b:4,c:4,gl:36975,p:1,wgpu:!1,bpp:4,rb:!0},"rgb16unorm-webgl":{gl:32852,b:2,c:3,f:ms},"rgb16snorm-webgl":{gl:36762,b:2,c:3,f:ms},rg32uint:{gl:33340,b:8,c:2,rb:!0},rg32sint:{gl:33339,b:8,c:2,rb:!0},rg32float:{gl:33328,b:8,c:2,render:!1,filter:Aa,rb:!0},rgba16uint:{gl:36214,b:8,c:4,rb:!0},rgba16sint:{gl:36232,b:8,c:4,rb:!0},rgba16float:{gl:34842,b:8,c:4,render:lf,filter:Hm},"rgba16unorm-webgl":{gl:32859,b:2,c:4,render:ms,rb:!0},"rgba16snorm-webgl":{gl:36763,b:2,c:4,render:uf},"rgb32float-webgl":{gl:34837,render:ba,filter:Aa,gl2ext:fN,dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,b:16,c:4,rb:!0},rgba32sint:{gl:36226,b:16,c:4,rb:!0},rgba32float:{gl:34836,b:16,c:4,render:ba,filter:Aa,rb:!0},stencil8:{gl:36168,b:1,c:1,attachment:36128,rb:!0},depth16unorm:{gl:33189,b:2,c:1,attachment:36096,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,b:3,c:1,attachment:36096,dataFormat:6402,types:[5125]},depth32float:{gl:36012,b:4,c:1,attachment:36096,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,b:4,c:2,p:1,attachment:33306,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,b:5,c:2,p:1,attachment:33306,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:As,f:We},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:Rs,f:We},"bc1-rgba-unorm":{gl:33777,x:As,f:We},"bc1-rgba-unorm-srgb":{gl:35916,x:Rs,f:We},"bc2-rgba-unorm":{gl:33778,x:As,f:We},"bc2-rgba-unorm-srgb":{gl:35918,x:Rs,f:We},"bc3-rgba-unorm":{gl:33779,x:As,f:We},"bc3-rgba-unorm-srgb":{gl:35919,x:Rs,f:We},"bc4-r-unorm":{gl:36283,x:di,f:We},"bc4-r-snorm":{gl:36284,x:di,f:We},"bc5-rg-unorm":{gl:36285,x:di,f:We},"bc5-rg-snorm":{gl:36286,x:di,f:We},"bc6h-rgb-ufloat":{gl:36495,x:pi,f:We},"bc6h-rgb-float":{gl:36494,x:pi,f:We},"bc7-rgba-unorm":{gl:36492,x:pi,f:We},"bc7-rgba-unorm-srgb":{gl:36493,x:pi,f:We},"etc2-rgb8unorm":{gl:37492,f:Kt},"etc2-rgb8unorm-srgb":{gl:37494,f:Kt},"etc2-rgb8a1unorm":{gl:37496,f:Kt},"etc2-rgb8a1unorm-srgb":{gl:37497,f:Kt},"etc2-rgba8unorm":{gl:37493,f:Kt},"etc2-rgba8unorm-srgb":{gl:37495,f:Kt},"eac-r11unorm":{gl:37488,f:Kt},"eac-r11snorm":{gl:37489,f:Kt},"eac-rg11unorm":{gl:37490,f:Kt},"eac-rg11snorm":{gl:37491,f:Kt},"astc-4x4-unorm":{gl:37808,f:se},"astc-4x4-unorm-srgb":{gl:37840,f:se},"astc-5x4-unorm":{gl:37809,f:se},"astc-5x4-unorm-srgb":{gl:37841,f:se},"astc-5x5-unorm":{gl:37810,f:se},"astc-5x5-unorm-srgb":{gl:37842,f:se},"astc-6x5-unorm":{gl:37811,f:se},"astc-6x5-unorm-srgb":{gl:37843,f:se},"astc-6x6-unorm":{gl:37812,f:se},"astc-6x6-unorm-srgb":{gl:37844,f:se},"astc-8x5-unorm":{gl:37813,f:se},"astc-8x5-unorm-srgb":{gl:37845,f:se},"astc-8x6-unorm":{gl:37814,f:se},"astc-8x6-unorm-srgb":{gl:37846,f:se},"astc-8x8-unorm":{gl:37815,f:se},"astc-8x8-unorm-srgb":{gl:37847,f:se},"astc-10x5-unorm":{gl:37819,f:se},"astc-10x5-unorm-srgb":{gl:37851,f:se},"astc-10x6-unorm":{gl:37817,f:se},"astc-10x6-unorm-srgb":{gl:37849,f:se},"astc-10x8-unorm":{gl:37818,f:se},"astc-10x8-unorm-srgb":{gl:37850,f:se},"astc-10x10-unorm":{gl:37819,f:se},"astc-10x10-unorm-srgb":{gl:37851,f:se},"astc-12x10-unorm":{gl:37820,f:se},"astc-12x10-unorm-srgb":{gl:37852,f:se},"astc-12x12-unorm":{gl:37821,f:se},"astc-12x12-unorm-srgb":{gl:37853,f:se},"pvrtc-rgb4unorm-webgl":{gl:35840,f:Sa},"pvrtc-rgba4unorm-webgl":{gl:35842,f:Sa},"pvrtc-rbg2unorm-webgl":{gl:35841,f:Sa},"pvrtc-rgba2unorm-webgl":{gl:35843,f:Sa},"etc1-rbg-unorm-webgl":{gl:36196,f:iN},"atc-rgb-unorm-webgl":{gl:35986,f:af},"atc-rgba-unorm-webgl":{gl:35986,f:af},"atc-rgbai-unorm-webgl":{gl:34798,f:af}};function dN(t,e,n){const r=Oo[e];if(!r||r.gl===void 0)return!1;const i=r.f;if(i)return zs(t,i,n);const s=r.x||r.gl2ext;return s?!!$i(t,s,n):!0}function pN(t,e,n){return u1(t,e,n).filterable||!1}function gN(t,e,n){return u1(t,e,n).renderable||!1}function u1(t,e,n){const r=fw(e);if(!r)return{supported:!1};const i=Oo[e];if(!i)return{supported:!1};let s=i.gl!==void 0;s=s&&zs(t,i.f,n);const o=e.startsWith("depth")||e.startsWith("stencil"),a=r==null?void 0:r.signed,l=s&&!a&&i.render&&zs(t,i.render,n),c=s&&!o&&!a&&i.filter&&zs(t,i.filter,n);return{supported:s,renderable:l,filterable:c,blendable:!1,storable:!1}}function f1(t){var i;const e=Oo[t],n=yN(t),r=fw(t);return{internalFormat:n,format:(e==null?void 0:e.dataFormat)||mN(r.channels,r.integer,r.normalized,n),type:r.dataType?c1(r.dataType):((i=e==null?void 0:e.types)==null?void 0:i[0])||5121,compressed:r.compressed||!1}}function _N(t){const e=Oo[t];if(!(e!=null&&e.attachment))throw new Error(`${t} is not a depth stencil format`);return e.attachment}function mN(t,e,n,r){if(r===6408||r===6407)return r;switch(t){case"r":return e&&!n?36244:6403;case"rg":return e&&!n?33320:33319;case"rgb":return e&&!n?36248:6407;case"rgba":return e&&!n?36249:6408;case"bgra":throw new Error("bgra pixels not supported by WebGL");default:return 6408}}function yN(t){const e=Oo[t],n=e==null?void 0:e.gl;if(n===void 0)throw new Error(`Unsupported texture format ${t}`);return n}const Xm={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class vN extends QC{constructor(n,r,i){super([],i);d(this,"gl");d(this,"extensions");d(this,"testedFeatures",new Set);this.gl=n,this.extensions=r,$i(n,"EXT_color_buffer_float",r)}*[Symbol.iterator](){const n=this.getFeatures();for(const r of n)this.has(r)&&(yield r);return[]}has(n){var r;return(r=this.disabledFeatures)!=null&&r[n]?!1:(this.testedFeatures.has(n)||(this.testedFeatures.add(n),hN(n)&&zs(this.gl,n,this.extensions)&&this.features.add(n),this.getWebGLFeature(n)&&this.features.add(n)),this.features.has(n))}initializeFeatures(){const n=this.getFeatures().filter(r=>r!=="polygon-mode-webgl");for(const r of n)this.has(r)}getFeatures(){return[...Object.keys(Xm),...Object.keys(Pp)]}getWebGLFeature(n){const r=Xm[n];return typeof r=="string"?!!$i(this.gl,r,this.extensions):!!r}}class TN extends ZC{constructor(n){super();d(this,"gl");d(this,"limits",{});this.gl=n}get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}getParameter(n){return this.limits[n]===void 0&&(this.limits[n]=this.gl.getParameter(n)),this.limits[n]||0}}class Vs extends Nl{constructor(n,r){super(n,r);d(this,"device");d(this,"gl");d(this,"handle");d(this,"colorAttachments",[]);d(this,"depthStencilAttachment",null);const i=r.handle===null;this.device=n,this.gl=n.gl,this.handle=this.props.handle||i?this.props.handle:this.gl.createFramebuffer(),i||(n.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),!this.destroyed&&this.handle!==null&&this.gl.deleteFramebuffer(this.handle)}updateAttachments(){const n=this.gl.bindFramebuffer(36160,this.handle);for(let r=0;r<this.colorAttachments.length;++r){const i=this.colorAttachments[r];if(i){const s=36064+r;this._attachTextureView(s,i)}}if(this.depthStencilAttachment){const r=_N(this.depthStencilAttachment.props.format);this._attachTextureView(r,this.depthStencilAttachment)}if(this.device.props.debug){const r=this.gl.checkFramebufferStatus(36160);if(r!==36053)throw new Error(`Framebuffer ${EN(r)}`)}this.gl.bindFramebuffer(36160,n)}_attachTextureView(n,r){const{gl:i}=this.device,{texture:s}=r,o=r.props.baseMipLevel,a=r.props.baseArrayLayer;switch(i.bindTexture(s.glTarget,s.handle),s.glTarget){case 35866:case 32879:i.framebufferTextureLayer(36160,n,s.handle,o,a);break;case 34067:const l=wN(a);i.framebufferTexture2D(36160,n,l,s.handle,o);break;case 3553:i.framebufferTexture2D(36160,n,3553,s.handle,o);break;default:throw new Error("Illegal texture type")}i.bindTexture(s.glTarget,null)}}function wN(t){return t<34069?t+34069:t}function EN(t){switch(t){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${t}`}}class SN extends Ah{constructor(n,r){super(r);d(this,"device");d(this,"format","rgba8unorm");d(this,"depthStencilFormat","depth24plus");d(this,"presentationSize");d(this,"_framebuffer",null);this.device=n,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new Vs(this.device,{handle:null}),this._framebuffer}update(){const n=this.getPixelSize();(n[0]!==this.presentationSize[0]||n[1]!==this.presentationSize[1])&&(this.presentationSize=n,this.resize())}resize(n){if(this.device.gl&&this.canvas){const r=this.getDevicePixelRatio(n==null?void 0:n.useDevicePixels);this.setDevicePixelRatio(r,n);return}}commit(){}}async function h1(t,e){const n=document.getElementsByTagName("head")[0];if(!n)throw new Error("loadScript");const r=document.createElement("script");return r.setAttribute("type","text/javascript"),r.setAttribute("src",t),e&&(r.id=e),new Promise((i,s)=>{r.onload=i,r.onerror=o=>s(new Error(`Unable to load script '${t}': ${o}`)),n.appendChild(r)})}const bN=1;let ae=null,Ym=!1;const Mp={debugSpectorJS:z.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function AN(t){if(!globalThis.SPECTOR)try{await h1(t.debugSpectorJSUrl||Mp.debugSpectorJSUrl)}catch(e){z.warn(String(e))}}function RN(t){var e;if(t={...Mp,...t},!t.debugSpectorJS)return null;if(!ae&&globalThis.SPECTOR&&!((e=globalThis.luma)!=null&&e.spector)){z.probe(bN,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();const{Spector:n}=globalThis.SPECTOR;ae=new n,globalThis.luma&&(globalThis.luma.spector=ae)}if(!ae)return null;if(Ym||(Ym=!0,ae.spyCanvases(),ae==null||ae.onCaptureStarted.add(n=>z.info("Spector capture started:",n)()),ae==null||ae.onCapture.add(n=>{z.info("Spector capture complete:",n)(),ae==null||ae.getResultUI(),ae==null||ae.resultView.display(),ae==null||ae.resultView.addCapture(n)})),t.gl){const n=t.gl,r=n.device;ae==null||ae.startCapture(t.gl,500),n.device=r,new Promise(i=>setTimeout(i,2e3)).then(i=>{z.info("Spector capture stopped after 2 seconds")(),ae==null||ae.stopCapture()})}return ae}const CN="https://unpkg.com/webgl-debug@2.0.1/index.js";function d1(t){return t.luma=t.luma||{},t.luma}async function xN(){Fr()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await h1(CN))}function PN(t,e={}){return e.debugWebGL||e.traceWebGL?IN(t,e):MN(t)}function MN(t){const e=d1(t);return e.realContext?e.realContext:t}function IN(t,e){if(!globalThis.WebGLDebugUtils)return z.warn("webgl-debug not loaded")(),t;const n=d1(t);if(n.debugContext)return n.debugContext;globalThis.WebGLDebugUtils.init({...hi,...t});const r=globalThis.WebGLDebugUtils.makeDebugContext(t,NN.bind(null,e),kN.bind(null,e));for(const o in hi)!(o in r)&&typeof hi[o]=="number"&&(r[o]=hi[o]);class i{}Object.setPrototypeOf(r,Object.getPrototypeOf(t)),Object.setPrototypeOf(i,r);const s=Object.create(i);return n.realContext=t,n.debugContext=s,s.debug=!0,s}function Km(t,e){e=Array.from(e).map(r=>r===void 0?"undefined":r);let n=globalThis.WebGLDebugUtils.glFunctionArgsToString(t,e);return n=`${n.slice(0,100)}${n.length>100?"...":""}`,`gl.${t}(${n})`}function NN(t,e,n,r){r=Array.from(r).map(a=>a===void 0?"undefined":a);const i=globalThis.WebGLDebugUtils.glEnumToString(e),s=globalThis.WebGLDebugUtils.glFunctionArgsToString(n,r),o=`${i} in gl.${n}(${s})`;z.error(o)();debugger}function kN(t,e,n){let r="";z.level>=1&&(r=Km(e,n),t.traceWebGL&&z.log(1,r)());for(const i of n)if(i===void 0){r=r||Km(e,n);debugger}}const ff={};function ON(t="id"){ff[t]=ff[t]||1;const e=ff[t]++;return`${t}-${e}`}class js extends ge{constructor(n,r={}){super(n,r);d(this,"device");d(this,"gl");d(this,"handle");d(this,"glTarget");d(this,"glUsage");d(this,"glIndexType",5123);d(this,"byteLength");d(this,"bytesUsed");this.device=n,this.gl=this.device.gl;const i=typeof r=="object"?r.handle:void 0;this.handle=i||this.gl.createBuffer(),n.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=FN(this.props.usage),this.glUsage=DN(this.props.usage),this.glIndexType=this.props.indexType==="uint32"?5125:5123,r.data?this._initWithData(r.data,r.byteOffset,r.byteLength):this._initWithByteLength(r.byteLength||0)}_initWithData(n,r=0,i=n.byteLength+r){const s=this.glTarget;this.gl.bindBuffer(s,this.handle),this.gl.bufferData(s,i,this.glUsage),this.gl.bufferSubData(s,r,n),this.gl.bindBuffer(s,null),this.bytesUsed=i,this.byteLength=i,this._setDebugData(n,r,i),this.trackAllocatedMemory(i)}_initWithByteLength(n){let r=n;n===0&&(r=new Float32Array(0));const i=this.glTarget;return this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bindBuffer(i,null),this.bytesUsed=n,this.byteLength=n,this._setDebugData(null,0,n),this.trackAllocatedMemory(n),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(n,r=0){this.gl.bindBuffer(36663,this.handle),this.gl.bufferSubData(36663,r,n),this.gl.bindBuffer(36663,null),this._setDebugData(n,r,n.byteLength)}async readAsync(n=0,r){return this.readSyncWebGL(n,r)}readSyncWebGL(n=0,r){r=r??this.byteLength-n;const i=new Uint8Array(r),s=0;return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,n,i,s,r),this.gl.bindBuffer(36662,null),this._setDebugData(i,n,r),i}}function FN(t){return t&ge.INDEX?34963:t&ge.VERTEX?34962:t&ge.UNIFORM?35345:34962}function DN(t){return t&ge.INDEX||t&ge.VERTEX?35044:t&ge.UNIFORM?35048:35044}function BN(t){const e=t.split(/\r?\n/),n=[];for(const r of e){if(r.length<=1)continue;const i=r.split(":");if(i.length===2){const[f,h]=i;n.push({message:h.trim(),type:qm(f),lineNum:0,linePos:0});continue}const[s,o,a,...l]=i;let c=parseInt(a,10);isNaN(c)&&(c=0);let u=parseInt(o,10);isNaN(u)&&(u=0),n.push({message:l.join(":").trim(),type:qm(s),lineNum:c,linePos:u})}return n}function qm(t){const e=["warning","error","info"],n=t.toLowerCase();return e.includes(n)?n:"info"}class UN extends Ml{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");switch(this.device=n,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw new Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){const n=this.device.gl.getShaderInfoLog(this.handle);return n?BN(n):[]}getTranslatedSource(){const r=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return(r==null?void 0:r.getTranslatedShaderSource(this.handle))||null}async _compile(n){n=n.startsWith("#version ")?n:`#version 300 es
${n}`;const{gl:r}=this.device;if(r.shaderSource(this.handle,n),r.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),this.compilationStatus==="error")throw new Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}z.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),z.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getShaderParameter(this.handle,37297))return;await n(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}function LN(t,e,n,r){if(HN(e))return r(t);const i=t;i.pushState();try{return zN(t,e),Ji(i.gl,n),r(t)}finally{i.popState()}}function zN(t,e){const n=t,{gl:r}=n;if(e.cullMode)switch(e.cullMode){case"none":r.disable(2884);break;case"front":r.enable(2884),r.cullFace(1028);break;case"back":r.enable(2884),r.cullFace(1029);break}if(e.frontFace&&r.frontFace(br("frontFace",e.frontFace,{ccw:2305,cw:2304})),e.unclippedDepth&&t.features.has("depth-clip-control")&&r.enable(34383),e.depthBias!==void 0&&(r.enable(32823),r.polygonOffset(e.depthBias,e.depthBiasSlopeScale||0)),e.provokingVertex&&t.features.has("provoking-vertex-webgl")){const s=n.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,o=br("provokingVertex",e.provokingVertex,{first:36429,last:36430});s==null||s.provokingVertexWEBGL(o)}if((e.polygonMode||e.polygonOffsetLine)&&t.features.has("polygon-mode-webgl")){if(e.polygonMode){const s=n.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,o=br("polygonMode",e.polygonMode,{fill:6914,line:6913});s==null||s.polygonModeWEBGL(1028,o),s==null||s.polygonModeWEBGL(1029,o)}e.polygonOffsetLine&&r.enable(10754)}if(t.features.has("shader-clip-cull-distance-webgl")&&(e.clipDistance0&&r.enable(12288),e.clipDistance1&&r.enable(12289),e.clipDistance2&&r.enable(12290),e.clipDistance3&&r.enable(12291),e.clipDistance4&&r.enable(12292),e.clipDistance5&&r.enable(12293),e.clipDistance6&&r.enable(12294),e.clipDistance7&&r.enable(12295)),e.depthWriteEnabled!==void 0&&r.depthMask(jN("depthWriteEnabled",e.depthWriteEnabled)),e.depthCompare&&(e.depthCompare!=="always"?r.enable(2929):r.disable(2929),r.depthFunc(Xh("depthCompare",e.depthCompare))),e.stencilWriteMask){const i=e.stencilWriteMask;r.stencilMaskSeparate(1028,i),r.stencilMaskSeparate(1029,i)}if(e.stencilReadMask&&z.warn("stencilReadMask not supported under WebGL"),e.stencilCompare){const i=e.stencilReadMask||4294967295,s=Xh("depthCompare",e.stencilCompare);e.stencilCompare!=="always"?r.enable(2960):r.disable(2960),r.stencilFuncSeparate(1028,s,0,i),r.stencilFuncSeparate(1029,s,0,i)}if(e.stencilPassOperation&&e.stencilFailOperation&&e.stencilDepthFailOperation){const i=hf("stencilPassOperation",e.stencilPassOperation),s=hf("stencilFailOperation",e.stencilFailOperation),o=hf("stencilDepthFailOperation",e.stencilDepthFailOperation);r.stencilOpSeparate(1028,s,o,i),r.stencilOpSeparate(1029,s,o,i)}switch(e.blend){case!0:r.enable(3042);break;case!1:r.disable(3042);break}if(e.blendColorOperation||e.blendAlphaOperation){const i=Zm("blendColorOperation",e.blendColorOperation||"add"),s=Zm("blendAlphaOperation",e.blendAlphaOperation||"add");r.blendEquationSeparate(i,s);const o=Ra("blendColorSrcFactor",e.blendColorSrcFactor||"one"),a=Ra("blendColorDstFactor",e.blendColorDstFactor||"zero"),l=Ra("blendAlphaSrcFactor",e.blendAlphaSrcFactor||"one"),c=Ra("blendAlphaDstFactor",e.blendAlphaDstFactor||"zero");r.blendFuncSeparate(o,a,l,c)}}function Xh(t,e){return br(t,e,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function hf(t,e){return br(t,e,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function Zm(t,e){return br(t,e,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function Ra(t,e){return br(t,e,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function VN(t,e){return`Illegal parameter ${e} for ${t}`}function br(t,e,n){if(!(e in n))throw new Error(VN(t,e));return n[e]}function jN(t,e){return e}function HN(t){let e=!0;for(const n in t){e=!1;break}return e}function p1(t){const e={};return t.addressModeU&&(e[10242]=df(t.addressModeU)),t.addressModeV&&(e[10243]=df(t.addressModeV)),t.addressModeW&&(e[32882]=df(t.addressModeW)),t.magFilter&&(e[10240]=Yh(t.magFilter)),(t.minFilter||t.mipmapFilter)&&(e[10241]=WN(t.minFilter||"linear",t.mipmapFilter)),t.lodMinClamp!==void 0&&(e[33082]=t.lodMinClamp),t.lodMaxClamp!==void 0&&(e[33083]=t.lodMaxClamp),t.type==="comparison-sampler"&&(e[34892]=34894),t.compare&&(e[34893]=Xh("compare",t.compare)),t.maxAnisotropy&&(e[34046]=t.maxAnisotropy),e}function df(t){switch(t){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function Yh(t){switch(t){case"nearest":return 9728;case"linear":return 9729}}function WN(t,e="none"){if(!e)return Yh(t);switch(e){case"none":return Yh(t);case"nearest":return t==="nearest"?9984:9986;case"linear":return t==="nearest"?9985:9987}}class Kh extends Il{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"parameters");this.device=n,this.parameters=p1(r),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(n){for(const[r,i]of Object.entries(n)){const s=Number(r);switch(s){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,s,i);break;default:this.device.gl.samplerParameteri(this.handle,s,i);break}}}}function Xi(t,e,n){if($N(e))return n(t);const{nocatch:r=!0}=e,i=Sr.get(t);i.push(),Ji(t,e);let s;if(r)s=n(t),i.pop();else try{s=n(t)}finally{i.pop()}return s}function $N(t){for(const e in t)return!1;return!0}class gi extends Pl{constructor(n,r){super(n,{...ve.defaultProps,...r});d(this,"device");d(this,"gl");d(this,"handle");d(this,"texture");this.device=n,this.gl=this.device.gl,this.handle=null,this.texture=r.texture}}const XN="Failed to deduce GL constant from typed array";function YN(t){switch(ArrayBuffer.isView(t)?t.constructor:t){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:return 5121;case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw new Error(XN)}}function KN(t,e){const{clamped:n=!0}=e||{};switch(t){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return n?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw new Error("Failed to deduce typed array type from GL constant")}}function g1(t){switch(t){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function qN(t){switch(t){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}function ZN(t,e,n){const{dimension:r,width:i,height:s,depth:o=0}=n,{glInternalFormat:a}=n,l=n.glTarget;switch(r){case"2d-array":case"3d":t.texStorage3D(l,e,a,i,s,o);break;default:t.texStorage2D(l,e,a,i,s)}}function Qm(t,e,n,r){const{width:i,height:s}=r,{dimension:o,depth:a=0,mipLevel:l=0}=r,{x:c=0,y:u=0,z:f=0}=r,{glFormat:h,glType:_}=r,v=_1(r.glTarget,o,a),E=r.flipY?{37440:!0}:{};Xi(t,E,()=>{switch(o){case"2d-array":case"3d":t.bindTexture(v,e),t.texSubImage3D(v,l,c,u,f,i,s,a,h,_,n),t.bindTexture(v,null);break;case"2d":case"cube":t.bindTexture(v,e),t.texSubImage2D(v,l,c,u,i,s,h,_,n),t.bindTexture(v,null);break;default:throw new Error(o)}})}function Jm(t,e,n){const{dimension:r,width:i,height:s,depth:o=0,mipLevel:a=0,byteOffset:l=0}=n,{x:c=0,y:u=0,z:f=0}=n,{glFormat:h,glType:_,compressed:v}=n,E=_1(n.glTarget,r,o);switch(r){case"2d-array":case"3d":v?t.compressedTexSubImage3D(E,a,c,u,f,i,s,o,h,e,l):t.texSubImage3D(E,a,c,u,f,i,s,o,h,_,e,l);break;case"2d":case"cube":v?t.compressedTexSubImage2D(E,a,c,u,i,s,h,e,l):t.texSubImage2D(E,a,c,u,i,s,h,_,e,l);break;default:throw new Error(r)}}function QN(t){switch(t){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw new Error(t)}function _1(t,e,n){return e==="cube"?34069+n:t}function JN(t,e){var g;const{sourceX:n=0,sourceY:r=0,sourceAttachment:i=0}=e||{};let{target:s=null,sourceWidth:o,sourceHeight:a,sourceDepth:l,sourceFormat:c,sourceType:u}=e||{};const{framebuffer:f,deleteFramebuffer:h}=m1(t),{gl:_,handle:v}=f;o||(o=f.width),a||(a=f.height);const E=(g=f.colorAttachments[i])==null?void 0:g.texture;if(!E)throw new Error(`Invalid framebuffer attachment ${i}`);l=(E==null?void 0:E.depth)||1,c||(c=(E==null?void 0:E.glFormat)||6408),u||(u=(E==null?void 0:E.glType)||5121),s=tk(s,u,c,o,a),u=u||YN(s);const b=_.bindFramebuffer(36160,v);return _.readBuffer(36064+i),_.readPixels(n,r,o,a,c,u,s),_.readBuffer(36064),_.bindFramebuffer(36160,b||null),h&&f.destroy(),s}function GN(t,e){const{target:n,sourceX:r=0,sourceY:i=0,sourceFormat:s=6408,targetByteOffset:o=0}=e||{};let{sourceWidth:a,sourceHeight:l,sourceType:c}=e||{};const{framebuffer:u,deleteFramebuffer:f}=m1(t);a=a||u.width,l=l||u.height;const h=u;c=c||5121;let _=n;if(!_){const E=g1(s),b=qN(c),g=o+a*l*E*b;_=h.device.createBuffer({byteLength:g})}const v=t.device.createCommandEncoder();return v.copyTextureToBuffer({sourceTexture:t,width:a,height:l,origin:[r,i],destinationBuffer:_,byteOffset:o}),v.destroy(),f&&u.destroy(),_}function m1(t){return t instanceof Nl?{framebuffer:t,deleteFramebuffer:!1}:{framebuffer:ek(t),deleteFramebuffer:!0}}function ek(t,e){const{device:n,width:r,height:i,id:s}=t;return n.createFramebuffer({...e,id:`framebuffer-for-${s}`,width:r,height:i,colorAttachments:[t]})}function tk(t,e,n,r,i,s){if(t)return t;e||(e=5121);const o=KN(e,{clamped:!1}),a=g1(n);return new o(r*i*a)}class Hs extends ve{constructor(n,r){super(n,r);d(this,"device");d(this,"gl");d(this,"handle");d(this,"sampler");d(this,"view");d(this,"mipmaps");d(this,"compressed");d(this,"glTarget");d(this,"glFormat");d(this,"glType");d(this,"glInternalFormat");d(this,"textureUnit",0);const i={...this.props};i.data=r.data,this.device=n,this.gl=this.device.gl,this.glTarget=QN(this.props.dimension);const s=f1(this.props.format);this.glInternalFormat=s.internalFormat,this.glFormat=s.format,this.glType=s.type,this.compressed=s.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(i),Object.seal(this)}_initialize(n){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:n.data});let{width:r,height:i}=n;if(!r||!i){const s=ve.getTextureDataSize(n.data);r=(s==null?void 0:s.width)||1,i=(s==null?void 0:s.height)||1}if(this.width=r,this.height=i,this.depth=n.depth,this.setSampler(n.sampler),this.view=new gi(this.device,{...this.props,texture:this}),this.bind(),ZN(this.gl,this.mipLevels,this),n.data)switch(n.dimension){case"1d":this.setTexture1DData(n.data);break;case"2d":this.setTexture2DData(n.data);break;case"3d":this.setTexture3DData(n.data);break;case"cube":this.setTextureCubeData(n.data);break;case"2d-array":this.setTextureArrayData(n.data);break;case"cube-array":this.setTextureCubeArrayData(n.data);break;default:throw new Error(n.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(n){return new gi(this.device,{...n,texture:this})}setSampler(n={}){let r;n instanceof Kh?(this.sampler=n,r=n.props):(this.sampler=new Kh(this.device,n),r=n);const i=p1(r);this._setSamplerParameters(i)}generateMipmap(n={}){(!this.device.isTextureFormatRenderable(this.props.format)||!this.device.isTextureFormatFilterable(this.props.format))&&z.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)();try{this.gl.bindTexture(this.glTarget,this.handle),Xi(this.gl,n,()=>{this.gl.generateMipmap(this.glTarget)})}catch(r){z.warn(`Error generating mipmap for ${this}: ${r.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(n){const r=ve.getExternalImageSize(n.image),i={...ve.defaultCopyExternalImageOptions,...r,...n},{image:s,depth:o,mipLevel:a,x:l,y:c,z:u,flipY:f}=i;let{width:h,height:_}=i;const{dimension:v,glTarget:E,glFormat:b,glInternalFormat:g,glType:p}=this;if(h=Math.min(h,this.width-l),_=Math.min(_,this.height-c),n.sourceX||n.sourceY)throw new Error("WebGL does not support sourceX/sourceY)");return Qm(this.device.gl,this.handle,s,{dimension:v,mipLevel:a,x:l,y:c,z:u,width:h,height:_,depth:o,glFormat:b,glInternalFormat:g,glType:p,glTarget:E,flipY:f}),{width:i.width,height:i.height}}setTexture1DData(n){throw new Error("setTexture1DData not supported in WebGL.")}setTexture2DData(n,r=0){this.bind();const i=ve.normalizeTextureData(n,this);i.length>1&&this.props.mipmaps!==!1&&z.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let s=0;s<i.length;s++){const o=i[s];this._setMipLevel(r,s,o)}this.unbind()}setTexture3DData(n){if(this.props.dimension!=="3d")throw new Error(this.id);ArrayBuffer.isView(n)&&(this.bind(),Jm(this.device.gl,n,this),this.unbind())}setTextureCubeData(n,r=0){if(this.props.dimension!=="cube")throw new Error(this.id);for(const i of ve.CubeFaces)this.setTextureCubeFaceData(n[i],i)}setTextureArrayData(n){throw this.props.dimension!=="2d-array"?new Error(this.id):new Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(n){throw new Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(n,r,i=0){Array.isArray(n)&&n.length>1&&this.props.mipmaps!==!1&&z.warn(`${this.id} has mipmap and multiple LODs.`)();const s=ve.CubeFaces.indexOf(r);this.setTexture2DData(n,s)}update(){throw new Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(n){const{face:r,width:i,height:s,pixels:o,data:a,format:l=6408,type:c=5121}=n,{gl:u}=this,f=o||a;this.bind(),f instanceof Promise?f.then(h=>this.setImageDataForFace(Object.assign({},n,{face:r,data:h,pixels:h}))):this.width||this.height?u.texImage2D(r,0,l,i,s,0,l,c,f):u.texImage2D(r,0,l,l,c,f)}_getImageDataMap(n){for(let r=0;r<ve.CubeFaces.length;++r){const i=ve.CubeFaces[r];n[i]&&(n[34069+r]=n[i],delete n[i])}return n}_setSamplerParameters(n){z.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(n))(),this.gl.bindTexture(this.glTarget,this.handle);for(const[r,i]of Object.entries(n)){const s=Number(r),o=i;switch(s){case 33082:case 33083:this.gl.texParameterf(this.glTarget,s,o);break;case 10241:this.gl.texParameteri(this.glTarget,s,o);break;case 10242:case 10243:this.gl.texParameteri(this.glTarget,s,o);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,s,o);break;default:this.gl.texParameteri(this.glTarget,s,o);break}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(n,r,i,s=this.glTarget){if(ve.isExternalImage(i)){Qm(this.device.gl,this.handle,i,{...this,depth:n,mipLevel:r,glTarget:s,flipY:this.props.flipY});return}if(ve.isTextureLevelData(i)){Jm(this.device.gl,i.data,{...this,depth:n,mipLevel:r,glTarget:s});return}throw new Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,this.handle),n}unbind(n){const{gl:r}=this;return n!==void 0&&(this.textureUnit=n,r.activeTexture(33984+n)),r.bindTexture(this.glTarget,null),n}}const nk=[1,2,4,8];class rk extends Rh{constructor(n,r){var s;super(n,r);d(this,"device");d(this,"glParameters");this.device=n;let i;if(!((s=r==null?void 0:r.parameters)!=null&&s.viewport))if(r!=null&&r.framebuffer){const{width:o,height:a}=r.framebuffer;i=[0,0,o,a]}else{const[o,a]=n.getCanvasContext().getDrawingBufferSize();i=[0,0,o,a]}if(this.device.pushState(),this.setParameters({viewport:i,...this.props.parameters}),this.props.framebuffer){const o=this.props.framebuffer.colorAttachments.map((a,l)=>36064+l);this.device.gl.drawBuffers(o)}else this.device.gl.drawBuffers([1029]);this.clear()}end(){this.device.popState()}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}setParameters(n={}){const r={...this.glParameters};r.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(r.depthMask=!this.props.depthReadOnly),r.stencilMask=this.props.stencilReadOnly?0:1,r[35977]=this.props.discard,n.viewport&&(n.viewport.length>=6?(r.viewport=n.viewport.slice(0,4),r.depthRange=[n.viewport[4],n.viewport[5]]):r.viewport=n.viewport),n.scissorRect&&(r.scissorTest=!0,r.scissor=n.scissorRect),n.blendConstant&&(r.blendColor=n.blendConstant),n.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),n[2967]=n.stencilReference),n.colorMask&&(r.colorMask=nk.map(i=>!!(i&n.colorMask))),this.glParameters=r,Ji(this.device.gl,r)}beginOcclusionQuery(n){const r=this.props.occlusionQuerySet;r==null||r.beginOcclusionQuery()}endOcclusionQuery(){const n=this.props.occlusionQuerySet;n==null||n.endOcclusionQuery()}clear(){const n={...this.glParameters};let r=0;this.props.clearColors&&this.props.clearColors.forEach((i,s)=>{i&&this.clearColorBuffer(s,i)}),this.props.clearColor!==!1&&this.props.clearColors===void 0&&(r|=16384,n.clearColor=this.props.clearColor),this.props.clearDepth!==!1&&(r|=256,n.clearDepth=this.props.clearDepth),this.props.clearStencil!==!1&&(r|=1024,n.clearStencil=this.props.clearStencil),r!==0&&Xi(this.device.gl,n,()=>{this.device.gl.clear(r)})}clearColorBuffer(n=0,r=[0,0,0,0]){Xi(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(r.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,n,r);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,n,r);break;case Float32Array:this.device.gl.clearBufferfv(6144,n,r);break;default:throw new Error("clearColorBuffer: color must be typed array")}})}}function ik(t){return sk.includes(t)}const sk=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],y1={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function v1(t){const e=y1[t];if(!e)throw new Error("uniform");const[n,r,,i]=e;return{format:i,components:r,glType:n}}function ok(t){const e=y1[t];if(!e)throw new Error("attribute");const[,n,,r,i]=e;return{attributeType:r,vertexFormat:i,components:n}}function ak(t,e){const n={attributes:[],bindings:[]};n.attributes=lk(t,e);const r=fk(t,e);for(const a of r){const l=a.uniforms.map(c=>({name:c.name,format:c.format,byteOffset:c.byteOffset,byteStride:c.byteStride,arrayLength:c.arrayLength}));n.bindings.push({type:"uniform",name:a.name,location:a.location,visibility:(a.vertex?1:0)&(a.fragment?2:0),minBindingSize:a.byteLength,uniforms:l})}const i=uk(t,e);let s=0;for(const a of i)if(ik(a.type)){const{viewDimension:l,sampleType:c}=dk(a.type);n.bindings.push({type:"texture",name:a.name,location:s,viewDimension:l,sampleType:c}),a.textureUnit=s,s+=1}i.length&&(n.uniforms=i);const o=ck(t,e);return o!=null&&o.length&&(n.varyings=o),n}function lk(t,e){const n=[],r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const s=t.getActiveAttrib(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a}=s,l=t.getAttribLocation(e,o);if(l>=0){const{attributeType:c}=ok(a),u=/instance/i.test(o)?"instance":"vertex";n.push({name:o,location:l,stepMode:u,type:c})}}return n.sort((i,s)=>i.location-s.location),n}function ck(t,e){const n=[],r=t.getProgramParameter(e,35971);for(let i=0;i<r;i++){const s=t.getTransformFeedbackVarying(e,i);if(!s)throw new Error("activeInfo");const{name:o,type:a,size:l}=s,{glType:c,components:u}=v1(a),f={location:i,name:o,type:c,size:l*u};n.push(f)}return n.sort((i,s)=>i.location-s.location),n}function uk(t,e){const n=[],r=t.getProgramParameter(e,35718);for(let i=0;i<r;i++){const s=t.getActiveUniform(e,i);if(!s)throw new Error("activeInfo");const{name:o,size:a,type:l}=s,{name:c,isArray:u}=pk(o);let f=t.getUniformLocation(e,c);const h={location:f,name:c,size:a,type:l,isArray:u};if(n.push(h),h.size>1)for(let _=0;_<h.size;_++){const v=`${c}[${_}]`;f=t.getUniformLocation(e,v);const E={...h,name:v,location:f};n.push(E)}}return n}function fk(t,e){const n=(s,o)=>t.getActiveUniformBlockParameter(e,s,o),r=[],i=t.getProgramParameter(e,35382);for(let s=0;s<i;s++){const o={name:t.getActiveUniformBlockName(e,s)||"",location:n(s,35391),byteLength:n(s,35392),vertex:n(s,35396),fragment:n(s,35398),uniformCount:n(s,35394),uniforms:[]},a=n(s,35395)||[],l=t.getActiveUniforms(e,a,35383),c=t.getActiveUniforms(e,a,35384),u=t.getActiveUniforms(e,a,35387),f=t.getActiveUniforms(e,a,35388);for(let h=0;h<o.uniformCount;++h){const _=t.getActiveUniform(e,a[h]);if(!_)throw new Error("activeInfo");o.uniforms.push({name:_.name,format:v1(l[h]).format,type:l[h],arrayLength:c[h],byteOffset:u[h],byteStride:f[h]})}r.push(o)}return r.sort((s,o)=>s.location-o.location),r}const hk={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};function dk(t){const e=hk[t];if(!e)throw new Error("sampler");const[n,r]=e;return{viewDimension:n,sampleType:r}}function pk(t){if(t[t.length-1]!=="]")return{name:t,length:1,isArray:!1};const n=/([^[]*)(\[[0-9]+\])?/.exec(t);if(!n||n.length<2)throw new Error(`Failed to parse GLSL uniform name ${t}`);return{name:n[1],length:n[2]?1:0,isArray:!!n[2]}}function gk(t,e,n,r){const i=t;let s=r;s===!0&&(s=1),s===!1&&(s=0);const o=typeof s=="number"?[s]:s;switch(n){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if(typeof r!="number")throw new Error("samplers must be set to integers");return t.uniform1i(e,r);case 5126:return t.uniform1fv(e,o);case 35664:return t.uniform2fv(e,o);case 35665:return t.uniform3fv(e,o);case 35666:return t.uniform4fv(e,o);case 5124:return t.uniform1iv(e,o);case 35667:return t.uniform2iv(e,o);case 35668:return t.uniform3iv(e,o);case 35669:return t.uniform4iv(e,o);case 35670:return t.uniform1iv(e,o);case 35671:return t.uniform2iv(e,o);case 35672:return t.uniform3iv(e,o);case 35673:return t.uniform4iv(e,o);case 5125:return i.uniform1uiv(e,o,1);case 36294:return i.uniform2uiv(e,o,2);case 36295:return i.uniform3uiv(e,o,3);case 36296:return i.uniform4uiv(e,o,4);case 35674:return t.uniformMatrix2fv(e,!1,o);case 35675:return t.uniformMatrix3fv(e,!1,o);case 35676:return t.uniformMatrix4fv(e,!1,o);case 35685:return i.uniformMatrix2x3fv(e,!1,o);case 35686:return i.uniformMatrix2x4fv(e,!1,o);case 35687:return i.uniformMatrix3x2fv(e,!1,o);case 35688:return i.uniformMatrix3x4fv(e,!1,o);case 35689:return i.uniformMatrix4x2fv(e,!1,o);case 35690:return i.uniformMatrix4x3fv(e,!1,o)}throw new Error("Illegal uniform")}function _k(t){return Jw(t)!==null||typeof t=="number"||typeof t=="boolean"}function mk(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach(n=>{const r=t[n];_k(r)?e.uniforms[n]=r:e.bindings[n]=r}),e}function yk(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw new Error(t)}}function vk(t){switch(t){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 1;case"triangle-list":return 4;case"triangle-strip":return 4;default:throw new Error(t)}}const Gm=4;class Tk extends Di{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"vs");d(this,"fs");d(this,"introspectedLayout");d(this,"uniforms",{});d(this,"bindings",{});d(this,"varyings",null);d(this,"_uniformCount",0);d(this,"_uniformSetters",{});this.device=n,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=r.vs,this.fs=r.fs;const{varyings:i,bufferMode:s=35981}=r;i&&i.length>0&&(this.varyings=i,this.device.gl.transformFeedbackVaryings(this.handle,i,s)),this._linkShaders(),z.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=ak(this.device.gl,this.handle),z.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=wk(this.introspectedLayout,r.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(n,r){for(const[i,s]of Object.entries(n)){const o=this.shaderLayout.bindings.find(a=>a.name===i)||this.shaderLayout.bindings.find(a=>a.name===`${i}Uniforms`);if(!o){const a=this.shaderLayout.bindings.map(l=>`"${l.name}"`).join(", ");r!=null&&r.disableWarnings||z.warn(`No binding "${i}" in render pipeline "${this.id}", expected one of ${a}`,s)();continue}switch(s||z.warn(`Unsetting binding "${i}" in render pipeline "${this.id}"`)(),o.type){case"uniform":if(!(s instanceof js)&&!(s.buffer instanceof js))throw new Error("buffer value");break;case"texture":if(!(s instanceof gi||s instanceof Hs||s instanceof Vs))throw new Error("texture value");break;case"sampler":z.warn(`Ignoring sampler ${i}`)();break;default:throw new Error(o.type)}this.bindings[i]=s}}draw(n){var b;const{renderPass:r,parameters:i=this.props.parameters,topology:s=this.props.topology,vertexArray:o,vertexCount:a,instanceCount:l,isInstanced:c=!1,firstVertex:u=0,transformFeedback:f}=n,h=yk(s),_=!!o.indexBuffer,v=(b=o.indexBuffer)==null?void 0:b.glIndexType;if(this.linkStatus!=="success")return z.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1;if(!this._areTexturesRenderable())return z.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1;this.device.gl.useProgram(this.handle),o.bindBeforeRender(r),f&&f.begin(this.props.topology),this._applyBindings(),this._applyUniforms();const E=r;return LN(this.device,i,E.glParameters,()=>{_&&c?this.device.gl.drawElementsInstanced(h,a||0,v,u,l||0):_?this.device.gl.drawElements(h,a||0,v,u):c?this.device.gl.drawArraysInstanced(h,u,a||0,l||0):this.device.gl.drawArrays(h,u,a||0),f&&f.end()}),o.unbindAfterRender(r),!0}setUniformsWebGL(n){const{bindings:r}=mk(n);Object.keys(r).forEach(i=>{z.warn(`Unsupported value "${JSON.stringify(r[i])}" used in setUniforms() for key ${i}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,n)}async _linkShaders(){const{gl:n}=this.device;if(n.attachShader(this.handle,this.vs.handle),n.attachShader(this.handle,this.fs.handle),z.time(Gm,`linkProgram for ${this.id}`)(),n.linkProgram(this.handle),z.timeEnd(Gm,`linkProgram for ${this.id}`)(),z.level,!this.device.features.has("compilation-status-async-webgl")){const i=this._getLinkStatus();this._reportLinkStatus(i);return}z.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),z.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();const r=this._getLinkStatus();this._reportLinkStatus(r)}async _reportLinkStatus(n){var r;switch(n){case"success":return;default:switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),new Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader());break}switch((r=this.fs)==null?void 0:r.compilationStatus){case"error":throw this.fs.debugShader(),new Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader());break}const i=this.device.gl.getProgramInfoLog(this.handle);throw new Error(`Error during ${n}: ${i}`)}}_getLinkStatus(){const{gl:n}=this.device;return n.getProgramParameter(this.handle,35714)?(n.validateProgram(this.handle),n.getProgramParameter(this.handle,35715)?(this.linkStatus="success","success"):(this.linkStatus="error","validation")):(this.linkStatus="error","linking")}async _waitForLinkComplete(){const n=async s=>await new Promise(o=>setTimeout(o,s));if(!this.device.features.has("compilation-status-async-webgl")){await n(10);return}const{gl:i}=this.device;for(;;){if(i.getProgramParameter(this.handle,37297))return;await n(10)}}_areTexturesRenderable(){let n=!0;for(const r of this.shaderLayout.bindings)!this.bindings[r.name]&&!this.bindings[r.name.replace(/Uniforms$/,"")]&&(z.warn(`Binding ${r.name} not found in ${this.id}`)(),n=!1);return n}_applyBindings(){if(this.linkStatus!=="success")return;const{gl:n}=this.device;n.useProgram(this.handle);let r=0,i=0;for(const s of this.shaderLayout.bindings){const o=this.bindings[s.name]||this.bindings[s.name.replace(/Uniforms$/,"")];if(!o)throw new Error(`No value for binding ${s.name} in ${this.id}`);switch(s.type){case"uniform":const{name:a}=s,l=n.getUniformBlockIndex(this.handle,a);if(l===4294967295)throw new Error(`Invalid uniform block name ${a}`);n.uniformBlockBinding(this.handle,i,l),o instanceof js?n.bindBufferBase(35345,i,o.handle):n.bindBufferRange(35345,i,o.buffer.handle,o.offset||0,o.size||o.buffer.byteLength-o.offset),i+=1;break;case"texture":if(!(o instanceof gi||o instanceof Hs||o instanceof Vs))throw new Error("texture");let c;if(o instanceof gi)c=o.texture;else if(o instanceof Hs)c=o;else if(o instanceof Vs&&o.colorAttachments[0]instanceof gi)z.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),c=o.colorAttachments[0].texture;else throw new Error("No texture");n.activeTexture(33984+r),n.bindTexture(c.glTarget,c.handle),r+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw new Error(`binding type '${s.type}' not supported in WebGL`)}}}_applyUniforms(){for(const n of this.shaderLayout.uniforms||[]){const{name:r,location:i,type:s,textureUnit:o}=n,a=this.uniforms[r]??o;a!==void 0&&gk(this.device.gl,i,s,a)}}}function wk(t,e){const n={...t,attributes:t.attributes.map(r=>({...r}))};for(const r of(e==null?void 0:e.attributes)||[]){const i=n.attributes.find(s=>s.name===r.name);i?(i.type=r.type||i.type,i.stepMode=r.stepMode||i.stepMode):z.warn(`shader layout attribute ${r.name} not present in shader`)}return n}class Ek extends xh{constructor(n){super(n,{});d(this,"device");d(this,"commands",[]);this.device=n}submitCommands(n=this.commands){for(const r of n)switch(r.name){case"copy-buffer-to-buffer":Sk(this.device,r.options);break;case"copy-buffer-to-texture":bk(this.device,r.options);break;case"copy-texture-to-buffer":Ak(this.device,r.options);break;case"copy-texture-to-texture":Rk(this.device,r.options);break;default:throw new Error(r.name)}}}function Sk(t,e){const n=e.sourceBuffer,r=e.destinationBuffer;t.gl.bindBuffer(36662,n.handle),t.gl.bindBuffer(36663,r.handle),t.gl.copyBufferSubData(36662,36663,e.sourceOffset??0,e.destinationOffset??0,e.size),t.gl.bindBuffer(36662,null),t.gl.bindBuffer(36663,null)}function bk(t,e){throw new Error("Not implemented")}function Ak(t,e){const{sourceTexture:n,mipLevel:r=0,aspect:i="all",width:s=e.sourceTexture.width,height:o=e.sourceTexture.height,depthOrArrayLayers:a=0,origin:l=[0,0],destinationBuffer:c,byteOffset:u=0,bytesPerRow:f,rowsPerImage:h}=e;if(i!=="all")throw new Error("aspect not supported in WebGL");if(r!==0||a!==0||f||h)throw new Error("not implemented");const{framebuffer:_,destroyFramebuffer:v}=T1(n);let E;try{const b=c,g=s||_.width,p=o||_.height,y=f1(_.colorAttachments[0].texture.props.format),S=y.format,R=y.type;t.gl.bindBuffer(35051,b.handle),E=t.gl.bindFramebuffer(36160,_.handle),t.gl.readPixels(l[0],l[1],g,p,S,R,u)}finally{t.gl.bindBuffer(35051,null),E!==void 0&&t.gl.bindFramebuffer(36160,E),v&&_.destroy()}}function Rk(t,e){const{sourceTexture:n,destinationMipLevel:r=0,origin:i=[0,0],destinationOrigin:s=[0,0],destinationTexture:o}=e;let{width:a=e.destinationTexture.width,height:l=e.destinationTexture.height}=e;const{framebuffer:c,destroyFramebuffer:u}=T1(n),[f,h]=i,[_,v,E]=s,b=t.gl.bindFramebuffer(36160,c.handle);let g=null,p;if(o instanceof Hs)g=o,a=Number.isFinite(a)?a:g.width,l=Number.isFinite(l)?l:g.height,g.bind(0),p=g.glTarget;else throw new Error("invalid destination");switch(p){case 3553:case 34067:t.gl.copyTexSubImage2D(p,r,_,v,f,h,a,l);break;case 35866:case 32879:t.gl.copyTexSubImage3D(p,r,_,v,E,f,h,a,l);break}g&&g.unbind(),t.gl.bindFramebuffer(36160,b),u&&c.destroy()}function T1(t){if(t instanceof ve){const{width:e,height:n,id:r}=t;return{framebuffer:t.device.createFramebuffer({id:`framebuffer-for-${r}`,width:e,height:n,colorAttachments:[t]}),destroyFramebuffer:!0}}return{framebuffer:t,destroyFramebuffer:!1}}class Ck extends Ch{constructor(n,r){super(n,r);d(this,"device");d(this,"commandBuffer");this.device=n,this.commandBuffer=new Ek(n)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(n){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:n})}copyBufferToTexture(n){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:n})}copyTextureToBuffer(n){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:n})}copyTextureToTexture(n){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:n})}pushDebugGroup(n){}popDebugGroup(){}insertDebugMarker(n){}resolveQuerySet(n,r,i){}}function xk(t){const{target:e,source:n,start:r=0,count:i=1}=t,s=n.length,o=i*s;let a=0;for(let l=r;a<s;a++)e[l++]=n[a];for(;a<o;)a<o-a?(e.copyWithin(r+a,r,r+a),a*=2):(e.copyWithin(r+a,r,r+o-a),a=o);return t.target}class Ip extends Ph{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"buffer",null);d(this,"bufferValue",null);this.device=n,this.handle=this.device.gl.createVertexArray()}get[Symbol.toStringTag](){return"VertexArray"}static isConstantAttributeZeroSupported(n){return VA()==="Chrome"}destroy(){var n;super.destroy(),this.buffer&&((n=this.buffer)==null||n.destroy()),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(n){const r=n;if(r&&r.glTarget!==34963)throw new Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,r?r.handle:null),this.indexBuffer=r,this.device.gl.bindVertexArray(null)}setBuffer(n,r){const i=r;if(i.glTarget===34963)throw new Error("Use .setIndexBuffer()");const{size:s,type:o,stride:a,offset:l,normalized:c,integer:u,divisor:f}=this._getAccessor(n);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,i.handle),u?this.device.gl.vertexAttribIPointer(n,s,o,a,l):this.device.gl.vertexAttribPointer(n,s,o,c,a,l),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(n),this.device.gl.vertexAttribDivisor(n,f||0),this.attributes[n]=i,this.device.gl.bindVertexArray(null)}setConstantWebGL(n,r){this._enable(n,!1),this.attributes[n]=r}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let n=0;n<this.maxVertexAttributes;++n){const r=this.attributes[n];ArrayBuffer.isView(r)&&this.device.setConstantAttributeWebGL(n,r)}}_getAccessor(n){const r=this.attributeInfos[n];if(!r)throw new Error(`Unknown attribute location ${n}`);const i=c1(r.bufferDataType);return{size:r.bufferComponents,type:i,stride:r.byteStride,offset:r.byteOffset,normalized:r.normalized,integer:r.integer,divisor:r.stepMode==="instance"?1:0}}_enable(n,r=!0){const s=Ip.isConstantAttributeZeroSupported(this.device)||n!==0;(r||s)&&(n=Number(n),this.device.gl.bindVertexArray(this.handle),r?this.device.gl.enableVertexAttribArray(n):this.device.gl.disableVertexAttribArray(n),this.device.gl.bindVertexArray(null))}getConstantBuffer(n,r){const i=Pk(r),s=i.byteLength*n,o=i.length*n;if(this.buffer&&s!==this.buffer.byteLength)throw new Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let a=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),a=a||!Mk(i,this.bufferValue),a){const l=Rx(r.constructor,o);xk({target:l,source:i,start:0,count:o}),this.buffer.write(l),this.bufferValue=r}return this.buffer}}function Pk(t){return Array.isArray(t)?new Float32Array(t):t}function Mk(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}class Ik extends Mh{constructor(n,r){super(n,r);d(this,"device");d(this,"gl");d(this,"handle");d(this,"layout");d(this,"buffers",{});d(this,"unusedBuffers",{});d(this,"bindOnUse",!0);d(this,"_bound",!1);this.device=n,this.gl=n.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,r.buffers&&this.setBuffers(r.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(n="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(vk(n))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(n){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(const r in n)this.setBuffer(r,n[r])})}setBuffer(n,r){const i=this._getVaryingIndex(n),{buffer:s,byteLength:o,byteOffset:a}=this._getBufferRange(r);if(i<0){this.unusedBuffers[n]=s,z.warn(`${this.id} unusedBuffers varying buffer ${n}`)();return}this.buffers[i]={buffer:s,byteLength:o,byteOffset:a},this.bindOnUse||this._bindBuffer(i,s,a,o)}getBuffer(n){if(ey(n))return this.buffers[n]||null;const r=this._getVaryingIndex(n);return r>=0?this.buffers[r]:null}bind(n=this.handle){if(typeof n!="function")return this.gl.bindTransformFeedback(36386,n),this;let r;return this._bound?r=n():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,r=n(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),r}unbind(){this.bind(null)}_getBufferRange(n){if(n instanceof js)return{buffer:n,byteOffset:0,byteLength:n.byteLength};const{buffer:r,byteOffset:i=0,byteLength:s=n.buffer.byteLength}=n;return{buffer:r,byteOffset:i,byteLength:s}}_getVaryingIndex(n){if(ey(n))return Number(n);for(const r of this.layout.varyings)if(n===r.name)return r.location;return-1}_bindBuffers(){for(const n in this.buffers){const{buffer:r,byteLength:i,byteOffset:s}=this._getBufferRange(this.buffers[n]);this._bindBuffer(Number(n),r,s,i)}}_unbindBuffers(){for(const n in this.buffers)this.gl.bindBufferBase(35982,Number(n),null)}_bindBuffer(n,r,i=0,s){const o=r&&r.handle;!o||s===void 0?this.gl.bindBufferBase(35982,n,o):this.gl.bindBufferRange(35982,n,o,i,s)}}function ey(t){return typeof t=="number"?Number.isInteger(t):/^\d+$/.test(t)}class Nk extends Ih{constructor(n,r){super(n,r);d(this,"device");d(this,"handle");d(this,"target",null);d(this,"_queryPending",!1);d(this,"_pollingPromise",null);if(this.device=n,r.count>1)throw new Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}get[Symbol.toStringTag](){return"Query"}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(n){return this._begin(n!=null&&n.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(n){this._queryPending||(this.target=n,this.device.gl.beginQuery(this.target,this.handle))}_end(){this._queryPending||this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;const n=this.device.gl.getQueryParameter(this.handle,34919);return n&&(this._queryPending=!1),n}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(n=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let r=0;return this._pollingPromise=new Promise((i,s)=>{const o=()=>{this.isResultAvailable()?(i(this.getResult()),this._pollingPromise=null):r++>n?(s("Timed out"),this._pollingPromise=null):requestAnimationFrame(o)};requestAnimationFrame(o)}),this._pollingPromise}}const kk=256,Ok=1024,Fk=16384;function Dk(t,e){z.warn("clear will be removed in next minor release");const{framebuffer:n=null,color:r=null,depth:i=null,stencil:s=null}=e||{},o={};n&&(o.framebuffer=n);let a=0;r&&(a|=Fk,r!==!0&&(o.clearColor=r)),i&&(a|=kk,i!==!0&&(o.clearDepth=i)),s&&(a|=Ok,i!==!0&&(o.clearStencil=i));const l=t.gl;Xi(l,o,()=>{l.clear(a)})}class Cs extends wr{constructor(n){var u,f;super({...n,id:n.id||ON("webgl-device")});d(this,"type","webgl");d(this,"handle");d(this,"features");d(this,"limits");d(this,"info");d(this,"canvasContext");d(this,"lost");d(this,"_resolveContextLost");d(this,"gl");d(this,"debug",!1);d(this,"_canvasSizeInfo",{clientWidth:0,clientHeight:0,devicePixelRatio:1});d(this,"_extensions",{});d(this,"_polyfilled",!1);d(this,"spectorJS");d(this,"renderPass",null);d(this,"_constants");if(!n.createCanvasContext)throw new Error("WebGLDevice requires props.createCanvasContext to be set");const r=n.createCanvasContext===!0?{}:n.createCanvasContext;let i=(f=(u=r.canvas)==null?void 0:u.gl)==null?void 0:f.device;if(i)throw new Error(`WebGL context already attached to device ${i.id}`);this.canvasContext=new SN(this,r),this.lost=new Promise(h=>{this._resolveContextLost=h});const s={...n.webgl};r.alphaMode==="premultiplied"&&(s.premultipliedAlpha=!0),n.powerPreference!==void 0&&(s.powerPreference=n.powerPreference);const o=eN(this.canvasContext.canvas,{onContextLost:h=>{var _;return(_=this._resolveContextLost)==null?void 0:_.call(this,{reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."})},onContextRestored:h=>console.log("WebGL context restored")},s);if(!o)throw new Error("WebGL context creation failed");if(i=o.device,i)throw new Error(`WebGL context already attached to device ${i.id}`);this.handle=o,this.gl=o,this.spectorJS=RN({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=tN(this.gl,this._extensions),this.limits=new TN(this.gl),this.features=new vN(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),this.canvasContext.resize(),new Sr(this.gl,{log:(...h)=>z.log(1,...h)()}).trackState(this.gl,{copyState:!1});const l=n.debugWebGL||n.debug,c=n.debugWebGL;l&&(this.gl=PN(this.gl,{debugWebGL:l,traceWebGL:c}),z.warn("WebGL debug mode activated. Performance reduced.")(),n.debugWebGL&&(z.level=Math.max(z.level,1)))}destroy(){}get isLost(){return this.gl.isContextLost()}isTextureFormatSupported(n){return dN(this.gl,n,this._extensions)}isTextureFormatFilterable(n){return pN(this.gl,n,this._extensions)}isTextureFormatRenderable(n){return gN(this.gl,n,this._extensions)}createCanvasContext(n){throw new Error("WebGL only supports a single canvas")}createBuffer(n){const r=this._normalizeBufferProps(n);return new js(this,r)}createTexture(n){return new Hs(this,n)}createExternalTexture(n){throw new Error("createExternalTexture() not implemented")}createSampler(n){return new Kh(this,n)}createShader(n){return new UN(this,n)}createFramebuffer(n){return new Vs(this,n)}createVertexArray(n){return new Ip(this,n)}createTransformFeedback(n){return new Ik(this,n)}createQuerySet(n){return new Nk(this,n)}createRenderPipeline(n){return new Tk(this,n)}beginRenderPass(n){return new rk(this,n)}createComputePipeline(n){throw new Error("ComputePipeline not supported in WebGL")}beginComputePass(n){throw new Error("ComputePass not supported in WebGL")}createCommandEncoder(n={}){return new Ck(this,n)}submit(){var n;(n=this.renderPass)==null||n.end(),this.renderPass=null}readPixelsToArrayWebGL(n,r){return JN(n,r)}readPixelsToBufferWebGL(n,r){return GN(n,r)}setParametersWebGL(n){Ji(this.gl,n)}getParametersWebGL(n){return a1(this.gl,n)}withParametersWebGL(n,r){return Xi(this.gl,n,r)}clearWebGL(n){Dk(this,n)}resetWebGL(){z.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),qI(this.gl)}loseDevice(){var s;let n=!1;const i=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return i&&(n=!0,i.loseContext()),(s=this._resolveContextLost)==null||s.call(this,{reason:"destroyed",message:"Application triggered context loss"}),n}pushState(){Sr.get(this.gl).push()}popState(){Sr.get(this.gl).pop()}setSpectorMetadata(n,r){n.__SPECTOR_Metadata=r}getGLKey(n,r){const i=Number(n);for(const s in this.gl)if(this.gl[s]===i)return`GL.${s}`;return r!=null&&r.emptyIfUnknown?"":String(n)}getGLKeys(n){const r={emptyIfUnknown:!0};return Object.entries(n).reduce((i,[s,o])=>(i[`${s}:${this.getGLKey(s,r)}`]=`${o}:${this.getGLKey(o,r)}`,i),{})}setConstantAttributeWebGL(n,r){const i=this.limits.maxVertexAttributes;this._constants=this._constants||new Array(i).fill(null);const s=this._constants[n];switch(s&&zk(s,r)&&z.info(1,`setConstantAttributeWebGL(${n}) could have been skipped, value unchanged`)(),this._constants[n]=r,r.constructor){case Float32Array:Bk(this,n,r);break;case Int32Array:Uk(this,n,r);break;case Uint32Array:Lk(this,n,r);break;default:throw new Error("constant")}}getExtension(n){return $i(this.gl,n,this._extensions),this._extensions}}function Bk(t,e,n){switch(n.length){case 1:t.gl.vertexAttrib1fv(e,n);break;case 2:t.gl.vertexAttrib2fv(e,n);break;case 3:t.gl.vertexAttrib3fv(e,n);break;case 4:t.gl.vertexAttrib4fv(e,n);break}}function Uk(t,e,n){t.gl.vertexAttribI4iv(e,n)}function Lk(t,e,n){t.gl.vertexAttribI4uiv(e,n)}function zk(t,e){if(!t||!e||t.length!==e.length||t.constructor!==e.constructor)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}const Vk={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},jk=t=>({drawBuffersWEBGL(e){return t.drawBuffers(e)},COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),Hk=t=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES(){return t.createVertexArray()},deleteVertexArrayOES(e){return t.deleteVertexArray(e)},isVertexArrayOES(e){return t.isVertexArray(e)},bindVertexArrayOES(e){return t.bindVertexArray(e)}}),Wk=t=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE(...e){return t.drawArraysInstanced(...e)},drawElementsInstancedANGLE(...e){return t.drawElementsInstanced(...e)},vertexAttribDivisorANGLE(...e){return t.vertexAttribDivisor(...e)}});function $k(t=!0){const e=HTMLCanvasElement.prototype;if(!t&&e.originalGetContext){e.getContext=e.originalGetContext,e.originalGetContext=void 0;return}e.originalGetContext=e.getContext,e.getContext=function(n,r){if(n==="webgl"||n==="experimental-webgl"){const i=this.originalGetContext("webgl2",r);return i instanceof HTMLElement&&Xk(i),i}return this.originalGetContext(n,r)}}function Xk(t){t.getExtension("EXT_color_buffer_float");const e={...Vk,WEBGL_disjoint_timer_query:t.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:jk(t),OES_vertex_array_object:Hk(t),ANGLE_instanced_arrays:Wk(t)},n=t.getExtension;t.getExtension=function(i){const s=n.call(t,i);return s||(i in e?e[i]:null)};const r=t.getSupportedExtensions;t.getSupportedExtensions=function(){const i=r.apply(t)||[];return i==null?void 0:i.concat(Object.keys(e))}}const Ca=1;class Yk extends nx{constructor(){super();d(this,"type","webgl");wr.defaultProps={...wr.defaultProps,...Mp},Cs.adapter=this}isSupported(){return typeof WebGL2RenderingContext<"u"}enforceWebGL2(n){$k(n)}async attach(n){if(n instanceof Cs)return n;if((n==null?void 0:n.device)instanceof wr)return n.device;if(!Kk(n))throw new Error("Invalid WebGL2RenderingContext");return new Cs({_handle:n})}async create(n={}){z.groupCollapsed(Ca,"WebGLDevice created")();const r=[];(n.debugWebGL||n.debug)&&r.push(xN()),n.debugSpectorJS&&r.push(AN(n));const i=await Promise.allSettled(r);for(const a of i)a.status==="rejected"&&z.error(`Failed to initialize debug libraries ${a.reason}`)();const s=new Cs(n),o=`Created ${s.type}${s.debug?" debug":""} context: ${s.info.vendor}, ${s.info.renderer} for canvas: ${s.canvasContext.id}`;return z.probe(Ca,o)(),z.table(Ca,s.info)(),z.groupEnd(Ca)(),s}}function Kk(t){return typeof WebGL2RenderingContext<"u"&&t instanceof WebGL2RenderingContext?!0:!!(t&&Number.isFinite(t._version))}const ty=new Yk;var w1={exports:{}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(t){(function(e,n,r,i){var s=["","webkit","Moz","MS","ms","o"],o=n.createElement("div"),a="function",l=Math.round,c=Math.abs,u=Date.now;function f(m,T,A){return setTimeout(y(m,A),T)}function h(m,T,A){return Array.isArray(m)?(_(m,A[T],A),!0):!1}function _(m,T,A){var N;if(m)if(m.forEach)m.forEach(T,A);else if(m.length!==i)for(N=0;N<m.length;)T.call(A,m[N],N,m),N++;else for(N in m)m.hasOwnProperty(N)&&T.call(A,m[N],N,m)}function v(m,T,A){var N="DEPRECATED METHOD: "+T+`
`+A+` AT 
`;return function(){var U=new Error("get-stack-trace"),$=U&&U.stack?U.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Q=e.console&&(e.console.warn||e.console.log);return Q&&Q.call(e.console,N,$),m.apply(this,arguments)}}var E;typeof Object.assign!="function"?E=function(T){if(T===i||T===null)throw new TypeError("Cannot convert undefined or null to object");for(var A=Object(T),N=1;N<arguments.length;N++){var U=arguments[N];if(U!==i&&U!==null)for(var $ in U)U.hasOwnProperty($)&&(A[$]=U[$])}return A}:E=Object.assign;var b=v(function(T,A,N){for(var U=Object.keys(A),$=0;$<U.length;)(!N||N&&T[U[$]]===i)&&(T[U[$]]=A[U[$]]),$++;return T},"extend","Use `assign`."),g=v(function(T,A){return b(T,A,!0)},"merge","Use `assign`.");function p(m,T,A){var N=T.prototype,U;U=m.prototype=Object.create(N),U.constructor=m,U._super=N,A&&E(U,A)}function y(m,T){return function(){return m.apply(T,arguments)}}function S(m,T){return typeof m==a?m.apply(T&&T[0]||i,T):m}function R(m,T){return m===i?T:m}function P(m,T,A){_(D(T),function(N){m.addEventListener(N,A,!1)})}function O(m,T,A){_(D(T),function(N){m.removeEventListener(N,A,!1)})}function M(m,T){for(;m;){if(m==T)return!0;m=m.parentNode}return!1}function k(m,T){return m.indexOf(T)>-1}function D(m){return m.trim().split(/\s+/g)}function F(m,T,A){if(m.indexOf&&!A)return m.indexOf(T);for(var N=0;N<m.length;){if(A&&m[N][A]==T||!A&&m[N]===T)return N;N++}return-1}function B(m){return Array.prototype.slice.call(m,0)}function V(m,T,A){for(var N=[],U=[],$=0;$<m.length;){var Q=T?m[$][T]:m[$];F(U,Q)<0&&N.push(m[$]),U[$]=Q,$++}return A&&(T?N=N.sort(function(Oe,qe){return Oe[T]>qe[T]}):N=N.sort()),N}function H(m,T){for(var A,N,U=T[0].toUpperCase()+T.slice(1),$=0;$<s.length;){if(A=s[$],N=A?A+U:T,N in m)return N;$++}return i}var Z=1;function Ce(){return Z++}function we(m){var T=m.ownerDocument||m;return T.defaultView||T.parentWindow||e}var j=/mobile|tablet|ip(ad|hone|od)|android/i,Y="ontouchstart"in e,q=H(e,"PointerEvent")!==i,K=Y&&j.test(navigator.userAgent),G="touch",fe="pen",ze="mouse",Ct="kinect",an=25,Se=1,rr=2,be=4,tt=8,Bo=1,Gi=2,es=4,ts=8,ns=16,Vt=Gi|es,ir=ts|ns,Xp=Vt|ir,Yp=["x","y"],Uo=["clientX","clientY"];function yt(m,T){var A=this;this.manager=m,this.callback=T,this.element=m.element,this.target=m.options.inputTarget,this.domHandler=function(N){S(m.options.enable,[m])&&A.handler(N)},this.init()}yt.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(we(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&O(this.element,this.evEl,this.domHandler),this.evTarget&&O(this.target,this.evTarget,this.domHandler),this.evWin&&O(we(this.element),this.evWin,this.domHandler)}};function yE(m){var T,A=m.options.inputClass;return A?T=A:q?T=tu:K?T=Vo:Y?T=nu:T=zo,new T(m,vE)}function vE(m,T,A){var N=A.pointers.length,U=A.changedPointers.length,$=T&Se&&N-U===0,Q=T&(be|tt)&&N-U===0;A.isFirst=!!$,A.isFinal=!!Q,$&&(m.session={}),A.eventType=T,TE(m,A),m.emit("hammer.input",A),m.recognize(A),m.session.prevInput=A}function TE(m,T){var A=m.session,N=T.pointers,U=N.length;A.firstInput||(A.firstInput=Kp(T)),U>1&&!A.firstMultiple?A.firstMultiple=Kp(T):U===1&&(A.firstMultiple=!1);var $=A.firstInput,Q=A.firstMultiple,Me=Q?Q.center:$.center,Oe=T.center=qp(N);T.timeStamp=u(),T.deltaTime=T.timeStamp-$.timeStamp,T.angle=eu(Me,Oe),T.distance=Lo(Me,Oe),wE(A,T),T.offsetDirection=Qp(T.deltaX,T.deltaY);var qe=Zp(T.deltaTime,T.deltaX,T.deltaY);T.overallVelocityX=qe.x,T.overallVelocityY=qe.y,T.overallVelocity=c(qe.x)>c(qe.y)?qe.x:qe.y,T.scale=Q?bE(Q.pointers,N):1,T.rotation=Q?SE(Q.pointers,N):0,T.maxPointers=A.prevInput?T.pointers.length>A.prevInput.maxPointers?T.pointers.length:A.prevInput.maxPointers:T.pointers.length,EE(A,T);var Ht=m.element;M(T.srcEvent.target,Ht)&&(Ht=T.srcEvent.target),T.target=Ht}function wE(m,T){var A=T.center,N=m.offsetDelta||{},U=m.prevDelta||{},$=m.prevInput||{};(T.eventType===Se||$.eventType===be)&&(U=m.prevDelta={x:$.deltaX||0,y:$.deltaY||0},N=m.offsetDelta={x:A.x,y:A.y}),T.deltaX=U.x+(A.x-N.x),T.deltaY=U.y+(A.y-N.y)}function EE(m,T){var A=m.lastInterval||T,N=T.timeStamp-A.timeStamp,U,$,Q,Me;if(T.eventType!=tt&&(N>an||A.velocity===i)){var Oe=T.deltaX-A.deltaX,qe=T.deltaY-A.deltaY,Ht=Zp(N,Oe,qe);$=Ht.x,Q=Ht.y,U=c(Ht.x)>c(Ht.y)?Ht.x:Ht.y,Me=Qp(Oe,qe),m.lastInterval=T}else U=A.velocity,$=A.velocityX,Q=A.velocityY,Me=A.direction;T.velocity=U,T.velocityX=$,T.velocityY=Q,T.direction=Me}function Kp(m){for(var T=[],A=0;A<m.pointers.length;)T[A]={clientX:l(m.pointers[A].clientX),clientY:l(m.pointers[A].clientY)},A++;return{timeStamp:u(),pointers:T,center:qp(T),deltaX:m.deltaX,deltaY:m.deltaY}}function qp(m){var T=m.length;if(T===1)return{x:l(m[0].clientX),y:l(m[0].clientY)};for(var A=0,N=0,U=0;U<T;)A+=m[U].clientX,N+=m[U].clientY,U++;return{x:l(A/T),y:l(N/T)}}function Zp(m,T,A){return{x:T/m||0,y:A/m||0}}function Qp(m,T){return m===T?Bo:c(m)>=c(T)?m<0?Gi:es:T<0?ts:ns}function Lo(m,T,A){A||(A=Yp);var N=T[A[0]]-m[A[0]],U=T[A[1]]-m[A[1]];return Math.sqrt(N*N+U*U)}function eu(m,T,A){A||(A=Yp);var N=T[A[0]]-m[A[0]],U=T[A[1]]-m[A[1]];return Math.atan2(U,N)*180/Math.PI}function SE(m,T){return eu(T[1],T[0],Uo)+eu(m[1],m[0],Uo)}function bE(m,T){return Lo(T[0],T[1],Uo)/Lo(m[0],m[1],Uo)}var AE={mousedown:Se,mousemove:rr,mouseup:be},RE="mousedown",CE="mousemove mouseup";function zo(){this.evEl=RE,this.evWin=CE,this.pressed=!1,yt.apply(this,arguments)}p(zo,yt,{handler:function(T){var A=AE[T.type];A&Se&&T.button===0&&(this.pressed=!0),A&rr&&T.which!==1&&(A=be),this.pressed&&(A&be&&(this.pressed=!1),this.callback(this.manager,A,{pointers:[T],changedPointers:[T],pointerType:ze,srcEvent:T}))}});var xE={pointerdown:Se,pointermove:rr,pointerup:be,pointercancel:tt,pointerout:tt},PE={2:G,3:fe,4:ze,5:Ct},Jp="pointerdown",Gp="pointermove pointerup pointercancel";e.MSPointerEvent&&!e.PointerEvent&&(Jp="MSPointerDown",Gp="MSPointerMove MSPointerUp MSPointerCancel");function tu(){this.evEl=Jp,this.evWin=Gp,yt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}p(tu,yt,{handler:function(T){var A=this.store,N=!1,U=T.type.toLowerCase().replace("ms",""),$=xE[U],Q=PE[T.pointerType]||T.pointerType,Me=Q==G,Oe=F(A,T.pointerId,"pointerId");$&Se&&(T.button===0||Me)?Oe<0&&(A.push(T),Oe=A.length-1):$&(be|tt)&&(N=!0),!(Oe<0)&&(A[Oe]=T,this.callback(this.manager,$,{pointers:A,changedPointers:[T],pointerType:Q,srcEvent:T}),N&&A.splice(Oe,1))}});var ME={touchstart:Se,touchmove:rr,touchend:be,touchcancel:tt},IE="touchstart",NE="touchstart touchmove touchend touchcancel";function eg(){this.evTarget=IE,this.evWin=NE,this.started=!1,yt.apply(this,arguments)}p(eg,yt,{handler:function(T){var A=ME[T.type];if(A===Se&&(this.started=!0),!!this.started){var N=kE.call(this,T,A);A&(be|tt)&&N[0].length-N[1].length===0&&(this.started=!1),this.callback(this.manager,A,{pointers:N[0],changedPointers:N[1],pointerType:G,srcEvent:T})}}});function kE(m,T){var A=B(m.touches),N=B(m.changedTouches);return T&(be|tt)&&(A=V(A.concat(N),"identifier",!0)),[A,N]}var OE={touchstart:Se,touchmove:rr,touchend:be,touchcancel:tt},FE="touchstart touchmove touchend touchcancel";function Vo(){this.evTarget=FE,this.targetIds={},yt.apply(this,arguments)}p(Vo,yt,{handler:function(T){var A=OE[T.type],N=DE.call(this,T,A);N&&this.callback(this.manager,A,{pointers:N[0],changedPointers:N[1],pointerType:G,srcEvent:T})}});function DE(m,T){var A=B(m.touches),N=this.targetIds;if(T&(Se|rr)&&A.length===1)return N[A[0].identifier]=!0,[A,A];var U,$,Q=B(m.changedTouches),Me=[],Oe=this.target;if($=A.filter(function(qe){return M(qe.target,Oe)}),T===Se)for(U=0;U<$.length;)N[$[U].identifier]=!0,U++;for(U=0;U<Q.length;)N[Q[U].identifier]&&Me.push(Q[U]),T&(be|tt)&&delete N[Q[U].identifier],U++;if(Me.length)return[V($.concat(Me),"identifier",!0),Me]}var BE=2500,tg=25;function nu(){yt.apply(this,arguments);var m=y(this.handler,this);this.touch=new Vo(this.manager,m),this.mouse=new zo(this.manager,m),this.primaryTouch=null,this.lastTouches=[]}p(nu,yt,{handler:function(T,A,N){var U=N.pointerType==G,$=N.pointerType==ze;if(!($&&N.sourceCapabilities&&N.sourceCapabilities.firesTouchEvents)){if(U)UE.call(this,A,N);else if($&&LE.call(this,N))return;this.callback(T,A,N)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function UE(m,T){m&Se?(this.primaryTouch=T.changedPointers[0].identifier,ng.call(this,T)):m&(be|tt)&&ng.call(this,T)}function ng(m){var T=m.changedPointers[0];if(T.identifier===this.primaryTouch){var A={x:T.clientX,y:T.clientY};this.lastTouches.push(A);var N=this.lastTouches,U=function(){var $=N.indexOf(A);$>-1&&N.splice($,1)};setTimeout(U,BE)}}function LE(m){for(var T=m.srcEvent.clientX,A=m.srcEvent.clientY,N=0;N<this.lastTouches.length;N++){var U=this.lastTouches[N],$=Math.abs(T-U.x),Q=Math.abs(A-U.y);if($<=tg&&Q<=tg)return!0}return!1}var rg=H(o.style,"touchAction"),ig=rg!==i,sg="compute",og="auto",ru="manipulation",sr="none",rs="pan-x",is="pan-y",jo=VE();function iu(m,T){this.manager=m,this.set(T)}iu.prototype={set:function(m){m==sg&&(m=this.compute()),ig&&this.manager.element.style&&jo[m]&&(this.manager.element.style[rg]=m),this.actions=m.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var m=[];return _(this.manager.recognizers,function(T){S(T.options.enable,[T])&&(m=m.concat(T.getTouchAction()))}),zE(m.join(" "))},preventDefaults:function(m){var T=m.srcEvent,A=m.offsetDirection;if(this.manager.session.prevented){T.preventDefault();return}var N=this.actions,U=k(N,sr)&&!jo[sr],$=k(N,is)&&!jo[is],Q=k(N,rs)&&!jo[rs];if(U){var Me=m.pointers.length===1,Oe=m.distance<2,qe=m.deltaTime<250;if(Me&&Oe&&qe)return}if(!(Q&&$)&&(U||$&&A&Vt||Q&&A&ir))return this.preventSrc(T)},preventSrc:function(m){this.manager.session.prevented=!0,m.preventDefault()}};function zE(m){if(k(m,sr))return sr;var T=k(m,rs),A=k(m,is);return T&&A?sr:T||A?T?rs:is:k(m,ru)?ru:og}function VE(){if(!ig)return!1;var m={},T=e.CSS&&e.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(A){m[A]=T?e.CSS.supports("touch-action",A):!0}),m}var Ho=1,vt=2,Lr=4,An=8,ln=An,ss=16,jt=32;function cn(m){this.options=E({},this.defaults,m||{}),this.id=Ce(),this.manager=null,this.options.enable=R(this.options.enable,!0),this.state=Ho,this.simultaneous={},this.requireFail=[]}cn.prototype={defaults:{},set:function(m){return E(this.options,m),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(m){if(h(m,"recognizeWith",this))return this;var T=this.simultaneous;return m=Wo(m,this),T[m.id]||(T[m.id]=m,m.recognizeWith(this)),this},dropRecognizeWith:function(m){return h(m,"dropRecognizeWith",this)?this:(m=Wo(m,this),delete this.simultaneous[m.id],this)},requireFailure:function(m){if(h(m,"requireFailure",this))return this;var T=this.requireFail;return m=Wo(m,this),F(T,m)===-1&&(T.push(m),m.requireFailure(this)),this},dropRequireFailure:function(m){if(h(m,"dropRequireFailure",this))return this;m=Wo(m,this);var T=F(this.requireFail,m);return T>-1&&this.requireFail.splice(T,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(m){return!!this.simultaneous[m.id]},emit:function(m){var T=this,A=this.state;function N(U){T.manager.emit(U,m)}A<An&&N(T.options.event+ag(A)),N(T.options.event),m.additionalEvent&&N(m.additionalEvent),A>=An&&N(T.options.event+ag(A))},tryEmit:function(m){if(this.canEmit())return this.emit(m);this.state=jt},canEmit:function(){for(var m=0;m<this.requireFail.length;){if(!(this.requireFail[m].state&(jt|Ho)))return!1;m++}return!0},recognize:function(m){var T=E({},m);if(!S(this.options.enable,[this,T])){this.reset(),this.state=jt;return}this.state&(ln|ss|jt)&&(this.state=Ho),this.state=this.process(T),this.state&(vt|Lr|An|ss)&&this.tryEmit(T)},process:function(m){},getTouchAction:function(){},reset:function(){}};function ag(m){return m&ss?"cancel":m&An?"end":m&Lr?"move":m&vt?"start":""}function lg(m){return m==ns?"down":m==ts?"up":m==Gi?"left":m==es?"right":""}function Wo(m,T){var A=T.manager;return A?A.get(m):m}function xt(){cn.apply(this,arguments)}p(xt,cn,{defaults:{pointers:1},attrTest:function(m){var T=this.options.pointers;return T===0||m.pointers.length===T},process:function(m){var T=this.state,A=m.eventType,N=T&(vt|Lr),U=this.attrTest(m);return N&&(A&tt||!U)?T|ss:N||U?A&be?T|An:T&vt?T|Lr:vt:jt}});function $o(){xt.apply(this,arguments),this.pX=null,this.pY=null}p($o,xt,{defaults:{event:"pan",threshold:10,pointers:1,direction:Xp},getTouchAction:function(){var m=this.options.direction,T=[];return m&Vt&&T.push(is),m&ir&&T.push(rs),T},directionTest:function(m){var T=this.options,A=!0,N=m.distance,U=m.direction,$=m.deltaX,Q=m.deltaY;return U&T.direction||(T.direction&Vt?(U=$===0?Bo:$<0?Gi:es,A=$!=this.pX,N=Math.abs(m.deltaX)):(U=Q===0?Bo:Q<0?ts:ns,A=Q!=this.pY,N=Math.abs(m.deltaY))),m.direction=U,A&&N>T.threshold&&U&T.direction},attrTest:function(m){return xt.prototype.attrTest.call(this,m)&&(this.state&vt||!(this.state&vt)&&this.directionTest(m))},emit:function(m){this.pX=m.deltaX,this.pY=m.deltaY;var T=lg(m.direction);T&&(m.additionalEvent=this.options.event+T),this._super.emit.call(this,m)}});function su(){xt.apply(this,arguments)}p(su,xt,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[sr]},attrTest:function(m){return this._super.attrTest.call(this,m)&&(Math.abs(m.scale-1)>this.options.threshold||this.state&vt)},emit:function(m){if(m.scale!==1){var T=m.scale<1?"in":"out";m.additionalEvent=this.options.event+T}this._super.emit.call(this,m)}});function ou(){cn.apply(this,arguments),this._timer=null,this._input=null}p(ou,cn,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[og]},process:function(m){var T=this.options,A=m.pointers.length===T.pointers,N=m.distance<T.threshold,U=m.deltaTime>T.time;if(this._input=m,!N||!A||m.eventType&(be|tt)&&!U)this.reset();else if(m.eventType&Se)this.reset(),this._timer=f(function(){this.state=ln,this.tryEmit()},T.time,this);else if(m.eventType&be)return ln;return jt},reset:function(){clearTimeout(this._timer)},emit:function(m){this.state===ln&&(m&&m.eventType&be?this.manager.emit(this.options.event+"up",m):(this._input.timeStamp=u(),this.manager.emit(this.options.event,this._input)))}});function au(){xt.apply(this,arguments)}p(au,xt,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[sr]},attrTest:function(m){return this._super.attrTest.call(this,m)&&(Math.abs(m.rotation)>this.options.threshold||this.state&vt)}});function lu(){xt.apply(this,arguments)}p(lu,xt,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Vt|ir,pointers:1},getTouchAction:function(){return $o.prototype.getTouchAction.call(this)},attrTest:function(m){var T=this.options.direction,A;return T&(Vt|ir)?A=m.overallVelocity:T&Vt?A=m.overallVelocityX:T&ir&&(A=m.overallVelocityY),this._super.attrTest.call(this,m)&&T&m.offsetDirection&&m.distance>this.options.threshold&&m.maxPointers==this.options.pointers&&c(A)>this.options.velocity&&m.eventType&be},emit:function(m){var T=lg(m.offsetDirection);T&&this.manager.emit(this.options.event+T,m),this.manager.emit(this.options.event,m)}});function Xo(){cn.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}p(Xo,cn,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[ru]},process:function(m){var T=this.options,A=m.pointers.length===T.pointers,N=m.distance<T.threshold,U=m.deltaTime<T.time;if(this.reset(),m.eventType&Se&&this.count===0)return this.failTimeout();if(N&&U&&A){if(m.eventType!=be)return this.failTimeout();var $=this.pTime?m.timeStamp-this.pTime<T.interval:!0,Q=!this.pCenter||Lo(this.pCenter,m.center)<T.posThreshold;this.pTime=m.timeStamp,this.pCenter=m.center,!Q||!$?this.count=1:this.count+=1,this._input=m;var Me=this.count%T.taps;if(Me===0)return this.hasRequireFailures()?(this._timer=f(function(){this.state=ln,this.tryEmit()},T.interval,this),vt):ln}return jt},failTimeout:function(){return this._timer=f(function(){this.state=jt},this.options.interval,this),jt},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ln&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function un(m,T){return T=T||{},T.recognizers=R(T.recognizers,un.defaults.preset),new cu(m,T)}un.VERSION="2.0.7",un.defaults={domEvents:!1,touchAction:sg,enable:!0,inputTarget:null,inputClass:null,preset:[[au,{enable:!1}],[su,{enable:!1},["rotate"]],[lu,{direction:Vt}],[$o,{direction:Vt},["swipe"]],[Xo],[Xo,{event:"doubletap",taps:2},["tap"]],[ou]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var jE=1,cg=2;function cu(m,T){this.options=E({},un.defaults,T||{}),this.options.inputTarget=this.options.inputTarget||m,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=m,this.input=yE(this),this.touchAction=new iu(this,this.options.touchAction),ug(this,!0),_(this.options.recognizers,function(A){var N=this.add(new A[0](A[1]));A[2]&&N.recognizeWith(A[2]),A[3]&&N.requireFailure(A[3])},this)}cu.prototype={set:function(m){return E(this.options,m),m.touchAction&&this.touchAction.update(),m.inputTarget&&(this.input.destroy(),this.input.target=m.inputTarget,this.input.init()),this},stop:function(m){this.session.stopped=m?cg:jE},recognize:function(m){var T=this.session;if(!T.stopped){this.touchAction.preventDefaults(m);var A,N=this.recognizers,U=T.curRecognizer;(!U||U&&U.state&ln)&&(U=T.curRecognizer=null);for(var $=0;$<N.length;)A=N[$],T.stopped!==cg&&(!U||A==U||A.canRecognizeWith(U))?A.recognize(m):A.reset(),!U&&A.state&(vt|Lr|An)&&(U=T.curRecognizer=A),$++}},get:function(m){if(m instanceof cn)return m;for(var T=this.recognizers,A=0;A<T.length;A++)if(T[A].options.event==m)return T[A];return null},add:function(m){if(h(m,"add",this))return this;var T=this.get(m.options.event);return T&&this.remove(T),this.recognizers.push(m),m.manager=this,this.touchAction.update(),m},remove:function(m){if(h(m,"remove",this))return this;if(m=this.get(m),m){var T=this.recognizers,A=F(T,m);A!==-1&&(T.splice(A,1),this.touchAction.update())}return this},on:function(m,T){if(m!==i&&T!==i){var A=this.handlers;return _(D(m),function(N){A[N]=A[N]||[],A[N].push(T)}),this}},off:function(m,T){if(m!==i){var A=this.handlers;return _(D(m),function(N){T?A[N]&&A[N].splice(F(A[N],T),1):delete A[N]}),this}},emit:function(m,T){this.options.domEvents&&HE(m,T);var A=this.handlers[m]&&this.handlers[m].slice();if(!(!A||!A.length)){T.type=m,T.preventDefault=function(){T.srcEvent.preventDefault()};for(var N=0;N<A.length;)A[N](T),N++}},destroy:function(){this.element&&ug(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function ug(m,T){var A=m.element;if(A.style){var N;_(m.options.cssProps,function(U,$){N=H(A.style,$),T?(m.oldCssProps[N]=A.style[N],A.style[N]=U):A.style[N]=m.oldCssProps[N]||""}),T||(m.oldCssProps={})}}function HE(m,T){var A=n.createEvent("Event");A.initEvent(m,!0,!0),A.gesture=T,T.target.dispatchEvent(A)}E(un,{INPUT_START:Se,INPUT_MOVE:rr,INPUT_END:be,INPUT_CANCEL:tt,STATE_POSSIBLE:Ho,STATE_BEGAN:vt,STATE_CHANGED:Lr,STATE_ENDED:An,STATE_RECOGNIZED:ln,STATE_CANCELLED:ss,STATE_FAILED:jt,DIRECTION_NONE:Bo,DIRECTION_LEFT:Gi,DIRECTION_RIGHT:es,DIRECTION_UP:ts,DIRECTION_DOWN:ns,DIRECTION_HORIZONTAL:Vt,DIRECTION_VERTICAL:ir,DIRECTION_ALL:Xp,Manager:cu,Input:yt,TouchAction:iu,TouchInput:Vo,MouseInput:zo,PointerEventInput:tu,TouchMouseInput:nu,SingleTouchInput:eg,Recognizer:cn,AttrRecognizer:xt,Tap:Xo,Pan:$o,Swipe:lu,Pinch:su,Rotate:au,Press:ou,on:P,off:O,each:_,merge:g,extend:b,assign:E,inherit:p,bindFn:y,prefixed:H});var WE=typeof e<"u"?e:typeof self<"u"?self:{};WE.Hammer=un,i==="function"&&i.amd?i(function(){return un}):t.exports?t.exports=un:e[r]=un})(window,document,"Hammer")})(w1);var Fo=w1.exports;const qk=v0(Fo),qt=YE({__proto__:null,default:qk},[Fo]),E1=1,S1=2,qh=4,Zk={mousedown:E1,mousemove:S1,mouseup:qh};function Qk(t,e){for(let n=0;n<t.length;n++)if(e(t[n]))return!0;return!1}function Jk(t){const e=t.prototype.handler;t.prototype.handler=function(r){const i=this.store;r.button>0&&r.type==="pointerdown"&&(Qk(i,s=>s.pointerId===r.pointerId)||i.push(r)),e.call(this,r)}}function Gk(t){t.prototype.handler=function(n){let r=Zk[n.type];r&E1&&n.button>=0&&(this.pressed=!0),r&S1&&n.buttons===0&&(r=qh),this.pressed&&(r&qh&&(this.pressed=!1),this.callback(this.manager,r,{pointers:[n],changedPointers:[n],pointerType:"mouse",srcEvent:n}))}}Jk(Fo.PointerEventInput);Gk(Fo.MouseInput);const eO=Fo.Manager;class Qc{constructor(e,n,r){this.element=e,this.callback=n,this.options={enable:!0,...r}}}const tO=qt?[[qt.Pan,{event:"tripan",pointers:3,threshold:0,enable:!1}],[qt.Rotate,{enable:!1}],[qt.Pinch,{enable:!1}],[qt.Swipe,{enable:!1}],[qt.Pan,{threshold:0,enable:!1}],[qt.Press,{enable:!1}],[qt.Tap,{event:"doubletap",taps:2,enable:!1}],[qt.Tap,{event:"anytap",enable:!1}],[qt.Tap,{enable:!1}]]:null,ny={tripan:["rotate","pinch","pan"],rotate:["pinch"],pinch:["pan"],pan:["press","doubletap","anytap","tap"],doubletap:["anytap"],anytap:["tap"]},nO={doubletap:["tap"]},rO={pointerdown:"pointerdown",pointermove:"pointermove",pointerup:"pointerup",touchstart:"pointerdown",touchmove:"pointermove",touchend:"pointerup",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup"},Np={KEY_EVENTS:["keydown","keyup"],MOUSE_EVENTS:["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"],WHEEL_EVENTS:["wheel","mousewheel"]},iO={tap:"tap",anytap:"anytap",doubletap:"doubletap",press:"press",pinch:"pinch",pinchin:"pinch",pinchout:"pinch",pinchstart:"pinch",pinchmove:"pinch",pinchend:"pinch",pinchcancel:"pinch",rotate:"rotate",rotatestart:"rotate",rotatemove:"rotate",rotateend:"rotate",rotatecancel:"rotate",tripan:"tripan",tripanstart:"tripan",tripanmove:"tripan",tripanup:"tripan",tripandown:"tripan",tripanleft:"tripan",tripanright:"tripan",tripanend:"tripan",tripancancel:"tripan",pan:"pan",panstart:"pan",panmove:"pan",panup:"pan",pandown:"pan",panleft:"pan",panright:"pan",panend:"pan",pancancel:"pan",swipe:"swipe",swipeleft:"swipe",swiperight:"swipe",swipeup:"swipe",swipedown:"swipe"},ry={click:"tap",anyclick:"anytap",dblclick:"doubletap",mousedown:"pointerdown",mousemove:"pointermove",mouseup:"pointerup",mouseover:"pointerover",mouseout:"pointerout",mouseleave:"pointerleave"},sO=typeof navigator<"u"&&navigator.userAgent?navigator.userAgent.toLowerCase():"",_i=typeof window<"u"?window:global;let Zh=!1;try{const t={get passive(){return Zh=!0,!0}};_i.addEventListener("test",null,t),_i.removeEventListener("test",null)}catch{Zh=!1}const oO=sO.indexOf("firefox")!==-1,{WHEEL_EVENTS:aO}=Np,iy="wheel",sy=4.000244140625,lO=40,cO=.25;class uO extends Qc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{if(!this.options.enable)return;let s=i.deltaY;_i.WheelEvent&&(oO&&i.deltaMode===_i.WheelEvent.DOM_DELTA_PIXEL&&(s/=_i.devicePixelRatio),i.deltaMode===_i.WheelEvent.DOM_DELTA_LINE&&(s*=lO)),s!==0&&s%sy===0&&(s=Math.floor(s/sy)),i.shiftKey&&s&&(s=s*cO),this.callback({type:iy,center:{x:i.clientX,y:i.clientY},delta:-s,srcEvent:i,pointerType:"mouse",target:i.target})},this.events=(this.options.events||[]).concat(aO),this.events.forEach(i=>e.addEventListener(i,this.handleEvent,Zh?{passive:!1}:!1))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===iy&&(this.options.enable=n)}}const{MOUSE_EVENTS:fO}=Np,oy="pointermove",ay="pointerover",ly="pointerout",cy="pointerenter",uy="pointerleave";class hO extends Qc{constructor(e,n,r){super(e,n,r),this.handleEvent=s=>{this.handleOverEvent(s),this.handleOutEvent(s),this.handleEnterEvent(s),this.handleLeaveEvent(s),this.handleMoveEvent(s)},this.pressed=!1;const{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,this.events=(this.options.events||[]).concat(fO),this.events.forEach(s=>e.addEventListener(s,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===oy&&(this.enableMoveEvent=n),e===ay&&(this.enableOverEvent=n),e===ly&&(this.enableOutEvent=n),e===cy&&(this.enableEnterEvent=n),e===uy&&(this.enableLeaveEvent=n)}handleOverEvent(e){this.enableOverEvent&&e.type==="mouseover"&&this._emit(ay,e)}handleOutEvent(e){this.enableOutEvent&&e.type==="mouseout"&&this._emit(ly,e)}handleEnterEvent(e){this.enableEnterEvent&&e.type==="mouseenter"&&this._emit(cy,e)}handleLeaveEvent(e){this.enableLeaveEvent&&e.type==="mouseleave"&&this._emit(uy,e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":e.buttons===0&&(this.pressed=!1),this.pressed||this._emit(oy,e);break;case"mouseup":this.pressed=!1;break}}_emit(e,n){this.callback({type:e,center:{x:n.clientX,y:n.clientY},srcEvent:n,pointerType:"mouse",target:n.target})}}const{KEY_EVENTS:dO}=Np,fy="keydown",hy="keyup";class pO extends Qc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{const s=i.target||i.srcElement;s.tagName==="INPUT"&&s.type==="text"||s.tagName==="TEXTAREA"||(this.enableDownEvent&&i.type==="keydown"&&this.callback({type:fy,srcEvent:i,key:i.key,target:i.target}),this.enableUpEvent&&i.type==="keyup"&&this.callback({type:hy,srcEvent:i,key:i.key,target:i.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,this.events=(this.options.events||[]).concat(dO),e.tabIndex=this.options.tabIndex||0,e.style.outline="none",this.events.forEach(i=>e.addEventListener(i,this.handleEvent))}destroy(){this.events.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,n){e===fy&&(this.enableDownEvent=n),e===hy&&(this.enableUpEvent=n)}}const dy="contextmenu";class gO extends Qc{constructor(e,n,r){super(e,n,r),this.handleEvent=i=>{this.options.enable&&this.callback({type:dy,center:{x:i.clientX,y:i.clientY},srcEvent:i,pointerType:"mouse",target:i.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,n){e===dy&&(this.options.enable=n)}}const py=1,Qh=2,gy=4,_O={pointerdown:py,pointermove:Qh,pointerup:gy,mousedown:py,mousemove:Qh,mouseup:gy},mO=0,yO=1,vO=2,TO=1,wO=2,EO=4;function SO(t){const e=_O[t.srcEvent.type];if(!e)return null;const{buttons:n,button:r}=t.srcEvent;let i=!1,s=!1,o=!1;return e===Qh?(i=!!(n&TO),s=!!(n&EO),o=!!(n&wO)):(i=r===mO,s=r===yO,o=r===vO),{leftButton:i,middleButton:s,rightButton:o}}function bO(t,e){const n=t.center;if(!n)return null;const r=e.getBoundingClientRect(),i=r.width/e.offsetWidth||1,s=r.height/e.offsetHeight||1,o={x:(n.x-r.left-e.clientLeft)/i,y:(n.y-r.top-e.clientTop)/s};return{center:n,offsetCenter:o}}const pf={srcElement:"root",priority:0};class AO{constructor(e){this.handleEvent=n=>{if(this.isEmpty())return;const r=this._normalizeEvent(n);let i=n.srcEvent.target;for(;i&&i!==r.rootElement;){if(this._emit(r,i),r.handled)return;i=i.parentNode}this._emit(r,"root")},this.eventManager=e,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,n,r,i=!1,s=!1){const{handlers:o,handlersByElement:a}=this;let l=pf;typeof r=="string"||r&&r.addEventListener?l={...pf,srcElement:r}:r&&(l={...pf,...r});let c=a.get(l.srcElement);c||(c=[],a.set(l.srcElement,c));const u={type:e,handler:n,srcElement:l.srcElement,priority:l.priority};i&&(u.once=!0),s&&(u.passive=!0),o.push(u),this._active=this._active||!u.passive;let f=c.length-1;for(;f>=0&&!(c[f].priority>=u.priority);)f--;c.splice(f+1,0,u)}remove(e,n){const{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){const o=r[s];if(o.type===e&&o.handler===n){r.splice(s,1);const a=i.get(o.srcElement);a.splice(a.indexOf(o),1),a.length===0&&i.delete(o.srcElement)}}this._active=r.some(s=>!s.passive)}_emit(e,n){const r=this.handlersByElement.get(n);if(r){let i=!1;const s=()=>{e.handled=!0},o=()=>{e.handled=!0,i=!0},a=[];for(let l=0;l<r.length;l++){const{type:c,handler:u,once:f}=r[l];if(u({...e,type:c,stopPropagation:s,stopImmediatePropagation:o}),f&&a.push(r[l]),i)break}for(let l=0;l<a.length;l++){const{type:c,handler:u}=a[l];this.remove(c,u)}}}_normalizeEvent(e){const n=this.eventManager.getElement();return{...e,...SO(e),...bO(e,n),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:n}}}const RO={events:null,recognizers:null,recognizerOptions:{},Manager:eO,touchAction:"none",tabIndex:0};class CO{constructor(e=null,n){this._onBasicInput=i=>{const{srcEvent:s}=i,o=rO[s.type];o&&this.manager.emit(o,i)},this._onOtherEvent=i=>{this.manager.emit(i.type,i)},this.options={...RO,...n},this.events=new Map,this.setElement(e);const{events:r}=this.options;r&&this.on(r)}getElement(){return this.element}setElement(e){if(this.element&&this.destroy(),this.element=e,!e)return;const{options:n}=this,r=n.Manager;this.manager=new r(e,{touchAction:n.touchAction,recognizers:n.recognizers||tO}).on("hammer.input",this._onBasicInput),n.recognizers||Object.keys(ny).forEach(i=>{const s=this.manager.get(i);s&&ny[i].forEach(o=>{s.recognizeWith(o)})});for(const i in n.recognizerOptions){const s=this.manager.get(i);if(s){const o=n.recognizerOptions[i];delete o.enable,s.set(o)}}this.wheelInput=new uO(e,this._onOtherEvent,{enable:!1}),this.moveInput=new hO(e,this._onOtherEvent,{enable:!1}),this.keyInput=new pO(e,this._onOtherEvent,{enable:!1,tabIndex:n.tabIndex}),this.contextmenuInput=new gO(e,this._onOtherEvent,{enable:!1});for(const[i,s]of this.events)s.isEmpty()||(this._toggleRecognizer(s.recognizerName,!0),this.manager.on(i,s.handleEvent))}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy(),this.wheelInput=null,this.moveInput=null,this.keyInput=null,this.contextmenuInput=null,this.manager=null,this.element=null)}on(e,n,r){this._addEventHandler(e,n,r,!1)}once(e,n,r){this._addEventHandler(e,n,r,!0)}watch(e,n,r){this._addEventHandler(e,n,r,!1,!0)}off(e,n){this._removeEventHandler(e,n)}_toggleRecognizer(e,n){const{manager:r}=this;if(!r)return;const i=r.get(e);if(i&&i.options.enable!==n){i.set({enable:n});const s=nO[e];s&&!this.options.recognizers&&s.forEach(o=>{const a=r.get(o);n?(a.requireFailure(e),i.dropRequireFailure(o)):a.dropRequireFailure(e)})}this.wheelInput.enableEventType(e,n),this.moveInput.enableEventType(e,n),this.keyInput.enableEventType(e,n),this.contextmenuInput.enableEventType(e,n)}_addEventHandler(e,n,r,i,s){if(typeof e!="string"){r=n;for(const u in e)this._addEventHandler(u,e[u],r,i,s);return}const{manager:o,events:a}=this,l=ry[e]||e;let c=a.get(l);c||(c=new AO(this),a.set(l,c),c.recognizerName=iO[l]||l,o&&o.on(l,c.handleEvent)),c.add(e,n,r,i,s),c.isEmpty()||this._toggleRecognizer(c.recognizerName,!0)}_removeEventHandler(e,n){if(typeof e!="string"){for(const o in e)this._removeEventHandler(o,e[o]);return}const{events:r}=this,i=ry[e]||e,s=r.get(i);if(s&&(s.remove(e,n),s.isEmpty())){const{recognizerName:o}=s;let a=!1;for(const l of r.values())if(l.recognizerName===o&&!l.isEmpty()){a=!0;break}a||this._toggleRecognizer(o,!1)}}}function Mn(){}const xO=({isDragging:t})=>t?"grabbing":"grab",_y={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{type:"webgl"},gl:null,glOptions:{},canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:Mn,onWebGLInitialized:Mn,onResize:Mn,onViewStateChange:Mn,onInteractionStateChange:Mn,onBeforeRender:Mn,onAfterRender:Mn,onLoad:Mn,onError:t=>ne.error(t.message,t.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:xO,getTooltip:null,debug:!1,drawPickingColors:!1},wc=class wc{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new Xc({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=r=>{const{_pickRequest:i}=this;if(r.type==="pointerleave")i.x=-1,i.y=-1,i.radius=0;else{if(r.leftButton||r.rightButton)return;{const s=r.offsetCenter;if(!s)return;i.x=s.x,i.y=s.y,i.radius=this.props.pickingRadius}}this.layerManager&&(this.layerManager.context.mousePosition={x:i.x,y:i.y}),i.event=r},this._onEvent=r=>{const i=Bh[r.type],s=r.offsetCenter;if(!i||!s||!this.layerManager)return;const o=this.layerManager.getLayers(),a=this.deckPicker.getLastPickedObject({x:s.x,y:s.y,layers:o,viewports:this.getViewports(s)},this._lastPointerDownInfo),{layer:l}=a,c=l&&(l[i.handler]||l.props[i.handler]),u=this.props[i.handler];let f=!1;c&&(f=c.call(l,a,r)),f||(u==null||u(a,r),this.widgetManager.onEvent(a,r))},this._onPointerDown=r=>{const i=r.offsetCenter,s=this._pick("pickObject","pickObject Time",{x:i.x,y:i.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=s.result[0]||s.emptyInfo},this.props={..._y,...e},e=this.props,e.viewState&&e.initialViewState&&ne.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let n=this.device;!n&&e.gl&&(e.gl instanceof WebGLRenderingContext&&ne.error("WebGL1 context not supported.")(),n=ty.attach(e.gl)),n||(n=bh.createDevice({type:"best-available",adapters:[ty],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e)}})),this.animationLoop=this._createAnimationLoop(n,e),this.setProps(e),e._typedArrayManagerProps&&po.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){var e,n,r,i,s,o,a,l,c,u;(e=this.animationLoop)==null||e.stop(),(n=this.animationLoop)==null||n.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,(r=this.layerManager)==null||r.finalize(),this.layerManager=null,(i=this.viewManager)==null||i.finalize(),this.viewManager=null,(s=this.effectManager)==null||s.finalize(),this.effectManager=null,(o=this.deckRenderer)==null||o.finalize(),this.deckRenderer=null,(a=this.deckPicker)==null||a.finalize(),this.deckPicker=null,(l=this.eventManager)==null||l.destroy(),this.eventManager=null,(c=this.widgetManager)==null||c.finalize(),this.widgetManager=null,!this.props.canvas&&!this.props.device&&!this.props.gl&&this.canvas&&((u=this.canvas.parentElement)==null||u.removeChild(this.canvas),this.canvas=null)}setProps(e){var r;this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&ne.removed("onLayerHover","onHover")(),"onLayerClick"in e&&ne.removed("onLayerClick","onClick")(),e.initialViewState&&!dt(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);const n=Object.create(this.props);Object.assign(n,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),(r=this.animationLoop)==null||r.setProps(n),this.layerManager&&(this.viewManager.setProps(n),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(n),this.effectManager.setProps(n),this.deckRenderer.setProps(n),this.deckPicker.setProps(n),this.widgetManager.setProps(n)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let n=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);const r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),o=this.deckRenderer.needsRedraw(e);return n=n||r||i||s||o,n}redraw(e){if(!this.layerManager)return;let n=this.needsRedraw({clearRedrawFlags:!0});n=e||n,n&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(n):this._drawLayers(n))}get isInitialized(){return this.viewManager!==null}getViews(){return Ye(this.viewManager),this.viewManager.views}getViewports(e){return Ye(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){const n=this._pick("pickObject","pickObject Time",e).result;return n.length?n[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,n=!1){for(const r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:n})}_removeResources(e){for(const n of e)this.layerManager.resourceManager.remove(n)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){var n;(n=this.layerManager)==null||n.removeDefaultShaderModule(e)}_pick(e,n,r){Ye(this.deckPicker);const{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(n).timeStart();const s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(n).timeEnd(),s}_createCanvas(e){let n=e.canvas;return typeof n=="string"&&(n=document.getElementById(n),Ye(n)),n||(n=document.createElement("canvas"),n.id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(n)),Object.assign(n.style,e.style),n}_setCanvasSize(e){var i;if(!this.canvas)return;const{width:n,height:r}=e;if(n||n===0){const s=Number.isFinite(n)?`${n}px`:n;this.canvas.style.width=s}if(r||r===0){const s=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=((i=e.style)==null?void 0:i.position)||"absolute",this.canvas.style.height=s}}_updateCanvasSize(){var i,s;const{canvas:e}=this;if(!e)return;const n=e.clientWidth??e.width,r=e.clientHeight??e.height;(n!==this.width||r!==this.height)&&(this.width=n,this.height=r,(i=this.viewManager)==null||i.setProps({width:n,height:r}),(s=this.layerManager)==null||s.activateViewport(this.getViewports()[0]),this.props.onResize({width:n,height:r}))}_createAnimationLoop(e,n){const{gl:r,onError:i,useDevicePixels:s}=n;return new $M({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:o=>this._setDevice(o.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){const{views:e}=this.props,n=Array.isArray(e)?e:e?[e]:[new Yl({id:"default-view"})];return n.length&&this.props.controller&&(n[0].props.controller=this.props.controller),n}_onContextLost(){const{onError:e}=this.props;this.animationLoop&&e&&e(new Error("WebGL context is lost"))}_pickAndCallback(){var n,r,i;const{_pickRequest:e}=this;if(e.event){const{result:s,emptyInfo:o}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=s.length>0;let a=o,l=!1;for(const c of s)a=c,l=((n=c.layer)==null?void 0:n.onHover(c,e.event))||l;l||((i=(r=this.props).onHover)==null||i.call(r,a,e.event),this.widgetManager.onHover(a,e.event)),e.event=null}}_updateCursor(){const e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){var i,s;if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=(i=this.device.canvasContext)==null?void 0:i.canvas),this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),this.device instanceof Cs&&this.props.onWebGLInitialized(this.device.gl);const n=new Qw;n.play(),this.animationLoop.attachTimeline(n),this.eventManager=new CO(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizerOptions:this.props.eventRecognizerOptions,events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}});for(const o in Bh)this.eventManager.on(o,this._onEvent);this.viewManager=new gI({timeline:n,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});const r=this.viewManager.getViewports()[0];this.layerManager=new pI(this.device,{deck:this,stats:this.stats,viewport:r,timeline:n}),this.effectManager=new II({deck:this,device:this.device}),this.deckRenderer=new OI(this.device),this.deckPicker=new zI(this.device),this.widgetManager=new HI({deck:this,parentElement:(s=this.canvas)==null?void 0:s.parentElement}),this.widgetManager.addDefault(new $I),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,n){var o;const{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});const s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...n};(o=this.deckRenderer)==null||o.renderLayers(s),s.pass==="screen"&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60===0&&(this._getMetrics(),this.stats.reset(),ne.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){const n=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:n},this.props.viewState||this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){const{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();const n=this.animationLoop.stats;e.get("GPU Time").addTime(n.get("GPU Time").lastTiming),e.get("CPU Time").addTime(n.get("CPU Time").lastTiming)}_getMetrics(){const{metrics:e,stats:n}=this;e.fps=n.get("frameRate").getHz(),e.setPropsTime=n.get("setProps Time").time,e.updateAttributesTime=n.get("Update Attributes").time,e.framesRedrawn=n.get("Redraw Count").count,e.pickTime=n.get("pickObject Time").time+n.get("pickMultipleObjects Time").time+n.get("pickObjects Time").time,e.pickCount=n.get("Pick Count").count,e.gpuTime=n.get("GPU Time").time,e.cpuTime=n.get("CPU Time").time,e.gpuTimePerFrame=n.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=n.get("CPU Time").getAverageTime();const r=bh.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}};wc.defaultProps=_y,wc.VERSION=aC;let Jh=wc;function PO(t){switch(t){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return yw(t)}}const MO=mw;function xa(t,e){return{attribute:t,format:e.size>1?`${e.type}x${e.size}`:e.type,byteOffset:e.offset||0}}function _r(t){return t.stride||t.size*t.bytesPerElement}function IO(t,e){return t.type===e.type&&t.size===e.size&&_r(t)===_r(e)&&(t.offset||0)===(e.offset||0)}function Gh(t,e){e.offset&&ne.removed("shaderAttribute.offset","vertexOffset, elementOffset")();const n=_r(t),r=e.vertexOffset!==void 0?e.vertexOffset:t.vertexOffset||0,i=e.elementOffset||0,s=r*n+i*t.bytesPerElement+(t.offset||0);return{...e,offset:s,stride:n}}function NO(t,e){const n=Gh(t,e);return{high:n,low:{...n,offset:n.offset+t.size*4}}}class kO{constructor(e,n,r){this._buffer=null,this.device=e,this.id=n.id||"",this.size=n.size||1;const i=n.logicalType||n.type,s=i==="float64";let{defaultValue:o}=n;o=Number.isFinite(o)?[o]:o||new Array(this.size).fill(0);let a;s?a="float32":!i&&n.isIndexed?a="uint32":a=i||"float32";let l=PO(i||a);this.doublePrecision=s,s&&n.fp64===!1&&(l=Float32Array),this.value=null,this.settings={...n,defaultType:l,defaultValue:o,logicalType:i,type:a,normalized:a.includes("norm"),size:this.size,bytesPerElement:l.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){const e=this.getAccessor();return e.vertexOffset?e.vertexOffset*_r(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),po.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,n=null){const r={};if(this.state.constant){const i=this.value;if(n){const s=Gh(this.getAccessor(),n),o=s.offset/i.BYTES_PER_ELEMENT,a=s.size||this.size;r[e]=i.subarray(o,o+a)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,n=null){const r=this.getAccessor(),i=[],s={name:this.id,byteStride:_r(r),attributes:i};if(this.doublePrecision){const o=NO(r,n||{});i.push(xa(e,{...r,...o.high}),xa(`${e}64Low`,{...r,...o.low}))}else if(n){const o=Gh(r,n);i.push(xa(e,{...r,...o}))}else i.push(xa(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){const n=Array.from(this.value);e=[n,n]}else{const{value:n,numInstances:r,size:i}=this,s=r*i;if(n&&s&&n.length>=s){const o=new Array(i).fill(1/0),a=new Array(i).fill(-1/0);for(let l=0;l<s;)for(let c=0;c<i;c++){const u=n[l++];u<o[c]&&(o[c]=u),u>a[c]&&(a[c]=u)}e=[o,a]}}return this.state.bounds=e,e}setData(e){const{state:n}=this;let r;ArrayBuffer.isView(e)?r={value:e}:e instanceof ge?r={buffer:e}:r=e;const i={...this.settings,...r};if(ArrayBuffer.isView(r.value)){if(!r.type)if(this.doublePrecision&&r.value instanceof Float64Array)i.type="float32";else{const o=MO(r.value);i.type=i.normalized?o.replace("int","norm"):o}i.bytesPerElement=r.value.BYTES_PER_ELEMENT,i.stride=_r(i)}if(n.bounds=null,r.constant){let s=r.value;if(s=this._normalizeValue(s,[],0),this.settings.normalized&&(s=this.normalizeConstant(s)),!(!n.constant||!this._areValuesEqual(s,this.value)))return!1;n.externalBuffer=null,n.constant=!0,this.value=ArrayBuffer.isView(s)?s:new Float32Array(s)}else if(r.buffer){const s=r.buffer;n.externalBuffer=s,n.constant=!1,this.value=r.value||null}else if(r.value){this._checkExternalBuffer(r);let s=r.value;n.externalBuffer=null,n.constant=!1,this.value=s;let{buffer:o}=this;const a=_r(i),l=(i.vertexOffset||0)*a;if(this.doublePrecision&&s instanceof Float64Array&&(s=tf(s,i)),this.settings.isIndexed){const u=this.settings.defaultType;s.constructor!==u&&(s=new u(s))}const c=s.byteLength+l+a*2;(!o||o.byteLength<c)&&(o=this._createBuffer(c)),o.write(s,l)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;const n=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&n instanceof Float64Array?tf(n,{size:this.size,startIndex:r,endIndex:i}):n.subarray(r,i),r*n.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,n=!1){const{state:r}=this,i=r.allocatedValue,s=po.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:n});this.value=s;const{byteOffset:o}=this;let{buffer:a}=this;return(!a||a.byteLength<s.byteLength+o)&&(a=this._createBuffer(s.byteLength+o),n&&i&&a.write(i instanceof Float64Array?tf(i,this):i,o)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){const{value:n}=e;if(!ArrayBuffer.isView(n))throw new Error(`Attribute ${this.id} value is not TypedArray`);const r=this.settings.defaultType;let i=!1;if(this.doublePrecision&&(i=n.BYTES_PER_ELEMENT<4),i)throw new Error(`Attribute ${this.id} does not support ${n.constructor.name}`);!(n instanceof r)&&this.settings.normalized&&!("normalized"in e)&&ne.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(n=>(n+128)/255*2-1);case"snorm16":return new Float32Array(e).map(n=>(n+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(n=>n/255);case"unorm16":return new Float32Array(e).map(n=>n/65535);default:return e}}_normalizeValue(e,n,r){const{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return n[r]=e,n;if(!e){let o=s;for(;--o>=0;)n[r+o]=i[o];return n}switch(s){case 4:n[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:n[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:n[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:n[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let o=s;for(;--o>=0;)n[r+o]=Number.isFinite(e[o])?e[o]:i[o]}return n}_areValuesEqual(e,n){if(!e||!n)return!1;const{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==n[i])return!1;return!0}_createBuffer(e){var i;this._buffer&&this._buffer.destroy();const{isIndexed:n,type:r}=this.settings;return this._buffer=this.device.createBuffer({...(i=this._buffer)==null?void 0:i.props,id:this.id,usage:n?ge.INDEX:ge.VERTEX,indexType:n?r:void 0,byteLength:e}),this._buffer}}const my=[],yy=[];function kp(t,e=0,n=1/0){let r=my;const i={index:-1,data:t,target:[]};return t?typeof t[Symbol.iterator]=="function"?r=t:t.length>0&&(yy.length=t.length,r=yy):r=my,(e>0||Number.isFinite(n))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(e,n),i.index=e-1),{iterable:r,objectInfo:i}}function b1(t){return t&&t[Symbol.asyncIterator]}function OO(t,e){const{size:n,stride:r,offset:i,startIndices:s,nested:o}=e,a=t.BYTES_PER_ELEMENT,l=r?r/a:n,c=i?i/a:0,u=Math.floor((t.length-c)/l);return(f,{index:h,target:_})=>{if(!s){const g=h*l+c;for(let p=0;p<n;p++)_[p]=t[g+p];return _}const v=s[h],E=s[h+1]||u;let b;if(o){b=new Array(E-v);for(let g=v;g<E;g++){const p=g*l+c;_=new Array(n);for(let y=0;y<n;y++)_[y]=t[p+y];b[g-v]=_}}else if(l===n)b=t.subarray(v*n+c,E*n+c);else{b=new t.constructor((E-v)*n);let g=0;for(let p=v;p<E;p++){const y=p*l+c;for(let S=0;S<n;S++)b[g++]=t[y+S]}}return b}}const FO=[],Ka=[[0,1/0]];function DO(t,e){if(t===Ka||(e[0]<0&&(e[0]=0),e[0]>=e[1]))return t;const n=[],r=t.length;let i=0;for(let s=0;s<r;s++){const o=t[s];o[1]<e[0]?(n.push(o),i=s+1):o[0]>e[1]?n.push(o):e=[Math.min(o[0],e[0]),Math.max(o[1],e[1])]}return n.splice(i,0,e),n}const BO={interpolation:{duration:0,easing:t=>t},spring:{stiffness:.05,damping:.5}};function A1(t,e){if(!t)return null;Number.isFinite(t)&&(t={type:"interpolation",duration:t});const n=t.type||"interpolation";return{...BO[n],...e,...t,type:n}}class R1 extends kO{constructor(e,n){super(e,n,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Ka}),this.constant=!1,this.settings.update=n.update||(n.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){const n=this.state.needsRedraw;return this.state.needsRedraw=n&&!e,n}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var n;(n=this.state).layoutChanged||(n.layoutChanged=!IO(e,this.getAccessor())),super.setAccessor(e)}getUpdateTriggers(){const{accessor:e}=this.settings;return[this.id].concat(typeof e!="function"&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;const{accessor:n}=this.settings,r=this.settings.transition,i=Array.isArray(n)?e[n.find(s=>e[s])]:e[n];return A1(i,r)}setNeedsUpdate(e=this.id,n){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),n){const{startRow:r=0,endRow:i=1/0}=n;this.state.updateRanges=DO(this.state.updateRanges,[r,i])}else this.state.updateRanges=Ka}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=FO}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){const{state:n,settings:r}=this;return r.noAlloc?!1:r.update?(super.allocate(e,n.updateRanges!==Ka),!0):!1}updateBuffer({numInstances:e,data:n,props:r,context:i}){if(!this.needsUpdate())return!1;const{state:{updateRanges:s},settings:{update:o,noAlloc:a}}=this;let l=!0;if(o){for(const[c,u]of s)o.call(i,this,{data:n,startRow:c,endRow:u,props:r,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(const[c,u]of s){const f=Number.isFinite(c)?this.getVertexOffset(c):0,h=Number.isFinite(u)?this.getVertexOffset(u):a||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:f,endOffset:h})}this._checkAttributeArray()}else l=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),l}setConstantValue(e){return e===void 0||typeof e=="function"?!1:(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){const{state:n}=this;return e?(this.clearNeedsUpdate(),n.lastExternalBuffer===e||(n.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e)),!0):(n.lastExternalBuffer=null,!1)}setBinaryValue(e,n=null){const{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||n!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});const o=e;Ye(ArrayBuffer.isView(o.value),`invalid ${i.accessor}`);const a=!!o.size&&o.size!==this.size;return r.binaryAccessor=OO(o.value,{size:o.size||this.size,stride:o.stride,offset:o.offset,startIndices:n,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){const{startIndices:n}=this;return(n?e<n.length?n[e]:this.numInstances:e)*this.size}getValue(){const e=this.settings.shaderAttributes,n=super.getValue();if(!e)return n;for(const r in e)Object.assign(n,super.getValue(r,e[r]));return n}getBufferLayout(e){this.state.layoutChanged=!1;const n=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if(i==="dynamic"?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!n)return r;for(const s in n){const o=super._getBufferLayout(s,n[s]);r.attributes.push(...o.attributes)}return r}_autoUpdater(e,{data:n,startRow:r,endRow:i,props:s,numInstances:o}){if(e.constant)return;const{settings:a,state:l,value:c,size:u,startIndices:f}=e,{accessor:h,transform:_}=a,v=l.binaryAccessor||(typeof h=="function"?h:s[h]);Ye(typeof v=="function",`accessor "${h}" is not a function`);let E=e.getVertexOffset(r);const{iterable:b,objectInfo:g}=kp(n,r,i);for(const p of b){g.index++;let y=v(p,g);if(_&&(y=_.call(this,y)),f){const S=(g.index<f.length-1?f[g.index+1]:o)-f[g.index];if(y&&Array.isArray(y[0])){let R=E;for(const P of y)e._normalizeValue(P,c,R),R+=u}else y&&y.length>u?c.set(y,E):(e._normalizeValue(y,g.target,0),cI({target:c,source:g.target,start:E,count:S}));E+=S*u}else e._normalizeValue(y,c,E),E+=u}}_validateAttributeUpdaters(){const{settings:e}=this;if(!(e.noAlloc||typeof e.update=="function"))throw new Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){const{value:e}=this,n=Math.min(4,this.size);if(e&&e.length>=n){let r=!0;switch(n){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw new Error(`Illegal attribute generated for ${this.id}`)}}}function gf(t){const{source:e,target:n,start:r=0,size:i,getData:s}=t,o=t.end||n.length,a=e.length,l=o-r;if(a>l){n.set(e.subarray(0,l),r);return}if(n.set(e,r),!s)return;let c=a;for(;c<l;){const u=s(c,e);for(let f=0;f<i;f++)n[r+c]=u[f]||0,c++}}function UO({source:t,target:e,size:n,getData:r,sourceStartIndices:i,targetStartIndices:s}){if(!i||!s)return gf({source:t,target:e,size:n,getData:r}),e;let o=0,a=0;const l=r&&((u,f)=>r(u+a,f)),c=Math.min(i.length,s.length);for(let u=1;u<c;u++){const f=i[u]*n,h=s[u]*n;gf({source:t.subarray(o,f),target:e,start:a,end:h,size:n,getData:l}),o=f,a=h}return a<e.length&&gf({source:[],target:e,start:a,size:n,getData:l}),e}function LO(t){const{device:e,settings:n,value:r}=t,i=new R1(e,n);return i.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:n.normalized}),i}function C1(t){switch(t){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw new Error(`No defined attribute type for size "${t}"`)}}function x1(t){switch(t){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw new Error("invalid type size")}}function P1(t){t.push(t.shift())}function zO(t,e){const{doublePrecision:n,settings:r,value:i,size:s}=t,o=n&&i instanceof Float64Array?2:1;let a=0;const{shaderAttributes:l}=t.settings;if(l)for(const c of Object.values(l))a=Math.max(a,c.vertexOffset??0);return(r.noAlloc?i.length:(e+a)*s)*o}function M1({device:t,source:e,target:n}){return(!n||n.byteLength<e.byteLength)&&(n==null||n.destroy(),n=t.createBuffer({byteLength:e.byteLength,usage:e.usage})),n}function I1({device:t,buffer:e,attribute:n,fromLength:r,toLength:i,fromStartIndices:s,getData:o=a=>a}){const a=n.doublePrecision&&n.value instanceof Float64Array?2:1,l=n.size*a,c=n.byteOffset,u=n.settings.bytesPerElement<4?c/n.settings.bytesPerElement*4:c,f=n.startIndices,h=s&&f,_=n.isConstant;if(!h&&e&&r>=i)return e;const v=n.value instanceof Float64Array?Float32Array:n.value.constructor,E=_?n.value:new v(n.getBuffer().readSyncWebGL(c,i*v.BYTES_PER_ELEMENT).buffer);if(n.settings.normalized&&!_){const y=o;o=(S,R)=>n.normalizeConstant(y(S,R))}const b=_?(y,S)=>o(E,S):(y,S)=>o(E.subarray(y+c,y+c+l),S),g=e?new Float32Array(e.readSyncWebGL(u,r*4).buffer):new Float32Array(0),p=new Float32Array(i);return UO({source:g,target:p,sourceStartIndices:s,targetStartIndices:f,size:l,getData:b}),(!e||e.byteLength<p.byteLength+u)&&(e==null||e.destroy(),e=t.createBuffer({byteLength:p.byteLength+u,usage:35050})),e.write(p,u),e}class N1{constructor({device:e,attribute:n,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new Zc(r),this.attribute=n,this.attributeInTransition=LO(n),this.currentStartIndices=n.startIndices}get inProgress(){return this.transition.inProgress}start(e,n,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=zO(this.attribute,n),this.transition.start({...e,duration:r})}update(){const e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){this.cancel();for(const e of this.buffers)e.destroy();this.buffers.length=0}}class VO extends N1{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="interpolation",this.transform=$O(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;if(super.start(e,n,e.duration),e.duration<=0){this.transition.cancel();return}const{buffers:s,attribute:o}=this;P1(s),s[0]=I1({device:this.device,buffer:s[0],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=M1({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);const{transform:a}=this,l=a.model;let c=Math.floor(this.currentLength/o.size);k1(o)&&(c/=2),l.setVertexCount(c),o.isConstant?(l.setAttributes({aFrom:s[0]}),l.setConstantAttributes({aTo:o.value})):l.setAttributes({aFrom:s[0],aTo:o.getBuffer()}),a.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){const{duration:e,easing:n}=this.settings,{time:r}=this.transition;let i=r/e;n&&(i=n(i));const{model:s}=this.transform,o={time:i};s.shaderInputs.setProps({interpolation:o}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}const jO=`uniform interpolationUniforms {
  float time;
} interpolation;
`,vy={name:"interpolation",vs:jO,uniformTypes:{time:"f32"}},HO=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,WO=`#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function k1(t){return t.doublePrecision&&t.value instanceof Float64Array}function $O(t,e){const n=e.size,r=C1(n),i=x1(n),s=e.getBufferLayout();return k1(e)?new go(t,{vs:WO,bufferLayout:[{name:"aFrom",byteStride:8*n,attributes:[{attribute:"aFrom",format:i,byteOffset:0},{attribute:"aFrom64Low",format:i,byteOffset:4*n}]},{name:"aTo",byteStride:8*n,attributes:[{attribute:"aTo",format:i,byteOffset:0},{attribute:"aTo64Low",format:i,byteOffset:4*n}]}],modules:[TP,vy],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:n},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new go(t,{vs:HO,bufferLayout:[{name:"aFrom",format:i},{name:"aTo",format:s.attributes[0].format}],modules:[vy],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}class XO extends N1{constructor({device:e,attribute:n,timeline:r}){super({device:e,attribute:n,timeline:r}),this.type="spring",this.texture=JO(e),this.framebuffer=GO(e,this.texture),this.transform=QO(e,n)}start(e,n){const r=this.currentLength,i=this.currentStartIndices;super.start(e,n);const{buffers:s,attribute:o}=this;for(let l=0;l<2;l++)s[l]=I1({device:this.device,buffer:s[l],attribute:o,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=M1({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);const{model:a}=this.transform;a.setVertexCount(Math.floor(this.currentLength/o.size)),o.isConstant?a.setConstantAttributes({aTo:o.value}):a.setAttributes({aTo:o.getBuffer()})}onUpdate(){const{buffers:e,transform:n,framebuffer:r,transition:i}=this,s=this.settings;n.model.setAttributes({aPrev:e[0],aCur:e[1]}),n.transformFeedback.setBuffers({vNext:e[2]});const o={stiffness:s.stiffness,damping:s.damping};n.model.shaderInputs.setProps({spring:o}),n.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),P1(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}const YO=`uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,KO={name:"spring",vs:YO,uniformTypes:{damping:"f32",stiffness:"f32"}},qO=`#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,ZO=`#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`;function QO(t,e){const n=C1(e.size),r=x1(e.size);return new go(t,{vs:qO,fs:ZO,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:e.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[KO],defines:{ATTRIBUTE_TYPE:n},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}function JO(t){return t.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1})}function GO(t,e){return t.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})}const eF={interpolation:VO,spring:XO};class tF{constructor(e,{id:n,timeline:r}){if(!e)throw new Error("AttributeTransitionManager is constructed without device");this.id=n,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(const e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:n,numInstances:r}){this.numInstances=r||1;for(const i in e){const s=e[i],o=s.getTransitionSetting(n);o&&this._updateAttribute(i,s,o)}for(const i in this.transitions){const s=e[i];(!s||!s.getTransitionSetting(n))&&this._removeTransition(i)}}hasAttribute(e){const n=this.transitions[e];return n&&n.inProgress}getAttributes(){const e={};for(const n in this.transitions){const r=this.transitions[n];r.inProgress&&(e[n]=r.attributeInTransition)}return e}run(){if(this.numInstances===0)return!1;for(const n in this.transitions)this.transitions[n].update()&&(this.needsRedraw=!0);const e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,n,r){const i=this.transitions[e];let s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);const o=eF[r.type];o?this.transitions[e]=new o({attribute:n,timeline:this.timeline,device:this.device}):(ne.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||n.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}const Ty="attributeManager.invalidate",nF="attributeManager.updateStart",rF="attributeManager.updateEnd",iF="attribute.updateStart",sF="attribute.allocate",oF="attribute.updateEnd";class aF{constructor(e,{id:n="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=ko(AM),this.id=n,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new tF(e,{id:`${n}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(const e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){const n=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,n&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(const n of e)this.attributes[n]!==void 0&&(this.attributes[n].delete(),delete this.attributes[n])}invalidate(e,n){const r=this._invalidateTrigger(e,n);$e(Ty,this,e,r)}invalidateAll(e){for(const n in this.attributes)this.attributes[n].setNeedsUpdate(n,e);$e(Ty,this,"all")}update({data:e,numInstances:n,startIndices:r=null,transitions:i,props:s={},buffers:o={},context:a={}}){let l=!1;$e(nF,this),this.stats&&this.stats.get("Update Attributes").timeStart();for(const c in this.attributes){const u=this.attributes[c],f=u.settings.accessor;u.startIndices=r,u.numInstances=n,s[c]&&ne.removed(`props.${c}`,`data.attributes.${c}`)(),u.setExternalBuffer(o[c])||u.setBinaryValue(typeof f=="string"?o[f]:void 0,e.startIndices)||typeof f=="string"&&!o[f]&&u.setConstantValue(s[f])||u.needsUpdate()&&(l=!0,this._updateAttribute({attribute:u,numInstances:n,data:e,props:s,context:a})),this.needsRedraw=this.needsRedraw||u.needsRedraw()}l&&$e(rF,this,n),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:n,transitions:i})}updateTransition(){const{attributeTransitionManager:e}=this,n=e.run();return this.needsRedraw=this.needsRedraw||n,n}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){const n=e.map(r=>{var i;return(i=this.attributes[r])==null?void 0:i.getBounds()});return this.mergeBoundsMemoized(n)}getChangedAttributes(e={clearChangedFlags:!1}){const{attributes:n,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(const s in n){const o=n[s];o.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=o)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(n=>n.getBufferLayout(e))}_add(e,n){for(const r in e){const i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...n};this.attributes[r]=new R1(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){const e={};for(const n in this.attributes)this.attributes[n].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(n)});this.updateTriggers=e}_invalidateTrigger(e,n){const{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(o=>{const a=r[o];a&&a.setNeedsUpdate(a.id,n)}),s}_updateAttribute(e){const{attribute:n,numInstances:r}=e;if($e(iF,n),n.constant){n.setConstantValue(n.value);return}n.allocate(r)&&$e(sF,n,r),n.updateBuffer(e)&&(this.needsRedraw=!0,$e(oF,n,r))}}class lF extends Zc{get value(){return this._value}_onUpdate(){const{time:e,settings:{fromValue:n,toValue:r,duration:i,easing:s}}=this,o=s(e/i);this._value=Bl(n,r,o)}}const wy=1e-5;function Ey(t,e,n,r,i){const s=e-t,a=(n-e)*i,l=-s*r;return a+l+s+e}function cF(t,e,n,r,i){if(Array.isArray(n)){const s=[];for(let o=0;o<n.length;o++)s[o]=Ey(t[o],e[o],n[o],r,i);return s}return Ey(t,e,n,r,i)}function Sy(t,e){if(Array.isArray(t)){let n=0;for(let r=0;r<t.length;r++){const i=t[r]-e[r];n+=i*i}return Math.sqrt(n)}return Math.abs(t-e)}class uF extends Zc{get value(){return this._currValue}_onUpdate(){const{fromValue:e,toValue:n,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:o=e}=this;let a=cF(s,o,n,r,i);const l=Sy(a,n),c=Sy(a,o);l<wy&&c<wy&&(a=n,this.end()),this._prevValue=o,this._currValue=a}}const fF={interpolation:lF,spring:uF};class hF{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,n,r,i){const{transitions:s}=this;if(s.has(e)){const l=s.get(e),{value:c=l.settings.fromValue}=l;n=c,this.remove(e)}if(i=A1(i),!i)return;const o=fF[i.type];if(!o){ne.error(`unsupported transition type '${i.type}'`)();return}const a=new o(this.timeline);a.start({...i,fromValue:n,toValue:r}),s.set(e,a)}remove(e){const{transitions:n}=this;n.has(e)&&(n.get(e).cancel(),n.delete(e))}update(){const e={};for(const[n,r]of this.transitions)r.update(),e[n]=r.value,r.inProgress||this.remove(n);return e}clear(){for(const e of this.transitions.keys())this.remove(e)}}function dF(t){const e=t[Zn];for(const n in e){const r=e[n],{validate:i}=r;if(i&&!i(t[n],r))throw new Error(`Invalid prop ${n}: ${t[n]}`)}}function pF(t,e){const n=O1({newProps:t,oldProps:e,propTypes:t[Zn],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=_F(t,e);let i=!1;return r||(i=mF(t,e)),{dataChanged:r,propsChanged:n,updateTriggersChanged:i,extensionsChanged:yF(t,e),transitionsChanged:gF(t,e)}}function gF(t,e){if(!t.transitions)return!1;const n={},r=t[Zn];let i=!1;for(const s in t.transitions){const o=r[s],a=o&&o.type;(a==="number"||a==="color"||a==="array")&&ed(t[s],e[s],o)&&(n[s]=!0,i=!0)}return i?n:!1}function O1({newProps:t,oldProps:e,ignoreProps:n={},propTypes:r={},triggerName:i="props"}){if(e===t)return!1;if(typeof t!="object"||t===null)return`${i} changed shallowly`;if(typeof e!="object"||e===null)return`${i} changed shallowly`;for(const s of Object.keys(t))if(!(s in n)){if(!(s in e))return`${i}.${s} added`;const o=ed(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}for(const s of Object.keys(e))if(!(s in n)){if(!(s in t))return`${i}.${s} dropped`;if(!Object.hasOwnProperty.call(t,s)){const o=ed(t[s],e[s],r[s]);if(o)return`${i}.${s} ${o}`}}return!1}function ed(t,e,n){let r=n&&n.equal;return r&&!r(t,e,n)||!r&&(r=t&&e&&t.equals,r&&!r.call(t,e))?"changed deeply":!r&&e!==t?"changed shallowly":null}function _F(t,e){if(e===null)return"oldProps is null, initial diff";let n=!1;const{dataComparator:r,_dataDiff:i}=t;return r?r(t.data,e.data)||(n="Data comparator detected a change"):t.data!==e.data&&(n="A new data container was supplied"),n&&i&&(n=i(t.data,e.data)||n),n}function mF(t,e){if(e===null)return{all:!0};if("all"in t.updateTriggers&&by(t,e,"all"))return{all:!0};const n={};let r=!1;for(const i in t.updateTriggers)i!=="all"&&by(t,e,i)&&(n[i]=!0,r=!0);return r?n:!1}function yF(t,e){if(e===null)return!0;const n=e.extensions,{extensions:r}=t;if(r===n)return!1;if(!n||!r||r.length!==n.length)return!0;for(let i=0;i<r.length;i++)if(!r[i].equals(n[i]))return!0;return!1}function by(t,e,n){let r=t.updateTriggers[n];r=r??{};let i=e.updateTriggers[n];return i=i??{},O1({oldProps:i,newProps:r,triggerName:n})}const vF="count(): argument not an object",TF="count(): argument not a container";function wF(t){if(!SF(t))throw new Error(vF);if(typeof t.count=="function")return t.count();if(Number.isFinite(t.size))return t.size;if(Number.isFinite(t.length))return t.length;if(EF(t))return Object.keys(t).length;throw new Error(TF)}function EF(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function SF(t){return t!==null&&typeof t=="object"}function Ay(t,e){if(!e)return t;const n={...t,...e};if("defines"in e&&(n.defines={...t.defines,...e.defines}),"modules"in e&&(n.modules=(t.modules||[]).concat(e.modules),e.modules.some(r=>r.name==="project64"))){const r=n.modules.findIndex(i=>i.name==="project32");r>=0&&n.modules.splice(r,1)}if("inject"in e)if(!t.inject)n.inject=e.inject;else{const r={...t.inject};for(const i in e.inject)r[i]=(r[i]||"")+e.inject[i];n.inject=r}return n}const bF={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},td={};function AF(t,e,n,r){if(n instanceof ve)return n;n.constructor&&n.constructor.name!=="Object"&&(n={data:n});let i=null;n.compressed&&(i={minFilter:"linear",mipmapFilter:n.data.length>1?"nearest":"linear"});const s=e.createTexture({...n,sampler:{...bF,...i,...r},mipmaps:!0});return td[s.id]=t,s}function RF(t,e){!e||!(e instanceof ve)||td[e.id]===t&&(e.delete(),delete td[e.id])}const CF={boolean:{validate(t,e){return!0},equal(t,e,n){return!!t==!!e}},number:{validate(t,e){return Number.isFinite(t)&&(!("max"in e)||t<=e.max)&&(!("min"in e)||t>=e.min)}},color:{validate(t,e){return e.optional&&!t||nd(t)&&(t.length===3||t.length===4)},equal(t,e,n){return dt(t,e,1)}},accessor:{validate(t,e){const n=Kl(t);return n==="function"||n===Kl(e.value)},equal(t,e,n){return typeof e=="function"?!0:dt(t,e,1)}},array:{validate(t,e){return e.optional&&!t||nd(t)},equal(t,e,n){const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?dt(t,e,i):t===e}},object:{equal(t,e,n){if(n.ignore)return!0;const{compare:r}=n,i=Number.isInteger(r)?r:r?1:0;return r?dt(t,e,i):t===e}},function:{validate(t,e){return e.optional&&!t||typeof t=="function"},equal(t,e,n){return!n.compare&&n.ignore!==!1||t===e}},data:{transform:(t,e,n)=>{if(!t)return t;const{dataTransform:r}=n.props;return r?r(t):typeof t.shape=="string"&&t.shape.endsWith("-table")&&Array.isArray(t.data)?t.data:t}},image:{transform:(t,e,n)=>{const r=n.context;return!r||!r.device?null:AF(n.id,r.device,t,{...e.parameters,...n.props.textureParameters})},release:(t,e,n)=>{RF(n.id,t)}}};function xF(t){const e={},n={},r={};for(const[i,s]of Object.entries(t)){const o=s==null?void 0:s.deprecatedFor;if(o)r[i]=Array.isArray(o)?o:[o];else{const a=PF(i,s);e[i]=a,n[i]=a.value}}return{propTypes:e,defaultProps:n,deprecatedProps:r}}function PF(t,e){switch(Kl(e)){case"object":return ys(t,e);case"array":return ys(t,{type:"array",value:e,compare:!1});case"boolean":return ys(t,{type:"boolean",value:e});case"number":return ys(t,{type:"number",value:e});case"function":return ys(t,{type:"function",value:e,compare:!0});default:return{name:t,type:"unknown",value:e}}}function ys(t,e){return"type"in e?{name:t,...CF[e.type],...e}:"value"in e?{name:t,type:Kl(e.value),...e}:{name:t,type:"object",value:e}}function nd(t){return Array.isArray(t)||ArrayBuffer.isView(t)}function Kl(t){return nd(t)?"array":t===null?"null":typeof t}function MF(t,e){let n;for(let s=e.length-1;s>=0;s--){const o=e[s];"extensions"in o&&(n=o.extensions)}const r=rd(t.constructor,n),i=Object.create(r);i[Xl]=t,i[Ir]={},i[Vn]={};for(let s=0;s<e.length;++s){const o=e[s];for(const a in o)i[a]=o[a]}return Object.freeze(i),i}const IF="_mergedDefaultProps";function rd(t,e){let n=IF;if(e)for(const i of e){const s=i.constructor;s&&(n+=`:${s.extensionName||s.name}`)}const r=F1(t,n);return r||(t[n]=NF(t,e||[]))}function NF(t,e){if(!t.prototype)return null;const r=Object.getPrototypeOf(t),i=rd(r),s=F1(t,"defaultProps")||{},o=xF(s),a=Object.assign(Object.create(null),i,o.defaultProps),l=Object.assign(Object.create(null),i==null?void 0:i[Zn],o.propTypes),c=Object.assign(Object.create(null),i==null?void 0:i[sf],o.deprecatedProps);for(const u of e){const f=rd(u.constructor);f&&(Object.assign(a,f),Object.assign(l,f[Zn]),Object.assign(c,f[sf]))}return kF(a,t),FF(a,l),OF(a,c),a[Zn]=l,a[sf]=c,e.length===0&&!Op(t,"_propTypes")&&(t._propTypes=l),a}function kF(t,e){const n=BF(e);Object.defineProperties(t,{id:{writable:!0,value:n}})}function OF(t,e){for(const n in e)Object.defineProperty(t,n,{enumerable:!1,set(r){const i=`${this.id}: ${n}`;for(const s of e[n])Op(this,s)||(this[s]=r);ne.deprecated(i,e[n].join("/"))()}})}function FF(t,e){const n={},r={};for(const i in e){const s=e[i],{name:o,value:a}=s;s.async&&(n[o]=a,r[o]=DF(o))}t[Ai]=n,t[Ir]={},Object.defineProperties(t,r)}function DF(t){return{enumerable:!0,set(e){typeof e=="string"||e instanceof Promise||b1(e)?this[Ir][t]=e:this[Vn][t]=e},get(){if(this[Vn]){if(t in this[Vn])return this[Vn][t]||this[Ai][t];if(t in this[Ir]){const e=this[Xl]&&this[Xl].internalState;if(e&&e.hasAsyncProp(t))return e.getAsyncProp(t)||this[Ai][t]}}return this[Ai][t]}}}function Op(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function F1(t,e){return Op(t,e)&&t[e]}function BF(t){const e=t.componentName;return e||ne.warn(`${t.name}.componentName not specified`)(),e||t.name}let UF=0;const Ec=class Ec{constructor(...e){this.props=MF(this,e),this.id=this.props.id,this.count=UF++}clone(e){const{props:n}=this,r={};for(const i in n[Ai])i in n[Vn]?r[i]=n[Vn][i]:i in n[Ir]&&(r[i]=n[Ir][i]);return new this.constructor({...n,...r,...e})}};Ec.componentName="Component",Ec.defaultProps={};let id=Ec;const LF=Object.freeze({});class zF{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(const e in this.asyncProps){const n=this.asyncProps[e];n&&n.type&&n.type.release&&n.type.release(n.resolvedValue,n.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||LF}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){const n=this.asyncProps[e];return n&&n.resolvedValue}isAsyncPropLoading(e){if(e){const n=this.asyncProps[e];return!!(n&&n.pendingLoadCount>0&&n.pendingLoadCount!==n.resolvedLoadCount)}for(const n in this.asyncProps)if(this.isAsyncPropLoading(n))return!0;return!1}reloadAsyncProp(e,n){this._watchPromise(e,Promise.resolve(n))}setAsyncProps(e){this.component=e[Xl]||this.component;const n=e[Vn]||{},r=e[Ir]||e,i=e[Ai]||{};for(const s in n){const o=n[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o),n[s]=this.getAsyncProp(s)}for(const s in r){const o=r[s];this._createAsyncPropData(s,i[s]),this._updateAsyncProp(s,o)}}_fetch(e,n){return null}_onResolve(e,n){}_onError(e,n){}_updateAsyncProp(e,n){if(this._didAsyncInputValueChange(e,n)){if(typeof n=="string"&&(n=this._fetch(e,n)),n instanceof Promise){this._watchPromise(e,n);return}if(b1(n)){this._resolveAsyncIterable(e,n);return}this._setPropValue(e,n)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps){this.oldAsyncProps=Object.create(this.oldProps);for(const e in this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}}_didAsyncInputValueChange(e,n){const r=this.asyncProps[e];return n===r.resolvedValue||n===r.lastValue?!1:(r.lastValue=n,!0)}_setPropValue(e,n){this._freezeAsyncOldProps();const r=this.asyncProps[e];r&&(n=this._postProcessValue(r,n),r.resolvedValue=n,r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,n,r){const i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&n!==void 0&&(this._freezeAsyncOldProps(),i.resolvedValue=n,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,n))}_watchPromise(e,n){const r=this.asyncProps[e];if(r){r.pendingLoadCount++;const i=r.pendingLoadCount;n.then(s=>{this.component&&(s=this._postProcessValue(r,s),this._setAsyncPropValue(e,s,i),this._onResolve(e,s))}).catch(s=>{this._onError(e,s)})}}async _resolveAsyncIterable(e,n){if(e!=="data"){this._setPropValue(e,n);return}const r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;const i=r.pendingLoadCount;let s=[],o=0;for await(const a of n){if(!this.component)return;const{dataTransform:l}=this.component.props;l?s=l(a,s):s=s.concat(a),Object.defineProperty(s,"__diff",{enumerable:!1,value:[{startRow:o,endRow:s.length}]}),o=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,n){const r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(n,r,this.component):n}_createAsyncPropData(e,n){if(!this.asyncProps[e]){const i=this.component&&this.component.props[Zn];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:n,pendingLoadCount:0,resolvedLoadCount:0}}}}class VF extends zF{constructor({attributeManager:e,layer:n}){super(n),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,n){const r=this.layer,i=r==null?void 0:r.props.fetch;return i?i(n,{propName:e,layer:r}):super._fetch(e,n)}_onResolve(e,n){const r=this.layer;if(r){const i=r.props.onDataLoad;e==="data"&&i&&i(n,{propName:e,layer:r})}}_onError(e,n){const r=this.layer;r&&r.raiseError(n,`loading ${e} of ${this.layer}`)}}const jF="layer.changeFlag",HF="layer.initialize",WF="layer.update",$F="layer.finalize",XF="layer.matched",Ry=2**24-1,YF=Object.freeze([]),KF=ko(({oldViewport:t,viewport:e})=>t.equals(e));let Mt=new Uint8ClampedArray(0);const qF={data:{type:"data",value:YF,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:t=>t&&t.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(t,{propName:e,layer:n,loaders:r,loadOptions:i,signal:s})=>{const{resourceManager:o}=n.context;i=i||n.getLoadOptions(),r=r||n.props.loaders,s&&(i={...i,fetch:{...i==null?void 0:i.fetch,signal:s}});let a=o.contains(t);return!a&&!i&&(o.add({resourceId:t,data:Al(t,r),persistent:!1}),a=!0),a?o.subscribe({resourceId:t,onChange:l=>{var c;return(c=n.internalState)==null?void 0:c.reloadAsyncProp(e,l)},consumerId:n.id,requestId:e}):Al(t,r,i)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:te.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:t})=>[0,-t*100]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}},Sc=class Sc extends id{constructor(){super(...arguments),this.internalState=null,this.lifecycle=Jr.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){return`${this.constructor.layerName||this.constructor.name}({id: '${this.props.id}'})`}project(e){Ye(this.internalState);const n=this.internalState.viewport||this.context.viewport,r=qw(e,{viewport:n,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,o]=Ww(r,n.pixelProjectionMatrix);return e.length===2?[i,s]:[i,s,o]}unproject(e){return Ye(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,n){Ye(this.internalState);const r=this.internalState.viewport||this.context.viewport;return Zw(e,{viewport:r,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...n})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return this.internalState?!this.internalState.isAsyncPropLoading():!1}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){const e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setModuleParameters(e){for(const n of this.getModels())n.updateModuleSettings(e)}setShaderModuleProps(...e){for(const n of this.getModels())n.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){const{coordinateSystem:e}=this.props;return e===te.DEFAULT||e===te.LNGLAT||e===te.CARTESIAN}onHover(e,n){return this.props.onHover&&this.props.onHover(e,n)||!1}onClick(e,n){return this.props.onClick&&this.props.onClick(e,n)||!1}nullPickingColor(){return[0,0,0]}encodePickingColor(e,n=[]){return n[0]=e+1&255,n[1]=e+1>>8&255,n[2]=e+1>>8>>8&255,n}decodePickingColor(e){Ye(e instanceof Uint8Array);const[n,r,i]=e;return n+r*256+i*65536-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&this.state.numInstances!==void 0?this.state.numInstances:wF(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){var e;return(e=this.getAttributeManager())==null?void 0:e.getBounds(["positions","instancePositions"])}getShaders(e){e=Ay(e,{disableWarnings:!0,modules:this.context.defaultShaderModules});for(const n of this.props.extensions)e=Ay(e,n.getShaders.call(this,n));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){const n=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&n)if(Array.isArray(r))for(const i of r)n.invalidateAll(i);else n.invalidateAll();if(n){const{props:i}=e,s=this.internalState.hasPickingBuffer,o=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(s!==o){this.internalState.hasPickingBuffer=o;const{pickingColors:a,instancePickingColors:l}=n.attributes,c=a||l;c&&(o&&c.constant&&(c.constant=!1,n.invalidate(c.id)),!c.value&&!o&&(c.constant=!0,c.value=[0,0,0]))}}}finalizeState(e){for(const r of this.getModels())r.destroy();const n=this.getAttributeManager();n&&n.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(const n of this.getModels())n.draw(e)}getPickingInfo({info:e,mode:n,sourceLayer:r}){const{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,n){var r,i,s,o;n&&(e=new Error(`${n}: ${e.message}`,{cause:e})),(i=(r=this.props).onError)!=null&&i.call(r,e)||(o=(s=this.context)==null?void 0:s.onError)==null||o.call(s,e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return this.internalState?this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()):!1}hasUniformTransition(){var e;return((e=this.internalState)==null?void 0:e.uniformTransitions.active)||!1}activateViewport(e){if(!this.internalState)return;const n=this.internalState.viewport;this.internalState.viewport=e,(!n||!KF({oldViewport:n,viewport:e}))&&(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){const n=this.getAttributeManager();n&&(e==="all"?n.invalidateAll():n.invalidate(e))}updateAttributes(e){let n=!1;for(const r in e)e[r].layoutChanged()&&(n=!0);for(const r of this.getModels())this._setModelAttributes(r,e,n)}_updateAttributes(){const e=this.getAttributeManager();if(!e)return;const n=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:n.data,numInstances:r,startIndices:i,props:n,transitions:n.transitions,buffers:n.data.attributes,context:this});const s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){const e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){const{uniformTransitions:e}=this.internalState;if(e.active){const n=e.update(),r=Object.create(this.props);for(const i in n)Object.defineProperty(r,i,{value:n[i]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:n}){if(e.constant)return;const r=Math.floor(Mt.length/4);if(this.internalState.usesPickingColorCache=!0,r<n){n>Ry&&ne.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")(),Mt=po.allocate(Mt,n,{size:4,copy:!0,maxCount:Math.max(n,Ry)});const i=Math.floor(Mt.length/4),s=[0,0,0];for(let o=r;o<i;o++)this.encodePickingColor(o,s),Mt[o*4+0]=s[0],Mt[o*4+1]=s[1],Mt[o*4+2]=s[2],Mt[o*4+3]=0}e.value=Mt.subarray(0,n*4)}_setModelAttributes(e,n,r=!1){var a;if(!Object.keys(n).length)return;if(r){const l=this.getAttributeManager();e.setBufferLayout(l.getBufferLayouts(e)),n=l.getAttributes()}const i=((a=e.userData)==null?void 0:a.excludeAttributes)||{},s={},o={};for(const l in n){if(i[l])continue;const c=n[l].getValue();for(const u in c){const f=c[u];f instanceof ge?n[l].settings.isIndexed?e.setIndexBuffer(f):s[u]=f:f&&(o[u]=f)}}e.setAttributes(s),e.setConstantAttributes(o)}disablePickingIndex(e){const n=this.props.data;if(!("attributes"in n)){this._disablePickingIndex(e);return}const{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,o=s&&n.attributes&&n.attributes[s.id];if(o&&o.value){const a=o.value,l=this.encodePickingColor(e);for(let c=0;c<n.length;c++){const u=s.getVertexOffset(c);a[u]===l[0]&&a[u+1]===l[1]&&a[u+2]===l[2]&&this._disablePickingIndex(c)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){const{pickingColors:n,instancePickingColors:r}=this.getAttributeManager().attributes,i=n||r;if(!i)return;const s=i.getVertexOffset(e),o=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(o-s),s)}restorePickingColors(){const{pickingColors:e,instancePickingColors:n}=this.getAttributeManager().attributes,r=e||n;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==Mt.buffer&&(r.value=Mt.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){Ye(!this.internalState),Ye(Number.isFinite(this.props.coordinateSystem)),$e(HF,this);const e=this._getAttributeManager();e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new VF({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(ne.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new hF(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context);for(const n of this.props.extensions)n.initializeState.call(this,this.context,n);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){$e(XF,this,this===e);const{state:n,internalState:r}=e;this!==e&&(this.internalState=r,this.state=n,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){const e=this.needsUpdate();if($e(WF,this,e),!e)return;const n=this.props,r=this.context,i=this.internalState,s=r.viewport,o=this._updateUniformTransition();i.propsInTransition=o,r.viewport=i.viewport||s,this.props=o;try{const a=this._getUpdateParams(),l=this.getModels();if(r.device)this.updateState(a);else try{this.updateState(a)}catch{}for(const u of this.props.extensions)u.updateState.call(this,a,u);this.setNeedsRedraw(),this._updateAttributes();const c=this.getModels()[0]!==l[0];this._postUpdate(a,c)}finally{r.viewport=s,this.props=n,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){$e($F,this),this.finalizeState(this.context);for(const e of this.props.extensions)e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,moduleParameters:n=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();const s=this.props,o=this.context;this.props=this.internalState.propsInTransition||s;const a=Math.pow(this.props.opacity,1/2.2);r.opacity=a;try{if(n){const{isActive:u,isAttribute:f}=n.picking,{viewport:h,devicePixelRatio:_,coordinateSystem:v,coordinateOrigin:E}=n,{material:b,modelMatrix:g}=this.props,{picking:p,...y}=n;this.setModuleParameters(y);const{shadowEnabled:S,drawToShadowMap:R,shadowMaps:P,dummyShadowMap:O,shadowColor:M,shadowMatrices:k,shadowLightId:D,picking:F,heightMap:B,heightMapBounds:V,dummyHeightMap:H,terrainCover:Z,drawToTerrainHeightMap:Ce,useTerrainHeightMap:we,terrainSkipRender:j,lightSources:Y}=n,q={viewport:h,shadowEnabled:S,drawToShadowMap:R,shadowMaps:P,dummyShadowMap:O,shadowColor:M,shadowMatrices:k,shadowLightId:D},K={viewport:h,picking:F,heightMap:B,heightMapBounds:V,dummyHeightMap:H,terrainCover:Z,drawToTerrainHeightMap:Ce,useTerrainHeightMap:we,terrainSkipRender:j};this.setShaderModuleProps({shadow:q,terrain:K,layer:{opacity:a},lighting:Y,phongMaterial:b,gouraudMaterial:b,picking:{isActive:u,isAttribute:f},project:{viewport:h,devicePixelRatio:_,modelMatrix:g,coordinateSystem:v,coordinateOrigin:E}})}const{getPolygonOffset:l}=this.props,c=l&&l(r)||[0,0];o.device.setParametersWebGL({polygonOffset:c});for(const u of this.getModels())u.setParameters(i);o.device.withParametersWebGL(i,()=>{const u={renderPass:e,moduleParameters:n,uniforms:r,parameters:i,context:o};for(const f of this.props.extensions)f.draw.call(this,u,f);this.draw(u)})}finally{this.props=s}}getChangeFlags(){var e;return(e=this.internalState)==null?void 0:e.changeFlags}setChangeFlags(e){if(!this.internalState)return;const{changeFlags:n}=this.internalState;for(const i in e)if(e[i]){let s=!1;switch(i){case"dataChanged":const o=e[i],a=n[i];o&&Array.isArray(a)&&(n.dataChanged=Array.isArray(o)?a.concat(o):o,s=!0);default:n[i]||(n[i]=e[i],s=!0)}s&&$e(jF,this,i,e)}const r=!!(n.dataChanged||n.updateTriggersChanged||n.propsChanged||n.extensionsChanged);n.propsOrDataChanged=r,n.somethingChanged=r||n.viewportChanged||n.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,n){var i;const r=pF(e,n);if(r.updateTriggersChanged)for(const s in r.updateTriggersChanged)r.updateTriggersChanged[s]&&this.invalidateAttribute(s);if(r.transitionsChanged)for(const s in r.transitionsChanged)this.internalState.uniformTransitions.add(s,n[s],e[s],(i=e.transitions)==null?void 0:i[s]);return this.setChangeFlags(r)}validateProps(){dF(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){const n={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&typeof r=="function"&&(n.highlightColor=r(e)),this.setShaderModuleProps({picking:n}),this.setNeedsRedraw()}_getAttributeManager(){const e=this.context;return new aF(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,n){const{props:r,oldProps:i}=e,s=this.state.model;s!=null&&s.isInstanced&&s.setInstanceCount(this.getNumInstances());const{autoHighlight:o,highlightedObjectIndex:a,highlightColor:l}=r;if(n||i.autoHighlight!==o||i.highlightedObjectIndex!==a||i.highlightColor!==l){const c={};Array.isArray(l)&&(c.highlightColor=l),(n||i.autoHighlight!==o||a!==i.highlightedObjectIndex)&&(c.highlightedObjectColor=Number.isFinite(a)&&a>=0?this.encodePickingColor(a):null),this.setShaderModuleProps({picking:c})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let n=!1;n=n||this.internalState.needsRedraw&&this.id;const r=this.getAttributeManager(),i=r?r.getNeedsRedraw(e):!1;if(n=n||i,n)for(const s of this.props.extensions)s.onNeedsRedraw.call(this,s);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,n}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}};Sc.defaultProps=qF,Sc.layerName="Layer";let Yi=Sc;const ZF="compositeLayer.renderLayers",$p=class $p extends Yi{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:n}=e;return n&&n.__source&&n.__source.parent&&n.__source.parent.id===this.id&&(e.object=n.__source.object,e.index=n.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,n){return n&&n.length}getSubLayerClass(e,n){const{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||n}getSubLayerRow(e,n,r){return e.__source={parent:this,object:n,index:r},e}getSubLayerAccessor(e){if(typeof e=="function"){const n={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(n.index=r.__source.index,e(r.__source.object,n)):e(r,i)}return e}getSubLayerProps(e={}){var O;const{opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:_,modelMatrix:v,extensions:E,fetch:b,operation:g,_subLayerProps:p}=this.props,y={id:"",updateTriggers:{},opacity:n,pickable:r,visible:i,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:f,wrapLongitude:h,positionFormat:_,modelMatrix:v,extensions:E,fetch:b,operation:g},S=p&&e.id&&p[e.id],R=S&&S.updateTriggers,P=e.id||"sublayer";if(S){const M=this.props[Zn],k=e.type?e.type._propTypes:{};for(const D in S){const F=k[D]||M[D];F&&F.type==="accessor"&&(S[D]=this.getSubLayerAccessor(S[D]))}}Object.assign(y,e,S),y.id=`${this.props.id}-${P}`,y.updateTriggers={all:(O=this.props.updateTriggers)==null?void 0:O.all,...e.updateTriggers,...R};for(const M of E){const k=M.getSubLayerProps.call(this,M);k&&Object.assign(y,k,{updateTriggers:Object.assign(y.updateTriggers,k.updateTriggers)})}return y}_updateAutoHighlight(e){for(const n of this.getSubLayers())n.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,n){let r=this.internalState.subLayers;const i=!r||this.needsUpdate();if(i){const s=this.renderLayers();r=Cp(s,Boolean),this.internalState.subLayers=r}$e(ZF,this,i,r);for(const s of r)s.parent=this}};$p.layerName="CompositeLayer";let sd=$p;const bc=class bc{static get componentName(){return Object.prototype.hasOwnProperty.call(this,"extensionName")?this.extensionName:""}constructor(e){e&&(this.opts=e)}equals(e){return this===e?!0:this.constructor===e.constructor&&dt(this.opts,e.opts,1)}getShaders(e){return null}getSubLayerProps(e){const{defaultProps:n}=e.constructor,r={updateTriggers:{}};for(const i in n)if(i in this.props){const s=n[i],o=this.props[i];r[i]=o,s&&s.type==="accessor"&&(r.updateTriggers[i]=this.props.updateTriggers[i],typeof o=="function"&&(r[i]=this.getSubLayerAccessor(o)))}return r}initializeState(e,n){}updateState(e,n){}onNeedsRedraw(e){}getNeedsPickingBuffer(e){return!1}draw(e,n){}finalizeState(e,n){}};bc.defaultProps={},bc.extensionName="LayerExtension";let od=bc;const QF=typeof window<"u"?W.useLayoutEffect:W.useEffect,JF=QF;function ql(t,e){for(;t;){if(t===e)return!0;t=Object.getPrototypeOf(t)}return!1}const GF={position:"absolute",zIndex:-1};function D1(t,e){if(typeof t=="function")return t(e);if(Array.isArray(t))return t.map(n=>D1(n,e));if(Jc(t)){if(eD(t))return e.style=GF,W.cloneElement(t,e);if(tD(t))return W.cloneElement(t,e)}return t}function Jc(t){return t&&typeof t=="object"&&"type"in t||!1}function eD(t){var e;return(e=t.props)==null?void 0:e.mapStyle}function tD(t){const e=t.type;return e&&e.deckGLViewProps}function ad(t){if(typeof t=="function")return W.createElement(Wi,{},t);if(Array.isArray(t))return t.map(ad);if(Jc(t)){if(t.type===W.Fragment)return ad(t.props.children);if(ql(t.type,Wi))return t}return t}function nD({children:t,layers:e=[],views:n=null}){const r=[],i=[],s={};return W.Children.forEach(ad(t),o=>{if(Jc(o)){const a=o.type;if(ql(a,Yi)){const l=rD(a,o.props);i.push(l)}else r.push(o);if(ql(a,Wi)&&a!==Wi&&o.props.id){const l=new a(o.props);s[l.id]=l}}else o&&r.push(o)}),Object.keys(s).length>0&&(Array.isArray(n)?n.forEach(o=>{s[o.id]=o}):n&&(s[n.id]=n),n=Object.values(s)),e=i.length>0?[...i,...e]:e,{layers:e,children:r,views:n}}function rD(t,e){const n={},r=t.defaultProps||{};for(const i in e)r[i]!==e[i]&&(n[i]=e[i]);return new t(n)}function iD({children:t,deck:e,ContextProvider:n}){const{viewManager:r}=e||{};if(!r||!r.views.length)return[];const i={},s=r.views[0].id;for(const o of t){let a=s,l=o;Jc(o)&&ql(o.type,Wi)&&(a=o.props.id||s,l=o.props.children);const c=r.getViewport(a),u=r.getViewState(a);if(c){u.padding=c.padding;const{x:f,y:h,width:_,height:v}=c;l=D1(l,{x:f,y:h,width:_,height:v,viewport:c,viewState:u}),i[a]||(i[a]={viewport:c,children:[]}),i[a].children.push(l)}}return Object.keys(i).map(o=>{const{viewport:a,children:l}=i[o],{x:c,y:u,width:f,height:h}=a,_={position:"absolute",left:c,top:u,width:f,height:h},v=`view-${o}`,E=W.createElement("div",{key:v,id:v,style:_},...l);if(n){const b={viewport:a,container:e.canvas.offsetParent,eventManager:e.eventManager,onViewStateChange:g=>{g.viewId=o,e._onViewStateChange(g)}};return W.createElement(n,{key:v,value:b},E)}return E})}const sD={mixBlendMode:null};function oD({width:t,height:e,style:n}){const r={position:"absolute",zIndex:0,left:0,top:0,width:t,height:e},i={left:0,top:0};if(n)for(const s in n)s in sD?i[s]=n[s]:r[s]=n[s];return{containerStyle:r,canvasStyle:i}}function aD(t){return{get deck(){return t.deck},pickObject:e=>t.deck.pickObject(e),pickMultipleObjects:e=>t.deck.pickMultipleObjects(e),pickObjects:e=>t.deck.pickObjects(e)}}function B1(t){t.redrawReason&&(t.deck._drawLayers(t.redrawReason),t.redrawReason=null)}function lD(t,e,n){const r=new e({...n,_customRender:i=>{t.redrawReason=i;const s=r.getViewports();t.lastRenderedViewports!==s?t.forceUpdate():B1(t)}});return r}function cD(t,e){const[n,r]=W.useState(0),s=W.useRef({control:null,version:n,forceUpdate:()=>r(R=>R+1)}).current,o=W.useRef(null),a=W.useRef(null),l=W.useMemo(()=>nD(t),[t.layers,t.views,t.children]);let c=!0;const u=R=>{var P;return c&&t.viewState?(s.viewStateUpdateRequested=R,null):(s.viewStateUpdateRequested=null,(P=t.onViewStateChange)==null?void 0:P.call(t,R))},f=R=>{var P;c?s.interactionStateUpdateRequested=R:(s.interactionStateUpdateRequested=null,(P=t.onInteractionStateChange)==null||P.call(t,R))},h=W.useMemo(()=>{const R={...t,style:null,width:"100%",height:"100%",parent:o.current,canvas:a.current,layers:l.layers,views:l.views,onViewStateChange:u,onInteractionStateChange:f};return delete R._customRender,s.deck&&s.deck.setProps(R),R},[t]);W.useEffect(()=>{const R=t.Deck||Jh;return s.deck=lD(s,R,{...h,parent:o.current,canvas:a.current}),()=>{var P;return(P=s.deck)==null?void 0:P.finalize()}},[]),JF(()=>{B1(s);const{viewStateUpdateRequested:R,interactionStateUpdateRequested:P}=s;R&&u(R),P&&f(P)}),W.useImperativeHandle(e,()=>aD(s),[]);const _=s.deck&&s.deck.isInitialized?s.deck.getViewports():void 0,{ContextProvider:v,width:E="100%",height:b="100%",id:g,style:p}=t,{containerStyle:y,canvasStyle:S}=W.useMemo(()=>oD({width:E,height:b,style:p}),[E,b,p]);if(!s.viewStateUpdateRequested&&s.lastRenderedViewports===_||s.version!==n){s.lastRenderedViewports=_,s.version=n;const R=iD({children:l.children,deck:s.deck,ContextProvider:v}),P=W.createElement("canvas",{key:"canvas",id:g||"deckgl-overlay",ref:a,style:S});s.control=W.createElement("div",{id:`${g||"deckgl"}-wrapper`,ref:o,style:y},[P,R])}return c=!1,s.control}const uD=W.forwardRef(cD),fD=uD,hD=`
in float collisionPriorities;

uniform sampler2D collision_texture;

uniform collisionUniforms {
  bool sort;
  bool enabled;
} collision;

vec2 collision_getCoords(vec4 position) {
  vec4 collision_clipspace = project_common_position_to_clipspace(position);
  return (1.0 + collision_clipspace.xy / collision_clipspace.w) / 2.0;
}

float collision_match(vec2 tex, vec3 pickingColor) {
  vec4 collision_pickingColor = texture(collision_texture, tex);
  float delta = dot(abs(collision_pickingColor.rgb - pickingColor), vec3(1.0));
  float e = 0.001;
  return step(delta, e);
}

float collision_isVisible(vec2 texCoords, vec3 pickingColor) {
  if (!collision.enabled) {
    return 1.0;
  }

  // Visibility test, sample area of 5x5 pixels in order to fade in/out.
  // Due to the locality, the lookups will be cached
  // This reduces the flicker present when objects are shown/hidden
  const int N = 2;
  float accumulator = 0.0;
  vec2 step = vec2(1.0 / project.viewportSize);

  const float floatN = float(N);
  vec2 delta = -floatN * step;
  for(int i = -N; i <= N; i++) {
    delta.x = -step.x * floatN;
    for(int j = -N; j <= N; j++) {
      accumulator += collision_match(texCoords + delta, pickingColor);
      delta.x += step.x;
    }
    delta.y += step.y;
  }

  float W = 2.0 * floatN + 1.0;
  return pow(accumulator / (W * W), 2.2);
}
`,dD={"vs:#decl":`
  float collision_fade = 1.0;
`,"vs:DECKGL_FILTER_GL_POSITION":`
  if (collision.sort) {
    float collisionPriority = collisionPriorities;
    position.z = -0.001 * collisionPriority * position.w; // Support range -1000 -> 1000
  }

  if (collision.enabled) {
    vec4 collision_common_position = project_position(vec4(geometry.worldPosition, 1.0));
    vec2 collision_texCoords = collision_getCoords(collision_common_position);
    collision_fade = collision_isVisible(collision_texCoords, geometry.pickingColor / 255.0);
    if (collision_fade < 0.0001) {
      // Position outside clip space bounds to discard
      position = vec4(0.0, 0.0, 2.0, 1.0);
    }
  }
  `,"vs:DECKGL_FILTER_COLOR":`
  color.a *= collision_fade;
  `},pD=t=>{if(!t||!("dummyCollisionMap"in t))return{};const{enabled:e,collisionFBO:n,drawToCollisionMap:r,dummyCollisionMap:i}=t;return{enabled:e,sort:!!r,collision_texture:!r&&n?n.colorAttachments[0]:i}},gD={name:"collision",dependencies:[Kc],vs:hD,inject:dD,getUniforms:pD,uniformTypes:{sort:"i32",enabled:"i32"}};class _D extends qc{renderCollisionMap(e,n){const i=[0,0,0,0],s=[1,1,e.width-2*1,e.height-2*1];this.render({...n,clearColor:i,scissorRect:s,target:e,pass:"collision"})}getLayerParameters(e,n,r){return{...e.props.parameters,blend:!1,depthRange:[0,1],depthTest:!0}}getModuleParameters(){return{drawToCollisionMap:!0,picking:{isActive:1,isAttribute:!1},lightSources:{enabled:!1}}}}const _f=2;class mD{constructor(){this.id="collision-filter-effect",this.props=null,this.useInPicking=!0,this.order=1,this.channels={},this.collisionFBOs={}}setup(e){this.context=e;const{device:n}=e;this.dummyCollisionMap=n.createTexture({width:1,height:1}),this.collisionFilterPass=new _D(n,{id:"default-collision-filter"})}preRender({effects:e,layers:n,layerFilter:r,viewports:i,onViewportActive:s,views:o,isPicking:a,preRenderStats:l={}}){var b;const{device:c}=this.context;if(a)return;const u=n.filter(({props:{visible:g,collisionEnabled:p}})=>g&&p);if(u.length===0){this.channels={};return}const f=e==null?void 0:e.filter(g=>g.useInPicking&&l[g.id]),h=(b=l["mask-effect"])==null?void 0:b.didRender,_=this._groupByCollisionGroup(c,u),v=i[0],E=!this.lastViewport||!this.lastViewport.equals(v)||h;for(const g in _){const p=this.collisionFBOs[g],y=_[g],[S,R]=c.canvasContext.getPixelSize();p.resize({width:S/_f,height:R/_f}),this._render(y,{effects:f,layerFilter:r,onViewportActive:s,views:o,viewport:v,viewportChanged:E})}}_render(e,{effects:n,layerFilter:r,onViewportActive:i,views:s,viewport:o,viewportChanged:a}){const{collisionGroup:l}=e,c=this.channels[l];if(!c)return;const u=a||e===c||!dt(c.layers,e.layers,1)||e.layerBounds.some((f,h)=>!Li(f,c.layerBounds[h]))||e.allLayersLoaded!==c.allLayersLoaded||e.layers.some(f=>f.props.transitions);if(this.channels[l]=e,u){this.lastViewport=o;const f=this.collisionFBOs[l];this.collisionFilterPass.renderCollisionMap(f,{pass:"collision-filter",isPicking:!0,layers:e.layers,effects:n,layerFilter:r,viewports:o?[o]:[],onViewportActive:i,views:s,moduleParameters:{dummyCollisionMap:this.dummyCollisionMap,devicePixelRatio:f.device.canvasContext.getDevicePixelRatio()/_f}})}}_groupByCollisionGroup(e,n){const r={};for(const i of n){const{collisionGroup:s}=i.props;let o=r[s];o||(o={collisionGroup:s,layers:[],layerBounds:[],allLayersLoaded:!0},r[s]=o),o.layers.push(i),o.layerBounds.push(i.getBounds()),i.isLoaded||(o.allLayersLoaded=!1)}for(const i of Object.keys(r))this.collisionFBOs[i]||this.createFBO(e,i),this.channels[i]||(this.channels[i]=r[i]);for(const i of Object.keys(this.collisionFBOs))r[i]||this.destroyFBO(i);return r}getModuleParameters(e){const{collisionGroup:n}=e.props,{collisionFBOs:r,dummyCollisionMap:i}=this;return{collisionFBO:r[n],dummyCollisionMap:i}}cleanup(){this.dummyCollisionMap&&(this.dummyCollisionMap.delete(),this.dummyCollisionMap=void 0),this.channels={};for(const e of Object.keys(this.collisionFBOs))this.destroyFBO(e);this.collisionFBOs={},this.lastViewport=void 0}createFBO(e,n){const{width:r,height:i}=e.gl.canvas,s=e.createTexture({format:"rgba8unorm",width:r,height:i,sampler:{minFilter:"nearest",magFilter:"nearest",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),o=e.createTexture({format:"depth16unorm",width:r,height:i,mipmaps:!1});this.collisionFBOs[n]=e.createFramebuffer({id:`collision-${n}`,width:r,height:i,colorAttachments:[s],depthStencilAttachment:o})}destroyFBO(e){var r,i;const n=this.collisionFBOs[e];(r=n.colorAttachments[0])==null||r.destroy(),(i=n.depthStencilAttachment)==null||i.destroy(),n.destroy(),delete this.collisionFBOs[e]}}const yD={getCollisionPriority:{type:"accessor",value:0},collisionEnabled:!0,collisionGroup:{type:"string",value:"default"},collisionTestProps:{}},Ac=class Ac extends od{getShaders(){return{modules:[gD]}}draw({moduleParameters:e}){const{collisionEnabled:n}=this.props,{collisionFBO:r,drawToCollisionMap:i,dummyCollisionMap:s}=e,o=n&&!!r;i&&(this.props=this.clone(this.props.collisionTestProps).props);const a={enabled:o,collisionFBO:r,drawToCollisionMap:i,dummyCollisionMap:s};this.setShaderModuleProps({collision:a})}initializeState(e,n){var i;if(this.getAttributeManager()===null)return;(i=this.context.deck)==null||i._addDefaultEffect(new mD),this.getAttributeManager().add({collisionPriorities:{size:1,stepMode:"dynamic",accessor:"getCollisionPriority"}})}getNeedsPickingBuffer(){return this.props.collisionEnabled}};Ac.defaultProps=yD,Ac.extensionName="CollisionFilterExtension";let ld=Ac;function qa(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function vD(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function U1(t){let e,n,r;t.length!==2?(e=qa,n=(a,l)=>qa(t(a),l),r=(a,l)=>t(a)-l):(e=t===qa||t===vD?t:TD,n=t,r=t);function i(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const f=c+u>>>1;n(a[f],l)<0?c=f+1:u=f}while(c<u)}return c}function s(a,l,c=0,u=a.length){if(c<u){if(e(l,l)!==0)return u;do{const f=c+u>>>1;n(a[f],l)<=0?c=f+1:u=f}while(c<u)}return c}function o(a,l,c=0,u=a.length){const f=i(a,l,c,u-1);return f>c&&r(a[f-1],l)>-r(a[f],l)?f-1:f}return{left:i,center:o,right:s}}function TD(){return 0}function wD(t){return t===null?NaN:+t}const ED=U1(qa),SD=ED.right;U1(wD).center;const bD=SD,AD=Math.sqrt(50),RD=Math.sqrt(10),CD=Math.sqrt(2);function cd(t,e,n){const r=(e-t)/Math.max(0,n),i=Math.floor(Math.log10(r)),s=r/Math.pow(10,i),o=s>=AD?10:s>=RD?5:s>=CD?2:1;let a,l,c;return i<0?(c=Math.pow(10,-i)/o,a=Math.round(t*c),l=Math.round(e*c),a/c<t&&++a,l/c>e&&--l,c=-c):(c=Math.pow(10,i)*o,a=Math.round(t/c),l=Math.round(e/c),a*c<t&&++a,l*c>e&&--l),l<a&&.5<=n&&n<2?cd(t,e,n*2):[a,l,c]}function Cy(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[i,s,o]=r?cd(e,t,n):cd(t,e,n);if(!(s>=i))return[];const a=s-i+1,l=new Array(a);if(r)if(o<0)for(let c=0;c<a;++c)l[c]=(s-c)/-o;else for(let c=0;c<a;++c)l[c]=(s-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(i+c)/-o;else for(let c=0;c<a;++c)l[c]=(i+c)*o;return l}function xD(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function Fp(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function L1(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Do(){}var _o=.7,Zl=1/_o,Ri="\\s*([+-]?\\d+)\\s*",mo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",rn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",PD=/^#([0-9a-f]{3,8})$/,MD=new RegExp(`^rgb\\(${Ri},${Ri},${Ri}\\)$`),ID=new RegExp(`^rgb\\(${rn},${rn},${rn}\\)$`),ND=new RegExp(`^rgba\\(${Ri},${Ri},${Ri},${mo}\\)$`),kD=new RegExp(`^rgba\\(${rn},${rn},${rn},${mo}\\)$`),OD=new RegExp(`^hsl\\(${mo},${rn},${rn}\\)$`),FD=new RegExp(`^hsla\\(${mo},${rn},${rn},${mo}\\)$`),xy={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Fp(Do,yo,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:Py,formatHex:Py,formatHex8:DD,formatHsl:BD,formatRgb:My,toString:My});function Py(){return this.rgb().formatHex()}function DD(){return this.rgb().formatHex8()}function BD(){return z1(this).formatHsl()}function My(){return this.rgb().formatRgb()}function yo(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=PD.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?Iy(e):n===3?new it(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?Pa(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?Pa(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=MD.exec(t))?new it(e[1],e[2],e[3],1):(e=ID.exec(t))?new it(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=ND.exec(t))?Pa(e[1],e[2],e[3],e[4]):(e=kD.exec(t))?Pa(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=OD.exec(t))?Oy(e[1],e[2]/100,e[3]/100,1):(e=FD.exec(t))?Oy(e[1],e[2]/100,e[3]/100,e[4]):xy.hasOwnProperty(t)?Iy(xy[t]):t==="transparent"?new it(NaN,NaN,NaN,0):null}function Iy(t){return new it(t>>16&255,t>>8&255,t&255,1)}function Pa(t,e,n,r){return r<=0&&(t=e=n=NaN),new it(t,e,n,r)}function UD(t){return t instanceof Do||(t=yo(t)),t?(t=t.rgb(),new it(t.r,t.g,t.b,t.opacity)):new it}function ud(t,e,n,r){return arguments.length===1?UD(t):new it(t,e,n,r??1)}function it(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}Fp(it,ud,L1(Do,{brighter(t){return t=t==null?Zl:Math.pow(Zl,t),new it(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?_o:Math.pow(_o,t),new it(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new it(Ar(this.r),Ar(this.g),Ar(this.b),Ql(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:Ny,formatHex:Ny,formatHex8:LD,formatRgb:ky,toString:ky}));function Ny(){return`#${mr(this.r)}${mr(this.g)}${mr(this.b)}`}function LD(){return`#${mr(this.r)}${mr(this.g)}${mr(this.b)}${mr((isNaN(this.opacity)?1:this.opacity)*255)}`}function ky(){const t=Ql(this.opacity);return`${t===1?"rgb(":"rgba("}${Ar(this.r)}, ${Ar(this.g)}, ${Ar(this.b)}${t===1?")":`, ${t})`}`}function Ql(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Ar(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function mr(t){return t=Ar(t),(t<16?"0":"")+t.toString(16)}function Oy(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Ft(t,e,n,r)}function z1(t){if(t instanceof Ft)return new Ft(t.h,t.s,t.l,t.opacity);if(t instanceof Do||(t=yo(t)),!t)return new Ft;if(t instanceof Ft)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),s=Math.max(e,n,r),o=NaN,a=s-i,l=(s+i)/2;return a?(e===s?o=(n-r)/a+(n<r)*6:n===s?o=(r-e)/a+2:o=(e-n)/a+4,a/=l<.5?s+i:2-s-i,o*=60):a=l>0&&l<1?0:o,new Ft(o,a,l,t.opacity)}function zD(t,e,n,r){return arguments.length===1?z1(t):new Ft(t,e,n,r??1)}function Ft(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}Fp(Ft,zD,L1(Do,{brighter(t){return t=t==null?Zl:Math.pow(Zl,t),new Ft(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?_o:Math.pow(_o,t),new Ft(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new it(mf(t>=240?t-240:t+120,i,r),mf(t,i,r),mf(t<120?t+240:t-120,i,r),this.opacity)},clamp(){return new Ft(Fy(this.h),Ma(this.s),Ma(this.l),Ql(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=Ql(this.opacity);return`${t===1?"hsl(":"hsla("}${Fy(this.h)}, ${Ma(this.s)*100}%, ${Ma(this.l)*100}%${t===1?")":`, ${t})`}`}}));function Fy(t){return t=(t||0)%360,t<0?t+360:t}function Ma(t){return Math.max(0,Math.min(1,t||0))}function mf(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const Dp=t=>()=>t;function VD(t,e){return function(n){return t+n*e}}function jD(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function HD(t){return(t=+t)==1?V1:function(e,n){return n-e?jD(e,n,t):Dp(isNaN(e)?n:e)}}function V1(t,e){var n=e-t;return n?VD(t,n):Dp(isNaN(t)?e:t)}const Dy=function t(e){var n=HD(e);function r(i,s){var o=n((i=ud(i)).r,(s=ud(s)).r),a=n(i.g,s.g),l=n(i.b,s.b),c=V1(i.opacity,s.opacity);return function(u){return i.r=o(u),i.g=a(u),i.b=l(u),i.opacity=c(u),i+""}}return r.gamma=t,r}(1);function WD(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),i;return function(s){for(i=0;i<n;++i)r[i]=t[i]*(1-s)+e[i]*s;return r}}function $D(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function XD(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,i=new Array(r),s=new Array(n),o;for(o=0;o<r;++o)i[o]=Bp(t[o],e[o]);for(;o<n;++o)s[o]=e[o];return function(a){for(o=0;o<r;++o)s[o]=i[o](a);return s}}function YD(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function Jl(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function KD(t,e){var n={},r={},i;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in t?n[i]=Bp(t[i],e[i]):r[i]=e[i];return function(s){for(i in n)r[i]=n[i](s);return r}}var fd=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,yf=new RegExp(fd.source,"g");function qD(t){return function(){return t}}function ZD(t){return function(e){return t(e)+""}}function QD(t,e){var n=fd.lastIndex=yf.lastIndex=0,r,i,s,o=-1,a=[],l=[];for(t=t+"",e=e+"";(r=fd.exec(t))&&(i=yf.exec(e));)(s=i.index)>n&&(s=e.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(r=r[0])===(i=i[0])?a[o]?a[o]+=i:a[++o]=i:(a[++o]=null,l.push({i:o,x:Jl(r,i)})),n=yf.lastIndex;return n<e.length&&(s=e.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?l[0]?ZD(l[0].x):qD(e):(e=l.length,function(c){for(var u=0,f;u<e;++u)a[(f=l[u]).i]=f.x(c);return a.join("")})}function Bp(t,e){var n=typeof e,r;return e==null||n==="boolean"?Dp(e):(n==="number"?Jl:n==="string"?(r=yo(e))?(e=r,Dy):QD:e instanceof yo?Dy:e instanceof Date?YD:$D(e)?WD:Array.isArray(e)?XD:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?KD:Jl)(t,e)}function JD(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function GD(t){return function(){return t}}function eB(t){return+t}var By=[0,1];function Ia(t){return t}function hd(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:GD(isNaN(e)?NaN:.5)}function tB(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function nB(t,e,n){var r=t[0],i=t[1],s=e[0],o=e[1];return i<r?(r=hd(i,r),s=n(o,s)):(r=hd(r,i),s=n(s,o)),function(a){return s(r(a))}}function rB(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),s=new Array(r),o=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<r;)i[o]=hd(t[o],t[o+1]),s[o]=n(e[o],e[o+1]);return function(a){var l=bD(t,a,1,r)-1;return s[l](i[l](a))}}function iB(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function sB(){var t=By,e=By,n=Bp,r,i,s,o=Ia,a,l,c;function u(){var h=Math.min(t.length,e.length);return o!==Ia&&(o=tB(t[0],t[h-1])),a=h>2?rB:nB,l=c=null,f}function f(h){return h==null||isNaN(h=+h)?s:(l||(l=a(t.map(r),e,n)))(r(o(h)))}return f.invert=function(h){return o(i((c||(c=a(e,t.map(r),Jl)))(h)))},f.domain=function(h){return arguments.length?(t=Array.from(h,eB),u()):t.slice()},f.range=function(h){return arguments.length?(e=Array.from(h),u()):e.slice()},f.rangeRound=function(h){return e=Array.from(h),n=JD,u()},f.clamp=function(h){return arguments.length?(o=h?!0:Ia,u()):o!==Ia},f.interpolate=function(h){return arguments.length?(n=h,u()):n},f.unknown=function(h){return arguments.length?(s=h,f):s},function(h,_){return r=h,i=_,u()}}function oB(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Gl(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function aB(t){return t=Gl(Math.abs(t)),t?t[1]:NaN}function lB(t,e){return function(n,r){for(var i=n.length,s=[],o=0,a=t[0],l=0;i>0&&a>0&&(l+a+1>r&&(a=Math.max(1,r-l)),s.push(n.substring(i-=a,i+a)),!((l+=a+1)>r));)a=t[o=(o+1)%t.length];return s.reverse().join(e)}}function cB(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var uB=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function ec(t){if(!(e=uB.exec(t)))throw new Error("invalid format: "+t);var e;return new Up({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}ec.prototype=Up.prototype;function Up(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Up.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function fB(t){e:for(var e=t.length,n=1,r=-1,i;n<e;++n)switch(t[n]){case".":r=i=n;break;case"0":r===0&&(r=n),i=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(i+1):t}var j1;function hB(t,e){var n=Gl(t,e);if(!n)return t+"";var r=n[0],i=n[1],s=i-(j1=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,o=r.length;return s===o?r:s>o?r+new Array(s-o+1).join("0"):s>0?r.slice(0,s)+"."+r.slice(s):"0."+new Array(1-s).join("0")+Gl(t,Math.max(0,e+s-1))[0]}function Uy(t,e){var n=Gl(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const Ly={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:oB,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>Uy(t*100,e),r:Uy,s:hB,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function zy(t){return t}var Vy=Array.prototype.map,jy=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function dB(t){var e=t.grouping===void 0||t.thousands===void 0?zy:lB(Vy.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",i=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?zy:cB(Vy.call(t.numerals,String)),o=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function c(f){f=ec(f);var h=f.fill,_=f.align,v=f.sign,E=f.symbol,b=f.zero,g=f.width,p=f.comma,y=f.precision,S=f.trim,R=f.type;R==="n"?(p=!0,R="g"):Ly[R]||(y===void 0&&(y=12),S=!0,R="g"),(b||h==="0"&&_==="=")&&(b=!0,h="0",_="=");var P=E==="$"?n:E==="#"&&/[boxX]/.test(R)?"0"+R.toLowerCase():"",O=E==="$"?r:/[%p]/.test(R)?o:"",M=Ly[R],k=/[defgprs%]/.test(R);y=y===void 0?6:/[gprs]/.test(R)?Math.max(1,Math.min(21,y)):Math.max(0,Math.min(20,y));function D(F){var B=P,V=O,H,Z,Ce;if(R==="c")V=M(F)+V,F="";else{F=+F;var we=F<0||1/F<0;if(F=isNaN(F)?l:M(Math.abs(F),y),S&&(F=fB(F)),we&&+F==0&&v!=="+"&&(we=!1),B=(we?v==="("?v:a:v==="-"||v==="("?"":v)+B,V=(R==="s"?jy[8+j1/3]:"")+V+(we&&v==="("?")":""),k){for(H=-1,Z=F.length;++H<Z;)if(Ce=F.charCodeAt(H),48>Ce||Ce>57){V=(Ce===46?i+F.slice(H+1):F.slice(H))+V,F=F.slice(0,H);break}}}p&&!b&&(F=e(F,1/0));var j=B.length+F.length+V.length,Y=j<g?new Array(g-j+1).join(h):"";switch(p&&b&&(F=e(Y+F,Y.length?g-V.length:1/0),Y=""),_){case"<":F=B+F+V+Y;break;case"=":F=B+Y+F+V;break;case"^":F=Y.slice(0,j=Y.length>>1)+B+F+V+Y.slice(j);break;default:F=Y+B+F+V;break}return s(F)}return D.toString=function(){return f+""},D}function u(f,h){var _=c((f=ec(f),f.type="f",f)),v=Math.max(-8,Math.min(8,Math.floor(aB(h)/3)))*3,E=Math.pow(10,-v),b=jy[8+v/3];return function(g){return _(E*g)+b}}return{format:c,formatPrefix:u}}var Na,H1;pB({thousands:",",grouping:[3],currency:["$",""]});function pB(t){return Na=dB(t),H1=Na.format,Na.formatPrefix,Na}function gB(t,e){t=t.slice();var n=0,r=t.length-1,i=t[n],s=t[r],o;return s<i&&(o=n,n=r,r=o,o=i,i=s,s=o),t[n]=e.floor(i),t[r]=e.ceil(s),t}function Hy(t){return Math.log(t)}function Wy(t){return Math.exp(t)}function _B(t){return-Math.log(-t)}function mB(t){return-Math.exp(-t)}function yB(t){return isFinite(t)?+("1e"+t):t<0?0:t}function vB(t){return t===10?yB:t===Math.E?Math.exp:e=>Math.pow(t,e)}function TB(t){return t===Math.E?Math.log:t===10&&Math.log10||t===2&&Math.log2||(t=Math.log(t),e=>Math.log(e)/t)}function $y(t){return(e,n)=>-t(-e,n)}function wB(t){const e=t(Hy,Wy),n=e.domain;let r=10,i,s;function o(){return i=TB(r),s=vB(r),n()[0]<0?(i=$y(i),s=$y(s),t(_B,mB)):t(Hy,Wy),e}return e.base=function(a){return arguments.length?(r=+a,o()):r},e.domain=function(a){return arguments.length?(n(a),o()):n()},e.ticks=a=>{const l=n();let c=l[0],u=l[l.length-1];const f=u<c;f&&([c,u]=[u,c]);let h=i(c),_=i(u),v,E;const b=a==null?10:+a;let g=[];if(!(r%1)&&_-h<b){if(h=Math.floor(h),_=Math.ceil(_),c>0){for(;h<=_;++h)for(v=1;v<r;++v)if(E=h<0?v/s(-h):v*s(h),!(E<c)){if(E>u)break;g.push(E)}}else for(;h<=_;++h)for(v=r-1;v>=1;--v)if(E=h>0?v/s(-h):v*s(h),!(E<c)){if(E>u)break;g.push(E)}g.length*2<b&&(g=Cy(c,u,b))}else g=Cy(h,_,Math.min(_-h,b)).map(s);return f?g.reverse():g},e.tickFormat=(a,l)=>{if(a==null&&(a=10),l==null&&(l=r===10?"s":","),typeof l!="function"&&(!(r%1)&&(l=ec(l)).precision==null&&(l.trim=!0),l=H1(l)),a===1/0)return l;const c=Math.max(1,r*a/e.ticks().length);return u=>{let f=u/s(Math.round(i(u)));return f*r<r-.5&&(f*=r),f<=c?l(u):""}},e.nice=()=>n(gB(n(),{floor:a=>s(Math.floor(i(a))),ceil:a=>s(Math.ceil(i(a)))})),e}function W1(){const t=wB(sB()).domain([1,10]);return t.copy=()=>iB(t,W1()).base(t.base()),xD.apply(t,arguments),t}const Xy=100;class EB{constructor(e,n){d(this,"schema");d(this,"options");d(this,"shape");d(this,"length",0);d(this,"rows",null);d(this,"cursor",0);d(this,"_headers",[]);if(this.options=n,this.schema=e,!Array.isArray(e)){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.shape="array-row-table",this.rows=this.rows||new Array(Xy),this.rows[this.length]=e,this.length++}addObjectRow(e,n){Number.isFinite(n)&&(this.cursor=n),this.shape="object-row-table",this.rows=this.rows||new Array(Xy),this.rows[this.length]=e,this.length++}getBatch(){let e=this.rows;return e?(e=e.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function $1(t,e){if(!t)throw new Error("null row");const n={};if(e)for(let r=0;r<e.length;r++)n[e[r]]=t[r];else for(let r=0;r<t.length;r++){const i=`column-${r}`;n[i]=t[r]}return n}function X1(t,e){if(!t)throw new Error("null row");if(e){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}return Object.values(t)}function SB(t){const e=[];for(let n=0;n<t.length;n++){const r=`column-${n}`;e.push(r)}return e}function bB(t){return Object.keys(t)}const Yy=100;class AB{constructor(e,n){d(this,"schema");d(this,"options");d(this,"length",0);d(this,"objectRows",null);d(this,"arrayRows",null);d(this,"cursor",0);d(this,"_headers",null);if(this.options=n,this.schema=e,e){this._headers=[];for(const r in e)this._headers[e[r].index]=e[r].name}}rowCount(){return this.length}addArrayRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=SB(e)),this.options.shape){case"object-row-table":const r=$1(e,this._headers);this.addObjectRow(r,n);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(Yy),this.arrayRows[this.length]=e,this.length++;break}}addObjectRow(e,n){switch(Number.isFinite(n)&&(this.cursor=n),this._headers||(this._headers=bB(e)),this.options.shape){case"array-row-table":const r=X1(e,this._headers);this.addArrayRow(r,n);break;case"object-row-table":this.objectRows=this.objectRows||new Array(Yy),this.objectRows[this.length]=e,this.length++;break}}getBatch(){let e=this.arrayRows||this.objectRows;return e?(e=e.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:e,length:this.length,schema:this.schema,cursor:this.cursor}):null}}const RB=100;class CB{constructor(e,n){d(this,"schema");d(this,"length",0);d(this,"allocated",0);d(this,"columns",{});this.schema=e,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(e){this._reallocateColumns();let n=0;for(const r in this.columns)this.columns[r][this.length]=e[n++];this.length++}addObjectRow(e){this._reallocateColumns();for(const n in e)this.columns[n][this.length]=e[n];this.length++}getBatch(){this._pruneColumns();const e=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const r in this.schema){const i=this.schema[r];e[i.name]=this.columns[i.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:e,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:RB,this.columns={};for(const e in this.schema){const n=this.schema[e],r=n.type||Float32Array,i=this.columns[n.index];if(i&&ArrayBuffer.isView(i)){const s=new r(this.allocated);s.set(i),this.columns[n.index]=s}else i?(i.length=this.allocated,this.columns[n.index]=i):this.columns[n.index]=new r(this.allocated)}}}_pruneColumns(){for(const[e,n]of Object.entries(this.columns))this.columns[e]=n.slice(0,this.length)}}const xB={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0},PB="TableBatchBuilder",Ks=class Ks{constructor(e,n){d(this,"schema");d(this,"options");d(this,"aggregator",null);d(this,"batchCount",0);d(this,"bytesUsed",0);d(this,"isChunkComplete",!1);d(this,"lastBatchEmittedMs",Date.now());d(this,"totalLength",0);d(this,"totalBytes",0);d(this,"rowBytes",0);this.schema=e,this.options={...xB,...n}}limitReached(){var e,n;return!!((e=this.options)!=null&&e.limit&&this.totalLength>=this.options.limit||(n=this.options)!=null&&n._limitMB&&this.totalBytes/1e6>=this.options._limitMB)}addRow(e){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(e),this.totalBytes+=this.rowBytes,Array.isArray(e)?this.addArrayRow(e):this.addObjectRow(e))}addArrayRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addArrayRow(e)}addObjectRow(e){if(!this.aggregator){const n=this._getTableBatchType();this.aggregator=new n(this.schema,this.options)}this.aggregator.addObjectRow(e)}chunkComplete(e){e instanceof ArrayBuffer&&(this.bytesUsed+=e.byteLength),typeof e=="string"&&(this.bytesUsed+=e.length),this.isChunkComplete=!0}getFullBatch(e){return this._isFull()?this._getBatch(e):null}getFinalBatch(e){return this._getBatch(e)}_estimateRowMB(e){return Array.isArray(e)?e.length*8:Object.keys(e).length*8}_isFull(){if(!this.aggregator||this.aggregator.rowCount()===0)return!1;if(this.options.batchSize==="auto"){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs?!1:(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(e){if(!this.aggregator)return null;e!=null&&e.bytesUsed&&(this.bytesUsed=e.bytesUsed);const n=this.aggregator.getBatch();return n.count=this.batchCount,n.bytesUsed=this.bytesUsed,Object.assign(n,e),this.batchCount++,this.aggregator=null,n}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return AB;case"columnar-table":return CB;case"arrow-table":if(!Ks.ArrowBatch)throw new Error(PB);return Ks.ArrowBatch;default:return EB}}};d(Ks,"ArrowBatch");let dd=Ks;class Ky extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class MB{constructor(){d(this,"_values");d(this,"_settlers");d(this,"_closed");this._values=new Ky,this._settlers=new Ky,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const n=this._settlers.dequeue();e instanceof Error?n.reject(e):n.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((e,n)=>{this._settlers.enqueue({resolve:e,reject:n})})}}/* @license
Papa Parse
v5.0.0-beta.0
https://github.com/mholt/PapaParse
License: MIT
*/const qy="\uFEFF",en={parse:IB,unparse:NB,RECORD_SEP:String.fromCharCode(30),UNIT_SEP:String.fromCharCode(31),BYTE_ORDER_MARK:qy,BAD_DELIMITERS:["\r",`
`,'"',qy],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:1024*1024*10,RemoteChunkSize:1024*1024*5,DefaultDelimiter:",",Parser:pd,ParserHandle:K1,ChunkStreamer:Y1,StringStreamer:Ki},Gc=en;function IB(t,e,n){e=e||{};var r=e.dynamicTyping||!1;if(Qe(r)&&(e.dynamicTypingFunction=r,r={}),e.dynamicTyping=r,e.transform=Qe(e.transform)?e.transform:!1,e.worker&&en.WORKERS_SUPPORTED){var i=newWorker();i.userStep=e.step,i.userChunk=e.chunk,i.userComplete=e.complete,i.userError=e.error,e.step=Qe(e.step),e.chunk=Qe(e.chunk),e.complete=Qe(e.complete),e.error=Qe(e.error),delete e.worker,i.postMessage({input:t,config:e,workerId:i.id});return}var s=null;return typeof t=="string"&&(s=new Ki(e)),s||(s=new n(e)),s.stream(t)}function NB(t,e){var n=!1,r=!0,i=",",s=`\r
`,o='"',a=o+o,l=!1,c=null;f();var u=new RegExp(vo(o),"g");if(typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(t)){if(!t.length||Array.isArray(t[0]))return _(null,t,l);if(typeof t[0]=="object")return _(c||h(t[0]),t,l)}else if(typeof t=="object")return typeof t.data=="string"&&(t.data=JSON.parse(t.data)),Array.isArray(t.data)&&(t.fields||(t.fields=t.meta&&t.meta.fields),t.fields||(t.fields=Array.isArray(t.data[0])?t.fields:h(t.data[0])),!Array.isArray(t.data[0])&&typeof t.data[0]!="object"&&(t.data=[t.data])),_(t.fields||[],t.data||[],l);throw new Error("Unable to serialize unrecognized input");function f(){if(typeof e=="object"){if(typeof e.delimiter=="string"&&!en.BAD_DELIMITERS.filter(function(b){return e.delimiter.indexOf(b)!==-1}).length&&(i=e.delimiter),(typeof e.quotes=="boolean"||Array.isArray(e.quotes))&&(n=e.quotes),(typeof e.skipEmptyLines=="boolean"||typeof e.skipEmptyLines=="string")&&(l=e.skipEmptyLines),typeof e.newline=="string"&&(s=e.newline),typeof e.quoteChar=="string"&&(o=e.quoteChar),typeof e.header=="boolean"&&(r=e.header),Array.isArray(e.columns)){if(e.columns.length===0)throw new Error("Option columns is empty");c=e.columns}e.escapeChar!==void 0&&(a=e.escapeChar+o)}}function h(b){if(typeof b!="object")return[];var g=[];for(var p in b)g.push(p);return g}function _(b,g,p){var y="";typeof b=="string"&&(b=JSON.parse(b)),typeof g=="string"&&(g=JSON.parse(g));var S=Array.isArray(b)&&b.length>0,R=!Array.isArray(g[0]);if(S&&r){for(var P=0;P<b.length;P++)P>0&&(y+=i),y+=v(b[P],P);g.length>0&&(y+=s)}for(var O=0;O<g.length;O++){var M=S?b.length:g[O].length,k=!1,D=S?Object.keys(g[O]).length===0:g[O].length===0;if(p&&!S&&(k=p==="greedy"?g[O].join("").trim()==="":g[O].length===1&&g[O][0].length===0),p==="greedy"&&S){for(var F=[],B=0;B<M;B++){var V=R?b[B]:B;F.push(g[O][V])}k=F.join("").trim()===""}if(!k){for(var H=0;H<M;H++){H>0&&!D&&(y+=i);var Z=S&&R?b[H]:H;y+=v(g[O][Z],H)}O<g.length-1&&(!p||M>0&&!D)&&(y+=s)}}return y}function v(b,g){if(typeof b>"u"||b===null)return"";if(b.constructor===Date)return JSON.stringify(b).slice(1,25);b=b.toString().replace(u,a);var p=typeof n=="boolean"&&n||Array.isArray(n)&&n[g]||E(b,en.BAD_DELIMITERS)||b.indexOf(i)>-1||b.charAt(0)===" "||b.charAt(b.length-1)===" ";return p?o+b+o:b}function E(b,g){for(var p=0;p<g.length;p++)if(b.indexOf(g[p])>-1)return!0;return!1}}function Y1(t){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},e.call(this,t),this.parseChunk=function(n,r){if(this.isFirstChunk&&Qe(this._config.beforeFirstChunk)){var i=this._config.beforeFirstChunk(n);i!==void 0&&(n=i)}this.isFirstChunk=!1;var s=this._partialLine+n;this._partialLine="";var o=this._handle.parse(s,this._baseIndex,!this._finished);if(!(this._handle.paused()||this._handle.aborted())){var a=o.meta.cursor;this._finished||(this._partialLine=s.substring(a-this._baseIndex),this._baseIndex=a),o&&o.data&&(this._rowCount+=o.data.length);var l=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(Qe(this._config.chunk)&&!r){if(this._config.chunk(o,this._handle),this._handle.paused()||this._handle.aborted())return;o=void 0,this._completeResults=void 0}return!this._config.step&&!this._config.chunk&&(this._completeResults.data=this._completeResults.data.concat(o.data),this._completeResults.errors=this._completeResults.errors.concat(o.errors),this._completeResults.meta=o.meta),!this._completed&&l&&Qe(this._config.complete)&&(!o||!o.meta.aborted)&&(this._config.complete(this._completeResults,this._input),this._completed=!0),!l&&(!o||!o.meta.paused)&&this._nextChunk(),o}},this._sendError=function(n){Qe(this._config.error)&&this._config.error(n)};function e(n){var r=Lp(n);r.chunkSize=parseInt(r.chunkSize),!n.step&&!n.chunk&&(r.chunkSize=null),this._handle=new K1(r),this._handle.streamer=this,this._config=r}}function Ki(t){t=t||{},Y1.call(this,t);var e;this.stream=function(n){return e=n,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var n=this._config.chunkSize,r=n?e.substr(0,n):e;return e=n?e.substr(n):"",this._finished=!e,this.parseChunk(r)}}}Ki.prototype=Object.create(Ki.prototype);Ki.prototype.constructor=Ki;function K1(t){var e=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,n=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,r=this,i=0,s=0,o,a,l=!1,c=!1,u,f=[],h={data:[],errors:[],meta:{}};if(Qe(t.step)){var _=t.step;t.step=function(M){if(h=M,b())E();else{if(E(),!h.data||h.data.length===0)return;i+=M.data.length,t.preview&&i>t.preview?a.abort():_(h,r)}}}this.parse=function(M,k,D){var F=t.quoteChar||'"';if(t.newline||(t.newline=P(M,F)),u=!1,t.delimiter)Qe(t.delimiter)&&(t.delimiter=t.delimiter(M),h.meta.delimiter=t.delimiter);else{var B=R(M,t.newline,t.skipEmptyLines,t.comments,t.delimitersToGuess);B.successful?t.delimiter=B.bestDelimiter:(u=!0,t.delimiter=en.DefaultDelimiter),h.meta.delimiter=t.delimiter}var V=Lp(t);return t.preview&&t.header&&V.preview++,o=M,a=new pd(V),h=a.parse(o,k,D),E(),l?{meta:{paused:!0}}:h||{meta:{paused:!1}}},this.paused=function(){return l},this.pause=function(){l=!0,a.abort(),o=o.substr(a.getCharIndex())},this.resume=function(){l=!1,r.streamer.parseChunk(o,!0)},this.aborted=function(){return c},this.abort=function(){c=!0,a.abort(),h.meta.aborted=!0,Qe(t.complete)&&t.complete(h),o=""};function v(M){return t.skipEmptyLines==="greedy"?M.join("").trim()==="":M.length===1&&M[0].length===0}function E(){if(h&&u&&(O("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+en.DefaultDelimiter+"'"),u=!1),t.skipEmptyLines)for(var M=0;M<h.data.length;M++)v(h.data[M])&&h.data.splice(M--,1);return b()&&g(),S()}function b(){return t.header&&f.length===0}function g(){if(!h)return;function M(D){Qe(t.transformHeader)&&(D=t.transformHeader(D)),f.push(D)}if(Array.isArray(h.data[0])){for(var k=0;b()&&k<h.data.length;k++)h.data[k].forEach(M);h.data.splice(0,1)}else h.data.forEach(M)}function p(M){return t.dynamicTypingFunction&&t.dynamicTyping[M]===void 0&&(t.dynamicTyping[M]=t.dynamicTypingFunction(M)),(t.dynamicTyping[M]||t.dynamicTyping)===!0}function y(M,k){return p(M)?k==="true"||k==="TRUE"?!0:k==="false"||k==="FALSE"?!1:e.test(k)?parseFloat(k):n.test(k)?new Date(k):k===""?null:k:k}function S(){if(!h||!h.data||!t.header&&!t.dynamicTyping&&!t.transform)return h;function M(D,F){var B=t.header?{}:[],V;for(V=0;V<D.length;V++){var H=V,Z=D[V];t.header&&(H=V>=f.length?"__parsed_extra":f[V]),t.transform&&(Z=t.transform(Z,H)),Z=y(H,Z),H==="__parsed_extra"?(B[H]=B[H]||[],B[H].push(Z)):B[H]=Z}return t.header&&(V>f.length?O("FieldMismatch","TooManyFields","Too many fields: expected "+f.length+" fields but parsed "+V,s+F):V<f.length&&O("FieldMismatch","TooFewFields","Too few fields: expected "+f.length+" fields but parsed "+V,s+F)),B}var k=1;return!h.data[0]||Array.isArray(h.data[0])?(h.data=h.data.map(M),k=h.data.length):h.data=M(h.data,0),t.header&&h.meta&&(h.meta.fields=f),s+=k,h}function R(M,k,D,F,B){var V,H,Z;B=B||[",","	","|",";",en.RECORD_SEP,en.UNIT_SEP];for(var Ce=0;Ce<B.length;Ce++){var we=B[Ce],j=0,Y=0,q=0;Z=void 0;for(var K=new pd({comments:F,delimiter:we,newline:k,preview:10}).parse(M),G=0;G<K.data.length;G++){if(D&&v(K.data[G])){q++;continue}var fe=K.data[G].length;if(Y+=fe,typeof Z>"u"){Z=0;continue}else fe>1&&(j+=Math.abs(fe-Z),Z=fe)}K.data.length>0&&(Y/=K.data.length-q),(typeof H>"u"||j>H)&&Y>1.99&&(H=j,V=we)}return t.delimiter=V,{successful:!!V,bestDelimiter:V}}function P(M,k){M=M.substr(0,1024*1024);var D=new RegExp(vo(k)+"([^]*?)"+vo(k),"gm");M=M.replace(D,"");var F=M.split("\r"),B=M.split(`
`),V=B.length>1&&B[0].length<F[0].length;if(F.length===1||V)return`
`;for(var H=0,Z=0;Z<F.length;Z++)F[Z][0]===`
`&&H++;return H>=F.length/2?`\r
`:"\r"}function O(M,k,D,F){h.errors.push({type:M,code:k,message:D,row:F})}}function vo(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function pd(t){t=t||{};var e=t.delimiter,n=t.newline,r=t.comments,i=t.step,s=t.preview,o=t.fastMode,a;t.quoteChar===void 0?a='"':a=t.quoteChar;var l=a;if(t.escapeChar!==void 0&&(l=t.escapeChar),(typeof e!="string"||en.BAD_DELIMITERS.indexOf(e)>-1)&&(e=","),r===e)throw new Error("Comment character same as delimiter");r===!0?r="#":(typeof r!="string"||en.BAD_DELIMITERS.indexOf(r)>-1)&&(r=!1),n!==`
`&&n!=="\r"&&n!==`\r
`&&(n=`
`);var c=0,u=!1;this.parse=function(f,h,_){if(typeof f!="string")throw new Error("Input must be a string");var v=f.length,E=e.length,b=n.length,g=r.length,p=Qe(i);c=0;var y=[],S=[],R=[],P=0;if(!f)return K();if(o||o!==!1&&f.indexOf(a)===-1){for(var O=f.split(n),M=0;M<O.length;M++){if(R=O[M],c+=R.length,M!==O.length-1)c+=n.length;else if(_)return K();if(!(r&&R.substr(0,g)===r)){if(p){if(y=[],we(R.split(e)),G(),u)return K()}else we(R.split(e));if(s&&M>=s)return y=y.slice(0,s),K(!0)}}return K()}for(var k=f.indexOf(e,c),D=f.indexOf(n,c),F=new RegExp(vo(l)+vo(a),"g"),B;;){if(f[c]===a){for(B=c,c++;;){if(B=f.indexOf(a,B+1),B===-1)return _||S.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:y.length,index:c}),Y();if(B===v-1){var V=f.substring(c,B).replace(F,a);return Y(V)}if(a===l&&f[B+1]===l){B++;continue}if(!(a!==l&&B!==0&&f[B-1]===l)){var H=D===-1?k:Math.min(k,D),Z=j(H);if(f[B+1+Z]===e){if(R.push(f.substring(c,B).replace(F,a)),c=B+1+Z+E,k=f.indexOf(e,c),D=f.indexOf(n,c),p&&(G(),u))return K();if(s&&y.length>=s)return K(!0);break}var Ce=j(D);if(f.substr(B+1+Ce,b)===n){if(R.push(f.substring(c,B).replace(F,a)),q(B+1+Ce+b),k=f.indexOf(e,c),p&&(G(),u))return K();if(s&&y.length>=s)return K(!0);break}S.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:y.length,index:c}),B++}}if(p&&(G(),u))return K();if(s&&y.length>=s)return K(!0);continue}if(r&&R.length===0&&f.substr(c,g)===r){if(D===-1)return K();c=D+b,D=f.indexOf(n,c),k=f.indexOf(e,c);continue}if(k!==-1&&(k<D||D===-1)){R.push(f.substring(c,k)),c=k+E,k=f.indexOf(e,c);continue}if(D!==-1){if(R.push(f.substring(c,D)),q(D+b),p&&(G(),u))return K();if(s&&y.length>=s)return K(!0);continue}break}return Y();function we(fe){y.push(fe),P=c}function j(fe){var ze=0;if(fe!==-1){var Ct=f.substring(B+1,fe);Ct&&Ct.trim()===""&&(ze=Ct.length)}return ze}function Y(fe){return _||(typeof fe>"u"&&(fe=f.substr(c)),R.push(fe),c=v,we(R),p&&G()),K()}function q(fe){c=fe,we(R),R=[],D=f.indexOf(n,c)}function K(fe,ze){var Ct=ze||!1;return{data:Ct?y[0]:y,errors:S,meta:{delimiter:e,linebreak:n,aborted:u,truncated:!!fe,cursor:P+(h||0)}}}function G(){i(K(void 0,!0)),y=[],S=[]}},this.abort=function(){u=!0},this.getCharIndex=function(){return c}}function Lp(t){if(typeof t!="object"||t===null)return t;var e=Array.isArray(t)?[]:{};for(var n in t)e[n]=Lp(t[n]);return e}function Qe(t){return typeof t=="function"}const{ChunkStreamer:q1}=Gc;function tc(t){t=t||{},q1.call(this,t),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(e){this._input=e;try{for await(const n of e)this.parseChunk(this.getStringChunk(n));this._finished=!0,this.parseChunk("")}catch(n){this._sendError(n)}},this._nextChunk=function(){},this.getStringChunk=function(e){return typeof e=="string"?e:this.textDecoder.decode(e,{stream:!0})}}tc.prototype=Object.create(q1.prototype);tc.prototype.constructor=tc;const kB="4.2.1",zp="object-row-table",Vp={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:kB,extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(t,e)=>Zy(new TextDecoder().decode(t),e),parseText:(t,e)=>Zy(t,e),parseInBatches:OB,options:{csv:{shape:zp,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","	","|",";"]}}};async function Zy(t,e){const n={...Vp.options.csv,...e==null?void 0:e.csv},r=FB(t),s=n.header==="auto"?Z1(r):!!n.header,o={...n,header:s,download:!1,transformHeader:s?Q1():void 0,error:f=>{throw new Error(f)}},a=Gc.parse(t,o),l=a.data,c=a.meta.fields||J1(n.columnPrefix,r.length),u=n.shape||zp;switch(u){case"object-row-table":return{shape:"object-row-table",data:l.map(f=>Array.isArray(f)?$1(f,c):f)};case"array-row-table":return{shape:"array-row-table",data:l.map(f=>Array.isArray(f)?f:X1(f,c))};default:throw new Error(u)}}function OB(t,e){e={...e},e.batchSize==="auto"&&(e.batchSize=4e3);const n={...Vp.options.csv,...e==null?void 0:e.csv},r=new MB;let i=!0,s=null,o=null,a=null;const l={...n,header:!1,download:!1,chunkSize:1024*1024*5,skipEmptyLines:!1,step(c){let u=c.data;if(n.skipEmptyLines&&u.flat().join("").trim()==="")return;const f=c.meta.cursor;if(i&&!s&&(n.header==="auto"?Z1(u):!!n.header)){s=u.map(Q1());return}i&&(i=!1,s||(s=J1(n.columnPrefix,u.length)),a=DB(u,s)),n.optimizeMemoryUsage&&(u=JSON.parse(JSON.stringify(u)));const h=n.shape||zp;o=o||new dd(a,{shape:h,...e});try{o.addRow(u);const _=o&&o.getFullBatch({bytesUsed:f});_&&r.enqueue(_)}catch(_){r.enqueue(_)}},complete(c){try{const u=c.meta.cursor,f=o&&o.getFinalBatch({bytesUsed:u});f&&r.enqueue(f)}catch(u){r.enqueue(u)}r.close()}};return Gc.parse(t,l,tc),r}function Z1(t){return t&&t.every(e=>typeof e=="string")}function FB(t){return Gc.parse(t,{download:!1,dynamicTyping:!0,preview:1}).data[0]}function Q1(){const t=new Set;return e=>{let n=e,r=1;for(;t.has(n);)n=`${e}.${r}`,r++;return t.add(n),n}}function J1(t,e=0){const n=[];for(let r=0;r<e;r++)n.push(`${t}${r+1}`);return n}function DB(t,e){const n=e?{}:[];for(let r=0;r<t.length;r++){const i=e&&e[r]||r;switch(typeof t[r]){case"number":case"boolean":n[i]={name:String(i),index:r,type:Float32Array};break;case"string":default:n[i]={name:String(i),index:r,type:Array}}}return n}const ka=globalThis,Kr=globalThis.process||{};function BB(t){var r,i;if(typeof window<"u"&&((r=window.process)==null?void 0:r.type)==="renderer"||typeof process<"u"&&((i=process.versions)!=null&&i.electron))return!0;const e=typeof navigator<"u"&&navigator.userAgent,n=t||e;return!!(n&&n.indexOf("Electron")>=0)}function jp(){return!(typeof process=="object"&&String(process)==="[object process]"&&!(process!=null&&process.browser))||BB()}const G1="4.0.7";function UB(t){try{const e=window[t],n="__storage_test__";return e.setItem(n,n),e.removeItem(n),e}catch{return null}}class LB{constructor(e,n,r="sessionStorage"){this.storage=UB(r),this.id=e,this.config=n,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}}_loadConfiguration(){let e={};if(this.storage){const n=this.storage.getItem(this.id);e=n?JSON.parse(n):{}}return Object.assign(this.config,e),this}}function zB(t){let e;return t<10?e=`${t.toFixed(2)}ms`:t<100?e=`${t.toFixed(1)}ms`:t<1e3?e=`${t.toFixed(0)}ms`:e=`${(t/1e3).toFixed(2)}s`,e}function VB(t,e=8){const n=Math.max(e-t.length,0);return`${" ".repeat(n)}${t}`}var nc;(function(t){t[t.BLACK=30]="BLACK",t[t.RED=31]="RED",t[t.GREEN=32]="GREEN",t[t.YELLOW=33]="YELLOW",t[t.BLUE=34]="BLUE",t[t.MAGENTA=35]="MAGENTA",t[t.CYAN=36]="CYAN",t[t.WHITE=37]="WHITE",t[t.BRIGHT_BLACK=90]="BRIGHT_BLACK",t[t.BRIGHT_RED=91]="BRIGHT_RED",t[t.BRIGHT_GREEN=92]="BRIGHT_GREEN",t[t.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",t[t.BRIGHT_BLUE=94]="BRIGHT_BLUE",t[t.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",t[t.BRIGHT_CYAN=96]="BRIGHT_CYAN",t[t.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(nc||(nc={}));const jB=10;function Qy(t){return typeof t!="string"?t:(t=t.toUpperCase(),nc[t]||nc.WHITE)}function HB(t,e,n){return!jp&&typeof t=="string"&&(e&&(t=`\x1B[${Qy(e)}m${t}\x1B[39m`),n&&(t=`\x1B[${Qy(n)+jB}m${t}\x1B[49m`)),t}function WB(t,e=["constructor"]){const n=Object.getPrototypeOf(t),r=Object.getOwnPropertyNames(n),i=t;for(const s of r){const o=i[s];typeof o=="function"&&(e.find(a=>s===a)||(i[s]=o.bind(t)))}}function Hp(t,e){if(!t)throw new Error(e||"Assertion failed")}function qr(){var e,n,r;let t;if(jp()&&ka.performance)t=(n=(e=ka==null?void 0:ka.performance)==null?void 0:e.now)==null?void 0:n.call(e);else if("hrtime"in Kr){const i=(r=Kr==null?void 0:Kr.hrtime)==null?void 0:r.call(Kr);t=i[0]*1e3+i[1]/1e6}else t=Date.now();return t}const Zr={debug:jp()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},$B={enabled:!0,level:0};function Qr(){}const Jy={},Gy={once:!0};class eE{constructor({id:e}={id:""}){this.VERSION=G1,this._startTs=qr(),this._deltaTs=qr(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new LB(`__probe-${this.id}__`,$B),this.timeStamp(`${this.id} started`),WB(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((qr()-this._startTs).toPrecision(10))}getDelta(){return Number((qr()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,n){this._storage.setConfiguration({[e]:n})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,n){if(!e)throw new Error(n||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Zr.warn,arguments,Gy)}error(e){return this._getLogFunction(0,e,Zr.error,arguments)}deprecated(e,n){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${n}\` instead`)}removed(e,n){return this.error(`\`${e}\` has been removed. Use \`${n}\` instead`)}probe(e,n){return this._getLogFunction(e,n,Zr.log,arguments,{time:!0,once:!0})}log(e,n){return this._getLogFunction(e,n,Zr.debug,arguments)}info(e,n){return this._getLogFunction(e,n,console.info,arguments)}once(e,n){return this._getLogFunction(e,n,Zr.debug||Zr.info,arguments,Gy)}table(e,n,r){return n?this._getLogFunction(e,n,console.table||Qr,r&&[r],{tag:YB(n)}):Qr}time(e,n){return this._getLogFunction(e,n,console.time?console.time:console.info)}timeEnd(e,n){return this._getLogFunction(e,n,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,n){return this._getLogFunction(e,n,console.timeStamp||Qr)}group(e,n,r={collapsed:!1}){const i=e0({logLevel:e,message:n,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,n,r={}){return this.group(e,n,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Qr)}withGroup(e,n,r){this.group(e,n)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=tE(e)}_getLogFunction(e,n,r,i,s){if(this._shouldLog(e)){s=e0({logLevel:e,message:n,args:i,opts:s}),r=r||s.method,Hp(r),s.total=this.getTotal(),s.delta=this.getDelta(),this._deltaTs=qr();const o=s.tag||s.message;if(s.once&&o)if(!Jy[o])Jy[o]=qr();else return Qr;return n=XB(this.id,s.message,s),r.bind(console,n,...s.args)}return Qr}}eE.VERSION=G1;function tE(t){if(!t)return 0;let e;switch(typeof t){case"number":e=t;break;case"object":e=t.logLevel||t.priority||0;break;default:return 0}return Hp(Number.isFinite(e)&&e>=0),e}function e0(t){const{logLevel:e,message:n}=t;t.logLevel=tE(e);const r=t.args?Array.from(t.args):[];for(;r.length&&r.shift()!==n;);switch(typeof e){case"string":case"function":n!==void 0&&r.unshift(n),t.message=e;break;case"object":Object.assign(t,e);break}typeof t.message=="function"&&(t.message=t.message());const i=typeof t.message;return Hp(i==="string"||i==="object"),Object.assign(t,{args:r},t.opts)}function XB(t,e,n){if(typeof e=="string"){const r=n.time?VB(zB(n.total)):"";e=n.time?`${t}: ${r}  ${e}`:`${t}: ${e}`,e=HB(e,n.color,n.background)}return e}function YB(t){for(const e in t)for(const n in t[e])return n||"untitled";return"empty"}const KB=new eE({id:"luma.gl"}),t0=`precision highp int;
struct AmbientLight {
vec3 color;
};
struct PointLight {
vec3 color;
vec3 position;
vec3 attenuation;
};
struct DirectionalLight {
vec3 color;
vec3 direction;
};
uniform lightingUniforms {
int enabled;
int lightType;
int directionalLightCount;
int pointLightCount;
vec3 ambientColor;
vec3 lightColor0;
vec3 lightPosition0;
vec3 lightDirection0;
vec3 lightAttenuation0;
vec3 lightColor1;
vec3 lightPosition1;
vec3 lightDirection1;
vec3 lightAttenuation1;
vec3 lightColor2;
vec3 lightPosition2;
vec3 lightDirection2;
vec3 lightAttenuation2;
} lighting;
PointLight lighting_getPointLight(int index) {
switch (index) {
case 0:
return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
case 1:
return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
case 2:
default:
return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
}
}
DirectionalLight lighting_getDirectionalLight(int index) {
switch (index) {
case 0:
return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
case 1:
return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
case 2:
default:
return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
}
}
float getPointLightAttenuation(PointLight pointLight, float distance) {
return pointLight.attenuation.x
+ pointLight.attenuation.y * distance
+ pointLight.attenuation.z * distance * distance;
}
`,nE=3,qB=255;var To;(function(t){t[t.POINT=0]="POINT",t[t.DIRECTIONAL=1]="DIRECTIONAL"})(To||(To={}));const Za={name:"lighting",vs:t0,fs:t0,getUniforms(t,e){return ZB(t)},defines:{MAX_LIGHTS:nE},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:To.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]}};function ZB(t,e={}){if(t=t&&{...t},!t)return{...Za.defaultUniforms};t.lights&&(t={...t,...JB(t.lights),lights:void 0});const{ambientLight:n,pointLights:r,directionalLights:i}=t||{};if(!(n||r&&r.length>0||i&&i.length>0))return{...Za.defaultUniforms,enabled:0};const o={...Za.defaultUniforms,...e,...QB({ambientLight:n,pointLights:r,directionalLights:i})};return t.enabled!==void 0&&(o.enabled=t.enabled?1:0),o}function QB({ambientLight:t,pointLights:e=[],directionalLights:n=[]}){const r={};r.ambientLightColor=vf(t);let i=0;for(const s of e){r.lightType=To.POINT;const o=i;r[`lightColor${o}`]=vf(s),r[`lightPosition${o}`]=s.position,r[`lightAttenuation${o}`]=s.attenuation||[1,0,0],i++}for(const s of n){r.lightType=To.DIRECTIONAL;const o=i;r[`lightColor${o}`]=vf(s),r[`lightDirection${o}`]=s.direction,i++}return i>nE&&KB.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=n.length,r.pointLightCount=e.length,r}function JB(t){var n,r;const e={pointLights:[],directionalLights:[]};for(const i of t||[])switch(i.type){case"ambient":e.ambientLight=i;break;case"directional":(n=e.directionalLights)==null||n.push(i);break;case"point":(r=e.pointLights)==null||r.push(i);break}return e}function vf(t={}){const{color:e=[0,0,0],intensity:n=1}=t;return e.map(r=>r*n/qB)}const GB=`uniform phongMaterialUniforms {
uniform float ambient;
uniform float diffuse;
uniform float shininess;
uniform vec3  specularColor;
} material;
`,e4=`uniform phongMaterialUniforms {
uniform float ambient;
uniform float diffuse;
uniform float shininess;
uniform vec3  specularColor;
} material;
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
vec3 halfway_direction = normalize(light_direction + view_direction);
float lambertian = dot(light_direction, normal_worldspace);
float specular = 0.0;
if (lambertian > 0.0) {
float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
specular = pow(specular_angle, material.shininess);
}
lambertian = max(lambertian, 0.0);
return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}
vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
vec3 lightColor = surfaceColor;
if (lighting.enabled == 0) {
return lightColor;
}
vec3 view_direction = normalize(cameraPosition - position_worldspace);
lightColor = material.ambient * surfaceColor * lighting.ambientColor;
for (int i = 0; i < lighting.pointLightCount; i++) {
PointLight pointLight = lighting_getPointLight(i);
vec3 light_position_worldspace = pointLight.position;
vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
}
int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
for (int i = lighting.pointLightCount; i < totalLights; i++) {
DirectionalLight directionalLight = lighting_getDirectionalLight(i);
lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
}
return lightColor;
}
`,rE={name:"phongMaterial",vs:GB,fs:e4,defines:{LIGHTING_FRAGMENT:1},dependencies:[Za],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(t){const e={...t};return e.specularColor&&(e.specularColor=e.specularColor.map(n=>n/255)),{...rE.defaultUniforms,...e}}},n0=`uniform iconUniforms {
  float sizeScale;
  vec2 iconsTextureDim;
  float sizeMinPixels;
  float sizeMaxPixels;
  bool billboard;
  highp int sizeUnits;
  float alphaCutoff;
} icon;
`,t4={name:"icon",vs:n0,fs:n0,uniformTypes:{sizeScale:"f32",iconsTextureDim:"vec2<f32>",sizeMinPixels:"f32",sizeMaxPixels:"f32",billboard:"f32",sizeUnits:"i32",alphaCutoff:"f32"}},n4=`#version 300 es
#define SHADER_NAME icon-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceSizes;
in float instanceAngles;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec4 instanceIconFrames;
in float instanceColorModes;
in vec2 instanceOffsets;
in vec2 instancePixelOffset;
out float vColorMode;
out vec4 vColor;
out vec2 vTextureCoords;
out vec2 uv;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = angle * PI / 180.0;
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vec2 iconSize = instanceIconFrames.zw;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * icon.sizeScale, icon.sizeUnits),
icon.sizeMinPixels, icon.sizeMaxPixels
);
float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
pixelOffset += instancePixelOffset;
pixelOffset.y *= -1.0;
if (icon.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vTextureCoords = mix(
instanceIconFrames.xy,
instanceIconFrames.xy + iconSize,
(positions.xy + 1.0) / 2.0
) / icon.iconsTextureDim;
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
vColorMode = instanceColorModes;
}
`,r4=`#version 300 es
#define SHADER_NAME icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in float vColorMode;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec4 texColor = texture(iconsTexture, vTextureCoords);
vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
float a = texColor.a * layer.opacity * vColor.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color, a);
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,i4=1024,s4=4,r0=()=>{},i0={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},o4={x:0,y:0,width:0,height:0};function a4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function l4(t,e,n,r){const i=Math.min(n/e.width,r/e.height),s=Math.floor(e.width*i),o=Math.floor(e.height*i);return i===1?{image:e,width:s,height:o}:(t.canvas.height=o,t.canvas.width=s,t.clearRect(0,0,s,o),t.drawImage(e,0,0,e.width,e.height,0,0,s,o),{image:t.canvas,width:s,height:o})}function wo(t){return t&&(t.id||t.url)}function c4(t,e,n,r){const{width:i,height:s,device:o}=t,a=o.createTexture({format:"rgba8unorm",width:e,height:n,sampler:r,mipmaps:!0}),l=o.createCommandEncoder();return l.copyTextureToTexture({sourceTexture:t,destinationTexture:a,width:i,height:s}),l.finish(),t.destroy(),a}function s0(t,e,n){for(let r=0;r<e.length;r++){const{icon:i,xOffset:s}=e[r],o=wo(i);t[o]={...i,x:s,y:n}}}function u4({icons:t,buffer:e,mapping:n={},xOffset:r=0,yOffset:i=0,rowHeight:s=0,canvasWidth:o}){let a=[];for(let l=0;l<t.length;l++){const c=t[l],u=wo(c);if(!n[u]){const{height:f,width:h}=c;r+h+e>o&&(s0(n,a,i),r=0,i=s+i+e,s=0,a=[]),a.push({icon:c,xOffset:r}),r=r+h+e,s=Math.max(s,f)}}return a.length>0&&s0(n,a,i),{mapping:n,rowHeight:s,xOffset:r,yOffset:i,canvasWidth:o,canvasHeight:a4(s+i+e)}}function f4(t,e,n){if(!t||!e)return null;n=n||{};const r={},{iterable:i,objectInfo:s}=kp(t);for(const o of i){s.index++;const a=e(o,s),l=wo(a);if(!a)throw new Error("Icon is missing.");if(!a.url)throw new Error("Icon url is missing.");!r[l]&&(!n[l]||a.url!==n[l].url)&&(r[l]={...a,source:o,sourceIndex:s.index})}return r}class h4{constructor(e,{onUpdate:n=r0,onError:r=r0}){this._loadOptions=null,this._texture=null,this._externalTexture=null,this._mapping={},this._samplerParameters=null,this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=s4,this._canvasWidth=i4,this._canvasHeight=0,this._canvas=null,this.device=e,this.onUpdate=n,this.onError=r}finalize(){var e;(e=this._texture)==null||e.delete()}getTexture(){return this._texture||this._externalTexture}getIconMapping(e){const n=this._autoPacking?wo(e):e;return this._mapping[n]||o4}setProps({loadOptions:e,autoPacking:n,iconAtlas:r,iconMapping:i,textureParameters:s}){var o;e&&(this._loadOptions=e),n!==void 0&&(this._autoPacking=n),i&&(this._mapping=i),r&&((o=this._texture)==null||o.delete(),this._texture=null,this._externalTexture=r),s&&(this._samplerParameters=s)}get isLoaded(){return this._pendingCount===0}packIcons(e,n){if(!this._autoPacking||typeof document>"u")return;const r=Object.values(f4(e,n,this._mapping)||{});if(r.length>0){const{mapping:i,xOffset:s,yOffset:o,rowHeight:a,canvasHeight:l}=u4({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset});this._rowHeight=a,this._mapping=i,this._xOffset=s,this._yOffset=o,this._canvasHeight=l,this._texture||(this._texture=this.device.createTexture({format:"rgba8unorm",width:this._canvasWidth,height:this._canvasHeight,sampler:this._samplerParameters||i0,mipmaps:!0})),this._texture.height!==this._canvasHeight&&(this._texture=c4(this._texture,this._canvasWidth,this._canvasHeight,this._samplerParameters||i0)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(r)}}_loadIcons(e){const n=this._canvas.getContext("2d",{willReadFrequently:!0});for(const r of e)this._pendingCount++,Al(r.url,this._loadOptions).then(i=>{var v;const s=wo(r),o=this._mapping[s],{x:a,y:l,width:c,height:u}=o,{image:f,width:h,height:_}=l4(n,i,c,u);(v=this._texture)==null||v.copyExternalImage({image:f,x:a+(c-h)/2,y:l+(u-_)/2,width:h,height:_}),o.width=h,o.height=_,this._texture.generateMipmap(),this.onUpdate()}).catch(i=>{this.onError({url:r.url,source:r.source,sourceIndex:r.sourceIndex,loadOptions:this._loadOptions,error:i})}).finally(()=>{this._pendingCount--})}}const iE=[0,0,0,255],d4={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:t=>t.position},getIcon:{type:"accessor",value:t=>t.icon},getColor:{type:"accessor",value:iE},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0,value:null}},Rc=class Rc extends Yi{getShaders(){return super.getShaders({vs:n4,fs:r4,modules:[zw,Xw,t4]})}initializeState(){this.state={iconManager:new h4(this.context.device,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:"uint8",accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:iE},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}updateState(e){var _;super.updateState(e);const{props:n,oldProps:r,changeFlags:i}=e,s=this.getAttributeManager(),{iconAtlas:o,iconMapping:a,data:l,getIcon:c,textureParameters:u}=n,{iconManager:f}=this.state;if(typeof o=="string")return;const h=o||this.internalState.isAsyncPropLoading("iconAtlas");f.setProps({loadOptions:n.loadOptions,autoPacking:!h,iconAtlas:o,iconMapping:h?a:null,textureParameters:u}),h?r.iconMapping!==n.iconMapping&&s.invalidate("getIcon"):(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getIcon))&&f.packIcons(l,c),i.extensionsChanged&&((_=this.state.model)==null||_.destroy(),this.state.model=this._getModel(),s.invalidateAll())}get isLoaded(){return super.isLoaded&&this.state.iconManager.isLoaded}finalizeState(e){super.finalizeState(e),this.state.iconManager.finalize()}draw({uniforms:e}){const{sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,sizeUnits:s,billboard:o,alphaCutoff:a}=this.props,{iconManager:l}=this.state,c=l.getTexture();if(c){const u=this.state.model,f={iconsTexture:c,iconsTextureDim:[c.width,c.height],sizeUnits:Ll[s],sizeScale:n,sizeMinPixels:r,sizeMaxPixels:i,billboard:o,alphaCutoff:a};u.shaderInputs.setProps({icon:f}),u.draw(this.context.renderPass)}}_getModel(){const e=[-1,-1,1,-1,-1,1,1,1];return new Hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new t1({topology:"triangle-strip",attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}_onUpdate(){this.setNeedsRedraw()}_onError(e){var r;const n=(r=this.getCurrentLayer())==null?void 0:r.props.onIconError;n?n(e):ne.error(e.error.message)()}getInstanceOffset(e){const{width:n,height:r,anchorX:i=n/2,anchorY:s=r/2}=this.state.iconManager.getIconMapping(e);return[n/2-i,r/2-s]}getInstanceColorMode(e){return this.state.iconManager.getIconMapping(e).mask?1:0}getInstanceIconFrame(e){const{x:n,y:r,width:i,height:s}=this.state.iconManager.getIconMapping(e);return[n,r,i,s]}};Rc.defaultProps=d4,Rc.layerName="IconLayer";let gd=Rc;const o0=`uniform sdfUniforms {
  float gamma;
  bool enabled;
  float buffer;
  float outlineBuffer;
  vec4 outlineColor;
} sdf;
`,p4={name:"sdf",vs:o0,fs:o0,uniformTypes:{gamma:"f32",enabled:"f32",buffer:"f32",outlineBuffer:"f32",outlineColor:"vec4<f32>"}},g4=`#version 300 es
#define SHADER_NAME multi-icon-layer-fragment-shader
precision highp float;
uniform sampler2D iconsTexture;
in vec4 vColor;
in vec2 vTextureCoords;
in vec2 uv;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
if (!bool(picking.isActive)) {
float alpha = texture(iconsTexture, vTextureCoords).a;
vec4 color = vColor;
if (sdf.enabled) {
float distance = alpha;
alpha = smoothstep(sdf.buffer - sdf.gamma, sdf.buffer + sdf.gamma, distance);
if (sdf.outlineBuffer > 0.0) {
float inFill = alpha;
float inBorder = smoothstep(sdf.outlineBuffer - sdf.gamma, sdf.outlineBuffer + sdf.gamma, distance);
color = mix(sdf.outlineColor, vColor, inFill);
alpha = inBorder;
}
}
float a = alpha * color.a;
if (a < icon.alphaCutoff) {
discard;
}
fragColor = vec4(color.rgb, a * layer.opacity);
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,Tf=192/256,a0=[],_4={getIconOffsets:{type:"accessor",value:t=>t.offsets},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},Cc=class Cc extends gd{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,p4],fs:g4}}initializeState(){super.initializeState(),this.getAttributeManager().addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:"uint8",size:3,accessor:(n,{index:r,target:i})=>this.encodePickingColor(r,i)}})}updateState(e){super.updateState(e);const{props:n,oldProps:r}=e;let{outlineColor:i}=n;i!==r.outlineColor&&(i=i.map(s=>s/255),i[3]=Number.isFinite(i[3])?i[3]:1,this.setState({outlineColor:i})),!n.sdf&&n.outlineWidth&&ne.warn(`${this.id}: fontSettings.sdf is required to render outline`)()}draw(e){const{sdf:n,smoothing:r,outlineWidth:i}=this.props,{outlineColor:s}=this.state,o=i?Math.max(r,Tf*(1-i)):-1,a=this.state.model,l={buffer:Tf,outlineBuffer:o,gamma:r,enabled:!!n,outlineColor:s};if(a.shaderInputs.setProps({sdf:l}),super.draw(e),n&&i){const{iconManager:c}=this.state;c.getTexture()&&(a.shaderInputs.setProps({sdf:{...l,outlineBuffer:Tf}}),a.draw(this.context.renderPass))}}getInstanceOffset(e){return e?Array.from(e).flatMap(n=>super.getInstanceOffset(n)):a0}getInstanceColorMode(e){return 1}getInstanceIconFrame(e){return e?Array.from(e).flatMap(n=>super.getInstanceIconFrame(n)):a0}};Cc.defaultProps=_4,Cc.layerName="MultiIconLayer";let Eo=Cc;const Ws=1e20;class m4{constructor({fontSize:e=24,buffer:n=3,radius:r=8,cutoff:i=.25,fontFamily:s="sans-serif",fontWeight:o="normal",fontStyle:a="normal"}={}){this.buffer=n,this.cutoff=i,this.radius=r;const l=this.size=e+n*4,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font=`${a} ${o} ${e}px ${s}`,u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const n=document.createElement("canvas");return n.width=n.height=e,n}draw(e){const{width:n,actualBoundingBoxAscent:r,actualBoundingBoxDescent:i,actualBoundingBoxLeft:s,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),l=0,c=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-s))),u=Math.min(this.size-this.buffer,a+Math.ceil(i)),f=c+2*this.buffer,h=u+2*this.buffer,_=Math.max(f*h,0),v=new Uint8ClampedArray(_),E={data:v,width:f,height:h,glyphWidth:c,glyphHeight:u,glyphTop:a,glyphLeft:l,glyphAdvance:n};if(c===0||u===0)return E;const{ctx:b,buffer:g,gridInner:p,gridOuter:y}=this;b.clearRect(g,g,c,u),b.fillText(e,g,g+a);const S=b.getImageData(g,g,c,u);y.fill(Ws,0,_),p.fill(0,0,_);for(let R=0;R<u;R++)for(let P=0;P<c;P++){const O=S.data[4*(R*c+P)+3]/255;if(O===0)continue;const M=(R+g)*f+P+g;if(O===1)y[M]=0,p[M]=Ws;else{const k=.5-O;y[M]=k>0?k*k:0,p[M]=k<0?k*k:0}}l0(y,0,0,f,h,f,this.f,this.v,this.z),l0(p,g,g,c,u,f,this.f,this.v,this.z);for(let R=0;R<_;R++){const P=Math.sqrt(y[R])-Math.sqrt(p[R]);v[R]=Math.round(255-255*(P/this.radius+this.cutoff))}return E}}function l0(t,e,n,r,i,s,o,a,l){for(let c=e;c<e+r;c++)c0(t,n*s+c,s,i,o,a,l);for(let c=n;c<n+i;c++)c0(t,c*s+e,1,r,o,a,l)}function c0(t,e,n,r,i,s,o){s[0]=0,o[0]=-Ws,o[1]=Ws,i[0]=t[e];for(let a=1,l=0,c=0;a<r;a++){i[a]=t[e+a*n];const u=a*a;do{const f=s[l];c=(i[a]-i[f]+u-f*f)/(a-f)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=Ws}for(let a=0,l=0;a<r;a++){for(;o[l+1]<a;)l++;const c=s[l],u=a-c;t[e+a*n]=i[c]+u*u}}const y4=32,v4=[];function T4(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function w4({characterSet:t,getFontWidth:e,fontHeight:n,buffer:r,maxCanvasWidth:i,mapping:s={},xOffset:o=0,yOffset:a=0}){let l=0,c=o;const u=n+r*2;for(const f of t)if(!s[f]){const h=e(f);c+h+r*2>i&&(c=0,l++),s[f]={x:c+r,y:a+l*u+r,width:h,height:u,layoutWidth:h,layoutHeight:n},c+=h+r*2}return{mapping:s,xOffset:c,yOffset:a+l*u,canvasHeight:T4(a+(l+1)*u)}}function sE(t,e,n,r){var s;let i=0;for(let o=e;o<n;o++){const a=t[o];i+=((s=r[a])==null?void 0:s.layoutWidth)||0}return i}function oE(t,e,n,r,i,s){let o=e,a=0;for(let l=e;l<n;l++){const c=sE(t,l,l+1,i);a+c>r&&(o<l&&s.push(l),o=l,a=0),a+=c}return a}function E4(t,e,n,r,i,s){let o=e,a=e,l=e,c=0;for(let u=e;u<n;u++)if((t[u]===" "||t[u+1]===" "||u+1===n)&&(l=u+1),l>a){let f=sE(t,a,l,i);c+f>r&&(o<a&&(s.push(a),o=a,c=0),f>r&&(f=oE(t,a,l,r,i,s),o=s[s.length-1])),a=l,c+=f}return c}function S4(t,e,n,r,i=0,s){s===void 0&&(s=t.length);const o=[];return e==="break-all"?oE(t,i,s,n,r,o):E4(t,i,s,n,r,o),o}function b4(t,e,n,r,i,s){let o=0,a=0;for(let l=e;l<n;l++){const c=t[l],u=r[c];u?(a||(a=u.layoutHeight),i[l]=o+u.layoutWidth/2,o+=u.layoutWidth):(ne.warn(`Missing character: ${c} (${c.codePointAt(0)})`)(),i[l]=o,o+=y4)}s[0]=o,s[1]=a}function A4(t,e,n,r,i){var b;const s=Array.from(t),o=s.length,a=new Array(o),l=new Array(o),c=new Array(o),u=(n==="break-word"||n==="break-all")&&isFinite(r)&&r>0,f=[0,0],h=[0,0];let _=0,v=0,E=0;for(let g=0;g<=o;g++){const p=s[g];if((p===`
`||g===o)&&(E=g),E>v){const y=u?S4(s,n,r,i,v,E):v4;for(let S=0;S<=y.length;S++){const R=S===0?v:y[S-1],P=S<y.length?y[S]:E;b4(s,R,P,i,a,h);for(let O=R;O<P;O++){const M=s[O],k=((b=i[M])==null?void 0:b.layoutOffsetY)||0;l[O]=_+h[1]/2+k,c[O]=h[0]}_=_+h[1]*e,f[0]=Math.max(f[0],h[0])}v=E}p===`
`&&(a[v]=0,l[v]=0,c[v]=0,v++)}return f[1]=_,{x:a,y:l,rowWidth:c,size:f}}function R4({value:t,length:e,stride:n,offset:r,startIndices:i,characterSet:s}){const o=t.BYTES_PER_ELEMENT,a=n?n/o:1,l=r?r/o:0,c=i[e]||Math.ceil((t.length-l)/a),u=s&&new Set,f=new Array(e);let h=t;if(a>1||l>0){const _=t.constructor;h=new _(c);for(let v=0;v<c;v++)h[v]=t[v*a+l]}for(let _=0;_<e;_++){const v=i[_],E=i[_+1]||c,b=h.subarray(v,E);f[_]=String.fromCodePoint.apply(null,b),u&&b.forEach(u.add,u)}if(u)for(const _ of u)s.add(String.fromCodePoint(_));return{texts:f,characterCount:c}}class aE{constructor(e=5){this._cache={},this._order=[],this.limit=e}get(e){const n=this._cache[e];return n&&(this._deleteOrder(e),this._appendOrder(e)),n}set(e,n){this._cache[e]?(this.delete(e),this._cache[e]=n,this._appendOrder(e)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[e]=n,this._appendOrder(e))}delete(e){this._cache[e]&&(delete this._cache[e],this._deleteOrder(e))}_deleteOrder(e){const n=this._order.indexOf(e);n>=0&&this._order.splice(n,1)}_appendOrder(e){this._order.push(e)}}function C4(){const t=[];for(let e=32;e<128;e++)t.push(String.fromCharCode(e));return t}const Ci={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:C4(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},u0=1024,f0=.9,h0=1.2,lE=3;let rc=new aE(lE);function x4(t,e){let n;typeof e=="string"?n=new Set(Array.from(e)):n=new Set(e);const r=rc.get(t);if(!r)return n;for(const i in r.mapping)n.has(i)&&n.delete(i);return n}function P4(t,e){for(let n=0;n<t.length;n++)e.data[4*n+3]=t[n]}function d0(t,e,n,r){t.font=`${r} ${n}px ${e}`,t.fillStyle="#000",t.textBaseline="alphabetic",t.textAlign="left"}function M4(t){ne.assert(Number.isFinite(t)&&t>=lE,"Invalid cache limit"),rc=new aE(t)}class I4{constructor(){this.props={...Ci}}get atlas(){return this._atlas}get mapping(){return this._atlas&&this._atlas.mapping}get scale(){const{fontSize:e,buffer:n}=this.props;return(e*h0+n*2)/e}setProps(e={}){Object.assign(this.props,e),this._key=this._getKey();const n=x4(this._key,this.props.characterSet),r=rc.get(this._key);if(r&&n.size===0){this._atlas!==r&&(this._atlas=r);return}const i=this._generateFontAtlas(n,r);this._atlas=i,rc.set(this._key,i)}_generateFontAtlas(e,n){const{fontFamily:r,fontWeight:i,fontSize:s,buffer:o,sdf:a,radius:l,cutoff:c}=this.props;let u=n&&n.data;u||(u=document.createElement("canvas"),u.width=u0);const f=u.getContext("2d",{willReadFrequently:!0});d0(f,r,s,i);const{mapping:h,canvasHeight:_,xOffset:v,yOffset:E}=w4({getFontWidth:b=>f.measureText(b).width,fontHeight:s*h0,buffer:o,characterSet:e,maxCanvasWidth:u0,...n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset}});if(u.height!==_){const b=f.getImageData(0,0,u.width,u.height);u.height=_,f.putImageData(b,0,0)}if(d0(f,r,s,i),a){const b=new m4({fontSize:s,buffer:o,radius:l,cutoff:c,fontFamily:r,fontWeight:`${i}`});for(const g of e){const{data:p,width:y,height:S,glyphTop:R}=b.draw(g);h[g].width=y,h[g].layoutOffsetY=s*f0-R;const P=f.createImageData(y,S);P4(p,P),f.putImageData(P,h[g].x,h[g].y)}}else for(const b of e)f.fillText(b,h[b].x,h[b].y+o+s*f0);return{xOffset:v,yOffset:E,mapping:h,data:u,width:u.width,height:u.height}}_getKey(){const{fontFamily:e,fontWeight:n,fontSize:r,buffer:i,sdf:s,radius:o,cutoff:a}=this.props;return s?`${e} ${n} ${r} ${i} ${o} ${a}`:`${e} ${n} ${r} ${i}`}}const p0=`uniform textBackgroundUniforms {
  bool billboard;
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  vec4 padding;
  highp int sizeUnits;
  bool stroked;
} textBackground;
`,N4={name:"textBackground",vs:p0,fs:p0,uniformTypes:{billboard:"f32",sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",padding:"vec4<f32>",sizeUnits:"i32",stroked:"f32"}},k4=`#version 300 es
#define SHADER_NAME text-background-layer-vertex-shader
in vec2 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceRects;
in float instanceSizes;
in float instanceAngles;
in vec2 instancePixelOffsets;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out float vLineWidth;
out vec2 uv;
out vec2 dimensions;
vec2 rotate_by_angle(vec2 vertex, float angle) {
float angle_radian = radians(angle);
float cos_angle = cos(angle_radian);
float sin_angle = sin(angle_radian);
mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
return rotationMatrix * vertex;
}
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = positions;
geometry.pickingColor = instancePickingColors;
uv = positions;
vLineWidth = instanceLineWidths;
float sizePixels = clamp(
project_size_to_pixel(instanceSizes * textBackground.sizeScale, textBackground.sizeUnits),
textBackground.sizeMinPixels, textBackground.sizeMaxPixels
);
dimensions = instanceRects.zw * sizePixels + textBackground.padding.xy + textBackground.padding.zw;
vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-textBackground.padding.xy, textBackground.padding.zw, positions);
pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
pixelOffset += instancePixelOffsets;
pixelOffset.y *= -1.0;
if (textBackground.billboard)  {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = vec3(pixelOffset, 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
DECKGL_FILTER_SIZE(offset_common, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,O4=`#version 300 es
#define SHADER_NAME text-background-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in float vLineWidth;
in vec2 uv;
in vec2 dimensions;
out vec4 fragColor;
void main(void) {
geometry.uv = uv;
vec2 pixelPosition = uv * dimensions;
if (textBackground.stroked) {
float distToEdge = min(
min(pixelPosition.x, dimensions.x - pixelPosition.x),
min(pixelPosition.y, dimensions.y - pixelPosition.y)
);
float isBorder = smoothedge(distToEdge, vLineWidth);
fragColor = mix(vFillColor, vLineColor, isBorder);
} else {
fragColor = vFillColor;
}
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,F4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:t=>t.position},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},xc=class xc extends Yi{getShaders(){return super.getShaders({vs:k4,fs:O4,modules:[zw,Xw,N4]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){var r;super.updateState(e);const{changeFlags:n}=e;n.extensionsChanged&&((r=this.state.model)==null||r.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){const{billboard:n,sizeScale:r,sizeUnits:i,sizeMinPixels:s,sizeMaxPixels:o,getLineWidth:a}=this.props;let{padding:l}=this.props;l.length<4&&(l=[l[0],l[1],l[0],l[1]]);const c=this.state.model,u={billboard:n,stroked:!!a,padding:l,sizeUnits:Ll[i],sizeScale:r,sizeMinPixels:s,sizeMaxPixels:o};c.shaderInputs.setProps({textBackground:u}),c.draw(this.context.renderPass)}_getModel(){const e=[0,0,1,0,0,1,1,1];return new Hi(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new t1({topology:"triangle-strip",vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(e)}}}),isInstanced:!0})}};xc.defaultProps=F4,xc.layerName="TextBackgroundLayer";let _d=xc;const g0={start:1,middle:0,end:-1},_0={top:1,center:0,bottom:-1},wf=[0,0,0,255],D4=1,B4={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:wf},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:Ci.characterSet},fontFamily:Ci.fontFamily,fontWeight:Ci.fontWeight,lineHeight:D4,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:wf},fontSettings:{type:"object",value:{},compare:1},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:t=>t.text},getPosition:{type:"accessor",value:t=>t.position},getColor:{type:"accessor",value:wf},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},Pc=class Pc extends sd{constructor(){super(...arguments),this.getBoundingRect=(e,n)=>{let{size:[r,i]}=this.transformParagraph(e,n);const{fontSize:s}=this.state.fontAtlasManager.props;r/=s,i/=s;const{getTextAnchor:o,getAlignmentBaseline:a}=this.props,l=g0[typeof o=="function"?o(e,n):o],c=_0[typeof a=="function"?a(e,n):a];return[(l-1)*r/2,(c-1)*i/2,r,i]},this.getIconOffsets=(e,n)=>{const{getTextAnchor:r,getAlignmentBaseline:i}=this.props,{x:s,y:o,rowWidth:a,size:[l,c]}=this.transformParagraph(e,n),u=g0[typeof r=="function"?r(e,n):r],f=_0[typeof i=="function"?i(e,n):i],h=s.length,_=new Array(h*2);let v=0;for(let E=0;E<h;E++){const b=(1-u)*(l-a[E])/2;_[v++]=(u-1)*l/2+b+s[E],_[v++]=(f-1)*c/2+o[E]}return _}}initializeState(){this.state={styleVersion:0,fontAtlasManager:new I4},this.props.maxWidth>0&&ne.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}updateState(e){const{props:n,oldProps:r,changeFlags:i}=e;(i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getText))&&this._updateText(),(this._updateFontAtlas()||n.lineHeight!==r.lineHeight||n.wordBreak!==r.wordBreak||n.maxWidth!==r.maxWidth)&&this.setState({styleVersion:this.state.styleVersion+1})}getPickingInfo({info:e}){return e.object=e.index>=0?this.props.data[e.index]:null,e}_updateFontAtlas(){const{fontSettings:e,fontFamily:n,fontWeight:r}=this.props,{fontAtlasManager:i,characterSet:s}=this.state,o={...e,characterSet:s,fontFamily:n,fontWeight:r};if(!i.mapping)return i.setProps(o),!0;for(const a in o)if(o[a]!==i.props[a])return i.setProps(o),!0;return!1}_updateText(){var l;const{data:e,characterSet:n}=this.props,r=(l=e.attributes)==null?void 0:l.getText;let{getText:i}=this.props,s=e.startIndices,o;const a=n==="auto"&&new Set;if(r&&s){const{texts:c,characterCount:u}=R4({...ArrayBuffer.isView(r)?{value:r}:r,length:e.length,startIndices:s,characterSet:a});o=u,i=(f,{index:h})=>c[h]}else{const{iterable:c,objectInfo:u}=kp(e);s=[0],o=0;for(const f of c){u.index++;const h=Array.from(i(f,u)||"");a&&h.forEach(a.add,a),o+=h.length,s.push(o)}}this.setState({getText:i,startIndices:s,numInstances:o,characterSet:a||n})}transformParagraph(e,n){const{fontAtlasManager:r}=this.state,i=r.mapping,s=this.state.getText,{wordBreak:o,lineHeight:a,maxWidth:l}=this.props,c=s(e,n)||"";return A4(c,a,o,l*r.props.fontSize,i)}renderLayers(){const{startIndices:e,numInstances:n,getText:r,fontAtlasManager:{scale:i,atlas:s,mapping:o},styleVersion:a}=this.state,{data:l,_dataDiff:c,getPosition:u,getColor:f,getSize:h,getAngle:_,getPixelOffset:v,getBackgroundColor:E,getBorderColor:b,getBorderWidth:g,backgroundPadding:p,background:y,billboard:S,fontSettings:R,outlineWidth:P,outlineColor:O,sizeScale:M,sizeUnits:k,sizeMinPixels:D,sizeMaxPixels:F,transitions:B,updateTriggers:V}=this.props,H=this.getSubLayerClass("characters",Eo),Z=this.getSubLayerClass("background",_d);return[y&&new Z({getFillColor:E,getLineColor:b,getLineWidth:g,padding:p,getPosition:u,getSize:h,getAngle:_,getPixelOffset:v,billboard:S,sizeScale:M,sizeUnits:k,sizeMinPixels:D,sizeMaxPixels:F,transitions:B&&{getPosition:B.getPosition,getAngle:B.getAngle,getSize:B.getSize,getFillColor:B.getBackgroundColor,getLineColor:B.getBorderColor,getLineWidth:B.getBorderWidth,getPixelOffset:B.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:V.getPosition,getAngle:V.getAngle,getSize:V.getSize,getFillColor:V.getBackgroundColor,getLineColor:V.getBorderColor,getLineWidth:V.getBorderWidth,getPixelOffset:V.getPixelOffset,getBoundingRect:{getText:V.getText,getTextAnchor:V.getTextAnchor,getAlignmentBaseline:V.getAlignmentBaseline,styleVersion:a}}}),{data:l.attributes&&l.attributes.background?{length:l.length,attributes:l.attributes.background}:l,_dataDiff:c,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new H({sdf:R.sdf,smoothing:Number.isFinite(R.smoothing)?R.smoothing:Ci.smoothing,outlineWidth:P/(R.radius||Ci.radius),outlineColor:O,iconAtlas:s,iconMapping:o,getPosition:u,getColor:f,getSize:h,getAngle:_,getPixelOffset:v,billboard:S,sizeScale:M*i,sizeUnits:k,sizeMinPixels:D*i,sizeMaxPixels:F*i,transitions:B&&{getPosition:B.getPosition,getAngle:B.getAngle,getColor:B.getColor,getSize:B.getSize,getPixelOffset:B.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{all:V.getText,getPosition:V.getPosition,getAngle:V.getAngle,getColor:V.getColor,getSize:V.getSize,getPixelOffset:V.getPixelOffset,getIconOffsets:{getTextAnchor:V.getTextAnchor,getAlignmentBaseline:V.getAlignmentBaseline,styleVersion:a}}}),{data:l,_dataDiff:c,startIndices:e,numInstances:n,getIconOffsets:this.getIconOffsets,getIcon:r})]}static set fontAtlasCacheLimit(e){M4(e)}};Pc.defaultProps=B4,Pc.layerName="TextLayer";let ic=Pc;const U4=`uniform embossUniforms {
  float bevelHeight;
  bool showNormal;
} emboss;

vec3 emboss_getNormal(sampler2D tex, vec2 texCoord) {
  // Remove effect for small text
  vec2 atlasSize = vec2(textureSize(tex, 0));
  vec3 p = vec3(atlasSize * texCoord, 0.0);
  float t = smoothstep(8.0, 7.0, length(fwidth(p)));

  float height = textureLod(tex, texCoord, 1.0).a;
  float bevelWidth = 1.2;
  float normalizedWidth = sdf.buffer * (1.0 - bevelWidth);
  float z = smoothstep(normalizedWidth, sdf.buffer, height);

  // Round edge
  z = sqrt(z);

  p.z = 0.1 * atlasSize.x * emboss.bevelHeight * z * t;
  vec3 normal = normalize(cross(dFdx(p), dFdy(-p)));
  normal.y *= -1.0;
  return normal;
}
`,L4={name:"emboss",fs:U4,uniformTypes:{bevelHeight:"f32",showNormal:"i32"}},z4={...Eo.defaultProps,bevelHeight:1};class cE extends Eo{getShaders(){const e=super.getShaders();return{...e,modules:[...e.modules,rE,L4],inject:{"vs:#decl":`out vec3 cameraPosition;
out vec4 position_commonspace;
`,"vs:#main-end":`  cameraPosition = project.cameraPosition;
  position_commonspace = geometry.position;
`,"fs:#decl":`in vec3 cameraPosition;
in vec4 position_commonspace;
`,"fs:#main-end":`  if (!bool(picking.isActive)) {
    vec3 normal = emboss_getNormal(iconsTexture, vTextureCoords);
    fragColor.rgb = lighting_getLightColor(fragColor.rgb, cameraPosition, position_commonspace.xyz, normal);
    if (emboss.showNormal) {
      fragColor.rgb = 0.5 * normal + 0.5;
    }
  }
`}}}draw(e){const{bevelHeight:n,showNormal:r}=this.props,i={bevelHeight:n,showNormal:r};this.state.model.shaderInputs.setProps({emboss:i}),super.draw(e)}}cE.defaultProps=z4;const V4={...ic.defaultProps,_subLayerProps:{characters:{type:cE}}};class uE extends ic{getSubLayerProps(e){const{bevelHeight:n,material:r,showNormal:i}=this.props;return{bevelHeight:n,material:r,showNormal:i,...super.getSubLayerProps(e)}}}uE.defaultProps=V4;const fE=Array.from(document.querySelectorAll("input"));let hE={fontSize:32,bevelHeight:0,showNormal:!1,ambientLight:.55,cameraLight:1,directionalLight:.8,directionalShade:0,ambient:1,diffuse:.9,shininess:150,specularR:255,specularG:255,specularB:255};const dE=new Yw({color:[255,255,255],intensity:1}),pE=new UM({color:[255,255,255],intensity:.4}),gE=new Hl({color:[255,255,255],intensity:1,direction:[1,-1,0]}),_E=new Hl({color:[255,255,255],intensity:-.1,direction:[-1,1,0]}),xs={ambient:1,diffuse:.9,shininess:150,specularColor:[255,255,255]},j4=new Ap({ambientLight:dE,highlight:gE,shadow:_E,cameraLight:pE});mE(hE);const H4="https://raw.githubusercontent.com/visgl/deck.gl-data/master/examples/text-layer/cities-1000.csv",m0={latitude:52,longitude:0,zoom:6,maxZoom:16,pitch:0,maxPitch:15,bearing:0},W4="https://basemaps.cartocdn.com/gl/dark-matter-nolabels-gl-style/style.json",$4=W1().domain([1e3,1e4,1e5,1e6,1e7]).range([[29,145,192],[65,182,196],[127,205,187],[199,233,180],[237,248,177]]);function X4({noOverlap:t=!0,mapStyle:e=W4}){const[n,r]=W.useState(m0.zoom),[i,s]=W.useState(hE);fE.forEach(f=>{f.oninput=()=>{s(K4())}});const o=W.useCallback(({viewState:f})=>{r(f.zoom)},[]),a=2**n,l=a/3*i.fontSize,c=Math.min(a/500,1)*i.fontSize,u=new uE({id:"world-cities",data:H4,loaders:[Vp],dataTransform:f=>f.data.filter(h=>h.population>1e5),characterSet:"auto",fontFamily:"Arial",fontWeight:800,fontSettings:{buffer:32,fontSize:172,radius:50,sdf:!0,smoothing:.05},outlineWidth:16,outlineColor:[73,161,191],billboard:!1,material:xs,bevelHeight:i.bevelHeight,showNormal:i.showNormal,opacity:.8,parameters:{depthTest:!1},getText:f=>f.name,getPosition:f=>[f.longitude,f.latitude],getColor:f=>$4(f.population),getSize:f=>Math.pow(f.population,.25)/40,sizeScale:i.fontSize,sizeMaxPixels:l,sizeMinPixels:c,maxWidth:64*12,collisionEnabled:t,getCollisionPriority:f=>Math.log10(f.population),collisionTestProps:{sizeScale:i.fontSize*2,sizeMaxPixels:l*2,sizeMinPixels:c*2},extensions:[new ld]});return Sf.createElement(fD,{views:new Yl({repeat:!0}),layers:[u],initialViewState:m0,onViewStateChange:o,controller:!0,effects:[j4]},Sf.createElement(LA,{reuseMaps:!0,mapStyle:e}))}async function Y4(t){MT(t).render(Sf.createElement(X4,null))}function K4(){const t={};return fE.forEach(e=>{const n=e.id,r=e.value;n==="showNormal"?t[n]=e.checked:t[n]=Number(r);const i=document.getElementById(`${n}-value`);i&&(i.innerHTML=String(r))}),mE(t),t}function mE(t){dE.intensity=t.ambientLight,pE.intensity=t.cameraLight,gE.intensity=t.directionalLight,_E.intensity=-t.directionalShade,xs.ambient=t.ambient,xs.diffuse=t.diffuse,xs.shininess=t.shininess,xs.specularColor=[t.specularR,t.specularG,t.specularB]}Y4(document.getElementById("app"));export{Z4 as c,v0 as g};
